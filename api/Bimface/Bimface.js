"use strict";
function _defineProperty(t, e, i) {
  return e in t
    ? Object.defineProperty(t, e, {
      value: i,
      enumerable: !0,
      configurable: !0,
      writable: !0
    })
    : t[e] = i,
  t
}
var _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator
    ? function(t) {
      return typeof t
    }
    : function(t) {
      return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype
        ? "symbol"
        : typeof t
    },
  Glodon = window.Glodon || {};
Glodon.Version = (new Date).toLocaleDateString();
var CLOUD = window.CLOUD || {};
!function() {
  function t(t, e) {
    for (var i = e.split("."), n = t, o = i.length, r = 0; r < o; r++)
      void 0 === n[i[r]] && (n[i[r]] = {}),
      n = n[i[r]];
    return n
  }
  t(Glodon, "Web.Lang.Utility.Namespace").ensureNamespace = t
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Common"),
    e = function(t) {
      "string" == typeof t && (t = JSON.parse(res)),
      this.code = t.code,
      this.message = t.message
    };
  e.prototype = {
    getErrorCode: function() {
      return this.code
    },
    getErrorMessage: function() {
      return this.message
    }
  },
  t.Error = e
}(),
function() {
  function t(t) {
    function e() {}
    return e.prototype = t,
    new e
  }
  function e(e, i) {
    var n = t(i.prototype);
    n.constructor = e,
    e.prototype = n
  }
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Type").inheritPrototype = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest"),
    e = function(t) {
      var e,
        i = {
          type: "get",
          cache: !0,
          headers: {
            "Content-type": "application/x-www-form-urlencoded"
          },
          data: null,
          async: !0,
          success: null,
          failure: null
        },
        n = Object.assign(i, t);
      e = window.XMLHttpRequest
        ? new XMLHttpRequest
        : new ActiveXObject("Microsoft.XMLHTTP"),
      e.onreadystatechange = function() {
        if (4 == e.readyState) {
          var t = e.status;
          t >= 200 && t < 300
            ? n.success && n.success(e.responseText, e.responseXML)
            : n.failure && n.failure(t)
        }
      },
      e.open(n.type, n.url, n.async);
      for (var o in n.headers)
        e.setRequestHeader(o, n.headers[o]);
      e.send(n.data)
    },
    i = function(t, e) {
      var i = {};
      if (i[t])
        e && e();
      else {
        var n = document.createElement("script");
        n.type = "text/javascript",
        n.src = t,
        document.head.appendChild(n),
        i[t] = !0,
        n.readyState
          ? n.onreadystatechange = function() {
            "loaded" != n.readyState && "complete" != n.readyState || (n.onreadystatechange = null, e && e())
          }
          : n.onload = function() {
            e && e()
          }
      }
    };
  t.ajax = e,
  t.getScript = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.FullScreen"),
    e = function(t) {
      if (!t)
        return !1;
      t.requestFullscreen
        ? t.requestFullscreen()
        : t.mozRequestFullScreen
          ? t.mozRequestFullScreen()
          : t.webkitRequestFullScreen
            ? t.webkitRequestFullScreen()
            : t.msRequestFullscreen && t.msRequestFullscreen()
    },
    i = function() {
      document.exitFullscreen
        ? document.exitFullscreen()
        : document.mozCancelFullScreen
          ? document.mozCancelFullScreen()
          : document.webkitCancelFullScreen
            ? document.webkitCancelFullScreen()
            : document.msExitFullscreen && document.msExitFullscreen()
    },
    n = function(t) {
      var e = function() {
        t && t()
      };
      document.documentElement.onwebkitfullscreenchange = e,
      document.onmozfullscreenchange = e,
      document.onmsfullscreenchange = e
    };
  t.fullScreen = e,
  t.exitFullScreen = i,
  t.onFullScreenChanged = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    e = function(t, e) {
      var i = document.createElement(t);
      return i.setAttribute("class", e),
      i
    };
  t.create = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    e = function(t, e) {
      var i = document.createElementNS("http://www.w3.org/2000/svg", t);
      return i.setAttribute("class", e),
      i
    };
  t.createNS = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    e = function(t) {
      return t.indexof("#")
        ? document.getElementById(t.replace("#", ""))
        : t.indexof(".")
          ? document.getElementsByClassName(t.replace(".", ""))
          : document.getElementsByTagName(t)
    };
  t.select = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    e = function(t) {
      var e = {
          element: null,
          handle: null,
          axis: "all",
          cursor: "move",
          distance: 0,
          start: null,
          move: null,
          stop: null
        },
        i = Object.assign(e, t),
        n = i.element;
      if (!n)
        return !1;
      var o = i.handle || n,
        r = void 0,
        a = !1,
        s = function(t) {
          return Math.pow(t.x, 2) + Math.pow(t.y, 2) > Math.pow(i.distance, 2) && (i.start && i.start(r), !0)
        },
        l = function(t) {
          var e = navigator.userAgent;
          return e.indexOf("compatible") > -1 && e.indexOf("MSIE") > -1 && !isOpera
            ? 1 == t
            : 0 == t
        },
        c = function(t) {
          var e = n.offsetLeft,
            o = n.offsetTop,
            r = e + t.x < 0
              ? 0
              : e + t.x,
            a = o + t.y < 0
              ? 0
              : o + t.y;
          switch (i.axis) {
            case "x":
              n.style.left = r + "px";
              break;
            case "y":
              n.style.top = a + "px";
              break;
            case "all":
            default:
              n.style.left = r + "px",
              n.style.top = a + "px"
          }
        },
        h = function(t) {
          var e = t;
          l(e.button) && (r = {
            x: e.clientX,
            y: e.clientY
          }, i.start && i.start(r), document.addEventListener("mousemove", u), document.addEventListener("touchmove", u))
        },
        u = function(t) {
          var e = t,
            n = {
              x: e.clientX,
              y: e.clientY
            },
            o = {
              x: n.x - r.x,
              y: n.y - r.y
            };
          a
            ? (i.move && i.move(r, n, o), r = n, c(o))
            : a = s(o)
        },
        d = function() {
          a && i.end && i.end(r),
          a = !1,
          document.removeEventListener("mousemove", u),
          document.removeEventListener("touchmove", u)
        };
      o.style.cursor = i.cursor,
      o.style.userSelect = "none",
      o.addEventListener("mousedown", h),
      o.addEventListener("touchstart", h),
      document.addEventListener("mouseup", d),
      document.addEventListener("touchend ", d)
    };
  t.drag = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    e = function(e) {
      var i = {
          element: null,
          axis: "all",
          minWidth: 100,
          minHeight: 100,
          distance: 0,
          start: null,
          sizable: null,
          stop: null
        },
        n = Object.assign(i, e),
        o = n.element;
      if (!o)
        return !1;
      var r = void 0,
        a = !1,
        s = t.create("div", "bf-resize"),
        l = function(t) {
          return Math.pow(t.x, 2) + Math.pow(t.y, 2) > Math.pow(n.distance, 2) && (n.start && n.start(r), !0)
        },
        c = function(t) {
          var e = navigator.userAgent;
          return e.indexOf("compatible") > -1 && e.indexOf("MSIE") > -1 && !isOpera
            ? 1 == t
            : 0 == t
        },
        h = function(t) {
          var e = o.offsetLeft,
            i = o.offsetTop,
            r = o.clientWidth,
            a = o.clientHeight,
            s = r + t.x < n.minWidth
              ? n.minWidth
              : r + t.x,
            l = a + t.y < n.minHeight
              ? n.minHeight
              : a + t.y;
          switch (n.resize && n.resize(s, l), o.style.left = e + "px", o.style.top = i + "px", n.axis) {
            case "x":
              o.style.width = s + "px";
              break;
            case "y":
              o.style.height = l + "px";
              break;
            case "all":
            default:
              o.style.width = s + "px",
              o.style.height = l + "px"
          }
        },
        u = function(t) {
          var e = t;
          c(e.button) && (r = {
            x: e.clientX,
            y: e.clientY
          }, document.addEventListener("mousemove", d), document.addEventListener("touchmove", d))
        },
        d = function(t) {
          var e = t,
            i = {
              x: e.clientX,
              y: e.clientY
            },
            o = {
              x: i.x - r.x,
              y: i.y - r.y
            };
          a
            ? (n.sizable && n.sizable(r, i, o), r = i, h(o))
            : a = l(o)
        },
        p = function() {
          a && n.end && n.end(r),
          a = !1,
          document.removeEventListener("mousemove", d),
          document.removeEventListener("touchmove", d)
        };
      o.addClass("bf-sizable"),
      o.appendChild(s),
      s.addEventListener("mousedown", u),
      s.addEventListener("touchstart", u),
      document.addEventListener("mouseup", p),
      document.addEventListener("touchend", p)
    };
  t.sizable = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    e = function(e) {
      var i = this,
        n = {
          element: null,
          min: 0,
          max: 100,
          cur: 50,
          step: 1,
          input: null,
          change: null
        },
        o = Object.assign(n, e);
      this._opt = o;
      var r = t.create("div", "bf-range"),
        a = t.create("input", "bf-input-range");
      i.input = a,
      a.setAttribute("type", "range"),
      a.setAttribute("step", o.step),
      a.setAttribute("min", o.min),
      a.setAttribute("max", o.max),
      a.setAttribute("value", o.cur);
      var s = t.create("span", "bf-range-min");
      s.innerText = o.min;
      var l = t.create("span", "bf-range-cur");
      i.cur = l,
      l.innerText = o.cur;
      var c = t.create("span", "bf-range-max");
      c.innerText = o.max;
      var h = t.create("span", "bf-range-progress");
      r.appendChild(a),
      r.appendChild(s),
      r.appendChild(l),
      r.appendChild(c),
      r.appendChild(h),
      o.element.appendChild(r),
      i.setProgress(),
      a.addEventListener("input", function() {
        i.setProgress(),
        o.input && o.input(this.value)
      }),
      a.addEventListener("change", function() {
        i.setProgress(),
        o.change && o.change(this.value)
      })
    };
  e.prototype.setProgress = function() {
    var t = this._opt,
      e = t.max - t.min,
      i = this.input,
      n = i.value,
      o = this.cur,
      r = (n - t.min) / e * 100;
    i.style.background = "linear-gradient(to right,#11dab7 0%,#11dab7 " + r + "%,#999 " + r + "%, #999 100%)",
    o.innerText = n
  },
  e.prototype.reset = function() {
    this.setProgress(this.input.value)
  },
  t.range = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.ClientHelper"),
    e = function() {
      var t = navigator.userAgent,
        e = /(?:Windows Phone)/.test(t),
        i = /(?:SymbianOS)/.test(t) || e,
        n = /(?:Android)/.test(t),
        o = /(?:Firefox)/.test(t),
        r = (/(?:Chrome|CriOS)/.test(t), /(?:iPad|PlayBook)/.test(t) || n && !/(?:Mobile)/.test(t) || o && /(?:Tablet)/.test(t));
      return !(/(?:iPhone)/.test(t) && !r || n || i)
    };
  t.getIsDesktop = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.UUID"),
    e = function() {
      for (var t = [], e = "0123456789abcdef", i = 0; i < 36; i++)
        t[i] = e.substr(Math.floor(16 * Math.random()), 1);
      return t[14] = "4",
      t[19] = e.substr(3 & t[19] | 8, 1),
      t[8] = t[13] = t[18] = t[23] = "-",
      t.join("")
    };
  t.createUUID = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang"),
    e = function() {
      this.container = {}
    };
  e.prototype.addEvent = function(t, e) {
    return "string" == typeof t && "function" == typeof e && (
      void 0 === this.container[t]
      ? this.container[t] = [e]
      : this.container[t].push(e)),
    this
  },
  e.prototype.fireEvent = function(t) {
    if (t && this.container[t]) {
      var e = Array.prototype.slice.call(arguments);
      e.shift();
      for (var i = this.container[t].length, n = 0; n < i; n++) {
        this.container[t][n].apply(null, e)
      }
    }
    return this
  },
  e.prototype.removeEvent = function(t, e) {
    if ("function" == typeof e && "string" == typeof t) {
      var i = this.container[t];
      if (i instanceof Array) {
        for (var n = 0, o = i.length; n < o; n += 1)
          if (i[n] === e) {
            i.splice(n, 1);
            break
          }
        0 == i.length && delete this.container[t]
      }
      return this
    }
  },
  t.EventManager = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Geometry"),
    e = function(t, e, i) {
      this.x = t,
      this.y = e,
      this.z = i
    };
  e.prototype = {
    get: function() {
      return {x: this.x, y: this.y, z: this.z}
    },
    set: function(t, e, i) {
      this.x = t,
      this.y = e,
      this.z = i
    }
  },
  t.Point3d = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Geometry"),
    e = function(e, i) {
      var n = {},
        o = new t.Point3d,
        r = new t.Point3d;
      return o.set(e.x, e.y, e.z),
      r.set(i.x, i.y, i.z),
      n.min = o,
      n.max = r,
      n
    };
  t.BoundingBox = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Graphics.Utility"),
    e = function(t) {
      var e = t.toString(16);
      return 1 == e.length && (e = "0" + e),
      e
    };
  t.RGBToHex = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Graphics.Utility.Relation"),
    e = function(t, e) {
      Glodon.Web.Lang.Utility.HttpRequest.ajax({
        url: "https://m.bimface.com/" + t + "/metadata/views.json",
        success: function(i) {
          var n = JSON.parse(i).viewList,
            i = [];
          for (var o in n) {
            var r = n[o];
            "FloorPlan" == r.viewType && (r.preview.path = "https://m.bimface.com/" + t + "/" + r.preview.path, i.push(r))
          }
          e && e(i)
        }
      })
    },
    i = function(t, e) {
      if ("FloorPlan" != e.viewType)
        return console.warn("Not support yet!"),
        null;
      var i = e.preview.width,
        n = e.preview.height,
        o = e.outline[0],
        r = e.outline[2],
        a = e.outline[1],
        s = e.outline[3],
        l = r - o,
        c = s - a,
        h = (0 - o) / l,
        u = s / c,
        d = (t.x - i * h) / i,
        p = (n * u - t.y) / n;
      return d = d * l * e.viewPoint.scale,
      p = p * c * e.viewPoint.scale,
      new Glodon.Web.Geometry.Point3d(d, p, e.elevation)
    },
    n = function(t, e) {
      if ("FloorPlan" != e.viewType)
        return console.warn("Not support yet!"),
        null;
      var i = e.preview.width,
        n = e.preview.height,
        o = e.outline[0],
        r = e.outline[2],
        a = e.outline[1],
        s = e.outline[3],
        l = r - o,
        c = s - a,
        h = (0 - o) / (r - o),
        u = s / (s - a),
        d = t.x / (l * e.viewPoint.scale),
        p = t.y / (c * e.viewPoint.scale);
      return d = d * i + i * h,
      p = n * u - p * n, {
        x: d,
        y: p,
        z: 0
      }
    };
  t.getViews = e,
  t.point2DToPoint3D = i,
  t.point3DToPoint2D = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Graphics.Utility"),
    e = function(t) {
      var e = new Image;
      return new Promise(function(i, n) {
        e.onload = function() {
          i(e)
        },
        e.onerror = function(t) {
          n(t)
        },
        e.crossOrigin = "anonymous",
        e.src = t,
        e.complete === !0 && i(e)
      })
    };
  t.ImageContainer = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Graphics"),
    e = Glodon.Web.Graphics.Utility.RGBToHex,
    i = function(t, e, i, n) {
      this.red = t,
      this.green = e,
      this.blue = i,
      this.alpha = n
    };
  i.prototype = {
    getRGB: function() {
      return "rgba(" + this.red + "," + this.green + "," + this.blue + ")"
    },
    getRGBA: function() {
      return "rgba(" + this.red + "," + this.green + "," + this.blue + "," + this.alpha + ")"
    },
    getHEX: function() {
      return "" + e(this.red) + e(this.green) + e(this.blue)
    },
    getAlpha: function() {
      return this.alpha
    }
  },
  t.Color = i
}(),
function() {
  HTMLElement.prototype.getClass = function(t) {
    return this.getAttribute("class")
  },
  HTMLElement.prototype.hasClass = function(t) {
    var e = this.getClass();
    return !!e && (e && e.split(" ")).indexOf(t) > -1
  },
  HTMLElement.prototype.addClass = function(t) {
    var e = this.getClass(),
      i = e && e.split(" ");
    return e
      ? i.indexOf(t) == -1 && (i.push(t), e = i.join(" "), this.setAttribute("class", "" + e))
      : this.setAttribute("class", "" + t),
    this
  },
  HTMLElement.prototype.removeClass = function(t) {
    if (!this.hasClass(t))
      return this;
    var e = this.getClass().replace(t, "").trim();
    return e
      ? this.setAttribute("class", "" + e)
      : this.removeAttribute("class"),
    this
  },
  HTMLElement.prototype.toggleClass = function(t, e) {
    var i = (this.getClass(), this.hasClass(t));
    return void 0 != e
      ? (e && !i && this.addClass(t), e || this.removeClass(t))
      : i
        ? this.removeClass(t)
        : this.addClass(t),
    !i
  }
}(),
function() {
  Array.prototype.getObjectByAttribute = function(t, e) {
    for (var i = this, n = i.length, o = 0; o < n; o++)
      if (i[o][t] == e)
        return i[o];
  return !1
  },
  Array.prototype.removeObjectByAttribute = function(t, e) {
    for (var i = this, n = i.length, o = 0; o < n; o++)
      if (i[o][t] == e)
        return i = i.splice(o, 1);
  return !1
  },
  Array.prototype.getAllObjectByAttribute = function(t, e) {
    for (var i = this, n = i.length, o = 0, r = []; o < n; o++)
      i[o][t] == e && r.push(i[o]);
    return r
  },
  Array.prototype.removeByValue = function(t) {
    for (var e = this, i = e.length, n = i - 1; n >= 0; n--)
      e[n] == t && e.splice(n, 1);
    return e
  },
  Array.prototype.insert = function(t, e) {
    return this.splice(t, 0, e),
    this
  }
}(),
function() {
  HTMLElement.prototype.setCss = function(t) {
    if (t)
      for (var e in t)
        this.style[e] = t[e]
  },
  HTMLElement.prototype.getCss = function() {
    return this.style
  }
}(),
function(t, e, i) {
  !function(t) {
    function e(n) {
      if (i[n])
        return i[n].exports;
      var o = i[n] = {
        exports: {},
        id: n,
        loaded: !1
      };
      return t[n].call(o.exports, o, o.exports, e),
      o.loaded = !0,
      o.exports
    }
    var i = {};
    e.m = t,
    e.c = i,
    e.p = "",
    e(0)
  }(
[
  function(t, e, i) {
      i(1),
      i(50),
      i(51),
      i(52),
      i(54),
      i(55),
      i(58),
      i(59),
      i(60),
      i(61),
      i(62),
      i(63),
      i(64),
      i(65),
      i(66),
      i(68),
      i(70),
      i(72),
      i(74),
      i(77),
      i(78),
      i(79),
      i(83),
      i(86),
      i(87),
      i(88),
      i(89),
      i(91),
      i(92),
      i(93),
      i(94),
      i(95),
      i(97),
      i(99),
      i(100),
      i(101),
      i(103),
      i(104),
      i(105),
      i(107),
      i(108),
      i(109),
      i(111),
      i(112),
      i(113),
      i(114),
      i(115),
      i(116),
      i(117),
      i(118),
      i(119),
      i(120),
      i(121),
      i(122),
      i(123),
      i(124),
      i(126),
      i(130),
      i(131),
      i(132),
      i(133),
      i(137),
      i(139),
      i(140),
      i(141),
      i(142),
      i(143),
      i(144),
      i(145),
      i(146),
      i(147),
      i(148),
      i(149),
      i(150),
      i(151),
      i(152),
      i(158),
      i(159),
      i(161),
      i(162),
      i(163),
      i(167),
      i(168),
      i(169),
      i(170),
      i(171),
      i(173),
      i(174),
      i(175),
      i(176),
      i(179),
      i(181),
      i(182),
      i(183),
      i(185),
      i(187),
      i(189),
      i(190),
      i(191),
      i(193),
      i(194),
      i(195),
      i(196),
      i(203),
      i(206),
      i(207),
      i(209),
      i(210),
      i(211),
      i(212),
      i(213),
      i(214),
      i(215),
      i(216),
      i(217),
      i(218),
      i(219),
      i(220),
      i(222),
      i(223),
      i(224),
      i(225),
      i(226),
      i(227),
      i(228),
      i(229),
      i(231),
      i(234),
      i(235),
      i(237),
      i(238),
      i(239),
      i(240),
      i(241),
      i(242),
      i(243),
      i(244),
      i(245),
      i(246),
      i(247),
      i(249),
      i(250),
      i(251),
      i(252),
      i(253),
      i(254),
      i(255),
      i(256),
      i(258),
      i(259),
      i(261),
      i(262),
      i(263),
      i(264),
      i(267),
      i(268),
      i(269),
      i(270),
      i(271),
      i(272),
      i(273),
      i(274),
      i(276),
      i(277),
      i(278),
      i(279),
      i(280),
      i(281),
      i(282),
      i(283),
      i(284),
      i(285),
      i(286),
      i(287),
      i(288),
      i(291),
      i(156),
      i(293),
      i(292),
      i(294),
      i(295),
      i(296),
      i(297),
      i(298),
      i(300),
      i(301),
      i(302),
      i(304),
      t.exports = i(305)
    },
    function(t, e, n) {
      var o = n(2),
        r = n(3),
        a = n(4),
        s = n(6),
        l = n(16),
        c = n(20).KEY,
        h = n(5),
        u = n(21),
        d = n(22),
        p = n(17),
        f = n(23),
        m = n(24),
        g = n(25),
        v = n(27),
        y = n(40),
        E = n(43),
        x = n(10),
        b = n(30),
        w = n(14),
        C = n(15),
        T = n(44),
        _ = n(47),
        L = n(49),
        M = n(9),
        S = n(28),
        O = L.f,
        D = M.f,
        R = _.f,
        U = o.Symbol,
        A = o.JSON,
        I = A && A.stringify,
        P = "prototype",
        B = f("_hidden"),
        N = f("toPrimitive"),
        k = {}.propertyIsEnumerable,
        H = u("symbol-registry"),
        F = u("symbols"),
        G = u("op-symbols"),
        V = Object[P],
        z = "function" == typeof U,
        q = o.QObject,
        W = !q || !q[P] || !q[P].findChild,
        j = a && h(function() {
          return 7 != T(D({}, "a", {
            get: function() {
              return D(this, "a", {value: 7}).a
            }
          })).a
        })
          ? function(t, e, i) {
            var n = O(V, e);
            n && delete V[e],
            D(t, e, i),
            n && t !== V && D(V, e, n)
          }
          : D,
        X = function(t) {
          var e = F[t] = T(U[P]);
          return e._k = t,
          e
        },
        Y = z && "symbol" == _typeof(U.iterator)
          ? function(t) {
            return "symbol" == (
              void 0 === t
              ? "undefined"
              : _typeof(t))
          }
          : function(t) {
            return t instanceof U
          },
        Z = function(t, e, i) {
          return t === V && Z(G, e, i),
          x(t),
          e = w(e, !0),
          x(i),
          r(F, e)
            ? (
              i.enumerable
              ? (r(t, B) && t[B][e] && (t[B][e] = !1), i = T(i, {
                enumerable: C(0, !1)
              }))
              : (r(t, B) || D(t, B, C(1, {})), t[B][e] = !0),
            j(t, e, i))
            : D(t, e, i)
        },
        K = function(t, e) {
          x(t);
          for (var i, n = y(e = b(e)), o = 0, r = n.length; r > o;)
            Z(t, i = n[o++], e[i]);
          return t
        },
        Q = function(t, e) {
          return e === i
            ? T(t)
            : K(T(t), e)
        },
        J = function(t) {
          var e = k.call(this, t = w(t, !0));
          return !(this === V && r(F, t) && !r(G, t)) && (!(e || !r(this, t) || !r(F, t) || r(this, B) && this[B][t]) || e)
        },
        $ = function(t, e) {
          if (t = b(t), e = w(e, !0), t !== V || !r(F, e) || r(G, e)) {
            var i = O(t, e);
            return !i || !r(F, e) || r(t, B) && t[B][e] || (i.enumerable = !0),
            i
          }
        },
        tt = function(t) {
          for (var e, i = R(b(t)), n = [], o = 0; i.length > o;)
            r(F, e = i[o++]) || e == B || e == c || n.push(e);
          return n
        },
        et = function(t) {
          for (var e, i = t === V, n = R(
            i
            ? G
            : b(t)), o = [], a = 0; n.length > a;)
            !r(F, e = n[a++]) || i && !r(V, e) || o.push(F[e]);
          return o
        };
      z || (U = function() {
        if (this instanceof U)
          throw TypeError("Symbol is not a constructor!");
        var t = p(
            arguments.length > 0
            ? arguments[0]
            : i),
          e = function e(i) {
            this === V && e.call(G, i),
            r(this, B) && r(this[B], t) && (this[B][t] = !1),
            j(this, t, C(1, i))
          };
        return a && W && j(V, t, {
          configurable: !0,
          set: e
        }),
        X(t)
      }, l(U[P], "toString", function() {
        return this._k
      }), L.f = $, M.f = Z, n(48).f = _.f = tt, n(42).f = J, n(41).f = et, a && !n(26) && l(V, "propertyIsEnumerable", J, !0), m.f = function(t) {
        return X(f(t))
      }),
      s(s.G + s.W + s.F * !z, {Symbol: U});
      for (var it = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), nt = 0; it.length > nt;)
        f(it[nt++]);
      for (var it = S(f.store), nt = 0; it.length > nt;)
        g(it[nt++]);
      s(s.S + s.F * !z, "Symbol", {
        for : function(t) {
          return r(H, t += "")
            ? H[t]
            : H[t] = U(t)
        }, keyFor : function(t) {
          if (Y(t))
            return v(H, t);
          throw TypeError(t + " is not a symbol!")
        }, useSetter : function() {
          W = !0
        }, useSimple : function() {
          W = !1
        }
      }), s(s.S + s.F * !z, "Object", {
        create: Q,
        defineProperty: Z,
        defineProperties: K,
        getOwnPropertyDescriptor: $,
        getOwnPropertyNames: tt,
        getOwnPropertySymbols: et
      }), A && s(s.S + s.F * (!z || h(function() {
        var t = U();
        return "[null]" != I([t]) || "{}" != I({a: t}) || "{}" != I(Object(t))
      })), "JSON", {
        stringify: function(t) {
          if (t !== i && !Y(t)) {
            for (var e, n, o = [t], r = 1; arguments.length > r;)
              o.push(arguments[r++]);
            return e = o[1],
            "function" == typeof e && (n = e),
            !n && E(e) || (e = function(t, e) {
              if (n && (e = n.call(this, t, e)), !Y(e))
                return e
            }),
            o[1] = e,
            I.apply(A, o)
          }
        }
      }), U[P][N] || n(8)(U[P], N, U[P].valueOf), d(U, "Symbol"), d(Math, "Math", !0), d(o.JSON, "JSON", !0)
    },
    function(t, i) {
      var n = t.exports = "undefined" != typeof window && window.Math == Math
        ? window
        : "undefined" != typeof self && self.Math == Math
          ? self
          : Function("return this")();
      "number" == typeof e && (e = n)
    },
    function(t, e) {
      var i = {}.hasOwnProperty;
      t.exports = function(t, e) {
        return i.call(t, e)
      }
    },
    function(t, e, i) {
      t.exports = !i(5)(function() {
        return 7 != Object.defineProperty({}, "a", {
          get: function() {
            return 7
          }
        }).a
      })
    },
    function(t, e) {
      t.exports = function(t) {
        try {
          return !!t()
        } catch (t) {
          return !0
        }
      }
    },
    function(t, e, n) {
      var o = n(2),
        r = n(7),
        a = n(8),
        s = n(16),
        l = n(18),
        c = "prototype",
        h = function t(e, n, h) {
          var u,
            d,
            p,
            f,
            m = e & t.F,
            g = e & t.G,
            v = e & t.S,
            y = e & t.P,
            E = e & t.B,
            x = g
              ? o
              : v
                ? o[n] || (o[n] = {})
                : (o[n] || {})[c],
            b = g
              ? r
              : r[n] || (r[n] = {}),
            w = b[c] || (b[c] = {});
          g && (h = n);
          for (u in h)
            d = !m && x && x[u] !== i,
            p = (
              d
              ? x
              : h)[u],
            f = E && d
              ? l(p, o)
              : y && "function" == typeof p
                ? l(Function.call, p)
                : p,
            x && s(x, u, p, e & t.U),
            b[u] != p && a(b, u, f),
            y && w[u] != p && (w[u] = p)
        };
      o.core = r,
      h.F = 1,
      h.G = 2,
      h.S = 4,
      h.P = 8,
      h.B = 16,
      h.W = 32,
      h.U = 64,
      h.R = 128,
      t.exports = h
    },
    function(e, i) {
      var n = e.exports = {
        version: "2.4.0"
      };
      "number" == typeof t && (t = n)
    },
    function(t, e, i) {
      var n = i(9),
        o = i(15);
      t.exports = i(4)
        ? function(t, e, i) {
          return n.f(t, e, o(1, i))
        }
        : function(t, e, i) {
          return t[e] = i,
          t
        }
    },
    function(t, e, i) {
      var n = i(10),
        o = i(12),
        r = i(14),
        a = Object.defineProperty;
      e.f = i(4)
        ? Object.defineProperty
        : function(t, e, i) {
          if (n(t), e = r(e, !0), n(i), o)
            try {
              return a(t, e, i)
            } catch (t) {}
          if ("get" in i || "set" in i)
            throw TypeError("Accessors not supported!");
          return "value" in i && (t[e] = i.value),
          t
        }
    },
    function(t, e, i) {
      var n = i(11);
      t.exports = function(t) {
        if (!n(t))
          throw TypeError(t + " is not an object!");
        return t
      }
    },
    function(t, e) {
      t.exports = function(t) {
        return "object" == (
          void 0 === t
          ? "undefined"
          : _typeof(t))
          ? null !== t
          : "function" == typeof t
      }
    },
    function(t, e, i) {
      t.exports = !i(4) && !i(5)(function() {
        return 7 != Object.defineProperty(i(13)("div"), "a", {
          get: function() {
            return 7
          }
        }).a
      })
    },
    function(t, e, i) {
      var n = i(11),
        o = i(2).document,
        r = n(o) && n(o.createElement);
      t.exports = function(t) {
        return r
          ? o.createElement(t)
          : {}
      }
    },
    function(t, e, i) {
      var n = i(11);
      t.exports = function(t, e) {
        if (!n(t))
          return t;
        var i,
          o;
        if (e && "function" == typeof(i = t.toString) && !n(o = i.call(t)))
          return o;
        if ("function" == typeof(i = t.valueOf) && !n(o = i.call(t)))
          return o;
        if (!e && "function" == typeof(i = t.toString) && !n(o = i.call(t)))
          return o;
        throw TypeError("Can't convert object to primitive value")
      }
    },
    function(t, e) {
      t.exports = function(t, e) {
        return {
          enumerable: !(1 & t),
          configurable: !(2 & t),
          writable: !(4 & t),
          value: e
        }
      }
    },
    function(t, e, i) {
      var n = i(2),
        o = i(8),
        r = i(3),
        a = i(17)("src"),
        s = "toString",
        l = Function[s],
        c = ("" + l).split(s);
      i(7).inspectSource = function(t) {
        return l.call(t)
      },
      (t.exports = function(t, e, i, s) {
        var l = "function" == typeof i;
        l && (r(i, "name") || o(i, "name", e)),
        t[e] !== i && (
          l && (r(i, a) || o(
            i, a, t[e]
            ? "" + t[e]
            : c.join(String(e)))), t === n
          ? t[e] = i
          : s
            ? t[e]
              ? t[e] = i
              : o(t, e, i)
            : (delete t[e], o(t, e, i)))
      })(Function.prototype, s, function() {
        return "function" == typeof this && this[a] || l.call(this)
      })
    },
    function(t, e) {
      var n = 0,
        o = Math.random();
      t.exports = function(t) {
        return "Symbol(".concat(
          t === i
          ? ""
          : t,
        ")_",
        (++n + o).toString(36))
      }
    },
    function(t, e, n) {
      var o = n(19);
      t.exports = function(t, e, n) {
        if (o(t), e === i)
          return t;
        switch (n) {
          case 1:
            return function(i) {
              return t.call(e, i)
            };
          case 2:
            return function(i, n) {
              return t.call(e, i, n)
            };
          case 3:
            return function(i, n, o) {
              return t.call(e, i, n, o)
            }
        }
        return function() {
          return t.apply(e, arguments)
        }
      }
    },
    function(t, e) {
      t.exports = function(t) {
        if ("function" != typeof t)
          throw TypeError(t + " is not a function!");
        return t
      }
    },
    function(t, e, i) {
      var n = i(17)("meta"),
        o = i(11),
        r = i(3),
        a = i(9).f,
        s = 0,
        l = Object.isExtensible || function() {
          return !0
        },
        c = !i(5)(function() {
          return l(Object.preventExtensions({}))
        }),
        h = function(t) {
          a(t, n, {
            value: {
              i: "O" + ++s,
              w: {}
            }
          })
        },
        u = function(t, e) {
          if (!o(t))
            return "symbol" == (
              void 0 === t
              ? "undefined"
              : _typeof(t))
              ? t
              : (
                "string" == typeof t
                ? "S"
                : "P") + t;
          if (!r(t, n)) {
            if (!l(t))
              return "F";
            if (!e)
              return "E";
            h(t)
          }
          return t[n].i
        },
        d = function(t, e) {
          if (!r(t, n)) {
            if (!l(t))
              return !0;
            if (!e)
              return !1;
            h(t)
          }
          return t[n].w
        },
        p = function(t) {
          return c && f.NEED && l(t) && !r(t, n) && h(t),
          t
        },
        f = t.exports = {
          KEY: n,
          NEED: !1,
          fastKey: u,
          getWeak: d,
          onFreeze: p
        }
    },
    function(t, e, i) {
      var n = i(2),
        o = "__core-js_shared__",
        r = n[o] || (n[o] = {});
      t.exports = function(t) {
        return r[t] || (r[t] = {})
      }
    },
    function(t, e, i) {
      var n = i(9).f,
        o = i(3),
        r = i(23)("toStringTag");
      t.exports = function(t, e, i) {
        t && !o(
          t = i
          ? t
          : t.prototype,
        r) && n(t, r, {
          configurable: !0,
          value: e
        })
      }
    },
    function(t, e, i) {
      var n = i(21)("wks"),
        o = i(17),
        r = i(2).Symbol,
        a = "function" == typeof r;
      (t.exports = function(t) {
        return n[t] || (n[t] = a && r[t] || (
          a
          ? r
          : o)("Symbol." + t))
      }).store = n
    },
    function(t, e, i) {
      e.f = i(23)
    },
    function(t, e, i) {
      var n = i(2),
        o = i(7),
        r = i(26),
        a = i(24),
        s = i(9).f;
      t.exports = function(t) {
        var e = o.Symbol || (
          o.Symbol = r
          ? {}
          : n.Symbol || {});
        "_" == t.charAt(0) || t in e || s(e, t, {value: a.f(t)})
      }
    },
    function(t, e) {
      t.exports = !1
    },
    function(t, e, i) {
      var n = i(28),
        o = i(30);
      t.exports = function(t, e) {
        for (var i, r = o(t), a = n(r), s = a.length, l = 0; s > l;)
          if (r[i = a[l++]] === e)
            return i
      }
    },
    function(t, e, i) {
      var n = i(29),
        o = i(39);
      t.exports = Object.keys || function(t) {
        return n(t, o)
      }
    },
    function(t, e, i) {
      var n = i(3),
        o = i(30),
        r = i(34)(!1),
        a = i(38)("IE_PROTO");
      t.exports = function(t, e) {
        var i,
          s = o(t),
          l = 0,
          c = [];
        for (i in s)
          i != a && n(s, i) && c.push(i);
        for (; e.length > l;)
          n(s, i = e[l++]) && (~ r(c, i) || c.push(i));
        return c
      }
    },
    function(t, e, i) {
      var n = i(31),
        o = i(33);
      t.exports = function(t) {
        return n(o(t))
      }
    },
    function(t, e, i) {
      var n = i(32);
      t.exports = Object("z").propertyIsEnumerable(0)
        ? Object
        : function(t) {
          return "String" == n(t)
            ? t.split("")
            : Object(t)
        }
    },
    function(t, e) {
      var i = {}.toString;
      t.exports = function(t) {
        return i.call(t).slice(8, -1)
      }
    },
    function(t, e) {
      t.exports = function(t) {
        if (t == i)
          throw TypeError("Can't call method on  " + t);
        return t
      }
    },
    function(t, e, i) {
      var n = i(30),
        o = i(35),
        r = i(37);
      t.exports = function(t) {
        return function(e, i, a) {
          var s,
            l = n(e),
            c = o(l.length),
            h = r(a, c);
          if (t && i != i) {
            for (; c > h;)
              if ((s = l[h++]) != s)
                return !0
            }
          else
            for (; c > h; h++)
              if ((t || h in l) && l[h] === i)
                return t || h || 0;
        return !t && -1
        }
      }
    },
    function(t, e, i) {
      var n = i(36),
        o = Math.min;
      t.exports = function(t) {
        return t > 0
          ? o(n(t), 9007199254740991)
          : 0
      }
    },
    function(t, e) {
      var i = Math.ceil,
        n = Math.floor;
      t.exports = function(t) {
        return isNaN(t = + t)
          ? 0
          : (
            t > 0
            ? n
            : i)(t)
      }
    },
    function(t, e, i) {
      var n = i(36),
        o = Math.max,
        r = Math.min;
      t.exports = function(t, e) {
        return t = n(t),
        t < 0
          ? o(t + e, 0)
          : r(t, e)
      }
    },
    function(t, e, i) {
      var n = i(21)("keys"),
        o = i(17);
      t.exports = function(t) {
        return n[t] || (n[t] = o(t))
      }
    },
    function(t, e) {
      t.exports = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")
    },
    function(t, e, i) {
      var n = i(28),
        o = i(41),
        r = i(42);
      t.exports = function(t) {
        var e = n(t),
          i = o.f;
        if (i)
          for (var a, s = i(t), l = r.f, c = 0; s.length > c;)
            l.call(t, a = s[c++]) && e.push(a);
      return e
      }
    },
    function(t, e) {
      e.f = Object.getOwnPropertySymbols
    },
    function(t, e) {
      e.f = {}.propertyIsEnumerable
    },
    function(t, e, i) {
      var n = i(32);
      t.exports = Array.isArray || function(t) {
        return "Array" == n(t)
      }
    },
    function(t, e, n) {
      var o = n(10),
        r = n(45),
        a = n(39),
        s = n(38)("IE_PROTO"),
        l = function() {},
        c = "prototype",
        h = function() {
          var t,
            e = n(13)("iframe"),
            i = a.length;
          for (e.style.display = "none", n(46).appendChild(e), e.src = "javascript:", t = e.contentWindow.document, t.open(), t.write("<script>document.F=Object</script>"), t.close(), h = t.F; i--;)
            delete h[c][a[i]];
          return h()
        };
      t.exports = Object.create || function(t, e) {
        var n;
        return null !== t
          ? (l[c] = o(t), n = new l, l[c] = null, n[s] = t)
          : n = h(),
        e === i
          ? n
          : r(n, e)
      }
    },
    function(t, e, i) {
      var n = i(9),
        o = i(10),
        r = i(28);
      t.exports = i(4)
        ? Object.defineProperties
        : function(t, e) {
          o(t);
          for (var i, a = r(e), s = a.length, l = 0; s > l;)
            n.f(t, i = a[l++], e[i]);
          return t
        }
    },
    function(t, e, i) {
      t.exports = i(2).document && document.documentElement
    },
    function(t, e, i) {
      var n = i(30),
        o = i(48).f,
        r = {}.toString,
        a = "object" == (
          "undefined" == typeof window
          ? "undefined"
          : _typeof(window)) && window && Object.getOwnPropertyNames
          ? Object.getOwnPropertyNames(window)
          : [],
        s = function(t) {
          try {
            return o(t)
          } catch (t) {
            return a.slice()
          }
        };
      t.exports.f = function(t) {
        return a && "[object Window]" == r.call(t)
          ? s(t)
          : o(n(t))
      }
    },
    function(t, e, i) {
      var n = i(29),
        o = i(39).concat("length", "prototype");
      e.f = Object.getOwnPropertyNames || function(t) {
        return n(t, o)
      }
    },
    function(t, e, i) {
      var n = i(42),
        o = i(15),
        r = i(30),
        a = i(14),
        s = i(3),
        l = i(12),
        c = Object.getOwnPropertyDescriptor;
      e.f = i(4)
        ? c
        : function(t, e) {
          if (t = r(t), e = a(e, !0), l)
            try {
              return c(t, e)
            } catch (t) {}
          if (s(t, e))
            return o(!n.f.call(t, e), t[e])
        }
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S + n.F * !i(4), "Object", {defineProperty: i(9).f})
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S + n.F * !i(4), "Object", {defineProperties: i(45)})
    },
    function(t, e, i) {
      var n = i(30),
        o = i(49).f;
      i(53)("getOwnPropertyDescriptor", function() {
        return function(t, e) {
          return o(n(t), e)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(7),
        r = i(5);
      t.exports = function(t, e) {
        var i = (o.Object || {})[t] || Object[t],
          a = {};
        a[t] = e(i),
        n(n.S + n.F * r(function() {
          i(1)
        }), "Object", a)
      }
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Object", {create: i(44)})
    },
    function(t, e, i) {
      var n = i(56),
        o = i(57);
      i(53)("getPrototypeOf", function() {
        return function(t) {
          return o(n(t))
        }
      })
    },
    function(t, e, i) {
      var n = i(33);
      t.exports = function(t) {
        return Object(n(t))
      }
    },
    function(t, e, i) {
      var n = i(3),
        o = i(56),
        r = i(38)("IE_PROTO"),
        a = Object.prototype;
      t.exports = Object.getPrototypeOf || function(t) {
        return t = o(t),
        n(t, r)
          ? t[r]
          : "function" == typeof t.constructor && t instanceof t.constructor
            ? t.constructor.prototype
            : t instanceof Object
              ? a
              : null
      }
    },
    function(t, e, i) {
      var n = i(56),
        o = i(28);
      i(53)("keys", function() {
        return function(t) {
          return o(n(t))
        }
      })
    },
    function(t, e, i) {
      i(53)("getOwnPropertyNames", function() {
        return i(47).f
      })
    },
    function(t, e, i) {
      var n = i(11),
        o = i(20).onFreeze;
      i(53)("freeze", function(t) {
        return function(e) {
          return t && n(e)
            ? t(o(e))
            : e
        }
      })
    },
    function(t, e, i) {
      var n = i(11),
        o = i(20).onFreeze;
      i(53)("seal", function(t) {
        return function(e) {
          return t && n(e)
            ? t(o(e))
            : e
        }
      })
    },
    function(t, e, i) {
      var n = i(11),
        o = i(20).onFreeze;
      i(53)("preventExtensions", function(t) {
        return function(e) {
          return t && n(e)
            ? t(o(e))
            : e
        }
      })
    },
    function(t, e, i) {
      var n = i(11);
      i(53)("isFrozen", function(t) {
        return function(e) {
          return !n(e) || !!t && t(e)
        }
      })
    },
    function(t, e, i) {
      var n = i(11);
      i(53)("isSealed", function(t) {
        return function(e) {
          return !n(e) || !!t && t(e)
        }
      })
    },
    function(t, e, i) {
      var n = i(11);
      i(53)("isExtensible", function(t) {
        return function(e) {
          return !!n(e) && (!t || t(e))
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S + n.F, "Object", {assign: i(67)})
    },
    function(t, e, i) {
      var n = i(28),
        o = i(41),
        r = i(42),
        a = i(56),
        s = i(31),
        l = Object.assign;
      t.exports = !l || i(5)(function() {
        var t = {},
          e = {},
          i = Symbol(),
          n = "abcdefghijklmnopqrst";
        return t[i] = 7,
        n.split("").forEach(function(t) {
          e[t] = t
        }),
        7 != l({}, t)[i] || Object.keys(l({}, e)).join("") != n
      })
        ? function(t, e) {
          for (var i = a(t), l = arguments.length, c = 1, h = o.f, u = r.f; l > c;)
            for (
              var d, p = s(arguments[c++]), f = h
              ? n(p).concat(h(p))
              : n(p),
            m = f.length,
            g = 0; m > g;)
              u.call(p, d = f[g++]) && (i[d] = p[d]);
        return i
        }
        : l
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Object", {is: i(69)})
    },
    function(t, e) {
      t.exports = Object.is || function(t, e) {
        return t === e
          ? 0 !== t || 1 / t == 1 / e
          : t != t && e != e
      }
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Object", {setPrototypeOf: i(71).set})
    },
    function(t, e, n) {
      var o = n(11),
        r = n(10),
        a = function(t, e) {
          if (r(t), !o(e) && null !== e)
            throw TypeError(e + ": can't set as prototype!")
        };
      t.exports = {
        set: Object.setPrototypeOf || (
          "__proto__" in {}
          ? function(t, e, i) {
            try {
              i = n(18)(Function.call, n(49).f(Object.prototype, "__proto__").set, 2),
              i(t, []),
              e = !(t instanceof Array)
            } catch (t) {
              e = !0
            }
            return function(t, n) {
              return a(t, n),
              e
                ? t.__proto__ = n
                : i(t, n),
              t
            }
          }({}, !1)
          : i),
        check: a
      }
    },
    function(t, e, i) {
      var n = i(73),
        o = {};
      o[i(23)("toStringTag")] = "z",
      o + "" != "[object z]" && i(16)(Object.prototype, "toString", function() {
        return "[object " + n(this) + "]"
      }, !0)
    },
    function(t, e, n) {
      var o = n(32),
        r = n(23)("toStringTag"),
        a = "Arguments" == o(function() {
          return arguments
        }()),
        s = function(t, e) {
          try {
            return t[e]
          } catch (t) {}
        };
      t.exports = function(t) {
        var e,
          n,
          l;
        return t === i
          ? "Undefined"
          : null === t
            ? "Null"
            : "string" == typeof(n = s(e = Object(t), r))
              ? n
              : a
                ? o(e)
                : "Object" == (l = o(e)) && "function" == typeof e.callee
                  ? "Arguments"
                  : l
      }
    },
    function(t, e, i) {
      var n = i(6);
      n(n.P, "Function", {bind: i(75)})
    },
    function(t, e, i) {
      var n = i(19),
        o = i(11),
        r = i(76),
        a = [].slice,
        s = {},
        l = function(t, e, i) {
          if (!(e in s)) {
            for (var n = [], o = 0; o < e; o++)
              n[o] = "a[" + o + "]";
            s[e] = Function("F,a", "return new F(" + n.join(",") + ")")
          }
          return s[e](t, i)
        };
      t.exports = Function.bind || function(t) {
        var e = n(this),
          i = a.call(arguments, 1),
          s = function n() {
            var o = i.concat(a.call(arguments));
            return this instanceof n
              ? l(e, o.length, o)
              : r(e, o, t)
          };
        return o(e.prototype) && (s.prototype = e.prototype),
        s
      }
    },
    function(t, e) {
      t.exports = function(t, e, n) {
        var o = n === i;
        switch (e.length) {
          case 0:
            return o
              ? t()
              : t.call(n);
          case 1:
            return o
              ? t(e[0])
              : t.call(n, e[0]);
          case 2:
            return o
              ? t(e[0], e[1])
              : t.call(n, e[0], e[1]);
          case 3:
            return o
              ? t(e[0], e[1], e[2])
              : t.call(n, e[0], e[1], e[2]);
          case 4:
            return o
              ? t(e[0], e[1], e[2], e[3])
              : t.call(n, e[0], e[1], e[2], e[3])
        }
        return t.apply(n, e)
      }
    },
    function(t, e, i) {
      var n = i(9).f,
        o = i(15),
        r = i(3),
        a = Function.prototype,
        s = "name",
        l = Object.isExtensible || function() {
          return !0
        };
      s in a || i(4) && n(a, s, {
        configurable: !0,
        get: function() {
          try {
            var t = this,
              e = ("" + t).match(/^\s*function ([^ (]*)/)[1];
            return r(t, s) || !l(t) || n(t, s, o(5, e)),
            e
          } catch (t) {
            return ""
          }
        }
      })
    },
    function(t, e, i) {
      var n = i(11),
        o = i(57),
        r = i(23)("hasInstance"),
        a = Function.prototype;
      r in a || i(9).f(a, r, {
        value: function(t) {
          if ("function" != typeof this || !n(t))
            return !1;
          if (!n(this.prototype))
            return t instanceof this;
          for (; t = o(t);)
            if (this.prototype === t)
              return !0;
        return !1
        }
      })
    },
    function(t, e, i) {
      var n = i(2),
        o = i(3),
        r = i(32),
        a = i(80),
        s = i(14),
        l = i(5),
        c = i(48).f,
        h = i(49).f,
        u = i(9).f,
        d = i(81).trim,
        p = "Number",
        f = n[p],
        m = f,
        g = f.prototype,
        v = r(i(44)(g)) == p,
        y = "trim" in String.prototype,
        E = function(t) {
          var e = s(t, !1);
          if ("string" == typeof e && e.length > 2) {
            e = y
              ? e.trim()
              : d(e, 3);
            var i,
              n,
              o,
              r = e.charCodeAt(0);
            if (43 === r || 45 === r) {
              if (88 === (i = e.charCodeAt(2)) || 120 === i)
                return 0 / 0
            } else if (48 === r) {
              switch (e.charCodeAt(1)) {
                case 66:
                case 98:
                  n = 2,
                  o = 49;
                  break;
                case 79:
                case 111:
                  n = 8,
                  o = 55;
                  break;
                default:
                  return + e
              }
              for (var a, l = e.slice(2), c = 0, h = l.length; c < h; c++)
                if ((a = l.charCodeAt(c)) < 48 || a > o)
                  return 0 / 0;
            return parseInt(l, n)
            }
          }
          return + e
        };
      if (!f(" 0o1") || !f("0b1") || f("+0x1")) {
        f = function(t) {
          var e = arguments.length < 1
              ? 0
              : t,
            i = this;
          return i instanceof f && (
            v
            ? l(function() {
              g.valueOf.call(i)
            })
            : r(i) != p)
            ? a(new m(E(e)), i, f)
            : E(e)
        };
        for (
          var x, b = i(4)
          ? c(m)
          : "MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),
        w = 0; b.length > w; w++)
          o(m, x = b[w]) && !o(f, x) && u(f, x, h(m, x));
        f.prototype = g,
        g.constructor = f,
        i(16)(n, p, f)
      }
    },
    function(t, e, i) {
      var n = i(11),
        o = i(71).set;
      t.exports = function(t, e, i) {
        var r,
          a = e.constructor;
        return a !== i && "function" == typeof a && (r = a.prototype) !== i.prototype && n(r) && o && o(t, r),
        t
      }
    },
    function(t, e, i) {
      var n = i(6),
        o = i(33),
        r = i(5),
        a = i(82),
        s = "[" + a + "]",
        l = "",
        c = RegExp("^" + s + s + "*"),
        h = RegExp(s + s + "*$"),
        u = function(t, e, i) {
          var o = {},
            s = r(function() {
              return !!a[t]() || l[t]() != l
            }),
            c = o[t] = s
              ? e(d)
              : a[t];
          i && (o[i] = c),
          n(n.P + n.F * s, "String", o)
        },
        d = u.trim = function(t, e) {
          return t = String(o(t)),
          1 & e && (t = t.replace(c, "")),
          2 & e && (t = t.replace(h, "")),
          t
        };
      t.exports = u
    },
    function(t, e) {
      t.exports = "\t\n\v\f\r \u2028\u2029\ufeff"
    },
    function(t, e, i) {
      var n = i(6),
        o = i(36),
        r = i(84),
        a = i(85),
        s = 1..toFixed,
        l = Math.floor,
        c = [
          0,
          0,
          0,
          0,
          0,
          0
        ],
        h = "Number.toFixed: incorrect invocation!",
        u = "0",
        d = function(t, e) {
          for (var i = -1, n = e; ++i < 6;)
            n += t * c[i],
            c[i] = n % 1e7,
            n = l(n / 1e7)
        },
        p = function(t) {
          for (var e = 6, i = 0; --e >= 0;)
            i += c[e],
            c[e] = l(i / t),
            i = i % t * 1e7
        },
        f = function() {
          for (var t = 6, e = ""; --t >= 0;)
            if ("" !== e || 0 === t || 0 !== c[t]) {
              var i = String(c[t]);
              e = "" === e
                ? i
                : e + a.call(u, 7 - i.length) + i
            }
          return e
        },
        m = function t(e, i, n) {
          return 0 === i
            ? n
            : i % 2 == 1
              ? t(e, i - 1, n * e)
              : t(e * e, i / 2, n)
        },
        g = function(t) {
          for (var e = 0, i = t; i >= 4096;)
            e += 12,
            i /= 4096;
          for (; i >= 2;)
            e += 1,
            i /= 2;
          return e
        };
      n(n.P + n.F * (!!s && ("0.000" !== 8e-5. toFixed(3) || "1" !== .9.toFixed(0) || "1.25" !== 1.255.toFixed(2) || "1000000000000000128" !== (0xde0b6b3a7640080).toFixed(0)) || !i(5)(function() {
        s.call({})
      })), "Number", {
        toFixed: function(t) {
          var e,
            i,
            n,
            s,
            l = r(this, h),
            c = o(t),
            v = "",
            y = u;
          if (c < 0 || c > 20)
            throw RangeError(h);
          if (l != l)
            return "NaN";
          if (l <= -1e21 || l >= 1e21)
            return String(l);
          if (l < 0 && (v = "-", l = -l), l > 1e-21)
            if (
              e = g(l * m(2, 69, 1)) - 69, i = e < 0
              ? l * m(2, -e, 1)
              : l / m(2, e, 1),
            i *= 4503599627370496,
            (e = 52 - e) > 0) {
              for (d(0, i), n = c; n >= 7;)
                d(1e7, 0),
                n -= 7;
              for (d(m(10, n, 1), 0), n = e - 1; n >= 23;)
                p(1 << 23),
                n -= 23;
              p(1 << n),
              d(1, 1),
              p(2),
              y = f()
            } else
              d(0, i), d(1 << -e, 0), y = f() + a.call(u, c);
        return c > 0
            ? (s = y.length, y = v + (
              s <= c
              ? "0." + a.call(u, c - s) + y
              : y.slice(0, s - c) + "." + y.slice(s - c)))
            : y = v + y,
          y
        }
      })
    },
    function(t, e, i) {
      var n = i(32);
      t.exports = function(t, e) {
        if ("number" != typeof t && "Number" != n(t))
          throw TypeError(e);
        return + t
      }
    },
    function(t, e, i) {
      var n = i(36),
        o = i(33);
      t.exports = function(t) {
        var e = String(o(this)),
          i = "",
          r = n(t);
        if (r < 0 || 1 / 0 == r)
          throw RangeError("Count can't be negative");
        for (; r > 0; (r >>>= 1) && (e += e))
          1 & r && (i += e);
        return i
      }
    },
    function(t, e, n) {
      var o = n(6),
        r = n(5),
        a = n(84),
        s = 1..toPrecision;
      o(o.P + o.F * (r(function() {
        return "1" !== s.call(1, i)
      }) || !r(function() {
        s.call({})
      })), "Number", {
        toPrecision: function(t) {
          var e = a(this, "Number#toPrecision: incorrect invocation!");
          return t === i
            ? s.call(e)
            : s.call(e, t)
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Number", {
        EPSILON: Math.pow(2, -52)
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(2).isFinite;
      n(n.S, "Number", {
        isFinite: function(t) {
          return "number" == typeof t && o(t)
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Number", {isInteger: i(90)})
    },
    function(t, e, i) {
      var n = i(11),
        o = Math.floor;
      t.exports = function(t) {
        return !n(t) && isFinite(t) && o(t) === t
      }
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Number", {
        isNaN: function(t) {
          return t != t
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(90),
        r = Math.abs;
      n(n.S, "Number", {
        isSafeInteger: function(t) {
          return o(t) && r(t) <= 9007199254740991
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Number", {MAX_SAFE_INTEGER: 9007199254740991})
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Number", {MIN_SAFE_INTEGER: -9007199254740991})
    },
    function(t, e, i) {
      var n = i(6),
        o = i(96);
      n(n.S + n.F * (Number.parseFloat != o), "Number", {parseFloat: o})
    },
    function(t, e, i) {
      var n = i(2).parseFloat,
        o = i(81).trim;
      t.exports = 1 / n(i(82) + "-0") != -1 / 0
        ? function(t) {
          var e = o(String(t), 3),
            i = n(e);
          return 0 === i && "-" == e.charAt(0)
            ? -0
            : i
        }
        : n
    },
    function(t, e, i) {
      var n = i(6),
        o = i(98);
      n(n.S + n.F * (Number.parseInt != o), "Number", {parseInt: o})
    },
    function(t, e, i) {
      var n = i(2).parseInt,
        o = i(81).trim,
        r = i(82),
        a = /^[\-+]?0[xX]/;
      t.exports = 8 !== n(r + "08") || 22 !== n(r + "0x16")
        ? function(t, e) {
          var i = o(String(t), 3);
          return n(i, e >>> 0 || (
            a.test(i)
            ? 16
            : 10))
        }
        : n
    },
    function(t, e, i) {
      var n = i(6),
        o = i(98);
      n(n.G + n.F * (parseInt != o), {parseInt: o})
    },
    function(t, e, i) {
      var n = i(6),
        o = i(96);
      n(n.G + n.F * (parseFloat != o), {parseFloat: o})
    },
    function(t, e, i) {
      var n = i(6),
        o = i(102),
        r = Math.sqrt,
        a = Math.acosh;
      n(n.S + n.F * !(a && 710 == Math.floor(a(Number.MAX_VALUE)) && 1 / 0 == a(1 / 0)), "Math", {
        acosh: function(t) {
          return (t = + t) < 1
            ? 0 / 0
            : t > 94906265.62425156
              ? Math.log(t) + Math.LN2
              : o(t - 1 + r(t - 1) * r(t + 1))
        }
      })
    },
    function(t, e) {
      t.exports = Math.log1p || function(t) {
        return (t = + t) > -1e-8 && t < 1e-8
          ? t - t * t / 2
          : Math.log(1 + t)
      }
    },
    function(t, e, i) {
      function n(t) {
        return isFinite(t = + t) && 0 != t
          ? t < 0
            ? -n(-t)
            : Math.log(t + Math.sqrt(t * t + 1))
          : t
      }
      var o = i(6),
        r = Math.asinh;
      o(o.S + o.F * !(r && 1 / r(0) > 0), "Math", {asinh: n})
    },
    function(t, e, i) {
      var n = i(6),
        o = Math.atanh;
      n(n.S + n.F * !(o && 1 / o(-0) < 0), "Math", {
        atanh: function(t) {
          return 0 == (t = + t)
            ? t
            : Math.log((1 + t) / (1 - t)) / 2
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(106);
      n(n.S, "Math", {
        cbrt: function(t) {
          return o(t = + t) * Math.pow(Math.abs(t), 1 / 3)
        }
      })
    },
    function(t, e) {
      t.exports = Math.sign || function(t) {
        return 0 == (t = + t) || t != t
          ? t
          : t < 0
            ? -1
            : 1
      }
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {
        clz32: function(t) {
          return (t >>>= 0)
            ? 31 - Math.floor(Math.log(t + .5) * Math.LOG2E)
            : 32
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = Math.exp;
      n(n.S, "Math", {
        cosh: function(t) {
          return (o(t = + t) + o(-t)) / 2
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(110);
      n(n.S + n.F * (o != Math.expm1), "Math", {expm1: o})
    },
    function(t, e) {
      var i = Math.expm1;
      t.exports = !i || i(10) > 22025.465794806718 || i(10) < 22025.465794806718 || i(-2e-17) != -2e-17
        ? function(t) {
          return 0 == (t = + t)
            ? t
            : t > -1e-6 && t < 1e-6
              ? t + t * t / 2
              : Math.exp(t) - 1
        }
        : i
    },
    function(t, e, i) {
      var n = i(6),
        o = i(106),
        r = Math.pow,
        a = r(2, -52),
        s = r(2, -23),
        l = r(2, 127) * (2 - s),
        c = r(2, -126),
        h = function(t) {
          return t + 1 / a - 1 / a
        };
      n(n.S, "Math", {
        fround: function(t) {
          var e,
            i,
            n = Math.abs(t),
            r = o(t);
          return n < c
            ? r * h(n / c / s) * c * s
            : (
              e = (1 + s / a) * n, i = e - (e - n), i > l || i != i
              ? 1 / 0 * r
              : r * i)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = Math.abs;
      n(n.S, "Math", {
        hypot: function(t, e) {
          for (var i, n, r = 0, a = 0, s = arguments.length, l = 0; a < s;)
            i = o(arguments[a++]),
            l < i
              ? (n = l / i, r = r * n * n + 1, l = i)
              : i > 0
                ? (n = i / l, r += n * n)
                : r += i;
          return 1 / 0 === l
            ? 1 / 0
            : l * Math.sqrt(r)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = Math.imul;
      n(n.S + n.F * i(5)(function() {
        return o(4294967295, 5) != -5 || 2 != o.length
      }), "Math", {
        imul: function(t, e) {
          var i = 65535,
            n = + t,
            o = + e,
            r = i & n,
            a = i & o;
          return 0 | r * a + ((i & n >>> 16) * a + r * (i & o >>> 16) << 16 >>> 0)
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {
        log10: function(t) {
          return Math.log(t) / Math.LN10
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {log1p: i(102)})
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {
        log2: function(t) {
          return Math.log(t) / Math.LN2
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {sign: i(106)})
    },
    function(t, e, i) {
      var n = i(6),
        o = i(110),
        r = Math.exp;
      n(n.S + n.F * i(5)(function() {
        return !Math.sinh(-2e-17) != -2e-17
      }), "Math", {
        sinh: function(t) {
          return Math.abs(t = + t) < 1
            ? (o(t) - o(-t)) / 2
            : (r(t - 1) - r(-t - 1)) * (Math.E / 2)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(110),
        r = Math.exp;
      n(n.S, "Math", {
        tanh: function(t) {
          var e = o(t = + t),
            i = o(-t);
          return 1 / 0 == e
            ? 1
            : 1 / 0 == i
              ? -1
              : (e - i) / (r(t) + r(-t))
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {
        trunc: function(t) {
          return (
            t > 0
            ? Math.floor
            : Math.ceil)(t)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(37),
        r = String.fromCharCode,
        a = String.fromCodePoint;
      n(n.S + n.F * (!!a && 1 != a.length), "String", {
        fromCodePoint: function(t) {
          for (var e, i = [], n = arguments.length, a = 0; n > a;) {
            if (e = + arguments[a++], o(e, 1114111) !== e)
              throw RangeError(e + " is not a valid code point");
            i.push(
              e < 65536
              ? r(e)
              : r(55296 + ((e -= 65536) >> 10), e % 1024 + 56320))
          }
          return i.join("")
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(30),
        r = i(35);
      n(n.S, "String", {
        raw: function(t) {
          for (var e = o(t.raw), i = r(e.length), n = arguments.length, a = [], s = 0; i > s;)
            a.push(String(e[s++])),
            s < n && a.push(String(arguments[s]));
          return a.join("")
        }
      })
    },
    function(t, e, i) {
      i(81)("trim", function(t) {
        return function() {
          return t(this, 3)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(125)(!1);
      n(n.P, "String", {
        codePointAt: function(t) {
          return o(this, t)
        }
      })
    },
    function(t, e, n) {
      var o = n(36),
        r = n(33);
      t.exports = function(t) {
        return function(e, n) {
          var a,
            s,
            l = String(r(e)),
            c = o(n),
            h = l.length;
          return c < 0 || c >= h
            ? t
              ? ""
              : i
            : (
              a = l.charCodeAt(c), a < 55296 || a > 56319 || c + 1 === h || (s = l.charCodeAt(c + 1)) < 56320 || s > 57343
              ? t
                ? l.charAt(c)
                : a
              : t
                ? l.slice(c, c + 2)
                : s - 56320 + (a - 55296 << 10) + 65536)
        }
      }
    },
    function(t, e, n) {
      var o = n(6),
        r = n(35),
        a = n(127),
        s = "endsWith",
        l = "" [s];
      o(o.P + o.F * n(129)(s), "String", {
        endsWith: function(t) {
          var e = a(this, t, s),
            n = arguments.length > 1
              ? arguments[1]
              : i,
            o = r(e.length),
            c = n === i
              ? o
              : Math.min(r(n), o),
            h = String(t);
          return l
            ? l.call(e, h, c)
            : e.slice(c - h.length, c) === h
        }
      })
    },
    function(t, e, i) {
      var n = i(128),
        o = i(33);
      t.exports = function(t, e, i) {
        if (n(e))
          throw TypeError("String#" + i + " doesn't accept regex!");
        return String(o(t))
      }
    },
    function(t, e, n) {
      var o = n(11),
        r = n(32),
        a = n(23)("match");
      t.exports = function(t) {
        var e;
        return o(t) && (
          (e = t[a]) !== i
          ? !!e
          : "RegExp" == r(t))
      }
    },
    function(t, e, i) {
      var n = i(23)("match");
      t.exports = function(t) {
        var e = /./;
        try {
          "/./" [t](e)
        } catch (i) {
          try {
            return e[n] = !1,
            !"/./" [t](e)
          } catch (t) {}
        }
        return !0
      }
    },
    function(t, e, n) {
      var o = n(6),
        r = n(127),
        a = "includes";
      o(o.P + o.F * n(129)(a), "String", {
        includes: function(t) {
          return ! !~r(this, t, a).indexOf(
            t, arguments.length > 1
            ? arguments[1]
            : i)
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.P, "String", {repeat: i(85)})
    },
    function(t, e, n) {
      var o = n(6),
        r = n(35),
        a = n(127),
        s = "startsWith",
        l = "" [s];
      o(o.P + o.F * n(129)(s), "String", {
        startsWith: function(t) {
          var e = a(this, t, s),
            n = r(Math.min(
              arguments.length > 1
              ? arguments[1]
              : i,
            e.length)),
            o = String(t);
          return l
            ? l.call(e, o, n)
            : e.slice(n, n + o.length) === o
        }
      })
    },
    function(t, e, n) {
      var o = n(125)(!0);
      n(134)(String, "String", function(t) {
        this._t = String(t),
        this._i = 0
      }, function() {
        var t,
          e = this._t,
          n = this._i;
        return n >= e.length
          ? {
            value: i,
            done: !0
          }
          : (t = o(e, n), this._i += t.length, {
            value: t,
            done: !1
          })
      })
    },
    function(t, e, n) {
      var o = n(26),
        r = n(6),
        a = n(16),
        s = n(8),
        l = n(3),
        c = n(135),
        h = n(136),
        u = n(22),
        d = n(57),
        p = n(23)("iterator"),
        f = !([].keys && "next" in[].keys()),
        m = "keys",
        g = "values",
        v = function() {
          return this
        };
      t.exports = function(t, e, n, y, E, x, b) {
        h(n, e, y);
        var w,
          C,
          T,
          _ = function(t) {
            if (!f && t in O)
              return O[t];
            switch (t) {
              case m:
              case g:
                return function() {
                  return new n(this, t)
                }
            }
            return function() {
              return new n(this, t)
            }
          },
          L = e + " Iterator",
          M = E == g,
          S = !1,
          O = t.prototype,
          D = O[p] || O["@@iterator"] || E && O[E],
          R = D || _(E),
          U = E
            ? M
              ? _("entries")
              : R
            : i,
          A = "Array" == e
            ? O.entries || D
            : D;
        if (A && (T = d(A.call(new t))) !== Object.prototype && (u(T, L, !0), o || l(T, p) || s(T, p, v)), M && D && D.name !== g && (S = !0, R = function() {
          return D.call(this)
        }), o && !b || !f && !S && O[p] || s(O, p, R), c[e] = R, c[L] = v, E)
          if (w = {
            values: M
              ? R
              : _(g),
            keys: x
              ? R
              : _(m),
            entries: U
          }, b)
            for (C in w)
              C in O || a(O, C, w[C]);
      else
          r(r.P + r.F * (f || S), e, w);
        return w
      }
    },
    function(t, e) {
      t.exports = {}
    },
    function(t, e, i) {
      var n = i(44),
        o = i(15),
        r = i(22),
        a = {};
      i(8)(a, i(23)("iterator"), function() {
        return this
      }),
      t.exports = function(t, e, i) {
        t.prototype = n(a, {
          next: o(1, i)
        }),
        r(t, e + " Iterator")
      }
    },
    function(t, e, i) {
      i(138)("anchor", function(t) {
        return function(e) {
          return t(this, "a", "name", e)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(5),
        r = i(33),
        a = function(t, e, i, n) {
          var o = String(r(t)),
            a = "<" + e;
          return "" !== i && (a += " " + i + '="' + String(n).replace(/"/g, "&quot;") + '"'),
          a + ">" + o + "</" + e + ">"
        };
      t.exports = function(t, e) {
        var i = {};
        i[t] = e(a),
        n(n.P + n.F * o(function() {
          var e = "" [t]('"');
          return e !== e.toLowerCase() || e.split('"').length > 3
        }), "String", i)
      }
    },
    function(t, e, i) {
      i(138)("big", function(t) {
        return function() {
          return t(this, "big", "", "")
        }
      })
    },
    function(t, e, i) {
      i(138)("blink", function(t) {
        return function() {
          return t(this, "blink", "", "")
        }
      })
    },
    function(t, e, i) {
      i(138)("bold", function(t) {
        return function() {
          return t(this, "b", "", "")
        }
      })
    },
    function(t, e, i) {
      i(138)("fixed", function(t) {
        return function() {
          return t(this, "tt", "", "")
        }
      })
    },
    function(t, e, i) {
      i(138)("fontcolor", function(t) {
        return function(e) {
          return t(this, "font", "color", e)
        }
      })
    },
    function(t, e, i) {
      i(138)("fontsize", function(t) {
        return function(e) {
          return t(this, "font", "size", e)
        }
      })
    },
    function(t, e, i) {
      i(138)("italics", function(t) {
        return function() {
          return t(this, "i", "", "")
        }
      })
    },
    function(t, e, i) {
      i(138)("link", function(t) {
        return function(e) {
          return t(this, "a", "href", e)
        }
      })
    },
    function(t, e, i) {
      i(138)("small", function(t) {
        return function() {
          return t(this, "small", "", "")
        }
      })
    },
    function(t, e, i) {
      i(138)("strike", function(t) {
        return function() {
          return t(this, "strike", "", "")
        }
      })
    },
    function(t, e, i) {
      i(138)("sub", function(t) {
        return function() {
          return t(this, "sub", "", "")
        }
      })
    },
    function(t, e, i) {
      i(138)("sup", function(t) {
        return function() {
          return t(this, "sup", "", "")
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Array", {isArray: i(43)})
    },
    function(t, e, n) {
      var o = n(18),
        r = n(6),
        a = n(56),
        s = n(153),
        l = n(154),
        c = n(35),
        h = n(155),
        u = n(156);
      r(r.S + r.F * !n(157)(function(t) {
        Array.from(t)
      }), "Array", {
        from: function(t) {
          var e,
            n,
            r,
            d,
            p = a(t),
            f = "function" == typeof this
              ? this
              : Array,
            m = arguments.length,
            g = m > 1
              ? arguments[1]
              : i,
            v = g !== i,
            y = 0,
            E = u(p);
          if (v && (g = o(
            g, m > 2
            ? arguments[2]
            : i,
          2)), E == i || f == Array && l(E))
            for (e = c(p.length), n = new f(e); e > y; y++)
              h(
                n, y, v
                ? g(p[y], y)
                : p[y]);
          else
            for (d = E.call(p), n = new f; !(r = d.next()).done; y++)
              h(
                n, y, v
                ? s(d, g, [
                  r.value, y
                ], !0)
                : r.value);
          return n.length = y,
          n
        }
      })
    },
    function(t, e, n) {
      var o = n(10);
      t.exports = function(t, e, n, r) {
        try {
          return r
            ? e(o(n)[0], n[1])
            : e(n)
        } catch (e) {
          var a = t.return;
          throw a !== i && o(a.call(t)),
          e
        }
      }
    },
    function(t, e, n) {
      var o = n(135),
        r = n(23)("iterator"),
        a = Array.prototype;
      t.exports = function(t) {
        return t !== i && (o.Array === t || a[r] === t)
      }
    },
    function(t, e, i) {
      var n = i(9),
        o = i(15);
      t.exports = function(t, e, i) {
        e in t
          ? n.f(t, e, o(0, i))
          : t[e] = i
      }
    },
    function(t, e, n) {
      var o = n(73),
        r = n(23)("iterator"),
        a = n(135);
      t.exports = n(7).getIteratorMethod = function(t) {
        if (t != i)
          return t[r] || t["@@iterator"] || a[o(t)]
      }
    },
    function(t, e, i) {
      var n = i(23)("iterator"),
        o = !1;
      try {
        var r = [7][n]();
        r.return = function() {
          o = !0
        },
        Array.from(r, function() {
          throw 2
        })
      } catch (t) {}
      t.exports = function(t, e) {
        if (!e && !o)
          return !1;
        var i = !1;
        try {
          var r = [7],
            a = r[n]();
          a.next = function() {
            return {
              done: i = !0
            }
          },
          r[n] = function() {
            return a
          },
          t(r)
        } catch (t) {}
        return i
      }
    },
    function(t, e, i) {
      var n = i(6),
        o = i(155);
      n(n.S + n.F * i(5)(function() {
        function t() {}
        return !(Array.of.call(t)instanceof t)
      }), "Array", {
        of: function() {
          for (var t = 0, e = arguments.length, i = new(
            "function" == typeof this
            ? this
            : Array)(e); e > t;)
            o(i, t, arguments[t++]);
          return i.length = e,
          i
        }
      })
    },
    function(t, e, n) {
      var o = n(6),
        r = n(30),
        a = [].join;
      o(o.P + o.F * (n(31) != Object || !n(160)(a)), "Array", {
        join: function(t) {
          return a.call(
            r(this), t === i
            ? ","
            : t)
        }
      })
    },
    function(t, e, i) {
      var n = i(5);
      t.exports = function(t, e) {
        return !!t && n(function() {
          e
            ? t.call(null, function() {}, 1)
            : t.call(null)
        })
      }
    },
    function(t, e, n) {
      var o = n(6),
        r = n(46),
        a = n(32),
        s = n(37),
        l = n(35),
        c = [].slice;
      o(o.P + o.F * n(5)(function() {
        r && c.call(r)
      }), "Array", {
        slice: function(t, e) {
          var n = l(this.length),
            o = a(this);
          if (
            e = e === i
            ? n
            : e,
          "Array" == o)
            return c.call(this, t, e);
          for (var r = s(t, n), h = s(e, n), u = l(h - r), d = Array(u), p = 0; p < u; p++)
            d[p] = "String" == o
              ? this.charAt(r + p)
              : this[r + p];
          return d
        }
      })
    },
    function(t, e, n) {
      var o = n(6),
        r = n(19),
        a = n(56),
        s = n(5),
        l = [].sort,
        c = [1, 2, 3];
      o(o.P + o.F * (s(function() {
        c.sort(i)
      }) || !s(function() {
        c.sort(null)
      }) || !n(160)(l)), "Array", {
        sort: function(t) {
          return t === i
            ? l.call(a(this))
            : l.call(a(this), r(t))
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(164)(0),
        r = i(160)([].forEach, !0);
      n(n.P + n.F * !r, "Array", {
        forEach: function(t) {
          return o(this, t, arguments[1])
        }
      })
    },
    function(t, e, n) {
      var o = n(18),
        r = n(31),
        a = n(56),
        s = n(35),
        l = n(165);
      t.exports = function(t, e) {
        var n = 1 == t,
          c = 2 == t,
          h = 3 == t,
          u = 4 == t,
          d = 6 == t,
          p = 5 == t || d,
          f = e || l;
        return function(e, l, m) {
          for (
            var g, v, y = a(e), E = r(y), x = o(l, m, 3), b = s(E.length), w = 0, C = n
            ? f(e, b)
            : c
              ? f(e, 0)
              : i; b > w; w++)
            if ((p || w in E) && (g = E[w], v = x(g, w, y), t))
              if (n)
                C[w] = v;
              else if (v)
                switch (t) {
                  case 3:
                    return !0;
                  case 5:
                    return g;
                  case 6:
                    return w;
                  case 2:
                    C.push(g)
                }
              else if (u)
            return !1;
          return d
            ? -1
            : h || u
              ? u
              : C
        }
      }
    },
    function(t, e, i) {
      var n = i(166);
      t.exports = function(t, e) {
        return new(n(t))(e)
      }
    },
    function(t, e, n) {
      var o = n(11),
        r = n(43),
        a = n(23)("species");
      t.exports = function(t) {
        var e;
        return r(t) && (e = t.constructor, "function" != typeof e || e !== Array && !r(e.prototype) || (e = i), o(e) && null === (e = e[a]) && (e = i)),
        e === i
          ? Array
          : e
      }
    },
    function(t, e, i) {
      var n = i(6),
        o = i(164)(1);
      n(n.P + n.F * !i(160)([].map, !0), "Array", {
        map: function(t) {
          return o(this, t, arguments[1])
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(164)(2);
      n(n.P + n.F * !i(160)([].filter, !0), "Array", {
        filter: function(t) {
          return o(this, t, arguments[1])
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(164)(3);
      n(n.P + n.F * !i(160)([].some, !0), "Array", {
        some: function(t) {
          return o(this, t, arguments[1])
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(164)(4);
      n(n.P + n.F * !i(160)([].every, !0), "Array", {
        every: function(t) {
          return o(this, t, arguments[1])
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(172);
      n(n.P + n.F * !i(160)([].reduce, !0), "Array", {
        reduce: function(t) {
          return o(this, t, arguments.length, arguments[1], !1)
        }
      })
    },
    function(t, e, i) {
      var n = i(19),
        o = i(56),
        r = i(31),
        a = i(35);
      t.exports = function(t, e, i, s, l) {
        n(e);
        var c = o(t),
          h = r(c),
          u = a(c.length),
          d = l
            ? u - 1
            : 0,
          p = l
            ? -1
            : 1;
        if (i < 2)
          for (;;) {
            if (d in h) {
              s = h[d],
              d += p;
              break
            }
            if (
              d += p, l
              ? d < 0
              : u <= d)
              throw TypeError("Reduce of empty array with no initial value")
          }
        for (
          ; l
          ? d >= 0
          : u > d; d += p)
          d in h && (s = e(s, h[d], d, c));
        return s
      }
    },
    function(t, e, i) {
      var n = i(6),
        o = i(172);
      n(n.P + n.F * !i(160)([].reduceRight, !0), "Array", {
        reduceRight: function(t) {
          return o(this, t, arguments.length, arguments[1], !0)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(34)(!1),
        r = [].indexOf,
        a = !!r && 1 / [1].indexOf(1, -0) < 0;
      n(n.P + n.F * (a || !i(160)(r)), "Array", {
        indexOf: function(t) {
          return a
            ? r.apply(this, arguments) || 0
            : o(this, t, arguments[1])
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(30),
        r = i(36),
        a = i(35),
        s = [].lastIndexOf,
        l = !!s && 1 / [1].lastIndexOf(1, -0) < 0;
      n(n.P + n.F * (l || !i(160)(s)), "Array", {
        lastIndexOf: function(t) {
          if (l)
            return s.apply(this, arguments) || 0;
          var e = o(this),
            i = a(e.length),
            n = i - 1;
          for (arguments.length > 1 && (n = Math.min(n, r(arguments[1]))), n < 0 && (n = i + n); n >= 0; n--)
            if (n in e && e[n] === t)
              return n || 0;
        return -1
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.P, "Array", {copyWithin: i(177)}),
      i(178)("copyWithin")
    },
    function(t, e, n) {
      var o = n(56),
        r = n(37),
        a = n(35);
      t.exports = [].copyWithin || function(t, e) {
        var n = o(this),
          s = a(n.length),
          l = r(t, s),
          c = r(e, s),
          h = arguments.length > 2
            ? arguments[2]
            : i,
          u = Math.min((
            h === i
            ? s
            : r(h, s)) - c, s - l),
          d = 1;
        for (c < l && l < c + u && (d = -1, c += u - 1, l += u - 1); u-- > 0;)
          c in n
            ? n[l] = n[c]
            : delete n[l],
          l += d,
          c += d;
        return n
      }
    },
    function(t, e, n) {
      var o = n(23)("unscopables"),
        r = Array.prototype;
      r[o] == i && n(8)(r, o, {}),
      t.exports = function(t) {
        r[o][t] = !0
      }
    },
    function(t, e, i) {
      var n = i(6);
      n(n.P, "Array", {fill: i(180)}),
      i(178)("fill")
    },
    function(t, e, n) {
      var o = n(56),
        r = n(37),
        a = n(35);
      t.exports = function(t) {
        for (
          var e = o(this), n = a(e.length), s = arguments.length, l = r(
            s > 1
            ? arguments[1]
            : i,
          n), c = s > 2
          ? arguments[2]
          : i,
        h = c === i
          ? n
          : r(c, n); h > l;)
          e[l++] = t;
        return e
      }
    },
    function(t, e, n) {
      var o = n(6),
        r = n(164)(5),
        a = "find",
        s = !0;
      a in[] && Array(1)[a](function() {
        s = !1
      }),
      o(o.P + o.F * s, "Array", {
        find: function(t) {
          return r(
            this, t, arguments.length > 1
            ? arguments[1]
            : i)
        }
      }),
      n(178)(a)
    },
    function(t, e, n) {
      var o = n(6),
        r = n(164)(6),
        a = "findIndex",
        s = !0;
      a in[] && Array(1)[a](function() {
        s = !1
      }),
      o(o.P + o.F * s, "Array", {
        findIndex: function(t) {
          return r(
            this, t, arguments.length > 1
            ? arguments[1]
            : i)
        }
      }),
      n(178)(a)
    },
    function(t, e, n) {
      var o = n(178),
        r = n(184),
        a = n(135),
        s = n(30);
      t.exports = n(134)(Array, "Array", function(t, e) {
        this._t = s(t),
        this._i = 0,
        this._k = e
      }, function() {
        var t = this._t,
          e = this._k,
          n = this._i++;
        return !t || n >= t.length
          ? (this._t = i, r(1))
          : "keys" == e
            ? r(0, n)
            : "values" == e
              ? r(0, t[n])
              : r(0, [
                n, t[n]
              ])
      }, "values"),
      a.Arguments = a.Array,
      o("keys"),
      o("values"),
      o("entries")
    },
    function(t, e) {
      t.exports = function(t, e) {
        return {
          value: e,
          done: !!t
        }
      }
    },
    function(t, e, i) {
      i(186)("Array")
    },
    function(t, e, i) {
      var n = i(2),
        o = i(9),
        r = i(4),
        a = i(23)("species");
      t.exports = function(t) {
        var e = n[t];
        r && e && !e[a] && o.f(e, a, {
          configurable: !0,
          get: function() {
            return this
          }
        })
      }
    },
    function(t, e, n) {
      var o = n(2),
        r = n(80),
        a = n(9).f,
        s = n(48).f,
        l = n(128),
        c = n(188),
        h = o.RegExp,
        u = h,
        d = h.prototype,
        p = /a/g,
        f = /a/g,
        m = new h(p) !== p;
      if (n(4) && (!m || n(5)(function() {
        return f[n(23)("match")] = !1,
        h(p) != p || h(f) == f || "/a/i" != h(p, "i")
      }))) {
        h = function(t, e) {
          var n = this instanceof h,
            o = l(t),
            a = e === i;
          return !n && o && t.constructor === h && a
            ? t
            : r(
              m
              ? new u(
                o && !a
                ? t.source
                : t,
              e)
              : u(
                (o = t instanceof h)
                ? t.source
                : t,
              o && a
                ? c.call(t)
                : e),
            n
              ? this
              : d,
            h)
        };
        for (var g = s(u), v = 0; g.length > v;)
          !function(t) {
            t in h || a(h, t, {
              configurable: !0,
              get: function() {
                return u[t]
              },
              set: function(e) {
                u[t] = e
              }
            })
          }
        (g[v++]);
        d.constructor = h,
        h.prototype = d,
        n(16)(o, "RegExp", h)
      }
      n(186)("RegExp")
    },
    function(t, e, i) {
      var n = i(10);
      t.exports = function() {
        var t = n(this),
          e = "";
        return t.global && (e += "g"),
        t.ignoreCase && (e += "i"),
        t.multiline && (e += "m"),
        t.unicode && (e += "u"),
        t.sticky && (e += "y"),
        e
      }
    },
    function(t, e, n) {
      n(190);
      var o = n(10),
        r = n(188),
        a = n(4),
        s = "toString",
        l = /./[s],
        c = function(t) {
          n(16)(RegExp.prototype, s, t, !0)
        };
      n(5)(function() {
        return "/a/b" != l.call({source: "a", flags: "b"})
      })
        ? c(function() {
          var t = o(this);
          return "/".concat(
            t.source, "/", "flags" in t
            ? t.flags
            : !a && t instanceof RegExp
              ? r.call(t)
              : i)
        })
        : l.name != s && c(function() {
          return l.call(this)
        })
    },
    function(t, e, i) {
      i(4) && "g" != /./g.flags && i(9).f(RegExp.prototype, "flags", {
        configurable: !0,
        get: i(188)
      })
    },
    function(t, e, n) {
      n(192)("match", 1, function(t, e, n) {
        return [
          function(n) {
            var o = t(this),
              r = n == i
                ? i
                : n[e];
            return r !== i
              ? r.call(n, o)
              : new RegExp(n)[e](String(o))
          },
          n
        ]
      })
    },
    function(t, e, i) {
      var n = i(8),
        o = i(16),
        r = i(5),
        a = i(33),
        s = i(23);
      t.exports = function(t, e, i) {
        var l = s(t),
          c = i(a, l, "" [t]),
          h = c[0],
          u = c[1];
        r(function() {
          var e = {};
          return e[l] = function() {
            return 7
          },
          7 != "" [t](e)
        }) && (o(String.prototype, t, h), n(
          RegExp.prototype, l, 2 == e
          ? function(t, e) {
            return u.call(t, this, e)
          }
          : function(t) {
            return u.call(t, this)
          }))
      }
    },
    function(t, e, n) {
      n(192)("replace", 2, function(t, e, n) {
        return [
          function(o, r) {
            var a = t(this),
              s = o == i
                ? i
                : o[e];
            return s !== i
              ? s.call(o, a, r)
              : n.call(String(a), o, r)
          },
          n
        ]
      })
    },
    function(t, e, n) {
      n(192)("search", 1, function(t, e, n) {
        return [
          function(n) {
            var o = t(this),
              r = n == i
                ? i
                : n[e];
            return r !== i
              ? r.call(n, o)
              : new RegExp(n)[e](String(o))
          },
          n
        ]
      })
    },
    function(t, e, n) {
      n(192)("split", 2, function(t, e, o) {
        var r = n(128),
          a = o,
          s = [].push,
          l = "split",
          c = "length",
          h = "lastIndex";
        if ("c" == "abbc" [l](/(b)*/)[1] || 4 != "test" [l](/(?:)/, -1)[c] || 2 != "ab" [l](/(?:ab)*/)[c] || 4 != "." [l](/(.?)(.?)/)[c] || "." [l](/()()/)[c] > 1 || "" [l](/.?/)[c]) {
          var u = /()??/.exec("")[1] === i;
          o = function(t, e) {
            var n = String(this);
            if (t === i && 0 === e)
              return [];
            if (!r(t))
              return a.call(n, t, e);
            var o,
              l,
              d,
              p,
              f,
              m = [],
              g = (
                t.ignoreCase
                ? "i"
                : "") + (
                t.multiline
                ? "m"
                : "") + (
                t.unicode
                ? "u"
                : "") + (
                t.sticky
                ? "y"
                : ""),
              v = 0,
              y = e === i
                ? 4294967295
                : e >>> 0,
              E = new RegExp(t.source, g + "g");
            for (u || (o = new RegExp("^" + E.source + "$(?!\\s)", g)); (l = E.exec(n)) && !((d = l.index + l[0][c]) > v && (m.push(n.slice(v, l.index)), !u && l[c] > 1 && l[0].replace(o, function() {
              for (f = 1; f < arguments[c] - 2; f++)
                arguments[f] === i && (l[f] = i)
            }), l[c] > 1 && l.index < n[c] && s.apply(m, l.slice(1)), p = l[0][c], v = d, m[c] >= y));)
              E[h] === l.index && E[h]++;
            return v === n[c]
              ? !p && E.test("") || m.push("")
              : m.push(n.slice(v)),
            m[c] > y
              ? m.slice(0, y)
              : m
          }
        } else
          "0" [l](i, 0)[c] && (o = function(t, e) {
            return t === i && 0 === e
              ? []
              : a.call(this, t, e)
          });
        return [
          function(n, r) {
            var a = t(this),
              s = n == i
                ? i
                : n[e];
            return s !== i
              ? s.call(n, a, r)
              : o.call(String(a), n, r)
          },
          o
        ]
      })
    },
    function(t, e, n) {
      var o,
        r,
        a,
        s = n(26),
        l = n(2),
        c = n(18),
        h = n(73),
        u = n(6),
        d = n(11),
        p = n(19),
        f = n(197),
        m = n(198),
        g = n(199),
        v = n(200).set,
        y = n(201)(),
        E = "Promise",
        x = l.TypeError,
        b = l.process,
        w = l[E],
        b = l.process,
        C = "process" == h(b),
        T = function() {},
        _ = !!function() {
          try {
            var t = w.resolve(1),
              e = (t.constructor = {})[n(23)("species")] = function(t) {
                t(T, T)
              };
            return (C || "function" == typeof PromiseRejectionEvent) && t.then(T)instanceof e
          } catch (t) {}
        }(),
        L = function(t, e) {
          return t === e || t === w && e === a
        },
        M = function(t) {
          var e;
          return !(!d(t) || "function" != typeof(e = t.then)) && e
        },
        S = function(t) {
          return L(w, t)
            ? new O(t)
            : new r(t)
        },
        O = r = function(t) {
          var e,
            n;
          this.promise = new t(function(t, o) {
            if (e !== i || n !== i)
              throw x("Bad Promise constructor");
            e = t,
            n = o
          }),
          this.resolve = p(e),
          this.reject = p(n)
        },
        D = function(t) {
          try {
            t()
          } catch (t) {
            return {error: t}
          }
        },
        R = function(t, e) {
          if (!t._n) {
            t._n = !0;
            var i = t._c;
            y(function() {
              for (var n = t._v, o = 1 == t._s, r = 0; i.length > r;)
                !function(e) {
                  var i,
                    r,
                    a = o
                      ? e.ok
                      : e.fail,
                    s = e.resolve,
                    l = e.reject,
                    c = e.domain;
                  try {
                    a
                      ? (
                        o || (2 == t._h && I(t), t._h = 1), a === !0
                        ? i = n
                        : (c && c.enter(), i = a(n), c && c.exit()),
                      i === e.promise
                        ? l(x("Promise-chain cycle"))
                        : (r = M(i))
                          ? r.call(i, s, l)
                          : s(i))
                      : l(n)
                  } catch (t) {
                    l(t)
                  }
                }
              (i[r++]);
              t._c = [],
              t._n = !1,
              e && !t._h && U(t)
            })
          }
        },
        U = function(t) {
          v.call(l, function() {
            var e,
              n,
              o,
              r = t._v;
            if (A(t) && (
              e = D(function() {
              C
                ? b.emit("unhandledRejection", r, t)
                : (n = l.onunhandledrejection)
                  ? n({promise: t, reason: r})
                  : (o = l.console) && o.error && o.error("Unhandled promise rejection", r)
            }), t._h = C || A(t)
              ? 2
              : 1), t._a = i, e)
              throw e.error
          })
        },
        A = function t(e) {
          if (1 == e._h)
            return !1;
          for (var i, n = e._a || e._c, o = 0; n.length > o;)
            if (i = n[o++], i.fail || !t(i.promise))
              return !1;
        return !0
        },
        I = function(t) {
          v.call(l, function() {
            var e;
            C
              ? b.emit("rejectionHandled", t)
              : (e = l.onrejectionhandled) && e({promise: t, reason: t._v})
          })
        },
        P = function(t) {
          var e = this;
          e._d || (e._d = !0, e = e._w || e, e._v = t, e._s = 2, e._a || (e._a = e._c.slice()), R(e, !0))
        },
        B = function t(e) {
          var i,
            n = this;
          if (!n._d) {
            n._d = !0,
            n = n._w || n;
            try {
              if (n === e)
                throw x("Promise can't be resolved itself");

              (i = M(e))
                ? y(function() {
                  var o = {
                    _w: n,
                    _d: !1
                  };
                  try {
                    i.call(e, c(t, o, 1), c(P, o, 1))
                  } catch (t) {
                    P.call(o, t)
                  }
                })
                : (n._v = e, n._s = 1, R(n, !1))
            } catch (t) {
              P.call({
                _w: n,
                _d: !1
              }, t)
            }
          }
        };
      _ || (w = function(t) {
        f(this, w, E, "_h"),
        p(t),
        o.call(this);
        try {
          t(c(B, this, 1), c(P, this, 1))
        } catch (t) {
          P.call(this, t)
        }
      }, o = function(t) {
        this._c = [],
        this._a = i,
        this._s = 0,
        this._d = !1,
        this._v = i,
        this._h = 0,
        this._n = !1
      }, o.prototype = n(202)(w.prototype, {
        then: function(t, e) {
          var n = S(g(this, w));
          return n.ok = "function" != typeof t || t,
          n.fail = "function" == typeof e && e,
          n.domain = C
            ? b.domain
            : i,
          this._c.push(n),
          this._a && this._a.push(n),
          this._s && R(this, !1),
          n.promise
        }, catch  : function(t) {
          return this.then(i, t)
        }
      }), O = function() {
        var t = new o;
        this.promise = t,
        this.resolve = c(B, t, 1),
        this.reject = c(P, t, 1)
      }), u(u.G + u.W + u.F * !_, {Promise: w}), n(22)(w, E), n(186)(E), a = n(7)[E], u(u.S + u.F * !_, E, {
        reject: function(t) {
          var e = S(this);
          return (0, e.reject)(t),
          e.promise
        }
      }), u(u.S + u.F * (s || !_), E, {
        resolve: function(t) {
          if (t instanceof w && L(t.constructor, this))
            return t;
          var e = S(this);
          return (0, e.resolve)(t),
          e.promise
        }
      }), u(u.S + u.F * !(_ && n(157)(function(t) {
        w.all(t).catch(T)
      })), E, {
        all: function(t) {
          var e = this,
            n = S(e),
            o = n.resolve,
            r = n.reject,
            a = D(function() {
              var n = [],
                a = 0,
                s = 1;
              m(t, !1, function(t) {
                var l = a++,
                  c = !1;
                n.push(i),
                s++,
                e.resolve(t).then(function(t) {
                  c || (c = !0, n[l] = t, --s || o(n))
                }, r)
              }),
              --s || o(n)
            });
          return a && r(a.error),
          n.promise
        },
        race: function(t) {
          var e = this,
            i = S(e),
            n = i.reject,
            o = D(function() {
              m(t, !1, function(t) {
                e.resolve(t).then(i.resolve, n)
              })
            });
          return o && n(o.error),
          i.promise
        }
      })
    },
    function(t, e) {
      t.exports = function(t, e, n, o) {
        if (!(t instanceof e) || o !== i && o in t)
          throw TypeError(n + ": incorrect invocation!");
        return t
      }
    },
    function(t, e, i) {
      var n = i(18),
        o = i(153),
        r = i(154),
        a = i(10),
        s = i(35),
        l = i(156),
        c = {},
        h = {},
        e = t.exports = function(t, e, i, u, d) {
          var p,
            f,
            m,
            g,
            v = d
              ? function() {
                return t
              }
              : l(t),
            y = n(
              i, u, e
              ? 2
              : 1),
            E = 0;
          if ("function" != typeof v)
            throw TypeError(t + " is not iterable!");
          if (r(v)) {
            for (p = s(t.length); p > E; E++)
              if ((
                g = e
                ? y(a(f = t[E])[0], f[1])
                : y(t[E])) === c || g === h)
                return g
            }
          else
            for (m = v.call(t); !(f = m.next()).done;)
              if ((g = o(m, y, f.value, e)) === c || g === h)
                return g
        };
      e.BREAK = c,
      e.RETURN = h
    },
    function(t, e, n) {
      var o = n(10),
        r = n(19),
        a = n(23)("species");
      t.exports = function(t, e) {
        var n,
          s = o(t).constructor;
        return s === i || (n = o(s)[a]) == i
          ? e
          : r(n)
      }
    },
    function(t, e, i) {
      var n,
        o,
        r,
        a = i(18),
        s = i(76),
        l = i(46),
        c = i(13),
        h = i(2),
        u = h.process,
        d = h.setImmediate,
        p = h.clearImmediate,
        f = h.MessageChannel,
        m = 0,
        g = {},
        v = "onreadystatechange",
        y = function() {
          var t = + this;
          if (g.hasOwnProperty(t)) {
            var e = g[t];
            delete g[t],
            e()
          }
        },
        E = function(t) {
          y.call(t.data)
        };
      d && p || (
        d = function(t) {
        for (var e = [], i = 1; arguments.length > i;)
          e.push(arguments[i++]);
        return g[++m] = function() {
          s(
            "function" == typeof t
            ? t
            : Function(t),
          e)
        },
        n(m),
        m
      }, p = function(t) {
        delete g[t]
      }, "process" == i(32)(u)
        ? n = function(t) {
          u.nextTick(a(y, t, 1))
        }
        : f
          ? (o = new f, r = o.port2, o.port1.onmessage = E, n = a(r.postMessage, r, 1))
          : h.addEventListener && "function" == typeof postMessage && !h.importScripts
            ? (n = function(t) {
              h.postMessage(t + "", "*")
            }, h.addEventListener("message", E, !1))
            : n = v in c("script")
              ? function(t) {
                l.appendChild(c("script"))[v] = function() {
                  l.removeChild(this),
                  y.call(t)
                }
              }
              : function(t) {
                setTimeout(a(y, t, 1), 0)
              }),
      t.exports = {
        set: d,
        clear: p
      }
    },
    function(t, e, n) {
      var o = n(2),
        r = n(200).set,
        a = o.MutationObserver || o.WebKitMutationObserver,
        s = o.process,
        l = o.Promise,
        c = "process" == n(32)(s);
      t.exports = function() {
        var t,
          e,
          n,
          h = function() {
            var o,
              r;
            for (c && (o = s.domain) && o.exit(); t;) {
              r = t.fn,
              t = t.next;
              try {
                r()
              } catch (o) {
                throw t? n() : e = i,
                o
              }
            }
            e = i,
            o && o.enter()
          };
        if (c)
          n = function() {
            s.nextTick(h)
          };
        else if (a) {
          var u = !0,
            d = document.createTextNode("");
          new a(h).observe(d, {
            characterData: !0
          }),
          n = function() {
            d.data = u = !u
          }
        } else if (l && l.resolve) {
          var p = l.resolve();
          n = function() {
            p.then(h)
          }
        } else
          n = function() {
            r.call(o, h)
          };
        return function(o) {
          var r = {
            fn: o,
            next: i
          };
          e && (e.next = r),
          t || (t = r, n()),
          e = r
        }
      }
    },
    function(t, e, i) {
      var n = i(16);
      t.exports = function(t, e, i) {
        for (var o in e)
          n(t, o, e[o], i);
        return t
      }
    },
    function(t, e, n) {
      var o = n(204);
      t.exports = n(205)("Map", function(t) {
        return function() {
          return t(
            this, arguments.length > 0
            ? arguments[0]
            : i)
        }
      }, {
        get: function(t) {
          var e = o.getEntry(this, t);
          return e && e.v
        },
        set: function(t, e) {
          return o.def(
            this, 0 === t
            ? 0
            : t,
          e)
        }
      }, o, !0)
    },
    function(t, e, n) {
      var o = n(9).f,
        r = n(44),
        a = n(202),
        s = n(18),
        l = n(197),
        c = n(33),
        h = n(198),
        u = n(134),
        d = n(184),
        p = n(186),
        f = n(4),
        m = n(20).fastKey,
        g = f
          ? "_s"
          : "size",
        v = function(t, e) {
          var i,
            n = m(e);
          if ("F" !== n)
            return t._i[n];
          for (i = t._f; i; i = i.n)
            if (i.k == e)
              return i
        };
      t.exports = {
        getConstructor: function(t, e, n, u) {
          var d = t(function(t, o) {
            l(t, d, e, "_i"),
            t._i = r(null),
            t._f = i,
            t._l = i,
            t[g] = 0,
            o != i && h(o, n, t[u], t)
          });
          return a(d.prototype, {
            clear: function() {
              for (var t = this, e = t._i, n = t._f; n; n = n.n)
                n.r = !0,
                n.p && (n.p = n.p.n = i),
                delete e[n.i];
              t._f = t._l = i,
              t[g] = 0
            },
            delete: function(t) {
              var e = this,
                i = v(e, t);
              if (i) {
                var n = i.n,
                  o = i.p;
                delete e._i[i.i],
                i.r = !0,
                o && (o.n = n),
                n && (n.p = o),
                e._f == i && (e._f = n),
                e._l == i && (e._l = o),
                e[g]--
              }
              return !!i
            },
            forEach: function(t) {
              l(this, d, "forEach");
              for (
                var e, n = s(
                  t, arguments.length > 1
                  ? arguments[1]
                  : i,
                3); e = e
                ? e.n
                : this._f;)
                for (n(e.v, e.k, this); e && e.r;)
                  e = e.p
            },
            has: function(t) {
              return !!v(this, t)
            }
          }),
          f && o(d.prototype, "size", {
            get: function() {
              return c(this[g])
            }
          }),
          d
        },
        def: function(t, e, n) {
          var o,
            r,
            a = v(t, e);
          return a
            ? a.v = n
            : (t._l = a = {
              i: r = m(e, !0),
              k: e,
              v: n,
              p: o = t._l,
              n: i,
              r: !1
            }, t._f || (t._f = a), o && (o.n = a), t[g]++, "F" !== r && (t._i[r] = a)),
          t
        },
        getEntry: v,
        setStrong: function(t, e, n) {
          u(
            t, e, function(t, e) {
            this._t = t,
            this._k = e,
            this._l = i
          }, function() {
            for (var t = this, e = t._k, n = t._l; n && n.r;)
              n = n.p;
            return t._t && (
              t._l = n = n
              ? n.n
              : t._t._f)
              ? "keys" == e
                ? d(0, n.k)
                : "values" == e
                  ? d(0, n.v)
                  : d(0, [n.k, n.v])
              : (t._t = i, d(1))
          }, n
            ? "entries"
            : "values",
          !n,
          !0),
          p(e)
        }
      }
    },
    function(t, e, n) {
      var o = n(2),
        r = n(6),
        a = n(16),
        s = n(202),
        l = n(20),
        c = n(198),
        h = n(197),
        u = n(11),
        d = n(5),
        p = n(157),
        f = n(22),
        m = n(80);
      t.exports = function(t, e, n, g, v, y) {
        var E = o[t],
          x = E,
          b = v
            ? "set"
            : "add",
          w = x && x.prototype,
          C = {},
          T = function(t) {
            var e = w[t];
            a(
              w, t, "delete" == t
              ? function(t) {
                return !(y && !u(t)) && e.call(
                  this, 0 === t
                  ? 0
                  : t)
              }
              : "has" == t
                ? function(t) {
                  return !(y && !u(t)) && e.call(
                    this, 0 === t
                    ? 0
                    : t)
                }
                : "get" == t
                  ? function(t) {
                    return y && !u(t)
                      ? i
                      : e.call(
                        this, 0 === t
                        ? 0
                        : t)
                  }
                  : "add" == t
                    ? function(t) {
                      return e.call(
                        this, 0 === t
                        ? 0
                        : t),
                      this
                    }
                    : function(t, i) {
                      return e.call(
                        this, 0 === t
                        ? 0
                        : t,
                      i),
                      this
                    })
          };
        if ("function" == typeof x && (y || w.forEach && !d(function() {
          (new x).entries().next()
        }))) {
          var _ = new x,
            L = _[b](
              y
              ? {}
              : -0,
            1) != _,
            M = d(function() {
              _.has(1)
            }),
            S = p(function(t) {
              new x(t)
            }),
            O = !y && d(function() {
              for (var t = new x, e = 5; e--;)
                t[b](e, e);
              return !t.has(-0)
            });
          S || (x = e(function(e, n) {
            h(e, x, t);
            var o = m(new E, e, x);
            return n != i && c(n, v, o[b], o),
            o
          }), x.prototype = w, w.constructor = x),
          (M || O) && (T("delete"), T("has"), v && T("get")),
          (O || L) && T(b),
          y && w.clear && delete w.clear
        } else
          x = g.getConstructor(e, t, v, b),
          s(x.prototype, n),
          l.NEED = !0;
        return f(x, t),
        C[t] = x,
        r(r.G + r.W + r.F * (x != E), C),
        y || g.setStrong(x, t, v),
        x
      }
    },
    function(t, e, n) {
      var o = n(204);
      t.exports = n(205)("Set", function(t) {
        return function() {
          return t(
            this, arguments.length > 0
            ? arguments[0]
            : i)
        }
      }, {
        add: function(t) {
          return o.def(
            this, t = 0 === t
            ? 0
            : t,
          t)
        }
      }, o)
    },
    function(t, e, n) {
      var o,
        r = n(164)(0),
        a = n(16),
        s = n(20),
        l = n(67),
        c = n(208),
        h = n(11),
        u = s.getWeak,
        d = Object.isExtensible,
        p = c.ufstore,
        f = {},
        m = function(t) {
          return function() {
            return t(
              this, arguments.length > 0
              ? arguments[0]
              : i)
          }
        },
        g = {
          get: function(t) {
            if (h(t)) {
              var e = u(t);
              return e === !0
                ? p(this).get(t)
                : e
                  ? e[this._i]
                  : i
            }
          },
          set: function(t, e) {
            return c.def(this, t, e)
          }
        },
        v = t.exports = n(205)("WeakMap", m, g, c, !0, !0);
      7 != (new v).set((Object.freeze || Object)(f), 7).get(f) && (o = c.getConstructor(m), l(o.prototype, g), s.NEED = !0, r([
        "delete", "has", "get", "set"
      ], function(t) {
        var e = v.prototype,
          i = e[t];
        a(e, t, function(e, n) {
          if (h(e) && !d(e)) {
            this._f || (this._f = new o);
            var r = this._f[t](e, n);
            return "set" == t
              ? this
              : r
          }
          return i.call(this, e, n)
        })
      }))
    },
    function(t, e, n) {
      var o = n(202),
        r = n(20).getWeak,
        a = n(10),
        s = n(11),
        l = n(197),
        c = n(198),
        h = n(164),
        u = n(3),
        d = h(5),
        p = h(6),
        f = 0,
        m = function(t) {
          return t._l || (t._l = new g)
        },
        g = function() {
          this.a = []
        },
        v = function(t, e) {
          return d(t.a, function(t) {
            return t[0] === e
          })
        };
      g.prototype = {
        get: function(t) {
          var e = v(this, t);
          if (e)
            return e[1]
        },
        has: function(t) {
          return !!v(this, t)
        },
        set: function(t, e) {
          var i = v(this, t);
          i
            ? i[1] = e
            : this.a.push([t, e])
        },
        delete: function(t) {
          var e = p(this.a, function(e) {
            return e[0] === t
          });
          return ~ e && this.a.splice(e, 1),
          ! !~e
        }
      },
      t.exports = {
        getConstructor: function(t, e, n, a) {
          var h = t(function(t, o) {
            l(t, h, e, "_i"),
            t._i = f++,
            t._l = i,
            o != i && c(o, n, t[a], t)
          });
          return o(h.prototype, {
            delete: function(t) {
              if (!s(t))
                return !1;
              var e = r(t);
              return e === !0
                ? m(this).delete(t)
                : e && u(e, this._i) && delete e[this._i]
            },
            has: function(t) {
              if (!s(t))
                return !1;
              var e = r(t);
              return e === !0
                ? m(this).has(t)
                : e && u(e, this._i)
            }
          }),
          h
        },
        def: function(t, e, i) {
          var n = r(a(e), !0);
          return n === !0
            ? m(t).set(e, i)
            : n[t._i] = i,
          t
        },
        ufstore: m
      }
    },
    function(t, e, n) {
      var o = n(208);
      n(205)("WeakSet", function(t) {
        return function() {
          return t(
            this, arguments.length > 0
            ? arguments[0]
            : i)
        }
      }, {
        add: function(t) {
          return o.def(this, t, !0)
        }
      }, o, !1, !0)
    },
    function(t, e, i) {
      var n = i(6),
        o = i(19),
        r = i(10),
        a = (i(2).Reflect || {}).apply,
        s = Function.apply;
      n(n.S + n.F * !i(5)(function() {
        a(function() {})
      }), "Reflect", {
        apply: function(t, e, i) {
          var n = o(t),
            l = r(i);
          return a
            ? a(n, e, l)
            : s.call(n, e, l)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(44),
        r = i(19),
        a = i(10),
        s = i(11),
        l = i(5),
        c = i(75),
        h = (i(2).Reflect || {}).construct,
        u = l(function() {
          function t() {}
          return !(h(function() {}, [], t)instanceof t)
        }),
        d = !l(function() {
          h(function() {})
        });
      n(n.S + n.F * (u || d), "Reflect", {
        construct: function(t, e) {
          r(t),
          a(e);
          var i = arguments.length < 3
            ? t
            : r(arguments[2]);
          if (d && !u)
            return h(t, e, i);
          if (t == i) {
            switch (e.length) {
              case 0:
                return new t;
              case 1:
                return new t(e[0]);
              case 2:
                return new t(e[0], e[1]);
              case 3:
                return new t(e[0], e[1], e[2]);
              case 4:
                return new t(e[0], e[1], e[2], e[3])
            }
            var n = [null];
            return n.push.apply(n, e),
            new(c.apply(t, n))
          }
          var l = i.prototype,
            p = o(
              s(l)
              ? l
              : Object.prototype),
            f = Function.apply.call(t, p, e);
          return s(f)
            ? f
            : p
        }
      })
    },
    function(t, e, i) {
      var n = i(9),
        o = i(6),
        r = i(10),
        a = i(14);
      o(o.S + o.F * i(5)(function() {
        Reflect.defineProperty(n.f({}, 1, {value: 1}), 1, {value: 2})
      }), "Reflect", {
        defineProperty: function(t, e, i) {
          r(t),
          e = a(e, !0),
          r(i);
          try {
            return n.f(t, e, i),
            !0
          } catch (t) {
            return !1
          }
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(49).f,
        r = i(10);
      n(n.S, "Reflect", {
        deleteProperty: function(t, e) {
          var i = o(r(t), e);
          return !(i && !i.configurable) && delete t[e]
        }
      })
    },
    function(t, e, n) {
      var o = n(6),
        r = n(10),
        a = function(t) {
          this._t = r(t),
          this._i = 0;
          var e,
            i = this._k = [];
          for (e in t)
            i.push(e)
        };
      n(136)(a, "Object", function() {
        var t,
          e = this,
          n = e._k;
        do {
          if (e._i >= n.length)
            return {
              value: i,
              done: !0
            }
          } while (!((t = n[e._i++]) in e._t));
        return {
          value: t,
          done: !1
        }
      }),
      o(o.S, "Reflect", {
        enumerate: function(t) {
          return new a(t)
        }
      })
    },
    function(t, e, n) {
      function o(t, e) {
        var n,
          l,
          u = arguments.length < 3
            ? t
            : arguments[2];
        return h(t) === u
          ? t[e]
          : (n = r.f(t, e))
            ? s(n, "value")
              ? n.value
              : n.get !== i
                ? n.get.call(u)
                : i
            : c(l = a(t))
              ? o(l, e, u)
              : void 0
      }
      var r = n(49),
        a = n(57),
        s = n(3),
        l = n(6),
        c = n(11),
        h = n(10);
      l(l.S, "Reflect", {get: o})
    },
    function(t, e, i) {
      var n = i(49),
        o = i(6),
        r = i(10);
      o(o.S, "Reflect", {
        getOwnPropertyDescriptor: function(t, e) {
          return n.f(r(t), e)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(57),
        r = i(10);
      n(n.S, "Reflect", {
        getPrototypeOf: function(t) {
          return o(r(t))
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Reflect", {
        has: function(t, e) {
          return e in t
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(10),
        r = Object.isExtensible;
      n(n.S, "Reflect", {
        isExtensible: function(t) {
          return o(t),
          !r || r(t)
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Reflect", {ownKeys: i(221)})
    },
    function(t, e, i) {
      var n = i(48),
        o = i(41),
        r = i(10),
        a = i(2).Reflect;
      t.exports = a && a.ownKeys || function(t) {
        var e = n.f(r(t)),
          i = o.f;
        return i
          ? e.concat(i(t))
          : e
      }
    },
    function(t, e, i) {
      var n = i(6),
        o = i(10),
        r = Object.preventExtensions;
      n(n.S, "Reflect", {
        preventExtensions: function(t) {
          o(t);
          try {
            return r && r(t),
            !0
          } catch (t) {
            return !1
          }
        }
      })
    },
    function(t, e, n) {
      function o(t, e, n) {
        var c,
          p,
          f = arguments.length < 4
            ? t
            : arguments[3],
          m = a.f(u(t), e);
        if (!m) {
          if (d(p = s(t)))
            return o(p, e, n, f);
          m = h(0)
        }
        return l(m, "value")
          ? !(m.writable === !1 || !d(f) || (c = a.f(f, e) || h(0), c.value = n, r.f(f, e, c), 0))
          : m.set !== i && (m.set.call(f, n), !0)
      }
      var r = n(9),
        a = n(49),
        s = n(57),
        l = n(3),
        c = n(6),
        h = n(15),
        u = n(10),
        d = n(11);
      c(c.S, "Reflect", {set: o})
    },
    function(t, e, i) {
      var n = i(6),
        o = i(71);
      o && n(n.S, "Reflect", {
        setPrototypeOf: function(t, e) {
          o.check(t, e);
          try {
            return o.set(t, e),
            !0
          } catch (t) {
            return !1
          }
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Date", {
        now: function() {
          return (new Date).getTime()
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(56),
        r = i(14);
      n(n.P + n.F * i(5)(function() {
        return null !== new Date(0 / 0).toJSON() || 1 !== Date.prototype.toJSON.call({
          toISOString: function() {
            return 1
          }
        })
      }), "Date", {
        toJSON: function(t) {
          var e = o(this),
            i = r(e);
          return "number" != typeof i || isFinite(i)
            ? e.toISOString()
            : null
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(5),
        r = Date.prototype.getTime,
        a = function(t) {
          return t > 9
            ? t
            : "0" + t
        };
      n(n.P + n.F * (o(function() {
        return "0385-07-25T07:06:39.999Z" != new Date(-5e13 - 1).toISOString()
      }) || !o(function() {
        new Date(0 / 0).toISOString()
      })), "Date", {
        toISOString: function() {
          if (!isFinite(r.call(this)))
            throw RangeError("Invalid time value");
          var t = this,
            e = t.getUTCFullYear(),
            i = t.getUTCMilliseconds(),
            n = e < 0
              ? "-"
              : e > 9999
                ? "+"
                : "";
          return n + ("00000" + Math.abs(e)).slice(
            n
            ? -6
            : -4) + "-" + a(t.getUTCMonth() + 1) + "-" + a(t.getUTCDate()) + "T" + a(t.getUTCHours()) + ":" + a(t.getUTCMinutes()) + ":" + a(t.getUTCSeconds()) + "." + (
            i > 99
            ? i
            : "0" + a(i)) + "Z"
        }
      })
    },
    function(t, e, i) {
      var n = Date.prototype,
        o = "Invalid Date",
        r = "toString",
        a = n[r],
        s = n.getTime;
      new Date(0 / 0) + "" != o && i(16)(n, r, function() {
        var t = s.call(this);
        return t === t
          ? a.call(this)
          : o
      })
    },
    function(t, e, i) {
      var n = i(23)("toPrimitive"),
        o = Date.prototype;
      n in o || i(8)(o, n, i(230))
    },
    function(t, e, i) {
      var n = i(10),
        o = i(14),
        r = "number";
      t.exports = function(t) {
        if ("string" !== t && t !== r && "default" !== t)
          throw TypeError("Incorrect hint");
        return o(n(this), t != r)
      }
    },
    function(t, e, n) {
      var o = n(6),
        r = n(232),
        a = n(233),
        s = n(10),
        l = n(37),
        c = n(35),
        h = n(11),
        u = n(2).ArrayBuffer,
        d = n(199),
        p = a.ArrayBuffer,
        f = a.DataView,
        m = r.ABV && u.isView,
        g = p.prototype.slice,
        v = r.VIEW,
        y = "ArrayBuffer";
      o(o.G + o.W + o.F * (u !== p), {ArrayBuffer: p}),
      o(o.S + o.F * !r.CONSTR, y, {
        isView: function(t) {
          return m && m(t) || h(t) && v in t
        }
      }),
      o(o.P + o.U + o.F * n(5)(function() {
        return !new p(2).slice(1, i).byteLength
      }), y, {
        slice: function(t, e) {
          if (g !== i && e === i)
            return g.call(s(this), t);
          for (var n = s(this).byteLength, o = l(t, n), r = l(
            e === i
            ? n
            : e,
          n), a = new(d(this, p))(c(r - o)), h = new f(this), u = new f(a), m = 0; o < r;)
            u.setUint8(m++, h.getUint8(o++));
          return a
        }
      }),
      n(186)(y)
    },
    function(t, e, i) {
      for (var n, o = i(2), r = i(8), a = i(17), s = a("typed_array"), l = a("view"), c = !(!o.ArrayBuffer || !o.DataView), h = c, u = 0, d = "Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(","); u < 9;)
        (n = o[d[u++]])
          ? (r(n.prototype, s, !0), r(n.prototype, l, !0))
          : h = !1;
      t.exports = {
        ABV: c,
        CONSTR: h,
        TYPED: s,
        VIEW: l
      }
    },
    function(t, e, n) {
      var o = n(2),
        r = n(4),
        a = n(26),
        s = n(232),
        l = n(8),
        c = n(202),
        h = n(5),
        u = n(197),
        d = n(36),
        p = n(35),
        f = n(48).f,
        m = n(9).f,
        g = n(180),
        v = n(22),
        y = "ArrayBuffer",
        E = "DataView",
        x = "prototype",
        b = "Wrong length!",
        w = "Wrong index!",
        C = o[y],
        T = o[E],
        _ = o.Math,
        L = o.RangeError,
        M = o.Infinity,
        S = C,
        O = _.abs,
        D = _.pow,
        R = _.floor,
        U = _.log,
        A = _.LN2,
        I = "buffer",
        P = "byteLength",
        B = "byteOffset",
        N = r
          ? "_b"
          : I,
        k = r
          ? "_l"
          : P,
        H = r
          ? "_o"
          : B,
        F = function(t, e, i) {
          var n,
            o,
            r,
            a = Array(i),
            s = 8 * i - e - 1,
            l = (1 << s) - 1,
            c = l >> 1,
            h = 23 === e
              ? D(2, -24) - D(2, -77)
              : 0,
            u = 0,
            d = t < 0 || 0 === t && 1 / t < 0
              ? 1
              : 0;
          for (
            t = O(t), t != t || t === M
            ? (
              o = t != t
              ? 1
              : 0,
            n = l)
            : (
              n = R(U(t) / A), t * (r = D(2, -n)) < 1 && (n--, r *= 2), t += n + c >= 1
              ? h / r
              : h * D(2, 1 - c),
            t * r >= 2 && (n++, r /= 2),
            n + c >= l
              ? (o = 0, n = l)
              : n + c >= 1
                ? (o = (t * r - 1) * D(2, e), n += c)
                : (o = t * D(2, c - 1) * D(2, e), n = 0)); e >= 8; a[u++] = 255 & o, o /= 256, e -= 8)
          ;
          for (n = n << e | o, s += e; s > 0; a[u++] = 255 & n, n /= 256, s -= 8)
          ;
          return a[--u] |= 128 * d,
          a
        },
        G = function(t, e, i) {
          var n,
            o = 8 * i - e - 1,
            r = (1 << o) - 1,
            a = r >> 1,
            s = o - 7,
            l = i - 1,
            c = t[l--],
            h = 127 & c;
          for (c >>= 7; s > 0; h = 256 * h + t[l], l--, s -= 8)
          ;
          for (n = h & (1 << -s) - 1, h >>= -s, s += e; s > 0; n = 256 * n + t[l], l--, s -= 8)
          ;
          if (0 === h)
            h = 1 - a;
          else {
            if (h === r)
              return n
                ? 0 / 0
                : c
                  ? -M
                  : M;
            n += D(2, e),
            h -= a
          }
          return (
            c
            ? -1
            : 1) * n * D(2, h - e)
        },
        V = function(t) {
          return t[3] << 24 | t[2] << 16 | t[1] << 8 | t[0]
        },
        z = function(t) {
          return [255 & t]
        },
        q = function(t) {
          return [
            255 & t,
            t >> 8 & 255
          ]
        },
        W = function(t) {
          return [
            255 & t,
            t >> 8 & 255,
            t >> 16 & 255,
            t >> 24 & 255
          ]
        },
        j = function(t) {
          return F(t, 52, 8)
        },
        X = function(t) {
          return F(t, 23, 4)
        },
        Y = function(t, e, i) {
          m(t[x], e, {
            get: function() {
              return this[i]
            }
          })
        },
        Z = function(t, e, i, n) {
          var o = + i,
            r = d(o);
          if (o != r || r < 0 || r + e > t[k])
            throw L(w);
          var a = t[N]._b,
            s = r + t[H],
            l = a.slice(s, s + e);
          return n
            ? l
            : l.reverse()
        },
        K = function(t, e, i, n, o, r) {
          var a = + i,
            s = d(a);
          if (a != s || s < 0 || s + e > t[k])
            throw L(w);
          for (var l = t[N]._b, c = s + t[H], h = n(+ o), u = 0; u < e; u++)
            l[c + u] = h[
              r
                ? u
                : e - u - 1
            ]
        },
        Q = function(t, e) {
          u(t, C, y);
          var i = + e,
            n = p(i);
          if (i != n)
            throw L(b);
          return n
        };
      if (s.ABV) {
        if (!h(function() {
          new C
        }) || !h(function() {
          new C(.5)
        })) {
          C = function(t) {
            return new S(Q(this, t))
          };
          for (var J, $ = C[x] = S[x], tt = f(S), et = 0; tt.length > et;)
            (J = tt[et++]) in C || l(C, J, S[J]);
          a || ($.constructor = C)
        }
        var it = new T(new C(2)),
          nt = T[x].setInt8;
        it.setInt8(0, 2147483648),
        it.setInt8(1, 2147483649),
        !it.getInt8(0) && it.getInt8(1) || c(T[x], {
          setInt8: function(t, e) {
            nt.call(this, t, e << 24 >> 24)
          },
          setUint8: function(t, e) {
            nt.call(this, t, e << 24 >> 24)
          }
        }, !0)
      } else
        C = function(t) {
          var e = Q(this, t);
          this._b = g.call(Array(e), 0),
          this[k] = e
        }
      ,
      T = function(t, e, n) {
        u(this, T, E),
        u(t, C, E);
        var o = t[k],
          r = d(e);
        if (r < 0 || r > o)
          throw L("Wrong offset!");
        if (
          n = n === i
          ? o - r
          : p(n),
        r + n > o)
          throw L(b);
        this[N] = t,
        this[H] = r,
        this[k] = n
      },
      r && (Y(C, P, "_l"), Y(T, I, "_b"), Y(T, P, "_l"), Y(T, B, "_o")),
      c(T[x], {
        getInt8: function(t) {
          return Z(this, 1, t)[0] << 24 >> 24
        },
        getUint8: function(t) {
          return Z(this, 1, t)[0]
        },
        getInt16: function(t) {
          var e = Z(this, 2, t, arguments[1]);
          return (e[1] << 8 | e[0]) << 16 >> 16
        },
        getUint16: function(t) {
          var e = Z(this, 2, t, arguments[1]);
          return e[1] << 8 | e[0]
        },
        getInt32: function(t) {
          return V(Z(this, 4, t, arguments[1]))
        },
        getUint32: function(t) {
          return V(Z(this, 4, t, arguments[1])) >>> 0
        },
        getFloat32: function(t) {
          return G(Z(this, 4, t, arguments[1]), 23, 4)
        },
        getFloat64: function(t) {
          return G(Z(this, 8, t, arguments[1]), 52, 8)
        },
        setInt8: function(t, e) {
          K(this, 1, t, z, e)
        },
        setUint8: function(t, e) {
          K(this, 1, t, z, e)
        },
        setInt16: function(t, e) {
          K(this, 2, t, q, e, arguments[2])
        },
        setUint16: function(t, e) {
          K(this, 2, t, q, e, arguments[2])
        },
        setInt32: function(t, e) {
          K(this, 4, t, W, e, arguments[2])
        },
        setUint32: function(t, e) {
          K(this, 4, t, W, e, arguments[2])
        },
        setFloat32: function(t, e) {
          K(this, 4, t, X, e, arguments[2])
        },
        setFloat64: function(t, e) {
          K(this, 8, t, j, e, arguments[2])
        }
      });
      v(C, y),
      v(T, E),
      l(T[x], s.VIEW, !0),
      e[y] = C,
      e[E] = T
    },
    function(t, e, i) {
      var n = i(6);
      n(n.G + n.W + n.F * !i(232).ABV, {DataView: i(233).DataView})
    },
    function(t, e, i) {
      i(236)("Int8", 1, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      })
    },
    function(t, e, n) {
      if (n(4)) {
        var o = n(26),
          r = n(2),
          a = n(5),
          s = n(6),
          l = n(232),
          c = n(233),
          h = n(18),
          u = n(197),
          d = n(15),
          p = n(8),
          f = n(202),
          m = n(36),
          g = n(35),
          v = n(37),
          y = n(14),
          E = n(3),
          x = n(69),
          b = n(73),
          w = n(11),
          C = n(56),
          T = n(154),
          _ = n(44),
          L = n(57),
          M = n(48).f,
          S = n(156),
          O = n(17),
          D = n(23),
          R = n(164),
          U = n(34),
          A = n(199),
          I = n(183),
          P = n(135),
          B = n(157),
          N = n(186),
          k = n(180),
          H = n(177),
          F = n(9),
          G = n(49),
          V = F.f,
          z = G.f,
          q = r.RangeError,
          W = r.TypeError,
          j = r.Uint8Array,
          X = "ArrayBuffer",
          Y = "Shared" + X,
          Z = "BYTES_PER_ELEMENT",
          K = "prototype",
          Q = Array[K],
          J = c.ArrayBuffer,
          $ = c.DataView,
          tt = R(0),
          et = R(2),
          it = R(3),
          nt = R(4),
          ot = R(5),
          rt = R(6),
          at = U(!0),
          st = U(!1),
          lt = I.values,
          ct = I.keys,
          ht = I.entries,
          ut = Q.lastIndexOf,
          dt = Q.reduce,
          pt = Q.reduceRight,
          ft = Q.join,
          mt = Q.sort,
          gt = Q.slice,
          vt = Q.toString,
          yt = Q.toLocaleString,
          Et = D("iterator"),
          xt = D("toStringTag"),
          bt = O("typed_constructor"),
          wt = O("def_constructor"),
          Ct = l.CONSTR,
          Tt = l.TYPED,
          _t = l.VIEW,
          Lt = "Wrong length!",
          Mt = R(1, function(t, e) {
            return At(A(t, t[wt]), e)
          }),
          St = a(function() {
            return 1 === new j(new Uint16Array([1]).buffer)[0]
          }),
          Ot = !!j && !!j[K].set && a(function() {
            new j(1).set({})
          }),
          Dt = function(t, e) {
            if (t === i)
              throw W(Lt);
            var n = + t,
              o = g(t);
            if (e && !x(n, o))
              throw q(Lt);
            return o
          },
          Rt = function(t, e) {
            var i = m(t);
            if (i < 0 || i % e)
              throw q("Wrong offset!");
            return i
          },
          Ut = function(t) {
            if (w(t) && Tt in t)
              return t;
            throw W(t + " is not a typed array!")
          },
          At = function(t, e) {
            if (!(w(t) && bt in t))
              throw W("It is not a typed array constructor!");
            return new t(e)
          },
          It = function(t, e) {
            return Pt(A(t, t[wt]), e)
          },
          Pt = function(t, e) {
            for (var i = 0, n = e.length, o = At(t, n); n > i;)
              o[i] = e[i++];
            return o
          },
          Bt = function(t, e, i) {
            V(t, e, {
              get: function() {
                return this._d[i]
              }
            })
          },
          Nt = function(t) {
            var e,
              n,
              o,
              r,
              a,
              s,
              l = C(t),
              c = arguments.length,
              u = c > 1
                ? arguments[1]
                : i,
              d = u !== i,
              p = S(l);
            if (p != i && !T(p)) {
              for (s = p.call(l), o = [], e = 0; !(a = s.next()).done; e++)
                o.push(a.value);
              l = o
            }
            for (d && c > 2 && (u = h(u, arguments[2], 2)), e = 0, n = g(l.length), r = At(this, n); n > e; e++)
              r[e] = d
                ? u(l[e], e)
                : l[e];
            return r
          },
          kt = function() {
            for (var t = 0, e = arguments.length, i = At(this, e); e > t;)
              i[t] = arguments[t++];
            return i
          },
          Ht = !!j && a(function() {
            yt.call(new j(1))
          }),
          Ft = function() {
            return yt.apply(
              Ht
              ? gt.call(Ut(this))
              : Ut(this),
            arguments)
          },
          Gt = {
            copyWithin: function(t, e) {
              return H.call(
                Ut(this), t, e, arguments.length > 2
                ? arguments[2]
                : i)
            },
            every: function(t) {
              return nt(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i)
            },
            fill: function(t) {
              return k.apply(Ut(this), arguments)
            },
            filter: function(t) {
              return It(this, et(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i))
            },
            find: function(t) {
              return ot(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i)
            },
            findIndex: function(t) {
              return rt(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i)
            },
            forEach: function(t) {
              tt(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i)
            },
            indexOf: function(t) {
              return st(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i)
            },
            includes: function(t) {
              return at(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i)
            },
            join: function(t) {
              return ft.apply(Ut(this), arguments)
            },
            lastIndexOf: function(t) {
              return ut.apply(Ut(this), arguments)
            },
            map: function(t) {
              return Mt(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i)
            },
            reduce: function(t) {
              return dt.apply(Ut(this), arguments)
            },
            reduceRight: function(t) {
              return pt.apply(Ut(this), arguments)
            },
            reverse: function() {
              for (var t, e = this, i = Ut(e).length, n = Math.floor(i / 2), o = 0; o < n;)
                t = e[o],
                e[o++] = e[--i],
                e[i] = t;
              return e
            },
            some: function(t) {
              return it(
                Ut(this), t, arguments.length > 1
                ? arguments[1]
                : i)
            },
            sort: function(t) {
              return mt.call(Ut(this), t)
            },
            subarray: function(t, e) {
              var n = Ut(this),
                o = n.length,
                r = v(t, o);
              return new(A(n, n[wt]))(n.buffer, n.byteOffset + r * n.BYTES_PER_ELEMENT, g((
                e === i
                ? o
                : v(e, o)) - r))
            }
          },
          Vt = function(t, e) {
            return It(this, gt.call(Ut(this), t, e))
          },
          zt = function(t) {
            Ut(this);
            var e = Rt(arguments[1], 1),
              i = this.length,
              n = C(t),
              o = g(n.length),
              r = 0;
            if (o + e > i)
              throw q(Lt);
            for (; r < o;)
              this[e + r] = n[r++]
          },
          qt = {
            entries: function() {
              return ht.call(Ut(this))
            },
            keys: function() {
              return ct.call(Ut(this))
            },
            values: function() {
              return lt.call(Ut(this))
            }
          },
          Wt = function(t, e) {
            return w(t) && t[Tt] && "symbol" != (
              void 0 === e
              ? "undefined"
              : _typeof(e)) && e in t && String(+ e) == String(e)
          },
          jt = function(t, e) {
            return Wt(t, e = y(e, !0))
              ? d(2, t[e])
              : z(t, e)
          },
          Xt = function(t, e, i) {
            return !(Wt(t, e = y(e, !0)) && w(i) && E(i, "value")) || E(i, "get") || E(i, "set") || i.configurable || E(i, "writable") && !i.writable || E(i, "enumerable") && !i.enumerable
              ? V(t, e, i)
              : (t[e] = i.value, t)
          };
        Ct || (G.f = jt, F.f = Xt),
        s(s.S + s.F * !Ct, "Object", {
          getOwnPropertyDescriptor: jt,
          defineProperty: Xt
        }),
        a(function() {
          vt.call({})
        }) && (vt = yt = function() {
          return ft.call(this)
        });
        var Yt = f({}, Gt);
        f(Yt, qt),
        p(Yt, Et, qt.values),
        f(Yt, {
          slice: Vt,
          set: zt,
          constructor: function() {},
          toString: vt,
          toLocaleString: Ft
        }),
        Bt(Yt, "buffer", "b"),
        Bt(Yt, "byteOffset", "o"),
        Bt(Yt, "byteLength", "l"),
        Bt(Yt, "length", "e"),
        V(Yt, xt, {
          get: function() {
            return this[Tt]
          }
        }),
        t.exports = function(t, e, n, c) {
          c = !!c;
          var h = t + (
              c
              ? "Clamped"
              : "") + "Array",
            d = "Uint8Array" != h,
            f = "get" + t,
            m = "set" + t,
            v = r[h],
            y = v || {},
            E = v && L(v),
            x = !v || !l.ABV,
            C = {},
            T = v && v[K],
            S = function(t, i) {
              var n = t._d;
              return n.v[f](i * e + n.o, St)
            },
            O = function(t, i, n) {
              var o = t._d;
              c && (
                n = (n = Math.round(n)) < 0
                ? 0
                : n > 255
                  ? 255
                  : 255 & n),
              o.v[m](i * e + o.o, n, St)
            },
            D = function(t, e) {
              V(t, e, {
                get: function() {
                  return S(this, e)
                },
                set: function(t) {
                  return O(this, e, t)
                },
                enumerable: !0
              })
            };
          x
            ? (v = n(function(t, n, o, r) {
              u(t, v, h, "_d");
              var a,
                s,
                l,
                c,
                d = 0,
                f = 0;
              if (w(n)) {
                if (!(n instanceof J || (c = b(n)) == X || c == Y))
                  return Tt in n
                    ? Pt(v, n)
                    : Nt.call(v, n);
                a = n,
                f = Rt(o, e);
                var m = n.byteLength;
                if (r === i) {
                  if (m % e)
                    throw q(Lt);
                  if ((s = m - f) < 0)
                    throw q(Lt)
                } else if ((s = g(r) * e) + f > m)
                  throw q(Lt);
                l = s / e
              } else
                l = Dt(n, !0),
                s = l * e,
                a = new J(s);
              for (p(t, "_d", {
                b: a,
                o: f,
                l: s,
                e: l,
                v: new $(a)
              }); d < l;)
                D(t, d++)
            }), T = v[K] = _(Yt), p(T, "constructor", v))
            : B(function(t) {
              new v(null),
              new v(t)
            }, !0) || (v = n(function(t, n, o, r) {
              u(t, v, h);
              var a;
              return w(n)
                ? n instanceof J || (a = b(n)) == X || a == Y
                  ? r !== i
                    ? new y(n, Rt(o, e), r)
                    : o !== i
                      ? new y(n, Rt(o, e))
                      : new y(n)
                  : Tt in n
                    ? Pt(v, n)
                    : Nt.call(v, n)
                : new y(Dt(n, d))
            }), tt(
              E !== Function.prototype
              ? M(y).concat(M(E))
              : M(y),
            function(t) {
              t in v || p(v, t, y[t])
            }), v[K] = T, o || (T.constructor = v));
          var R = T[Et],
            U = !!R && ("values" == R.name || R.name == i),
            A = qt.values;
          p(v, bt, !0),
          p(T, Tt, h),
          p(T, _t, !0),
          p(T, wt, v),
          (
            c
            ? new v(1)[xt] == h
            : xt in T) || V(T, xt, {
            get: function() {
              return h
            }
          }),
          C[h] = v,
          s(s.G + s.W + s.F * (v != y), C),
          s(s.S, h, {
            BYTES_PER_ELEMENT: e,
            from: Nt,
            of: kt
          }),
          Z in T || p(T, Z, e),
          s(s.P, h, Gt),
          N(h),
          s(s.P + s.F * Ot, h, {set: zt}),
          s(s.P + s.F * !U, h, qt),
          s(s.P + s.F * (T.toString != vt), h, {toString: vt}),
          s(s.P + s.F * a(function() {
            new v(1).slice()
          }), h, {slice: Vt}),
          s(s.P + s.F * (a(function() {
            return [1, 2].toLocaleString() != new v([1, 2]).toLocaleString()
          }) || !a(function() {
            T.toLocaleString.call([1, 2])
          })), h, {toLocaleString: Ft}),
          P[h] = U
            ? R
            : A,
          o || U || p(T, Et, A)
        }
      } else
        t.exports = function() {}
      },
    function(t, e, i) {
      i(236)("Uint8", 1, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      })
    },
    function(t, e, i) {
      i(236)("Uint8", 1, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      }, !0)
    },
    function(t, e, i) {
      i(236)("Int16", 2, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      })
    },
    function(t, e, i) {
      i(236)("Uint16", 2, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      })
    },
    function(t, e, i) {
      i(236)("Int32", 4, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      })
    },
    function(t, e, i) {
      i(236)("Uint32", 4, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      })
    },
    function(t, e, i) {
      i(236)("Float32", 4, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      })
    },
    function(t, e, i) {
      i(236)("Float64", 8, function(t) {
        return function(e, i, n) {
          return t(this, e, i, n)
        }
      })
    },
    function(t, e, n) {
      var o = n(6),
        r = n(34)(!0);
      o(o.P, "Array", {
        includes: function(t) {
          return r(
            this, t, arguments.length > 1
            ? arguments[1]
            : i)
        }
      }),
      n(178)("includes")
    },
    function(t, e, i) {
      var n = i(6),
        o = i(125)(!0);
      n(n.P, "String", {
        at: function(t) {
          return o(this, t)
        }
      })
    },
    function(t, e, n) {
      var o = n(6),
        r = n(248);
      o(o.P, "String", {
        padStart: function(t) {
          return r(
            this, t, arguments.length > 1
            ? arguments[1]
            : i,
          !0)
        }
      })
    },
    function(t, e, n) {
      var o = n(35),
        r = n(85),
        a = n(33);
      t.exports = function(t, e, n, s) {
        var l = String(a(t)),
          c = l.length,
          h = n === i
            ? " "
            : String(n),
          u = o(e);
        if (u <= c || "" == h)
          return l;
        var d = u - c,
          p = r.call(h, Math.ceil(d / h.length));
        return p.length > d && (p = p.slice(0, d)),
        s
          ? p + l
          : l + p
      }
    },
    function(t, e, n) {
      var o = n(6),
        r = n(248);
      o(o.P, "String", {
        padEnd: function(t) {
          return r(
            this, t, arguments.length > 1
            ? arguments[1]
            : i,
          !1)
        }
      })
    },
    function(t, e, i) {
      i(81)("trimLeft", function(t) {
        return function() {
          return t(this, 1)
        }
      }, "trimStart")
    },
    function(t, e, i) {
      i(81)("trimRight", function(t) {
        return function() {
          return t(this, 2)
        }
      }, "trimEnd")
    },
    function(t, e, i) {
      var n = i(6),
        o = i(33),
        r = i(35),
        a = i(128),
        s = i(188),
        l = RegExp.prototype,
        c = function(t, e) {
          this._r = t,
          this._s = e
        };
      i(136)(c, "RegExp String", function() {
        var t = this._r.exec(this._s);
        return {
          value: t,
          done: null === t
        }
      }),
      n(n.P, "String", {
        matchAll: function(t) {
          if (o(this), !a(t))
            throw TypeError(t + " is not a regexp!");
          var e = String(this),
            i = "flags" in l
              ? String(t.flags)
              : s.call(t),
            n = new RegExp(
              t.source, ~ i.indexOf("g")
              ? i
              : "g" + i);
          return n.lastIndex = r(t.lastIndex),
          new c(n, e)
        }
      })
    },
    function(t, e, i) {
      i(25)("asyncIterator")
    },
    function(t, e, i) {
      i(25)("observable")
    },
    function(t, e, i) {
      var n = i(6),
        o = i(221),
        r = i(30),
        a = i(49),
        s = i(155);
      n(n.S, "Object", {
        getOwnPropertyDescriptors: function(t) {
          for (var e, i = r(t), n = a.f, l = o(i), c = {}, h = 0; l.length > h;)
            s(c, e = l[h++], n(i, e));
          return c
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(257)(!1);
      n(n.S, "Object", {
        values: function(t) {
          return o(t)
        }
      })
    },
    function(t, e, i) {
      var n = i(28),
        o = i(30),
        r = i(42).f;
      t.exports = function(t) {
        return function(e) {
          for (var i, a = o(e), s = n(a), l = s.length, c = 0, h = []; l > c;)
            r.call(a, i = s[c++]) && h.push(
              t
              ? [
                i, a[i]
              ]
              : a[i]);
          return h
        }
      }
    },
    function(t, e, i) {
      var n = i(6),
        o = i(257)(!0);
      n(n.S, "Object", {
        entries: function(t) {
          return o(t)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(56),
        r = i(19),
        a = i(9);
      i(4) && n(n.P + i(260), "Object", {
        __defineGetter__: function(t, e) {
          a.f(o(this), t, {
            get: r(e),
            enumerable: !0,
            configurable: !0
          })
        }
      })
    },
    function(t, e, i) {
      t.exports = i(26) || !i(5)(function() {
        var t = Math.random();
        __defineSetter__.call(null, t, function() {}),
        delete i(2)[t]
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(56),
        r = i(19),
        a = i(9);
      i(4) && n(n.P + i(260), "Object", {
        __defineSetter__: function(t, e) {
          a.f(o(this), t, {
            set: r(e),
            enumerable: !0,
            configurable: !0
          })
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(56),
        r = i(14),
        a = i(57),
        s = i(49).f;
      i(4) && n(n.P + i(260), "Object", {
        __lookupGetter__: function(t) {
          var e,
            i = o(this),
            n = r(t, !0);
          do {
            if (e = s(i, n))
              return e.get
          } while (i = a(i))
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(56),
        r = i(14),
        a = i(57),
        s = i(49).f;
      i(4) && n(n.P + i(260), "Object", {
        __lookupSetter__: function(t) {
          var e,
            i = o(this),
            n = r(t, !0);
          do {
            if (e = s(i, n))
              return e.set
          } while (i = a(i))
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.P + n.R, "Map", {
        toJSON: i(265)("Map")
      })
    },
    function(t, e, i) {
      var n = i(73),
        o = i(266);
      t.exports = function(t) {
        return function() {
          if (n(this) != t)
            throw TypeError(t + "#toJSON isn't generic");
          return o(this)
        }
      }
    },
    function(t, e, i) {
      var n = i(198);
      t.exports = function(t, e) {
        var i = [];
        return n(t, !1, i.push, i, e),
        i
      }
    },
    function(t, e, i) {
      var n = i(6);
      n(n.P + n.R, "Set", {
        toJSON: i(265)("Set")
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "System", {global: i(2)})
    },
    function(t, e, i) {
      var n = i(6),
        o = i(32);
      n(n.S, "Error", {
        isError: function(t) {
          return "Error" === o(t)
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {
        iaddh: function(t, e, i, n) {
          var o = t >>> 0,
            r = e >>> 0,
            a = i >>> 0;
          return r + (n >>> 0) + ((o & a | (o | a) &~ (o + a >>> 0)) >>> 31) | 0
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {
        isubh: function(t, e, i, n) {
          var o = t >>> 0,
            r = e >>> 0,
            a = i >>> 0;
          return r - (n >>> 0) - ((~ o & a |~ (o ^ a) & o - a >>> 0) >>> 31) | 0
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {
        imulh: function(t, e) {
          var i = 65535,
            n = + t,
            o = + e,
            r = n & i,
            a = o & i,
            s = n >> 16,
            l = o >> 16,
            c = (s * a >>> 0) + (r * a >>> 16);
          return s * l + (c >> 16) + ((r * l >>> 0) + (c & i) >> 16)
        }
      })
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S, "Math", {
        umulh: function(t, e) {
          var i = 65535,
            n = + t,
            o = + e,
            r = n & i,
            a = o & i,
            s = n >>> 16,
            l = o >>> 16,
            c = (s * a >>> 0) + (r * a >>> 16);
          return s * l + (c >>> 16) + ((r * l >>> 0) + (c & i) >>> 16)
        }
      })
    },
    function(t, e, i) {
      var n = i(275),
        o = i(10),
        r = n.key,
        a = n.set;
      n.exp({
        defineMetadata: function(t, e, i, n) {
          a(t, e, o(i), r(n))
        }
      })
    },
    function(t, e, n) {
      var o = n(203),
        r = n(6),
        a = n(21)("metadata"),
        s = a.store || (a.store = new(n(207))),
        l = function(t, e, n) {
          var r = s.get(t);
          if (!r) {
            if (!n)
              return i;
            s.set(t, r = new o)
          }
          var a = r.get(e);
          if (!a) {
            if (!n)
              return i;
            r.set(e, a = new o)
          }
          return a
        },
        c = function(t, e, n) {
          var o = l(e, n, !1);
          return o !== i && o.has(t)
        },
        h = function(t, e, n) {
          var o = l(e, n, !1);
          return o === i
            ? i
            : o.get(t)
        },
        u = function(t, e, i, n) {
          l(i, n, !0).set(t, e)
        },
        d = function(t, e) {
          var i = l(t, e, !1),
            n = [];
          return i && i.forEach(function(t, e) {
            n.push(e)
          }),
          n
        },
        p = function(t) {
          return t === i || "symbol" == (
            void 0 === t
            ? "undefined"
            : _typeof(t))
            ? t
            : String(t)
        },
        f = function(t) {
          r(r.S, "Reflect", t)
        };
      t.exports = {
        store: s,
        map: l,
        has: c,
        get: h,
        set: u,
        keys: d,
        key: p,
        exp: f
      }
    },
    function(t, e, n) {
      var o = n(275),
        r = n(10),
        a = o.key,
        s = o.map,
        l = o.store;
      o.exp({
        deleteMetadata: function(t, e) {
          var n = arguments.length < 3
              ? i
              : a(arguments[2]),
            o = s(r(e), n, !1);
          if (o === i || !o.delete(t))
            return !1;
          if (o.size)
            return !0;
          var c = l.get(e);
          return c.delete(n),
          !!c.size || l.delete(e)
        }
      })
    },
    function(t, e, n) {
      var o = n(275),
        r = n(10),
        a = n(57),
        s = o.has,
        l = o.get,
        c = o.key,
        h = function t(e, n, o) {
          if (s(e, n, o))
            return l(e, n, o);
          var r = a(n);
          return null !== r
            ? t(e, r, o)
            : i
        };
      o.exp({
        getMetadata: function(t, e) {
          return h(
            t, r(e), arguments.length < 3
            ? i
            : c(arguments[2]))
        }
      })
    },
    function(t, e, n) {
      var o = n(206),
        r = n(266),
        a = n(275),
        s = n(10),
        l = n(57),
        c = a.keys,
        h = a.key,
        u = function t(e, i) {
          var n = c(e, i),
            a = l(e);
          if (null === a)
            return n;
          var s = t(a, i);
          return s.length
            ? n.length
              ? r(new o(n.concat(s)))
              : s
            : n
        };
      a.exp({
        getMetadataKeys: function(t) {
          return u(
            s(t), arguments.length < 2
            ? i
            : h(arguments[1]))
        }
      })
    },
    function(t, e, n) {
      var o = n(275),
        r = n(10),
        a = o.get,
        s = o.key;
      o.exp({
        getOwnMetadata: function(t, e) {
          return a(
            t, r(e), arguments.length < 3
            ? i
            : s(arguments[2]))
        }
      })
    },
    function(t, e, n) {
      var o = n(275),
        r = n(10),
        a = o.keys,
        s = o.key;
      o.exp({
        getOwnMetadataKeys: function(t) {
          return a(
            r(t), arguments.length < 2
            ? i
            : s(arguments[1]))
        }
      })
    },
    function(t, e, n) {
      var o = n(275),
        r = n(10),
        a = n(57),
        s = o.has,
        l = o.key,
        c = function t(e, i, n) {
          if (s(e, i, n))
            return !0;
          var o = a(i);
          return null !== o && t(e, o, n)
        };
      o.exp({
        hasMetadata: function(t, e) {
          return c(
            t, r(e), arguments.length < 3
            ? i
            : l(arguments[2]))
        }
      })
    },
    function(t, e, n) {
      var o = n(275),
        r = n(10),
        a = o.has,
        s = o.key;
      o.exp({
        hasOwnMetadata: function(t, e) {
          return a(
            t, r(e), arguments.length < 3
            ? i
            : s(arguments[2]))
        }
      })
    },
    function(t, e, n) {
      var o = n(275),
        r = n(10),
        a = n(19),
        s = o.key,
        l = o.set;
      o.exp({
        metadata: function(t, e) {
          return function(n, o) {
            l(t, e, (
              o !== i
              ? r
              : a)(n), s(o))
          }
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(201)(),
        r = i(2).process,
        a = "process" == i(32)(r);
      n(n.G, {
        asap: function(t) {
          var e = a && r.domain;
          o(
            e
            ? e.bind(t)
            : t)
        }
      })
    },
    function(t, e, n) {
      var o = n(6),
        r = n(2),
        a = n(7),
        s = n(201)(),
        l = n(23)("observable"),
        c = n(19),
        h = n(10),
        u = n(197),
        d = n(202),
        p = n(8),
        f = n(198),
        m = f.RETURN,
        g = function(t) {
          return null == t
            ? i
            : c(t)
        },
        v = function(t) {
          var e = t._c;
          e && (t._c = i, e())
        },
        y = function(t) {
          return t._o === i
        },
        E = function(t) {
          y(t) || (t._o = i, v(t))
        },
        x = function(t, e) {
          h(t),
          this._c = i,
          this._o = t,
          t = new b(this);
          try {
            var n = e(t),
              o = n;
            null != n && (
              "function" == typeof n.unsubscribe
              ? n = function() {
                o.unsubscribe()
              }
              : c(n),
            this._c = n)
          } catch (e) {
            return void t.error(e)
          }
          y(this) && v(this)
        };
      x.prototype = d({}, {
        unsubscribe: function() {
          E(this)
        }
      });
      var b = function(t) {
        this._s = t
      };
      b.prototype = d({}, {
        next: function(t) {
          var e = this._s;
          if (!y(e)) {
            var i = e._o;
            try {
              var n = g(i.next);
              if (n)
                return n.call(i, t)
            } catch (t) {
              try {
                E(e)
              } finally {
                throw t
              }
            }
          }
        },
        error: function(t) {
          var e = this._s;
          if (y(e))
            throw t;
          var n = e._o;
          e._o = i;
          try {
            var o = g(n.error);
            if (!o)
              throw t;
            t = o.call(n, t)
          } catch (t) {
            try {
              v(e)
            } finally {
              throw t
            }
          }
          return v(e),
          t
        },
        complete: function(t) {
          var e = this._s;
          if (!y(e)) {
            var n = e._o;
            e._o = i;
            try {
              var o = g(n.complete);
              t = o
                ? o.call(n, t)
                : i
            } catch (t) {
              try {
                v(e)
              } finally {
                throw t
              }
            }
            return v(e),
            t
          }
        }
      });
      var w = function(t) {
        u(this, w, "Observable", "_f")._f = c(t)
      };
      d(w.prototype, {
        subscribe: function(t) {
          return new x(t, this._f)
        },
        forEach: function(t) {
          var e = this;
          return new(a.Promise || r.Promise)(function(i, n) {
            c(t);
            var o = e.subscribe({
              next: function(e) {
                try {
                  return t(e)
                } catch (t) {
                  n(t),
                  o.unsubscribe()
                }
              },
              error: n,
              complete: i
            })
          })
        }
      }),
      d(w, {
        from: function(t) {
          var e = "function" == typeof this
              ? this
              : w,
            i = g(h(t)[l]);
          if (i) {
            var n = h(i.call(t));
            return n.constructor === e
              ? n
              : new e(function(t) {
                return n.subscribe(t)
              })
          }
          return new e(function(e) {
            var i = !1;
            return s(function() {
              if (!i) {
                try {
                  if (f(t, !1, function(t) {
                    if (e.next(t), i)
                      return m
                  }) === m)
                    return
                } catch (t) {
                  if (i)
                    throw t;
                  return void e.error(t)
                }
                e.complete()
              }
            }),
            function() {
              i = !0
            }
          })
        },
        of: function() {
          for (var t = 0, e = arguments.length, i = Array(e); t < e;)
            i[t] = arguments[t++];
          return new(
            "function" == typeof this
            ? this
            : w)(function(t) {
            var e = !1;
            return s(function() {
              if (!e) {
                for (var n = 0; n < i.length; ++n)
                  if (t.next(i[n]), e)
                    return;
              t.complete()
              }
            }),
            function() {
              e = !0
            }
          })
        }
      }),
      p(w.prototype, l, function() {
        return this
      }),
      o(o.G, {Observable: w}),
      n(186)("Observable")
    },
    function(t, e, i) {
      var n = i(6),
        o = i(200);
      n(n.G + n.B, {
        setImmediate: o.set,
        clearImmediate: o.clear
      })
    },
    function(t, e, i) {
      for (var n = i(183), o = i(16), r = i(2), a = i(8), s = i(135), l = i(23), c = l("iterator"), h = l("toStringTag"), u = s.Array, d = [
        "NodeList", "DOMTokenList", "MediaList", "StyleSheetList", "CSSRuleList"
      ], p = 0; p < 5; p++) {
        var f,
          m = d[p],
          g = r[m],
          v = g && g.prototype;
        if (v) {
          v[c] || a(v, c, u),
          v[h] || a(v, h, m),
          s[m] = u;
          for (f in n)
            v[f] || o(v, f, n[f], !0)
        }
      }
    },
    function(t, e, i) {
      var n = i(2),
        o = i(6),
        r = i(76),
        a = i(289),
        s = n.navigator,
        l = !!s && /MSIE .\./.test(s.userAgent),
        c = function(t) {
          return l
            ? function(e, i) {
              return t(r(
                a, [].slice.call(arguments, 2), "function" == typeof e
                ? e
                : Function(e)), i)
            }
            : t
        };
      o(o.G + o.B + o.F * l, {
        setTimeout: c(n.setTimeout),
        setInterval: c(n.setInterval)
      })
    },
    function(t, e, i) {
      var n = i(290),
        o = i(76),
        r = i(19);
      t.exports = function() {
        for (var t = r(this), e = arguments.length, i = Array(e), a = 0, s = n._, l = !1; e > a;)
          (i[a] = arguments[a++]) === s && (l = !0);
        return function() {
          var n,
            r = this,
            a = arguments.length,
            c = 0,
            h = 0;
          if (!l && !a)
            return o(t, i, r);
          if (n = i.slice(), l)
            for (; e > c; c++)
              n[c] === s && (n[c] = arguments[h++]);
        for (; a > h;)
            n.push(arguments[h++]);
          return o(t, n, r)
        }
      }
    },
    function(t, e, i) {
      t.exports = i(2)
    },
    function(t, e, n) {
      function o(t) {
        var e = f(null);
        return t != i && (
          b(t)
          ? x(t, !0, function(t, i) {
            e[t] = i
          })
          : p(e, t)),
        e
      }
      function r(t, e, i) {
        E(e);
        var n,
          o,
          r = _(t),
          a = g(r),
          s = a.length,
          l = 0;
        if (arguments.length < 3) {
          if (!s)
            throw TypeError("Reduce of empty object with no initial value");
          n = r[a[l++]]
        } else
          n = Object(i);
        for (; s > l;)
          M(r, o = a[l++]) && (n = e(n, r[o], o, t));
        return n
      }
      function a(t, e) {
        return (
          e == e
          ? y(t, e)
          : O(t, function(t) {
            return t != t
          })) !== i
      }
      function s(t, e) {
        if (M(t, e))
          return t[e]
      }
      function l(t, e, i) {
        return L && e in Object
          ? v.f(t, e, d(0, i))
          : t[e] = i,
        t
      }
      function c(t) {
        return T(t) && m(t) === o.prototype
      }
      var h = n(18),
        u = n(6),
        d = n(15),
        p = n(67),
        f = n(44),
        m = n(57),
        g = n(28),
        v = n(9),
        y = n(27),
        E = n(19),
        x = n(198),
        b = n(292),
        w = n(136),
        C = n(184),
        T = n(11),
        _ = n(30),
        L = n(4),
        M = n(3),
        S = function(t) {
          var e = 1 == t,
            n = 4 == t;
          return function(r, a, s) {
            var l,
              c,
              u,
              d = h(a, s, 3),
              p = _(r),
              f = e || 7 == t || 2 == t
                ? new(
                  "function" == typeof this
                  ? this
                  : o)
                : i;
            for (l in p)
              if (M(p, l) && (c = p[l], u = d(c, l, r), t))
                if (e)
                  f[l] = u;
                else if (u)
                  switch (t) {
                    case 2:
                      f[l] = c;
                      break;
                    case 3:
                      return !0;
                    case 5:
                      return c;
                    case 6:
                      return l;
                    case 7:
                      f[u[0]] = u[1]
                  }
                else if (n)
              return !1;
            return 3 == t || n
              ? n
              : f
          }
        },
        O = S(6),
        D = function(t) {
          return function(e) {
            return new R(e, t)
          }
        },
        R = function(t, e) {
          this._t = _(t),
          this._a = g(t),
          this._i = 0,
          this._k = e
        };
      w(R, "Dict", function() {
        var t,
          e = this,
          n = e._t,
          o = e._a,
          r = e._k;
        do {
          if (e._i >= o.length)
            return e._t = i,
            C(1)
        } while (!M(n, t = o[e._i++]));
        return "keys" == r
          ? C(0, t)
          : "values" == r
            ? C(0, n[t])
            : C(0, [
              t, n[t]
            ])
      }),
      o.prototype = null,
      u(u.G + u.F, {Dict: o}),
      u(u.S, "Dict", {
        keys: D("keys"),
        values: D("values"),
        entries: D("entries"),
        forEach: S(0),
        map: S(1),
        filter: S(2),
        some: S(3),
        every: S(4),
        find: S(5),
        findKey: O,
        mapPairs: S(7),
        reduce: r,
        keyOf: y,
        includes: a,
        has: M,
        get: s,
        set: l,
        isDict: c
      })
    },
    function(t, e, n) {
      var o = n(73),
        r = n(23)("iterator"),
        a = n(135);
      t.exports = n(7).isIterable = function(t) {
        var e = Object(t);
        return e[r] !== i || "@@iterator" in e || a.hasOwnProperty(o(e))
      }
    },
    function(t, e, i) {
      var n = i(10),
        o = i(156);
      t.exports = i(7).getIterator = function(t) {
        var e = o(t);
        if ("function" != typeof e)
          throw TypeError(t + " is not iterable!");
        return n(e.call(t))
      }
    },
    function(t, e, i) {
      var n = i(2),
        o = i(7),
        r = i(6),
        a = i(289);
      r(r.G + r.F, {
        delay: function(t) {
          return new(o.Promise || n.Promise)(function(e) {
            setTimeout(a.call(e, !0), t)
          })
        }
      })
    },
    function(t, e, i) {
      var n = i(290),
        o = i(6);
      i(7)._ = n._ = n._ || {},
      o(o.P + o.F, "Function", {part: i(289)})
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S + n.F, "Object", {isObject: i(11)})
    },
    function(t, e, i) {
      var n = i(6);
      n(n.S + n.F, "Object", {classof: i(73)})
    },
    function(t, e, i) {
      var n = i(6),
        o = i(299);
      n(n.S + n.F, "Object", {define: o})
    },
    function(t, e, i) {
      var n = i(9),
        o = i(49),
        r = i(221),
        a = i(30);
      t.exports = function(t, e) {
        for (var i, s = r(a(e)), l = s.length, c = 0; l > c;)
          n.f(t, i = s[c++], o.f(e, i));
        return t
      }
    },
    function(t, e, i) {
      var n = i(6),
        o = i(299),
        r = i(44);
      n(n.S + n.F, "Object", {
        make: function(t, e) {
          return o(r(t), e)
        }
      })
    },
    function(t, e, n) {
      n(134)(Number, "Number", function(t) {
        this._l = + t,
        this._i = 0
      }, function() {
        var t = this._i++,
          e = !(t < this._l);
        return {
          done: e,
          value: e
            ? i
            : t
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(303)(/[\\^$*+?.()|[\]{}]/g, "\\$&");
      n(n.S, "RegExp", {
        escape: function(t) {
          return o(t)
        }
      })
    },
    function(t, e) {
      t.exports = function(t, e) {
        var i = e === Object(e)
          ? function(t) {
            return e[t]
          }
          : e;
        return function(e) {
          return String(e).replace(t, i)
        }
      }
    },
    function(t, e, i) {
      var n = i(6),
        o = i(303)(/[&<>"']/g, {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&apos;"
        });
      n(n.P + n.F, "String", {
        escapeHTML: function() {
          return o(this)
        }
      })
    },
    function(t, e, i) {
      var n = i(6),
        o = i(303)(/&(?:amp|lt|gt|quot|apos);/g, {
          "&amp;": "&",
          "&lt;": "<",
          "&gt;": ">",
          "&quot;": '"',
          "&apos;": "'"
        });
      n(n.P + n.F, "String", {
        unescapeHTML: function() {
          return o(this)
        }
      })
    }
  ]),
  "undefined" != typeof module && module.exports
    ? module.exports = t
    : "function" == typeof define && define.amd
      ? define(function() {
        return t
      })
      : e.core = t
}(1, 1), function(t, e) {
  "object" === (
    "undefined" == typeof exports
    ? "undefined"
    : _typeof(exports)) && "undefined" != typeof module
    ? e(exports)
    : "function" == typeof define && define.amd
      ? define(["exports"], e)
      : e(t.THREE = t.THREE || {})
}(window, function(t) {
  function e() {}
  function i(t, e) {
    this.x = t || 0,
    this.y = e || 0
  }
  function n(t, e, o, r, a, s, l, c, h, u) {
    Object.defineProperty(this, "id", {
      value: vs++
    }),
    this.uuid = gs.generateUUID(),
    this.name = "",
    this.image = void 0 !== t
      ? t
      : n.DEFAULT_IMAGE,
    this.mipmaps = [],
    this.mapping = void 0 !== e
      ? e
      : n.DEFAULT_MAPPING,
    this.wrapS = void 0 !== o
      ? o
      : Ea,
    this.wrapT = void 0 !== r
      ? r
      : Ea,
    this.magFilter = void 0 !== a
      ? a
      : Ta,
    this.minFilter = void 0 !== s
      ? s
      : La,
    this.anisotropy = void 0 !== h
      ? h
      : 1,
    this.format = void 0 !== l
      ? l
      : Ga,
    this.type = void 0 !== c
      ? c
      : Ma,
    this.offset = new i(0, 0),
    this.repeat = new i(1, 1),
    this.rotateMatrix = new et,
    this.generateMipmaps = !0,
    this.premultiplyAlpha = !1,
    this.flipY = !0,
    this.unpackAlignment = 4,
    this.encoding = void 0 !== u
      ? u
      : ss,
    this.version = 0,
    this.onUpdate = null
  }
  function o(t, e, i, n) {
    this.x = t || 0,
    this.y = e || 0,
    this.z = i || 0,
    this.w = void 0 !== n
      ? n
      : 1
  }
  function r(t, e, i) {
    this.uuid = gs.generateUUID(),
    this.width = t,
    this.height = e,
    this.scissor = new o(0, 0, t, e),
    this.scissorTest = !1,
    this.viewport = new o(0, 0, t, e),
    i = i || {},
    void 0 === i.minFilter && (i.minFilter = Ta),
    this.texture = new n(void 0, void 0, i.wrapS, i.wrapT, i.magFilter, i.minFilter, i.format, i.type, i.anisotropy, i.encoding),
    this.depthBuffer = void 0 === i.depthBuffer || i.depthBuffer,
    this.stencilBuffer = void 0 === i.stencilBuffer || i.stencilBuffer,
    this.depthTexture = void 0 !== i.depthTexture
      ? i.depthTexture
      : null
  }
  function a(t, e, i) {
    r.call(this, t, e, i),
    this.activeCubeFace = 0,
    this.activeMipMapLevel = 0
  }
  function s(t, e, i, n) {
    this._x = t || 0,
    this._y = e || 0,
    this._z = i || 0,
    this._w = void 0 !== n
      ? n
      : 1
  }
  function l(t, e, i) {
    this.x = t || 0,
    this.y = e || 0,
    this.z = i || 0
  }
  function c() {
    this.elements = new Float32Array([
      1,
      0,
      0,
      0,
      0,
      1,
      0,
      0,
      0,
      0,
      1,
      0,
      0,
      0,
      0,
      1
    ]),
    arguments.length > 0 && console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")
  }
  function h(t, e, i, o, r, a, s, l, c, h, u, d) {
    n.call(this, null, a, s, l, c, h, o, r, u, d),
    this.image = {
      data: t,
      width: e,
      height: i
    },
    this.magFilter = void 0 !== c
      ? c
      : ba,
    this.minFilter = void 0 !== h
      ? h
      : ba,
    this.generateMipmaps = !1,
    this.flipY = !1,
    this.unpackAlignment = 1
  }
  function u(t, e, i, o, r, a, s, l, c, h) {
    t = void 0 !== t
      ? t
      : [],
    e = void 0 !== e
      ? e
      : ua,
    n.call(this, t, e, i, o, r, a, s, l, c, h),
    this.flipY = !1
  }
  function d() {
    this.seq = [],
    this.map = {}
  }
  function p(t, e, i) {
    var n = t[0];
    if (n <= 0 || n > 0)
      return t;
    var o = e * i,
      r = xs[o];
    if (void 0 === r && (r = new Float32Array(o), xs[o] = r), 0 !== e) {
      n.toArray(r, 0);
      for (var a = 1, s = 0; a !== e; ++a)
        s += i,
        t[a].toArray(r, s)
    }
    return r
  }
  function f(t, e) {
    var i = bs[e];
    void 0 === i && (i = new Int32Array(e), bs[e] = i);
    for (var n = 0; n !== e; ++n)
      i[n] = t.allocTextureUnit();
    return i
  }
  function m(t, e) {
    t.uniform1f(this.addr, e)
  }
  function g(t, e) {
    t.uniform1i(this.addr, e)
  }
  function v(t, e) {
    void 0 === e.x
      ? t.uniform2fv(this.addr, e)
      : t.uniform2f(this.addr, e.x, e.y)
  }
  function y(t, e) {
    void 0 !== e.x
      ? t.uniform3f(this.addr, e.x, e.y, e.z)
      : void 0 !== e.r
        ? t.uniform3f(this.addr, e.r, e.g, e.b)
        : t.uniform3fv(this.addr, e)
  }
  function E(t, e) {
    void 0 === e.x
      ? t.uniform4fv(this.addr, e)
      : t.uniform4f(this.addr, e.x, e.y, e.z, e.w)
  }
  function x(t, e) {
    t.uniformMatrix2fv(this.addr, !1, e.elements || e)
  }
  function b(t, e) {
    void 0 === e.elements
      ? t.uniformMatrix3fv(this.addr, !1, e)
      : (Cs.set(e.elements), t.uniformMatrix3fv(this.addr, !1, Cs))
  }
  function w(t, e) {
    void 0 === e.elements
      ? t.uniformMatrix4fv(this.addr, !1, e)
      : (ws.set(e.elements), t.uniformMatrix4fv(this.addr, !1, ws))
  }
  function C(t, e, i) {
    var n = i.allocTextureUnit();
    t.uniform1i(this.addr, n),
    i.setTexture2D(e || ys, n)
  }
  function T(t, e, i) {
    var n = i.allocTextureUnit();
    t.uniform1i(this.addr, n),
    i.setTextureCube(e || Es, n)
  }
  function _(t, e) {
    t.uniform2iv(this.addr, e)
  }
  function L(t, e) {
    t.uniform3iv(this.addr, e)
  }
  function M(t, e) {
    t.uniform4iv(this.addr, e)
  }
  function S(t) {
    switch (t) {
      case 5126:
        return m;
      case 35664:
        return v;
      case 35665:
        return y;
      case 35666:
        return E;
      case 35674:
        return x;
      case 35675:
        return b;
      case 35676:
        return w;
      case 35678:
        return C;
      case 35680:
        return T;
      case 5124:
      case 35670:
        return g;
      case 35667:
      case 35671:
        return _;
      case 35668:
      case 35672:
        return L;
      case 35669:
      case 35673:
        return M
    }
  }
  function O(t, e) {
    t.uniform1fv(this.addr, e)
  }
  function D(t, e) {
    t.uniform1iv(this.addr, e)
  }
  function R(t, e) {
    t.uniform2fv(this.addr, p(e, this.size, 2))
  }
  function U(t, e) {
    t.uniform3fv(this.addr, p(e, this.size, 3))
  }
  function A(t, e) {
    t.uniform4fv(this.addr, p(e, this.size, 4))
  }
  function I(t, e) {
    t.uniformMatrix2fv(this.addr, !1, p(e, this.size, 4))
  }
  function P(t, e) {
    t.uniformMatrix3fv(this.addr, !1, p(e, this.size, 9))
  }
  function B(t, e) {
    t.uniformMatrix4fv(this.addr, !1, p(e, this.size, 16))
  }
  function N(t, e, i) {
    var n = e.length,
      o = f(i, n);
    t.uniform1iv(this.addr, o);
    for (var r = 0; r !== n; ++r)
      i.setTexture2D(e[r] || ys, o[r])
  }
  function k(t, e, i) {
    var n = e.length,
      o = f(i, n);
    t.uniform1iv(this.addr, o);
    for (var r = 0; r !== n; ++r)
      i.setTextureCube(e[r] || Es, o[r])
  }
  function H(t) {
    switch (t) {
      case 5126:
        return O;
      case 35664:
        return R;
      case 35665:
        return U;
      case 35666:
        return A;
      case 35674:
        return I;
      case 35675:
        return P;
      case 35676:
        return B;
      case 35678:
        return N;
      case 35680:
        return k;
      case 5124:
      case 35670:
        return D;
      case 35667:
      case 35671:
        return _;
      case 35668:
      case 35672:
        return L;
      case 35669:
      case 35673:
        return M
    }
  }
  function F(t, e, i) {
    this.id = t,
    this.addr = i,
    this.setValue = S(e.type)
  }
  function G(t, e, i) {
    this.id = t,
    this.addr = i,
    this.size = e.size,
    this.setValue = H(e.type)
  }
  function V(t) {
    this.id = t,
    d.call(this)
  }
  function z(t, e) {
    t.seq.push(e),
    t.map[e.id] = e
  }
  function q(t, e, i) {
    var n = t.name,
      o = n.length;
    for (Ts.lastIndex = 0;;) {
      var r = Ts.exec(n),
        a = Ts.lastIndex,
        s = r[1],
        l = "]" === r[2],
        c = r[3];
      if (l && (s |= 0), void 0 === c || "[" === c && a + 2 === o) {
        z(
          i, void 0 === c
          ? new F(s, t, e)
          : new G(s, t, e));
        break
      }
      var h = i.map,
        u = h[s];
      void 0 === u && (u = new V(s), z(i, u)),
      i = u
    }
  }
  function W(t, e, i) {
    d.call(this),
    this.renderer = i;
    for (var n = t.getProgramParameter(e, t.ACTIVE_UNIFORMS), o = 0; o < n; ++o) {
      var r = t.getActiveUniform(e, o),
        a = r.name;
      q(r, t.getUniformLocation(e, a), this)
    }
  }
  function j(t, e, i) {
    return void 0 === e && void 0 === i
      ? this.set(t)
      : this.setRGB(t, e, i)
  }
  function X(t, e) {
    this.min = void 0 !== t
      ? t
      : new i(1 / 0, 1 / 0),
    this.max = void 0 !== e
      ? e
      : new i(-1 / 0, -1 / 0)
  }
  function Y(t, e) {
    function n() {
      var t = new Float32Array([
          -1,
          -1,
          0,
          0,
          1,
          -1,
          1,
          0,
          1,
          1,
          1,
          1,
          -1,
          1,
          0,
          1
        ]),
        e = new Uint16Array([
          0,
          1,
          2,
          0,
          2,
          3
        ]);
      r = f.createBuffer(),
      a = f.createBuffer(),
      f.bindBuffer(f.ARRAY_BUFFER, r),
      f.bufferData(f.ARRAY_BUFFER, t, f.STATIC_DRAW),
      f.bindBuffer(f.ELEMENT_ARRAY_BUFFER, a),
      f.bufferData(f.ELEMENT_ARRAY_BUFFER, e, f.STATIC_DRAW),
      d = f.createTexture(),
      p = f.createTexture(),
      m.bindTexture(f.TEXTURE_2D, d),
      f.texImage2D(f.TEXTURE_2D, 0, f.RGB, 16, 16, 0, f.RGB, f.UNSIGNED_BYTE, null),
      f.texParameteri(f.TEXTURE_2D, f.TEXTURE_WRAP_S, f.CLAMP_TO_EDGE),
      f.texParameteri(f.TEXTURE_2D, f.TEXTURE_WRAP_T, f.CLAMP_TO_EDGE),
      f.texParameteri(f.TEXTURE_2D, f.TEXTURE_MAG_FILTER, f.NEAREST),
      f.texParameteri(f.TEXTURE_2D, f.TEXTURE_MIN_FILTER, f.NEAREST),
      m.bindTexture(f.TEXTURE_2D, p),
      f.texImage2D(f.TEXTURE_2D, 0, f.RGBA, 16, 16, 0, f.RGBA, f.UNSIGNED_BYTE, null),
      f.texParameteri(f.TEXTURE_2D, f.TEXTURE_WRAP_S, f.CLAMP_TO_EDGE),
      f.texParameteri(f.TEXTURE_2D, f.TEXTURE_WRAP_T, f.CLAMP_TO_EDGE),
      f.texParameteri(f.TEXTURE_2D, f.TEXTURE_MAG_FILTER, f.NEAREST),
      f.texParameteri(f.TEXTURE_2D, f.TEXTURE_MIN_FILTER, f.NEAREST),
      s = {
        vertexShader: [
          "uniform lowp int renderType;",
          "uniform vec3 screenPosition;",
          "uniform vec2 scale;",
          "uniform float rotation;",
          "uniform sampler2D occlusionMap;",
          "attribute vec2 position;",
          "attribute vec2 uv;",
          "varying vec2 vUV;",
          "varying float vVisibility;",
          "void main() {",
          "vUV = uv;",
          "vec2 pos = position;",
          "if ( renderType == 2 ) {",
          "vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );",
          "visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );",
          "visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );",
          "visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );",
          "visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );",
          "visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );",
          "visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );",
          "visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );",
          "visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );",
          "vVisibility =        visibility.r / 9.0;",
          "vVisibility *= 1.0 - visibility.g / 9.0;",
          "vVisibility *=       visibility.b / 9.0;",
          "vVisibility *= 1.0 - visibility.a / 9.0;",
          "pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;",
          "pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;",
          "}",
          "gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );",
          "}"
        ].join("\n"),
        fragmentShader: [
          "uniform lowp int renderType;",
          "uniform sampler2D map;",
          "uniform float opacity;",
          "uniform vec3 color;",
          "varying vec2 vUV;",
          "varying float vVisibility;",
          "void main() {",
          "if ( renderType == 0 ) {",
          "gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );",
          "} else if ( renderType == 1 ) {",
          "gl_FragColor = texture2D( map, vUV );",
          "} else {",
          "vec4 texture = texture2D( map, vUV );",
          "texture.a *= opacity * vVisibility;",
          "gl_FragColor = texture;",
          "gl_FragColor.rgb *= color;",
          "}",
          "}"
        ].join("\n")
      },
      c = o(s),
      h = {
        vertex: f.getAttribLocation(c, "position"),
        uv: f.getAttribLocation(c, "uv")
      },
      u = {
        renderType: f.getUniformLocation(c, "renderType"),
        map: f.getUniformLocation(c, "map"),
        occlusionMap: f.getUniformLocation(c, "occlusionMap"),
        opacity: f.getUniformLocation(c, "opacity"),
        color: f.getUniformLocation(c, "color"),
        scale: f.getUniformLocation(c, "scale"),
        rotation: f.getUniformLocation(c, "rotation"),
        screenPosition: f.getUniformLocation(c, "screenPosition")
      }
    }
    function o(e) {
      var i = f.createProgram(),
        n = f.createShader(f.FRAGMENT_SHADER),
        o = f.createShader(f.VERTEX_SHADER),
        r = "precision " + t.getPrecision() + " float;\n";
      return f.shaderSource(n, r + e.fragmentShader),
      f.shaderSource(o, r + e.vertexShader),
      f.compileShader(n),
      f.compileShader(o),
      f.attachShader(i, n),
      f.attachShader(i, o),
      f.linkProgram(i),
      i
    }
    var r,
      a,
      s,
      c,
      h,
      u,
      d,
      p,
      f = t.context,
      m = t.state;
    this.render = function(o, s, g) {
      if (0 !== e.length) {
        var v = new l,
          y = g.w / g.z,
          E = .5 * g.z,
          x = .5 * g.w,
          b = 16 / g.w,
          w = new i(b * y, b),
          C = new l(1, 1, 0),
          T = new i(1, 1),
          _ = new X;
        _.min.set(g.x, g.y),
        _.max.set(g.x + (g.z - 16), g.y + (g.w - 16)),
        void 0 === c && n(),
        f.useProgram(c),
        m.initAttributes(),
        m.enableAttribute(h.vertex),
        m.enableAttribute(h.uv),
        m.disableUnusedAttributes(),
        f.uniform1i(u.occlusionMap, 0),
        f.uniform1i(u.map, 1),
        f.bindBuffer(f.ARRAY_BUFFER, r),
        f.vertexAttribPointer(h.vertex, 2, f.FLOAT, !1, 16, 0),
        f.vertexAttribPointer(h.uv, 2, f.FLOAT, !1, 16, 8),
        f.bindBuffer(f.ELEMENT_ARRAY_BUFFER, a),
        m.disable(f.CULL_FACE),
        m.buffers.depth.setMask(!1);
        for (var L = 0, M = e.length; L < M; L++) {
          b = 16 / g.w,
          w.set(b * y, b);
          var S = e[L];
          if (v.set(S.matrixWorld.elements[12], S.matrixWorld.elements[13], S.matrixWorld.elements[14]), v.applyMatrix4(s.matrixWorldInverse), v.applyMatrix4(s.projectionMatrix), C.copy(v), T.x = g.x + C.x * E + E - 8, T.y = g.y + C.y * x + x - 8, _.containsPoint(T) === !0) {
            m.activeTexture(f.TEXTURE0),
            m.bindTexture(f.TEXTURE_2D, null),
            m.activeTexture(f.TEXTURE1),
            m.bindTexture(f.TEXTURE_2D, d),
            f.copyTexImage2D(f.TEXTURE_2D, 0, f.RGB, T.x, T.y, 16, 16, 0),
            f.uniform1i(u.renderType, 0),
            f.uniform2f(u.scale, w.x, w.y),
            f.uniform3f(u.screenPosition, C.x, C.y, C.z),
            m.disable(f.BLEND),
            m.enable(f.DEPTH_TEST),
            f.drawElements(f.TRIANGLES, 6, f.UNSIGNED_SHORT, 0),
            m.activeTexture(f.TEXTURE0),
            m.bindTexture(f.TEXTURE_2D, p),
            f.copyTexImage2D(f.TEXTURE_2D, 0, f.RGBA, T.x, T.y, 16, 16, 0),
            f.uniform1i(u.renderType, 1),
            m.disable(f.DEPTH_TEST),
            m.activeTexture(f.TEXTURE1),
            m.bindTexture(f.TEXTURE_2D, d),
            f.drawElements(f.TRIANGLES, 6, f.UNSIGNED_SHORT, 0),
            S.positionScreen.copy(C),
            S.customUpdateCallback
              ? S.customUpdateCallback(S)
              : S.updateLensFlares(),
            f.uniform1i(u.renderType, 2),
            m.enable(f.BLEND);
            for (var O = 0, D = S.lensFlares.length; O < D; O++) {
              var R = S.lensFlares[O];
              R.opacity > .001 && R.scale > .001 && (C.x = R.x, C.y = R.y, C.z = R.z, b = R.size * R.scale / g.w, w.x = b * y, w.y = b, f.uniform3f(u.screenPosition, C.x, C.y, C.z), f.uniform2f(u.scale, w.x, w.y), f.uniform1f(u.rotation, R.rotation), f.uniform1f(u.opacity, R.opacity), f.uniform3f(u.color, R.color.r, R.color.g, R.color.b), m.setBlending(R.blending, R.blendEquation, R.blendSrc, R.blendDst), t.setTexture2D(R.texture, 1), f.drawElements(f.TRIANGLES, 6, f.UNSIGNED_SHORT, 0))
            }
          }
        }
        m.enable(f.CULL_FACE),
        m.enable(f.DEPTH_TEST),
        m.buffers.depth.setMask(!0),
        t.resetGLState()
      }
    }
  }
  function Z(t, e) {
    function i() {
      var t = new Float32Array([
          -.5,
          -.5,
          0,
          0,
          .5,
          -.5,
          1,
          0,
          .5,
          .5,
          1,
          1,
          -.5,
          .5,
          0,
          1
        ]),
        e = new Uint16Array([
          0,
          1,
          2,
          0,
          2,
          3
        ]);
      a = f.createBuffer(),
      c = f.createBuffer(),
      f.bindBuffer(f.ARRAY_BUFFER, a),
      f.bufferData(f.ARRAY_BUFFER, t, f.STATIC_DRAW),
      f.bindBuffer(f.ELEMENT_ARRAY_BUFFER, c),
      f.bufferData(f.ELEMENT_ARRAY_BUFFER, e, f.STATIC_DRAW),
      h = o(),
      u = {
        position: f.getAttribLocation(h, "position"),
        uv: f.getAttribLocation(h, "uv")
      },
      d = {
        uvOffset: f.getUniformLocation(h, "uvOffset"),
        uvScale: f.getUniformLocation(h, "uvScale"),
        rotation: f.getUniformLocation(h, "rotation"),
        scale: f.getUniformLocation(h, "scale"),
        color: f.getUniformLocation(h, "color"),
        map: f.getUniformLocation(h, "map"),
        opacity: f.getUniformLocation(h, "opacity"),
        modelViewMatrix: f.getUniformLocation(h, "modelViewMatrix"),
        projectionMatrix: f.getUniformLocation(h, "projectionMatrix"),
        fogType: f.getUniformLocation(h, "fogType"),
        fogDensity: f.getUniformLocation(h, "fogDensity"),
        fogNear: f.getUniformLocation(h, "fogNear"),
        fogFar: f.getUniformLocation(h, "fogFar"),
        fogColor: f.getUniformLocation(h, "fogColor"),
        alphaTest: f.getUniformLocation(h, "alphaTest")
      };
      var i = document.createElementNS("http://www.w3.org/1999/xhtml", "canvas");
      i.width = 8,
      i.height = 8;
      var r = i.getContext("2d");
      r.fillStyle = "white",
      r.fillRect(0, 0, 8, 8),
      p = new n(i),
      p.needsUpdate = !0
    }
    function o() {
      var e = f.createProgram(),
        i = f.createShader(f.VERTEX_SHADER),
        n = f.createShader(f.FRAGMENT_SHADER);
      return f.shaderSource(i, [
        "precision " + t.getPrecision() + " float;",
        "uniform mat4 modelViewMatrix;",
        "uniform mat4 projectionMatrix;",
        "uniform float rotation;",
        "uniform vec2 scale;",
        "uniform vec2 uvOffset;",
        "uniform vec2 uvScale;",
        "attribute vec2 position;",
        "attribute vec2 uv;",
        "varying vec2 vUV;",
        "void main() {",
        "vUV = uvOffset + uv * uvScale;",
        "vec2 alignedPosition = position * scale;",
        "vec2 rotatedPosition;",
        "rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;",
        "rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;",
        "vec4 finalPosition;",
        "finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );",
        "finalPosition.xy += rotatedPosition;",
        "finalPosition = projectionMatrix * finalPosition;",
        "gl_Position = finalPosition;",
        "}"
      ].join("\n")),
      f.shaderSource(n, [
        "precision " + t.getPrecision() + " float;",
        "uniform vec3 color;",
        "uniform sampler2D map;",
        "uniform float opacity;",
        "uniform int fogType;",
        "uniform vec3 fogColor;",
        "uniform float fogDensity;",
        "uniform float fogNear;",
        "uniform float fogFar;",
        "uniform float alphaTest;",
        "varying vec2 vUV;",
        "void main() {",
        "vec4 texture = texture2D( map, vUV );",
        "if ( texture.a < alphaTest ) discard;",
        "gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );",
        "if ( fogType > 0 ) {",
        "float depth = gl_FragCoord.z / gl_FragCoord.w;",
        "float fogFactor = 0.0;",
        "if ( fogType == 1 ) {",
        "fogFactor = smoothstep( fogNear, fogFar, depth );",
        "} else {",
        "const float LOG2 = 1.442695;",
        "fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );",
        "fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );",
        "}",
        "gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );",
        "}",
        "}"
      ].join("\n")),
      f.compileShader(i),
      f.compileShader(n),
      f.attachShader(e, i),
      f.attachShader(e, n),
      f.linkProgram(e),
      e
    }
    function r(t, e) {
      return t.renderOrder !== e.renderOrder
        ? t.renderOrder - e.renderOrder
        : t.z !== e.z
          ? e.z - t.z
          : e.id - t.id
    }
    var a,
      c,
      h,
      u,
      d,
      p,
      f = t.context,
      m = t.state,
      g = new l,
      v = new s,
      y = new l;
    this.render = function(n, o) {
      if (0 !== e.length) {
        void 0 === h && i(),
        f.useProgram(h),
        m.initAttributes(),
        m.enableAttribute(u.position),
        m.enableAttribute(u.uv),
        m.disableUnusedAttributes(),
        m.disable(f.CULL_FACE),
        m.enable(f.BLEND),
        f.bindBuffer(f.ARRAY_BUFFER, a),
        f.vertexAttribPointer(u.position, 2, f.FLOAT, !1, 16, 0),
        f.vertexAttribPointer(u.uv, 2, f.FLOAT, !1, 16, 8),
        f.bindBuffer(f.ELEMENT_ARRAY_BUFFER, c),
        f.uniformMatrix4fv(d.projectionMatrix, !1, o.projectionMatrix.elements),
        m.activeTexture(f.TEXTURE0),
        f.uniform1i(d.map, 0);
        var s = 0,
          l = 0,
          E = n.fog;
        E
          ? (
            f.uniform3f(d.fogColor, E.color.r, E.color.g, E.color.b), E.isFog
            ? (f.uniform1f(d.fogNear, E.near), f.uniform1f(d.fogFar, E.far), f.uniform1i(d.fogType, 1), s = 1, l = 1)
            : E.isFogExp2 && (f.uniform1f(d.fogDensity, E.density), f.uniform1i(d.fogType, 2), s = 2, l = 2))
          : (f.uniform1i(d.fogType, 0), s = 0, l = 0);
        for (var x = 0, b = e.length; x < b; x++) {
          var w = e[x];
          w.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse, w.matrixWorld),
          w.z = -w.modelViewMatrix.elements[14]
        }
        e.sort(r);
        for (var C = [], x = 0, b = e.length; x < b; x++) {
          var w = e[x],
            T = w.material;
          if (T.visible !== !1) {
            f.uniform1f(d.alphaTest, T.alphaTest),
            f.uniformMatrix4fv(d.modelViewMatrix, !1, w.modelViewMatrix.elements),
            w.matrixWorld.decompose(g, v, y),
            C[0] = y.x,
            C[1] = y.y;
            var _ = 0;
            n.fog && T.fog && (_ = l),
            s !== _ && (f.uniform1i(d.fogType, _), s = _),
            null !== T.map
              ? (f.uniform2f(d.uvOffset, T.map.offset.x, T.map.offset.y), f.uniform2f(d.uvScale, T.map.repeat.x, T.map.repeat.y))
              : (f.uniform2f(d.uvOffset, 0, 0), f.uniform2f(d.uvScale, 1, 1)),
            f.uniform1f(d.opacity, T.opacity),
            f.uniform3f(d.color, T.color.r, T.color.g, T.color.b),
            f.uniform1f(d.rotation, T.rotation),
            f.uniform2fv(d.scale, C),
            m.setBlending(T.blending, T.blendEquation, T.blendSrc, T.blendDst),
            m.buffers.depth.setTest(T.depthTest),
            m.buffers.depth.setMask(T.depthWrite),
            T.map
              ? t.setTexture2D(T.map, 0)
              : t.setTexture2D(p, 0),
            f.drawElements(f.TRIANGLES, 6, f.UNSIGNED_SHORT, 0)
          }
        }
        m.enable(f.CULL_FACE),
        t.resetGLState()
      }
    }
  }
  function K() {
    Object.defineProperty(this, "id", {
      value: Ds++
    }),
    this.uuid = gs.generateUUID(),
    this.name = "",
    this.type = "Material",
    this.fog = !0,
    this.lights = !0,
    this.blending = Sr,
    this.side = Er,
    this.shading = Cr,
    this.vertexColors = Tr,
    this.opacity = 1,
    this.transparent = !1,
    this.blendSrc = Vr,
    this.blendDst = zr,
    this.blendEquation = Ar,
    this.blendSrcAlpha = null,
    this.blendDstAlpha = null,
    this.blendEquationAlpha = null,
    this.depthFunc = Jr,
    this.depthTest = !0,
    this.depthWrite = !0,
    this.clippingPlanes = null,
    this.clipIntersection = !1,
    this.clipShadows = !1,
    this.colorWrite = !0,
    this.precision = null,
    this.polygonOffset = !1,
    this.polygonOffsetFactor = 0,
    this.polygonOffsetUnits = 0,
    this.dithering = !1,
    this.alphaTest = 0,
    this.premultipliedAlpha = !1,
    this.overdraw = 0,
    this.visible = !0,
    this.needsUpdate = !0
  }
  function Q(t) {
    K.call(this),
    this.type = "ShaderMaterial",
    this.defines = {},
    this.uniforms = {},
    this.vertexShader = "void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
    this.fragmentShader = "void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",
    this.linewidth = 1,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.fog = !1,
    this.lights = !1,
    this.clipping = !1,
    this.skinning = !1,
    this.morphTargets = !1,
    this.morphNormals = !1,
    this.extensions = {
      derivatives: !1,
      fragDepth: !1,
      drawBuffers: !1,
      shaderTextureLOD: !1
    },
    this.defaultAttributeValues = {
      color: [
        1, 1, 1
      ],
      uv: [
        0, 0
      ],
      uv2: [0, 0]
    },
    this.index0AttributeName = void 0,
    void 0 !== t && (void 0 !== t.attributes && console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."), this.setValues(t))
  }
  function J(t) {
    K.call(this),
    this.type = "MeshDepthMaterial",
    this.depthPacking = fs,
    this.skinning = !1,
    this.morphTargets = !1,
    this.map = null,
    this.alphaMap = null,
    this.displacementMap = null,
    this.displacementScale = 1,
    this.displacementBias = 0,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.fog = !1,
    this.lights = !1,
    this.setValues(t)
  }
  function $(t, e) {
    this.min = void 0 !== t
      ? t
      : new l(1 / 0, 1 / 0, 1 / 0),
    this.max = void 0 !== e
      ? e
      : new l(-1 / 0, -1 / 0, -1 / 0)
  }
  function tt(t, e) {
    this.center = void 0 !== t
      ? t
      : new l,
    this.radius = void 0 !== e
      ? e
      : 0
  }
  function et() {
    this.elements = [
      1,
      0,
      0,
      0,
      1,
      0,
      0,
      0,
      1
    ],
    arguments.length > 0 && console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")
  }
  function it(t, e) {
    this.normal = void 0 !== t
      ? t
      : new l(1, 0, 0),
    this.constant = void 0 !== e
      ? e
      : 0
  }
  function nt(t, e, i, n, o, r) {
    this.planes = [
      void 0 !== t
        ? t
        : new it,
      void 0 !== e
        ? e
        : new it,
      void 0 !== i
        ? i
        : new it,
      void 0 !== n
        ? n
        : new it,
      void 0 !== o
        ? o
        : new it,
      void 0 !== r
        ? r
        : new it
    ]
  }
  function ot(t, e, n, a) {
    function s(e, i, n, o) {
      var r = e.geometry,
        a = null,
        s = C,
        l = e.customDepthMaterial;
      if (n && (s = T, l = e.customDistanceMaterial), l)
        a = l;
      else {
        var c = !1;
        i.morphTargets && (
          r && r.isBufferGeometry
          ? c = r.morphAttributes && r.morphAttributes.position && r.morphAttributes.position.length > 0
          : r && r.isGeometry && (c = r.morphTargets && r.morphTargets.length > 0)),
        e.isSkinnedMesh && i.skinning === !1 && console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:", e);
        var h = e.isSkinnedMesh && i.skinning,
          u = 0;
        c && (u |= x),
        h && (u |= b),
        a = s[u]
      }
      if (t.localClippingEnabled && i.clipShadows === !0 && 0 !== i.clippingPlanes.length) {
        var d = a.uuid,
          p = i.uuid,
          f = _[d];
        void 0 === f && (f = {}, _[d] = f);
        var m = f[p];
        void 0 === m && (m = a.clone(), f[p] = m),
        a = m
      }
      a.visible = i.visible,
      a.wireframe = i.wireframe;
      var g = i.side;
      return N.renderSingleSided && g == br && (g = Er),
      N.renderReverseSided && (
        g === Er
        ? g = xr
        : g === xr && (g = Er)),
      a.side = g,
      a.clipShadows = i.clipShadows,
      a.clippingPlanes = i.clippingPlanes,
      a.wireframeLinewidth = i.wireframeLinewidth,
      a.linewidth = i.linewidth,
      n && void 0 !== a.uniforms.lightPos && a.uniforms.lightPos.value.copy(o),
      a
    }
    function h(e, i, o, r) {
      if (e.visible !== !1) {
        if (e.layers.test(i.layers) && (e.isMesh || e.isLine || e.isPoints) && e.castShadow && (!e.frustumCulled || p.intersectsObject(e))) {
          e.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse, e.matrixWorld);
          var a = n.update(e),
            l = e.material;
          if (Array.isArray(l))
            for (var c = a.groups, u = 0, d = c.length; u < d; u++) {
              var f = c[u],
                m = l[f.materialIndex];
              if (m && m.visible) {
                var g = s(e, m, r, E);
                t.renderBufferDirect(o, null, a, g, e, f)
              }
            }
          else if (l.visible) {
            var g = s(e, l, r, E);
            t.renderBufferDirect(o, null, a, g, e, null)
          }
        }
        for (var v = e.children, y = 0, x = v.length; y < x; y++)
          h(v[y], i, o, r)
      }
    }
    var u = t.context,
      d = t.state,
      p = new nt,
      f = new c,
      m = e.shadows,
      g = new i,
      v = new i(a.maxTextureSize, a.maxTextureSize),
      y = new l,
      E = new l,
      x = 1,
      b = 2,
      w = 1 + (x | b),
      C = new Array(w),
      T = new Array(w),
      _ = {},
      L = [
        new l(1, 0, 0),
        new l(-1, 0, 0),
        new l(0, 0, 1),
        new l(0, 0, -1),
        new l(0, 1, 0),
        new l(0, -1, 0)
      ],
      M = [
        new l(0, 1, 0),
        new l(0, 1, 0),
        new l(0, 1, 0),
        new l(0, 1, 0),
        new l(0, 0, 1),
        new l(0, 0, -1)
      ],
      S = [
        new o,
        new o,
        new o,
        new o,
        new o,
        new o
      ],
      O = new J;
    O.depthPacking = ms,
    O.clipping = !0;
    for (var D = Os.distanceRGBA, R = Ms.clone(D.uniforms), U = 0; U !== w; ++U) {
      var A = 0 != (U & x),
        I = 0 != (U & b),
        P = O.clone();
      P.morphTargets = A,
      P.skinning = I,
      C[U] = P;
      var B = new Q({
        defines: {
          USE_SHADOWMAP: ""
        },
        uniforms: R,
        vertexShader: D.vertexShader,
        fragmentShader: D.fragmentShader,
        morphTargets: A,
        skinning: I,
        clipping: !0
      });
      T[U] = B
    }
    var N = this;
    this.enabled = !1,
    this.autoUpdate = !0,
    this.needsUpdate = !1,
    this.type = vr,
    this.renderReverseSided = !0,
    this.renderSingleSided = !0,
    this.render = function(e, i) {
      if (N.enabled !== !1 && (N.autoUpdate !== !1 || N.needsUpdate !== !1) && 0 !== m.length) {
        d.disable(u.BLEND),
        d.buffers.color.setClear(1, 1, 1, 1),
        d.buffers.depth.setTest(!0),
        d.setScissorTest(!1);
        for (var n, o, a = 0, s = m.length; a < s; a++) {
          var l = m[a],
            c = l.shadow;
          if (void 0 !== c) {
            var x = c.camera,
              b = c.matrix;
            if (E.setFromMatrixPosition(l.matrixWorld), x.position.copy(E), g.copy(c.mapSize), g.min(v), l && l.isPointLight) {
              n = 6,
              o = !0;
              var w = g.x,
                C = g.y;
              S[0].set(2 * w, C, w, C),
              S[1].set(0, C, w, C),
              S[2].set(3 * w, C, w, C),
              S[3].set(w, C, w, C),
              S[4].set(3 * w, 0, w, C),
              S[5].set(w, 0, w, C),
              g.x *= 4,
              g.y *= 2,
              b.makeTranslation(-E.x, -E.y, -E.z)
            } else
              n = 1,
              o = !1,
              y.setFromMatrixPosition(l.target.matrixWorld),
              x.lookAt(y),
              x.updateMatrixWorld(),
              x.matrixWorldInverse.getInverse(x.matrixWorld),
              b.set(.5, 0, 0, .5, 0, .5, 0, .5, 0, 0, .5, .5, 0, 0, 0, 1),
              b.multiply(x.projectionMatrix),
              b.multiply(x.matrixWorldInverse);
            if (null === c.map) {
              var T = {
                minFilter: ba,
                magFilter: ba,
                format: Ga
              };
              c.map = new r(g.x, g.y, T),
              c.map.texture.name = l.name + ".shadowMap",
              x.updateProjectionMatrix()
            }
            c.isSpotLightShadow && c.update(l);
            var _ = c.map;
            t.setRenderTarget(_),
            t.clear();
            for (var O = 0; O < n; O++) {
              if (o) {
                y.copy(x.position),
                y.add(L[O]),
                x.up.copy(M[O]),
                x.lookAt(y),
                x.updateMatrixWorld(),
                x.matrixWorldInverse.getInverse(x.matrixWorld);
                var D = S[O];
                d.viewport(D)
              }
              f.multiplyMatrices(x.projectionMatrix, x.matrixWorldInverse),
              p.setFromMatrix(f),
              h(e, i, x, o)
            }
          } else
            console.warn("THREE.WebGLShadowMap:", l, "has no shadow.")
        }
        var R = t.getClearColor(),
          U = t.getClearAlpha();
        t.setClearColor(R, U),
        N.needsUpdate = !1
      }
    }
  }
  function rt(t, e) {
    this.origin = void 0 !== t
      ? t
      : new l,
    this.direction = void 0 !== e
      ? e
      : new l
  }
  function at(t, e, i, n) {
    this._x = t || 0,
    this._y = e || 0,
    this._z = i || 0,
    this._order = n || at.DefaultOrder
  }
  function st() {
    this.mask = 1
  }
  function lt() {
    function t() {
      o.setFromEuler(n, !1)
    }
    function e() {
      n.setFromQuaternion(o, void 0, !1)
    }
    Object.defineProperty(this, "id", {
      value: Rs++
    }),
    this.uuid = gs.generateUUID(),
    this.name = "",
    this.type = "Object3D",
    this.parent = null,
    this.children = [],
    this.up = lt.DefaultUp.clone();
    var i = new l,
      n = new at,
      o = new s,
      r = new l(1, 1, 1);
    n.onChange(t),
    o.onChange(e),
    Object.defineProperties(this, {
      position: {
        enumerable: !0,
        value: i
      },
      rotation: {
        enumerable: !0,
        value: n
      },
      quaternion: {
        enumerable: !0,
        value: o
      },
      scale: {
        enumerable: !0,
        value: r
      },
      modelViewMatrix: {
        value: new c
      },
      normalMatrix: {
        value: new et
      }
    }),
    this.matrix = new c,
    this.matrixWorld = new c,
    this.matrixAutoUpdate = lt.DefaultMatrixAutoUpdate,
    this.matrixWorldNeedsUpdate = !1,
    this.layers = new st,
    this.visible = !0,
    this.castShadow = !1,
    this.receiveShadow = !1,
    this.frustumCulled = !0,
    this.renderOrder = 0,
    this.userData = {},
    this.onBeforeRender = function() {},
    this.onAfterRender = function() {}
  }
  function ct(t, e) {
    this.start = void 0 !== t
      ? t
      : new l,
    this.end = void 0 !== e
      ? e
      : new l
  }
  function ht(t, e, i) {
    this.a = void 0 !== t
      ? t
      : new l,
    this.b = void 0 !== e
      ? e
      : new l,
    this.c = void 0 !== i
      ? i
      : new l
  }
  function ut(t, e, i, n, o, r) {
    this.a = t,
    this.b = e,
    this.c = i,
    this.normal = n && n.isVector3
      ? n
      : new l,
    this.vertexNormals = Array.isArray(n)
      ? n
      : [],
    this.color = o && o.isColor
      ? o
      : new j,
    this.vertexColors = Array.isArray(o)
      ? o
      : [],
    this.materialIndex = void 0 !== r
      ? r
      : 0
  }
  function dt(t) {
    K.call(this),
    this.type = "MeshBasicMaterial",
    this.color = new j(16777215),
    this.map = null,
    this.lightMap = null,
    this.lightMapIntensity = 1,
    this.aoMap = null,
    this.aoMapIntensity = 1,
    this.specularMap = null,
    this.alphaMap = null,
    this.envMap = null,
    this.combine = na,
    this.reflectivity = 1,
    this.refractionRatio = .98,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.wireframeLinecap = "round",
    this.wireframeLinejoin = "round",
    this.skinning = !1,
    this.morphTargets = !1,
    this.lights = !1,
    this.setValues(t)
  }
  function pt(t, e, i) {
    if (Array.isArray(t))
      throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");
    this.uuid = gs.generateUUID(),
    this.array = t,
    this.itemSize = e,
    this.count = void 0 !== t
      ? t.length / e
      : 0,
    this.normalized = i === !0,
    this.dynamic = !1,
    this.updateRange = {
      offset: 0,
      count: -1
    },
    this.onUploadCallback = function() {},
    this.version = 0
  }
  function ft(t, e) {
    pt.call(this, new Int8Array(t), e)
  }
  function mt(t, e) {
    pt.call(this, new Uint8Array(t), e)
  }
  function gt(t, e) {
    pt.call(this, new Uint8ClampedArray(t), e)
  }
  function vt(t, e) {
    pt.call(this, new Int16Array(t), e)
  }
  function yt(t, e) {
    pt.call(this, new Uint16Array(t), e)
  }
  function Et(t, e) {
    pt.call(this, new Int32Array(t), e)
  }
  function xt(t, e) {
    pt.call(this, new Uint32Array(t), e)
  }
  function bt(t, e) {
    pt.call(this, new Float32Array(t), e)
  }
  function wt(t, e) {
    pt.call(this, new Float64Array(t), e)
  }
  function Ct() {
    this.indices = [],
    this.vertices = [],
    this.normals = [],
    this.colors = [],
    this.uvs = [],
    this.uvs2 = [],
    this.groups = [],
    this.morphTargets = {},
    this.skinWeights = [],
    this.skinIndices = [],
    this.boundingBox = null,
    this.boundingSphere = null,
    this.verticesNeedUpdate = !1,
    this.normalsNeedUpdate = !1,
    this.colorsNeedUpdate = !1,
    this.uvsNeedUpdate = !1,
    this.groupsNeedUpdate = !1
  }
  function Tt(t) {
    if (0 === t.length)
      return -1 / 0;
    for (var e = t[0], i = 1, n = t.length; i < n; ++i)
      t[i] > e && (e = t[i]);
    return e
  }
  function _t() {
    return Us++
  }
  function Lt() {
    Object.defineProperty(this, "id", {value: _t()}),
    this.uuid = gs.generateUUID(),
    this.name = "",
    this.type = "Geometry",
    this.vertices = [],
    this.colors = [],
    this.faces = [],
    this.faceVertexUvs = [
      []
    ],
    this.morphTargets = [],
    this.morphNormals = [],
    this.skinWeights = [],
    this.skinIndices = [],
    this.lineDistances = [],
    this.boundingBox = null,
    this.boundingSphere = null,
    this.elementsNeedUpdate = !1,
    this.verticesNeedUpdate = !1,
    this.uvsNeedUpdate = !1,
    this.normalsNeedUpdate = !1,
    this.colorsNeedUpdate = !1,
    this.lineDistancesNeedUpdate = !1,
    this.groupsNeedUpdate = !1
  }
  function Mt() {
    Object.defineProperty(this, "id", {value: _t()}),
    this.uuid = gs.generateUUID(),
    this.name = "",
    this.type = "BufferGeometry",
    this.index = null,
    this.attributes = {},
    this.morphAttributes = {},
    this.groups = [],
    this.boundingBox = null,
    this.boundingSphere = null,
    this.drawRange = {
      start: 0,
      count: 1 / 0
    }
  }
  function St(t, e) {
    lt.call(this),
    this.type = "Mesh",
    this.geometry = void 0 !== t
      ? t
      : new Mt,
    this.material = void 0 !== e
      ? e
      : new dt({color: 16777215 *Math.random()}),
    this.drawMode = os,
    this.updateMorphTargets()
  }
  function Ot(t, e, i, n, o, r) {
    Lt.call(this),
    this.type = "BoxGeometry",
    this.parameters = {
      width: t,
      height: e,
      depth: i,
      widthSegments: n,
      heightSegments: o,
      depthSegments: r
    },
    this.fromBufferGeometry(new Dt(t, e, i, n, o, r)),
    this.mergeVertices()
  }
  function Dt(t, e, i, n, o, r) {
    function a(t, e, i, n, o, r, a, m, g, v, y) {
      var E,
        x,
        b = r / g,
        w = a / v,
        C = r / 2,
        T = a / 2,
        _ = m / 2,
        L = g + 1,
        M = v + 1,
        S = 0,
        O = 0,
        D = new l;
      for (x = 0; x < M; x++) {
        var R = x * w - T;
        for (E = 0; E < L; E++) {
          var U = E * b - C;
          D[t] = U * n,
          D[e] = R * o,
          D[i] = _,
          h.push(D.x, D.y, D.z),
          D[t] = 0,
          D[e] = 0,
          D[i] = m > 0
            ? 1
            : -1,
          u.push(D.x, D.y, D.z),
          d.push(E / g),
          d.push(1 - x / v),
          S += 1
        }
      }
      for (x = 0; x < v; x++)
        for (E = 0; E < g; E++) {
          var A = p + E + L * x,
            I = p + E + L * (x + 1),
            P = p + (E + 1) + L * (x + 1),
            B = p + (E + 1) + L * x;
          c.push(A, I, B),
          c.push(I, P, B),
          O += 6
        }
      s.addGroup(f, O, y),
      f += O,
      p += S
    }
    Mt.call(this),
    this.type = "BoxBufferGeometry",
    this.parameters = {
      width: t,
      height: e,
      depth: i,
      widthSegments: n,
      heightSegments: o,
      depthSegments: r
    };
    var s = this;
    n = Math.floor(n) || 1,
    o = Math.floor(o) || 1,
    r = Math.floor(r) || 1;
    var c = [],
      h = [],
      u = [],
      d = [],
      p = 0,
      f = 0;
    a("z", "y", "x", -1, -1, i, e, t, r, o, 0),
    a("z", "y", "x", 1, -1, i, e, -t, r, o, 1),
    a("x", "z", "y", 1, 1, t, i, e, n, r, 2),
    a("x", "z", "y", 1, -1, t, i, -e, n, r, 3),
    a("x", "y", "z", 1, -1, t, e, i, n, o, 4),
    a("x", "y", "z", -1, -1, t, e, -i, n, o, 5),
    this.setIndex(c),
    this.addAttribute("position", new bt(h, 3)),
    this.addAttribute("normal", new bt(u, 3)),
    this.addAttribute("uv", new bt(d, 2))
  }
  function Rt(t, e, i, n) {
    Lt.call(this),
    this.type = "PlaneGeometry",
    this.parameters = {
      width: t,
      height: e,
      widthSegments: i,
      heightSegments: n
    },
    this.fromBufferGeometry(new Ut(t, e, i, n)),
    this.mergeVertices()
  }
  function Ut(t, e, i, n) {
    Mt.call(this),
    this.type = "PlaneBufferGeometry",
    this.parameters = {
      width: t,
      height: e,
      widthSegments: i,
      heightSegments: n
    };
    var o,
      r,
      a = t / 2,
      s = e / 2,
      l = Math.floor(i) || 1,
      c = Math.floor(n) || 1,
      h = l + 1,
      u = c + 1,
      d = t / l,
      p = e / c,
      f = [],
      m = [],
      g = [],
      v = [];
    for (r = 0; r < u; r++) {
      var y = r * p - s;
      for (o = 0; o < h; o++) {
        var E = o * d - a;
        m.push(E, -y, 0),
        g.push(0, 0, 1),
        v.push(o / l),
        v.push(1 - r / c)
      }
    }
    for (r = 0; r < c; r++)
      for (o = 0; o < l; o++) {
        var x = o + h * r,
          b = o + h * (r + 1),
          w = o + 1 + h * (r + 1),
          C = o + 1 + h * r;
        f.push(x, b, C),
        f.push(b, w, C)
      }
    this.setIndex(f),
    this.addAttribute("position", new bt(m, 3)),
    this.addAttribute("normal", new bt(g, 3)),
    this.addAttribute("uv", new bt(v, 2))
  }
  function At() {
    lt.call(this),
    this.type = "Camera",
    this.matrixWorldInverse = new c,
    this.projectionMatrix = new c
  }
  function It(t, e, i, n) {
    At.call(this),
    this.type = "PerspectiveCamera",
    this.fov = void 0 !== t
      ? t
      : 50,
    this.zoom = 1,
    this.near = void 0 !== i
      ? i
      : .1,
    this.far = void 0 !== n
      ? n
      : 2e3,
    this.focus = 10,
    this.aspect = void 0 !== e
      ? e
      : 1,
    this.view = null,
    this.filmGauge = 35,
    this.filmOffset = 0,
    this.updateProjectionMatrix()
  }
  function Pt(t, e, i, n, o, r) {
    At.call(this),
    this.type = "OrthographicCamera",
    this.zoom = 1,
    this.view = null,
    this.left = t,
    this.right = e,
    this.top = i,
    this.bottom = n,
    this.near = void 0 !== o
      ? o
      : .1,
    this.far = void 0 !== r
      ? r
      : 2e3,
    this.updateProjectionMatrix()
  }
  function Bt(t) {
    function e(e, i) {
      var n = e.array,
        o = e.dynamic
          ? t.DYNAMIC_DRAW
          : t.STATIC_DRAW,
        r = t.createBuffer();
      t.bindBuffer(i, r),
      t.bufferData(i, n, o),
      e.onUploadCallback();
      var a = t.FLOAT;
      return n instanceof Float32Array
        ? a = t.FLOAT
        : n instanceof Float64Array
          ? console.warn("Unsupported data buffer format: Float64Array")
          : n instanceof Uint16Array
            ? a = t.UNSIGNED_SHORT
            : n instanceof Int16Array
              ? a = t.SHORT
              : n instanceof Uint32Array
                ? a = t.UNSIGNED_INT
                : n instanceof Int32Array
                  ? a = t.INT
                  : n instanceof Int8Array
                    ? a = t.BYTE
                    : n instanceof Uint8Array && (a = t.UNSIGNED_BYTE), {
        buffer: r,
        type: a,
        bytesPerElement: n.BYTES_PER_ELEMENT,
        version: e.version
      }
    }
    function i(e, i, n) {
      var o = i.array,
        r = i.updateRange;
      t.bindBuffer(n, e),
      i.dynamic === !1
        ? t.bufferData(n, o, t.STATIC_DRAW)
        : r.count === -1
          ? t.bufferSubData(n, 0, o)
          : 0 === r.count
            ? console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.")
            : (t.bufferSubData(n, r.offset * o.BYTES_PER_ELEMENT, o.subarray(r.offset, r.offset + r.count)), r.count = 0)
    }
    function n(t) {
      return t.isInterleavedBufferAttribute && (t = t.data),
      a[t.uuid]
    }
    function o(e) {
      var i = a[e.uuid];
      i && (t.deleteBuffer(i.buffer), delete a[e.uuid])
    }
    function r(t, n) {
      t.isInterleavedBufferAttribute && (t = t.data);
      var o = a[t.uuid];
      void 0 === o
        ? a[t.uuid] = e(t, n)
        : o.version < t.version && (i(o.buffer, t, n), o.version = t.version)
    }
    var a = {};
    return {get: n, remove: o, update: r}
  }
  function Nt(t, e) {
    return t.renderOrder !== e.renderOrder
      ? t.renderOrder - e.renderOrder
      : t.program && e.program && t.program !== e.program
        ? t.program.id - e.program.id
        : t.material.id !== e.material.id
          ? t.material.id - e.material.id
          : t.z !== e.z
            ? t.z - e.z
            : t.id - e.id
  }
  function kt(t, e) {
    return t.renderOrder !== e.renderOrder
      ? t.renderOrder - e.renderOrder
      : t.z !== e.z
        ? e.z - t.z
        : t.id - e.id
  }
  function Ht() {
    function t() {
      r = -1,
      s = -1
    }
    function e(t, e, i, n, l) {
      var c,
        h;
      i.transparent
        ? (c = a, h = ++s)
        : (c = o, h = ++r);
      var u = c[h];
      u
        ? (u.id = t.id, u.object = t, u.geometry = e, u.material = i, u.program = i.program, u.renderOrder = t.renderOrder, u.z = n, u.group = l)
        : (u = {
          id: t.id,
          object: t,
          geometry: e,
          material: i,
          program: i.program,
          renderOrder: t.renderOrder,
          z: n,
          group: l
        }, c.push(u))
    }
    function i() {
      o.length = r + 1,
      a.length = s + 1
    }
    function n() {
      o.sort(Nt),
      a.sort(kt)
    }
    var o = [],
      r = -1,
      a = [],
      s = -1;
    return {
      opaque: o,
      transparent: a,
      init: t,
      push: e,
      finish: i,
      sort: n
    }
  }
  function Ft() {
    function t(t, e) {
      var n = t.id + "," + e.id,
        o = i[n];
      return void 0 === o && (o = new Ht, i[n] = o),
      o
    }
    function e() {
      i = {}
    }
    var i = {};
    return {get: t, dispose: e}
  }
  function Gt(t, e, i) {
    function n(t) {
      s = t
    }
    function o(i) {
      i.array instanceof Uint32Array && e.get("OES_element_index_uint")
        ? (l = t.UNSIGNED_INT, c = 4)
        : i.array instanceof Uint16Array
          ? (l = t.UNSIGNED_SHORT, c = 2)
          : (l = t.UNSIGNED_BYTE, c = 1)
    }
    function r(e, n) {
      t.drawElements(s, n, l, e * c),
      i.calls++,
      i.vertices += n,
      s === t.TRIANGLES && (i.faces += n / 3)
    }
    function a(n, o, r) {
      var a = e.get("ANGLE_instanced_arrays");
      if (null === a)
        return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
      a.drawElementsInstancedANGLE(s, r, l, o * c, n.maxInstancedCount),
      i.calls++,
      i.vertices += r * n.maxInstancedCount,
      s === t.TRIANGLES && (i.faces += n.maxInstancedCount * r / 3)
    }
    var s,
      l,
      c;
    this.setMode = n,
    this.setIndex = o,
    this.render = r,
    this.renderInstances = a
  }
  function Vt(t, e, i) {
    function n(t) {
      a = t
    }
    function o(e, n) {
      t.drawArrays(a, e, n),
      i.calls++,
      i.vertices += n,
      a === t.TRIANGLES && (i.faces += n / 3)
    }
    function r(n, o, r) {
      var s = e.get("ANGLE_instanced_arrays");
      if (null === s)
        return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
      var l = n.attributes.position;
      l.isInterleavedBufferAttribute
        ? (r = l.data.count, s.drawArraysInstancedANGLE(a, 0, r, n.maxInstancedCount))
        : s.drawArraysInstancedANGLE(a, o, r, n.maxInstancedCount),
      i.calls++,
      i.vertices += r * n.maxInstancedCount,
      a === t.TRIANGLES && (i.faces += n.maxInstancedCount * r / 3)
    }
    var a;
    this.setMode = n,
    this.render = o,
    this.renderInstances = r
  }
  function zt(t, e, i) {
    function n(t) {
      var o = t.target,
        r = s[o.id];
      null !== r.index && e.remove(r.index);
      for (var a in r.attributes)
        e.remove(r.attributes[a]);
      o.removeEventListener("dispose", n),
      delete s[o.id];
      var c = l[o.id];
      c && (e.remove(c), delete l[o.id]),
      c = l[r.id],
      c && (e.remove(c), delete l[r.id]),
      i.geometries--
    }
    function o(t, e) {
      var o = s[e.id];
      return o || (
        e.addEventListener("dispose", n), e.isBufferGeometry
        ? o = e
        : e.isGeometry && (void 0 === e._bufferGeometry && (e._bufferGeometry = (new Mt).setFromObject(t)), o = e._bufferGeometry),
      s[e.id] = o,
      i.geometries++,
      o)
    }
    function r(i) {
      var n = i.index,
        o = i.attributes;
      null !== n && e.update(n, t.ELEMENT_ARRAY_BUFFER);
      for (var r in o)
        e.update(o[r], t.ARRAY_BUFFER);
      var a = i.morphAttributes;
      for (var r in a)
        for (var s = a[r], l = 0, c = s.length; l < c; l++)
          e.update(s[l], t.ARRAY_BUFFER)
    }
    function a(i) {
      var n = l[i.id];
      if (n)
        return n;
      var o = [],
        r = i.index,
        a = i.attributes;
      if (null !== r)
        for (var s = r.array, c = 0, h = s.length; c < h; c += 3) {
          var u = s[c + 0],
            d = s[c + 1],
            p = s[c + 2];
          o.push(u, d, d, p, p, u)
        }
      else
        for (var s = a.position.array, c = 0, h = s.length / 3 - 1; c < h; c += 3) {
          var u = c + 0,
            d = c + 1,
            p = c + 2;
          o.push(u, d, d, p, p, u)
        }
      return n = new(
        Tt(o) > 65535
        ? xt
        : yt)(o, 1),
      e.update(n, t.ELEMENT_ARRAY_BUFFER),
      l[i.id] = n,
      n
    }
    var s = {},
      l = {};
    return {get: o, update: r, getWireframeAttribute: a}
  }
  function qt() {
    var t = {};
    return {
      get: function(e) {
        if (void 0 !== t[e.id])
          return t[e.id];
        var n;
        switch (e.type) {
          case "DirectionalLight":
            n = {
              direction: new l,
              color: new j,
              shadow: !1,
              shadowBias: 0,
              shadowRadius: 1,
              shadowMapSize: new i
            };
            break;
          case "SpotLight":
            n = {
              position: new l,
              direction: new l,
              color: new j,
              distance: 0,
              coneCos: 0,
              penumbraCos: 0,
              decay: 0,
              shadow: !1,
              shadowBias: 0,
              shadowRadius: 1,
              shadowMapSize: new i
            };
            break;
          case "PointLight":
            n = {
              position: new l,
              color: new j,
              distance: 0,
              decay: 0,
              shadow: !1,
              shadowBias: 0,
              shadowRadius: 1,
              shadowMapSize: new i
            };
            break;
          case "HemisphereLight":
            n = {
              direction: new l,
              skyColor: new j,
              groundColor: new j
            };
            break;
          case "RectAreaLight":
            n = {
              color: new j,
              position: new l,
              halfWidth: new l,
              halfHeight: new l
            }
        }
        return t[e.id] = n,
        n
      }
    }
  }
  function Wt(t, e, i) {
    function n(t) {
      var n = i.frame,
        o = t.geometry,
        a = e.get(t, o);
      return r[a.id] !== n && (o.isGeometry && a.updateFromObject(t), e.update(a), r[a.id] = n),
      a
    }
    function o() {
      r = {}
    }
    var r = {};
    return {update: n, clear: o}
  }
  function jt(t) {
    for (var e = t.split("\n"), i = 0; i < e.length; i++)
      e[i] = i + 1 + ": " + e[i];
    return e.join("\n")
  }
  function Xt(t, e, i) {
    var n = t.createShader(e);
    return t.shaderSource(n, i),
    t.compileShader(n),
    t.getShaderParameter(n, t.COMPILE_STATUS) === !1 && console.error("THREE.WebGLShader: Shader couldn't compile."),
    "" !== t.getShaderInfoLog(n) && console.warn(
      "THREE.WebGLShader: gl.getShaderInfoLog()", e === t.VERTEX_SHADER
      ? "vertex"
      : "fragment",
    t.getShaderInfoLog(n),
    jt(i)),
    n
  }
  function Yt(t) {
    switch (t) {
      case ss:
        return ["Linear", "( value )"];
      case ls:
        return ["sRGB", "( value )"];
      case hs:
        return ["RGBE", "( value )"];
      case us:
        return ["RGBM", "( value, 7.0 )"];
      case ds:
        return ["RGBM", "( value, 16.0 )"];
      case ps:
        return ["RGBD", "( value, 256.0 )"];
      case cs:
        return ["Gamma", "( value, float( GAMMA_FACTOR ) )"];
      default:
        throw new Error("unsupported encoding: " + t)
    }
  }
  function Zt(t, e) {
    var i = Yt(e);
    return "vec4 " + t + "( vec4 value ) { return " + i[0] + "ToLinear" + i[1] + "; }"
  }
  function Kt(t, e) {
    var i = Yt(e);
    return "vec4 " + t + "( vec4 value ) { return LinearTo" + i[0] + i[1] + "; }"
  }
  function Qt(t, e) {
    var i;
    switch (e) {
      case sa:
        i = "Linear";
        break;
      case la:
        i = "Reinhard";
        break;
      case ca:
        i = "Uncharted2";
        break;
      case ha:
        i = "OptimizedCineon";
        break;
      default:
        throw new Error("unsupported toneMapping: " + e)
    }
    return "vec3 " + t + "( vec3 color ) { return " + i + "ToneMapping( color ); }"
  }
  function Jt(t, e, i) {
    return t = t || {},
    [
      t.derivatives || e.envMapCubeUV || e.bumpMap || e.normalMap || e.flatShading
        ? "#extension GL_OES_standard_derivatives : enable"
        : "",
      (t.fragDepth || e.logarithmicDepthBuffer) && i.get("EXT_frag_depth")
        ? "#extension GL_EXT_frag_depth : enable"
        : "",
      t.drawBuffers && i.get("WEBGL_draw_buffers")
        ? "#extension GL_EXT_draw_buffers : require"
        : "",
      (t.shaderTextureLOD || e.envMap) && i.get("EXT_shader_texture_lod")
        ? "#extension GL_EXT_shader_texture_lod : enable"
        : ""
    ].filter(ee).join("\n")
  }
  function $t(t) {
    var e = [];
    for (var i in t) {
      var n = t[i];
      n !== !1 && e.push("#define " + i + " " + n)
    }
    return e.join("\n")
  }
  function te(t, e, i) {
    for (var n = {}, o = t.getProgramParameter(e, t.ACTIVE_ATTRIBUTES), r = 0; r < o; r++) {
      var a = t.getActiveAttrib(e, r),
        s = a.name;
      n[s] = t.getAttribLocation(e, s)
    }
    return n
  }
  function ee(t) {
    return "" !== t
  }
  function ie(t, e) {
    return t.replace(/NUM_DIR_LIGHTS/g, e.numDirLights).replace(/NUM_SPOT_LIGHTS/g, e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g, e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g, e.numPointLights).replace(/NUM_HEMI_LIGHTS/g, e.numHemiLights)
  }
  function ne(t) {
    function e(t, e) {
      var i = Ss[e];
      if (void 0 === i)
        throw new Error("Can not resolve #include <" + e + ">");
      return ne(i)
    }
    return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm, e)
  }
  function oe(t) {
    function e(t, e, i, n) {
      for (var o = "", r = parseInt(e); r < parseInt(i); r++)
        o += n.replace(/\[ i \]/g, "[ " + r + " ]");
      return o
    }
    return t.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g, e)
  }
  function re(t, e, i, n) {
    var o = t.context,
      r = i.extensions,
      a = i.defines,
      s = i.__webglShader.vertexShader,
      l = i.__webglShader.fragmentShader,
      c = "SHADOWMAP_TYPE_BASIC";
    n.shadowMapType === vr
      ? c = "SHADOWMAP_TYPE_PCF"
      : n.shadowMapType === yr && (c = "SHADOWMAP_TYPE_PCF_SOFT");
    var h = "ENVMAP_TYPE_CUBE",
      u = "ENVMAP_MODE_REFLECTION",
      d = "ENVMAP_BLENDING_MULTIPLY";
    if (n.envMap) {
      switch (i.envMap.mapping) {
        case ua:
        case da:
          h = "ENVMAP_TYPE_CUBE";
          break;
        case ga:
        case va:
          h = "ENVMAP_TYPE_CUBE_UV";
          break;
        case pa:
        case fa:
          h = "ENVMAP_TYPE_EQUIREC";
          break;
        case ma:
          h = "ENVMAP_TYPE_SPHERE"
      }
      switch (i.envMap.mapping) {
        case da:
        case fa:
          u = "ENVMAP_MODE_REFRACTION"
      }
      switch (i.combine) {
        case na:
          d = "ENVMAP_BLENDING_MULTIPLY";
          break;
        case oa:
          d = "ENVMAP_BLENDING_MIX";
          break;
        case ra:
          d = "ENVMAP_BLENDING_ADD"
      }
    }
    var p,
      f,
      m = t.gammaFactor > 0
        ? t.gammaFactor
        : 1,
      g = Jt(r, n, t.extensions),
      v = $t(a),
      y = o.createProgram();
    i.isRawShaderMaterial
      ? (p = [v, "\n"].filter(ee).join("\n"), f = [g, v, "\n"].filter(ee).join("\n"))
      : (p = [
        "precision " + n.precision + " float;",
        "precision " + n.precision + " int;",
        "#define SHADER_NAME " + i.__webglShader.name,
        v,
        n.supportsVertexTextures
          ? "#define VERTEX_TEXTURES"
          : "",
        "#define GAMMA_FACTOR " + m,
        "#define MAX_BONES " + n.maxBones,
        n.useFog && n.fog
          ? "#define USE_FOG"
          : "",
        n.useFog && n.fogExp
          ? "#define FOG_EXP2"
          : "",
        n.map
          ? "#define USE_MAP"
          : "",
        n.envMap
          ? "#define USE_ENVMAP"
          : "",
        n.envMap
          ? "#define " + u
          : "",
        n.lightMap
          ? "#define USE_LIGHTMAP"
          : "",
        n.aoMap
          ? "#define USE_AOMAP"
          : "",
        n.emissiveMap
          ? "#define USE_EMISSIVEMAP"
          : "",
        n.bumpMap
          ? "#define USE_BUMPMAP"
          : "",
        n.normalMap
          ? "#define USE_NORMALMAP"
          : "",
        n.displacementMap && n.supportsVertexTextures
          ? "#define USE_DISPLACEMENTMAP"
          : "",
        n.specularMap
          ? "#define USE_SPECULARMAP"
          : "",
        n.roughnessMap
          ? "#define USE_ROUGHNESSMAP"
          : "",
        n.metalnessMap
          ? "#define USE_METALNESSMAP"
          : "",
        n.alphaMap
          ? "#define USE_ALPHAMAP"
          : "",
        n.vertexColors
          ? "#define USE_COLOR"
          : "",
        n.flatShading
          ? "#define FLAT_SHADED"
          : "",
        n.skinning
          ? "#define USE_SKINNING"
          : "",
        n.useVertexTexture
          ? "#define BONE_TEXTURE"
          : "",
        n.morphTargets
          ? "#define USE_MORPHTARGETS"
          : "",
        n.morphNormals && n.flatShading === !1
          ? "#define USE_MORPHNORMALS"
          : "",
        n.doubleSided
          ? "#define DOUBLE_SIDED"
          : "",
        n.flipSided
          ? "#define FLIP_SIDED"
          : "",
        "#define NUM_CLIPPING_PLANES " + n.numClippingPlanes,
        n.shadowMapEnabled
          ? "#define USE_SHADOWMAP"
          : "",
        n.shadowMapEnabled
          ? "#define " + c
          : "",
        n.sizeAttenuation
          ? "#define USE_SIZEATTENUATION"
          : "",
        n.logarithmicDepthBuffer
          ? "#define USE_LOGDEPTHBUF"
          : "",
        n.logarithmicDepthBuffer && t.extensions.get("EXT_frag_depth")
          ? "#define USE_LOGDEPTHBUF_EXT"
          : "",
        "uniform mat4 modelMatrix;",
        "uniform mat4 modelViewMatrix;",
        "uniform mat4 projectionMatrix;",
        "uniform mat4 viewMatrix;",
        "uniform mat3 normalMatrix;",
        "uniform vec3 cameraPosition;",
        "attribute vec3 position;",
        "attribute vec3 normal;",
        "attribute vec2 uv;",
        "#ifdef USE_COLOR",
        "\tattribute vec3 color;",
        "#endif",
        "#ifdef USE_MORPHTARGETS",
        "\tattribute vec3 morphTarget0;",
        "\tattribute vec3 morphTarget1;",
        "\tattribute vec3 morphTarget2;",
        "\tattribute vec3 morphTarget3;",
        "\t#ifdef USE_MORPHNORMALS",
        "\t\tattribute vec3 morphNormal0;",
        "\t\tattribute vec3 morphNormal1;",
        "\t\tattribute vec3 morphNormal2;",
        "\t\tattribute vec3 morphNormal3;",
        "\t#else",
        "\t\tattribute vec3 morphTarget4;",
        "\t\tattribute vec3 morphTarget5;",
        "\t\tattribute vec3 morphTarget6;",
        "\t\tattribute vec3 morphTarget7;",
        "\t#endif",
        "#endif",
        "#ifdef USE_SKINNING",
        "\tattribute vec4 skinIndex;",
        "\tattribute vec4 skinWeight;",
        "#endif",
        "\n"
      ].filter(ee).join("\n"), f = [
        g, "precision " + n.precision + " float;",
        "precision " + n.precision + " int;",
        "#define SHADER_NAME " + i.__webglShader.name,
        v,
        n.alphaTest
          ? "#define ALPHATEST " + n.alphaTest
          : "",
        "#define GAMMA_FACTOR " + m,
        n.useFog && n.fog
          ? "#define USE_FOG"
          : "",
        n.useFog && n.fogExp
          ? "#define FOG_EXP2"
          : "",
        n.map
          ? "#define USE_MAP"
          : "",
        n.envMap
          ? "#define USE_ENVMAP"
          : "",
        n.envMap
          ? "#define " + h
          : "",
        n.envMap
          ? "#define " + u
          : "",
        n.envMap
          ? "#define " + d
          : "",
        n.lightMap
          ? "#define USE_LIGHTMAP"
          : "",
        n.aoMap
          ? "#define USE_AOMAP"
          : "",
        n.emissiveMap
          ? "#define USE_EMISSIVEMAP"
          : "",
        n.bumpMap
          ? "#define USE_BUMPMAP"
          : "",
        n.normalMap
          ? "#define USE_NORMALMAP"
          : "",
        n.specularMap
          ? "#define USE_SPECULARMAP"
          : "",
        n.roughnessMap
          ? "#define USE_ROUGHNESSMAP"
          : "",
        n.metalnessMap
          ? "#define USE_METALNESSMAP"
          : "",
        n.alphaMap
          ? "#define USE_ALPHAMAP"
          : "",
        n.vertexColors
          ? "#define USE_COLOR"
          : "",
        n.gradientMap
          ? "#define USE_GRADIENTMAP"
          : "",
        n.flatShading
          ? "#define FLAT_SHADED"
          : "",
        n.doubleSided
          ? "#define DOUBLE_SIDED"
          : "",
        n.flipSided
          ? "#define FLIP_SIDED"
          : "",
        "#define NUM_CLIPPING_PLANES " + n.numClippingPlanes,
        "#define UNION_CLIPPING_PLANES " + (
        n.numClippingPlanes - n.numClipIntersection),
        n.shadowMapEnabled
          ? "#define USE_SHADOWMAP"
          : "",
        n.shadowMapEnabled
          ? "#define " + c
          : "",
        n.premultipliedAlpha
          ? "#define PREMULTIPLIED_ALPHA"
          : "",
        n.physicallyCorrectLights
          ? "#define PHYSICALLY_CORRECT_LIGHTS"
          : "",
        n.logarithmicDepthBuffer
          ? "#define USE_LOGDEPTHBUF"
          : "",
        n.logarithmicDepthBuffer && t.extensions.get("EXT_frag_depth")
          ? "#define USE_LOGDEPTHBUF_EXT"
          : "",
        n.envMap && t.extensions.get("EXT_shader_texture_lod")
          ? "#define TEXTURE_LOD_EXT"
          : "",
        "uniform mat4 viewMatrix;",
        "uniform vec3 cameraPosition;",
        n.toneMapping !== aa
          ? "#define TONE_MAPPING"
          : "",
        n.toneMapping !== aa
          ? Ss.tonemapping_pars_fragment
          : "",
        n.toneMapping !== aa
          ? Qt("toneMapping", n.toneMapping)
          : "",
        n.dithering
          ? "#define DITHERING"
          : "",
        n.outputEncoding || n.mapEncoding || n.envMapEncoding || n.emissiveMapEncoding
          ? Ss.encodings_pars_fragment
          : "",
        n.mapEncoding
          ? Zt("mapTexelToLinear", n.mapEncoding)
          : "",
        n.envMapEncoding
          ? Zt("envMapTexelToLinear", n.envMapEncoding)
          : "",
        n.emissiveMapEncoding
          ? Zt("emissiveMapTexelToLinear", n.emissiveMapEncoding)
          : "",
        n.outputEncoding
          ? Kt("linearToOutputTexel", n.outputEncoding)
          : "",
        n.depthPacking
          ? "#define DEPTH_PACKING " + i.depthPacking
          : "",
        "\n"
      ].filter(ee).join("\n")),
    s = ne(s, n),
    s = ie(s, n),
    l = ne(l, n),
    l = ie(l, n),
    i.isShaderMaterial || (s = oe(s), l = oe(l));
    var E = p + s,
      x = f + l,
      b = Xt(o, o.VERTEX_SHADER, E),
      w = Xt(o, o.FRAGMENT_SHADER, x);
    o.attachShader(y, b),
    o.attachShader(y, w),
    void 0 !== i.index0AttributeName
      ? o.bindAttribLocation(y, 0, i.index0AttributeName)
      : n.morphTargets === !0 && o.bindAttribLocation(y, 0, "position"),
    o.linkProgram(y);
    var C = o.getProgramInfoLog(y),
      T = o.getShaderInfoLog(b),
      _ = o.getShaderInfoLog(w),
      L = !0,
      M = !0;
    o.getProgramParameter(y, o.LINK_STATUS) === !1
      ? (L = !1, console.error("THREE.WebGLProgram: shader error: ", o.getError(), "gl.VALIDATE_STATUS", o.getProgramParameter(y, o.VALIDATE_STATUS), "gl.getProgramInfoLog", C, T, _))
      : "" !== C
        ? console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()", C)
        : "" !== T && "" !== _ || (M = !1),
    M && (this.diagnostics = {
      runnable: L,
      material: i,
      programLog: C,
      vertexShader: {
        log: T,
        prefix: p
      },
      fragmentShader: {
        log: _,
        prefix: f
      }
    }),
    o.deleteShader(b),
    o.deleteShader(w);
    var S;
    this.getUniforms = function() {
      return void 0 === S && (S = new W(o, y, t)),
      S
    };
    var O;
    return this.getAttributes = function() {
      return void 0 === O && (O = te(o, y)),
      O
    },
    this.destroy = function() {
      o.deleteProgram(y),
      this.program = void 0
    },
    Object.defineProperties(this, {
      uniforms: {
        get: function() {
          return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),
          this.getUniforms()
        }
      },
      attributes: {
        get: function() {
          return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),
          this.getAttributes()
        }
      }
    }),
    this.id = As++,
    this.code = e,
    this.usedTimes = 1,
    this.program = y,
    this.vertexShader = b,
    this.fragmentShader = w,
    this
  }
  function ae(t, e) {
    function i(t) {
      var i = t.skeleton,
        n = i.bones;
      if (e.floatVertexTextures)
        return 1024;
      var o = e.maxVertexUniforms,
        r = Math.floor((o - 20) / 4),
        a = Math.min(r, n.length);
      return a < n.length
        ? (console.warn("THREE.WebGLRenderer: Skeleton has " + n.length + " bones. This GPU supports " + a + "."), 0)
        : a
    }
    function n(t, e) {
      var i;
      return t
        ? t.isTexture
          ? i = t.encoding
          : t.isWebGLRenderTarget && (console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."), i = t.texture.encoding)
        : i = ss,
      i === ss && e && (i = cs),
      i
    }
    var o = [],
      r = {
        MeshDepthMaterial: "depth",
        MeshNormalMaterial: "normal",
        MeshBasicMaterial: "basic",
        MeshLambertMaterial: "lambert",
        MeshPhongMaterial: "phong",
        MeshToonMaterial: "phong",
        MeshStandardMaterial: "physical",
        MeshPhysicalMaterial: "physical",
        LineBasicMaterial: "basic",
        LineDashedMaterial: "dashed",
        PointsMaterial: "points"
      },
      a = [
        "precision",
        "supportsVertexTextures",
        "map",
        "mapEncoding",
        "envMap",
        "envMapMode",
        "envMapEncoding",
        "lightMap",
        "aoMap",
        "emissiveMap",
        "emissiveMapEncoding",
        "bumpMap",
        "normalMap",
        "displacementMap",
        "specularMap",
        "roughnessMap",
        "metalnessMap",
        "gradientMap",
        "alphaMap",
        "combine",
        "vertexColors",
        "fog",
        "useFog",
        "fogExp",
        "flatShading",
        "sizeAttenuation",
        "logarithmicDepthBuffer",
        "skinning",
        "maxBones",
        "useVertexTexture",
        "morphTargets",
        "morphNormals",
        "maxMorphTargets",
        "maxMorphNormals",
        "premultipliedAlpha",
        "numDirLights",
        "numPointLights",
        "numSpotLights",
        "numHemiLights",
        "numRectAreaLights",
        "shadowMapEnabled",
        "shadowMapType",
        "toneMapping",
        "physicallyCorrectLights",
        "alphaTest",
        "doubleSided",
        "flipSided",
        "numClippingPlanes",
        "numClipIntersection",
        "depthPacking",
        "dithering"
      ];
    this.getParameters = function(o, a, s, l, c, h) {
      var u = r[o.type],
        d = h.isSkinnedMesh
          ? i(h)
          : 0,
        p = t.getPrecision();
      null !== o.precision && (p = e.getMaxPrecision(o.precision)) !== o.precision && console.warn("THREE.WebGLProgram.getParameters:", o.precision, "not supported, using", p, "instead.");
      var f = t.getRenderTarget();
      return {
        shaderID: u,
        precision: p,
        supportsVertexTextures: e.vertexTextures,
        outputEncoding: n(
          f
          ? f.texture
          : null,
        t.gammaOutput),
        map: !!o.map,
        mapEncoding: n(o.map, t.gammaInput),
        envMap: !!o.envMap,
        envMapMode: o.envMap && o.envMap.mapping,
        envMapEncoding: n(o.envMap, t.gammaInput),
        envMapCubeUV: !!o.envMap && (o.envMap.mapping === ga || o.envMap.mapping === va),
        lightMap: !!o.lightMap,
        aoMap: !!o.aoMap,
        emissiveMap: !!o.emissiveMap,
        emissiveMapEncoding: n(o.emissiveMap, t.gammaInput),
        bumpMap: !!o.bumpMap,
        normalMap: !!o.normalMap,
        displacementMap: !!o.displacementMap,
        roughnessMap: !!o.roughnessMap,
        metalnessMap: !!o.metalnessMap,
        specularMap: !!o.specularMap,
        alphaMap: !!o.alphaMap,
        gradientMap: !!o.gradientMap,
        combine: o.combine,
        vertexColors: o.vertexColors,
        fog: !!s,
        useFog: o.fog,
        fogExp: s && s.isFogExp2,
        flatShading: o.shading === wr,
        sizeAttenuation: o.sizeAttenuation,
        logarithmicDepthBuffer: e.logarithmicDepthBuffer,
        skinning: o.skinning && d > 0,
        maxBones: d,
        useVertexTexture: e.floatVertexTextures,
        morphTargets: o.morphTargets,
        morphNormals: o.morphNormals,
        maxMorphTargets: t.maxMorphTargets,
        maxMorphNormals: t.maxMorphNormals,
        numDirLights: a.directional.length,
        numPointLights: a.point.length,
        numSpotLights: a.spot.length,
        numRectAreaLights: a.rectArea.length,
        numHemiLights: a.hemi.length,
        numClippingPlanes: l,
        numClipIntersection: c,
        dithering: o.dithering,
        shadowMapEnabled: t.shadowMap.enabled && h.receiveShadow && a.shadows.length > 0,
        shadowMapType: t.shadowMap.type,
        toneMapping: t.toneMapping,
        physicallyCorrectLights: t.physicallyCorrectLights,
        premultipliedAlpha: o.premultipliedAlpha,
        alphaTest: o.alphaTest,
        doubleSided: o.side === br,
        flipSided: o.side === xr,
        depthPacking: void 0 !== o.depthPacking && o.depthPacking
      }
    },
    this.getProgramCode = function(t, e) {
      var i = [];
      if (
        e.shaderID
        ? i.push(e.shaderID)
        : (i.push(t.fragmentShader), i.push(t.vertexShader)),
      void 0 !== t.defines)
        for (var n in t.defines)
          i.push(n),
          i.push(t.defines[n]);
    for (var o = 0; o < a.length; o++)
        i.push(e[a[o]]);
      return i.join()
    },
    this.acquireProgram = function(e, i, n) {
      for (var r, a = 0, s = o.length; a < s; a++) {
        var l = o[a];
        if (l.code === n) {
          r = l, = r.usedTimes + 1;
          break
        }
      }
      return void 0 === r && (r = new re(t, n, e, i), o.push(r)),
      r
    },
    this.releaseProgram = function(t) {
      if (0 == --t.usedTimes) {
        var e = o.indexOf(t);
        o[e] = o[o.length - 1],
        o.pop(),
        t.destroy()
      }
    },
    this.programs = o
  }
  function se(t, e, i, n, o, r, a) {
    function s(t, e) {
      if (t.width > e || t.height > e) {
        var i = e / Math.max(t.width, t.height),
          n = document.createElementNS("http://www.w3.org/1999/xhtml", "canvas");
        n.width = Math.floor(t.width * i),
        n.height = Math.floor(t.height * i);
        return n.getContext("2d").drawImage(t, 0, 0, t.width, t.height, 0, 0, n.width, n.height),
        console.warn("THREE.WebGLRenderer: image is too big (" + t.width + "x" + t.height + "). Resized to " + n.width + "x" + n.height, t),
        n
      }
      return t
    }
    function l(t) {
      return gs.isPowerOfTwo(t.width) && gs.isPowerOfTwo(t.height)
    }
    function c(t) {
      if (t instanceof HTMLImageElement || t instanceof HTMLCanvasElement) {
        var e = document.createElementNS("http://www.w3.org/1999/xhtml", "canvas");
        e.width = gs.nearestPowerOfTwo(t.width),
        e.height = gs.nearestPowerOfTwo(t.height);
        return e.getContext("2d").drawImage(t, 0, 0, e.width, e.height),
        console.warn("THREE.WebGLRenderer: image is not power of two (" + t.width + "x" + t.height + "). Resized to " + e.width + "x" + e.height, t),
        e
      }
      return t
    }
    function h(t) {
      return t.wrapS !== Ea || t.wrapT !== Ea || t.minFilter !== ba && t.minFilter !== Ta
    }
    function u(e) {
      return e === ba || e === wa || e === Ca
        ? t.NEAREST
        : t.LINEAR
    }
    function d(t) {
      var e = t.target;
      e.removeEventListener("dispose", d),
      f(e),
      a.textures--
    }
    function p(t) {
      var e = t.target;
      e.removeEventListener("dispose", p),
      m(e),
      a.textures--
    }
    function f(e) {
      var i = n.get(e);
      if (e.image && i.__image__webglTextureCube)
        t.deleteTexture(i.__image__webglTextureCube);
      else {
        if (void 0 === i.__webglInit)
          return;
        t.deleteTexture(i.__webglTexture)
      }
      n.remove(e)
    }
    function m(e) {
      var i = n.get(e),
        o = n.get(e.texture);
      if (e) {
        if (void 0 !== o.__webglTexture && t.deleteTexture(o.__webglTexture), e.depthTexture && e.depthTexture.dispose(), e.isWebGLRenderTargetCube)
          for (var r = 0; r < 6; r++)
            t.deleteFramebuffer(i.__webglFramebuffer[r]),
            i.__webglDepthbuffer && t.deleteRenderbuffer(i.__webglDepthbuffer[r]);
      else
          t.deleteFramebuffer(i.__webglFramebuffer),
          i.__webglDepthbuffer && t.deleteRenderbuffer(i.__webglDepthbuffer);
        n.remove(e.texture),
        n.remove(e)
      }
    }
    function g(e, o) {
      var r = n.get(e);
      if (e.version > 0 && r.__version !== e.version) {
        var a = e.image;
        if (void 0 === a)
          console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined", e);
        else {
          if (a.complete !== !1)
            return void x(r, e, o);
          console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete", e)
        }
      }
      i.activeTexture(t.TEXTURE0 + o),
      i.bindTexture(t.TEXTURE_2D, r.__webglTexture)
    }
    function v(e, c) {
      var h = n.get(e);
      if (6 === e.image.length)
        if (e.version > 0 && h.__version !== e.version) {
          h.__image__webglTextureCube || (e.addEventListener("dispose", d), h.__image__webglTextureCube = t.createTexture(), a.textures++),
          i.activeTexture(t.TEXTURE0 + c),
          i.bindTexture(t.TEXTURE_CUBE_MAP, h.__image__webglTextureCube),
          t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL, e.flipY);
          for (var u = e && e.isCompressedTexture, p = e.image[0] && e.image[0].isDataTexture, f = [], m = 0; m < 6; m++)
            f[m] = u || p
              ? p
                ? e.image[m].image
                : e.image[m]
              : s(e.image[m], o.maxCubemapSize);
          var g = f[0],
            v = l(g),
            y = r(e.format),
            x = r(e.type);
          E(t.TEXTURE_CUBE_MAP, e, v);
          for (var m = 0; m < 6; m++)
            if (u)
              for (var b, w = f[m].mipmaps, C = 0, T = w.length; C < T; C++)
                b = w[C],
                e.format !== Ga && e.format !== Fa
                  ? i.getCompressedTextureFormats().indexOf(y) > -1
                    ? i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X + m, C, y, b.width, b.height, 0, b.data)
                    : console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()")
                  : i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X + m, C, y, b.width, b.height, 0, y, x, b.data);
          else
            p
              ? i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X + m, 0, y, f[m].width, f[m].height, 0, y, x, f[m].data)
              : i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X + m, 0, y, y, x, f[m]);
          e.generateMipmaps && v && t.generateMipmap(t.TEXTURE_CUBE_MAP),
          h.__version = e.version,
          e.onUpdate && e.onUpdate(e)
        } else
          i.activeTexture(t.TEXTURE0 + c),
          i.bindTexture(t.TEXTURE_CUBE_MAP, h.__image__webglTextureCube)
    }
    function y(e, o) {
      i.activeTexture(t.TEXTURE0 + o),
      i.bindTexture(t.TEXTURE_CUBE_MAP, n.get(e).__webglTexture)
    }
    function E(i, a, s) {
      var l;
      if (
        s
        ? (t.texParameteri(i, t.TEXTURE_WRAP_S, r(a.wrapS)), t.texParameteri(i, t.TEXTURE_WRAP_T, r(a.wrapT)), t.texParameteri(i, t.TEXTURE_MAG_FILTER, r(a.magFilter)), t.texParameteri(i, t.TEXTURE_MIN_FILTER, r(a.minFilter)))
        : (t.texParameteri(i, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE), t.texParameteri(i, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE), a.wrapS === Ea && a.wrapT === Ea || console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.", a), t.texParameteri(i, t.TEXTURE_MAG_FILTER, u(a.magFilter)), t.texParameteri(i, t.TEXTURE_MIN_FILTER, u(a.minFilter)), a.minFilter !== ba && a.minFilter !== Ta && console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.", a)),
      l = e.get("EXT_texture_filter_anisotropic")) {
        if (a.type === Aa && null === e.get("OES_texture_float_linear"))
          return;
        if (a.type === Ia && null === e.get("OES_texture_half_float_linear"))
          return;

        (a.anisotropy > 1 || n.get(a).__currentAnisotropy) && (t.texParameterf(i, l.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(a.anisotropy, o.getMaxAnisotropy())), n.get(a).__currentAnisotropy = a.anisotropy)
      }
    }
    function x(e, n, u) {
      void 0 === e.__webglInit && (e.__webglInit = !0, n.addEventListener("dispose", d), e.__webglTexture = t.createTexture(), a.textures++),
      i.activeTexture(t.TEXTURE0 + u),
      i.bindTexture(t.TEXTURE_2D, e.__webglTexture),
      t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL, n.flipY),
      t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL, n.premultiplyAlpha),
      t.pixelStorei(t.UNPACK_ALIGNMENT, n.unpackAlignment);
      var p = s(n.image, o.maxTextureSize);
      h(n) && l(p) === !1 && (p = c(p));
      var f = l(p),
        m = r(n.format),
        g = r(n.type);
      E(t.TEXTURE_2D, n, f);
      var v,
        y = n.mipmaps;
      if (n.isDepthTexture) {
        var x = t.DEPTH_COMPONENT;
        if (n.type === Aa) {
          if (!M)
            throw new Error("Float Depth Texture only supported in WebGL2.0");
          x = t.DEPTH_COMPONENT32F
        } else
          M && (x = t.DEPTH_COMPONENT16);
        n.format === Wa && x === t.DEPTH_COMPONENT && n.type !== Da && n.type !== Ua && (console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."), n.type = Da, g = r(n.type)),
        n.format === ja && (x = t.DEPTH_STENCIL, n.type !== ka && (console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."), n.type = ka, g = r(n.type))),
        i.texImage2D(t.TEXTURE_2D, 0, x, p.width, p.height, 0, m, g, null)
      } else if (n.isDataTexture)
        if (y.length > 0 && f) {
          for (var b = 0, w = y.length; b < w; b++)
            v = y[b],
            i.texImage2D(t.TEXTURE_2D, b, m, v.width, v.height, 0, m, g, v.data);
          n.generateMipmaps = !1
        } else
          i.texImage2D(t.TEXTURE_2D, 0, m, p.width, p.height, 0, m, g, p.data);
    else if (n.isCompressedTexture)
        for (var b = 0, w = y.length; b < w; b++)
          v = y[b],
          n.format !== Ga && n.format !== Fa
            ? i.getCompressedTextureFormats().indexOf(m) > -1
              ? i.compressedTexImage2D(t.TEXTURE_2D, b, m, v.width, v.height, 0, v.data)
              : console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")
            : i.texImage2D(t.TEXTURE_2D, b, m, v.width, v.height, 0, m, g, v.data);
        else if (y.length > 0 && f) {
          for (var b = 0, w = y.length; b < w; b++)
            v = y[b],
            i.texImage2D(t.TEXTURE_2D, b, m, m, g, v);
          n.generateMipmaps = !1
        }
      else
        i.texImage2D(t.TEXTURE_2D, 0, m, m, g, p);
      n.generateMipmaps && f && t.generateMipmap(t.TEXTURE_2D),
      e.__version = n.version,
      n.onUpdate && n.onUpdate(n)
    }
    function b(e, o, a, s) {
      var l = r(o.texture.format),
        c = r(o.texture.type);
      i.texImage2D(s, 0, l, o.width, o.height, 0, l, c, null),
      t.bindFramebuffer(t.FRAMEBUFFER, e),
      t.framebufferTexture2D(t.FRAMEBUFFER, a, s, n.get(o.texture).__webglTexture, 0),
      t.bindFramebuffer(t.FRAMEBUFFER, null)
    }
    function w(e, i) {
      t.bindRenderbuffer(t.RENDERBUFFER, e),
      i.depthBuffer && !i.stencilBuffer
        ? (t.renderbufferStorage(t.RENDERBUFFER, t.DEPTH_COMPONENT16, i.width, i.height), t.framebufferRenderbuffer(t.FRAMEBUFFER, t.DEPTH_ATTACHMENT, t.RENDERBUFFER, e))
        : i.depthBuffer && i.stencilBuffer
          ? (t.renderbufferStorage(t.RENDERBUFFER, t.DEPTH_STENCIL, i.width, i.height), t.framebufferRenderbuffer(t.FRAMEBUFFER, t.DEPTH_STENCIL_ATTACHMENT, t.RENDERBUFFER, e))
          : t.renderbufferStorage(t.RENDERBUFFER, t.RGBA4, i.width, i.height),
      t.bindRenderbuffer(t.RENDERBUFFER, null)
    }
    function C(e, i) {
      if (i && i.isWebGLRenderTargetCube)
        throw new Error("Depth Texture with cube render targets is not supported!");
      if (t.bindFramebuffer(t.FRAMEBUFFER, e), !i.depthTexture || !i.depthTexture.isDepthTexture)
        throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");
      n.get(i.depthTexture).__webglTexture && i.depthTexture.image.width === i.width && i.depthTexture.image.height === i.height || (i.depthTexture.image.width = i.width, i.depthTexture.image.height = i.height, i.depthTexture.needsUpdate = !0),
      g(i.depthTexture, 0);
      var o = n.get(i.depthTexture).__webglTexture;
      if (i.depthTexture.format === Wa)
        t.framebufferTexture2D(t.FRAMEBUFFER, t.DEPTH_ATTACHMENT, t.TEXTURE_2D, o, 0);
      else {
        if (i.depthTexture.format !== ja)
          throw new Error("Unknown depthTexture format");
        t.framebufferTexture2D(t.FRAMEBUFFER, t.DEPTH_STENCIL_ATTACHMENT, t.TEXTURE_2D, o, 0)
      }
    }
    function T(e) {
      var i = n.get(e),
        o = e.isWebGLRenderTargetCube === !0;
      if (e.depthTexture) {
        if (o)
          throw new Error("target.depthTexture not supported in Cube render targets");
        C(i.__webglFramebuffer, e)
      } else if (o) {
        i.__webglDepthbuffer = [];
        for (var r = 0; r < 6; r++)
          t.bindFramebuffer(t.FRAMEBUFFER, i.__webglFramebuffer[r]),
          i.__webglDepthbuffer[r] = t.createRenderbuffer(),
          w(i.__webglDepthbuffer[r], e)
      } else
        t.bindFramebuffer(t.FRAMEBUFFER, i.__webglFramebuffer),
        i.__webglDepthbuffer = t.createRenderbuffer(),
        w(i.__webglDepthbuffer, e);
      t.bindFramebuffer(t.FRAMEBUFFER, null)
    }
    function _(e) {
      var o = n.get(e),
        r = n.get(e.texture);
      e.addEventListener("dispose", p),
      r.__webglTexture = t.createTexture(),
      a.textures++;
      var s = e.isWebGLRenderTargetCube === !0,
        c = l(e);
      if (s) {
        o.__webglFramebuffer = [];
        for (var h = 0; h < 6; h++)
          o.__webglFramebuffer[h] = t.createFramebuffer()
      } else
        o.__webglFramebuffer = t.createFramebuffer();
      if (s) {
        i.bindTexture(t.TEXTURE_CUBE_MAP, r.__webglTexture),
        E(t.TEXTURE_CUBE_MAP, e.texture, c);
        for (var h = 0; h < 6; h++)
          b(o.__webglFramebuffer[h], e, t.COLOR_ATTACHMENT0, t.TEXTURE_CUBE_MAP_POSITIVE_X + h);
        e.texture.generateMipmaps && c && t.generateMipmap(t.TEXTURE_CUBE_MAP),
        i.bindTexture(t.TEXTURE_CUBE_MAP, null)
      } else
        i.bindTexture(t.TEXTURE_2D, r.__webglTexture),
        E(t.TEXTURE_2D, e.texture, c),
        b(o.__webglFramebuffer, e, t.COLOR_ATTACHMENT0, t.TEXTURE_2D),
        e.texture.generateMipmaps && c && t.generateMipmap(t.TEXTURE_2D),
        i.bindTexture(t.TEXTURE_2D, null);
      e.depthBuffer && T(e)
    }
    function L(e) {
      var o = e.texture;
      if (o.generateMipmaps && l(e) && o.minFilter !== ba && o.minFilter !== Ta) {
        var r = e && e.isWebGLRenderTargetCube
            ? t.TEXTURE_CUBE_MAP
            : t.TEXTURE_2D,
          a = n.get(o).__webglTexture;
        i.bindTexture(r, a),
        t.generateMipmap(r),
        i.bindTexture(r, null)
      }
    }
    var M = "undefined" != typeof WebGL2RenderingContext && t instanceof WebGL2RenderingContext;
    this.setTexture2D = g,
    this.setTextureCube = v,
    this.setTextureCubeDynamic = y,
    this.setupRenderTarget = _,
    this.updateRenderTargetMipmap = L
  }
  function le() {
    function t(t) {
      var e = t.uuid,
        i = n[e];
      return void 0 === i && (i = {}, n[e] = i),
      i
    }
    function e(t) {
      delete n[t.uuid]
    }
    function i() {
      n = {}
    }
    var n = {};
    return {get: t, remove: e, clear: i}
  }
  function ce(t, e, i) {
    function n() {
      var e = !1,
        i = new o,
        n = null,
        r = new o;
      return {
        setMask: function(i) {
          n === i || e || (t.colorMask(i, i, i, i), n = i)
        },
        setLocked: function(t) {
          e = t
        },
        setClear: function(e, n, o, a, s) {
          s === !0 && (e *= a, n *= a, o *= a),
          i.set(e, n, o, a),
          r.equals(i) === !1 && (t.clearColor(e, n, o, a), r.copy(i))
        },
        reset: function() {
          e = !1,
          n = null,
          r.set(0, 0, 0, 1)
        }
      }
    }
    function r() {
      var e = !1,
        i = null,
        n = null,
        o = null;
      return {
        setTest: function(e) {
          e
            ? p(t.DEPTH_TEST)
            : f(t.DEPTH_TEST)
        },
        setMask: function(n) {
          i === n || e || (t.depthMask(n), i = n)
        },
        setFunc: function(e) {
          if (n !== e) {
            if (e)
              switch (e) {
                case Zr:
                  t.depthFunc(t.NEVER);
                  break;
                case Kr:
                  t.depthFunc(t.ALWAYS);
                  break;
                case Qr:
                  t.depthFunc(t.LESS);
                  break;
                case Jr:
                  t.depthFunc(t.LEQUAL);
                  break;
                case $r:
                  t.depthFunc(t.EQUAL);
                  break;
                case ta:
                  t.depthFunc(t.GEQUAL);
                  break;
                case ea:
                  t.depthFunc(t.GREATER);
                  break;
                case ia:
                  t.depthFunc(t.NOTEQUAL);
                  break;
                default:
                  t.depthFunc(t.LEQUAL)
              }
            else
              t.depthFunc(t.LEQUAL);
            n = e
          }
        },
        setLocked: function(t) {
          e = t
        },
        setClear: function(e) {
          o !== e && (t.clearDepth(e), o = e)
        },
        reset: function() {
          e = !1,
          i = null,
          n = null,
          o = null
        }
      }
    }
    function a() {
      var e = !1,
        i = null,
        n = null,
        o = null,
        r = null,
        a = null,
        s = null,
        l = null,
        c = null;
      return {
        setTest: function(e) {
          e
            ? p(t.STENCIL_TEST)
            : f(t.STENCIL_TEST)
        },
        setMask: function(n) {
          i === n || e || (t.stencilMask(n), i = n)
        },
        setFunc: function(e, i, a) {
          n === e && o === i && r === a || (t.stencilFunc(e, i, a), n = e, o = i, r = a)
        },
        setOp: function(e, i, n) {
          a === e && s === i && l === n || (t.stencilOp(e, i, n), a = e, s = i, l = n)
        },
        setLocked: function(t) {
          e = t
        },
        setClear: function(e) {
          c !== e && (t.clearStencil(e), c = e)
        },
        reset: function() {
          e = !1,
          i = null,
          n = null,
          o = null,
          r = null,
          a = null,
          s = null,
          l = null,
          c = null
        }
      }
    }
    function s(e, i, n) {
      var o = new Uint8Array(4),
        r = t.createTexture();
      t.bindTexture(e, r),
      t.texParameteri(e, t.TEXTURE_MIN_FILTER, t.NEAREST),
      t.texParameteri(e, t.TEXTURE_MAG_FILTER, t.NEAREST);
      for (var a = 0; a < n; a++)
        t.texImage2D(i + a, 0, t.RGBA, 1, 1, 0, t.RGBA, t.UNSIGNED_BYTE, o);
      return r
    }
    function l() {
      R.setClear(0, 0, 0, 1),
      U.setClear(1),
      A.setClear(0),
      p(t.DEPTH_TEST),
      U.setFunc(Jr),
      y(!1),
      E(fr),
      p(t.CULL_FACE),
      p(t.BLEND),
      g(Sr)
    }
    function c() {
      for (var t = 0, e = P.length; t < e; t++)
        P[t] = 0
    }
    function h(i) {
      if (P[i] = 1, 0 === B[i] && (t.enableVertexAttribArray(i), B[i] = 1), 0 !== N[i]) {
        e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i, 0),
        N[i] = 0
      }
    }
    function u(i, n) {
      if (P[i] = 1, 0 === B[i] && (t.enableVertexAttribArray(i), B[i] = 1), N[i] !== n) {
        e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i, n),
        N[i] = n
      }
    }
    function d() {
      for (var e = 0, i = B.length; e !== i; ++e)
        B[e] !== P[e] && (t.disableVertexAttribArray(e), B[e] = 0)
    }
    function p(e) {
      k[e] !== !0 && (t.enable(e), k[e] = !0)
    }
    function f(e) {
      k[e] !== !1 && (t.disable(e), k[e] = !1)
    }
    function m() {
      if (null === H && (H = [], e.get("WEBGL_compressed_texture_pvrtc") || e.get("WEBGL_compressed_texture_s3tc") || e.get("WEBGL_compressed_texture_etc1")))
        for (var i = t.getParameter(t.COMPRESSED_TEXTURE_FORMATS), n = 0; n < i.length; n++)
          H.push(i[n]);
    return H
    }
    function g(e, n, o, r, a, s, l, c) {
      e !== Mr
        ? p(t.BLEND)
        : f(t.BLEND),
      e === F && c === X || (
        e === Or
        ? c
          ? (t.blendEquationSeparate(t.FUNC_ADD, t.FUNC_ADD), t.blendFuncSeparate(t.ONE, t.ONE, t.ONE, t.ONE))
          : (t.blendEquation(t.FUNC_ADD), t.blendFunc(t.SRC_ALPHA, t.ONE))
        : e === Dr
          ? c
            ? (t.blendEquationSeparate(t.FUNC_ADD, t.FUNC_ADD), t.blendFuncSeparate(t.ZERO, t.ZERO, t.ONE_MINUS_SRC_COLOR, t.ONE_MINUS_SRC_ALPHA))
            : (t.blendEquation(t.FUNC_ADD), t.blendFunc(t.ZERO, t.ONE_MINUS_SRC_COLOR))
          : e === Rr
            ? c
              ? (t.blendEquationSeparate(t.FUNC_ADD, t.FUNC_ADD), t.blendFuncSeparate(t.ZERO, t.SRC_COLOR, t.ZERO, t.SRC_ALPHA))
              : (t.blendEquation(t.FUNC_ADD), t.blendFunc(t.ZERO, t.SRC_COLOR))
            : c
              ? (t.blendEquationSeparate(t.FUNC_ADD, t.FUNC_ADD), t.blendFuncSeparate(t.ONE, t.ONE_MINUS_SRC_ALPHA, t.ONE, t.ONE_MINUS_SRC_ALPHA))
              : (t.blendEquationSeparate(t.FUNC_ADD, t.FUNC_ADD), t.blendFuncSeparate(t.SRC_ALPHA, t.ONE_MINUS_SRC_ALPHA, t.ONE, t.ONE_MINUS_SRC_ALPHA)),
      F = e,
      X = c),
      e === Ur
        ? (a = a || n, s = s || o, l = l || r, n === G && a === q || (t.blendEquationSeparate(i(n), i(a)), G = n, q = a), o === V && r === z && s === W && l === j || (t.blendFuncSeparate(i(o), i(r), i(s), i(l)), V = o, z = r, W = s, j = l))
        : (G = null, V = null, z = null, q = null, W = null, j = null)
    }
    function v(e) {
      e.side === br
        ? f(t.CULL_FACE)
        : p(t.CULL_FACE),
      y(e.side === xr),
      e.transparent === !0
        ? g(e.blending, e.blendEquation, e.blendSrc, e.blendDst, e.blendEquationAlpha, e.blendSrcAlpha, e.blendDstAlpha, e.premultipliedAlpha)
        : g(Mr),
      U.setFunc(e.depthFunc),
      U.setTest(e.depthTest),
      U.setMask(e.depthWrite),
      R.setMask(e.colorWrite),
      b(e.polygonOffset, e.polygonOffsetFactor, e.polygonOffsetUnits)
    }
    function y(e) {
      Y !== e && (
        e
        ? t.frontFace(t.CW)
        : t.frontFace(t.CCW),
      Y = e)
    }
    function E(e) {
      e !== pr
        ? (p(t.CULL_FACE), e !== Z && (
          e === fr
          ? t.cullFace(t.BACK)
          : e === mr
            ? t.cullFace(t.FRONT)
            : t.cullFace(t.FRONT_AND_BACK)))
        : f(t.CULL_FACE),
      Z = e
    }
    function x(e) {
      e !== K && (it && t.lineWidth(e), K = e)
    }
    function b(e, i, n) {
      e
        ? (p(t.POLYGON_OFFSET_FILL), Q === i && J === n || (t.polygonOffset(i, n), Q = i, J = n))
        : f(t.POLYGON_OFFSET_FILL)
    }
    function w() {
      return $
    }
    function C(e) {
      $ = e,
      e
        ? p(t.SCISSOR_TEST)
        : f(t.SCISSOR_TEST)
    }
    function T(e) {
      void 0 === e && (e = t.TEXTURE0 + tt - 1),
      nt !== e && (t.activeTexture(e), nt = e)
    }
    function _(e, i) {
      null === nt && T();
      var n = ot[nt];
      void 0 === n && (n = {
        type: void 0,
        texture: void 0
      }, ot[nt] = n),
      n.type === e && n.texture === i || (t.bindTexture(e, i || st[e]), n.type = e, n.texture = i)
    }
    function L() {
      try {
        t.compressedTexImage2D.apply(t, arguments)
      } catch (t) {
        console.error(t)
      }
    }
    function M() {
      try {
        t.texImage2D.apply(t, arguments)
      } catch (t) {
        console.error(t)
      }
    }
    function S(e) {
      rt.equals(e) === !1 && (t.scissor(e.x, e.y, e.z, e.w), rt.copy(e))
    }
    function O(e) {
      at.equals(e) === !1 && (t.viewport(e.x, e.y, e.z, e.w), at.copy(e))
    }
    function D() {
      for (var e = 0; e < B.length; e++)
        1 === B[e] && (t.disableVertexAttribArray(e), B[e] = 0);
      k = {},
      H = null,
      nt = null,
      ot = {},
      F = null,
      Y = null,
      Z = null,
      R.reset(),
      U.reset(),
      A.reset()
    }
    var R = new n,
      U = new r,
      A = new a,
      I = t.getParameter(t.MAX_VERTEX_ATTRIBS),
      P = new Uint8Array(I),
      B = new Uint8Array(I),
      N = new Uint8Array(I),
      k = {},
      H = null,
      F = null,
      G = null,
      V = null,
      z = null,
      q = null,
      W = null,
      j = null,
      X = !1,
      Y = null,
      Z = null,
      K = null,
      Q = null,
      J = null,
      $ = null,
      tt = t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),
      et = parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),
      it = parseFloat(et) >= 1,
      nt = null,
      ot = {},
      rt = new o,
      at = new o,
      st = {};
    return st[t.TEXTURE_2D] = s(t.TEXTURE_2D, t.TEXTURE_2D, 1),
    st[t.TEXTURE_CUBE_MAP] = s(t.TEXTURE_CUBE_MAP, t.TEXTURE_CUBE_MAP_POSITIVE_X, 6), {
      buffers: {
        color: R,
        depth: U,
        stencil: A
      },
      init: l,
      initAttributes: c,
      enableAttribute: h,
      enableAttributeAndDivisor: u,
      disableUnusedAttributes: d,
      enable: p,
      disable: f,
      getCompressedTextureFormats: m,
      setBlending: g,
      setMaterial: v,
      setFlipSided: y,
      setCullFace: E,
      setLineWidth: x,
      setPolygonOffset: b,
      getScissorTest: w,
      setScissorTest: C,
      activeTexture: T,
      bindTexture: _,
      compressedTexImage2D: L,
      texImage2D: M,
      scissor: S,
      viewport: O,
      reset: D
    }
  }
  function he(t, e, i) {
    function n() {
      if (void 0 !== r)
        return r;
      var i = e.get("EXT_texture_filter_anisotropic");
      return r = null !== i
        ? t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)
        : 0
    }
    function o(e) {
      if ("highp" === e) {
        if (t.getShaderPrecisionFormat(t.VERTEX_SHADER, t.HIGH_FLOAT).precision > 0 && t.getShaderPrecisionFormat(t.FRAGMENT_SHADER, t.HIGH_FLOAT).precision > 0)
          return "highp";
        e = "mediump"
      }
      return "mediump" === e && t.getShaderPrecisionFormat(t.VERTEX_SHADER, t.MEDIUM_FLOAT).precision > 0 && t.getShaderPrecisionFormat(t.FRAGMENT_SHADER, t.MEDIUM_FLOAT).precision > 0
        ? "mediump"
        : "lowp"
    }
    var r,
      a = void 0 !== i.precision
        ? i.precision
        : "highp",
      s = o(a);
    s !== a && (console.warn("THREE.WebGLRenderer:", a, "not supported, using", s, "instead."), a = s);
    var l = i.logarithmicDepthBuffer === !0 && !!e.get("EXT_frag_depth"),
      c = t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),
      h = t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
      u = t.getParameter(t.MAX_TEXTURE_SIZE),
      d = t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),
      p = t.getParameter(t.MAX_VERTEX_ATTRIBS),
      f = t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),
      m = t.getParameter(t.MAX_VARYING_VECTORS),
      g = t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),
      v = h > 0,
      y = !!e.get("OES_texture_float");
    return {
      getMaxAnisotropy: n,
      getMaxPrecision: o,
      precision: a,
      logarithmicDepthBuffer: l,
      maxTextures: c,
      maxVertexTextures: h,
      maxTextureSize: u,
      maxCubemapSize: d,
      maxAttributes: p,
      maxVertexUniforms: f,
      maxVaryings: m,
      maxFragmentUniforms: g,
      vertexTextures: v,
      floatFragmentTextures: y,
      floatVertexTextures: v && y
    }
  }
  function ue(t) {
    var e = {};
    return {
      get: function(i) {
        if (void 0 !== e[i])
          return e[i];
        var n;
        switch (i) {
          case "WEBGL_depth_texture":
            n = t.getExtension("WEBGL_depth_texture") || t.getExtension("MOZ_WEBGL_depth_texture") || t.getExtension("WEBKIT_WEBGL_depth_texture");
            break;
          case "EXT_texture_filter_anisotropic":
            n = t.getExtension("EXT_texture_filter_anisotropic") || t.getExtension("MOZ_EXT_texture_filter_anisotropic") || t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");
            break;
          case "WEBGL_compressed_texture_s3tc":
            n = t.getExtension("WEBGL_compressed_texture_s3tc") || t.getExtension("MOZ_WEBGL_compressed_texture_s3tc") || t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
            break;
          case "WEBGL_compressed_texture_pvrtc":
            n = t.getExtension("WEBGL_compressed_texture_pvrtc") || t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");
            break;
          case "WEBGL_compressed_texture_etc1":
            n = t.getExtension("WEBGL_compressed_texture_etc1");
            break;
          default:
            n = t.getExtension(i)
        }
        return null === n && console.warn("THREE.WebGLRenderer: " + i + " extension not supported."),
        e[i] = n,
        n
      }
    }
  }
  function de() {
    function t() {
      c.value !== n && (c.value = n, c.needsUpdate = o > 0),
      i.numPlanes = o,
      i.numIntersection = 0
    }
    function e(t, e, n, o) {
      var r = null !== t
          ? t.length
          : 0,
        a = null;
      if (0 !== r) {
        if (a = c.value, o !== !0 || null === a) {
          var h = n + 4 * r,
            u = e.matrixWorldInverse;
          l.getNormalMatrix(u),
          (null === a || a.length < h) && (a = new Float32Array(h));
          for (var d = 0, p = n; d !== r; ++d, p += 4)
            s.copy(t[d]).applyMatrix4(u, l),
            s.normal.toArray(a, p),
            a[p + 3] = s.constant
        }
        c.value = a,
        c.needsUpdate = !0
      }
      return i.numPlanes = r,
      a
    }
    var i = this,
      n = null,
      o = 0,
      r = !1,
      a = !1,
      s = new it,
      l = new et,
      c = {
        value: null,
        needsUpdate: !1
      };
    this.uniform = c,
    this.numPlanes = 0,
    this.numIntersection = 0,
    this.init = function(t, i, a) {
      var s = 0 !== t.length || i || 0 !== o || r;
      return r = i,
      n = e(t, a, 0),
      o = t.length,
      s
    },
    this.beginShadows = function() {
      a = !0,
      e(null)
    },
    this.endShadows = function() {
      a = !1,
      t()
    },
    this.setState = function(i, s, l, h, u, d) {
      if (!r || null === i || 0 === i.length || a && !l)
        a
          ? e(null)
          : t();
      else {
        var p = a
            ? 0
            : o,
          f = 4 * p,
          m = u.clippingState || null;
        c.value = m,
        m = e(i, h, f, d);
        for (var g = 0; g !== f; ++g)
          m[g] = n[g];
        u.clippingState = m,
        this.numIntersection = s
          ? this.numPlanes
          : 0,
        this.numPlanes += p
      }
    }
  }
  function pe(t) {
    function e() {
      return null === it
        ? yt
        : 1
    }
    function i() {
      Kt.init(),
      Kt.scissor(ct.copy(Et).multiplyScalar(yt)),
      Kt.viewport(ut.copy(bt).multiplyScalar(yt)),
      Kt.buffers.color.setClear(ft.r, ft.g, ft.b, mt, V)
    }
    function n() {
      et = null,
      lt = null,
      st = "",
      at = -1,
      Kt.reset()
    }
    function r(t) {
      t.preventDefault(),
      n(),
      i(),
      Qt.clear(),
      ee.clear()
    }
    function a(t) {
      var e = t.target;
      e.removeEventListener("dispose", a),
      s(e)
    }
    function s(t) {
      u(t),
      Qt.remove(t)
    }
    function u(t) {
      var e = Qt.get(t).program;
      t.program = void 0,
      void 0 !== e && ie.releaseProgram(e)
    }
    function d(t, e, i) {
      t.render(function(t) {
        tt.renderBufferImmediate(t, e, i)
      })
    }
    function p(t, e) {
      return Math.abs(e[0]) - Math.abs(t[0])
    }
    function f(t, e, i, n) {
      if (i && i.isInstancedBufferGeometry && null === Yt.get("ANGLE_instanced_arrays"))
        return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
      void 0 === n && (n = 0),
      Kt.initAttributes();
      var o = i.attributes,
        r = e.getAttributes(),
        a = t.defaultAttributeValues;
      for (var s in r) {
        var l = r[s];
        if (l >= 0) {
          var c = o[s];
          if (void 0 !== c) {
            var h = c.normalized,
              u = c.itemSize,
              d = $t.get(c),
              p = d.buffer,
              f = d.type,
              m = d.bytesPerElement;
            if (c.isInterleavedBufferAttribute) {
              var g = c.data,
                v = g.stride,
                y = c.offset;
              g && g.isInstancedInterleavedBuffer
                ? (Kt.enableAttributeAndDivisor(l, g.meshPerAttribute), void 0 === i.maxInstancedCount && (i.maxInstancedCount = g.meshPerAttribute * g.count))
                : Kt.enableAttribute(l),
              jt.bindBuffer(jt.ARRAY_BUFFER, p),
              jt.vertexAttribPointer(l, u, f, h, v * m, (n * v + y) * m)
            } else
              c.isInstancedBufferAttribute
                ? (Kt.enableAttributeAndDivisor(l, c.meshPerAttribute), void 0 === i.maxInstancedCount && (i.maxInstancedCount = c.meshPerAttribute * c.count))
                : Kt.enableAttribute(l),
              jt.bindBuffer(jt.ARRAY_BUFFER, p),
              jt.vertexAttribPointer(l, u, f, h, 0, n * u * m)
          } else if (void 0 !== a) {
            var E = a[s];
            if (void 0 !== E)
              switch (E.length) {
                case 2:
                  jt.vertexAttrib2fv(l, E);
                  break;
                case 3:
                  jt.vertexAttrib3fv(l, E);
                  break;
                case 4:
                  jt.vertexAttrib4fv(l, E);
                  break;
                default:
                  jt.vertexAttrib1fv(l, E)
              }
            }
        }
      }
      Kt.disableUnusedAttributes()
    }
    function m(t, e, i) {
      if (t.visible && t.alive !== !1) {
        if (t.layers.test(e.layers))
          if (t.isLight)
            q.push(t);
          else if (t.isSprite)
            t.frustumCulled && !wt.intersectsSprite(t) || J.push(t);
          else if (t.isLensFlare)
            $.push(t);
          else if (t.isImmediateRenderObject)
            i && Ot.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Lt),
            X.push(t, null, t.material, Ot.z, null);
          else if ((t.isMesh || t.isLine || t.isPoints) && (t.isSkinnedMesh && t.skeleton.update(), !t.frustumCulled || wt.intersectsObject(t))) {
            i && Ot.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Lt);
            var n = ee.update(t),
              o = t.material;
            if (Array.isArray(o))
              for (var r = n.groups, a = 0, s = r.length; a < s; a++) {
                var l = r[a],
                  c = o[l.materialIndex];
                c && c.visible && X.push(t, n, c, Ot.z, l)
              }
            else
              o.visible && X.push(t, n, o, Ot.z, null)
          }
        for (var h = t.children, a = 0, s = h.length; a < s; a++)
          m(h[a], e, i)
      }
    }
    function g(t, e, i, n) {
      for (var o = 0, r = t.length; o < r; o++) {
        var a = t[o],
          s = a.object,
          l = a.geometry,
          c = void 0 === n
            ? a.material
            : n,
          h = a.group;
        if (s.onBeforeRender(tt, e, i, l, c, h), i.isArrayCamera && i.enabled)
          for (var u = i.cameras, d = 0, p = u.length; d < p; d++) {
            var f = u[d],
              m = f.bounds;
            tt.setViewport(m.x * gt * yt, m.y * vt * yt, m.z * gt * yt, m.w * vt * yt),
            tt.setScissor(m.x * gt * yt, m.y * vt * yt, m.z * gt * yt, m.w * vt * yt),
            tt.setScissorTest(!0),
            v(s, e, f, l, c, h)
          }
        else
          v(s, e, i, l, c, h);
        s.onAfterRender(tt, e, i, l, c, h)
      }
    }
    function v(t, e, i, n, o, r) {
      if (t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse, t.matrixWorld), t.normalMatrix.getNormalMatrix(t.modelViewMatrix), t.isImmediateRenderObject) {
        Kt.setMaterial(o);
        var a = E(i, e.fog, o, t);
        st = "",
        d(t, a, o)
      } else
        tt.renderBufferDirect(i, e.fog, n, o, t, r)
    }
    function y(t, e, i) {
      var n = Qt.get(t),
        o = ie.getParameters(t, Nt, e, Ct.numPlanes, Ct.numIntersection, i),
        r = ie.getProgramCode(t, o),
        s = n.program,
        l = !0;
      if (void 0 === s)
        t.addEventListener("dispose", a);
      else if (s.code !== r)
        u(t);
      else {
        if (void 0 !== o.shaderID)
          return;
        l = !1
      }
      if (l) {
        if (o.shaderID) {
          var c = Os[o.shaderID];
          n.__webglShader = {
            name: t.type,
            uniforms: Ms.clone(c.uniforms),
            vertexShader: c.vertexShader,
            fragmentShader: c.fragmentShader
          }
        } else
          n.__webglShader = {
            name: t.type,
            uniforms: t.uniforms,
            vertexShader: t.vertexShader,
            fragmentShader: t.fragmentShader
          };
        t.__webglShader = n.__webglShader,
        s = ie.acquireProgram(t, o, r),
        n.program = s,
        t.program = s
      }
      var h = s.getAttributes();
      if (t.morphTargets) {
        t.numSupportedMorphTargets = 0;
        for (var d = 0; d < tt.maxMorphTargets; d++)
          h["morphTarget" + d] >= 0 && t.numSupportedMorphTargets++
      }
      if (t.morphNormals) {
        t.numSupportedMorphNormals = 0;
        for (var d = 0; d < tt.maxMorphNormals; d++)
          h["morphNormal" + d] >= 0 && t.numSupportedMorphNormals++
      }
      var p = n.__webglShader.uniforms;
      (t.isShaderMaterial || t.isRawShaderMaterial) && t.clipping !== !0 || (n.numClippingPlanes = Ct.numPlanes, n.numIntersection = Ct.numIntersection, p.clippingPlanes = Ct.uniform),
      n.fog = e,
      n.lightsHash = Nt.hash,
      t.lights && (p.ambientLightColor.value = Nt.ambient, p.directionalLights.value = Nt.directional, p.spotLights.value = Nt.spot, p.rectAreaLights.value = Nt.rectArea, p.pointLights.value = Nt.point, p.hemisphereLights.value = Nt.hemi, p.directionalShadowMap.value = Nt.directionalShadowMap, p.directionalShadowMatrix.value = Nt.directionalShadowMatrix, p.spotShadowMap.value = Nt.spotShadowMap, p.spotShadowMatrix.value = Nt.spotShadowMatrix, p.pointShadowMap.value = Nt.pointShadowMap, p.pointShadowMatrix.value = Nt.pointShadowMatrix);
      var f = n.program.getUniforms(),
        m = W.seqWithValue(f.seq, p);
      n.uniformsList = m
    }
    function E(t, e, i, n) {
      pt = 0;
      var o = Qt.get(i);
      if (Tt && (_t || t !== lt)) {
        var r = t === lt && i.id === at;
        Ct.setState(i.clippingPlanes, i.clipIntersection, i.clipShadows, t, o, r)
      }
      i.needsUpdate === !1 && (
        void 0 === o.program
        ? i.needsUpdate = !0
        : i.fog && o.fog !== e
          ? i.needsUpdate = !0
          : i.lights && o.lightsHash !== Nt.hash
            ? i.needsUpdate = !0
            : void 0 === o.numClippingPlanes || o.numClippingPlanes === Ct.numPlanes && o.numIntersection === Ct.numIntersection || (i.needsUpdate = !0)),
      i.needsUpdate && (y(i, e, n), i.needsUpdate = !1);
      var a = !1,
        s = !1,
        l = !1,
        c = o.program,
        u = c.getUniforms(),
        d = o.__webglShader.uniforms;
      if (c.id !== et && (jt.useProgram(c.program), et = c.id, a = !0, s = !0, l = !0), i.id !== at && (at = i.id, s = !0), a || t !== lt) {
        if (u.setValue(jt, "projectionMatrix", t.projectionMatrix), Zt.logarithmicDepthBuffer && u.setValue(jt, "logDepthBufFC", 2 / (Math.log(t.far + 1) / Math.LN2)), t !== lt && (lt = t, s = !0, l = !0), i.isShaderMaterial || i.isMeshPhongMaterial || i.isMeshStandardMaterial || i.envMap) {
          var p = u.map.cameraPosition;
          void 0 !== p && p.setValue(jt, Ot.setFromMatrixPosition(t.matrixWorld))
        }
        (i.isMeshPhongMaterial || i.isMeshLambertMaterial || i.isMeshBasicMaterial || i.isMeshStandardMaterial || i.isShaderMaterial || i.skinning) && u.setValue(jt, "viewMatrix", t.matrixWorldInverse),
        u.setValue(jt, "toneMappingExposure", tt.toneMappingExposure),
        u.setValue(jt, "toneMappingWhitePoint", tt.toneMappingWhitePoint)
      }
      if (i.skinning) {
        u.setOptional(jt, n, "bindMatrix"),
        u.setOptional(jt, n, "bindMatrixInverse");
        var f = n.skeleton;
        if (f) {
          var m = f.bones;
          if (Zt.floatVertexTextures) {
            if (void 0 === f.boneTexture) {
              var g = Math.sqrt(4 * m.length);
              g = gs.nextPowerOfTwo(Math.ceil(g)),
              g = Math.max(g, 4);
              var v = new Float32Array(g * g * 4);
              v.set(f.boneMatrices);
              var E = new h(v, g, g, Ga, Aa);
              f.boneMatrices = v,
              f.boneTexture = E,
              f.boneTextureSize = g
            }
            u.setValue(jt, "boneTexture", f.boneTexture),
            u.setValue(jt, "boneTextureSize", f.boneTextureSize)
          } else
            u.setOptional(jt, f, "boneMatrices")
        }
      }
      return s && (
        i.lights && R(d, l), e && i.fog && T(d, e), (i.isMeshBasicMaterial || i.isMeshLambertMaterial || i.isMeshPhongMaterial || i.isMeshStandardMaterial || i.isMeshNormalMaterial || i.isMeshDepthMaterial) && x(d, i), i.isLineBasicMaterial
        ? b(d, i)
        : i.isLineDashedMaterial
          ? (b(d, i), w(d, i))
          : i.isPointsMaterial
            ? C(d, i)
            : i.isMeshLambertMaterial
              ? _(d, i)
              : i.isMeshToonMaterial
                ? M(d, i)
                : i.isMeshPhongMaterial
                  ? L(d, i)
                  : i.isMeshPhysicalMaterial
                    ? O(d, i)
                    : i.isMeshStandardMaterial
                      ? S(d, i)
                      : i.isMeshDepthMaterial
                        ? i.displacementMap && (d.displacementMap.value = i.displacementMap, d.displacementScale.value = i.displacementScale, d.displacementBias.value = i.displacementBias)
                        : i.isMeshNormalMaterial && D(d, i),
      void 0 !== d.ltcMat && (d.ltcMat.value = Ls.LTC_MAT_TEXTURE),
      void 0 !== d.ltcMag && (d.ltcMag.value = Ls.LTC_MAG_TEXTURE),
      W.upload(jt, o.uniformsList, d, tt)),
      u.setValue(jt, "modelViewMatrix", n.modelViewMatrix),
      u.setValue(jt, "normalMatrix", n.normalMatrix),
      u.setValue(jt, "modelMatrix", n.matrixWorld),
      c
    }
    function x(t, e) {
      t.opacity.value = e.opacity,
      t.diffuse.value = e.color,
      e.emissive && t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),
      t.map.value = e.map,
      t.specularMap.value = e.specularMap,
      t.alphaMap.value = e.alphaMap,
      e.lightMap && (t.lightMap.value = e.lightMap, t.lightMapIntensity.value = e.lightMapIntensity),
      e.aoMap && (t.aoMap.value = e.aoMap, t.aoMapIntensity.value = e.aoMapIntensity);
      var i;
      if (
        e.map
        ? i = e.map
        : e.specularMap
          ? i = e.specularMap
          : e.displacementMap
            ? i = e.displacementMap
            : e.normalMap
              ? i = e.normalMap
              : e.bumpMap
                ? i = e.bumpMap
                : e.roughnessMap
                  ? i = e.roughnessMap
                  : e.metalnessMap
                    ? i = e.metalnessMap
                    : e.alphaMap
                      ? i = e.alphaMap
                      : e.emissiveMap && (i = e.emissiveMap),
      void 0 !== i) {
        i.isWebGLRenderTarget && (i = i.texture);
        var n = i.offset,
          o = i.repeat;
        t.offsetRepeat.value.set(n.x, n.y, o.x, o.y),
        t.rotateMatrix.value.copy(i.rotateMatrix)
      }
      t.envMap.value = e.envMap,
      t.flipEnvMap.value = e.envMap && e.envMap.isCubeTexture
        ? -1
        : 1,
      t.reflectivity.value = e.reflectivity,
      t.refractionRatio.value = e.refractionRatio
    }
    function b(t, e) {
      t.diffuse.value = e.color,
      t.opacity.value = e.opacity
    }
    function w(t, e) {
      t.dashSize.value = e.dashSize,
      t.totalSize.value = e.dashSize + e.gapSize,
      t.scale.value = e.scale
    }
    function C(t, e) {
      if (t.diffuse.value = e.color, t.opacity.value = e.opacity, t.size.value = e.size * yt, t.scale.value = .5 * vt, t.map.value = e.map, null !== e.map) {
        var i = e.map.offset,
          n = e.map.repeat;
        t.offsetRepeat.value.set(i.x, i.y, n.x, n.y)
      }
    }
    function T(t, e) {
      t.fogColor.value = e.color,
      e.isFog
        ? (t.fogNear.value = e.near, t.fogFar.value = e.far)
        : e.isFogExp2 && (t.fogDensity.value = e.density)
    }
    function _(t, e) {
      e.emissiveMap && (t.emissiveMap.value = e.emissiveMap)
    }
    function L(t, e) {
      t.specular.value = e.specular,
      t.shininess.value = Math.max(e.shininess, 1e-4),
      e.emissiveMap && (t.emissiveMap.value = e.emissiveMap),
      e.bumpMap && (t.bumpMap.value = e.bumpMap, t.bumpScale.value = e.bumpScale),
      e.normalMap && (t.normalMap.value = e.normalMap, t.normalScale.value.copy(e.normalScale)),
      e.displacementMap && (t.displacementMap.value = e.displacementMap, t.displacementScale.value = e.displacementScale, t.displacementBias.value = e.displacementBias)
    }
    function M(t, e) {
      L(t, e),
      e.gradientMap && (t.gradientMap.value = e.gradientMap)
    }
    function S(t, e) {
      t.roughness.value = e.roughness,
      t.metalness.value = e.metalness,
      e.roughnessMap && (t.roughnessMap.value = e.roughnessMap),
      e.metalnessMap && (t.metalnessMap.value = e.metalnessMap),
      e.emissiveMap && (t.emissiveMap.value = e.emissiveMap),
      e.bumpMap && (t.bumpMap.value = e.bumpMap, t.bumpScale.value = e.bumpScale),
      e.normalMap && (t.normalMap.value = e.normalMap, t.normalScale.value.copy(e.normalScale)),
      e.displacementMap && (t.displacementMap.value = e.displacementMap, t.displacementScale.value = e.displacementScale, t.displacementBias.value = e.displacementBias),
      e.envMap && (t.envMapIntensity.value = e.envMapIntensity)
    }
    function O(t, e) {
      t.clearCoat.value = e.clearCoat,
      t.clearCoatRoughness.value = e.clearCoatRoughness,
      S(t, e)
    }
    function D(t, e) {
      e.bumpMap && (t.bumpMap.value = e.bumpMap, t.bumpScale.value = e.bumpScale),
      e.normalMap && (t.normalMap.value = e.normalMap, t.normalScale.value.copy(e.normalScale)),
      e.displacementMap && (t.displacementMap.value = e.displacementMap, t.displacementScale.value = e.displacementScale, t.displacementBias.value = e.displacementBias)
    }
    function R(t, e) {
      t.ambientLightColor.needsUpdate = e,
      t.directionalLights.needsUpdate = e,
      t.pointLights.needsUpdate = e,
      t.spotLights.needsUpdate = e,
      t.rectAreaLights.needsUpdate = e,
      t.hemisphereLights.needsUpdate = e
    }
    function U(t) {
      for (var e = 0, i = 0, n = t.length; i < n; i++) {
        var o = t[i];
        o.castShadow && (Nt.shadows[e] = o, e++)
      }
      Nt.shadows.length = e
    }
    function A(t, e) {
      var i,
        n,
        o,
        r,
        a,
        s,
        l,
        c,
        h = 0,
        u = 0,
        d = 0,
        p = e.matrixWorldInverse,
        f = 0,
        m = 0,
        g = 0,
        v = 0,
        y = 0;
      for (i = 0, n = t.length; i < n; i++)
        if (
          o = t[i], a = o.color, s = o.intensity, l = o.distance, c = o.shadow && o.shadow.map
          ? o.shadow.map.texture
          : null,
        o.isAmbientLight)
          h += a.r * s,
          u += a.g * s,
          d += a.b * s;
        else if (o.isDirectionalLight) {
          var E = ne.get(o);
          E.color.copy(o.color).multiplyScalar(o.intensity),
          E.direction.setFromMatrixPosition(o.matrixWorld),
          Ot.setFromMatrixPosition(o.target.matrixWorld),
          E.direction.sub(Ot),
          E.direction.transformDirection(p),
          E.shadow = o.castShadow,
          o.castShadow && (r = o.shadow, E.shadowBias = r.bias, E.shadowRadius = r.radius, E.shadowMapSize = r.mapSize),
          Nt.directionalShadowMap[f] = c,
          Nt.directionalShadowMatrix[f] = o.shadow.matrix,
          Nt.directional[f] = E,
          f++
        }
      else if (o.isSpotLight) {
        var E = ne.get(o);
        E.position.setFromMatrixPosition(o.matrixWorld),
        E.position.applyMatrix4(p),
        E.color.copy(a).multiplyScalar(s),
        E.distance = l,
        E.direction.setFromMatrixPosition(o.matrixWorld),
        Ot.setFromMatrixPosition(o.target.matrixWorld),
        E.direction.sub(Ot),
        E.direction.transformDirection(p),
        E.coneCos = Math.cos(o.angle),
        E.penumbraCos = Math.cos(o.angle * (1 - o.penumbra)),
        E.decay = 0 === o.distance
          ? 0
          : o.decay,
        E.shadow = o.castShadow,
        o.castShadow && (r = o.shadow, E.shadowBias = r.bias, E.shadowRadius = r.radius, E.shadowMapSize = r.mapSize),
        Nt.spotShadowMap[g] = c,
        Nt.spotShadowMatrix[g] = o.shadow.matrix,
        Nt.spot[g] = E,
        g++
      } else if (o.isRectAreaLight) {
        var E = ne.get(o);
        E.color.copy(a).multiplyScalar(s / (o.width * o.height)),
        E.position.setFromMatrixPosition(o.matrixWorld),
        E.position.applyMatrix4(p),
        At.identity(),
        Rt.copy(o.matrixWorld),
        Rt.premultiply(p),
        At.extractRotation(Rt),
        E.halfWidth.set(.5 * o.width, 0, 0),
        E.halfHeight.set(0, .5 * o.height, 0),
        E.halfWidth.applyMatrix4(At),
        E.halfHeight.applyMatrix4(At),
        Nt.rectArea[v] = E,
        v++
      } else if (o.isPointLight) {
        var E = ne.get(o);
        E.position.setFromMatrixPosition(o.matrixWorld),
        E.position.applyMatrix4(p),
        E.color.copy(o.color).multiplyScalar(o.intensity),
        E.distance = o.distance,
        E.decay = 0 === o.distance
          ? 0
          : o.decay,
        E.shadow = o.castShadow,
        o.castShadow && (r = o.shadow, E.shadowBias = r.bias, E.shadowRadius = r.radius, E.shadowMapSize = r.mapSize),
        Nt.pointShadowMap[m] = c,
        Nt.pointShadowMatrix[m] = o.shadow.matrix,
        Nt.point[m] = E,
        m++
      } else if (o.isHemisphereLight) {
        var E = ne.get(o);
        E.direction.setFromMatrixPosition(o.matrixWorld),
        E.direction.transformDirection(p),
        E.direction.normalize(),
        E.skyColor.copy(o.color).multiplyScalar(s),
        E.groundColor.copy(o.groundColor).multiplyScalar(s),
        Nt.hemi[y] = E,
        y++
      }
      Nt.ambient[0] = h,
      Nt.ambient[1] = u,
      Nt.ambient[2] = d,
      Nt.directional.length = f,
      Nt.spot.length = g,
      Nt.rectArea.length = v,
      Nt.point.length = m,
      Nt.hemi.length = y,
      Nt.hash = f + "," + m + "," + g + "," + v + "," + y + "," + Nt.shadows.length
    }
    function I() {
      var t = pt;
      return t >= Zt.maxTextures && console.warn("WebGLRenderer: trying to use " + t + " texture units while this GPU supports only " + Zt.maxTextures),
      pt += 1,
      t
    }
    function P(t) {
      var e;
      if (t === ya)
        return jt.REPEAT;
      if (t === Ea)
        return jt.CLAMP_TO_EDGE;
      if (t === xa)
        return jt.MIRRORED_REPEAT;
      if (t === ba)
        return jt.NEAREST;
      if (t === wa)
        return jt.NEAREST_MIPMAP_NEAREST;
      if (t === Ca)
        return jt.NEAREST_MIPMAP_LINEAR;
      if (t === Ta)
        return jt.LINEAR;
      if (t === _a)
        return jt.LINEAR_MIPMAP_NEAREST;
      if (t === La)
        return jt.LINEAR_MIPMAP_LINEAR;
      if (t === Ma)
        return jt.UNSIGNED_BYTE;
      if (t === Pa)
        return jt.UNSIGNED_SHORT_4_4_4_4;
      if (t === Ba)
        return jt.UNSIGNED_SHORT_5_5_5_1;
      if (t === Na)
        return jt.UNSIGNED_SHORT_5_6_5;
      if (t === Sa)
        return jt.BYTE;
      if (t === Oa)
        return jt.SHORT;
      if (t === Da)
        return jt.UNSIGNED_SHORT;
      if (t === Ra)
        return jt.INT;
      if (t === Ua)
        return jt.UNSIGNED_INT;
      if (t === Aa)
        return jt.FLOAT;
      if (t === Ia && null !== (e = Yt.get("OES_texture_half_float")))
        return e.HALF_FLOAT_OES;
      if (t === Ha)
        return jt.ALPHA;
      if (t === Fa)
        return jt.RGB;
      if (t === Ga)
        return jt.RGBA;
      if (t === Va)
        return jt.LUMINANCE;
      if (t === za)
        return jt.LUMINANCE_ALPHA;
      if (t === Wa)
        return jt.DEPTH_COMPONENT;
      if (t === ja)
        return jt.DEPTH_STENCIL;
      if (t === Ar)
        return jt.FUNC_ADD;
      if (t === Ir)
        return jt.FUNC_SUBTRACT;
      if (t === Pr)
        return jt.FUNC_REVERSE_SUBTRACT;
      if (t === kr)
        return jt.ZERO;
      if (t === Hr)
        return jt.ONE;
      if (t === Fr)
        return jt.SRC_COLOR;
      if (t === Gr)
        return jt.ONE_MINUS_SRC_COLOR;
      if (t === Vr)
        return jt.SRC_ALPHA;
      if (t === zr)
        return jt.ONE_MINUS_SRC_ALPHA;
      if (t === qr)
        return jt.DST_ALPHA;
      if (t === Wr)
        return jt.ONE_MINUS_DST_ALPHA;
      if (t === jr)
        return jt.DST_COLOR;
      if (t === Xr)
        return jt.ONE_MINUS_DST_COLOR;
      if (t === Yr)
        return jt.SRC_ALPHA_SATURATE;
      if ((t === Xa || t === Ya || t === Za || t === Ka) && null !== (e = Yt.get("WEBGL_compressed_texture_s3tc"))) {
        if (t === Xa)
          return e.COMPRESSED_RGB_S3TC_DXT1_EXT;
        if (t === Ya)
          return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;
        if (t === Za)
          return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;
        if (t === Ka)
          return e.COMPRESSED_RGBA_S3TC_DXT5_EXT
      }
      if ((t === Qa || t === Ja || t === $a || t === ts) && null !== (e = Yt.get("WEBGL_compressed_texture_pvrtc"))) {
        if (t === Qa)
          return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;
        if (t === Ja)
          return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;
        if (t === $a)
          return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;
        if (t === ts)
          return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG
      }
      if (t === es && null !== (e = Yt.get("WEBGL_compressed_texture_etc1")))
        return e.COMPRESSED_RGB_ETC1_WEBGL;
      if ((t === Br || t === Nr) && null !== (e = Yt.get("EXT_blend_minmax"))) {
        if (t === Br)
          return e.MIN_EXT;
        if (t === Nr)
          return e.MAX_EXT
      }
      return t === ka && null !== (e = Yt.get("WEBGL_depth_texture"))
        ? e.UNSIGNED_INT_24_8_WEBGL
        : 0
    }
    console.log("THREE.WebGLRenderer", ur),
    t = t || {};
    var B = void 0 !== t.canvas
        ? t.canvas
        : document.createElementNS("http://www.w3.org/1999/xhtml", "canvas"),
      N = void 0 !== t.context
        ? t.context
        : null,
      k = void 0 !== t.alpha && t.alpha,
      H = void 0 === t.depth || t.depth,
      F = void 0 === t.stencil || t.stencil,
      G = void 0 !== t.antialias && t.antialias,
      V = void 0 === t.premultipliedAlpha || t.premultipliedAlpha,
      z = void 0 !== t.preserveDrawingBuffer && t.preserveDrawingBuffer,
      q = [],
      X = null,
      K = new Float32Array(8),
      J = [],
      $ = [];
    this.domElement = B,
    this.context = null,
    this.autoClear = !0,
    this.autoClearColor = !0,
    this.autoClearDepth = !0,
    this.autoClearStencil = !0,
    this.sortObjects = !0,
    this.clippingPlanes = [],
    this.localClippingEnabled = !1,
    this.gammaFactor = 2,
    this.gammaInput = !1,
    this.gammaOutput = !1,
    this.physicallyCorrectLights = !1,
    this.toneMapping = sa,
    this.toneMappingExposure = 1,
    this.toneMappingWhitePoint = 1,
    this.maxMorphTargets = 8,
    this.maxMorphNormals = 4;
    var tt = this,
      et = null,
      it = null,
      rt = null,
      at = -1,
      st = "",
      lt = null,
      ct = new o,
      ht = null,
      ut = new o,
      pt = 0,
      ft = new j(0),
      mt = 0,
      gt = B.width,
      vt = B.height,
      yt = 1,
      Et = new o(0, 0, gt, vt),
      xt = !1,
      bt = new o(0, 0, gt, vt),
      wt = new nt,
      Ct = new de,
      Tt = !1,
      _t = !1,
      Lt = new c,
      Ot = new l,
      Rt = new c,
      At = new c,
      Nt = {
        hash: "",
        ambient: [
          0, 0, 0
        ],
        directional: [],
        directionalShadowMap: [],
        directionalShadowMatrix: [],
        spot: [],
        spotShadowMap: [],
        spotShadowMatrix: [],
        rectArea: [],
        point: [],
        pointShadowMap: [],
        pointShadowMatrix: [],
        hemi: [],
        shadows: []
      },
      kt = {
        geometries: 0,
        textures: 0
      },
      Ht = {
        frame: 0,
        calls: 0,
        vertices: 0,
        faces: 0,
        points: 0
      };
    this.info = {
      render: Ht,
      memory: kt,
      programs: null
    };
    var jt;
    try {
      var Xt = {
        alpha: k,
        depth: H,
        stencil: F,
        antialias: G,
        premultipliedAlpha: V,
        preserveDrawingBuffer: z
      };
      if (null === (jt = N || B.getContext("webgl", Xt) || B.getContext("experimental-webgl", Xt)))
        throw null !== B.getContext("webgl")
          ? "Error creating WebGL context with your selected attributes."
          : "Error creating WebGL context.";
      void 0 === jt.getShaderPrecisionFormat && (jt.getShaderPrecisionFormat = function() {
        return {rangeMin: 1, rangeMax: 1, precision: 1}
      }),
      B.addEventListener("webglcontextlost", r, !1)
    } catch (t) {
      console.error("THREE.WebGLRenderer: " + t)
    }
    var Yt = new ue(jt);
    Yt.get("WEBGL_depth_texture"),
    Yt.get("OES_texture_float"),
    Yt.get("OES_texture_float_linear"),
    Yt.get("OES_texture_half_float"),
    Yt.get("OES_texture_half_float_linear"),
    Yt.get("OES_standard_derivatives"),
    Yt.get("ANGLE_instanced_arrays"),
    Yt.get("OES_element_index_uint") && (Mt.MaxIndex = 4294967296);
    var Zt = new he(jt, Yt, t),
      Kt = new ce(jt, Yt, P),
      Qt = new le,
      Jt = new se(jt, Yt, Kt, Qt, Zt, P, kt),
      $t = new Bt(jt),
      te = new zt(jt, $t, kt),
      ee = new Wt(jt, te, Ht),
      ie = new ae(this, Zt),
      ne = new qt,
      oe = new Ft;
    this.info.programs = ie.programs;
    var re,
      pe,
      fe,
      me,
      ge = new Vt(jt, Yt, Ht),
      ve = new Gt(jt, Yt, Ht);
    i(),
    this.context = jt,
    this.capabilities = Zt,
    this.extensions = Yt,
    this.properties = Qt,
    this.state = Kt;
    var ye = new ot(this, Nt, ee, Zt);
    this.shadowMap = ye;
    var Ee = new Z(this, J),
      xe = new Y(this, $);
    this.getContext = function() {
      return jt
    },
    this.getContextAttributes = function() {
      return jt.getContextAttributes()
    },
    this.forceContextLoss = function() {
      var t = Yt.get("WEBGL_lose_context");
      t && t.loseContext()
    },
    this.getMaxAnisotropy = function() {
      return Zt.getMaxAnisotropy()
    },
    this.getPrecision = function() {
      return Zt.precision
    },
    this.getPixelRatio = function() {
      return yt
    },
    this.setPixelRatio = function(t) {
      void 0 !== t && (yt = t, this.setSize(bt.z, bt.w, !1))
    },
    this.getSize = function() {
      return {width: gt, height: vt}
    },
    this.setSize = function(t, e, i) {
      gt = t,
      vt = e,
      B.width = t * yt,
      B.height = e * yt,
      i !== !1 && (B.style.width = t + "px", B.style.height = e + "px"),
      this.setViewport(0, 0, t, e)
    },
    this.setViewport = function(t, e, i, n) {
      Kt.viewport(bt.set(t, e, i, n))
    },
    this.setScissor = function(t, e, i, n) {
      Kt.scissor(Et.set(t, e, i, n))
    },
    this.setScissorTest = function(t) {
      Kt.setScissorTest(xt = t)
    },
    this.getClearColor = function() {
      return ft
    },
    this.setClearColor = function(t, e) {
      ft.set(t),
      mt = void 0 !== e
        ? e
        : 1,
      Kt.buffers.color.setClear(ft.r, ft.g, ft.b, mt, V)
    },
    this.getClearAlpha = function() {
      return mt
    },
    this.setClearAlpha = function(t) {
      mt = t,
      Kt.buffers.color.setClear(ft.r, ft.g, ft.b, mt, V)
    },
    this.clear = function(t, e, i) {
      var n = 0;
      (void 0 === t || t) && (n |= jt.COLOR_BUFFER_BIT),
      (void 0 === e || e) && (n |= jt.DEPTH_BUFFER_BIT),
      (void 0 === i || i) && (n |= jt.STENCIL_BUFFER_BIT),
      jt.clear(n)
    },
    this.clearColor = function() {
      this.clear(!0, !1, !1)
    },
    this.clearDepth = function() {
      this.clear(!1, !0, !1)
    },
    this.clearStencil = function() {
      this.clear(!1, !1, !0)
    },
    this.clearTarget = function(t, e, i, n) {
      this.setRenderTarget(t),
      this.clear(e, i, n)
    },
    this.resetGLState = n,
    this.dispose = function() {
      B.removeEventListener("webglcontextlost", r, !1),
      oe.dispose()
    },
    this.renderBufferImmediate = function(t, e, i) {
      Kt.initAttributes();
      var n = Qt.get(t);
      t.hasPositions && !n.position && (n.position = jt.createBuffer()),
      t.hasNormals && !n.normal && (n.normal = jt.createBuffer()),
      t.hasUvs && !n.uv && (n.uv = jt.createBuffer()),
      t.hasColors && !n.color && (n.color = jt.createBuffer());
      var o = e.getAttributes();
      if (t.hasPositions && (jt.bindBuffer(jt.ARRAY_BUFFER, n.position), jt.bufferData(jt.ARRAY_BUFFER, t.positionArray, jt.DYNAMIC_DRAW), Kt.enableAttribute(o.position), jt.vertexAttribPointer(o.position, 3, jt.FLOAT, !1, 0, 0)), t.hasNormals) {
        if (jt.bindBuffer(jt.ARRAY_BUFFER, n.normal), !i.isMeshPhongMaterial && !i.isMeshStandardMaterial && !i.isMeshNormalMaterial && i.shading === wr)
          for (var r = 0, a = 3 * t.count; r < a; r += 9) {
            var s = t.normalArray,
              l = (s[r + 0] + s[r + 3] + s[r + 6]) / 3,
              c = (s[r + 1] + s[r + 4] + s[r + 7]) / 3,
              h = (s[r + 2] + s[r + 5] + s[r + 8]) / 3;
            s[r + 0] = l,
            s[r + 1] = c,
            s[r + 2] = h,
            s[r + 3] = l,
            s[r + 4] = c,
            s[r + 5] = h,
            s[r + 6] = l,
            s[r + 7] = c,
            s[r + 8] = h
          }
        jt.bufferData(jt.ARRAY_BUFFER, t.normalArray, jt.DYNAMIC_DRAW),
        Kt.enableAttribute(o.normal),
        jt.vertexAttribPointer(o.normal, 3, jt.FLOAT, !1, 0, 0)
      }
      t.hasUvs && i.map && (jt.bindBuffer(jt.ARRAY_BUFFER, n.uv), jt.bufferData(jt.ARRAY_BUFFER, t.uvArray, jt.DYNAMIC_DRAW), Kt.enableAttribute(o.uv), jt.vertexAttribPointer($t.uv, 2, jt.FLOAT, !1, 0, 0)),
      t.hasColors && i.vertexColors !== Tr && (jt.bindBuffer(jt.ARRAY_BUFFER, n.color), jt.bufferData(jt.ARRAY_BUFFER, t.colorArray, jt.DYNAMIC_DRAW), Kt.enableAttribute(o.color), jt.vertexAttribPointer(o.color, 3, jt.FLOAT, !1, 0, 0)),
      Kt.disableUnusedAttributes(),
      jt.drawArrays(jt.TRIANGLES, 0, t.count),
      t.count = 0
    },
    this.renderBufferDirect = function(t, i, n, o, r, a) {
      Kt.setMaterial(o);
      var s = E(t, i, o, r),
        l = n.id;
      l += "_",
      l += s.id,
      l += "_",
      l += o.wireframe === !0;
      var c = !1;
      l !== st && (st = l, c = !0);
      var h = r.morphTargetInfluences;
      if (void 0 !== h) {
        for (var u = [], d = 0, m = h.length; d < m; d++) {
          var g = h[d];
          u.push([g, d])
        }
        u.sort(p),
        u.length > 8 && (u.length = 8);
        for (var v = n.morphAttributes, d = 0, m = u.length; d < m; d++) {
          var g = u[d];
          if (K[d] = g[0], 0 !== g[0]) {
            var y = g[1];
            o.morphTargets === !0 && v.position && n.addAttribute("morphTarget" + d, v.position[y]),
            o.morphNormals === !0 && v.normal && n.addAttribute("morphNormal" + d, v.normal[y])
          } else
            o.morphTargets === !0 && n.removeAttribute("morphTarget" + d),
            o.morphNormals === !0 && n.removeAttribute("morphNormal" + d)
        }
        for (var d = u.length, x = K.length; d < x; d++)
          K[d] = 0;
        s.getUniforms().setValue(jt, "morphTargetInfluences", K),
        c = !0
      }
      var y = n.index,
        b = n.attributes.position,
        w = 1;
      o.wireframe === !0 && (y = te.getWireframeAttribute(n), w = 2);
      var C = ge;
      null !== y && (C = ve, C.setIndex(y)),
      c && (f(o, s, n), null !== y && jt.bindBuffer(jt.ELEMENT_ARRAY_BUFFER, $t.get(y).buffer));
      var T = 0;
      null !== y
        ? T = y.count
        : void 0 !== b && (T = b.count);
      var _ = n.drawRange.start * w,
        L = n.drawRange.count * w,
        M = null !== a
          ? a.start * w
          : 0,
        S = null !== a
          ? a.count * w
          : 1 / 0,
        O = Math.max(_, M),
        D = Math.min(T, _ + L, M + S) - 1,
        R = Math.max(0, D - O + 1);
      if (0 !== R) {
        if (r.isMesh)
          if (o.wireframe === !0)
            Kt.setLineWidth(o.wireframeLinewidth * e()),
            C.setMode(jt.LINES);
          else
            switch (r.drawMode) {
              case os:
                C.setMode(jt.TRIANGLES);
                break;
              case rs:
                C.setMode(jt.TRIANGLE_STRIP);
                break;
              case as:
                C.setMode(jt.TRIANGLE_FAN)
            }
          else if (r.isLine) {
            var U = o.linewidth;
            void 0 === U && (U = 1),
            Kt.setLineWidth(U * e()),
            r.isLineSegments
              ? C.setMode(jt.LINES)
              : r.isLineLoop
                ? C.setMode(jt.LINE_LOOP)
                : C.setMode(jt.LINE_STRIP)
          }
        else
          r.isPoints && C.setMode(jt.POINTS);
        n && n.isInstancedBufferGeometry
          ? n.maxInstancedCount > 0 && C.renderInstances(n, O, R)
          : C.render(O, R)
      }
    },
    this.compile = function(t, e) {
      q = [],
      t.traverse(function(t) {
        t.isLight && q.push(t)
      }),
      A(q, e),
      t.traverse(function(e) {
        if (e.material)
          if (Array.isArray(e.material))
            for (var i = 0; i < e.material.length; i++)
              y(e.material[i], t.fog, e);
      else
          y(e.material, t.fog, e)
      })
    },
    this.render = function(t, e, i, n) {
      if (void 0 !== e && e.isCamera !== !0)
        return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");
      st = "",
      at = -1,
      lt = null,
      t.autoUpdate === !0 && t.updateMatrixWorld(),
      e.onBeforeRender(tt),
      null === e.parent && e.updateMatrixWorld(),
      e.matrixWorldInverse.getInverse(e.matrixWorld),
      Lt.multiplyMatrices(e.projectionMatrix, e.matrixWorldInverse),
      wt.setFromMatrix(Lt),
      q.length = 0,
      J.length = 0,
      $.length = 0,
      _t = this.localClippingEnabled,
      Tt = Ct.init(this.clippingPlanes, _t, e),
      X = oe.get(t, e),
      X.init(),
      m(t, e, tt.sortObjects),
      X.finish(),
      tt.sortObjects === !0 && X.sort(),
      Tt && Ct.beginShadows(),
      U(q),
      ye.render(t, e),
      A(q, e),
      Tt && Ct.endShadows(),
      Ht.frame++,
      Ht.calls = 0,
      Ht.vertices = 0,
      Ht.faces = 0,
      Ht.points = 0,
      void 0 === i && (i = null),
      this.setRenderTarget(i);
      var o = t.background;
      null === o
        ? Kt.buffers.color.setClear(ft.r, ft.g, ft.b, mt, V)
        : o && o.isColor && (Kt.buffers.color.setClear(o.r, o.g, o.b, 1, V), n = !0),
      (this.autoClear || n) && this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil),
      o && o.isCubeTexture
        ? (void 0 === fe && (fe = new It, me = new St(new Dt(5, 5, 5), new Q({
          uniforms: Os.cube.uniforms,
          vertexShader: Os.cube.vertexShader,
          fragmentShader: Os.cube.fragmentShader,
          side: xr,
          depthTest: !1,
          depthWrite: !1,
          fog: !1
        }))), fe.projectionMatrix.copy(e.projectionMatrix), fe.matrixWorld.extractRotation(e.matrixWorld), fe.matrixWorldInverse.getInverse(fe.matrixWorld), me.material.uniforms.tCube.value = o, me.modelViewMatrix.multiplyMatrices(fe.matrixWorldInverse, me.matrixWorld), ee.update(me), tt.renderBufferDirect(fe, null, me.geometry, me.material, me, null))
        : o && o.isTexture && (void 0 === re && (re = new Pt(-1, 1, 1, -1, 0, 1), pe = new St(new Ut(2, 2), new dt({
          depthTest: !1,
          depthWrite: !1,
          fog: !1
        }))), pe.material.map = o, ee.update(pe), tt.renderBufferDirect(re, null, pe.geometry, pe.material, pe, null));
      var r = X.opaque,
        a = X.transparent;
      if (t.overrideMaterial) {
        var s = t.overrideMaterial;
        r.length && g(r, t, e, s),
        a.length && g(a, t, e, s)
      } else
        r.length && g(r, t, e),
        a.length && g(a, t, e);
      Ee.render(t, e),
      xe.render(t, e, ut),
      i && Jt.updateRenderTargetMipmap(i),
      Kt.buffers.depth.setTest(!0),
      Kt.buffers.depth.setMask(!0),
      Kt.buffers.color.setMask(!0),
      e.isArrayCamera && e.enabled && tt.setScissorTest(!1),
      e.onAfterRender(tt)
    },
    this.setFaceCulling = function(t, e) {
      Kt.setCullFace(t),
      Kt.setFlipSided(e === gr)
    },
    this.allocTextureUnit = I,
    this.setTexture2D = function() {
      var t = !1;
      return function(e, i) {
        e && e.isWebGLRenderTarget && (t || (console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."), t = !0), e = e.texture),
        Jt.setTexture2D(e, i)
      }
    }(),
    this.setTexture = function() {
      var t = !1;
      return function(e, i) {
        t || (console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."), t = !0),
        Jt.setTexture2D(e, i)
      }
    }(),
    this.setTextureCube = function() {
      var t = !1;
      return function(e, i) {
        e && e.isWebGLRenderTargetCube && (t || (console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."), t = !0), e = e.texture),
        e && e.isCubeTexture || Array.isArray(e.image) && 6 === e.image.length
          ? Jt.setTextureCube(e, i)
          : Jt.setTextureCubeDynamic(e, i)
      }
    }(),
    this.getRenderTarget = function() {
      return it
    },
    this.setRenderTarget = function(t) {
      it = t,
      t && void 0 === Qt.get(t).__webglFramebuffer && Jt.setupRenderTarget(t);
      var e,
        i = t && t.isWebGLRenderTargetCube;
      if (t) {
        var n = Qt.get(t);
        e = i
          ? n.__webglFramebuffer[t.activeCubeFace]
          : n.__webglFramebuffer,
        ct.copy(t.scissor),
        ht = t.scissorTest,
        ut.copy(t.viewport)
      } else
        e = null,
        ct.copy(Et).multiplyScalar(yt),
        ht = xt,
        ut.copy(bt).multiplyScalar(yt);
      if (rt !== e && (jt.bindFramebuffer(jt.FRAMEBUFFER, e), rt = e), Kt.scissor(ct), Kt.setScissorTest(ht), Kt.viewport(ut), i) {
        var o = Qt.get(t.texture);
        jt.framebufferTexture2D(jt.FRAMEBUFFER, jt.COLOR_ATTACHMENT0, jt.TEXTURE_CUBE_MAP_POSITIVE_X + t.activeCubeFace, o.__webglTexture, t.activeMipMapLevel)
      }
    },
    this.readRenderTargetPixels = function(t, e, i, n, o, r) {
      if ((t && t.isWebGLRenderTarget) === !1)
        return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");
      var a = Qt.get(t).__webglFramebuffer;
      if (a) {
        var s = !1;
        a !== rt && (jt.bindFramebuffer(jt.FRAMEBUFFER, a), s = !0);
        try {
          var l = t.texture,
            c = l.format,
            h = l.type;
          if (c !== Ga && P(c) !== jt.getParameter(jt.IMPLEMENTATION_COLOR_READ_FORMAT))
            return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");
          if (!(h === Ma || P(h) === jt.getParameter(jt.IMPLEMENTATION_COLOR_READ_TYPE) || h === Aa && (Yt.get("OES_texture_float") || Yt.get("WEBGL_color_buffer_float")) || h === Ia && Yt.get("EXT_color_buffer_half_float")))
            return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");
          jt.checkFramebufferStatus(jt.FRAMEBUFFER) === jt.FRAMEBUFFER_COMPLETE
            ? e >= 0 && e <= t.width - n && i >= 0 && i <= t.height - o && jt.readPixels(e, i, n, o, P(c), P(h), r)
            : console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")
        } finally {
          s && jt.bindFramebuffer(jt.FRAMEBUFFER, rt)
        }
      }
    }
  }
  function fe(t, e) {
    this.name = "",
    this.color = new j(t),
    this.density = void 0 !== e
      ? e
      : 25e-5
  }
  function me(t, e, i) {
    this.name = "",
    this.color = new j(t),
    this.near = void 0 !== e
      ? e
      : 1,
    this.far = void 0 !== i
      ? i
      : 1e3
  }
  function ge() {
    lt.call(this),
    this.type = "Scene",
    this.background = null,
    this.fog = null,
    this.overrideMaterial = null,
    this.autoUpdate = !0
  }
  function ve(t, e, i, n, o) {
    lt.call(this),
    this.lensFlares = [],
    this.positionScreen = new l,
    this.customUpdateCallback = void 0,
    void 0 !== t && this.add(t, e, i, n, o)
  }
  function ye(t) {
    K.call(this),
    this.type = "SpriteMaterial",
    this.color = new j(16777215),
    this.map = null,
    this.rotation = 0,
    this.fog = !1,
    this.lights = !1,
    this.setValues(t)
  }
  function Ee(t) {
    lt.call(this),
    this.type = "Sprite",
    this.material = void 0 !== t
      ? t
      : new ye
  }
  function xe() {
    lt.call(this),
    this.type = "LOD",
    Object.defineProperties(this, {
      levels: {
        enumerable: !0,
        value: []
      }
    })
  }
  function be(t, e) {
    if (t = t || [], this.bones = t.slice(0), this.boneMatrices = new Float32Array(16 * this.bones.length), void 0 === e)
      this.calculateInverses();
    else if (this.bones.length === e.length)
      this.boneInverses = e.slice(0);
    else {
      console.warn("THREE.Skeleton boneInverses is the wrong length."),
      this.boneInverses = [];
      for (var i = 0, n = this.bones.length; i < n; i++)
        this.boneInverses.push(new c)
    }
  }
  function we() {
    lt.call(this),
    this.type = "Bone"
  }
  function Ce(t, e) {
    St.call(this, t, e),
    this.type = "SkinnedMesh",
    this.bindMode = "attached",
    this.bindMatrix = new c,
    this.bindMatrixInverse = new c;
    var i = this.initBones(),
      n = new be(i);
    this.bind(n, this.matrixWorld),
    this.normalizeSkinWeights()
  }
  function Te(t) {
    K.call(this),
    this.type = "LineBasicMaterial",
    this.color = new j(16777215),
    this.linewidth = 1,
    this.linecap = "round",
    this.linejoin = "round",
    this.lights = !1,
    this.setValues(t)
  }
  function _e(t, e, i) {
    if (1 === i)
      return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),
      new Le(t, e);
    lt.call(this),
    this.type = "Line",
    this.geometry = void 0 !== t
      ? t
      : new Mt,
    this.material = void 0 !== e
      ? e
      : new Te({color: 16777215 *Math.random()})
  }
  function Le(t, e) {
    _e.call(this, t, e),
    this.type = "LineSegments"
  }
  function Me(t, e) {
    _e.call(this, t, e),
    this.type = "LineLoop"
  }
  function Se(t) {
    K.call(this),
    this.type = "PointsMaterial",
    this.color = new j(16777215),
    this.map = null,
    this.size = 1,
    this.sizeAttenuation = !0,
    this.lights = !1,
    this.setValues(t)
  }
  function Oe(t, e) {
    lt.call(this),
    this.type = "Points",
    this.geometry = void 0 !== t
      ? t
      : new Mt,
    this.material = void 0 !== e
      ? e
      : new Se({color: 16777215 *Math.random()})
  }
  function De() {
    lt.call(this),
    this.type = "Group"
  }
  function Re(t, e, i, o, r, a, s, l, c) {
    function h() {
      requestAnimationFrame(h),
      t.readyState >= t.HAVE_CURRENT_DATA && (u.needsUpdate = !0)
    }
    n.call(this, t, e, i, o, r, a, s, l, c),
    this.generateMipmaps = !1;
    var u = this;
    h()
  }
  function Ue(t, e, i, o, r, a, s, l, c, h, u, d) {
    n.call(this, null, a, s, l, c, h, o, r, u, d),
    this.image = {
      width: e,
      height: i
    },
    this.mipmaps = t,
    this.flipY = !1,
    this.generateMipmaps = !1
  }
  function Ae(t, e, i, o, r, a, s, l, c) {
    n.call(this, t, e, i, o, r, a, s, l, c),
    this.needsUpdate = !0
  }
  function Ie(t, e, i, o, r, a, s, l, c, h) {
    if ((
      h = void 0 !== h
      ? h
      : Wa) !== Wa && h !== ja)
      throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");
    void 0 === i && h === Wa && (i = Da),
    void 0 === i && h === ja && (i = ka),
    n.call(this, null, o, r, a, s, l, h, i, c),
    this.image = {
      width: t,
      height: e
    },
    this.magFilter = void 0 !== s
      ? s
      : ba,
    this.minFilter = void 0 !== l
      ? l
      : ba,
    this.flipY = !1,
    this.generateMipmaps = !1
  }
  function Pe(t) {
    Mt.call(this),
    this.type = "WireframeGeometry";
    var e,
      i,
      n,
      o,
      r,
      a,
      s,
      c,
      h,
      u,
      d = [],
      p = [
        0, 0
      ],
      f = {},
      m = ["a", "b", "c"];
    if (t && t.isGeometry) {
      var g = t.faces;
      for (e = 0, n = g.length; e < n; e++) {
        var v = g[e];
        for (i = 0; i < 3; i++)
          s = v[m[i]],
          c = v[m[(i + 1) % 3]],
          p[0] = Math.min(s, c),
          p[1] = Math.max(s, c),
          h = p[0] + "," + p[1],
          void 0 === f[h] && (f[h] = {
            index1: p[0],
            index2: p[1]
          })
      }
      for (h in f)
        a = f[h],
        u = t.vertices[a.index1],
        d.push(u.x, u.y, u.z),
        u = t.vertices[a.index2],
        d.push(u.x, u.y, u.z)
    } else if (t && t.isBufferGeometry) {
      var y,
        E,
        x,
        b,
        w,
        C,
        T,
        _;
      if (u = new l, null !== t.index) {
        for (y = t.attributes.position, E = t.index, x = t.groups, 0 === x.length && (x = [
          {
            start: 0,
            count: E.count,
            materialIndex: 0
          }
        ]), o = 0, r = x.length; o < r; ++o)
          for (b = x[o], w = b.start, C = b.count, e = w, n = w + C; e < n; e += 3)
            for (i = 0; i < 3; i++)
              s = E.getX(e + i),
              c = E.getX(e + (i + 1) % 3),
              p[0] = Math.min(s, c),
              p[1] = Math.max(s, c),
              h = p[0] + "," + p[1],
              void 0 === f[h] && (f[h] = {
                index1: p[0],
                index2: p[1]
              });
      for (h in f)
          a = f[h],
          u.fromBufferAttribute(y, a.index1),
          d.push(u.x, u.y, u.z),
          u.fromBufferAttribute(y, a.index2),
          d.push(u.x, u.y, u.z)
      } else
        for (y = t.attributes.position, e = 0, n = y.count / 3; e < n; e++)
          for (i = 0; i < 3; i++)
            T = 3 * e + i,
            u.fromBufferAttribute(y, T),
            d.push(u.x, u.y, u.z),
            _ = 3 * e + (i + 1) % 3,
            u.fromBufferAttribute(y, _),
            d.push(u.x, u.y, u.z)
    }
    this.addAttribute("position", new bt(d, 3))
  }
  function Be(t, e, i) {
    Lt.call(this),
    this.type = "ParametricGeometry",
    this.parameters = {
      func: t,
      slices: e,
      stacks: i
    },
    this.fromBufferGeometry(new Ne(t, e, i)),
    this.mergeVertices()
  }
  function Ne(t, e, i) {
    Mt.call(this),
    this.type = "ParametricBufferGeometry",
    this.parameters = {
      func: t,
      slices: e,
      stacks: i
    };
    var n,
      o,
      r = [],
      a = [],
      s = [],
      c = [],
      h = new l,
      u = new l,
      d = new l,
      p = new l,
      f = new l,
      m = e + 1;
    for (n = 0; n <= i; n++) {
      var g = n / i;
      for (o = 0; o <= e; o++) {
        var v = o / e;
        u = t(v, g, u),
        a.push(u.x, u.y, u.z),
        v - 1e-5 >= 0
          ? (d = t(v - 1e-5, g, d), p.subVectors(u, d))
          : (d = t(v + 1e-5, g, d), p.subVectors(d, u)),
        g - 1e-5 >= 0
          ? (d = t(v, g - 1e-5, d), f.subVectors(u, d))
          : (d = t(v, g + 1e-5, d), f.subVectors(d, u)),
        h.crossVectors(p, f).normalize(),
        s.push(h.x, h.y, h.z),
        c.push(v, g)
      }
    }
    for (n = 0; n < i; n++)
      for (o = 0; o < e; o++) {
        var y = n * m + o,
          E = n * m + o + 1,
          x = (n + 1) * m + o + 1,
          b = (n + 1) * m + o;
        r.push(y, E, b),
        r.push(E, x, b)
      }
    this.setIndex(r),
    this.addAttribute("position", new bt(a, 3)),
    this.addAttribute("normal", new bt(s, 3)),
    this.addAttribute("uv", new bt(c, 2))
  }
  function ke(t, e, i, n) {
    Lt.call(this),
    this.type = "PolyhedronGeometry",
    this.parameters = {
      vertices: t,
      indices: e,
      radius: i,
      detail: n
    },
    this.fromBufferGeometry(new He(t, e, i, n)),
    this.mergeVertices()
  }
  function He(t, e, n, o) {
    function r(t, e, i, n) {
      var o,
        r,
        a = Math.pow(2, n),
        l = [];
      for (o = 0; o <= a; o++) {
        l[o] = [];
        var c = t.clone().lerp(i, o / a),
          h = e.clone().lerp(i, o / a),
          u = a - o;
        for (r = 0; r <= u; r++)
          l[o][r] = 0 === r && o === a
            ? c
            : c.clone().lerp(h, r / u)
        }
      for (o = 0; o < a; o++)
        for (r = 0; r < 2 * (a - o) - 1; r++) {
          var d = Math.floor(r / 2);
          r % 2 == 0
            ? (s(l[o][d + 1]), s(l[o + 1][d]), s(l[o][d]))
            : (s(l[o][d + 1]), s(l[o + 1][d + 1]), s(l[o + 1][d]))
        }
      }
    function a() {
      for (var t = 0; t < m.length; t += 6) {
        var e = m[t + 0],
          i = m[t + 2],
          n = m[t + 4],
          o = Math.max(e, i, n),
          r = Math.min(e, i, n);
        o > .9 && r < .1 && (e < .2 && (m[t + 0] += 1), i < .2 && (m[t + 2] += 1), n < .2 && (m[t + 4] += 1))
      }
    }
    function s(t) {
      f.push(t.x, t.y, t.z)
    }
    function c(e, i) {
      var n = 3 * e;
      i.x = t[n + 0],
      i.y = t[n + 1],
      i.z = t[n + 2]
    }
    function h() {
      for (var t = new l, e = new l, n = new l, o = new l, r = new i, a = new i, s = new i, c = 0, h = 0; c < f.length; c += 9, h += 6) {
        t.set(f[c + 0], f[c + 1], f[c + 2]),
        e.set(f[c + 3], f[c + 4], f[c + 5]),
        n.set(f[c + 6], f[c + 7], f[c + 8]),
        r.set(m[h + 0], m[h + 1]),
        a.set(m[h + 2], m[h + 3]),
        s.set(m[h + 4], m[h + 5]),
        o.copy(t).add(e).add(n).divideScalar(3);
        var p = d(o);
        u(r, h + 0, t, p),
        u(a, h + 2, e, p),
        u(s, h + 4, n, p)
      }
    }
    function u(t, e, i, n) {
      n < 0 && 1 === t.x && (m[e] = t.x - 1),
      0 === i.x && 0 === i.z && (m[e] = n / 2 / Math.PI + .5)
    }
    function d(t) {
      return Math.atan2(t.z, -t.x)
    }
    function p(t) {
      return Math.atan2(-t.y, Math.sqrt(t.x * t.x + t.z * t.z))
    }
    Mt.call(this),
    this.type = "PolyhedronBufferGeometry",
    this.parameters = {
      vertices: t,
      indices: e,
      radius: n,
      detail: o
    },
    n = n || 1,
    o = o || 0;
    var f = [],
      m = [];
    !function(t) {
      for (var i = new l, n = new l, o = new l, a = 0; a < e.length; a += 3)
        c(e[a + 0], i),
        c(e[a + 1], n),
        c(e[a + 2], o),
        r(i, n, o, t)
    }(o),
    function(t) {
      for (var e = new l, i = 0; i < f.length; i += 3)
        e.x = f[i + 0],
        e.y = f[i + 1],
        e.z = f[i + 2],
        e.normalize().multiplyScalar(t),
        f[i + 0] = e.x,
        f[i + 1] = e.y,
        f[i + 2] = e.z
    }(n),
    function() {
      for (var t = new l, e = 0; e < f.length; e += 3) {
        t.x = f[e + 0],
        t.y = f[e + 1],
        t.z = f[e + 2];
        var i = d(t) / 2 / Math.PI + .5,
          n = p(t) / Math.PI + .5;
        m.push(i, 1 - n)
      }
      h(),
      a()
    }(),
    this.addAttribute("position", new bt(f, 3)),
    this.addAttribute("normal", new bt(f.slice(), 3)),
    this.addAttribute("uv", new bt(m, 2)),
    this.normalizeNormals()
  }
  function Fe(t, e) {
    Lt.call(this),
    this.type = "TetrahedronGeometry",
    this.parameters = {
      radius: t,
      detail: e
    },
    this.fromBufferGeometry(new Ge(t, e)),
    this.mergeVertices()
  }
  function Ge(t, e) {
    var i = [
        1,
        1,
        1,
        -1,
        -1,
        1,
        -1,
        1,
        -1,
        1,
        -1,
        -1
      ],
      n = [
        2,
        1,
        0,
        0,
        3,
        2,
        1,
        3,
        0,
        2,
        3,
        1
      ];
    He.call(this, i, n, t, e),
    this.type = "TetrahedronBufferGeometry",
    this.parameters = {
      radius: t,
      detail: e
    }
  }
  function Ve(t, e) {
    Lt.call(this),
    this.type = "OctahedronGeometry",
    this.parameters = {
      radius: t,
      detail: e
    },
    this.fromBufferGeometry(new ze(t, e)),
    this.mergeVertices()
  }
  function ze(t, e) {
    var i = [
        1,
        0,
        0,
        -1,
        0,
        0,
        0,
        1,
        0,
        0,
        -1,
        0,
        0,
        0,
        1,
        0,
        0,
        -1
      ],
      n = [
        0,
        2,
        4,
        0,
        4,
        3,
        0,
        3,
        5,
        0,
        5,
        2,
        1,
        2,
        5,
        1,
        5,
        3,
        1,
        3,
        4,
        1,
        4,
        2
      ];
    He.call(this, i, n, t, e),
    this.type = "OctahedronBufferGeometry",
    this.parameters = {
      radius: t,
      detail: e
    }
  }
  function qe(t, e) {
    Lt.call(this),
    this.type = "IcosahedronGeometry",
    this.parameters = {
      radius: t,
      detail: e
    },
    this.fromBufferGeometry(new We(t, e)),
    this.mergeVertices()
  }
  function We(t, e) {
    var i = (1 + Math.sqrt(5)) / 2,
      n = [
        -1,
        i,
        0,
        1,
        i,
        0,
        -1, -i,
        0,
        1, -i,
        0,
        0,
        -1,
        i,
        0,
        1,
        i,
        0,
        -1, -i,
        0,
        1, -i,
        i,
        0,
        -1,
        i,
        0,
        1, -i,
        0,
        -1, -i,
        0,
        1
      ],
      o = [
        0,
        11,
        5,
        0,
        5,
        1,
        0,
        1,
        7,
        0,
        7,
        10,
        0,
        10,
        11,
        1,
        5,
        9,
        5,
        11,
        4,
        11,
        10,
        2,
        10,
        7,
        6,
        7,
        1,
        8,
        3,
        9,
        4,
        3,
        4,
        2,
        3,
        2,
        6,
        3,
        6,
        8,
        3,
        8,
        9,
        4,
        9,
        5,
        2,
        4,
        11,
        6,
        2,
        10,
        8,
        6,
        7,
        9,
        8,
        1
      ];
    He.call(this, n, o, t, e),
    this.type = "IcosahedronBufferGeometry",
    this.parameters = {
      radius: t,
      detail: e
    }
  }
  function je(t, e) {
    Lt.call(this),
    this.type = "DodecahedronGeometry",
    this.parameters = {
      radius: t,
      detail: e
    },
    this.fromBufferGeometry(new Xe(t, e)),
    this.mergeVertices()
  }
  function Xe(t, e) {
    var i = (1 + Math.sqrt(5)) / 2,
      n = 1 / i,
      o = [
        -1,
        -1,
        -1,
        -1,
        -1,
        1,
        -1,
        1,
        -1,
        -1,
        1,
        1,
        1,
        -1,
        -1,
        1,
        -1,
        1,
        1,
        1,
        -1,
        1,
        1,
        1,
        0, -n, -i,
        0, -n,
        i,
        0,
        n, -i,
        0,
        n,
        i, -n, -i,
        0, -n,
        i,
        0,
        n, -i,
        0,
        n,
        i,
        0, -i,
        0, -n,
        i,
        0, -n, -i,
        0,
        n,
        i,
        0,
        n
      ],
      r = [
        3,
        11,
        7,
        3,
        7,
        15,
        3,
        15,
        13,
        7,
        19,
        17,
        7,
        17,
        6,
        7,
        6,
        15,
        17,
        4,
        8,
        17,
        8,
        10,
        17,
        10,
        6,
        8,
        0,
        16,
        8,
        16,
        2,
        8,
        2,
        10,
        0,
        12,
        1,
        0,
        1,
        18,
        0,
        18,
        16,
        6,
        10,
        2,
        6,
        2,
        13,
        6,
        13,
        15,
        2,
        16,
        18,
        2,
        18,
        3,
        2,
        3,
        13,
        18,
        1,
        9,
        18,
        9,
        11,
        18,
        11,
        3,
        4,
        14,
        12,
        4,
        12,
        0,
        4,
        0,
        8,
        11,
        9,
        5,
        11,
        5,
        19,
        11,
        19,
        7,
        19,
        5,
        14,
        19,
        14,
        4,
        19,
        4,
        17,
        1,
        12,
        14,
        1,
        14,
        5,
        1,
        5,
        9
      ];
    He.call(this, o, r, t, e),
    this.type = "DodecahedronBufferGeometry",
    this.parameters = {
      radius: t,
      detail: e
    }
  }
  function Ye(t, e, i, n, o, r) {
    Lt.call(this),
    this.type = "TubeGeometry",
    this.parameters = {
      path: t,
      tubularSegments: e,
      radius: i,
      radialSegments: n,
      closed: o
    },
    void 0 !== r && console.warn("THREE.TubeGeometry: taper has been removed.");
    var a = new Ze(t, e, i, n, o);
    this.tangents = a.tangents,
    this.normals = a.normals,
    this.binormals = a.binormals,
    this.fromBufferGeometry(a),
    this.mergeVertices()
  }
  function Ze(t, e, n, o, r) {
    function a(i) {
      var r = t.getPointAt(i / e),
        a = h.normals[i],
        s = h.binormals[i];
      for (d = 0; d <= o; d++) {
        var l = d / o * Math.PI * 2,
          c = Math.sin(l),
          u = -Math.cos(l);
        f.x = u * a.x + c * s.x,
        f.y = u * a.y + c * s.y,
        f.z = u * a.z + c * s.z,
        f.normalize(),
        v.push(f.x, f.y, f.z),
        p.x = r.x + n * f.x,
        p.y = r.y + n * f.y,
        p.z = r.z + n * f.z,
        g.push(p.x, p.y, p.z)
      }
    }
    function s() {
      for (d = 1; d <= e; d++)
        for (u = 1; u <= o; u++) {
          var t = (o + 1) * (d - 1) + (u - 1),
            i = (o + 1) * d + (u - 1),
            n = (o + 1) * d + u,
            r = (o + 1) * (d - 1) + u;
          E.push(t, i, r),
          E.push(i, n, r)
        }
      }
    function c() {
      for (u = 0; u <= e; u++)
        for (d = 0; d <= o; d++)
          m.x = u / e,
          m.y = d / o,
          y.push(m.x, m.y)
    }
    Mt.call(this),
    this.type = "TubeBufferGeometry",
    this.parameters = {
      path: t,
      tubularSegments: e,
      radius: n,
      radialSegments: o,
      closed: r
    },
    e = e || 64,
    n = n || 1,
    o = o || 8,
    r = r || !1;
    var h = t.computeFrenetFrames(e, r);
    this.tangents = h.tangents,
    this.normals = h.normals,
    this.binormals = h.binormals;
    var u,
      d,
      p = new l,
      f = new l,
      m = new i,
      g = [],
      v = [],
      y = [],
      E = [];
    !function() {
      for (u = 0; u < e; u++)
        a(u);
      a(
        r === !1
        ? e
        : 0),
      c(),
      s()
    }(),
    this.setIndex(E),
    this.addAttribute("position", new bt(g, 3)),
    this.addAttribute("normal", new bt(v, 3)),
    this.addAttribute("uv", new bt(y, 2))
  }
  function Ke(t, e, i, n, o, r, a) {
    Lt.call(this),
    this.type = "TorusKnotGeometry",
    this.parameters = {
      radius: t,
      tube: e,
      tubularSegments: i,
      radialSegments: n,
      p: o,
      q: r
    },
    void 0 !== a && console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),
    this.fromBufferGeometry(new Qe(t, e, i, n, o, r)),
    this.mergeVertices()
  }
  function Qe(t, e, i, n, o, r) {
    function a(t, e, i, n, o) {
      var r = Math.cos(t),
        a = Math.sin(t),
        s = i / e * t,
        l = Math.cos(s);
      o.x = n * (2 + l) * .5 * r,
      o.y = n * (2 + l) * a * .5,
      o.z = n * Math.sin(s) * .5
    }
    Mt.call(this),
    this.type = "TorusKnotBufferGeometry",
    this.parameters = {
      radius: t,
      tube: e,
      tubularSegments: i,
      radialSegments: n,
      p: o,
      q: r
    },
    t = t || 100,
    e = e || 40,
    i = Math.floor(i) || 64,
    n = Math.floor(n) || 8,
    o = o || 2,
    r = r || 3;
    var s,
      c,
      h = [],
      u = [],
      d = [],
      p = [],
      f = new l,
      m = new l,
      g = new l,
      v = new l,
      y = new l,
      E = new l,
      x = new l;
    for (s = 0; s <= i; ++s) {
      var b = s / i * o * Math.PI * 2;
      for (a(b, o, r, t, g), a(b + .01, o, r, t, v), E.subVectors(v, g), x.addVectors(v, g), y.crossVectors(E, x), x.crossVectors(y, E), y.normalize(), x.normalize(), c = 0; c <= n; ++c) {
        var w = c / n * Math.PI * 2,
          C = -e * Math.cos(w),
          T = e * Math.sin(w);
        f.x = g.x + (C * x.x + T * y.x),
        f.y = g.y + (C * x.y + T * y.y),
        f.z = g.z + (C * x.z + T * y.z),
        u.push(f.x, f.y, f.z),
        m.subVectors(f, g).normalize(),
        d.push(m.x, m.y, m.z),
        p.push(s / i),
        p.push(c / n)
      }
    }
    for (c = 1; c <= i; c++)
      for (s = 1; s <= n; s++) {
        var _ = (n + 1) * (c - 1) + (s - 1),
          L = (n + 1) * c + (s - 1),
          M = (n + 1) * c + s,
          S = (n + 1) * (c - 1) + s;
        h.push(_, L, S),
        h.push(L, M, S)
      }
    this.setIndex(h),
    this.addAttribute("position", new bt(u, 3)),
    this.addAttribute("normal", new bt(d, 3)),
    this.addAttribute("uv", new bt(p, 2))
  }
  function Je(t, e, i, n, o) {
    Lt.call(this),
    this.type = "TorusGeometry",
    this.parameters = {
      radius: t,
      tube: e,
      radialSegments: i,
      tubularSegments: n,
      arc: o
    },
    this.fromBufferGeometry(new $e(t, e, i, n, o)),
    this.mergeVertices()
  }
  function $e(t, e, i, n, o) {
    Mt.call(this),
    this.type = "TorusBufferGeometry",
    this.parameters = {
      radius: t,
      tube: e,
      radialSegments: i,
      tubularSegments: n,
      arc: o
    },
    t = t || 100,
    e = e || 40,
    i = Math.floor(i) || 8,
    n = Math.floor(n) || 6,
    o = o || 2 * Math.PI;
    var r,
      a,
      s = [],
      c = [],
      h = [],
      u = [],
      d = new l,
      p = new l,
      f = new l;
    for (r = 0; r <= i; r++)
      for (a = 0; a <= n; a++) {
        var m = a / n * o,
          g = r / i * Math.PI * 2;
        p.x = (t + e * Math.cos(g)) * Math.cos(m),
        p.y = (t + e * Math.cos(g)) * Math.sin(m),
        p.z = e * Math.sin(g),
        c.push(p.x, p.y, p.z),
        d.x = t * Math.cos(m),
        d.y = t * Math.sin(m),
        f.subVectors(p, d).normalize(),
        h.push(f.x, f.y, f.z),
        u.push(a / n),
        u.push(r / i)
      }
    for (r = 1; r <= i; r++)
      for (a = 1; a <= n; a++) {
        var v = (n + 1) * r + a - 1,
          y = (n + 1) * (r - 1) + a - 1,
          E = (n + 1) * (r - 1) + a,
          x = (n + 1) * r + a;
        s.push(v, y, x),
        s.push(y, E, x)
      }
    this.setIndex(s),
    this.addAttribute("position", new bt(c, 3)),
    this.addAttribute("normal", new bt(h, 3)),
    this.addAttribute("uv", new bt(u, 2))
  }
  function ti(t, e) {
    Lt.call(this),
    this.type = "ExtrudeGeometry",
    this.parameters = {
      shapes: t,
      options: e
    },
    this.fromBufferGeometry(new ei(t, e)),
    this.mergeVertices()
  }
  function ei(t, e) {
    if (void 0 === t)
      return void(t = []);
    Mt.call(this),
    this.type = "ExtrudeBufferGeometry",
    t = Array.isArray(t)
      ? t
      : [t],
    this.addShapeList(t, e),
    this.computeVertexNormals()
  }
  function ii(t, e) {
    Lt.call(this),
    this.type = "TextGeometry",
    this.parameters = {
      text: t,
      parameters: e
    },
    this.fromBufferGeometry(new ni(t, e)),
    this.mergeVertices()
  }
  function ni(t, e) {
    e = e || {};
    var i = e.font;
    if ((i && i.isFont) === !1)
      return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),
      new Lt;
    var n = i.generateShapes(t, e.size, e.curveSegments);
    e.amount = void 0 !== e.height
      ? e.height
      : 50,
    void 0 === e.bevelThickness && (e.bevelThickness = 10),
    void 0 === e.bevelSize && (e.bevelSize = 8),
    void 0 === e.bevelEnabled && (e.bevelEnabled = !1),
    ei.call(this, n, e),
    this.type = "TextBufferGeometry"
  }
  function oi(t, e, i, n, o, r, a) {
    Lt.call(this),
    this.type = "SphereGeometry",
    this.parameters = {
      radius: t,
      widthSegments: e,
      heightSegments: i,
      phiStart: n,
      phiLength: o,
      thetaStart: r,
      thetaLength: a
    },
    this.fromBufferGeometry(new ri(t, e, i, n, o, r, a)),
    this.mergeVertices()
  }
  function ri(t, e, i, n, o, r, a) {
    Mt.call(this),
    this.type = "SphereBufferGeometry",
    this.parameters = {
      radius: t,
      widthSegments: e,
      heightSegments: i,
      phiStart: n,
      phiLength: o,
      thetaStart: r,
      thetaLength: a
    },
    t = t || 50,
    e = Math.max(3, Math.floor(e) || 8),
    i = Math.max(2, Math.floor(i) || 6),
    n = void 0 !== n
      ? n
      : 0,
    o = void 0 !== o
      ? o
      : 2 * Math.PI,
    r = void 0 !== r
      ? r
      : 0,
    a = void 0 !== a
      ? a
      : Math.PI;
    var s,
      c,
      h = r + a,
      u = 0,
      d = [],
      p = new l,
      f = new l,
      m = [],
      g = [],
      v = [],
      y = [];
    for (c = 0; c <= i; c++) {
      var E = [],
        x = c / i;
      for (s = 0; s <= e; s++) {
        var b = s / e;
        p.x = -t * Math.cos(n + b * o) * Math.sin(r + x * a),
        p.y = t * Math.cos(r + x * a),
        p.z = t * Math.sin(n + b * o) * Math.sin(r + x * a),
        g.push(p.x, p.y, p.z),
        f.set(p.x, p.y, p.z).normalize(),
        v.push(f.x, f.y, f.z),
        y.push(b, 1 - x),
        E.push(u++)
      }
      d.push(E)
    }
    for (c = 0; c < i; c++)
      for (s = 0; s < e; s++) {
        var w = d[c][s + 1],
          C = d[c][s],
          T = d[c + 1][s],
          _ = d[c + 1][s + 1];
        (0 !== c || r > 0) && m.push(w, C, _),
        (c !== i - 1 || h < Math.PI) && m.push(C, T, _)
      }
    this.setIndex(m),
    this.addAttribute("position", new bt(g, 3)),
    this.addAttribute("normal", new bt(v, 3)),
    this.addAttribute("uv", new bt(y, 2))
  }
  function ai(t, e, i, n, o, r) {
    Lt.call(this),
    this.type = "RingGeometry",
    this.parameters = {
      innerRadius: t,
      outerRadius: e,
      thetaSegments: i,
      phiSegments: n,
      thetaStart: o,
      thetaLength: r
    },
    this.fromBufferGeometry(new si(t, e, i, n, o, r)),
    this.mergeVertices()
  }
  function si(t, e, n, o, r, a) {
    Mt.call(this),
    this.type = "RingBufferGeometry",
    this.parameters = {
      innerRadius: t,
      outerRadius: e,
      thetaSegments: n,
      phiSegments: o,
      thetaStart: r,
      thetaLength: a
    },
    t = t || 20,
    e = e || 50,
    r = void 0 !== r
      ? r
      : 0,
    a = void 0 !== a
      ? a
      : 2 * Math.PI,
    n = void 0 !== n
      ? Math.max(3, n)
      : 8,
    o = void 0 !== o
      ? Math.max(1, o)
      : 1;
    var s,
      c,
      h,
      u = [],
      d = [],
      p = [],
      f = [],
      m = t,
      g = (e - t) / o,
      v = new l,
      y = new i;
    for (c = 0; c <= o; c++) {
      for (h = 0; h <= n; h++)
        s = r + h / n * a,
        v.x = m * Math.cos(s),
        v.y = m * Math.sin(s),
        d.push(v.x, v.y, v.z),
        p.push(0, 0, 1),
        y.x = (v.x / e + 1) / 2,
        y.y = (v.y / e + 1) / 2,
        f.push(y.x, y.y);
      m += g
    }
    for (c = 0; c < o; c++) {
      var E = c * (n + 1);
      for (h = 0; h < n; h++) {
        s = h + E;
        var x = s,
          b = s + n + 1,
          w = s + n + 2,
          C = s + 1;
        u.push(x, b, C),
        u.push(b, w, C)
      }
    }
    this.setIndex(u),
    this.addAttribute("position", new bt(d, 3)),
    this.addAttribute("normal", new bt(p, 3)),
    this.addAttribute("uv", new bt(f, 2))
  }
  function li(t, e, i, n) {
    Lt.call(this),
    this.type = "LatheGeometry",
    this.parameters = {
      points: t,
      segments: e,
      phiStart: i,
      phiLength: n
    },
    this.fromBufferGeometry(new ci(t, e, i, n)),
    this.mergeVertices()
  }
  function ci(t, e, n, o) {
    Mt.call(this),
    this.type = "LatheBufferGeometry",
    this.parameters = {
      points: t,
      segments: e,
      phiStart: n,
      phiLength: o
    },
    e = Math.floor(e) || 12,
    n = n || 0,
    o = o || 2 * Math.PI,
    o = gs.clamp(o, 0, 2 * Math.PI);
    var r,
      a,
      s,
      c = [],
      h = [],
      u = [],
      d = 1 / e,
      p = new l,
      f = new i;
    for (a = 0; a <= e; a++) {
      var m = n + a * d * o,
        g = Math.sin(m),
        v = Math.cos(m);
      for (s = 0; s <= t.length - 1; s++)
        p.x = t[s].x * g,
        p.y = t[s].y,
        p.z = t[s].x * v,
        h.push(p.x, p.y, p.z),
        f.x = a / e,
        f.y = s / (t.length - 1),
        u.push(f.x, f.y)
    }
    for (a = 0; a < e; a++)
      for (s = 0; s < t.length - 1; s++) {
        r = s + a * t.length;
        var y = r,
          E = r + t.length,
          x = r + t.length + 1,
          b = r + 1;
        c.push(y, E, b),
        c.push(E, x, b)
      }
    if (this.setIndex(c), this.addAttribute("position", new bt(h, 3)), this.addAttribute("uv", new bt(u, 2)), this.computeVertexNormals(), o === 2 * Math.PI) {
      var w = this.attributes.normal.array,
        C = new l,
        T = new l,
        _ = new l;
      for (r = e * t.length * 3, a = 0, s = 0; a < t.length; a++, s += 3)
        C.x = w[s + 0],
        C.y = w[s + 1],
        C.z = w[s + 2],
        T.x = w[r + s + 0],
        T.y = w[r + s + 1],
        T.z = w[r + s + 2],
        _.addVectors(C, T).normalize(),
        w[s + 0] = w[r + s + 0] = _.x,
        w[s + 1] = w[r + s + 1] = _.y,
        w[s + 2] = w[r + s + 2] = _.z
    }
  }
  function hi(t, e) {
    Lt.call(this),
    this.type = "ShapeGeometry",
    "object" === (
      void 0 === e
      ? "undefined"
      : _typeof(e)) && (console.warn("THREE.ShapeGeometry: Options parameter has been removed."), e = e.curveSegments),
    this.parameters = {
      shapes: t,
      curveSegments: e
    },
    this.fromBufferGeometry(new ui(t, e)),
    this.mergeVertices()
  }
  function ui(t, e) {
    function i(t) {
      var i,
        s,
        c,
        h = o.length / 3,
        u = t.extractPoints(e),
        d = u.shape,
        p = u.holes;
      if (Is.isClockWise(d) === !1)
        for (d = d.reverse(), i = 0, s = p.length; i < s; i++)
          c = p[i],
          Is.isClockWise(c) === !0 && (p[i] = c.reverse());
    var f = Is.triangulateShape(d, p);
      for (i = 0, s = p.length; i < s; i++)
        c = p[i],
        d = d.concat(c);
      for (i = 0, s = d.length; i < s; i++) {
        var m = d[i];
        o.push(m.x, m.y, 0),
        r.push(0, 0, 1),
        a.push(m.x, m.y)
      }
      for (i = 0, s = f.length; i < s; i++) {
        var g = f[i],
          v = g[0] + h,
          y = g[1] + h,
          E = g[2] + h;
        n.push(v, y, E),
        l += 3
      }
    }
    Mt.call(this),
    this.type = "ShapeBufferGeometry",
    this.parameters = {
      shapes: t,
      curveSegments: e
    },
    e = e || 12;
    var n = [],
      o = [],
      r = [],
      a = [],
      s = 0,
      l = 0;
    if (Array.isArray(t) === !1)
      i(t);
    else
      for (var c = 0; c < t.length; c++)
        i(t[c]),
        this.addGroup(s, l, c),
        s += l,
        l = 0;
  this.setIndex(n),
    this.addAttribute("position", new bt(o, 3)),
    this.addAttribute("normal", new bt(r, 3)),
    this.addAttribute("uv", new bt(a, 2))
  }
  function di(t, e) {
    Mt.call(this),
    this.type = "EdgesGeometry",
    this.parameters = {
      thresholdAngle: e
    },
    e = void 0 !== e
      ? e
      : 1;
    var i,
      n,
      o,
      r,
      a = [],
      s = Math.cos(gs.DEG2RAD * e),
      l = [
        0, 0
      ],
      c = {},
      h = ["a", "b", "c"];
    t.isBufferGeometry
      ? (r = new Lt, r.fromBufferGeometry(t))
      : r = t.clone(),
    r.mergeVertices(),
    r.computeFaceNormals();
    for (var u = r.vertices, d = r.faces, p = 0, f = d.length; p < f; p++)
      for (var m = d[p], g = 0; g < 3; g++)
        i = m[h[g]],
        n = m[h[(g + 1) % 3]],
        l[0] = Math.min(i, n),
        l[1] = Math.max(i, n),
        o = l[0] + "," + l[1],
        void 0 === c[o]
          ? c[o] = {
            index1: l[0],
            index2: l[1],
            face1: p,
            face2: void 0
          }
          : c[o].face2 = p;
    for (o in c) {
      var v = c[o];
      if (void 0 === v.face2 || d[v.face1].normal.dot(d[v.face2].normal) <= s) {
        var y = u[v.index1];
        a.push(y.x, y.y, y.z),
        y = u[v.index2],
        a.push(y.x, y.y, y.z)
      }
    }
    this.addAttribute("position", new bt(a, 3))
  }
  function pi(t, e, i, n, o, r, a, s) {
    Lt.call(this),
    this.type = "CylinderGeometry",
    this.parameters = {
      radiusTop: t,
      radiusBottom: e,
      height: i,
      radialSegments: n,
      heightSegments: o,
      openEnded: r,
      thetaStart: a,
      thetaLength: s
    },
    this.fromBufferGeometry(new fi(t, e, i, n, o, r, a, s)),
    this.mergeVertices()
  }
  function fi(t, e, n, o, r, a, s, c) {
    function h(n) {
      var r,
        a,
        h,
        v = new i,
        x = new l,
        b = 0,
        w = n === !0
          ? t
          : e,
        C = n === !0
          ? 1
          : -1;
      for (a = g, r = 1; r <= o; r++)
        p.push(0, y * C, 0),
        f.push(0, C, 0),
        m.push(.5, .5),
        g++;
      for (h = g, r = 0; r <= o; r++) {
        var T = r / o,
          _ = T * c + s,
          L = Math.cos(_),
          M = Math.sin(_);
        x.x = w * M,
        x.y = y * C,
        x.z = w * L,
        p.push(x.x, x.y, x.z),
        f.push(0, C, 0),
        v.x = .5 * L + .5,
        v.y = .5 * M * C + .5,
        m.push(v.x, v.y),
        g++
      }
      for (r = 0; r < o; r++) {
        var S = a + r,
          O = h + r;
        n === !0
          ? d.push(O, O + 1, S)
          : d.push(O + 1, O, S),
        b += 3
      }
      u.addGroup(
        E, b, n === !0
        ? 1
        : 2),
      E += b
    }
    Mt.call(this),
    this.type = "CylinderBufferGeometry",
    this.parameters = {
      radiusTop: t,
      radiusBottom: e,
      height: n,
      radialSegments: o,
      heightSegments: r,
      openEnded: a,
      thetaStart: s,
      thetaLength: c
    };
    var u = this;
    t = void 0 !== t
      ? t
      : 20,
    e = void 0 !== e
      ? e
      : 20,
    n = void 0 !== n
      ? n
      : 100,
    o = Math.floor(o) || 8,
    r = Math.floor(r) || 1,
    a = void 0 !== a && a,
    s = void 0 !== s
      ? s
      : 0,
    c = void 0 !== c
      ? c
      : 2 * Math.PI;
    var d = [],
      p = [],
      f = [],
      m = [],
      g = 0,
      v = [],
      y = n / 2,
      E = 0;
    !function() {
      var i,
        a,
        h = new l,
        x = new l,
        b = 0,
        w = (e - t) / n;
      for (a = 0; a <= r; a++) {
        var C = [],
          T = a / r,
          _ = T * (e - t) + t;
        for (i = 0; i <= o; i++) {
          var L = i / o,
            M = L * c + s,
            S = Math.sin(M),
            O = Math.cos(M);
          x.x = _ * S,
          x.y = -T * n + y,
          x.z = _ * O,
          p.push(x.x, x.y, x.z),
          h.set(S, w, O).normalize(),
          f.push(h.x, h.y, h.z),
          m.push(L, 1 - T),
          C.push(g++)
        }
        v.push(C)
      }
      for (i = 0; i < o; i++)
        for (a = 0; a < r; a++) {
          var D = v[a][i],
            R = v[a + 1][i],
            U = v[a + 1][i + 1],
            A = v[a][i + 1];
          d.push(D, R, A),
          d.push(R, U, A),
          b += 6
        }
      u.addGroup(E, b, 0),
      E += b
    }(),
    a === !1 && (t > 0 && h(!0), e > 0 && h(!1)),
    this.setIndex(d),
    this.addAttribute("position", new bt(p, 3)),
    this.addAttribute("normal", new bt(f, 3)),
    this.addAttribute("uv", new bt(m, 2))
  }
  function mi(t, e, i, n, o, r, a) {
    pi.call(this, 0, t, e, i, n, o, r, a),
    this.type = "ConeGeometry",
    this.parameters = {
      radius: t,
      height: e,
      radialSegments: i,
      heightSegments: n,
      openEnded: o,
      thetaStart: r,
      thetaLength: a
    }
  }
  function gi(t, e, i, n, o, r, a) {
    fi.call(this, 0, t, e, i, n, o, r, a),
    this.type = "ConeBufferGeometry",
    this.parameters = {
      radius: t,
      height: e,
      radialSegments: i,
      heightSegments: n,
      openEnded: o,
      thetaStart: r,
      thetaLength: a
    }
  }
  function vi(t, e, i, n) {
    Lt.call(this),
    this.type = "CircleGeometry",
    this.parameters = {
      radius: t,
      segments: e,
      thetaStart: i,
      thetaLength: n
    },
    this.fromBufferGeometry(new yi(t, e, i, n)),
    this.mergeVertices()
  }
  function yi(t, e, n, o) {
    Mt.call(this),
    this.type = "CircleBufferGeometry",
    this.parameters = {
      radius: t,
      segments: e,
      thetaStart: n,
      thetaLength: o
    },
    t = t || 50,
    e = void 0 !== e
      ? Math.max(3, e)
      : 8,
    n = void 0 !== n
      ? n
      : 0,
    o = void 0 !== o
      ? o
      : 2 * Math.PI;
    var r,
      a,
      s = [],
      c = [],
      h = [],
      u = [],
      d = new l,
      p = new i;
    for (c.push(0, 0, 0), h.push(0, 0, 1), u.push(.5, .5), a = 0, r = 3; a <= e; a++, r += 3) {
      var f = n + a / e * o;
      d.x = t * Math.cos(f),
      d.y = t * Math.sin(f),
      c.push(d.x, d.y, d.z),
      h.push(0, 0, 1),
      p.x = (c[r] / t + 1) / 2,
      p.y = (c[r + 1] / t + 1) / 2,
      u.push(p.x, p.y)
    }
    for (r = 1; r <= e; r++)
      s.push(r, r + 1, 0);
    this.setIndex(s),
    this.addAttribute("position", new bt(c, 3)),
    this.addAttribute("normal", new bt(h, 3)),
    this.addAttribute("uv", new bt(u, 2))
  }
  function Ei(t) {
    Q.call(this, {
      uniforms: Ms.merge([
        Ls.lights, {
          opacity: {
            value: 1
          }
        }
      ]),
      vertexShader: Ss.shadow_vert,
      fragmentShader: Ss.shadow_frag
    }),
    this.lights = !0,
    this.transparent = !0,
    Object.defineProperties(this, {
      opacity: {
        enumerable: !0,
        get: function() {
          return this.uniforms.opacity.value
        },
        set: function(t) {
          this.uniforms.opacity.value = t
        }
      }
    }),
    this.setValues(t)
  }
  function xi(t) {
    Q.call(this, t),
    this.type = "RawShaderMaterial"
  }
  function bi(t) {
    K.call(this),
    this.defines = {
      STANDARD: ""
    },
    this.type = "MeshStandardMaterial",
    this.color = new j(16777215),
    this.roughness = .5,
    this.metalness = .5,
    this.map = null,
    this.lightMap = null,
    this.lightMapIntensity = 1,
    this.aoMap = null,
    this.aoMapIntensity = 1,
    this.emissive = new j(0),
    this.emissiveIntensity = 1,
    this.emissiveMap = null,
    this.bumpMap = null,
    this.bumpScale = 1,
    this.normalMap = null,
    this.normalScale = new i(1, 1),
    this.displacementMap = null,
    this.displacementScale = 1,
    this.displacementBias = 0,
    this.roughnessMap = null,
    this.metalnessMap = null,
    this.alphaMap = null,
    this.envMap = null,
    this.envMapIntensity = 1,
    this.refractionRatio = .98,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.wireframeLinecap = "round",
    this.wireframeLinejoin = "round",
    this.skinning = !1,
    this.morphTargets = !1,
    this.morphNormals = !1,
    this.setValues(t)
  }
  function wi(t) {
    bi.call(this),
    this.defines = {
      PHYSICAL: ""
    },
    this.type = "MeshPhysicalMaterial",
    this.reflectivity = .5,
    this.clearCoat = 0,
    this.clearCoatRoughness = 0,
    this.setValues(t)
  }
  function Ci(t) {
    K.call(this),
    this.type = "MeshPhongMaterial",
    this.color = new j(16777215),
    this.specular = new j(1118481),
    this.shininess = 30,
    this.map = null,
    this.lightMap = null,
    this.lightMapIntensity = 1,
    this.aoMap = null,
    this.aoMapIntensity = 1,
    this.emissive = new j(0),
    this.emissiveIntensity = 1,
    this.emissiveMap = null,
    this.bumpMap = null,
    this.bumpScale = 1,
    this.normalMap = null,
    this.normalScale = new i(1, 1),
    this.displacementMap = null,
    this.displacementScale = 1,
    this.displacementBias = 0,
    this.specularMap = null,
    this.alphaMap = null,
    this.envMap = null,
    this.combine = na,
    this.reflectivity = 1,
    this.refractionRatio = .98,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.wireframeLinecap = "round",
    this.wireframeLinejoin = "round",
    this.skinning = !1,
    this.morphTargets = !1,
    this.morphNormals = !1,
    this.setValues(t)
  }
  function Ti(t) {
    Ci.call(this),
    this.defines = {
      TOON: ""
    },
    this.type = "MeshToonMaterial",
    this.gradientMap = null,
    this.setValues(t)
  }
  function _i(t) {
    K.call(this, t),
    this.type = "MeshNormalMaterial",
    this.bumpMap = null,
    this.bumpScale = 1,
    this.normalMap = null,
    this.normalScale = new i(1, 1),
    this.displacementMap = null,
    this.displacementScale = 1,
    this.displacementBias = 0,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.fog = !1,
    this.lights = !1,
    this.skinning = !1,
    this.morphTargets = !1,
    this.morphNormals = !1,
    this.setValues(t)
  }
  function Li(t) {
    K.call(this),
    this.type = "MeshLambertMaterial",
    this.color = new j(16777215),
    this.map = null,
    this.lightMap = null,
    this.lightMapIntensity = 1,
    this.aoMap = null,
    this.aoMapIntensity = 1,
    this.emissive = new j(0),
    this.emissiveIntensity = 1,
    this.emissiveMap = null,
    this.specularMap = null,
    this.alphaMap = null,
    this.envMap = null,
    this.combine = na,
    this.reflectivity = 1,
    this.refractionRatio = .98,
    this.wireframe = !1,
    this.wireframeLinewidth = 1,
    this.wireframeLinecap = "round",
    this.wireframeLinejoin = "round",
    this.skinning = !1,
    this.morphTargets = !1,
    this.morphNormals = !1,
    this.setValues(t)
  }
  function Mi(t) {
    K.call(this),
    this.type = "LineDashedMaterial",
    this.color = new j(16777215),
    this.linewidth = 1,
    this.scale = 1,
    this.dashSize = 3,
    this.gapSize = 1,
    this.lights = !1,
    this.setValues(t)
  }
  function Si(t, e, i) {
    var n = this,
      o = !1,
      r = 0,
      a = 0;
    this.onStart = void 0,
    this.onLoad = t,
    this.onProgress = e,
    this.onError = i,
    this.itemStart = function(t) {
      a++,
      o === !1 && void 0 !== n.onStart && n.onStart(t, r, a),
      o = !0
    },
    this.itemEnd = function(t) {
      r++,
      void 0 !== n.onProgress && n.onProgress(t, r, a),
      r === a && (o = !1, void 0 !== n.onLoad && n.onLoad())
    },
    this.itemError = function(t) {
      void 0 !== n.onError && n.onError(t)
    }
  }
  function Oi(t) {
    this.manager = void 0 !== t
      ? t
      : ks
  }
  function Di(t) {
    this.manager = void 0 !== t
      ? t
      : ks,
    this._parser = null
  }
  function Ri(t) {
    this.manager = void 0 !== t
      ? t
      : ks,
    this._parser = null
  }
  function Ui(t) {
    this.manager = void 0 !== t
      ? t
      : ks
  }
  function Ai(t) {
    this.manager = void 0 !== t
      ? t
      : ks
  }
  function Ii(t) {
    this.manager = void 0 !== t
      ? t
      : ks
  }
  function Pi(t, e) {
    lt.call(this),
    this.type = "Light",
    this.color = new j(t),
    this.intensity = void 0 !== e
      ? e
      : 1,
    this.receiveShadow = void 0
  }
  function Bi(t, e, i) {
    Pi.call(this, t, i),
    this.type = "HemisphereLight",
    this.castShadow = void 0,
    this.position.copy(lt.DefaultUp),
    this.updateMatrix(),
    this.groundColor = new j(e)
  }
  function Ni(t) {
    this.camera = t,
    this.bias = 0,
    this.radius = 1,
    this.mapSize = new i(512, 512),
    this.map = null,
    this.matrix = new c
  }
  function ki() {
    Ni.call(this, new It(50, 1, .5, 500))
  }
  function Hi(t, e, i, n, o, r) {
    Pi.call(this, t, e),
    this.type = "SpotLight",
    this.position.copy(lt.DefaultUp),
    this.updateMatrix(),
    this.target = new lt,
    Object.defineProperty(this, "power", {
      get: function() {
        return this.intensity * Math.PI
      },
      set: function(t) {
        this.intensity = t / Math.PI
      }
    }),
    this.distance = void 0 !== i
      ? i
      : 0,
    this.angle = void 0 !== n
      ? n
      : Math.PI / 3,
    this.penumbra = void 0 !== o
      ? o
      : 0,
    this.decay = void 0 !== r
      ? r
      : 1,
    this.shadow = new ki
  }
  function Fi(t, e, i, n) {
    Pi.call(this, t, e),
    this.type = "PointLight",
    Object.defineProperty(this, "power", {
      get: function() {
        return 4 * this.intensity * Math.PI
      },
      set: function(t) {
        this.intensity = t / (4 * Math.PI)
      }
    }),
    this.distance = void 0 !== i
      ? i
      : 0,
    this.decay = void 0 !== n
      ? n
      : 1,
    this.shadow = new Ni(new It(90, 1, .5, 500))
  }
  function Gi() {
    Ni.call(this, new Pt(-5, 5, 5, -5, .5, 500))
  }
  function Vi(t, e) {
    Pi.call(this, t, e),
    this.type = "DirectionalLight",
    this.position.copy(lt.DefaultUp),
    this.updateMatrix(),
    this.target = new lt,
    this.shadow = new Gi
  }
  function zi(t, e) {
    Pi.call(this, t, e),
    this.type = "AmbientLight",
    this.castShadow = void 0
  }
  function qi(t, e, i, n) {
    Pi.call(this, t, e),
    this.type = "RectAreaLight",
    this.position.set(0, 1, 0),
    this.updateMatrix(),
    this.width = void 0 !== i
      ? i
      : 10,
    this.height = void 0 !== n
      ? n
      : 10
  }
  function Wi(t, e, i, n) {
    this.parameterPositions = t,
    this._cachedIndex = 0,
    this.resultBuffer = void 0 !== n
      ? n
      : new e.constructor(i),
    this.sampleValues = e,
    this.valueSize = i
  }
  function ji(t, e, i, n) {
    Wi.call(this, t, e, i, n),
    this._weightPrev = -0,
    this._offsetPrev = -0,
    this._weightNext = -0,
    this._offsetNext = -0
  }
  function Xi(t, e, i, n) {
    Wi.call(this, t, e, i, n)
  }
  function Yi(t, e, i, n) {
    Wi.call(this, t, e, i, n)
  }
  function Zi(t, e, i, n) {
    if (void 0 === t)
      throw new Error("track name is undefined");
    if (void 0 === e || 0 === e.length)
      throw new Error("no keyframes in track named " + t);
    this.name = t,
    this.times = Hs.convertArray(e, this.TimeBufferType),
    this.values = Hs.convertArray(i, this.ValueBufferType),
    this.setInterpolation(n || this.DefaultInterpolation),
    this.validate(),
    this.optimize()
  }
  function Ki(t, e, i, n) {
    Zi.call(this, t, e, i, n)
  }
  function Qi(t, e, i, n) {
    Wi.call(this, t, e, i, n)
  }
  function Ji(t, e, i, n) {
    Zi.call(this, t, e, i, n)
  }
  function $i(t, e, i, n) {
    Zi.call(this, t, e, i, n)
  }
  function tn(t, e, i, n) {
    Zi.call(this, t, e, i, n)
  }
  function en(t, e, i) {
    Zi.call(this, t, e, i)
  }
  function nn(t, e, i, n) {
    Zi.call(this, t, e, i, n)
  }
  function on(t, e, i, n) {
    Zi.apply(this, arguments)
  }
  function rn(t, e, i) {
    this.name = t,
    this.tracks = i,
    this.duration = void 0 !== e
      ? e
      : -1,
    this.uuid = gs.generateUUID(),
    this.duration < 0 && this.resetDuration(),
    this.optimize()
  }
  function an(t) {
    this.manager = void 0 !== t
      ? t
      : ks,
    this.textures = {}
  }
  function sn(t) {
    this.manager = void 0 !== t
      ? t
      : ks
  }
  function ln() {
    this.onLoadStart = function() {},
    this.onLoadProgress = function() {},
    this.onLoadComplete = function() {}
  }
  function cn(t) {
    "boolean" == typeof t && (console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."), t = void 0),
    this.manager = void 0 !== t
      ? t
      : ks,
    this.withCredentials = !1
  }
  function hn(t) {
    this.manager = void 0 !== t
      ? t
      : ks,
    this.texturePath = ""
  }
  function un(t, e, i, n, o) {
    var r = .5 * (n - e),
      a = .5 * (o - i),
      s = t * t;
    return (2 * i - 2 * n + r + a) * (t * s) + (-3 * i + 3 * n - 2 * r - a) * s + r * t + i
  }
  function dn(t, e) {
    var i = 1 - t;
    return i * i * e
  }
  function pn(t, e) {
    return 2 * (1 - t) * t * e
  }
  function fn(t, e) {
    return t * t * e
  }
  function mn(t, e, i, n) {
    return dn(t, e) + pn(t, i) + fn(t, n)
  }
  function gn(t, e) {
    var i = 1 - t;
    return i * i * i * e
  }
  function vn(t, e) {
    var i = 1 - t;
    return 3 * i * i * t * e
  }
  function yn(t, e) {
    return 3 * (1 - t) * t * t * e
  }
  function En(t, e) {
    return t * t * t * e
  }
  function xn(t, e, i, n, o) {
    return gn(t, e) + vn(t, i) + yn(t, n) + En(t, o)
  }
  function bn() {
    this.arcLengthDivisions = 200
  }
  function wn(t, e) {
    bn.call(this),
    this.v1 = t,
    this.v2 = e
  }
  function Cn() {
    bn.call(this),
    this.curves = [],
    this.autoClose = !1
  }
  function Tn(t, e, i, n, o, r, a, s) {
    bn.call(this),
    this.aX = t,
    this.aY = e,
    this.xRadius = i,
    this.yRadius = n,
    this.aStartAngle = o,
    this.aEndAngle = r,
    this.aClockwise = a,
    this.aRotation = s || 0
  }
  function _n(t) {
    bn.call(this),
    this.points = void 0 === t
      ? []
      : t
  }
  function Ln(t, e, i, n) {
    bn.call(this),
    this.v0 = t,
    this.v1 = e,
    this.v2 = i,
    this.v3 = n
  }
  function Mn(t, e, i) {
    bn.call(this),
    this.v0 = t,
    this.v1 = e,
    this.v2 = i
  }
  function Sn(t) {
    Cn.call(this),
    this.currentPoint = new i,
    t && this.fromPoints(t)
  }
  function On() {
    Sn.apply(this, arguments),
    this.holes = []
  }
  function Dn() {
    this.subPaths = [],
    this.currentPath = null
  }
  function Rn(t) {
    this.data = t
  }
  function Un(t) {
    this.manager = void 0 !== t
      ? t
      : ks
  }
  function An(t) {
    this.manager = void 0 !== t
      ? t
      : ks
  }
  function In() {
    this.type = "StereoCamera",
    this.aspect = 1,
    this.eyeSep = .064,
    this.cameraL = new It,
    this.cameraL.layers.enable(1),
    this.cameraL.matrixAutoUpdate = !1,
    this.cameraR = new It,
    this.cameraR.layers.enable(2),
    this.cameraR.matrixAutoUpdate = !1
  }
  function Pn(t, e, i) {
    lt.call(this),
    this.type = "CubeCamera";
    var n = new It(90, 1, t, e);
    n.up.set(0, -1, 0),
    n.lookAt(new l(1, 0, 0)),
    this.add(n);
    var o = new It(90, 1, t, e);
    o.up.set(0, -1, 0),
    o.lookAt(new l(-1, 0, 0)),
    this.add(o);
    var r = new It(90, 1, t, e);
    r.up.set(0, 0, 1),
    r.lookAt(new l(0, 1, 0)),
    this.add(r);
    var s = new It(90, 1, t, e);
    s.up.set(0, 0, -1),
    s.lookAt(new l(0, -1, 0)),
    this.add(s);
    var c = new It(90, 1, t, e);
    c.up.set(0, -1, 0),
    c.lookAt(new l(0, 0, 1)),
    this.add(c);
    var h = new It(90, 1, t, e);
    h.up.set(0, -1, 0),
    h.lookAt(new l(0, 0, -1)),
    this.add(h);
    var u = {
      format: Fa,
      magFilter: Ta,
      minFilter: Ta
    };
    this.renderTarget = new a(i, i, u),
    this.renderTarget.texture.name = "CubeCamera",
    this.updateCubeMap = function(t, e) {
      null === this.parent && this.updateMatrixWorld();
      var i = this.renderTarget,
        a = i.texture.generateMipmaps;
      i.texture.generateMipmaps = !1,
      i.activeCubeFace = 0,
      t.render(e, n, i),
      i.activeCubeFace = 1,
      t.render(e, o, i),
      i.activeCubeFace = 2,
      t.render(e, r, i),
      i.activeCubeFace = 3,
      t.render(e, s, i),
      i.activeCubeFace = 4,
      t.render(e, c, i),
      i.texture.generateMipmaps = a,
      i.activeCubeFace = 5,
      t.render(e, h, i),
      t.setRenderTarget(null)
    }
  }
  function Bn(t) {
    It.call(this),
    this.enabled = !1,
    this.cameras = t || []
  }
  function Nn() {
    lt.call(this),
    this.type = "AudioListener",
    this.context = Xs.getContext(),
    this.gain = this.context.createGain(),
    this.gain.connect(this.context.destination),
    this.filter = null
  }
  function kn(t) {
    lt.call(this),
    this.type = "Audio",
    this.context = t.context,
    this.gain = this.context.createGain(),
    this.gain.connect(t.getInput()),
    this.autoplay = !1,
    this.buffer = null,
    this.loop = !1,
    this.startTime = 0,
    this.playbackRate = 1,
    this.isPlaying = !1,
    this.hasPlaybackControl = !0,
    this.sourceType = "empty",
    this.filters = []
  }
  function Hn(t) {
    kn.call(this, t),
    this.panner = this.context.createPanner(),
    this.panner.connect(this.gain)
  }
  function Fn(t, e) {
    this.analyser = t.context.createAnalyser(),
    this.analyser.fftSize = void 0 !== e
      ? e
      : 2048,
    this.data = new Uint8Array(this.analyser.frequencyBinCount),
    t.getOutput().connect(this.analyser)
  }
  function Gn(t, e, i) {
    this.binding = t,
    this.valueSize = i;
    var n,
      o = Float64Array;
    switch (e) {
      case "quaternion":
        n = this._slerp;
        break;
      case "string":
      case "bool":
        o = Array,
        n = this._select;
        break;
      default:
        n = this._lerp
    }
    this.buffer = new o(4 * i),
    this._mixBufferRegion = n,
    this.cumulativeWeight = 0,
    this.useCount = 0,
    this.referenceCount = 0
  }
  function Vn(t, e, i) {
    var n = i || zn.parseTrackName(e);
    this._targetGroup = t,
    this._bindings = t.subscribe_(e, n)
  }
  function zn(t, e, i) {
    this.path = e,
    this.parsedPath = i || zn.parseTrackName(e),
    this.node = zn.findNode(t, this.parsedPath.nodeName) || t,
    this.rootNode = t
  }
  function qn(t) {
    this.uuid = gs.generateUUID(),
    this._objects = Array.prototype.slice.call(arguments),
    this.nCachedObjects_ = 0;
    var e = {};
    this._indicesByUUID = e;
    for (var i = 0, n = arguments.length; i !== n; ++i)
      e[arguments[i].uuid] = i;
    this._paths = [],
    this._parsedPaths = [],
    this._bindings = [],
    this._bindingsIndicesByPath = {};
    var o = this;
    this.stats = {
      objects: {
        get total() {
          return o._objects.length
        },
        get inUse() {
          return this.total - o.nCachedObjects_
        }
      },
      get bindingsPerObject() {
        return o._bindings.length
      }
    }
  }
  function Wn(t, e, i) {
    this._mixer = t,
    this._clip = e,
    this._localRoot = i || null;
    for (var n = e.tracks, o = n.length, r = new Array(o), a = {
      endingStart: ns,
      endingEnd: ns
    }, s = 0; s !== o; ++s) {
      var l = n[s].createInterpolant(null);
      r[s] = l,
      l.settings = a
    }
    this._interpolantSettings = a,
    this._interpolants = r,
    this._propertyBindings = new Array(o),
    this._cacheIndex = null,
    this._byClipCacheIndex = null,
    this._timeScaleInterpolant = null,
    this._weightInterpolant = null,
    this.loop = is,
    this._loopCount = -1,
    this._startTime = null,
    this.time = 0,
    this.timeScale = 1,
    this._effectiveTimeScale = 1,
    this.weight = 1,
    this._effectiveWeight = 1,
    this.repetitions = 1 / 0,
    this.paused = !1,
    this.enabled = !0,
    this.clampWhenFinished = !1,
    this.zeroSlopeAtStart = !0,
    this.zeroSlopeAtEnd = !0
  }
  function jn(t) {
    this._root = t,
    this._initMemoryManager(),
    this._accuIndex = 0,
    this.time = 0,
    this.timeScale = 1
  }
  function Xn(t) {
    "string" == typeof t && (console.warn("THREE.Uniform: Type parameter is no longer needed."), t = arguments[1]),
    this.value = t
  }
  function Yn() {
    Mt.call(this),
    this.type = "InstancedBufferGeometry",
    this.maxInstancedCount = void 0
  }
  function Zn(t, e, i, n) {
    this.uuid = gs.generateUUID(),
    this.data = t,
    this.itemSize = e,
    this.offset = i,
    this.normalized = n === !0
  }
  function Kn(t, e) {
    this.uuid = gs.generateUUID(),
    this.array = t,
    this.stride = e,
    this.count = void 0 !== t
      ? t.length / e
      : 0,
    this.dynamic = !1,
    this.updateRange = {
      offset: 0,
      count: -1
    },
    this.onUploadCallback = function() {},
    this.version = 0
  }
  function Qn(t, e, i) {
    Kn.call(this, t, e),
    this.meshPerAttribute = i || 1
  }
  function Jn(t, e, i) {
    pt.call(this, t, e),
    this.meshPerAttribute = i || 1
  }
  function $n(t, e, i, n) {
    this.ray = new rt(t, e),
    this.near = i || 0,
    this.far = n || 1 / 0,
    this.params = {
      Mesh: {},
      Line: {},
      LOD: {},
      Points: {
        threshold: 1
      },
      Sprite: {}
    },
    Object.defineProperties(this.params, {
      PointCloud: {
        get: function() {
          return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),
          this.Points
        }
      }
    })
  }
  function to(t, e) {
    return t.distance - e.distance
  }
  function eo(t, e, i, n) {
    if (t.visible !== !1 && (t.raycast(e, i), n === !0))
      for (var o = t.children, r = 0, a = o.length; r < a; r++)
        eo(o[r], e, i, !0)
  }
  function io(t) {
    this.autoStart = void 0 === t || t,
    this.startTime = 0,
    this.oldTime = 0,
    this.elapsedTime = 0,
    this.running = !1
  }
  function no(t, e, i) {
    return this.radius = void 0 !== t
      ? t
      : 1,
    this.phi = void 0 !== e
      ? e
      : 0,
    this.theta = void 0 !== i
      ? i
      : 0,
    this
  }
  function oo(t, e, i) {
    return this.radius = void 0 !== t
      ? t
      : 1,
    this.theta = void 0 !== e
      ? e
      : 0,
    this.y = void 0 !== i
      ? i
      : 0,
    this
  }
  function ro(t, e) {
    St.call(this, t, e),
    this.animationsMap = {},
    this.animationsList = [];
    var i = this.geometry.morphTargets.length,
      n = i - 1,
      o = i / 1;
    this.createAnimation("__default", 0, n, o),
    this.setAnimationWeight("__default", 1)
  }
  function ao(t) {
    lt.call(this),
    this.material = t,
    this.render = function(t) {}
  }
  function so(t, e, i, n) {
    this.object = t,
    this.size = void 0 !== e
      ? e
      : 1;
    var o = void 0 !== i
        ? i
        : 16711680,
      r = void 0 !== n
        ? n
        : 1,
      a = 0,
      s = this.object.geometry;
    s && s.isGeometry
      ? a = 3 * s.faces.length
      : s && s.isBufferGeometry && (a = s.attributes.normal.count);
    var l = new Mt,
      c = new bt(2 * a * 3, 3);
    l.addAttribute("position", c),
    Le.call(this, l, new Te({color: o, linewidth: r})),
    this.matrixAutoUpdate = !1,
    this.update()
  }
  function lo(t) {
    lt.call(this),
    this.light = t,
    this.light.updateMatrixWorld(),
    this.matrix = t.matrixWorld,
    this.matrixAutoUpdate = !1;
    for (var e = new Mt, i = [
      0,
      0,
      0,
      0,
      0,
      1,
      0,
      0,
      0,
      1,
      0,
      1,
      0,
      0,
      0,
      -1,
      0,
      1,
      0,
      0,
      0,
      0,
      1,
      1,
      0,
      0,
      0,
      0,
      -1,
      1
    ], n = 0, o = 1; n < 32; n++, o++) {
      var r = n / 32 * Math.PI * 2,
        a = o / 32 * Math.PI * 2;
      i.push(Math.cos(r), Math.sin(r), 1, Math.cos(a), Math.sin(a), 1)
    }
    e.addAttribute("position", new bt(i, 3));
    var s = new Te({
      fog: !1
    });
    this.cone = new Le(e, s),
    this.add(this.cone),
    this.update()
  }
  function co(t) {
    this.bones = this.getBoneList(t);
    for (var e = new Mt, i = [], n = [], o = new j(0, 0, 1), r = new j(0, 1, 0), a = 0; a < this.bones.length; a++) {
      var s = this.bones[a];
      s.parent && s.parent.isBone && (i.push(0, 0, 0), i.push(0, 0, 0), n.push(o.r, o.g, o.b), n.push(r.r, r.g, r.b))
    }
    e.addAttribute("position", new bt(i, 3)),
    e.addAttribute("color", new bt(n, 3));
    var l = new Te({
      vertexColors: Lr,
      depthTest: !1,
      depthWrite: !1,
      transparent: !0
    });
    Le.call(this, e, l),
    this.root = t,
    this.matrix = t.matrixWorld,
    this.matrixAutoUpdate = !1,
    this.update()
  }
  function ho(t, e) {
    this.light = t,
    this.light.updateMatrixWorld();
    var i = new ri(e, 4, 2),
      n = new dt({
        wireframe: !0,
        fog: !1
      });
    n.color.copy(this.light.color),
    St.call(this, i, n),
    this.matrix = this.light.matrixWorld,
    this.matrixAutoUpdate = !1
  }
  function uo(t) {
    lt.call(this),
    this.light = t,
    this.light.updateMatrixWorld(),
    this.matrix = t.matrixWorld,
    this.matrixAutoUpdate = !1;
    var e = new Te({color: t.color}),
      i = new Mt;
    i.addAttribute("position", new pt(new Float32Array(15), 3)),
    this.add(new _e(i, e)),
    this.update()
  }
  function po(t, e) {
    lt.call(this),
    this.light = t,
    this.light.updateMatrixWorld(),
    this.matrix = t.matrixWorld,
    this.matrixAutoUpdate = !1;
    var i = new ze(e);
    i.rotateY(.5 * Math.PI);
    var n = new dt({
        vertexColors: Lr,
        wireframe: !0
      }),
      o = i.getAttribute("position"),
      r = new Float32Array(3 * o.count);
    i.addAttribute("color", new pt(r, 3)),
    this.add(new St(i, n)),
    this.update()
  }
  function fo(t, e, i, n) {
    t = t || 10,
    e = e || 10,
    i = new j(
      void 0 !== i
      ? i
      : 4473924),
    n = new j(
      void 0 !== n
      ? n
      : 8947848);
    for (var o = e / 2, r = t / e, a = t / 2, s = [], l = [], c = 0, h = 0, u = -a; c <= e; c++, u += r) {
      s.push(-a, 0, u, a, 0, u),
      s.push(u, 0, -a, u, 0, a);
      var d = c === o
        ? i
        : n;
      d.toArray(l, h),
      h += 3,
      d.toArray(l, h),
      h += 3,
      d.toArray(l, h),
      h += 3,
      d.toArray(l, h),
      h += 3
    }
    var p = new Mt;
    p.addAttribute("position", new bt(s, 3)),
    p.addAttribute("color", new bt(l, 3));
    var f = new Te({vertexColors: Lr});
    Le.call(this, p, f)
  }
  function mo(t, e, i, n, o, r) {
    t = t || 10,
    e = e || 16,
    i = i || 8,
    n = n || 64,
    o = new j(
      void 0 !== o
      ? o
      : 4473924),
    r = new j(
      void 0 !== r
      ? r
      : 8947848);
    var a,
      s,
      l,
      c,
      h,
      u,
      d,
      p = [],
      f = [];
    for (c = 0; c <= e; c++)
      l = c / e * (2 * Math.PI),
      a = Math.sin(l) * t,
      s = Math.cos(l) * t,
      p.push(0, 0, 0),
      p.push(a, 0, s),
      d = 1 & c
        ? o
        : r,
      f.push(d.r, d.g, d.b),
      f.push(d.r, d.g, d.b);
    for (c = 0; c <= i; c++)
      for (
        d = 1 & c
        ? o
        : r,
      u = t - t / i * c,
      h = 0; h < n; h++)
        l = h / n * (2 * Math.PI),
        a = Math.sin(l) * u,
        s = Math.cos(l) * u,
        p.push(a, 0, s),
        f.push(d.r, d.g, d.b),
        l = (h + 1) / n * (2 * Math.PI),
        a = Math.sin(l) * u,
        s = Math.cos(l) * u,
        p.push(a, 0, s),
        f.push(d.r, d.g, d.b);
  var m = new Mt;
    m.addAttribute("position", new bt(p, 3)),
    m.addAttribute("color", new bt(f, 3));
    var g = new Te({vertexColors: Lr});
    Le.call(this, m, g)
  }
  function go(t, e, i, n) {
    this.object = t,
    this.size = void 0 !== e
      ? e
      : 1;
    var o = void 0 !== i
        ? i
        : 16776960,
      r = void 0 !== n
        ? n
        : 1,
      a = 0,
      s = this.object.geometry;
    s && s.isGeometry
      ? a = s.faces.length
      : console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");
    var l = new Mt,
      c = new bt(2 * a * 3, 3);
    l.addAttribute("position", c),
    Le.call(this, l, new Te({color: o, linewidth: r})),
    this.matrixAutoUpdate = !1,
    this.update()
  }
  function vo(t, e) {
    lt.call(this),
    this.light = t,
    this.light.updateMatrixWorld(),
    this.matrix = t.matrixWorld,
    this.matrixAutoUpdate = !1,
    void 0 === e && (e = 1);
    var i = new Mt;
    i.addAttribute("position", new bt([
      -e,
      e,
      0,
      e,
      e,
      0,
      e, -e,
      0, -e, -e,
      0, -e,
      e,
      0
    ], 3));
    var n = new Te({
      fog: !1
    });
    this.add(new _e(i, n)),
    i = new Mt,
    i.addAttribute("position", new bt([
      0,
      0,
      0,
      0,
      0,
      1
    ], 3)),
    this.add(new _e(i, n)),
    this.update()
  }
  function yo(t) {
    function e(t, e, n) {
      i(t, n),
      i(e, n)
    }
    function i(t, e) {
      r.push(0, 0, 0),
      a.push(e.r, e.g, e.b),
      void 0 === s[t] && (s[t] = []),
      s[t].push(r.length / 3 - 1)
    }
    var n = new Mt,
      o = new Te({color: 16777215, vertexColors: _r}),
      r = [],
      a = [],
      s = {},
      l = new j(16755200),
      c = new j(16711680),
      h = new j(43775),
      u = new j(16777215),
      d = new j(3355443);
    e("n1", "n2", l),
    e("n2", "n4", l),
    e("n4", "n3", l),
    e("n3", "n1", l),
    e("f1", "f2", l),
    e("f2", "f4", l),
    e("f4", "f3", l),
    e("f3", "f1", l),
    e("n1", "f1", l),
    e("n2", "f2", l),
    e("n3", "f3", l),
    e("n4", "f4", l),
    e("p", "n1", c),
    e("p", "n2", c),
    e("p", "n3", c),
    e("p", "n4", c),
    e("u1", "u2", h),
    e("u2", "u3", h),
    e("u3", "u1", h),
    e("c", "t", u),
    e("p", "c", d),
    e("cn1", "cn2", d),
    e("cn3", "cn4", d),
    e("cf1", "cf2", d),
    e("cf3", "cf4", d),
    n.addAttribute("position", new bt(r, 3)),
    n.addAttribute("color", new bt(a, 3)),
    Le.call(this, n, o),
    this.camera = t,
    this.camera.updateProjectionMatrix && this.camera.updateProjectionMatrix(),
    this.matrix = t.matrixWorld,
    this.matrixAutoUpdate = !1,
    this.pointMap = s,
    this.update()
  }
  function Eo(t, e) {
    this.object = t,
    void 0 === e && (e = 16776960);
    var i = new Uint16Array([
        0,
        1,
        1,
        2,
        2,
        3,
        3,
        0,
        4,
        5,
        5,
        6,
        6,
        7,
        7,
        4,
        0,
        4,
        1,
        5,
        2,
        6,
        3,
        7
      ]),
      n = new Float32Array(24),
      o = new Mt;
    o.setIndex(new pt(i, 1)),
    o.addAttribute("position", new pt(n, 3)),
    Le.call(this, o, new Te({color: e})),
    this.matrixAutoUpdate = !1,
    this.update()
  }
  function xo(t, e, i, n, o, r) {
    lt.call(this),
    void 0 === n && (n = 16776960),
    void 0 === i && (i = 1),
    void 0 === o && (o = .2 * i),
    void 0 === r && (r = .2 * o),
    void 0 === Ys && (Ys = new Mt, Ys.addAttribute("position", new bt([
      0,
      0,
      0,
      0,
      1,
      0
    ], 3)), Zs = new fi(0, .5, 1, 5, 1), Zs.translate(0, -.5, 0)),
    this.position.copy(e),
    this.line = new _e(Ys, new Te({color: n})),
    this.line.matrixAutoUpdate = !1,
    this.add(this.line),
    this.cone = new St(Zs, new dt({color: n})),
    this.cone.matrixAutoUpdate = !1,
    this.add(this.cone),
    this.setDirection(t),
    this.setLength(i, o, r)
  }
  function bo(t) {
    t = t || 1;
    var e = [
        0,
        0,
        0,
        t,
        0,
        0,
        0,
        0,
        0,
        0,
        t,
        0,
        0,
        0,
        0,
        0,
        0,
        t
      ],
      i = [
        1,
        0,
        0,
        1,
        .6,
        0,
        0,
        1,
        0,
        .6,
        1,
        0,
        0,
        0,
        1,
        0,
        .6,
        1
      ],
      n = new Mt;
    n.addAttribute("position", new bt(e, 3)),
    n.addAttribute("color", new bt(i, 3));
    var o = new Te({vertexColors: Lr});
    Le.call(this, n, o)
  }
  function wo() {
    function t(t, r, a, s) {
      e = t,
      i = a,
      n = -3 * t + 3 * r - 2 * a - s,
      o = 2 * t - 2 * r + a + s
    }
    var e = 0,
      i = 0,
      n = 0,
      o = 0;
    return {
      initCatmullRom: function(e, i, n, o, r) {
        t(i, n, r * (n - e), r * (o - i))
      },
      initNonuniformCatmullRom: function(e, i, n, o, r, a, s) {
        var l = (i - e) / r - (n - e) / (r + a) + (n - i) / a,
          c = (n - i) / a - (o - i) / (a + s) + (o - n) / s;
        l *= a,
        c *= a,
        t(i, n, l, c)
      },
      calc: function(t) {
        var r = t * t;
        return e + i * t + n * r + o * (r * t)
      }
    }
  }
  function Co(t) {
    bn.call(this),
    this.points = t || [],
    this.closed = !1
  }
  function To(t, e, i, n) {
    bn.call(this),
    this.v0 = t,
    this.v1 = e,
    this.v2 = i,
    this.v3 = n
  }
  function _o(t, e, i) {
    bn.call(this),
    this.v0 = t,
    this.v1 = e,
    this.v2 = i
  }
  function Lo(t, e) {
    bn.call(this),
    this.v1 = t,
    this.v2 = e
  }
  function Mo(t, e, i, n, o, r) {
    Tn.call(this, t, e, i, i, n, o, r)
  }
  function So(t, e, i, n, o, r, a) {
    return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),
    new ut(t, e, i, o, r, a)
  }
  function Oo(t) {
    return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),
    t
  }
  function Do(t) {
    return void 0 === t && (t = []),
    console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),
    t.isMultiMaterial = !0,
    t.materials = t,
    t.clone = function() {
      return t.slice()
    },
    t
  }
  function Ro(t, e) {
    return console.warn("THREE.PointCloud has been renamed to THREE.Points."),
    new Oe(t, e)
  }
  function Uo(t) {
    return console.warn("THREE.Particle has been renamed to THREE.Sprite."),
    new Ee(t)
  }
  function Ao(t, e) {
    return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),
    new Oe(t, e)
  }
  function Io(t) {
    return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),
    new Se(t)
  }
  function Po(t) {
    return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),
    new Se(t)
  }
  function Bo(t) {
    return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),
    new Se(t)
  }
  function No(t, e, i) {
    return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),
    new l(t, e, i)
  }
  function ko(t, e) {
    return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),
    new pt(t, e).setDynamic(!0)
  }
  function Ho(t, e) {
    return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),
    new ft(t, e)
  }
  function Fo(t, e) {
    return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),
    new mt(t, e)
  }
  function Go(t, e) {
    return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),
    new gt(t, e)
  }
  function Vo(t, e) {
    return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),
    new vt(t, e)
  }
  function zo(t, e) {
    return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),
    new yt(t, e)
  }
  function qo(t, e) {
    return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),
    new Et(t, e)
  }
  function Wo(t, e) {
    return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),
    new xt(t, e)
  }
  function jo(t, e) {
    return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),
    new bt(t, e)
  }
  function Xo(t, e) {
    return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),
    new wt(t, e)
  }
  function Yo(t) {
    console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),
    Co.call(this, t),
    this.type = "catmullrom",
    this.closed = !0
  }
  function Zo(t) {
    console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),
    Co.call(this, t),
    this.type = "catmullrom"
  }
  function Ko(t) {
    console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),
    Co.call(this, t),
    this.type = "catmullrom"
  }
  function Qo(t, e) {
    return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),
    new Eo(t, e)
  }
  function Jo(t, e) {
    return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),
    new Le(new di(t.geometry), new Te({
      color: void 0 !== e
        ? e
        : 16777215
    }))
  }
  function $o(t, e) {
    return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),
    new Le(new Pe(t.geometry), new Te({
      color: void 0 !== e
        ? e
        : 16777215
    }))
  }
  function tr(t) {
    return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),
    new Oi(t)
  }
  function er(t) {
    return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),
    new Ri(t)
  }
  function ir() {
    console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),
    this.projectVector = function(t, e) {
      console.warn("THREE.Projector: .projectVector() is now vector.project()."),
      t.project(e)
    },
    this.unprojectVector = function(t, e) {
      console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),
      t.unproject(e)
    },
    this.pickingRay = function() {
      console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")
    }
  }
  function nr() {
    console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),
    this.domElement = document.createElementNS("http://www.w3.org/1999/xhtml", "canvas"),
    this.clear = function() {},
    this.render = function() {},
    this.setClearColor = function() {},
    this.setSize = function() {}
  }
  function or(t, e) {
    "number" != typeof t && (e = t, t = 0),
    this.size = 0,
    this.limit = t,
    this.oldest = this.newest = void 0,
    this._keymap = new Map,
    e && (this.assign(e), t < 1 && (this.limit = this.size))
  }
  function rr(t, e) {
    this.key = t,
    this.value = e,
    this[nl] = void 0,
    this[ol] = void 0
  }
  function ar(t) {
    this.entry = t
  }
  function sr(t) {
    this.entry = t
  }
  function lr(t) {
    this.entry = t
  }
  function cr(t, e, i, n) {
    function o(t, n) {
      null !== n.index && e.remove(n.index);
      for (var o in n.attributes)
        e.remove(n.attributes[o]);
      var r = c[t];
      r && (e.remove(r), delete c[t]),
      r = c[n.id],
      r && (e.remove(r), delete c[n.id]),
      i.geometries--
    }
    function r(t, e) {
      var n = e.id;
      if (l.has(n))
        return l.get(n);
      var o;
      return e.isBufferGeometry
        ? o = e
        : e.isGeometry && (void 0 === e._bufferGeometry && (e._bufferGeometry = (new Mt).setFromObject(t)), o = e._bufferGeometry),
      l.set(n, o),
      i.geometries++,
      o
    }
    function a(i) {
      var n = i.index,
        o = i.attributes;
      null !== n && e.update(n, t.ELEMENT_ARRAY_BUFFER);
      for (var r in o)
        e.update(o[r], t.ARRAY_BUFFER);
      var a = i.morphAttributes;
      for (var r in a)
        for (var s = a[r], l = 0, c = s.length; l < c; l++)
          e.update(s[l], t.ARRAY_BUFFER)
    }
    function s(i) {
      var n = c[i.id];
      if (n)
        return n;
      var o = [],
        r = i.index,
        a = i.attributes;
      if (null !== r)
        for (var s = r.array, l = 0, h = s.length; l < h; l += 3) {
          var u = s[l + 0],
            d = s[l + 1],
            p = s[l + 2];
          o.push(u, d, d, p, p, u)
        }
      else
        for (var s = a.position.array, l = 0, h = s.length / 3 - 1; l < h; l += 3) {
          var u = l + 0,
            d = l + 1,
            p = l + 2;
          o.push(u, d, d, p, p, u)
        }
      return n = new(
        Tt(o) > 65535
        ? xt
        : yt)(o, 1),
      e.update(n, t.ELEMENT_ARRAY_BUFFER),
      c[i.id] = n,
      n
    }
    var l = new or(n),
      c = {};
    return l.shift = function() {
      var t = or.prototype.shift.call(this);
      o(t[0], t[1])
    }, {
      get: r,
      update: a,
      getWireframeAttribute: s
    }
  }
  function hr(t) {
    function e() {
      return null === K
        ? ut
        : 1
    }
    function i() {
      Ut.init(),
      Ut.scissor(et.copy(dt).multiplyScalar(ut)),
      Ut.viewport(rt.copy(ft).multiplyScalar(ut)),
      Ut.buffers.color.setClear(st.r, st.g, st.b, lt, N)
    }
    function n() {
      X = null,
      tt = null,
      $ = "",
      J = -1,
      Ut.reset()
    }
    function r(t) {
      t.preventDefault(),
      n(),
      i(),
      At.clear(),
      Nt.clear()
    }
    function a(t) {
      var e = t.target;
      e.removeEventListener("dispose", a),
      s(e)
    }
    function s(t) {
      u(t),
      At.remove(t)
    }
    function u(t) {
      var e = At.get(t).program;
      t.program = void 0,
      void 0 !== e && kt.releaseProgram(e)
    }
    function d(t, e) {
      return Math.abs(e[0]) - Math.abs(t[0])
    }
    function p(t, e, i, n) {
      if (i && i.isInstancedBufferGeometry && null === Ot.get("ANGLE_instanced_arrays"))
        return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
      void 0 === n && (n = 0),
      Ut.initAttributes();
      var o = i.attributes,
        r = e.getAttributes(),
        a = t.defaultAttributeValues;
      for (var s in r) {
        var l = r[s];
        if (l >= 0) {
          var c = o[s];
          if (void 0 !== c) {
            var h = c.normalized,
              u = c.itemSize,
              d = Pt.get(c),
              p = d.buffer,
              f = d.type,
              m = d.bytesPerElement;
            if (c.isInterleavedBufferAttribute) {
              var g = c.data,
                v = g.stride,
                y = c.offset;
              g && g.isInstancedInterleavedBuffer
                ? (Ut.enableAttributeAndDivisor(l, g.meshPerAttribute), void 0 === i.maxInstancedCount && (i.maxInstancedCount = g.meshPerAttribute * g.count))
                : Ut.enableAttribute(l),
              Lt.bindBuffer(Lt.ARRAY_BUFFER, p),
              Lt.vertexAttribPointer(l, u, f, h, v * m, (n * v + y) * m)
            } else
              c.isInstancedBufferAttribute
                ? (Ut.enableAttributeAndDivisor(l, c.meshPerAttribute), void 0 === i.maxInstancedCount && (i.maxInstancedCount = c.meshPerAttribute * c.count))
                : Ut.enableAttribute(l),
              Lt.bindBuffer(Lt.ARRAY_BUFFER, p),
              Lt.vertexAttribPointer(l, u, f, h, 0, n * u * m)
          } else if (void 0 !== a) {
            var E = a[s];
            if (void 0 !== E)
              switch (E.length) {
                case 2:
                  Lt.vertexAttrib2fv(l, E);
                  break;
                case 3:
                  Lt.vertexAttrib3fv(l, E);
                  break;
                case 4:
                  Lt.vertexAttrib4fv(l, E);
                  break;
                default:
                  Lt.vertexAttrib1fv(l, E)
              }
            }
        }
      }
      Ut.disableUnusedAttributes()
    }
    function f(t, e, i) {
      var n = At.get(t),
        o = kt.getParameters(t, Ct, e, gt.numPlanes, gt.numIntersection, i),
        r = kt.getProgramCode(t, o),
        s = n.program,
        l = !0;
      if (void 0 === s)
        t.addEventListener("dispose", a);
      else if (s.code !== r)
        u(t);
      else {
        if (void 0 !== o.shaderID)
          return;
        l = !1
      }
      if (l) {
        if (o.shaderID) {
          var c = Os[o.shaderID];
          n.__webglShader = {
            name: t.type,
            uniforms: Ms.clone(c.uniforms),
            vertexShader: c.vertexShader,
            fragmentShader: c.fragmentShader
          }
        } else
          n.__webglShader = {
            name: t.type,
            uniforms: t.uniforms,
            vertexShader: t.vertexShader,
            fragmentShader: t.fragmentShader
          };
        t.__webglShader = n.__webglShader,
        s = kt.acquireProgram(t, o, r),
        n.program = s,
        t.program = s
      }
      var h = s.getAttributes();
      if (t.morphTargets) {
        t.numSupportedMorphTargets = 0;
        for (var d = 0; d < q.maxMorphTargets; d++)
          h["morphTarget" + d] >= 0 && t.numSupportedMorphTargets++
      }
      if (t.morphNormals) {
        t.numSupportedMorphNormals = 0;
        for (var d = 0; d < q.maxMorphNormals; d++)
          h["morphNormal" + d] >= 0 && t.numSupportedMorphNormals++
      }
      var p = n.__webglShader.uniforms;
      (t.isShaderMaterial || t.isRawShaderMaterial) && t.clipping !== !0 || (n.numClippingPlanes = gt.numPlanes, n.numIntersection = gt.numIntersection, p.clippingPlanes = gt.uniform),
      n.fog = e,
      n.lightsHash = Ct.hash,
      t.lights && (p.ambientLightColor.value = Ct.ambient, p.directionalLights.value = Ct.directional, p.spotLights.value = Ct.spot, p.rectAreaLights.value = Ct.rectArea, p.pointLights.value = Ct.point, p.hemisphereLights.value = Ct.hemi, p.directionalShadowMap.value = Ct.directionalShadowMap, p.directionalShadowMatrix.value = Ct.directionalShadowMatrix, p.spotShadowMap.value = Ct.spotShadowMap, p.spotShadowMatrix.value = Ct.spotShadowMatrix, p.pointShadowMap.value = Ct.pointShadowMap, p.pointShadowMatrix.value = Ct.pointShadowMatrix);
      var f = n.program.getUniforms(),
        m = W.seqWithValue(f.seq, p);
      n.uniformsList = m
    }
    function m(t, e, i, n) {
      at = 0;
      var o = At.get(i);
      if (vt && (yt || t !== tt)) {
        var r = t === tt && i.id === J;
        gt.setState(i.clippingPlanes, i.clipIntersection, i.clipShadows, t, o, r)
      }
      i.needsUpdate === !1 && (
        void 0 === o.program
        ? i.needsUpdate = !0
        : i.fog && o.fog !== e
          ? i.needsUpdate = !0
          : i.lights && o.lightsHash !== Ct.hash
            ? i.needsUpdate = !0
            : void 0 === o.numClippingPlanes || o.numClippingPlanes === gt.numPlanes && o.numIntersection === gt.numIntersection || (i.needsUpdate = !0)),
      i.needsUpdate && (f(i, e, n), i.needsUpdate = !1);
      var a = !1,
        s = !1,
        l = !1,
        c = o.program,
        u = c.getUniforms(),
        d = o.__webglShader.uniforms;
      if (c.id !== X && (Lt.useProgram(c.program), X = c.id, a = !0, s = !0, l = !0), i.id !== J && (J = i.id, s = !0), a || t !== tt) {
        if (u.setValue(Lt, "projectionMatrix", t.projectionMatrix), Rt.logarithmicDepthBuffer && u.setValue(Lt, "logDepthBufFC", 2 / (Math.log(t.far + 1) / Math.LN2)), t !== tt && (tt = t, s = !0, l = !0), i.isShaderMaterial || i.isMeshPhongMaterial || i.isMeshStandardMaterial || i.envMap) {
          var p = u.map.cameraPosition;
          void 0 !== p && p.setValue(Lt, xt.setFromMatrixPosition(t.matrixWorld))
        }
        (i.isMeshPhongMaterial || i.isMeshLambertMaterial || i.isMeshBasicMaterial || i.isMeshStandardMaterial || i.isShaderMaterial || i.skinning) && u.setValue(Lt, "viewMatrix", t.matrixWorldInverse),
        u.setValue(Lt, "toneMappingExposure", q.toneMappingExposure),
        u.setValue(Lt, "toneMappingWhitePoint", q.toneMappingWhitePoint)
      }
      if (i.skinning) {
        u.setOptional(Lt, n, "bindMatrix"),
        u.setOptional(Lt, n, "bindMatrixInverse");
        var m = n.skeleton;
        if (m) {
          var S = m.bones;
          if (Rt.floatVertexTextures) {
            if (void 0 === m.boneTexture) {
              var O = Math.sqrt(4 * S.length);
              O = gs.nextPowerOfTwo(Math.ceil(O)),
              O = Math.max(O, 4);
              var D = new Float32Array(O * O * 4);
              D.set(m.boneMatrices);
              var R = new h(D, O, O, Ga, Aa);
              m.boneMatrices = D,
              m.boneTexture = R,
              m.boneTextureSize = O
            }
            u.setValue(Lt, "boneTexture", m.boneTexture),
            u.setValue(Lt, "boneTextureSize", m.boneTextureSize)
          } else
            u.setOptional(Lt, m, "boneMatrices")
        }
      }
      return s && (
        i.lights && M(d, l), e && i.fog && x(d, e), (i.isMeshBasicMaterial || i.isMeshLambertMaterial || i.isMeshPhongMaterial || i.isMeshStandardMaterial || i.isMeshNormalMaterial || i.isMeshDepthMaterial) && g(d, i), i.isLineBasicMaterial
        ? v(d, i)
        : i.isLineDashedMaterial
          ? (v(d, i), y(d, i))
          : i.isPointsMaterial
            ? E(d, i)
            : i.isMeshLambertMaterial
              ? b(d, i)
              : i.isMeshToonMaterial
                ? C(d, i)
                : i.isMeshPhongMaterial
                  ? w(d, i)
                  : i.isMeshPhysicalMaterial
                    ? _(d, i)
                    : i.isMeshStandardMaterial
                      ? T(d, i)
                      : i.isMeshDepthMaterial
                        ? i.displacementMap && (d.displacementMap.value = i.displacementMap, d.displacementScale.value = i.displacementScale, d.displacementBias.value = i.displacementBias)
                        : i.isMeshNormalMaterial && L(d, i),
      void 0 !== d.ltcMat && (d.ltcMat.value = Ls.LTC_MAT_TEXTURE),
      void 0 !== d.ltcMag && (d.ltcMag.value = Ls.LTC_MAG_TEXTURE),
      W.upload(Lt, o.uniformsList, d, q)),
      u.setValue(Lt, "modelViewMatrix", n.modelViewMatrix),
      u.setValue(Lt, "normalMatrix", n.normalMatrix),
      u.setValue(Lt, "modelMatrix", n.matrixWorld),
      c
    }
    function g(t, e) {
      t.opacity.value = e.opacity,
      t.diffuse.value = e.color,
      e.emissive && t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),
      t.map.value = e.map,
      t.specularMap.value = e.specularMap,
      t.alphaMap.value = e.alphaMap,
      e.lightMap && (t.lightMap.value = e.lightMap, t.lightMapIntensity.value = e.lightMapIntensity),
      e.aoMap && (t.aoMap.value = e.aoMap, t.aoMapIntensity.value = e.aoMapIntensity);
      var i;
      if (
        e.map
        ? i = e.map
        : e.specularMap
          ? i = e.specularMap
          : e.displacementMap
            ? i = e.displacementMap
            : e.normalMap
              ? i = e.normalMap
              : e.bumpMap
                ? i = e.bumpMap
                : e.roughnessMap
                  ? i = e.roughnessMap
                  : e.metalnessMap
                    ? i = e.metalnessMap
                    : e.alphaMap
                      ? i = e.alphaMap
                      : e.emissiveMap && (i = e.emissiveMap),
      void 0 !== i) {
        i.isWebGLRenderTarget && (i = i.texture);
        var n = i.offset,
          o = i.repeat;
        t.offsetRepeat.value.set(n.x, n.y, o.x, o.y),
        t.rotateMatrix.value.copy(i.rotateMatrix)
      }
      t.envMap.value = e.envMap,
      t.flipEnvMap.value = e.envMap && e.envMap.isCubeTexture
        ? -1
        : 1,
      t.reflectivity.value = e.reflectivity,
      t.refractionRatio.value = e.refractionRatio
    }
    function v(t, e) {
      t.diffuse.value = e.color,
      t.opacity.value = e.opacity
    }
    function y(t, e) {
      t.dashSize.value = e.dashSize,
      t.totalSize.value = e.dashSize + e.gapSize,
      t.scale.value = e.scale
    }
    function E(t, e) {
      if (t.diffuse.value = e.color, t.opacity.value = e.opacity, t.size.value = e.size * ut, t.scale.value = .5 * ht, t.map.value = e.map, null !== e.map) {
        var i = e.map.offset,
          n = e.map.repeat;
        t.offsetRepeat.value.set(i.x, i.y, n.x, n.y)
      }
    }
    function x(t, e) {
      t.fogColor.value = e.color,
      e.isFog
        ? (t.fogNear.value = e.near, t.fogFar.value = e.far)
        : e.isFogExp2 && (t.fogDensity.value = e.density)
    }
    function b(t, e) {
      e.emissiveMap && (t.emissiveMap.value = e.emissiveMap)
    }
    function w(t, e) {
      t.specular.value = e.specular,
      t.shininess.value = Math.max(e.shininess, 1e-4),
      e.emissiveMap && (t.emissiveMap.value = e.emissiveMap),
      e.bumpMap && (t.bumpMap.value = e.bumpMap, t.bumpScale.value = e.bumpScale),
      e.normalMap && (t.normalMap.value = e.normalMap, t.normalScale.value.copy(e.normalScale)),
      e.displacementMap && (t.displacementMap.value = e.displacementMap, t.displacementScale.value = e.displacementScale, t.displacementBias.value = e.displacementBias)
    }
    function C(t, e) {
      w(t, e),
      e.gradientMap && (t.gradientMap.value = e.gradientMap)
    }
    function T(t, e) {
      t.roughness.value = e.roughness,
      t.metalness.value = e.metalness,
      e.roughnessMap && (t.roughnessMap.value = e.roughnessMap),
      e.metalnessMap && (t.metalnessMap.value = e.metalnessMap),
      e.emissiveMap && (t.emissiveMap.value = e.emissiveMap),
      e.bumpMap && (t.bumpMap.value = e.bumpMap, t.bumpScale.value = e.bumpScale),
      e.normalMap && (t.normalMap.value = e.normalMap, t.normalScale.value.copy(e.normalScale)),
      e.displacementMap && (t.displacementMap.value = e.displacementMap, t.displacementScale.value = e.displacementScale, t.displacementBias.value = e.displacementBias),
      e.envMap && (t.envMapIntensity.value = e.envMapIntensity)
    }
    function _(t, e) {
      t.clearCoat.value = e.clearCoat,
      t.clearCoatRoughness.value = e.clearCoatRoughness,
      T(t, e)
    }
    function L(t, e) {
      e.bumpMap && (t.bumpMap.value = e.bumpMap, t.bumpScale.value = e.bumpScale),
      e.normalMap && (t.normalMap.value = e.normalMap, t.normalScale.value.copy(e.normalScale)),
      e.displacementMap && (t.displacementMap.value = e.displacementMap, t.displacementScale.value = e.displacementScale, t.displacementBias.value = e.displacementBias)
    }
    function M(t, e) {
      t.ambientLightColor.needsUpdate = e,
      t.directionalLights.needsUpdate = e,
      t.pointLights.needsUpdate = e,
      t.spotLights.needsUpdate = e,
      t.rectAreaLights.needsUpdate = e,
      t.hemisphereLights.needsUpdate = e
    }
    function S(t, e) {
      var i,
        n,
        o,
        r,
        a,
        s,
        l,
        c,
        h = 0,
        u = 0,
        d = 0,
        p = e.matrixWorldInverse,
        f = 0,
        m = 0,
        g = 0,
        v = 0,
        y = 0;
      for (i = 0, n = t.length; i < n; i++)
        if (
          o = t[i], a = o.color, s = o.intensity, l = o.distance, c = o.shadow && o.shadow.map
          ? o.shadow.map.texture
          : null,
        o.isAmbientLight)
          h += a.r * s,
          u += a.g * s,
          d += a.b * s;
        else if (o.isDirectionalLight) {
          var E = Ht.get(o);
          E.color.copy(o.color).multiplyScalar(o.intensity),
          E.direction.setFromMatrixPosition(o.matrixWorld),
          xt.setFromMatrixPosition(o.target.matrixWorld),
          E.direction.sub(xt),
          E.direction.transformDirection(p),
          E.shadow = o.castShadow,
          o.castShadow && (r = o.shadow, E.shadowBias = r.bias, E.shadowRadius = r.radius, E.shadowMapSize = r.mapSize),
          Ct.directionalShadowMap[f] = c,
          Ct.directionalShadowMatrix[f] = o.shadow.matrix,
          Ct.directional[f] = E,
          f++
        }
      else if (o.isSpotLight) {
        var E = Ht.get(o);
        E.position.setFromMatrixPosition(o.matrixWorld),
        E.position.applyMatrix4(p),
        E.color.copy(a).multiplyScalar(s),
        E.distance = l,
        E.direction.setFromMatrixPosition(o.matrixWorld),
        xt.setFromMatrixPosition(o.target.matrixWorld),
        E.direction.sub(xt),
        E.direction.transformDirection(p),
        E.coneCos = Math.cos(o.angle),
        E.penumbraCos = Math.cos(o.angle * (1 - o.penumbra)),
        E.decay = 0 === o.distance
          ? 0
          : o.decay,
        E.shadow = o.castShadow,
        o.castShadow && (r = o.shadow, E.shadowBias = r.bias, E.shadowRadius = r.radius, E.shadowMapSize = r.mapSize),
        Ct.spotShadowMap[g] = c,
        Ct.spotShadowMatrix[g] = o.shadow.matrix,
        Ct.spot[g] = E,
        g++
      } else if (o.isRectAreaLight) {
        var E = Ht.get(o);
        E.color.copy(a).multiplyScalar(s / (o.width * o.height)),
        E.position.setFromMatrixPosition(o.matrixWorld),
        E.position.applyMatrix4(p),
        wt.identity(),
        bt.copy(o.matrixWorld),
        bt.premultiply(p),
        wt.extractRotation(bt),
        E.halfWidth.set(.5 * o.width, 0, 0),
        E.halfHeight.set(0, .5 * o.height, 0),
        E.halfWidth.applyMatrix4(wt),
        E.halfHeight.applyMatrix4(wt),
        Ct.rectArea[v] = E,
        v++
      } else if (o.isPointLight) {
        var E = Ht.get(o);
        E.position.setFromMatrixPosition(o.matrixWorld),
        E.position.applyMatrix4(p),
        E.color.copy(o.color).multiplyScalar(o.intensity),
        E.distance = o.distance,
        E.decay = 0 === o.distance
          ? 0
          : o.decay,
        E.shadow = o.castShadow,
        o.castShadow && (r = o.shadow, E.shadowBias = r.bias, E.shadowRadius = r.radius, E.shadowMapSize = r.mapSize),
        Ct.pointShadowMap[m] = c,
        Ct.pointShadowMatrix[m] = o.shadow.matrix,
        Ct.point[m] = E,
        m++
      } else if (o.isHemisphereLight) {
        var E = Ht.get(o);
        E.direction.setFromMatrixPosition(o.matrixWorld),
        E.direction.transformDirection(p),
        E.direction.normalize(),
        E.skyColor.copy(o.color).multiplyScalar(s),
        E.groundColor.copy(o.groundColor).multiplyScalar(s),
        Ct.hemi[y] = E,
        y++
      }
      Ct.ambient[0] = h,
      Ct.ambient[1] = u,
      Ct.ambient[2] = d,
      Ct.directional.length = f,
      Ct.spot.length = g,
      Ct.rectArea.length = v,
      Ct.point.length = m,
      Ct.hemi.length = y,
      Ct.hash = f + "," + m + "," + g + "," + v + "," + y + "," + Ct.shadows.length
    }
    function O() {
      var t = at;
      return t >= Rt.maxTextures && console.warn("WebGLRenderer: trying to use " + t + " texture units while this GPU supports only " + Rt.maxTextures),
      at += 1,
      t
    }
    function D(t) {
      var e;
      if (t === ya)
        return Lt.REPEAT;
      if (t === Ea)
        return Lt.CLAMP_TO_EDGE;
      if (t === xa)
        return Lt.MIRRORED_REPEAT;
      if (t === ba)
        return Lt.NEAREST;
      if (t === wa)
        return Lt.NEAREST_MIPMAP_NEAREST;
      if (t === Ca)
        return Lt.NEAREST_MIPMAP_LINEAR;
      if (t === Ta)
        return Lt.LINEAR;
      if (t === _a)
        return Lt.LINEAR_MIPMAP_NEAREST;
      if (t === La)
        return Lt.LINEAR_MIPMAP_LINEAR;
      if (t === Ma)
        return Lt.UNSIGNED_BYTE;
      if (t === Pa)
        return Lt.UNSIGNED_SHORT_4_4_4_4;
      if (t === Ba)
        return Lt.UNSIGNED_SHORT_5_5_5_1;
      if (t === Na)
        return Lt.UNSIGNED_SHORT_5_6_5;
      if (t === Sa)
        return Lt.BYTE;
      if (t === Oa)
        return Lt.SHORT;
      if (t === Da)
        return Lt.UNSIGNED_SHORT;
      if (t === Ra)
        return Lt.INT;
      if (t === Ua)
        return Lt.UNSIGNED_INT;
      if (t === Aa)
        return Lt.FLOAT;
      if (t === Ia && null !== (e = Ot.get("OES_texture_half_float")))
        return e.HALF_FLOAT_OES;
      if (t === Ha)
        return Lt.ALPHA;
      if (t === Fa)
        return Lt.RGB;
      if (t === Ga)
        return Lt.RGBA;
      if (t === Va)
        return Lt.LUMINANCE;
      if (t === za)
        return Lt.LUMINANCE_ALPHA;
      if (t === Wa)
        return Lt.DEPTH_COMPONENT;
      if (t === ja)
        return Lt.DEPTH_STENCIL;
      if (t === Ar)
        return Lt.FUNC_ADD;
      if (t === Ir)
        return Lt.FUNC_SUBTRACT;
      if (t === Pr)
        return Lt.FUNC_REVERSE_SUBTRACT;
      if (t === kr)
        return Lt.ZERO;
      if (t === Hr)
        return Lt.ONE;
      if (t === Fr)
        return Lt.SRC_COLOR;
      if (t === Gr)
        return Lt.ONE_MINUS_SRC_COLOR;
      if (t === Vr)
        return Lt.SRC_ALPHA;
      if (t === zr)
        return Lt.ONE_MINUS_SRC_ALPHA;
      if (t === qr)
        return Lt.DST_ALPHA;
      if (t === Wr)
        return Lt.ONE_MINUS_DST_ALPHA;
      if (t === jr)
        return Lt.DST_COLOR;
      if (t === Xr)
        return Lt.ONE_MINUS_DST_COLOR;
      if (t === Yr)
        return Lt.SRC_ALPHA_SATURATE;
      if ((t === Xa || t === Ya || t === Za || t === Ka) && null !== (e = Ot.get("WEBGL_compressed_texture_s3tc"))) {
        if (t === Xa)
          return e.COMPRESSED_RGB_S3TC_DXT1_EXT;
        if (t === Ya)
          return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;
        if (t === Za)
          return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;
        if (t === Ka)
          return e.COMPRESSED_RGBA_S3TC_DXT5_EXT
      }
      if ((t === Qa || t === Ja || t === $a || t === ts) && null !== (e = Ot.get("WEBGL_compressed_texture_pvrtc"))) {
        if (t === Qa)
          return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;
        if (t === Ja)
          return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;
        if (t === $a)
          return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;
        if (t === ts)
          return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG
      }
      if (t === es && null !== (e = Ot.get("WEBGL_compressed_texture_etc1")))
        return e.COMPRESSED_RGB_ETC1_WEBGL;
      if ((t === Br || t === Nr) && null !== (e = Ot.get("EXT_blend_minmax"))) {
        if (t === Br)
          return e.MIN_EXT;
        if (t === Nr)
          return e.MAX_EXT
      }
      return t === ka && null !== (e = Ot.get("WEBGL_depth_texture"))
        ? e.UNSIGNED_INT_24_8_WEBGL
        : 0
    }
    console.log("THREE.WebGLRenderer", ur),
    t = t || {};
    var R = void 0 !== t.canvas
        ? t.canvas
        : document.createElementNS("http://www.w3.org/1999/xhtml", "canvas"),
      U = void 0 !== t.context
        ? t.context
        : null,
      A = void 0 !== t.alpha && t.alpha,
      I = void 0 === t.depth || t.depth,
      P = void 0 === t.stencil || t.stencil,
      B = void 0 !== t.antialias && t.antialias,
      N = void 0 === t.premultipliedAlpha || t.premultipliedAlpha,
      k = void 0 !== t.preserveDrawingBuffer && t.preserveDrawingBuffer,
      H = t.maxDrawCacheNum,
      F = [],
      G = new Float32Array(8),
      V = [],
      z = [];
    this.domElement = R,
    this.context = null,
    this.autoClear = !0,
    this.autoClearColor = !0,
    this.autoClearDepth = !0,
    this.autoClearStencil = !0,
    this.sortObjects = !0,
    this.clippingPlanes = [],
    this.localClippingEnabled = !1,
    this.gammaFactor = 2,
    this.gammaInput = !1,
    this.gammaOutput = !1,
    this.physicallyCorrectLights = !1,
    this.toneMapping = sa,
    this.toneMappingExposure = 1,
    this.toneMappingWhitePoint = 1,
    this.maxMorphTargets = 8,
    this.maxMorphNormals = 4;
    var q = this,
      X = null,
      K = null,
      Q = null,
      J = -1,
      $ = "",
      tt = null,
      et = new o,
      it = null,
      rt = new o,
      at = 0,
      st = new j(0),
      lt = 0,
      ct = R.width,
      ht = R.height,
      ut = 1,
      dt = new o(0, 0, ct, ht),
      pt = !1,
      ft = new o(0, 0, ct, ht),
      mt = new nt,
      gt = new de,
      vt = !1,
      yt = !1,
      Et = new c,
      xt = new l,
      bt = new c,
      wt = new c,
      Ct = {
        hash: "",
        ambient: [
          0, 0, 0
        ],
        directional: [],
        directionalShadowMap: [],
        directionalShadowMatrix: [],
        spot: [],
        spotShadowMap: [],
        spotShadowMatrix: [],
        rectArea: [],
        point: [],
        pointShadowMap: [],
        pointShadowMatrix: [],
        hemi: [],
        shadows: []
      },
      Tt = {
        geometries: 0,
        textures: 0
      },
      _t = {
        frame: 0,
        calls: 0,
        vertices: 0,
        faces: 0,
        points: 0
      };
    this.info = {
      render: _t,
      memory: Tt,
      programs: null
    };
    var Lt;
    try {
      var St = {
        alpha: A,
        depth: I,
        stencil: P,
        antialias: B,
        premultipliedAlpha: N,
        preserveDrawingBuffer: k
      };
      if (null === (Lt = U || R.getContext("webgl", St) || R.getContext("experimental-webgl", St)))
        throw null !== R.getContext("webgl")
          ? "Error creating WebGL context with your selected attributes."
          : "Error creating WebGL context.";
      void 0 === Lt.getShaderPrecisionFormat && (Lt.getShaderPrecisionFormat = function() {
        return {rangeMin: 1, rangeMax: 1, precision: 1}
      }),
      R.addEventListener("webglcontextlost", r, !1)
    } catch (t) {
      console.error("THREE.WebGLRenderer: " + t)
    }
    var Ot = new ue(Lt);
    Ot.get("WEBGL_depth_texture"),
    Ot.get("OES_texture_float"),
    Ot.get("OES_texture_float_linear"),
    Ot.get("OES_texture_half_float"),
    Ot.get("OES_texture_half_float_linear"),
    Ot.get("OES_standard_derivatives"),
    Ot.get("ANGLE_instanced_arrays"),
    Ot.get("OES_element_index_uint") && (Mt.MaxIndex = 4294967296);
    var Dt,
      Rt = new he(Lt, Ot, t),
      Ut = new ce(Lt, Ot, D),
      At = new le,
      It = new se(Lt, Ot, Ut, At, Rt, D, Tt),
      Pt = new Bt(Lt);
    Dt = void 0 !== H
      ? new cr(Lt, Pt, Tt, H)
      : new zt(Lt, Pt, Tt);
    var Nt = new Wt(Lt, Dt, _t),
      kt = new ae(this, Rt),
      Ht = new qt,
      jt = new Ft;
    this.info.programs = kt.programs;
    var Xt = new Vt(Lt, Ot, _t),
      Yt = new Gt(Lt, Ot, _t);
    i(),
    this.context = Lt,
    this.capabilities = Rt,
    this.extensions = Ot,
    this.properties = At,
    this.state = Ut;
    var Zt = new ot(this, Ct, Nt, Rt);
    this.shadowMap = Zt;
    new Z(this, V),
    new Y(this, z);
    this.getContext = function() {
      return Lt
    },
    this.getContextAttributes = function() {
      return Lt.getContextAttributes()
    },
    this.forceContextLoss = function() {
      var t = Ot.get("WEBGL_lose_context");
      t && t.loseContext()
    },
    this.getMaxAnisotropy = function() {
      return Rt.getMaxAnisotropy()
    },
    this.getPrecision = function() {
      return Rt.precision
    },
    this.getPixelRatio = function() {
      return ut
    },
    this.setPixelRatio = function(t) {
      void 0 !== t && (ut = t, this.setSize(ft.z, ft.w, !1))
    },
    this.getSize = function() {
      return {width: ct, height: ht}
    },
    this.setSize = function(t, e, i) {
      ct = t,
      ht = e,
      R.width = t * ut,
      R.height = e * ut,
      i !== !1 && (R.style.width = t + "px", R.style.height = e + "px"),
      this.setViewport(0, 0, t, e)
    },
    this.setViewport = function(t, e, i, n) {
      Ut.viewport(ft.set(t, e, i, n))
    },
    this.setScissor = function(t, e, i, n) {
      Ut.scissor(dt.set(t, e, i, n))
    },
    this.setScissorTest = function(t) {
      Ut.setScissorTest(pt = t)
    },
    this.getClearColor = function() {
      return st
    },
    this.setClearColor = function(t, e) {
      st.set(t),
      lt = void 0 !== e
        ? e
        : 1,
      Ut.buffers.color.setClear(st.r, st.g, st.b, lt, N)
    },
    this.getClearAlpha = function() {
      return lt
    },
    this.setClearAlpha = function(t) {
      lt = t,
      Ut.buffers.color.setClear(st.r, st.g, st.b, lt, N)
    },
    this.clear = function(t, e, i) {
      var n = 0;
      (void 0 === t || t) && (n |= Lt.COLOR_BUFFER_BIT),
      (void 0 === e || e) && (n |= Lt.DEPTH_BUFFER_BIT),
      (void 0 === i || i) && (n |= Lt.STENCIL_BUFFER_BIT),
      Lt.clear(n)
    },
    this.clearColor = function() {
      this.clear(!0, !1, !1)
    },
    this.clearDepth = function() {
      this.clear(!1, !0, !1)
    },
    this.clearStencil = function() {
      this.clear(!1, !1, !0)
    },
    this.clearTarget = function(t, e, i, n) {
      this.setRenderTarget(t),
      this.clear(e, i, n)
    },
    this.resetGLState = n,
    this.dispose = function() {
      R.removeEventListener("webglcontextlost", r, !1),
      jt.dispose()
    },
    this.renderBufferImmediate = function(t, e, i) {
      Ut.initAttributes();
      var n = At.get(t);
      t.hasPositions && !n.position && (n.position = Lt.createBuffer()),
      t.hasNormals && !n.normal && (n.normal = Lt.createBuffer()),
      t.hasUvs && !n.uv && (n.uv = Lt.createBuffer()),
      t.hasColors && !n.color && (n.color = Lt.createBuffer());
      var o = e.getAttributes();
      if (t.hasPositions && (Lt.bindBuffer(Lt.ARRAY_BUFFER, n.position), Lt.bufferData(Lt.ARRAY_BUFFER, t.positionArray, Lt.DYNAMIC_DRAW), Ut.enableAttribute(o.position), Lt.vertexAttribPointer(o.position, 3, Lt.FLOAT, !1, 0, 0)), t.hasNormals) {
        if (Lt.bindBuffer(Lt.ARRAY_BUFFER, n.normal), !i.isMeshPhongMaterial && !i.isMeshStandardMaterial && !i.isMeshNormalMaterial && i.shading === wr)
          for (var r = 0, a = 3 * t.count; r < a; r += 9) {
            var s = t.normalArray,
              l = (s[r + 0] + s[r + 3] + s[r + 6]) / 3,
              c = (s[r + 1] + s[r + 4] + s[r + 7]) / 3,
              h = (s[r + 2] + s[r + 5] + s[r + 8]) / 3;
            s[r + 0] = l,
            s[r + 1] = c,
            s[r + 2] = h,
            s[r + 3] = l,
            s[r + 4] = c,
            s[r + 5] = h,
            s[r + 6] = l,
            s[r + 7] = c,
            s[r + 8] = h
          }
        Lt.bufferData(Lt.ARRAY_BUFFER, t.normalArray, Lt.DYNAMIC_DRAW),
        Ut.enableAttribute(o.normal),
        Lt.vertexAttribPointer(o.normal, 3, Lt.FLOAT, !1, 0, 0)
      }
      t.hasUvs && i.map && (Lt.bindBuffer(Lt.ARRAY_BUFFER, n.uv), Lt.bufferData(Lt.ARRAY_BUFFER, t.uvArray, Lt.DYNAMIC_DRAW), Ut.enableAttribute(o.uv), Lt.vertexAttribPointer(Pt.uv, 2, Lt.FLOAT, !1, 0, 0)),
      t.hasColors && i.vertexColors !== Tr && (Lt.bindBuffer(Lt.ARRAY_BUFFER, n.color), Lt.bufferData(Lt.ARRAY_BUFFER, t.colorArray, Lt.DYNAMIC_DRAW), Ut.enableAttribute(o.color), Lt.vertexAttribPointer(o.color, 3, Lt.FLOAT, !1, 0, 0)),
      Ut.disableUnusedAttributes(),
      Lt.drawArrays(Lt.TRIANGLES, 0, t.count),
      t.count = 0
    },
    this.renderBufferDirect = function(t, i, n, o, r, a) {
      Ut.setMaterial(o);
      var s = m(t, i, o, r),
        l = n.id;
      l += "_",
      l += s.id,
      l += "_",
      l += o.wireframe === !0;
      var c = !1;
      l !== $ && ($ = l, c = !0);
      var h = r.morphTargetInfluences;
      if (void 0 !== h) {
        for (var u = [], f = 0, g = h.length; f < g; f++) {
          var v = h[f];
          u.push([v, f])
        }
        u.sort(d),
        u.length > 8 && (u.length = 8);
        for (var y = n.morphAttributes, f = 0, g = u.length; f < g; f++) {
          var v = u[f];
          if (G[f] = v[0], 0 !== v[0]) {
            var E = v[1];
            o.morphTargets === !0 && y.position && n.addAttribute("morphTarget" + f, y.position[E]),
            o.morphNormals === !0 && y.normal && n.addAttribute("morphNormal" + f, y.normal[E])
          } else
            o.morphTargets === !0 && n.removeAttribute("morphTarget" + f),
            o.morphNormals === !0 && n.removeAttribute("morphNormal" + f)
        }
        for (var f = u.length, x = G.length; f < x; f++)
          G[f] = 0;
        s.getUniforms().setValue(Lt, "morphTargetInfluences", G),
        c = !0
      }
      var E = n.index,
        b = n.attributes.position,
        w = 1;
      o.wireframe === !0 && (E = Dt.getWireframeAttribute(n), w = 2);
      var C = Xt;
      null !== E && (C = Yt, C.setIndex(E)),
      c && (p(o, s, n), null !== E && Lt.bindBuffer(Lt.ELEMENT_ARRAY_BUFFER, Pt.get(E).buffer));
      var T = 0;
      null !== E
        ? T = E.count
        : void 0 !== b && (T = b.count);
      var _ = n.drawRange.start * w,
        L = n.drawRange.count * w,
        M = null !== a
          ? a.start * w
          : 0,
        S = null !== a
          ? a.count * w
          : 1 / 0,
        O = Math.max(_, M),
        D = Math.min(T, _ + L, M + S) - 1,
        R = Math.max(0, D - O + 1);
      if (0 !== R) {
        if (r.isMesh)
          if (o.wireframe === !0)
            Ut.setLineWidth(o.wireframeLinewidth * e()),
            C.setMode(Lt.LINES);
          else
            switch (r.drawMode) {
              case os:
                C.setMode(Lt.TRIANGLES);
                break;
              case rs:
                C.setMode(Lt.TRIANGLE_STRIP);
                break;
              case as:
                C.setMode(Lt.TRIANGLE_FAN)
            }
          else if (r.isLine) {
            var U = o.linewidth;
            void 0 === U && (U = 1),
            Ut.setLineWidth(U * e()),
            r.isLineSegments
              ? C.setMode(Lt.LINES)
              : r.isLineLoop
                ? C.setMode(Lt.LINE_LOOP)
                : C.setMode(Lt.LINE_STRIP)
          }
        else
          r.isPoints && C.setMode(Lt.POINTS);
        n && n.isInstancedBufferGeometry
          ? n.maxInstancedCount > 0 && C.renderInstances(n, O, R)
          : C.render(O, R)
      }
    },
    this.compile = function(t, e) {
      F = [],
      t.traverse(function(t) {
        t.isLight && F.push(t)
      }),
      S(F, e),
      t.traverse(function(e) {
        if (e.material)
          if (Array.isArray(e.material))
            for (var i = 0; i < e.material.length; i++)
              f(e.material[i], t.fog, e);
      else
          f(e.material, t.fog, e)
      })
    },
    this.render = function(t, e, i, n) {
      return null === Kt
        ? void console.error("THREE.WebGLRenderer.render: OrderedRenderer is not set.")
        : void 0 !== e && e.isCamera !== !0
          ? void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")
          : ($ = "", J = -1, tt = null, t.autoUpdate === !0 && t.updateMatrixWorld(), e.onBeforeRender(q), null === e.parent && e.updateMatrixWorld(), e.matrixWorldInverse.getInverse(e.matrixWorld), yt = this.localClippingEnabled, vt = gt.init(this.clippingPlanes, yt, e), Et.multiplyMatrices(e.projectionMatrix, e.matrixWorldInverse), mt.setFromMatrix(Et), _t.frame++, _t.calls = 0, _t.vertices = 0, _t.faces = 0, _t.points = 0, Kt.update(mt, Et), Kt.render(this, t, e, F, i, n, Ut))
    },
    this.setFaceCulling = function(t, e) {
      Ut.setCullFace(t),
      Ut.setFlipSided(e === gr)
    },
    this.allocTextureUnit = O,
    this.setTexture2D = function() {
      var t = !1;
      return function(e, i) {
        e && e.isWebGLRenderTarget && (t || (console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."), t = !0), e = e.texture),
        It.setTexture2D(e, i)
      }
    }(),
    this.setTexture = function() {
      var t = !1;
      return function(e, i) {
        t || (console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."), t = !0),
        It.setTexture2D(e, i)
      }
    }(),
    this.setTextureCube = function() {
      var t = !1;
      return function(e, i) {
        e && e.isWebGLRenderTargetCube && (t || (console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."), t = !0), e = e.texture),
        e && e.isCubeTexture || Array.isArray(e.image) && 6 === e.image.length
          ? It.setTextureCube(e, i)
          : It.setTextureCubeDynamic(e, i)
      }
    }(),
    this.getRenderTarget = function() {
      return K
    },
    this.setRenderTarget = function(t) {
      K = t,
      t && void 0 === At.get(t).__webglFramebuffer && It.setupRenderTarget(t);
      var e,
        i = t && t.isWebGLRenderTargetCube;
      if (t) {
        var n = At.get(t);
        e = i
          ? n.__webglFramebuffer[t.activeCubeFace]
          : n.__webglFramebuffer,
        et.copy(t.scissor),
        it = t.scissorTest,
        rt.copy(t.viewport)
      } else
        e = null,
        et.copy(dt).multiplyScalar(ut),
        it = pt,
        rt.copy(ft).multiplyScalar(ut);
      if (Q !== e && (Lt.bindFramebuffer(Lt.FRAMEBUFFER, e), Q = e), Ut.scissor(et), Ut.setScissorTest(it), Ut.viewport(rt), i) {
        var o = At.get(t.texture);
        Lt.framebufferTexture2D(Lt.FRAMEBUFFER, Lt.COLOR_ATTACHMENT0, Lt.TEXTURE_CUBE_MAP_POSITIVE_X + t.activeCubeFace, o.__webglTexture, t.activeMipMapLevel)
      }
    },
    this.readRenderTargetPixels = function(t, e, i, n, o, r) {
      if ((t && t.isWebGLRenderTarget) === !1)
        return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");
      var a = At.get(t).__webglFramebuffer;
      if (a) {
        var s = !1;
        a !== Q && (Lt.bindFramebuffer(Lt.FRAMEBUFFER, a), s = !0);
        try {
          var l = t.texture,
            c = l.format,
            h = l.type;
          if (c !== Ga && D(c) !== Lt.getParameter(Lt.IMPLEMENTATION_COLOR_READ_FORMAT))
            return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");
          if (!(h === Ma || D(h) === Lt.getParameter(Lt.IMPLEMENTATION_COLOR_READ_TYPE) || h === Aa && (Ot.get("OES_texture_float") || Ot.get("WEBGL_color_buffer_float")) || h === Ia && Ot.get("EXT_color_buffer_half_float")))
            return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");
          Lt.checkFramebufferStatus(Lt.FRAMEBUFFER) === Lt.FRAMEBUFFER_COMPLETE
            ? e >= 0 && e <= t.width - n && i >= 0 && i <= t.height - o && Lt.readPixels(e, i, n, o, D(c), D(h), r)
            : console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")
        } finally {
          s && Lt.bindFramebuffer(Lt.FRAMEBUFFER, Q)
        }
      }
    },
    this.updateObject = function(t) {
      return Nt.update(t)
    };
    var Kt = null;
    this.setRenderer = function(t) {
      Kt = t
    },
    this.getRenderer = function() {
      return Kt
    },
    this.destroy = function() {
      Kt.destroy(),
      At.clear()
    },
    this.resetIncrementRender = function() {
      Kt.restart()
    },
    this.setFilterObject = function(t) {
      Kt.setFilter(t)
    },
    this.setObjectListUpdateState = function(t) {
      Kt.updateObjectList(t)
    },
    this.computeSelectionBBox = function() {
      return Kt.computeSelectionBBox()
    },
    this.computeRenderObjectsBox = function() {
      return Kt.computeRenderObjectsBox()
    },
    this.setRenderTicket = function(t) {
      Nt._renderTicket = t
    },
    this.setupLights = function(t, e) {
      S(t, e)
    }
  }
  void 0 === Number.EPSILON && (Number.EPSILON = Math.pow(2, -52)),
  void 0 === Number.isInteger && (Number.isInteger = function(t) {
    return "number" == typeof t && isFinite(t) && Math.floor(t) === t
  }),
  void 0 === Math.sign && (Math.sign = function(t) {
    return t < 0
      ? -1
      : t > 0
        ? 1
        : + t
  }),
  void 0 === Function.prototype.name && Object.defineProperty(Function.prototype, "name", {
    get: function() {
      return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]
    }
  }),
  void 0 === Object.assign && function() {
    Object.assign = function(t) {
      if (void 0 === t || null === t)
        throw new TypeError("Cannot convert undefined or null to object");
      for (var e = Object(t), i = 1; i < arguments.length; i++) {
        var n = arguments[i];
        if (void 0 !== n && null !== n)
          for (var o in n)
            Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o])
      }
      return e
    }
  }(),
  Object.assign(e.prototype, {
    addEventListener: function(t, e) {
      void 0 === this._listeners && (this._listeners = {});
      var i = this._listeners;
      void 0 === i[t] && (i[t] = []),
      i[t].indexOf(e) === -1 && i[t].push(e)
    },
    hasEventListener: function(t, e) {
      if (void 0 === this._listeners)
        return !1;
      var i = this._listeners;
      return void 0 !== i[t] && i[t].indexOf(e) !== -1
    },
    removeEventListener: function(t, e) {
      if (void 0 !== this._listeners) {
        var i = this._listeners,
          n = i[t];
        if (void 0 !== n) {
          var o = n.indexOf(e);
          o !== -1 && n.splice(o, 1)
        }
      }
    },
    dispatchEvent: function(t) {
      if (void 0 !== this._listeners) {
        var e = this._listeners,
          i = e[t.type];
        if (void 0 !== i) {
          t.target = this;
          var n = [],
            o = 0,
            r = i.length;
          for (o = 0; o < r; o++)
            n[o] = i[o];
          for (o = 0; o < r; o++)
            n[o].call(this, t)
        }
      }
    }
  });
  var ur = "85",
    dr = {
      LEFT: 0,
      MIDDLE: 1,
      RIGHT: 2
    },
    pr = 0,
    fr = 1,
    mr = 2,
    gr = 0,
    vr = 1,
    yr = 2,
    Er = 0,
    xr = 1,
    br = 2,
    wr = 1,
    Cr = 2,
    Tr = 0,
    _r = 1,
    Lr = 2,
    Mr = 0,
    Sr = 1,
    Or = 2,
    Dr = 3,
    Rr = 4,
    Ur = 5,
    Ar = 100,
    Ir = 101,
    Pr = 102,
    Br = 103,
    Nr = 104,
    kr = 200,
    Hr = 201,
    Fr = 202,
    Gr = 203,
    Vr = 204,
    zr = 205,
    qr = 206,
    Wr = 207,
    jr = 208,
    Xr = 209,
    Yr = 210,
    Zr = 0,
    Kr = 1,
    Qr = 2,
    Jr = 3,
    $r = 4,
    ta = 5,
    ea = 6,
    ia = 7,
    na = 0,
    oa = 1,
    ra = 2,
    aa = 0,
    sa = 1,
    la = 2,
    ca = 3,
    ha = 4,
    ua = 301,
    da = 302,
    pa = 303,
    fa = 304,
    ma = 305,
    ga = 306,
    va = 307,
    ya = 1e3,
    Ea = 1001,
    xa = 1002,
    ba = 1003,
    wa = 1004,
    Ca = 1005,
    Ta = 1006,
    _a = 1007,
    La = 1008,
    Ma = 1009,
    Sa = 1010,
    Oa = 1011,
    Da = 1012,
    Ra = 1013,
    Ua = 1014,
    Aa = 1015,
    Ia = 1016,
    Pa = 1017,
    Ba = 1018,
    Na = 1019,
    ka = 1020,
    Ha = 1021,
    Fa = 1022,
    Ga = 1023,
    Va = 1024,
    za = 1025,
    qa = Ga,
    Wa = 1026,
    ja = 1027,
    Xa = 2001,
    Ya = 2002,
    Za = 2003,
    Ka = 2004,
    Qa = 2100,
    Ja = 2101,
    $a = 2102,
    ts = 2103,
    es = 2151,
    is = 2201,
    ns = 2400,
    os = 0,
    rs = 1,
    as = 2,
    ss = 3e3,
    ls = 3001,
    cs = 3007,
    hs = 3002,
    us = 3004,
    ds = 3005,
    ps = 3006,
    fs = 3200,
    ms = 3201,
    gs = {
      DEG2RAD: Math.PI / 180,
      RAD2DEG: 180 / Math.PI,
      generateUUID: function() {
        var t,
          e = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),
          i = new Array(36),
          n = 0;
        return function() {
          for (var o = 0; o < 36; o++)
            8 === o || 13 === o || 18 === o || 23 === o
              ? i[o] = "-"
              : 14 === o
                ? i[o] = "4"
                : (n <= 2 && (n = 33554432 + 16777216 * Math.random() | 0), t = 15 & n, n >>= 4, i[o] = e[
                  19 === o
                    ? 3 & t | 8
                    : t
                ]);
          return i.join("")
        }
      }(),
      clamp: function(t, e, i) {
        return Math.max(e, Math.min(i, t))
      },
      euclideanModulo: function(t, e) {
        return (t % e + e) % e
      },
      mapLinear: function(t, e, i, n, o) {
        return n + (t - e) * (o - n) / (i - e)
      },
      lerp: function(t, e, i) {
        return (1 - i) * t + i * e
      },
      smoothstep: function(t, e, i) {
        return t <= e
          ? 0
          : t >= i
            ? 1
            : (t = (t - e) / (i - e)) * t * (3 - 2 * t)
      },
      smootherstep: function(t, e, i) {
        return t <= e
          ? 0
          : t >= i
            ? 1
            : (t = (t - e) / (i - e)) * t * t * (t * (6 * t - 15) + 10)
      },
      randInt: function(t, e) {
        return t + Math.floor(Math.random() * (e - t + 1))
      },
      randFloat: function(t, e) {
        return t + Math.random() * (e - t)
      },
      randFloatSpread: function(t) {
        return t * (.5 - Math.random())
      },
      degToRad: function(t) {
        return t * gs.DEG2RAD
      },
      radToDeg: function(t) {
        return t * gs.RAD2DEG
      },
      isPowerOfTwo: function(t) {
        return 0 == (t & t - 1) && 0 !== t
      },
      nearestPowerOfTwo: function(t) {
        return Math.pow(2, Math.round(Math.log(t) / Math.LN2))
      },
      nextPowerOfTwo: function(t) {
        return t--,
        t |= t >> 1,
        t |= t >> 2,
        t |= t >> 4,
        t |= t >> 8,
        t |= t >> 16,
        ++t
      }
    };
  Object.defineProperties(i.prototype, {
    width: {
      get: function() {
        return this.x
      },
      set: function(t) {
        this.x = t
      }
    },
    height: {
      get: function() {
        return this.y
      },
      set: function(t) {
        this.y = t
      }
    }
  }),
  Object.assign(i.prototype, {
    isVector2: !0,
    set: function(t, e) {
      return this.x = t,
      this.y = e,
      this
    },
    setScalar: function(t) {
      return this.x = t,
      this.y = t,
      this
    },
    setX: function(t) {
      return this.x = t,
      this
    },
    setY: function(t) {
      return this.y = t,
      this
    },
    setComponent: function(t, e) {
      switch (t) {
        case 0:
          this.x = e;
          break;
        case 1:
          this.y = e;
          break;
        default:
          throw new Error("index is out of range: " + t)
      }
      return this
    },
    getComponent: function(t) {
      switch (t) {
        case 0:
          return this.x;
        case 1:
          return this.y;
        default:
          throw new Error("index is out of range: " + t)
      }
    },
    clone: function() {
      return new this.constructor(this.x, this.y)
    },
    copy: function(t) {
      return this.x = t.x,
      this.y = t.y,
      this
    },
    add: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."), this.addVectors(t, e))
        : (this.x += t.x, this.y += t.y, this)
    },
    addScalar: function(t) {
      return this.x += t,
      this.y += t,
      this
    },
    addVectors: function(t, e) {
      return this.x = t.x + e.x,
      this.y = t.y + e.y,
      this
    },
    addScaledVector: function(t, e) {
      return this.x += t.x * e,
      this.y += t.y * e,
      this
    },
    sub: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."), this.subVectors(t, e))
        : (this.x -= t.x, this.y -= t.y, this)
    },
    subScalar: function(t) {
      return this.x -= t,
      this.y -= t,
      this
    },
    subVectors: function(t, e) {
      return this.x = t.x - e.x,
      this.y = t.y - e.y,
      this
    },
    multiply: function(t) {
      return this.x *= t.x,
      this.y *= t.y,
      this
    },
    multiplyScalar: function(t) {
      return this.x *= t,
      this.y *= t,
      this
    },
    divide: function(t) {
      return this.x /= t.x,
      this.y /= t.y,
      this
    },
    divideScalar: function(t) {
      return this.multiplyScalar(1 / t)
    },
    min: function(t) {
      return this.x = Math.min(this.x, t.x),
      this.y = Math.min(this.y, t.y),
      this
    },
    max: function(t) {
      return this.x = Math.max(this.x, t.x),
      this.y = Math.max(this.y, t.y),
      this
    },
    clamp: function(t, e) {
      return this.x = Math.max(t.x, Math.min(e.x, this.x)),
      this.y = Math.max(t.y, Math.min(e.y, this.y)),
      this
    },
    clampScalar: function() {
      var t = new i,
        e = new i;
      return function(i, n) {
        return t.set(i, i),
        e.set(n, n),
        this.clamp(t, e)
      }
    }(),
    clampLength: function(t, e) {
      var i = this.length();
      return this.multiplyScalar(Math.max(t, Math.min(e, i)) / i)
    },
    floor: function() {
      return this.x = Math.floor(this.x),
      this.y = Math.floor(this.y),
      this
    },
    ceil: function() {
      return this.x = Math.ceil(this.x),
      this.y = Math.ceil(this.y),
      this
    },
    round: function() {
      return this.x = Math.round(this.x),
      this.y = Math.round(this.y),
      this
    },
    roundToZero: function() {
      return this.x = this.x < 0
        ? Math.ceil(this.x)
        : Math.floor(this.x),
      this.y = this.y < 0
        ? Math.ceil(this.y)
        : Math.floor(this.y),
      this
    },
    negate: function() {
      return this.x = -this.x,
      this.y = -this.y,
      this
    },
    dot: function(t) {
      return this.x * t.x + this.y * t.y
    },
    lengthSq: function() {
      return this.x * this.x + this.y * this.y
    },
    length: function() {
      return Math.sqrt(this.x * this.x + this.y * this.y)
    },
    lengthManhattan: function() {
      return Math.abs(this.x) + Math.abs(this.y)
    },
    normalize: function() {
      return this.divideScalar(this.length())
    },
    angle: function() {
      var t = Math.atan2(this.y, this.x);
      return t < 0 && (t += 2 * Math.PI),
      t
    },
    distanceTo: function(t) {
      return Math.sqrt(this.distanceToSquared(t))
    },
    distanceToSquared: function(t) {
      var e = this.x - t.x,
        i = this.y - t.y;
      return e * e + i * i
    },
    distanceToManhattan: function(t) {
      return Math.abs(this.x - t.x) + Math.abs(this.y - t.y)
    },
    setLength: function(t) {
      return this.multiplyScalar(t / this.length())
    },
    lerp: function(t, e) {
      return this.x += (t.x - this.x) * e,
      this.y += (t.y - this.y) * e,
      this
    },
    lerpVectors: function(t, e, i) {
      return this.subVectors(e, t).multiplyScalar(i).add(t)
    },
    equals: function(t) {
      return t.x === this.x && t.y === this.y
    },
    fromArray: function(t, e) {
      return void 0 === e && (e = 0),
      this.x = t[e],
      this.y = t[e + 1],
      this
    },
    toArray: function(t, e) {
      return void 0 === t && (t = []),
      void 0 === e && (e = 0),
      t[e] = this.x,
      t[e + 1] = this.y,
      t
    },
    fromBufferAttribute: function(t, e, i) {
      return void 0 !== i && console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),
      this.x = t.getX(e),
      this.y = t.getY(e),
      this
    },
    rotateAround: function(t, e) {
      var i = Math.cos(e),
        n = Math.sin(e),
        o = this.x - t.x,
        r = this.y - t.y;
      return this.x = o * i - r * n + t.x,
      this.y = o * n + r * i + t.y,
      this
    }
  });
  var vs = 0;
  n.DEFAULT_IMAGE = void 0,
  n.DEFAULT_MAPPING = 300,
  Object.defineProperty(n.prototype, "needsUpdate", {
    set: function(t) {
      t === !0 && this.version++
    }
  }),
  Object.assign(n.prototype, e.prototype, {
    constructor: n,
    isTexture: !0,
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.name = t.name,
      this.image = t.image,
      this.mipmaps = t.mipmaps.slice(0),
      this.mapping = t.mapping,
      this.wrapS = t.wrapS,
      this.wrapT = t.wrapT,
      this.magFilter = t.magFilter,
      this.minFilter = t.minFilter,
      this.anisotropy = t.anisotropy,
      this.format = t.format,
      this.type = t.type,
      this.offset.copy(t.offset),
      this.repeat.copy(t.repeat),
      this.rotateMatrix.copy(t.rotateMatrix),
      this.generateMipmaps = t.generateMipmaps,
      this.premultiplyAlpha = t.premultiplyAlpha,
      this.flipY = t.flipY,
      this.unpackAlignment = t.unpackAlignment,
      this.encoding = t.encoding,
      this
    },
    toJSON: function(t) {
      if (void 0 !== t.textures[this.uuid])
        return t.textures[this.uuid];
      var e = {
        metadata: {
          version: 4.5,
          type: "Texture",
          generator: "Texture.toJSON"
        },
        uuid: this.uuid,
        name: this.name,
        mapping: this.mapping,
        repeat: [
          this.repeat.x, this.repeat.y
        ],
        offset: [
          this.offset.x, this.offset.y
        ],
        wrap: [
          this.wrapS, this.wrapT
        ],
        minFilter: this.minFilter,
        magFilter: this.magFilter,
        anisotropy: this.anisotropy,
        flipY: this.flipY
      };
      if (void 0 !== this.image) {
        var i = this.image;
        void 0 === i.uuid && (i.uuid = gs.generateUUID()),
        void 0 === t.images[i.uuid] && (t.images[i.uuid] = {
          uuid: i.uuid,
          url: function(t) {
            var e;
            return void 0 !== t.toDataURL
              ? e = t
              : (e = document.createElementNS("http://www.w3.org/1999/xhtml", "canvas"), e.width = t.width, e.height = t.height, e.getContext("2d").drawImage(t, 0, 0, t.width, t.height)),
            e.width > 2048 || e.height > 2048
              ? e.toDataURL("image/jpeg", .6)
              : e.toDataURL("image/png")
          }(i)
        }),
        e.image = i.uuid
      }
      return t.textures[this.uuid] = e,
      e
    },
    dispose: function() {
      this.dispatchEvent({type: "dispose"})
    },
    transformUv: function(t) {
      if (300 === this.mapping) {
        if (t.multiply(this.repeat), t.add(this.offset), t.x < 0 || t.x > 1)
          switch (this.wrapS) {
            case ya:
              t.x = t.x - Math.floor(t.x);
              break;
            case Ea:
              t.x = t.x < 0
                ? 0
                : 1;
              break;
            case xa:
              1 === Math.abs(Math.floor(t.x) % 2)
                ? t.x = Math.ceil(t.x) - t.x
                : t.x = t.x - Math.floor(t.x)
          }
        if (t.y < 0 || t.y > 1)
          switch (this.wrapT) {
            case ya:
              t.y = t.y - Math.floor(t.y);
              break;
            case Ea:
              t.y = t.y < 0
                ? 0
                : 1;
              break;
            case xa:
              1 === Math.abs(Math.floor(t.y) % 2)
                ? t.y = Math.ceil(t.y) - t.y
                : t.y = t.y - Math.floor(t.y)
          }
        this.flipY && (t.y = 1 - t.y)
      }
    },
    setRotateAngle: function(t) {
      var e = THREE.Math.degToRad(t),
        i = Math.sin(e),
        n = Math.cos(e);
      this.rotateMatrix.elements[0] = n,
      this.rotateMatrix.elements[1] = i,
      this.rotateMatrix.elements[3] = -i,
      this.rotateMatrix.elements[4] = n
    }
  }),
  Object.assign(o.prototype, {
    isVector4: !0,
    set: function(t, e, i, n) {
      return this.x = t,
      this.y = e,
      this.z = i,
      this.w = n,
      this
    },
    setScalar: function(t) {
      return this.x = t,
      this.y = t,
      this.z = t,
      this.w = t,
      this
    },
    setX: function(t) {
      return this.x = t,
      this
    },
    setY: function(t) {
      return this.y = t,
      this
    },
    setZ: function(t) {
      return this.z = t,
      this
    },
    setW: function(t) {
      return this.w = t,
      this
    },
    setComponent: function(t, e) {
      switch (t) {
        case 0:
          this.x = e;
          break;
        case 1:
          this.y = e;
          break;
        case 2:
          this.z = e;
          break;
        case 3:
          this.w = e;
          break;
        default:
          throw new Error("index is out of range: " + t)
      }
      return this
    },
    getComponent: function(t) {
      switch (t) {
        case 0:
          return this.x;
        case 1:
          return this.y;
        case 2:
          return this.z;
        case 3:
          return this.w;
        default:
          throw new Error("index is out of range: " + t)
      }
    },
    clone: function() {
      return new this.constructor(this.x, this.y, this.z, this.w)
    },
    copy: function(t) {
      return this.x = t.x,
      this.y = t.y,
      this.z = t.z,
      this.w = void 0 !== t.w
        ? t.w
        : 1,
      this
    },
    add: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."), this.addVectors(t, e))
        : (this.x += t.x, this.y += t.y, this.z += t.z, this.w += t.w, this)
    },
    addScalar: function(t) {
      return this.x += t,
      this.y += t,
      this.z += t,
      this.w += t,
      this
    },
    addVectors: function(t, e) {
      return this.x = t.x + e.x,
      this.y = t.y + e.y,
      this.z = t.z + e.z,
      this.w = t.w + e.w,
      this
    },
    addScaledVector: function(t, e) {
      return this.x += t.x * e,
      this.y += t.y * e,
      this.z += t.z * e,
      this.w += t.w * e,
      this
    },
    sub: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."), this.subVectors(t, e))
        : (this.x -= t.x, this.y -= t.y, this.z -= t.z, this.w -= t.w, this)
    },
    subScalar: function(t) {
      return this.x -= t,
      this.y -= t,
      this.z -= t,
      this.w -= t,
      this
    },
    subVectors: function(t, e) {
      return this.x = t.x - e.x,
      this.y = t.y - e.y,
      this.z = t.z - e.z,
      this.w = t.w - e.w,
      this
    },
    multiplyScalar: function(t) {
      return this.x *= t,
      this.y *= t,
      this.z *= t,
      this.w *= t,
      this
    },
    applyMatrix4: function(t) {
      var e = this.x,
        i = this.y,
        n = this.z,
        o = this.w,
        r = t.elements;
      return this.x = r[0] * e + r[4] * i + r[8] * n + r[12] * o,
      this.y = r[1] * e + r[5] * i + r[9] * n + r[13] * o,
      this.z = r[2] * e + r[6] * i + r[10] * n + r[14] * o,
      this.w = r[3] * e + r[7] * i + r[11] * n + r[15] * o,
      this
    },
    divideScalar: function(t) {
      return this.multiplyScalar(1 / t)
    },
    setAxisAngleFromQuaternion: function(t) {
      this.w = 2 * Math.acos(t.w);
      var e = Math.sqrt(1 - t.w * t.w);
      return e < 1e-4
        ? (this.x = 1, this.y = 0, this.z = 0)
        : (this.x = t.x / e, this.y = t.y / e, this.z = t.z / e),
      this
    },
    setAxisAngleFromRotationMatrix: function(t) {
      var e,
        i,
        n,
        o,
        r = t.elements,
        a = r[0],
        s = r[4],
        l = r[8],
        c = r[1],
        h = r[5],
        u = r[9],
        d = r[2],
        p = r[6],
        f = r[10];
      if (Math.abs(s - c) < .01 && Math.abs(l - d) < .01 && Math.abs(u - p) < .01) {
        if (Math.abs(s + c) < .1 && Math.abs(l + d) < .1 && Math.abs(u + p) < .1 && Math.abs(a + h + f - 3) < .1)
          return this.set(1, 0, 0, 0),
          this;
        e = Math.PI;
        var m = (a + 1) / 2,
          g = (h + 1) / 2,
          v = (f + 1) / 2,
          y = (s + c) / 4,
          E = (l + d) / 4,
          x = (u + p) / 4;
        return m > g && m > v
          ? m < .01
            ? (i = 0, n = .707106781, o = .707106781)
            : (i = Math.sqrt(m), n = y / i, o = E / i)
          : g > v
            ? g < .01
              ? (i = .707106781, n = 0, o = .707106781)
              : (n = Math.sqrt(g), i = y / n, o = x / n)
            : v < .01
              ? (i = .707106781, n = .707106781, o = 0)
              : (o = Math.sqrt(v), i = E / o, n = x / o),
        this.set(i, n, o, e),
        this
      }
      var b = Math.sqrt((p - u) * (p - u) + (l - d) * (l - d) + (c - s) * (c - s));
      return Math.abs(b) < .001 && (b = 1),
      this.x = (p - u) / b,
      this.y = (l - d) / b,
      this.z = (c - s) / b,
      this.w = Math.acos((a + h + f - 1) / 2),
      this
    },
    min: function(t) {
      return this.x = Math.min(this.x, t.x),
      this.y = Math.min(this.y, t.y),
      this.z = Math.min(this.z, t.z),
      this.w = Math.min(this.w, t.w),
      this
    },
    max: function(t) {
      return this.x = Math.max(this.x, t.x),
      this.y = Math.max(this.y, t.y),
      this.z = Math.max(this.z, t.z),
      this.w = Math.max(this.w, t.w),
      this
    },
    clamp: function(t, e) {
      return this.x = Math.max(t.x, Math.min(e.x, this.x)),
      this.y = Math.max(t.y, Math.min(e.y, this.y)),
      this.z = Math.max(t.z, Math.min(e.z, this.z)),
      this.w = Math.max(t.w, Math.min(e.w, this.w)),
      this
    },
    clampScalar: function() {
      var t = new o,
        e = new o;
      return function(i, n) {
        return t.set(i, i, i, i),
        e.set(n, n, n, n),
        this.clamp(t, e)
      }
    }(),
    floor: function() {
      return this.x = Math.floor(this.x),
      this.y = Math.floor(this.y),
      this.z = Math.floor(this.z),
      this.w = Math.floor(this.w),
      this
    },
    ceil: function() {
      return this.x = Math.ceil(this.x),
      this.y = Math.ceil(this.y),
      this.z = Math.ceil(this.z),
      this.w = Math.ceil(this.w),
      this
    },
    round: function() {
      return this.x = Math.round(this.x),
      this.y = Math.round(this.y),
      this.z = Math.round(this.z),
      this.w = Math.round(this.w),
      this
    },
    roundToZero: function() {
      return this.x = this.x < 0
        ? Math.ceil(this.x)
        : Math.floor(this.x),
      this.y = this.y < 0
        ? Math.ceil(this.y)
        : Math.floor(this.y),
      this.z = this.z < 0
        ? Math.ceil(this.z)
        : Math.floor(this.z),
      this.w = this.w < 0
        ? Math.ceil(this.w)
        : Math.floor(this.w),
      this
    },
    negate: function() {
      return this.x = -this.x,
      this.y = -this.y,
      this.z = -this.z,
      this.w = -this.w,
      this
    },
    dot: function(t) {
      return this.x * t.x + this.y * t.y + this.z * t.z + this.w * t.w
    },
    lengthSq: function() {
      return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w
    },
    length: function() {
      return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
    },
    lengthManhattan: function() {
      return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w)
    },
    normalize: function() {
      return this.divideScalar(this.length())
    },
    setLength: function(t) {
      return this.multiplyScalar(t / this.length())
    },
    lerp: function(t, e) {
      return this.x += (t.x - this.x) * e,
      this.y += (t.y - this.y) * e,
      this.z += (t.z - this.z) * e,
      this.w += (t.w - this.w) * e,
      this
    },
    lerpVectors: function(t, e, i) {
      return this.subVectors(e, t).multiplyScalar(i).add(t)
    },
    equals: function(t) {
      return t.x === this.x && t.y === this.y && t.z === this.z && t.w === this.w
    },
    fromArray: function(t, e) {
      return void 0 === e && (e = 0),
      this.x = t[e],
      this.y = t[e + 1],
      this.z = t[e + 2],
      this.w = t[e + 3],
      this
    },
    toArray: function(t, e) {
      return void 0 === t && (t = []),
      void 0 === e && (e = 0),
      t[e] = this.x,
      t[e + 1] = this.y,
      t[e + 2] = this.z,
      t[e + 3] = this.w,
      t
    },
    fromBufferAttribute: function(t, e, i) {
      return void 0 !== i && console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),
      this.x = t.getX(e),
      this.y = t.getY(e),
      this.z = t.getZ(e),
      this.w = t.getW(e),
      this
    }
  }),
  Object.assign(r.prototype, e.prototype, {
    isWebGLRenderTarget: !0,
    setSize: function(t, e) {
      this.width === t && this.height === e || (this.width = t, this.height = e, this.dispose()),
      this.viewport.set(0, 0, t, e),
      this.scissor.set(0, 0, t, e)
    },
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.width = t.width,
      this.height = t.height,
      this.viewport.copy(t.viewport),
      this.texture = t.texture.clone(),
      this.depthBuffer = t.depthBuffer,
      this.stencilBuffer = t.stencilBuffer,
      this.depthTexture = t.depthTexture,
      this
    },
    dispose: function() {
      this.dispatchEvent({type: "dispose"})
    }
  }),
  a.prototype = Object.create(r.prototype),
  a.prototype.constructor = a,
  a.prototype.isWebGLRenderTargetCube = !0,
  Object.assign(s, {
    slerp: function(t, e, i, n) {
      return i.copy(t).slerp(e, n)
    },
    slerpFlat: function(t, e, i, n, o, r, a) {
      var s = i[n + 0],
        l = i[n + 1],
        c = i[n + 2],
        h = i[n + 3],
        u = o[r + 0],
        d = o[r + 1],
        p = o[r + 2],
        f = o[r + 3];
      if (h !== f || s !== u || l !== d || c !== p) {
        var m = 1 - a,
          g = s * u + l * d + c * p + h * f,
          v = g >= 0
            ? 1
            : -1,
          y = 1 - g * g;
        if (y > Number.EPSILON) {
          var E = Math.sqrt(y),
            x = Math.atan2(E, g * v);
          m = Math.sin(m * x) / E,
          a = Math.sin(a * x) / E
        }
        var b = a * v;
        if (s = s * m + u * b, l = l * m + d * b, c = c * m + p * b, h = h * m + f * b, m === 1 - a) {
          var w = 1 / Math.sqrt(s * s + l * l + c * c + h * h);
          s *= w,
          l *= w,
          c *= w,
          h *= w
        }
      }
      t[e] = s,
      t[e + 1] = l,
      t[e + 2] = c,
      t[e + 3] = h
    }
  }),
  Object.defineProperties(s.prototype, {
    x: {
      get: function() {
        return this._x
      },
      set: function(t) {
        this._x = t,
        this.onChangeCallback()
      }
    },
    y: {
      get: function() {
        return this._y
      },
      set: function(t) {
        this._y = t,
        this.onChangeCallback()
      }
    },
    z: {
      get: function() {
        return this._z
      },
      set: function(t) {
        this._z = t,
        this.onChangeCallback()
      }
    },
    w: {
      get: function() {
        return this._w
      },
      set: function(t) {
        this._w = t,
        this.onChangeCallback()
      }
    }
  }),
  Object.assign(s.prototype, {
    set: function(t, e, i, n) {
      return this._x = t,
      this._y = e,
      this._z = i,
      this._w = n,
      this.onChangeCallback(),
      this
    },
    clone: function() {
      return new this.constructor(this._x, this._y, this._z, this._w)
    },
    copy: function(t) {
      return this._x = t.x,
      this._y = t.y,
      this._z = t.z,
      this._w = t.w,
      this.onChangeCallback(),
      this
    },
    setFromEuler: function(t, e) {
      if ((t && t.isEuler) === !1)
        throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");
      var i = t._x,
        n = t._y,
        o = t._z,
        r = t.order,
        a = Math.cos,
        s = Math.sin,
        l = a(i / 2),
        c = a(n / 2),
        h = a(o / 2),
        u = s(i / 2),
        d = s(n / 2),
        p = s(o / 2);
      return "XYZ" === r
        ? (this._x = u * c * h + l * d * p, this._y = l * d * h - u * c * p, this._z = l * c * p + u * d * h, this._w = l * c * h - u * d * p)
        : "YXZ" === r
          ? (this._x = u * c * h + l * d * p, this._y = l * d * h - u * c * p, this._z = l * c * p - u * d * h, this._w = l * c * h + u * d * p)
          : "ZXY" === r
            ? (this._x = u * c * h - l * d * p, this._y = l * d * h + u * c * p, this._z = l * c * p + u * d * h, this._w = l * c * h - u * d * p)
            : "ZYX" === r
              ? (this._x = u * c * h - l * d * p, this._y = l * d * h + u * c * p, this._z = l * c * p - u * d * h, this._w = l * c * h + u * d * p)
              : "YZX" === r
                ? (this._x = u * c * h + l * d * p, this._y = l * d * h + u * c * p, this._z = l * c * p - u * d * h, this._w = l * c * h - u * d * p)
                : "XZY" === r && (this._x = u * c * h - l * d * p, this._y = l * d * h - u * c * p, this._z = l * c * p + u * d * h, this._w = l * c * h + u * d * p),
      e !== !1 && this.onChangeCallback(),
      this
    },
    setFromAxisAngle: function(t, e) {
      var i = e / 2,
        n = Math.sin(i);
      return this._x = t.x * n,
      this._y = t.y * n,
      this._z = t.z * n,
      this._w = Math.cos(i),
      this.onChangeCallback(),
      this
    },
    setFromRotationMatrix: function(t) {
      var e,
        i = t.elements,
        n = i[0],
        o = i[4],
        r = i[8],
        a = i[1],
        s = i[5],
        l = i[9],
        c = i[2],
        h = i[6],
        u = i[10],
        d = n + s + u;
      return d > 0
        ? (e = .5 / Math.sqrt(d + 1), this._w = .25 / e, this._x = (h - l) * e, this._y = (r - c) * e, this._z = (a - o) * e)
        : n > s && n > u
          ? (e = 2 * Math.sqrt(1 + n - s - u), this._w = (h - l) / e, this._x = .25 * e, this._y = (o + a) / e, this._z = (r + c) / e)
          : s > u
            ? (e = 2 * Math.sqrt(1 + s - n - u), this._w = (r - c) / e, this._x = (o + a) / e, this._y = .25 * e, this._z = (l + h) / e)
            : (e = 2 * Math.sqrt(1 + u - n - s), this._w = (a - o) / e, this._x = (r + c) / e, this._y = (l + h) / e, this._z = .25 * e),
      this.onChangeCallback(),
      this
    },
    setFromUnitVectors: function() {
      var t,
        e = new l;
      return function(i, n) {
        return void 0 === e && (e = new l),
        t = i.dot(n) + 1,
        t < 1e-6
          ? (
            t = 0, Math.abs(i.x) > Math.abs(i.z)
            ? e.set(-i.y, i.x, 0)
            : e.set(0, -i.z, i.y))
          : e.crossVectors(i, n),
        this._x = e.x,
        this._y = e.y,
        this._z = e.z,
        this._w = t,
        this.normalize()
      }
    }(),
    inverse: function() {
      return this.conjugate().normalize()
    },
    conjugate: function() {
      return this._x *= -1,
      this._y *= -1,
      this._z *= -1,
      this.onChangeCallback(),
      this
    },
    dot: function(t) {
      return this._x * t._x + this._y * t._y + this._z * t._z + this._w * t._w
    },
    lengthSq: function() {
      return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w
    },
    length: function() {
      return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w)
    },
    normalize: function() {
      var t = this.length();
      return 0 === t
        ? (this._x = 0, this._y = 0, this._z = 0, this._w = 1)
        : (t = 1 / t, this._x = this._x * t, this._y = this._y * t, this._z = this._z * t, this._w = this._w * t),
      this.onChangeCallback(),
      this
    },
    multiply: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."), this.multiplyQuaternions(t, e))
        : this.multiplyQuaternions(this, t)
    },
    premultiply: function(t) {
      return this.multiplyQuaternions(t, this)
    },
    multiplyQuaternions: function(t, e) {
      var i = t._x,
        n = t._y,
        o = t._z,
        r = t._w,
        a = e._x,
        s = e._y,
        l = e._z,
        c = e._w;
      return this._x = i * c + r * a + n * l - o * s,
      this._y = n * c + r * s + o * a - i * l,
      this._z = o * c + r * l + i * s - n * a,
      this._w = r * c - i * a - n * s - o * l,
      this.onChangeCallback(),
      this
    },
    slerp: function(t, e) {
      if (0 === e)
        return this;
      if (1 === e)
        return this.copy(t);
      var i = this._x,
        n = this._y,
        o = this._z,
        r = this._w,
        a = r * t._w + i * t._x + n * t._y + o * t._z;
      if (
        a < 0
        ? (this._w = -t._w, this._x = -t._x, this._y = -t._y, this._z = -t._z, a = -a)
        : this.copy(t),
      a >= 1)
        return this._w = r,
        this._x = i,
        this._y = n,
        this._z = o,
        this;
      var s = Math.sqrt(1 - a * a);
      if (Math.abs(s) < .001)
        return this._w = .5 * (r + this._w),
        this._x = .5 * (i + this._x),
        this._y = .5 * (n + this._y),
        this._z = .5 * (o + this._z),
        this;
      var l = Math.atan2(s, a),
        c = Math.sin((1 - e) * l) / s,
        h = Math.sin(e * l) / s;
      return this._w = r * c + this._w * h,
      this._x = i * c + this._x * h,
      this._y = n * c + this._y * h,
      this._z = o * c + this._z * h,
      this.onChangeCallback(),
      this
    },
    equals: function(t) {
      return t._x === this._x && t._y === this._y && t._z === this._z && t._w === this._w
    },
    fromArray: function(t, e) {
      return void 0 === e && (e = 0),
      this._x = t[e],
      this._y = t[e + 1],
      this._z = t[e + 2],
      this._w = t[e + 3],
      this.onChangeCallback(),
      this
    },
    toArray: function(t, e) {
      return void 0 === t && (t = []),
      void 0 === e && (e = 0),
      t[e] = this._x,
      t[e + 1] = this._y,
      t[e + 2] = this._z,
      t[e + 3] = this._w,
      t
    },
    onChange: function(t) {
      return this.onChangeCallback = t,
      this
    },
    onChangeCallback: function() {}
  }),
  Object.assign(l.prototype, {
    isVector3: !0,
    set: function(t, e, i) {
      return this.x = t,
      this.y = e,
      this.z = i,
      this
    },
    setScalar: function(t) {
      return this.x = t,
      this.y = t,
      this.z = t,
      this
    },
    setX: function(t) {
      return this.x = t,
      this
    },
    setY: function(t) {
      return this.y = t,
      this
    },
    setZ: function(t) {
      return this.z = t,
      this
    },
    setComponent: function(t, e) {
      switch (t) {
        case 0:
          this.x = e;
          break;
        case 1:
          this.y = e;
          break;
        case 2:
          this.z = e;
          break;
        default:
          throw new Error("index is out of range: " + t)
      }
      return this
    },
    getComponent: function(t) {
      switch (t) {
        case 0:
          return this.x;
        case 1:
          return this.y;
        case 2:
          return this.z;
        default:
          throw new Error("index is out of range: " + t)
      }
    },
    clone: function() {
      return new this.constructor(this.x, this.y, this.z)
    },
    copy: function(t) {
      return this.x = t.x,
      this.y = t.y,
      this.z = t.z,
      this
    },
    add: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."), this.addVectors(t, e))
        : (this.x += t.x, this.y += t.y, this.z += t.z, this)
    },
    addScalar: function(t) {
      return this.x += t,
      this.y += t,
      this.z += t,
      this
    },
    addVectors: function(t, e) {
      return this.x = t.x + e.x,
      this.y = t.y + e.y,
      this.z = t.z + e.z,
      this
    },
    addScaledVector: function(t, e) {
      return this.x += t.x * e,
      this.y += t.y * e,
      this.z += t.z * e,
      this
    },
    sub: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."), this.subVectors(t, e))
        : (this.x -= t.x, this.y -= t.y, this.z -= t.z, this)
    },
    subScalar: function(t) {
      return this.x -= t,
      this.y -= t,
      this.z -= t,
      this
    },
    subVectors: function(t, e) {
      return this.x = t.x - e.x,
      this.y = t.y - e.y,
      this.z = t.z - e.z,
      this
    },
    multiply: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."), this.multiplyVectors(t, e))
        : (this.x *= t.x, this.y *= t.y, this.z *= t.z, this)
    },
    multiplyScalar: function(t) {
      return this.x *= t,
      this.y *= t,
      this.z *= t,
      this
    },
    multiplyVectors: function(t, e) {
      return this.x = t.x * e.x,
      this.y = t.y * e.y,
      this.z = t.z * e.z,
      this
    },
    applyEuler: function() {
      var t = new s;
      return function(e) {
        return (e && e.isEuler) === !1 && console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),
        this.applyQuaternion(t.setFromEuler(e))
      }
    }(),
    applyAxisAngle: function() {
      var t = new s;
      return function(e, i) {
        return this.applyQuaternion(t.setFromAxisAngle(e, i))
      }
    }(),
    applyMatrix3: function(t) {
      var e = this.x,
        i = this.y,
        n = this.z,
        o = t.elements;
      return this.x = o[0] * e + o[3] * i + o[6] * n,
      this.y = o[1] * e + o[4] * i + o[7] * n,
      this.z = o[2] * e + o[5] * i + o[8] * n,
      this
    },
    applyMatrix4: function(t) {
      var e = this.x,
        i = this.y,
        n = this.z,
        o = t.elements;
      this.x = o[0] * e + o[4] * i + o[8] * n + o[12],
      this.y = o[1] * e + o[5] * i + o[9] * n + o[13],
      this.z = o[2] * e + o[6] * i + o[10] * n + o[14];
      var r = o[3] * e + o[7] * i + o[11] * n + o[15];
      return this.divideScalar(r)
    },
    applyQuaternion: function(t) {
      var e = this.x,
        i = this.y,
        n = this.z,
        o = t.x,
        r = t.y,
        a = t.z,
        s = t.w,
        l = s * e + r * n - a * i,
        c = s * i + a * e - o * n,
        h = s * n + o * i - r * e,
        u = -o * e - r * i - a * n;
      return this.x = l * s + u * -o + c * -a - h * -r,
      this.y = c * s + u * -r + h * -o - l * -a,
      this.z = h * s + u * -a + l * -r - c * -o,
      this
    },
    project: function() {
      var t = new c;
      return function(e) {
        return t.multiplyMatrices(e.projectionMatrix, t.getInverse(e.matrixWorld)),
        this.applyMatrix4(t)
      }
    }(),
    unproject: function() {
      var t = new c;
      return function(e) {
        return t.multiplyMatrices(e.matrixWorld, t.getInverse(e.projectionMatrix)),
        this.applyMatrix4(t)
      }
    }(),
    transformDirection: function(t) {
      var e = this.x,
        i = this.y,
        n = this.z,
        o = t.elements;
      return this.x = o[0] * e + o[4] * i + o[8] * n,
      this.y = o[1] * e + o[5] * i + o[9] * n,
      this.z = o[2] * e + o[6] * i + o[10] * n,
      this.normalize()
    },
    divide: function(t) {
      return this.x /= t.x,
      this.y /= t.y,
      this.z /= t.z,
      this
    },
    divideScalar: function(t) {
      return this.multiplyScalar(1 / t)
    },
    min: function(t) {
      return this.x = Math.min(this.x, t.x),
      this.y = Math.min(this.y, t.y),
      this.z = Math.min(this.z, t.z),
      this
    },
    max: function(t) {
      return this.x = Math.max(this.x, t.x),
      this.y = Math.max(this.y, t.y),
      this.z = Math.max(this.z, t.z),
      this
    },
    clamp: function(t, e) {
      return this.x = Math.max(t.x, Math.min(e.x, this.x)),
      this.y = Math.max(t.y, Math.min(e.y, this.y)),
      this.z = Math.max(t.z, Math.min(e.z, this.z)),
      this
    },
    clampScalar: function() {
      var t = new l,
        e = new l;
      return function(i, n) {
        return t.set(i, i, i),
        e.set(n, n, n),
        this.clamp(t, e)
      }
    }(),
    clampLength: function(t, e) {
      var i = this.length();
      return this.multiplyScalar(Math.max(t, Math.min(e, i)) / i)
    },
    floor: function() {
      return this.x = Math.floor(this.x),
      this.y = Math.floor(this.y),
      this.z = Math.floor(this.z),
      this
    },
    ceil: function() {
      return this.x = Math.ceil(this.x),
      this.y = Math.ceil(this.y),
      this.z = Math.ceil(this.z),
      this
    },
    round: function() {
      return this.x = Math.round(this.x),
      this.y = Math.round(this.y),
      this.z = Math.round(this.z),
      this
    },
    roundToZero: function() {
      return this.x = this.x < 0
        ? Math.ceil(this.x)
        : Math.floor(this.x),
      this.y = this.y < 0
        ? Math.ceil(this.y)
        : Math.floor(this.y),
      this.z = this.z < 0
        ? Math.ceil(this.z)
        : Math.floor(this.z),
      this
    },
    negate: function() {
      return this.x = -this.x,
      this.y = -this.y,
      this.z = -this.z,
      this
    },
    dot: function(t) {
      return this.x * t.x + this.y * t.y + this.z * t.z
    },
    lengthSq: function() {
      return this.x * this.x + this.y * this.y + this.z * this.z
    },
    length: function() {
      return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z)
    },
    lengthManhattan: function() {
      return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z)
    },
    normalize: function() {
      return this.divideScalar(this.length())
    },
    setLength: function(t) {
      return this.multiplyScalar(t / this.length())
    },
    lerp: function(t, e) {
      return this.x += (t.x - this.x) * e,
      this.y += (t.y - this.y) * e,
      this.z += (t.z - this.z) * e,
      this
    },
    lerpVectors: function(t, e, i) {
      return this.subVectors(e, t).multiplyScalar(i).add(t)
    },
    cross: function(t, e) {
      if (void 0 !== e)
        return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),
        this.crossVectors(t, e);
      var i = this.x,
        n = this.y,
        o = this.z;
      return this.x = n * t.z - o * t.y,
      this.y = o * t.x - i * t.z,
      this.z = i * t.y - n * t.x,
      this
    },
    crossVectors: function(t, e) {
      var i = t.x,
        n = t.y,
        o = t.z,
        r = e.x,
        a = e.y,
        s = e.z;
      return this.x = n * s - o * a,
      this.y = o * r - i * s,
      this.z = i * a - n * r,
      this
    },
    projectOnVector: function(t) {
      var e = t.dot(this) / t.lengthSq();
      return this.copy(t).multiplyScalar(e)
    },
    projectOnPlane: function() {
      var t = new l;
      return function(e) {
        return t.copy(this).projectOnVector(e),
        this.sub(t)
      }
    }(),
    reflect: function() {
      var t = new l;
      return function(e) {
        return this.sub(t.copy(e).multiplyScalar(2 * this.dot(e)))
      }
    }(),
    angleTo: function(t) {
      var e = this.dot(t) / Math.sqrt(this.lengthSq() * t.lengthSq());
      return Math.acos(gs.clamp(e, -1, 1))
    },
    distanceTo: function(t) {
      return Math.sqrt(this.distanceToSquared(t))
    },
    distanceToSquared: function(t) {
      var e = this.x - t.x,
        i = this.y - t.y,
        n = this.z - t.z;
      return e * e + i * i + n * n
    },
    distanceToManhattan: function(t) {
      return Math.abs(this.x - t.x) + Math.abs(this.y - t.y) + Math.abs(this.z - t.z)
    },
    setFromSpherical: function(t) {
      var e = Math.sin(t.phi) * t.radius;
      return this.x = e * Math.sin(t.theta),
      this.y = Math.cos(t.phi) * t.radius,
      this.z = e * Math.cos(t.theta),
      this
    },
    setFromCylindrical: function(t) {
      return this.x = t.radius * Math.sin(t.theta),
      this.y = t.y,
      this.z = t.radius * Math.cos(t.theta),
      this
    },
    setFromMatrixPosition: function(t) {
      return this.setFromMatrixColumn(t, 3)
    },
    setFromMatrixScale: function(t) {
      var e = this.setFromMatrixColumn(t, 0).length(),
        i = this.setFromMatrixColumn(t, 1).length(),
        n = this.setFromMatrixColumn(t, 2).length();
      return this.x = e,
      this.y = i,
      this.z = n,
      this
    },
    setFromMatrixColumn: function(t, e) {
      return this.fromArray(t.elements, 4 * e)
    },
    equals: function(t) {
      return t.x === this.x && t.y === this.y && t.z === this.z
    },
    fromArray: function(t, e) {
      return void 0 === e && (e = 0),
      this.x = t[e],
      this.y = t[e + 1],
      this.z = t[e + 2],
      this
    },
    toArray: function(t, e) {
      return void 0 === t && (t = []),
      void 0 === e && (e = 0),
      t[e] = this.x,
      t[e + 1] = this.y,
      t[e + 2] = this.z,
      t
    },
    fromBufferAttribute: function(t, e, i) {
      return void 0 !== i && console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),
      this.x = t.getX(e),
      this.y = t.getY(e),
      this.z = t.getZ(e),
      this
    }
  }),
  Object.assign(c.prototype, {
    isMatrix4: !0,
    set: function(t, e, i, n, o, r, a, s, l, c, h, u, d, p, f, m) {
      var g = this.elements;
      return g[0] = t,
      g[4] = e,
      g[8] = i,
      g[12] = n,
      g[1] = o,
      g[5] = r,
      g[9] = a,
      g[13] = s,
      g[2] = l,
      g[6] = c,
      g[10] = h,
      g[14] = u,
      g[3] = d,
      g[7] = p,
      g[11] = f,
      g[15] = m,
      this
    },
    identity: function() {
      return this.set(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1),
      this
    },
    clone: function() {
      return (new c).fromArray(this.elements)
    },
    copy: function(t) {
      var e = this.elements,
        i = t.elements;
      return e[0] = i[0],
      e[1] = i[1],
      e[2] = i[2],
      e[3] = i[3],
      e[4] = i[4],
      e[5] = i[5],
      e[6] = i[6],
      e[7] = i[7],
      e[8] = i[8],
      e[9] = i[9],
      e[10] = i[10],
      e[11] = i[11],
      e[12] = i[12],
      e[13] = i[13],
      e[14] = i[14],
      e[15] = i[15],
      this
    },
    copyPosition: function(t) {
      var e = this.elements,
        i = t.elements;
      return e[12] = i[12],
      e[13] = i[13],
      e[14] = i[14],
      this
    },
    extractBasis: function(t, e, i) {
      return t.setFromMatrixColumn(this, 0),
      e.setFromMatrixColumn(this, 1),
      i.setFromMatrixColumn(this, 2),
      this
    },
    makeBasis: function(t, e, i) {
      return this.set(t.x, e.x, i.x, 0, t.y, e.y, i.y, 0, t.z, e.z, i.z, 0, 0, 0, 0, 1),
      this
    },
    extractRotation: function() {
      var t = new l;
      return function(e) {
        var i = this.elements,
          n = e.elements,
          o = 1 / t.setFromMatrixColumn(e, 0).length(),
          r = 1 / t.setFromMatrixColumn(e, 1).length(),
          a = 1 / t.setFromMatrixColumn(e, 2).length();
        return i[0] = n[0] * o,
        i[1] = n[1] * o,
        i[2] = n[2] * o,
        i[4] = n[4] * r,
        i[5] = n[5] * r,
        i[6] = n[6] * r,
        i[8] = n[8] * a,
        i[9] = n[9] * a,
        i[10] = n[10] * a,
        this
      }
    }(),
    makeRotationFromEuler: function(t) {
      (t && t.isEuler) === !1 && console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
      var e = this.elements,
        i = t.x,
        n = t.y,
        o = t.z,
        r = Math.cos(i),
        a = Math.sin(i),
        s = Math.cos(n),
        l = Math.sin(n),
        c = Math.cos(o),
        h = Math.sin(o);
      if ("XYZ" === t.order) {
        var u = r * c,
          d = r * h,
          p = a * c,
          f = a * h;
        e[0] = s * c,
        e[4] = -s * h,
        e[8] = l,
        e[1] = d + p * l,
        e[5] = u - f * l,
        e[9] = -a * s,
        e[2] = f - u * l,
        e[6] = p + d * l,
        e[10] = r * s
      } else if ("YXZ" === t.order) {
        var m = s * c,
          g = s * h,
          v = l * c,
          y = l * h;
        e[0] = m + y * a,
        e[4] = v * a - g,
        e[8] = r * l,
        e[1] = r * h,
        e[5] = r * c,
        e[9] = -a,
        e[2] = g * a - v,
        e[6] = y + m * a,
        e[10] = r * s
      } else if ("ZXY" === t.order) {
        var m = s * c,
          g = s * h,
          v = l * c,
          y = l * h;
        e[0] = m - y * a,
        e[4] = -r * h,
        e[8] = v + g * a,
        e[1] = g + v * a,
        e[5] = r * c,
        e[9] = y - m * a,
        e[2] = -r * l,
        e[6] = a,
        e[10] = r * s
      } else if ("ZYX" === t.order) {
        var u = r * c,
          d = r * h,
          p = a * c,
          f = a * h;
        e[0] = s * c,
        e[4] = p * l - d,
        e[8] = u * l + f,
        e[1] = s * h,
        e[5] = f * l + u,
        e[9] = d * l - p,
        e[2] = -l,
        e[6] = a * s,
        e[10] = r * s
      } else if ("YZX" === t.order) {
        var E = r * s,
          x = r * l,
          b = a * s,
          w = a * l;
        e[0] = s * c,
        e[4] = w - E * h,
        e[8] = b * h + x,
        e[1] = h,
        e[5] = r * c,
        e[9] = -a * c,
        e[2] = -l * c,
        e[6] = x * h + b,
        e[10] = E - w * h
      } else if ("XZY" === t.order) {
        var E = r * s,
          x = r * l,
          b = a * s,
          w = a * l;
        e[0] = s * c,
        e[4] = -h,
        e[8] = l * c,
        e[1] = E * h + w,
        e[5] = r * c,
        e[9] = x * h - b,
        e[2] = b * h - x,
        e[6] = a * c,
        e[10] = w * h + E
      }
      return e[3] = 0,
      e[7] = 0,
      e[11] = 0,
      e[12] = 0,
      e[13] = 0,
      e[14] = 0,
      e[15] = 1,
      this
    },
    makeRotationFromQuaternion: function(t) {
      var e = this.elements,
        i = t._x,
        n = t._y,
        o = t._z,
        r = t._w,
        a = i + i,
        s = n + n,
        l = o + o,
        c = i * a,
        h = i * s,
        u = i * l,
        d = n * s,
        p = n * l,
        f = o * l,
        m = r * a,
        g = r * s,
        v = r * l;
      return e[0] = 1 - (d + f),
      e[4] = h - v,
      e[8] = u + g,
      e[1] = h + v,
      e[5] = 1 - (c + f),
      e[9] = p - m,
      e[2] = u - g,
      e[6] = p + m,
      e[10] = 1 - (c + d),
      e[3] = 0,
      e[7] = 0,
      e[11] = 0,
      e[12] = 0,
      e[13] = 0,
      e[14] = 0,
      e[15] = 1,
      this
    },
    lookAt: function() {
      var t = new l,
        e = new l,
        i = new l;
      return function(n, o, r) {
        var a = this.elements;
        return i.subVectors(n, o),
        0 === i.lengthSq() && (i.z = 1),
        i.normalize(),
        t.crossVectors(r, i),
        0 === t.lengthSq() && (i.z += 1e-4, t.crossVectors(r, i)),
        t.normalize(),
        e.crossVectors(i, t),
        a[0] = t.x,
        a[4] = e.x,
        a[8] = i.x,
        a[1] = t.y,
        a[5] = e.y,
        a[9] = i.y,
        a[2] = t.z,
        a[6] = e.z,
        a[10] = i.z,
        this
      }
    }(),
    multiply: function(t, e) {
      return void 0 !== e
        ? (console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."), this.multiplyMatrices(t, e))
        : this.multiplyMatrices(this, t)
    },
    premultiply: function(t) {
      return this.multiplyMatrices(t, this)
    },
    multiplyMatrices: function(t, e) {
      var i = t.elements,
        n = e.elements,
        o = this.elements,
        r = i[0],
        a = i[4],
        s = i[8],
        l = i[12],
        c = i[1],
        h = i[5],
        u = i[9],
        d = i[13],
        p = i[2],
        f = i[6],
        m = i[10],
        g = i[14],
        v = i[3],
        y = i[7],
        E = i[11],
        x = i[15],
        b = n[0],
        w = n[4],
        C = n[8],
        T = n[12],
        _ = n[1],
        L = n[5],
        M = n[9],
        S = n[13],
        O = n[2],
        D = n[6],
        R = n[10],
        U = n[14],
        A = n[3],
        I = n[7],
        P = n[11],
        B = n[15];
      return o[0] = r * b + a * _ + s * O + l * A,
      o[4] = r * w + a * L + s * D + l * I,
      o[8] = r * C + a * M + s * R + l * P,
      o[12] = r * T + a * S + s * U + l * B,
      o[1] = c * b + h * _ + u * O + d * A,
      o[5] = c * w + h * L + u * D + d * I,
      o[9] = c * C + h * M + u * R + d * P,
      o[13] = c * T + h * S + u * U + d * B,
      o[2] = p * b + f * _ + m * O + g * A,
      o[6] = p * w + f * L + m * D + g * I,
      o[10] = p * C + f * M + m * R + g * P,
      o[14] = p * T + f * S + m * U + g * B,
      o[3] = v * b + y * _ + E * O + x * A,
      o[7] = v * w + y * L + E * D + x * I,
      o[11] = v * C + y * M + E * R + x * P,
      o[15] = v * T + y * S + E * U + x * B,
      this
    },
    multiplyScalar: function(t) {
      var e = this.elements;
      return e[0] *= t,
      e[4] *= t,
      e[8] *= t,
      e[12] *= t,
      e[1] *= t,
      e[5] *= t,
      e[9] *= t,
      e[13] *= t,
      e[2] *= t,
      e[6] *= t,
      e[10] *= t,
      e[14] *= t,
      e[3] *= t,
      e[7] *= t,
      e[11] *= t,
      e[15] *= t,
      this
    },
    applyToBufferAttribute: function() {
      var t = new l;
      return function(e) {
        for (var i = 0, n = e.count; i < n; i++)
          t.x = e.getX(i),
          t.y = e.getY(i),
          t.z = e.getZ(i),
          t.applyMatrix4(this),
          e.setXYZ(i, t.x, t.y, t.z);
        return e
      }
    }(),
    determinant: function() {
      var t = this.elements,
        e = t[0],
        i = t[4],
        n = t[8],
        o = t[12],
        r = t[1],
        a = t[5],
        s = t[9],
        l = t[13],
        c = t[2],
        h = t[6],
        u = t[10],
        d = t[14];
      return t[3] * (+ o * s * h - n * l * h - o * a * u + i * l * u + n * a * d - i * s * d) + t[7] * (+ e * s * d - e * l * u + o * r * u - n * r * d + n * l * c - o * s * c) + t[11] * (+ e * l * h - e * a * d - o * r * h + i * r * d + o * a * c - i * l * c) + t[15] * (-n * a * c - e * s * h + e * a * u + n * r * h - i * r * u + i * s * c)
    },
    transpose: function() {
      var t,
        e = this.elements;
      return t = e[1],
      e[1] = e[4],
      e[4] = t,
      t = e[2],
      e[2] = e[8],
      e[8] = t,
      t = e[6],
      e[6] = e[9],
      e[9] = t,
      t = e[3],
      e[3] = e[12],
      e[12] = t,
      t = e[7],
      e[7] = e[13],
      e[13] = t,
      t = e[11],
      e[11] = e[14],
      e[14] = t,
      this
    },
    setPosition: function(t) {
      var e = this.elements;
      return e[12] = t.x,
      e[13] = t.y,
      e[14] = t.z,
      this
    },
    getInverse: function(t, e) {
      var i = this.elements,
        n = t.elements,
        o = n[0],
        r = n[1],
        a = n[2],
        s = n[3],
        l = n[4],
        c = n[5],
        h = n[6],
        u = n[7],
        d = n[8],
        p = n[9],
        f = n[10],
        m = n[11],
        g = n[12],
        v = n[13],
        y = n[14],
        E = n[15],
        x = p * y * u - v * f * u + v * h * m - c * y * m - p * h * E + c * f * E,
        b = g * f * u - d * y * u - g * h * m + l * y * m + d * h * E - l * f * E,
        w = d * v * u - g * p * u + g * c * m - l * v * m - d * c * E + l * p * E,
        C = g * p * h - d * v * h - g * c * f + l * v * f + d * c * y - l * p * y,
        T = o * x + r * b + a * w + s * C;
      if (0 === T) {
        var _ = "THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";
        if (e === !0)
          throw new Error(_);
        return console.warn(_),
        this.identity()
      }
      var L = 1 / T;
      return i[0] = x * L,
      i[1] = (v * f * s - p * y * s - v * a * m + r * y * m + p * a * E - r * f * E) * L,
      i[2] = (c * y * s - v * h * s + v * a * u - r * y * u - c * a * E + r * h * E) * L,
      i[3] = (p * h * s - c * f * s - p * a * u + r * f * u + c * a * m - r * h * m) * L,
      i[4] = b * L,
      i[5] = (d * y * s - g * f * s + g * a * m - o * y * m - d * a * E + o * f * E) * L,
      i[6] = (g * h * s - l * y * s - g * a * u + o * y * u + l * a * E - o * h * E) * L,
      i[7] = (l * f * s - d * h * s + d * a * u - o * f * u - l * a * m + o * h * m) * L,
      i[8] = w * L,
      i[9] = (g * p * s - d * v * s - g * r * m + o * v * m + d * r * E - o * p * E) * L,
      i[10] = (l * v * s - g * c * s + g * r * u - o * v * u - l * r * E + o * c * E) * L,
      i[11] = (d * c * s - l * p * s - d * r * u + o * p * u + l * r * m - o * c * m) * L,
      i[12] = C * L,
      i[13] = (d * v * a - g * p * a + g * r * f - o * v * f - d * r * y + o * p * y) * L,
      i[14] = (g * c * a - l * v * a - g * r * h + o * v * h + l * r * y - o * c * y) * L,
      i[15] = (l * p * a - d * c * a + d * r * h - o * p * h - l * r * f + o * c * f) * L,
      this
    },
    scale: function(t) {
      var e = this.elements,
        i = t.x,
        n = t.y,
        o = t.z;
      return e[0] *= i,
      e[4] *= n,
      e[8] *= o,
      e[1] *= i,
      e[5] *= n,
      e[9] *= o,
      e[2] *= i,
      e[6] *= n,
      e[10] *= o,
      e[3] *= i,
      e[7] *= n,
      e[11] *= o,
      this
    },
    getMaxScaleOnAxis: function() {
      var t = this.elements,
        e = t[0] * t[0] + t[1] * t[1] + t[2] * t[2],
        i = t[4] * t[4] + t[5] * t[5] + t[6] * t[6],
        n = t[8] * t[8] + t[9] * t[9] + t[10] * t[10];
      return Math.sqrt(Math.max(e, i, n))
    },
    makeTranslation: function(t, e, i) {
      return this.set(1, 0, 0, t, 0, 1, 0, e, 0, 0, 1, i, 0, 0, 0, 1),
      this
    },
    makeRotationX: function(t) {
      var e = Math.cos(t),
        i = Math.sin(t);
      return this.set(1, 0, 0, 0, 0, e, -i, 0, 0, i, e, 0, 0, 0, 0, 1),
      this
    },
    makeRotationY: function(t) {
      var e = Math.cos(t),
        i = Math.sin(t);
      return this.set(e, 0, i, 0, 0, 1, 0, 0, -i, 0, e, 0, 0, 0, 0, 1),
      this
    },
    makeRotationZ: function(t) {
      var e = Math.cos(t),
        i = Math.sin(t);
      return this.set(e, -i, 0, 0, i, e, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1),
      this
    },
    makeRotationAxis: function(t, e) {
      var i = Math.cos(e),
        n = Math.sin(e),
        o = 1 - i,
        r = t.x,
        a = t.y,
        s = t.z,
        l = o * r,
        c = o * a;
      return this.set(l * r + i, l * a - n * s, l * s + n * a, 0, l * a + n * s, c * a + i, c * s - n * r, 0, l * s - n * a, c * s + n * r, o * s * s + i, 0, 0, 0, 0, 1),
      this
    },
    makeScale: function(t, e, i) {
      return this.set(t, 0, 0, 0, 0, e, 0, 0, 0, 0, i, 0, 0, 0, 0, 1),
      this
    },
    makeShear: function(t, e, i) {
      return this.set(1, e, i, 0, t, 1, i, 0, t, e, 1, 0, 0, 0, 0, 1),
      this
    },
    compose: function(t, e, i) {
      return this.makeRotationFromQuaternion(e),
      this.scale(i),
      this.setPosition(t),
      this
    },
    decompose: function() {
      var t = new l,
        e = new c;
      return function(i, n, o) {
        var r = this.elements,
          a = t.set(r[0], r[1], r[2]).length(),
          s = t.set(r[4], r[5], r[6]).length(),
          l = t.set(r[8], r[9], r[10]).length();
        this.determinant() < 0 && (a = -a),
        i.x = r[12],
        i.y = r[13],
        i.z = r[14],
        e.copy(this);
        var c = 1 / a,
          h = 1 / s,
          u = 1 / l;
        return e.elements[0] *= c,
        e.elements[1] *= c,
        e.elements[2] *= c,
        e.elements[4] *= h,
        e.elements[5] *= h,
        e.elements[6] *= h,
        e.elements[8] *= u,
        e.elements[9] *= u,
        e.elements[10] *= u,
        n.setFromRotationMatrix(e),
        o.x = a,
        o.y = s,
        o.z = l,
        this
      }
    }(),
    makePerspective: function(t, e, i, n, o, r) {
      void 0 === r && console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");
      var a = this.elements,
        s = 2 * o / (e - t),
        l = 2 * o / (i - n),
        c = (e + t) / (e - t),
        h = (i + n) / (i - n),
        u = -(r + o) / (r - o),
        d = -2 * r * o / (r - o);
      return a[0] = s,
      a[4] = 0,
      a[8] = c,
      a[12] = 0,
      a[1] = 0,
      a[5] = l,
      a[9] = h,
      a[13] = 0,
      a[2] = 0,
      a[6] = 0,
      a[10] = u,
      a[14] = d,
      a[3] = 0,
      a[7] = 0,
      a[11] = -1,
      a[15] = 0,
      this
    },
    makeOrthographic: function(t, e, i, n, o, r) {
      var a = this.elements,
        s = 1 / (e - t),
        l = 1 / (i - n),
        c = 1 / (r - o),
        h = (e + t) * s,
        u = (i + n) * l,
        d = (r + o) * c;
      return a[0] = 2 * s,
      a[4] = 0,
      a[8] = 0,
      a[12] = -h,
      a[1] = 0,
      a[5] = 2 * l,
      a[9] = 0,
      a[13] = -u,
      a[2] = 0,
      a[6] = 0,
      a[10] = -2 * c,
      a[14] = -d,
      a[3] = 0,
      a[7] = 0,
      a[11] = 0,
      a[15] = 1,
      this
    },
    equals: function(t) {
      for (var e = this.elements, i = t.elements, n = 0; n < 16; n++)
        if (e[n] !== i[n])
          return !1;
    return !0
    },
    fromArray: function(t, e) {
      void 0 === e && (e = 0);
      for (var i = 0; i < 16; i++)
        this.elements[i] = t[i + e];
      return this
    },
    toArray: function(t, e) {
      void 0 === t && (t = []),
      void 0 === e && (e = 0);
      var i = this.elements;
      return t[e] = i[0],
      t[e + 1] = i[1],
      t[e + 2] = i[2],
      t[e + 3] = i[3],
      t[e + 4] = i[4],
      t[e + 5] = i[5],
      t[e + 6] = i[6],
      t[e + 7] = i[7],
      t[e + 8] = i[8],
      t[e + 9] = i[9],
      t[e + 10] = i[10],
      t[e + 11] = i[11],
      t[e + 12] = i[12],
      t[e + 13] = i[13],
      t[e + 14] = i[14],
      t[e + 15] = i[15],
      t
    }
  }),
  h.prototype = Object.create(n.prototype),
  h.prototype.constructor = h,
  h.prototype.isDataTexture = !0,
  u.prototype = Object.create(n.prototype),
  u.prototype.constructor = u,
  u.prototype.isCubeTexture = !0,
  Object.defineProperty(u.prototype, "images", {
    get: function() {
      return this.image
    },
    set: function(t) {
      this.image = t
    }
  });
  var ys = new n,
    Es = new u,
    xs = [],
    bs = [],
    ws = new Float32Array(16),
    Cs = new Float32Array(9);
  V.prototype.setValue = function(t, e) {
    for (var i = this.seq, n = 0, o = i.length; n !== o; ++n) {
      var r = i[n];
      r.setValue(t, e[r.id])
    }
  };
  var Ts = /([\w\d_]+)(\])?(\[|\.)?/g;
  W.prototype.setValue = function(t, e, i) {
    var n = this.map[e];
    void 0 !== n && n.setValue(t, i, this.renderer)
  },
  W.prototype.setOptional = function(t, e, i) {
    var n = e[i];
    void 0 !== n && this.setValue(t, i, n)
  },
  W.upload = function(t, e, i, n) {
    for (var o = 0, r = e.length; o !== r; ++o) {
      var a = e[o],
        s = i[a.id];
      s.needsUpdate !== !1 && a.setValue(t, s.value, n)
    }
  },
  W.seqWithValue = function(t, e) {
    for (var i = [], n = 0, o = t.length; n !== o; ++n) {
      var r = t[n];
      r.id in e && i.push(r)
    }
    return i
  };
  var _s = {
    aliceblue: 15792383,
    antiquewhite: 16444375,
    aqua: 65535,
    aquamarine: 8388564,
    azure: 15794175,
    beige: 16119260,
    bisque: 16770244,
    black: 0,
    blanchedalmond: 16772045,
    blue: 255,
    blueviolet: 9055202,
    brown: 10824234,
    burlywood: 14596231,
    cadetblue: 6266528,
    chartreuse: 8388352,
    chocolate: 13789470,
    coral: 16744272,
    cornflowerblue: 6591981,
    cornsilk: 16775388,
    crimson: 14423100,
    cyan: 65535,
    darkblue: 139,
    darkcyan: 35723,
    darkgoldenrod: 12092939,
    darkgray: 11119017,
    darkgreen: 25600,
    darkgrey: 11119017,
    darkkhaki: 12433259,
    darkmagenta: 9109643,
    darkolivegreen: 5597999,
    darkorange: 16747520,
    darkorchid: 10040012,
    darkred: 9109504,
    darksalmon: 15308410,
    darkseagreen: 9419919,
    darkslateblue: 4734347,
    darkslategray: 3100495,
    darkslategrey: 3100495,
    darkturquoise: 52945,
    darkviolet: 9699539,
    deeppink: 16716947,
    deepskyblue: 49151,
    dimgray: 6908265,
    dimgrey: 6908265,
    dodgerblue: 2003199,
    firebrick: 11674146,
    floralwhite: 16775920,
    forestgreen: 2263842,
    fuchsia: 16711935,
    gainsboro: 14474460,
    ghostwhite: 16316671,
    gold: 16766720,
    goldenrod: 14329120,
    gray: 8421504,
    green: 32768,
    greenyellow: 11403055,
    grey: 8421504,
    honeydew: 15794160,
    hotpink: 16738740,
    indianred: 13458524,
    indigo: 4915330,
    ivory: 16777200,
    khaki: 15787660,
    lavender: 15132410,
    lavenderblush: 16773365,
    lawngreen: 8190976,
    lemonchiffon: 16775885,
    lightblue: 11393254,
    lightcoral: 15761536,
    lightcyan: 14745599,
    lightgoldenrodyellow: 16448210,
    lightgray: 13882323,
    lightgreen: 9498256,
    lightgrey: 13882323,
    lightpink: 16758465,
    lightsalmon: 16752762,
    lightseagreen: 2142890,
    lightskyblue: 8900346,
    lightslategray: 7833753,
    lightslategrey: 7833753,
    lightsteelblue: 11584734,
    lightyellow: 16777184,
    lime: 65280,
    limegreen: 3329330,
    linen: 16445670,
    magenta: 16711935,
    maroon: 8388608,
    mediumaquamarine: 6737322,
    mediumblue: 205,
    mediumorchid: 12211667,
    mediumpurple: 9662683,
    mediumseagreen: 3978097,
    mediumslateblue: 8087790,
    mediumspringgreen: 64154,
    mediumturquoise: 4772300,
    mediumvioletred: 13047173,
    midnightblue: 1644912,
    mintcream: 16121850,
    mistyrose: 16770273,
    moccasin: 16770229,
    navajowhite: 16768685,
    navy: 128,
    oldlace: 16643558,
    olive: 8421376,
    olivedrab: 7048739,
    orange: 16753920,
    orangered: 16729344,
    orchid: 14315734,
    palegoldenrod: 15657130,
    palegreen: 10025880,
    paleturquoise: 11529966,
    palevioletred: 14381203,
    papayawhip: 16773077,
    peachpuff: 16767673,
    peru: 13468991,
    pink: 16761035,
    plum: 14524637,
    powderblue: 11591910,
    purple: 8388736,
    red: 16711680,
    rosybrown: 12357519,
    royalblue: 4286945,
    saddlebrown: 9127187,
    salmon: 16416882,
    sandybrown: 16032864,
    seagreen: 3050327,
    seashell: 16774638,
    sienna: 10506797,
    silver: 12632256,
    skyblue: 8900331,
    slateblue: 6970061,
    slategray: 7372944,
    slategrey: 7372944,
    snow: 16775930,
    springgreen: 65407,
    steelblue: 4620980,
    tan: 13808780,
    teal: 32896,
    thistle: 14204888,
    tomato: 16737095,
    turquoise: 4251856,
    violet: 15631086,
    wheat: 16113331,
    white: 16777215,
    whitesmoke: 16119285,
    yellow: 16776960,
    yellowgreen: 10145074
  };
  Object.assign(j.prototype, {
    isColor: !0,
    r: 1,
    g: 1,
    b: 1,
    set: function(t) {
      return t && t.isColor
        ? this.copy(t)
        : "number" == typeof t
          ? this.setHex(t)
          : "string" == typeof t && this.setStyle(t),
      this
    },
    setScalar: function(t) {
      return this.r = t,
      this.g = t,
      this.b = t,
      this
    },
    setHex: function(t) {
      return t = Math.floor(t),
      this.r = (t >> 16 & 255) / 255,
      this.g = (t >> 8 & 255) / 255,
      this.b = (255 & t) / 255,
      this
    },
    setRGB: function(t, e, i) {
      return this.r = t,
      this.g = e,
      this.b = i,
      this
    },
    setHSL: function() {
      function t(t, e, i) {
        return i < 0 && (i += 1),
        i > 1 && (i -= 1),
        i < 1 / 6
          ? t + 6 * (e - t) * i
          : i < .5
            ? e
            : i < 2 / 3
              ? t + 6 * (e - t) * (2 / 3 - i)
              : t
      }
      return function(e, i, n) {
        if (e = gs.euclideanModulo(e, 1), i = gs.clamp(i, 0, 1), n = gs.clamp(n, 0, 1), 0 === i)
          this.r = this.g = this.b = n;
        else {
          var o = n <= .5
              ? n * (1 + i)
              : n + i - n * i,
            r = 2 * n - o;
          this.r = t(r, o, e + 1 / 3),
          this.g = t(r, o, e),
          this.b = t(r, o, e - 1 / 3)
        }
        return this
      }
    }(),
    setStyle: function(t) {
      function e(e) {
        void 0 !== e && parseFloat(e) < 1 && console.warn("THREE.Color: Alpha component of " + t + " will be ignored.")
      }
      var i;
      if (i = /^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)) {
        var n,
          o = i[1],
          r = i[2];
        switch (o) {
          case "rgb":
          case "rgba":
            if (n = /^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))
              return this.r = Math.min(255, parseInt(n[1], 10)) / 255,
              this.g = Math.min(255, parseInt(n[2], 10)) / 255,
              this.b = Math.min(255, parseInt(n[3], 10)) / 255,
              e(n[5]),
              this;
            if (n = /^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))
              return this.r = Math.min(100, parseInt(n[1], 10)) / 100,
              this.g = Math.min(100, parseInt(n[2], 10)) / 100,
              this.b = Math.min(100, parseInt(n[3], 10)) / 100,
              e(n[5]),
              this;
            break;
          case "hsl":
          case "hsla":
            if (n = /^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)) {
              var a = parseFloat(n[1]) / 360,
                s = parseInt(n[2], 10) / 100,
                l = parseInt(n[3], 10) / 100;
              return e(n[5]),
              this.setHSL(a, s, l)
            }
        }
      } else if (i = /^\#([A-Fa-f0-9]+)$/.exec(t)) {
        var c = i[1],
          h = c.length;
        if (3 === h)
          return this.r = parseInt(c.charAt(0) + c.charAt(0), 16) / 255,
          this.g = parseInt(c.charAt(1) + c.charAt(1), 16) / 255,
          this.b = parseInt(c.charAt(2) + c.charAt(2), 16) / 255,
          this;
        if (6 === h)
          return this.r = parseInt(c.charAt(0) + c.charAt(1), 16) / 255,
          this.g = parseInt(c.charAt(2) + c.charAt(3), 16) / 255,
          this.b = parseInt(c.charAt(4) + c.charAt(5), 16) / 255,
          this
      }
      if (t && t.length > 0) {
        var c = _s[t];
        void 0 !== c
          ? this.setHex(c)
          : console.warn("THREE.Color: Unknown color " + t)
      }
      return this
    },
    clone: function() {
      return new this.constructor(this.r, this.g, this.b)
    },
    copy: function(t) {
      return this.r = t.r,
      this.g = t.g,
      this.b = t.b,
      this
    },
    copyGammaToLinear: function(t, e) {
      return void 0 === e && (e = 2),
      this.r = Math.pow(t.r, e),
      this.g = Math.pow(t.g, e),
      this.b = Math.pow(t.b, e),
      this
    },
    copyLinearToGamma: function(t, e) {
      void 0 === e && (e = 2);
      var i = e > 0
        ? 1 / e
        : 1;
      return this.r = Math.pow(t.r, i),
      this.g = Math.pow(t.g, i),
      this.b = Math.pow(t.b, i),
      this
    },
    convertGammaToLinear: function() {
      var t = this.r,
        e = this.g,
        i = this.b;
      return this.r = t * t,
      this.g = e * e,
      this.b = i * i,
      this
    },
    convertLinearToGamma: function() {
      return this.r = Math.sqrt(this.r),
      this.g = Math.sqrt(this.g),
      this.b = Math.sqrt(this.b),
      this
    },
    getHex: function() {
      return 255 * this.r << 16 ^ 255 * this.g << 8 ^ 255 * this.b << 0
    },
    getHexString: function() {
      return ("000000" + this.getHex().toString(16)).slice(-6)
    },
    getHSL: function(t) {
      var e,
        i,
        n = t || {
          h: 0,
          s: 0,
          l: 0
        },
        o = this.r,
        r = this.g,
        a = this.b,
        s = Math.max(o, r, a),
        l = Math.min(o, r, a),
        c = (l + s) / 2;
      if (l === s)
        e = 0,
        i = 0;
      else {
        var h = s - l;
        switch (
          i = c <= .5
          ? h / (s + l)
          : h / (2 - s - l),
        s) {
          case o:
            e = (r - a) / h + (
              r < a
              ? 6
              : 0);
            break;
          case r:
            e = (a - o) / h + 2;
            break;
          case a:
            e = (o - r) / h + 4
        }
        e /= 6
      }
      return n.h = e,
      n.s = i,
      n.l = c,
      n
    },
    getStyle: function() {
      return "rgb(" + (
      255 * this.r | 0) + "," + (
      255 * this.g | 0) + "," + (
      255 * this.b | 0) + ")"
    },
    offsetHSL: function(t, e, i) {
      var n = this.getHSL();
      return n.h += t,
      n.s += e,
      n.l += i,
      this.setHSL(n.h, n.s, n.l),
      this
    },
    add: function(t) {
      return this.r += t.r,
      this.g += t.g,
      this.b += t.b,
      this
    },
    addColors: function(t, e) {
      return this.r = t.r + e.r,
      this.g = t.g + e.g,
      this.b = t.b + e.b,
      this
    },
    addScalar: function(t) {
      return this.r += t,
      this.g += t,
      this.b += t,
      this
    },
    sub: function(t) {
      return this.r = Math.max(0, this.r - t.r),
      this.g = Math.max(0, this.g - t.g),
      this.b = Math.max(0, this.b - t.b),
      this
    },
    multiply: function(t) {
      return this.r *= t.r,
      this.g *= t.g,
      this.b *= t.b,
      this
    },
    multiplyScalar: function(t) {
      return this.r *= t,
      this.g *= t,
      this.b *= t,
      this
    },
    lerp: function(t, e) {
      return this.r += (t.r - this.r) * e,
      this.g += (t.g - this.g) * e,
      this.b += (t.b - this.b) * e,
      this
    },
    equals: function(t) {
      return t.r === this.r && t.g === this.g && t.b === this.b
    },
    fromArray: function(t, e) {
      return void 0 === e && (e = 0),
      this.r = t[e],
      this.g = t[e + 1],
      this.b = t[e + 2],
      this
    },
    toArray: function(t, e) {
      return void 0 === t && (t = []),
      void 0 === e && (e = 0),
      t[e] = this.r,
      t[e + 1] = this.g,
      t[e + 2] = this.b,
      t
    },
    toJSON: function() {
      return this.getHex()
    }
  });
  var Ls = {
      common: {
        diffuse: {
          value: new j(15658734)
        },
        opacity: {
          value: 1
        },
        map: {
          value: null
        },
        offsetRepeat: {
          value: new o(0, 0, 1, 1)
        },
        rotateMatrix: {
          value: new et
        },
        specularMap: {
          value: null
        },
        alphaMap: {
          value: null
        },
        envMap: {
          value: null
        },
        flipEnvMap: {
          value: -1
        },
        reflectivity: {
          value: 1
        },
        refractionRatio: {
          value: .98
        }
      },
      aomap: {
        aoMap: {
          value: null
        },
        aoMapIntensity: {
          value: 1
        }
      },
      lightmap: {
        lightMap: {
          value: null
        },
        lightMapIntensity: {
          value: 1
        }
      },
      emissivemap: {
        emissiveMap: {
          value: null
        }
      },
      bumpmap: {
        bumpMap: {
          value: null
        },
        bumpScale: {
          value: 1
        }
      },
      normalmap: {
        normalMap: {
          value: null
        },
        normalScale: {
          value: new i(1, 1)
        }
      },
      displacementmap: {
        displacementMap: {
          value: null
        },
        displacementScale: {
          value: 1
        },
        displacementBias: {
          value: 0
        }
      },
      roughnessmap: {
        roughnessMap: {
          value: null
        }
      },
      metalnessmap: {
        metalnessMap: {
          value: null
        }
      },
      gradientmap: {
        gradientMap: {
          value: null
        }
      },
      fog: {
        fogDensity: {
          value: 25e-5
        },
        fogNear: {
          value: 1
        },
        fogFar: {
          value: 2e3
        },
        fogColor: {
          value: new j(16777215)
        }
      },
      lights: {
        ambientLightColor: {
          value: []
        },
        directionalLights: {
          value: [],
          properties: {
            direction: {},
            color: {},
            shadow: {},
            shadowBias: {},
            shadowRadius: {},
            shadowMapSize: {}
          }
        },
        directionalShadowMap: {
          value: []
        },
        directionalShadowMatrix: {
          value: []
        },
        spotLights: {
          value: [],
          properties: {
            color: {},
            position: {},
            direction: {},
            distance: {},
            coneCos: {},
            penumbraCos: {},
            decay: {},
            shadow: {},
            shadowBias: {},
            shadowRadius: {},
            shadowMapSize: {}
          }
        },
        spotShadowMap: {
          value: []
        },
        spotShadowMatrix: {
          value: []
        },
        pointLights: {
          value: [],
          properties: {
            color: {},
            position: {},
            decay: {},
            distance: {},
            shadow: {},
            shadowBias: {},
            shadowRadius: {},
            shadowMapSize: {}
          }
        },
        pointShadowMap: {
          value: []
        },
        pointShadowMatrix: {
          value: []
        },
        hemisphereLights: {
          value: [],
          properties: {
            direction: {},
            skyColor: {},
            groundColor: {}
          }
        },
        rectAreaLights: {
          value: [],
          properties: {
            color: {},
            position: {},
            width: {},
            height: {}
          }
        }
      },
      points: {
        diffuse: {
          value: new j(15658734)
        },
        opacity: {
          value: 1
        },
        size: {
          value: 1
        },
        scale: {
          value: 1
        },
        map: {
          value: null
        },
        offsetRepeat: {
          value: new o(0, 0, 1, 1)
        }
      }
    },
    Ms = {
      merge: function(t) {
        for (var e = {}, i = 0; i < t.length; i++) {
          var n = this.clone(t[i]);
          for (var o in n)
            e[o] = n[o]
        }
        return e
      },
      clone: function(t) {
        var e = {};
        for (var i in t) {
          e[i] = {};
          for (var n in t[i]) {
            var o = t[i][n];
            o && (o.isColor || o.isMatrix3 || o.isMatrix4 || o.isVector2 || o.isVector3 || o.isVector4 || o.isTexture)
              ? e[i][n] = o.clone()
              : Array.isArray(o)
                ? e[i][n] = o.slice()
                : e[i][n] = o
          }
        }
        return e
      }
    },
    Ss = {
      alphamap_fragment: "#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",
      alphamap_pars_fragment: "#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",
      alphatest_fragment: "#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",
      aomap_fragment: "#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
      aomap_pars_fragment: "#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",
      begin_vertex: "\nvec3 transformed = vec3( position );\n",
      beginnormal_vertex: "\nvec3 objectNormal = vec3( normal );\n",
      bsdfs: "float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
      bumpmap_pars_fragment: "#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
      clipping_planes_fragment: "#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",
      clipping_planes_pars_fragment: "#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",
      clipping_planes_pars_vertex: "#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",
      clipping_planes_vertex: "#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",
      color_fragment: "#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",
      color_pars_fragment: "#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",
      color_pars_vertex: "#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",
      color_vertex: "#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",
      common: "#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",
      cube_uv_reflection_fragment: "#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
      defaultnormal_vertex: "#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",
      displacementmap_pars_vertex: "#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",
      displacementmap_vertex: "#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",
      emissivemap_fragment: "#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",
      emissivemap_pars_fragment: "#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",
      encodings_fragment: "  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",
      encodings_pars_fragment: "\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",
      envmap_fragment: "#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
      envmap_pars_fragment: "#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
      envmap_pars_vertex: "#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",
      envmap_vertex: "#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
      fog_vertex: "\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",
      fog_pars_vertex: "#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",
      fog_fragment: "#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",
      fog_pars_fragment: "#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",
      gradientmap_pars_fragment: "#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",
      lightmap_fragment: "#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",
      lightmap_pars_fragment: "#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",
      lights_lambert_vertex: "vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
      lights_pars: "uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
      lights_phong_fragment: "BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",
      lights_phong_pars_fragment: "varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
      lights_physical_fragment: "PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
      lights_physical_pars_fragment: "struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
      lights_template: "\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",
      logdepthbuf_fragment: "#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",
      logdepthbuf_pars_fragment: "#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",
      logdepthbuf_pars_vertex: "#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",
      logdepthbuf_vertex: "#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",
      map_fragment: "#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",
      map_pars_fragment: "#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",
      map_particle_fragment: "#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",
      map_particle_pars_fragment: "#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",
      metalnessmap_fragment: "float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",
      metalnessmap_pars_fragment: "#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",
      morphnormal_vertex: "#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",
      morphtarget_pars_vertex: "#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",
      morphtarget_vertex: "#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
      normal_flip: "#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",
      normal_fragment: "#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
      normalmap_pars_fragment: "#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
      packing: "vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
      premultiplied_alpha_fragment: "#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",
      project_vertex: "#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",
      dithering_fragment: "#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",
      dithering_pars_fragment: "#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",
      roughnessmap_fragment: "float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",
      roughnessmap_pars_fragment: "#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",
      shadowmap_pars_fragment: "#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
      shadowmap_pars_vertex: "#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",
      shadowmap_vertex: "#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",
      shadowmask_pars_fragment: "float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
      skinbase_vertex: "#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",
      skinning_pars_vertex: "#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
      skinning_vertex: "#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",
      skinnormal_vertex: "#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
      specularmap_fragment: "float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",
      specularmap_pars_fragment: "#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",
      tonemapping_fragment: "#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",
      tonemapping_pars_fragment: "#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
      uv_pars_fragment: "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",
      uv_pars_vertex: "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\tuniform mat3 rotateMatrix;\n#endif\n",
      uv_vertex: "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = mat2(rotateMatrix) * vec2(uv.x - 0.5, uv.y - 0.5) + vec2(0.5, 0.5);\n\tvUv = (vUv -  offsetRepeat.xy)* offsetRepeat.zw;\n#endif",
      uv2_pars_fragment: "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",
      uv2_pars_vertex: "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
      uv2_vertex: "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",
      worldpos_vertex: "#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",
      cube_frag: "uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
      cube_vert: "varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
      depth_frag: "#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
      depth_vert: "#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
      distanceRGBA_frag: "uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",
      distanceRGBA_vert: "varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",
      equirect_frag: "uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",
      equirect_vert: "varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
      linedashed_frag: "uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
      linedashed_vert: "uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",
      meshbasic_frag: "uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
      meshbasic_vert: "#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",
      meshlambert_frag: "uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
      meshlambert_vert: "#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
      meshphong_frag: "#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
      meshphong_vert: "#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
      meshphysical_frag: "#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
      meshphysical_vert: "#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
      normal_frag: "#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",
      normal_vert: "#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",
      points_frag: "uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
      points_vert: "uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
      shadow_frag: "uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n",
      shadow_vert: "#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"
    },
    Os = {
      basic: {
        uniforms: Ms.merge([Ls.common, Ls.aomap, Ls.lightmap, Ls.fog]),
        vertexShader: Ss.meshbasic_vert,
        fragmentShader: Ss.meshbasic_frag
      },
      lambert: {
        uniforms: Ms.merge([
          Ls.common,
          Ls.aomap,
          Ls.lightmap,
          Ls.emissivemap,
          Ls.fog,
          Ls.lights, {
            emissive: {
              value: new j(0)
            }
          }
        ]),
        vertexShader: Ss.meshlambert_vert,
        fragmentShader: Ss.meshlambert_frag
      },
      phong: {
        uniforms: Ms.merge([
          Ls.common,
          Ls.aomap,
          Ls.lightmap,
          Ls.emissivemap,
          Ls.bumpmap,
          Ls.normalmap,
          Ls.displacementmap,
          Ls.gradientmap,
          Ls.fog,
          Ls.lights, {
            emissive: {
              value: new j(0)
            },
            specular: {
              value: new j(1118481)
            },
            shininess: {
              value: 30
            }
          }
        ]),
        vertexShader: Ss.meshphong_vert,
        fragmentShader: Ss.meshphong_frag
      },
      standard: {
        uniforms: Ms.merge([
          Ls.common,
          Ls.aomap,
          Ls.lightmap,
          Ls.emissivemap,
          Ls.bumpmap,
          Ls.normalmap,
          Ls.displacementmap,
          Ls.roughnessmap,
          Ls.metalnessmap,
          Ls.fog,
          Ls.lights, {
            emissive: {
              value: new j(0)
            },
            roughness: {
              value: .5
            },
            metalness: {
              value: .5
            },
            envMapIntensity: {
              value: 1
            }
          }
        ]),
        vertexShader: Ss.meshphysical_vert,
        fragmentShader: Ss.meshphysical_frag
      },
      points: {
        uniforms: Ms.merge([Ls.points, Ls.fog]),
        vertexShader: Ss.points_vert,
        fragmentShader: Ss.points_frag
      },
      dashed: {
        uniforms: Ms.merge([
          Ls.common,
          Ls.fog, {
            scale: {
              value: 1
            },
            dashSize: {
              value: 1
            },
            totalSize: {
              value: 2
            }
          }
        ]),
        vertexShader: Ss.linedashed_vert,
        fragmentShader: Ss.linedashed_frag
      },
      depth: {
        uniforms: Ms.merge([Ls.common, Ls.displacementmap]),
        vertexShader: Ss.depth_vert,
        fragmentShader: Ss.depth_frag
      },
      normal: {
        uniforms: Ms.merge([
          Ls.common,
          Ls.bumpmap,
          Ls.normalmap,
          Ls.displacementmap, {
            opacity: {
              value: 1
            }
          }
        ]),
        vertexShader: Ss.normal_vert,
        fragmentShader: Ss.normal_frag
      },
      cube: {
        uniforms: {
          tCube: {
            value: null
          },
          tFlip: {
            value: -1
          },
          opacity: {
            value: 1
          }
        },
        vertexShader: Ss.cube_vert,
        fragmentShader: Ss.cube_frag
      },
      equirect: {
        uniforms: {
          tEquirect: {
            value: null
          },
          tFlip: {
            value: -1
          }
        },
        vertexShader: Ss.equirect_vert,
        fragmentShader: Ss.equirect_frag
      },
      distanceRGBA: {
        uniforms: {
          lightPos: {
            value: new l
          }
        },
        vertexShader: Ss.distanceRGBA_vert,
        fragmentShader: Ss.distanceRGBA_frag
      }
    };
  Os.physical = {
    uniforms: Ms.merge([
      Os.standard.uniforms, {
        clearCoat: {
          value: 0
        },
        clearCoatRoughness: {
          value: 0
        }
      }
    ]),
    vertexShader: Ss.meshphysical_vert,
    fragmentShader: Ss.meshphysical_frag
  },
  Object.assign(X.prototype, {
    set: function(t, e) {
      return this.min.copy(t),
      this.max.copy(e),
      this
    },
    setFromPoints: function(t) {
      this.makeEmpty();
      for (var e = 0, i = t.length; e < i; e++)
        this.expandByPoint(t[e]);
      return this
    },
    setFromCenterAndSize: function() {
      var t = new i;
      return function(e, i) {
        var n = t.copy(i).multiplyScalar(.5);
        return this.min.copy(e).sub(n),
        this.max.copy(e).add(n),
        this
      }
    }(),
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.min.copy(t.min),
      this.max.copy(t.max),
      this
    },
    makeEmpty: function() {
      return this.min.x = this.min.y = 1 / 0,
      this.max.x = this.max.y = -1 / 0,
      this
    },
    isEmpty: function() {
      return this.max.x < this.min.x || this.max.y < this.min.y
    },
    getCenter: function(t) {
      var e = t || new i;
      return this.isEmpty()
        ? e.set(0, 0)
        : e.addVectors(this.min, this.max).multiplyScalar(.5)
    },
    getSize: function(t) {
      var e = t || new i;
      return this.isEmpty()
        ? e.set(0, 0)
        : e.subVectors(this.max, this.min)
    },
    expandByPoint: function(t) {
      return this.min.min(t),
      this.max.max(t),
      this
    },
    expandByVector: function(t) {
      return this.min.sub(t),
      this.max.add(t),
      this
    },
    expandByScalar: function(t) {
      return this.min.addScalar(-t),
      this.max.addScalar(t),
      this
    },
    containsPoint: function(t) {
      return !(t.x < this.min.x || t.x > this.max.x || t.y < this.min.y || t.y > this.max.y)
    },
    containsBox: function(t) {
      return this.min.x <= t.min.x && t.max.x <= this.max.x && this.min.y <= t.min.y && t.max.y <= this.max.y
    },
    getParameter: function(t, e) {
      return (e || new i).set((t.x - this.min.x) / (this.max.x - this.min.x), (t.y - this.min.y) / (this.max.y - this.min.y))
    },
    intersectsBox: function(t) {
      return !(t.max.x < this.min.x || t.min.x > this.max.x || t.max.y < this.min.y || t.min.y > this.max.y)
    },
    clampPoint: function(t, e) {
      return (e || new i).copy(t).clamp(this.min, this.max)
    },
    distanceToPoint: function() {
      var t = new i;
      return function(e) {
        return t.copy(e).clamp(this.min, this.max).sub(e).length()
      }
    }(),
    intersect: function(t) {
      return this.min.max(t.min),
      this.max.min(t.max),
      this
    },
    union: function(t) {
      return this.min.min(t.min),
      this.max.max(t.max),
      this
    },
    translate: function(t) {
      return this.min.add(t),
      this.max.add(t),
      this
    },
    equals: function(t) {
      return t.min.equals(this.min) && t.max.equals(this.max)
    }
  });
  var Ds = 0;
  Object.assign(K.prototype, e.prototype, {
    isMaterial: !0,
    setValues: function(t) {
      if (void 0 !== t)
        for (var e in t) {
          var i = t[e];
          if (void 0 !== i) {
            var n = this[e];
            void 0 !== n
              ? n && n.isColor
                ? n.set(i)
                : n && n.isVector3 && i && i.isVector3
                  ? n.copy(i)
                  : this[e] = "overdraw" === e
                    ? Number(i)
                    : i
              : console.warn("THREE." + this.type + ": '" + e + "' is not a property of this material.")
          } else
            console.warn("THREE.Material: '" + e + "' parameter is undefined.")
        }
      },
    toJSON: function(t) {
      function e(t) {
        var e = [];
        for (var i in t) {
          var n = t[i];
          delete n.metadata,
          e.push(n)
        }
        return e
      }
      var i = void 0 === t;
      i && (t = {
        textures: {},
        images: {}
      });
      var n = {
        metadata: {
          version: 4.5,
          type: "Material",
          generator: "Material.toJSON"
        }
      };
      if (n.uuid = this.uuid, n.type = this.type, "" !== this.name && (n.name = this.name), this.color && this.color.isColor && (n.color = this.color.getHex()), void 0 !== this.roughness && (n.roughness = this.roughness), void 0 !== this.metalness && (n.metalness = this.metalness), this.emissive && this.emissive.isColor && (n.emissive = this.emissive.getHex()), this.specular && this.specular.isColor && (n.specular = this.specular.getHex()), void 0 !== this.shininess && (n.shininess = this.shininess), void 0 !== this.clearCoat && (n.clearCoat = this.clearCoat), void 0 !== this.clearCoatRoughness && (n.clearCoatRoughness = this.clearCoatRoughness), this.map && this.map.isTexture && (n.map = this.map.toJSON(t).uuid), this.alphaMap && this.alphaMap.isTexture && (n.alphaMap = this.alphaMap.toJSON(t).uuid), this.lightMap && this.lightMap.isTexture && (n.lightMap = this.lightMap.toJSON(t).uuid), this.bumpMap && this.bumpMap.isTexture && (n.bumpMap = this.bumpMap.toJSON(t).uuid, n.bumpScale = this.bumpScale), this.normalMap && this.normalMap.isTexture && (n.normalMap = this.normalMap.toJSON(t).uuid, n.normalScale = this.normalScale.toArray()), this.displacementMap && this.displacementMap.isTexture && (n.displacementMap = this.displacementMap.toJSON(t).uuid, n.displacementScale = this.displacementScale, n.displacementBias = this.displacementBias), this.roughnessMap && this.roughnessMap.isTexture && (n.roughnessMap = this.roughnessMap.toJSON(t).uuid), this.metalnessMap && this.metalnessMap.isTexture && (n.metalnessMap = this.metalnessMap.toJSON(t).uuid), this.emissiveMap && this.emissiveMap.isTexture && (n.emissiveMap = this.emissiveMap.toJSON(t).uuid), this.specularMap && this.specularMap.isTexture && (n.specularMap = this.specularMap.toJSON(t).uuid), this.envMap && this.envMap.isTexture && (n.envMap = this.envMap.toJSON(t).uuid, n.reflectivity = this.reflectivity), this.gradientMap && this.gradientMap.isTexture && (n.gradientMap = this.gradientMap.toJSON(t).uuid), void 0 !== this.size && (n.size = this.size), void 0 !== this.sizeAttenuation && (n.sizeAttenuation = this.sizeAttenuation), this.blending !== Sr && (n.blending = this.blending), this.shading !== Cr && (n.shading = this.shading), this.side !== Er && (n.side = this.side), this.vertexColors !== Tr && (n.vertexColors = this.vertexColors), this.opacity < 1 && (n.opacity = this.opacity), this.transparent === !0 && (n.transparent = this.transparent), n.depthFunc = this.depthFunc, n.depthTest = this.depthTest, n.depthWrite = this.depthWrite, this.alphaTest > 0 && (n.alphaTest = this.alphaTest), this.premultipliedAlpha === !0 && (n.premultipliedAlpha = this.premultipliedAlpha), this.wireframe === !0 && (n.wireframe = this.wireframe), this.wireframeLinewidth > 1 && (n.wireframeLinewidth = this.wireframeLinewidth), "round" !== this.wireframeLinecap && (n.wireframeLinecap = this.wireframeLinecap), "round" !== this.wireframeLinejoin && (n.wireframeLinejoin = this.wireframeLinejoin), n.skinning = this.skinning, n.morphTargets = this.morphTargets, n.dithering = this.dithering, i) {
        var o = e(t.textures),
          r = e(t.images);
        o.length > 0 && (n.textures = o),
        r.length > 0 && (n.images = r)
      }
      return n
    },
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      this.name = t.name,
      this.fog = t.fog,
      this.lights = t.lights,
      this.blending = t.blending,
      this.side = t.side,
      this.shading = t.shading,
      this.vertexColors = t.vertexColors,
      this.opacity = t.opacity,
      this.transparent = t.transparent,
      this.blendSrc = t.blendSrc,
      this.blendDst = t.blendDst,
      this.blendEquation = t.blendEquation,
      this.blendSrcAlpha = t.blendSrcAlpha,
      this.blendDstAlpha = t.blendDstAlpha,
      this.blendEquationAlpha = t.blendEquationAlpha,
      this.depthFunc = t.depthFunc,
      this.depthTest = t.depthTest,
      this.depthWrite = t.depthWrite,
      this.colorWrite = t.colorWrite,
      this.precision = t.precision,
      this.polygonOffset = t.polygonOffset,
      this.polygonOffsetFactor = t.polygonOffsetFactor,
      this.polygonOffsetUnits = t.polygonOffsetUnits,
      this.dithering = t.dithering,
      this.alphaTest = t.alphaTest,
      this.premultipliedAlpha = t.premultipliedAlpha,
      this.overdraw = t.overdraw,
      this.visible = t.visible,
      this.clipShadows = t.clipShadows,
      this.clipIntersection = t.clipIntersection;
      var e = t.clippingPlanes,
        i = null;
      if (null !== e) {
        var n = e.length;
        i = new Array(n);
        for (var o = 0; o !== n; ++o)
          i[o] = e[o].clone()
      }
      return this.clippingPlanes = i,
      this
    },
    dispose: function() {
      this.dispatchEvent({type: "dispose"})
    }
  }),
  Q.prototype = Object.create(K.prototype),
  Q.prototype.constructor = Q,
  Q.prototype.isShaderMaterial = !0,
  Q.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.fragmentShader = t.fragmentShader,
    this.vertexShader = t.vertexShader,
    this.uniforms = Ms.clone(t.uniforms),
    this.defines = t.defines,
    this.wireframe = t.wireframe,
    this.wireframeLinewidth = t.wireframeLinewidth,
    this.lights = t.lights,
    this.clipping = t.clipping,
    this.skinning = t.skinning,
    this.morphTargets = t.morphTargets,
    this.morphNormals = t.morphNormals,
    this.extensions = t.extensions,
    this
  },
  Q.prototype.toJSON = function(t) {
    var e = K.prototype.toJSON.call(this, t);
    return e.uniforms = this.uniforms,
    e.vertexShader = this.vertexShader,
    e.fragmentShader = this.fragmentShader,
    e
  },
  J.prototype = Object.create(K.prototype),
  J.prototype.constructor = J,
  J.prototype.isMeshDepthMaterial = !0,
  J.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.depthPacking = t.depthPacking,
    this.skinning = t.skinning,
    this.morphTargets = t.morphTargets,
    this.map = t.map,
    this.alphaMap = t.alphaMap,
    this.displacementMap = t.displacementMap,
    this.displacementScale = t.displacementScale,
    this.displacementBias = t.displacementBias,
    this.wireframe = t.wireframe,
    this.wireframeLinewidth = t.wireframeLinewidth,
    this
  },
  Object.assign($.prototype, {
    isBox3: !0,
    set: function(t, e) {
      return this.min.copy(t),
      this.max.copy(e),
      this
    },
    setFromArray: function(t) {
      for (var e = 1 / 0, i = 1 / 0, n = 1 / 0, o = -1 / 0, r = -1 / 0, a = -1 / 0, s = 0, l = t.length; s < l; s += 3) {
        var c = t[s],
          h = t[s + 1],
          u = t[s + 2];
        c < e && (e = c),
        h < i && (i = h),
        u < n && (n = u),
        c > o && (o = c),
        h > r && (r = h),
        u > a && (a = u)
      }
      return this.min.set(e, i, n),
      this.max.set(o, r, a),
      this
    },
    setFromBufferAttribute: function(t) {
      for (var e = 1 / 0, i = 1 / 0, n = 1 / 0, o = -1 / 0, r = -1 / 0, a = -1 / 0, s = 0, l = t.count; s < l; s++) {
        var c = t.getX(s),
          h = t.getY(s),
          u = t.getZ(s);
        c < e && (e = c),
        h < i && (i = h),
        u < n && (n = u),
        c > o && (o = c),
        h > r && (r = h),
        u > a && (a = u)
      }
      return this.min.set(e, i, n),
      this.max.set(o, r, a),
      this
    },
    setFromPoints: function(t) {
      this.makeEmpty();
      for (var e = 0, i = t.length; e < i; e++)
        this.expandByPoint(t[e]);
      return this
    },
    setFromCenterAndSize: function() {
      var t = new l;
      return function(e, i) {
        var n = t.copy(i).multiplyScalar(.5);
        return this.min.copy(e).sub(n),
        this.max.copy(e).add(n),
        this
      }
    }(),
    setFromObject: function(t) {
      return this.makeEmpty(),
      this.expandByObject(t)
    },
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.min.copy(t.min),
      this.max.copy(t.max),
      this
    },
    makeEmpty: function() {
      return this.min.x = this.min.y = this.min.z = 1 / 0,
      this.max.x = this.max.y = this.max.z = -1 / 0,
      this
    },
    isEmpty: function() {
      return this.max.x < this.min.x || this.max.y < this.min.y || this.max.z < this.min.z
    },
    getCenter: function(t) {
      var e = t || new l;
      return this.isEmpty()
        ? e.set(0, 0, 0)
        : e.addVectors(this.min, this.max).multiplyScalar(.5)
    },
    getSize: function(t) {
      var e = t || new l;
      return this.isEmpty()
        ? e.set(0, 0, 0)
        : e.subVectors(this.max, this.min)
    },
    expandByPoint: function(t) {
      return this.min.min(t),
      this.max.max(t),
      this
    },
    expandByVector: function(t) {
      return this.min.sub(t),
      this.max.add(t),
      this
    },
    expandByScalar: function(t) {
      return this.min.addScalar(-t),
      this.max.addScalar(t),
      this
    },
    expandByObject: function() {
      var t = new l;
      return function(e) {
        var i = this;
        return e.updateMatrixWorld(!0),
        e.traverse(function(e) {
          var n,
            o,
            r = e.geometry;
          if (void 0 !== r)
            if (r.isGeometry) {
              var a = r.vertices;
              for (n = 0, o = a.length; n < o; n++)
                t.copy(a[n]),
                t.applyMatrix4(e.matrixWorld),
                i.expandByPoint(t)
            }
          else if (r.isBufferGeometry) {
            var s = r.attributes.position;
            if (void 0 !== s)
              for (n = 0, o = s.count; n < o; n++)
                t.fromBufferAttribute(s, n).applyMatrix4(e.matrixWorld),
                i.expandByPoint(t)
          }
        }),
        this
      }
    }(),
    containsPoint: function(t) {
      return !(t.x < this.min.x || t.x > this.max.x || t.y < this.min.y || t.y > this.max.y || t.z < this.min.z || t.z > this.max.z)
    },
    containsBox: function(t) {
      return this.min.x <= t.min.x && t.max.x <= this.max.x && this.min.y <= t.min.y && t.max.y <= this.max.y && this.min.z <= t.min.z && t.max.z <= this.max.z
    },
    getParameter: function(t, e) {
      return (e || new l).set((t.x - this.min.x) / (this.max.x - this.min.x), (t.y - this.min.y) / (this.max.y - this.min.y), (t.z - this.min.z) / (this.max.z - this.min.z))
    },
    intersectsBox: function(t) {
      return !(t.max.x < this.min.x || t.min.x > this.max.x || t.max.y < this.min.y || t.min.y > this.max.y || t.max.z < this.min.z || t.min.z > this.max.z)
    },
    intersectsSphere: function() {
      var t = new l;
      return function(e) {
        return this.clampPoint(e.center, t),
        t.distanceToSquared(e.center) <= e.radius * e.radius
      }
    }(),
    intersectsPlane: function(t) {
      var e,
        i;
      return t.normal.x > 0
        ? (e = t.normal.x * this.min.x, i = t.normal.x * this.max.x)
        : (e = t.normal.x * this.max.x, i = t.normal.x * this.min.x),
      t.normal.y > 0
        ? (e += t.normal.y * this.min.y, i += t.normal.y * this.max.y)
        : (e += t.normal.y * this.max.y, i += t.normal.y * this.min.y),
      t.normal.z > 0
        ? (e += t.normal.z * this.min.z, i += t.normal.z * this.max.z)
        : (e += t.normal.z * this.max.z, i += t.normal.z * this.min.z),
      e <= t.constant && i >= t.constant
    },
    clampPoint: function(t, e) {
      return (e || new l).copy(t).clamp(this.min, this.max)
    },
    distanceToPoint: function() {
      var t = new l;
      return function(e) {
        return t.copy(e).clamp(this.min, this.max).sub(e).length()
      }
    }(),
    getBoundingSphere: function() {
      var t = new l;
      return function(e) {
        var i = e || new tt;
        return this.getCenter(i.center),
        i.radius = .5 * this.getSize(t).length(),
        i
      }
    }(),
    intersect: function(t) {
      return this.min.max(t.min),
      this.max.min(t.max),
      this.isEmpty() && this.makeEmpty(),
      this
    },
    union: function(t) {
      return this.min.min(t.min),
      this.max.max(t.max),
      this
    },
    applyMatrix4: function() {
      var t = [
        new l,
        new l,
        new l,
        new l,
        new l,
        new l,
        new l,
        new l
      ];
      return function(e) {
        return this.isEmpty()
          ? this
          : (t[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(e), t[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(e), t[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(e), t[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(e), t[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(e), t[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(e), t[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(e), t[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(e), this.setFromPoints(t), this)
      }
    }(),
    translate: function(t) {
      return this.min.add(t),
      this.max.add(t),
      this
    },
    equals: function(t) {
      return t.min.equals(this.min) && t.max.equals(this.max)
    }
  }),
  Object.assign(tt.prototype, {
    set: function(t, e) {
      return this.center.copy(t),
      this.radius = e,
      this
    },
    setFromPoints: function() {
      var t = new $;
      return function(e, i) {
        var n = this.center;
        void 0 !== i
          ? n.copy(i)
          : t.setFromPoints(e).getCenter(n);
        for (var o = 0, r = 0, a = e.length; r < a; r++)
          o = Math.max(o, n.distanceToSquared(e[r]));
        return this.radius = Math.sqrt(o),
        this
      }
    }(),
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.center.copy(t.center),
      this.radius = t.radius,
      this
    },
    empty: function() {
      return this.radius <= 0
    },
    containsPoint: function(t) {
      return t.distanceToSquared(this.center) <= this.radius * this.radius
    },
    distanceToPoint: function(t) {
      return t.distanceTo(this.center) - this.radius
    },
    intersectsSphere: function(t) {
      var e = this.radius + t.radius;
      return t.center.distanceToSquared(this.center) <= e * e
    },
    intersectsBox: function(t) {
      return t.intersectsSphere(this)
    },
    intersectsPlane: function(t) {
      return Math.abs(this.center.dot(t.normal) - t.constant) <= this.radius
    },
    clampPoint: function(t, e) {
      var i = this.center.distanceToSquared(t),
        n = e || new l;
      return n.copy(t),
      i > this.radius * this.radius && (n.sub(this.center).normalize(), n.multiplyScalar(this.radius).add(this.center)),
      n
    },
    getBoundingBox: function(t) {
      var e = t || new $;
      return e.set(this.center, this.center),
      e.expandByScalar(this.radius),
      e
    },
    applyMatrix4: function(t) {
      return this.center.applyMatrix4(t),
      this.radius = this.radius * t.getMaxScaleOnAxis(),
      this
    },
    translate: function(t) {
      return this.center.add(t),
      this
    },
    equals: function(t) {
      return t.center.equals(this.center) && t.radius === this.radius
    }
  }),
  Object.assign(et.prototype, {
    isMatrix3: !0,
    set: function(t, e, i, n, o, r, a, s, l) {
      var c = this.elements;
      return c[0] = t,
      c[1] = n,
      c[2] = a,
      c[3] = e,
      c[4] = o,
      c[5] = s,
      c[6] = i,
      c[7] = r,
      c[8] = l,
      this
    },
    identity: function() {
      return this.set(1, 0, 0, 0, 1, 0, 0, 0, 1),
      this
    },
    clone: function() {
      return (new this.constructor).fromArray(this.elements)
    },
    copy: function(t) {
      var e = this.elements,
        i = t.elements;
      return e[0] = i[0],
      e[1] = i[1],
      e[2] = i[2],
      e[3] = i[3],
      e[4] = i[4],
      e[5] = i[5],
      e[6] = i[6],
      e[7] = i[7],
      e[8] = i[8],
      this
    },
    setFromMatrix4: function(t) {
      var e = t.elements;
      return this.set(e[0], e[4], e[8], e[1], e[5], e[9], e[2], e[6], e[10]),
      this
    },
    applyToBufferAttribute: function() {
      var t = new l;
      return function(e) {
        for (var i = 0, n = e.count; i < n; i++)
          t.x = e.getX(i),
          t.y = e.getY(i),
          t.z = e.getZ(i),
          t.applyMatrix3(this),
          e.setXYZ(i, t.x, t.y, t.z);
        return e
      }
    }(),
    multiply: function(t) {
      return this.multiplyMatrices(this, t)
    },
    premultiply: function(t) {
      return this.multiplyMatrices(t, this)
    },
    multiplyMatrices: function(t, e) {
      var i = t.elements,
        n = e.elements,
        o = this.elements,
        r = i[0],
        a = i[3],
        s = i[6],
        l = i[1],
        c = i[4],
        h = i[7],
        u = i[2],
        d = i[5],
        p = i[8],
        f = n[0],
        m = n[3],
        g = n[6],
        v = n[1],
        y = n[4],
        E = n[7],
        x = n[2],
        b = n[5],
        w = n[8];
      return o[0] = r * f + a * v + s * x,
      o[3] = r * m + a * y + s * b,
      o[6] = r * g + a * E + s * w,
      o[1] = l * f + c * v + h * x,
      o[4] = l * m + c * y + h * b,
      o[7] = l * g + c * E + h * w,
      o[2] = u * f + d * v + p * x,
      o[5] = u * m + d * y + p * b,
      o[8] = u * g + d * E + p * w,
      this
    },
    multiplyScalar: function(t) {
      var e = this.elements;
      return e[0] *= t,
      e[3] *= t,
      e[6] *= t,
      e[1] *= t,
      e[4] *= t,
      e[7] *= t,
      e[2] *= t,
      e[5] *= t,
      e[8] *= t,
      this
    },
    determinant: function() {
      var t = this.elements,
        e = t[0],
        i = t[1],
        n = t[2],
        o = t[3],
        r = t[4],
        a = t[5],
        s = t[6],
        l = t[7],
        c = t[8];
      return e * r * c - e * a * l - i * o * c + i * a * s + n * o * l - n * r * s
    },
    getInverse: function(t, e) {
      t && t.isMatrix4 && console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");
      var i = t.elements,
        n = this.elements,
        o = i[0],
        r = i[1],
        a = i[2],
        s = i[3],
        l = i[4],
        c = i[5],
        h = i[6],
        u = i[7],
        d = i[8],
        p = d * l - c * u,
        f = c * h - d * s,
        m = u * s - l * h,
        g = o * p + r * f + a * m;
      if (0 === g) {
        var v = "THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";
        if (e === !0)
          throw new Error(v);
        return console.warn(v),
        this.identity()
      }
      var y = 1 / g;
      return n[0] = p * y,
      n[1] = (a * u - d * r) * y,
      n[2] = (c * r - a * l) * y,
      n[3] = f * y,
      n[4] = (d * o - a * h) * y,
      n[5] = (a * s - c * o) * y,
      n[6] = m * y,
      n[7] = (r * h - u * o) * y,
      n[8] = (l * o - r * s) * y,
      this
    },
    transpose: function() {
      var t,
        e = this.elements;
      return t = e[1],
      e[1] = e[3],
      e[3] = t,
      t = e[2],
      e[2] = e[6],
      e[6] = t,
      t = e[5],
      e[5] = e[7],
      e[7] = t,
      this
    },
    getNormalMatrix: function(t) {
      return this.setFromMatrix4(t).getInverse(this).transpose()
    },
    transposeIntoArray: function(t) {
      var e = this.elements;
      return t[0] = e[0],
      t[1] = e[3],
      t[2] = e[6],
      t[3] = e[1],
      t[4] = e[4],
      t[5] = e[7],
      t[6] = e[2],
      t[7] = e[5],
      t[8] = e[8],
      this
    },
    equals: function(t) {
      for (var e = this.elements, i = t.elements, n = 0; n < 9; n++)
        if (e[n] !== i[n])
          return !1;
    return !0
    },
    fromArray: function(t, e) {
      void 0 === e && (e = 0);
      for (var i = 0; i < 9; i++)
        this.elements[i] = t[i + e];
      return this
    },
    toArray: function(t, e) {
      void 0 === t && (t = []),
      void 0 === e && (e = 0);
      var i = this.elements;
      return t[e] = i[0],
      t[e + 1] = i[1],
      t[e + 2] = i[2],
      t[e + 3] = i[3],
      t[e + 4] = i[4],
      t[e + 5] = i[5],
      t[e + 6] = i[6],
      t[e + 7] = i[7],
      t[e + 8] = i[8],
      t
    }
  }),
  Object.assign(it.prototype, {
    set: function(t, e) {
      return this.normal.copy(t),
      this.constant = e,
      this
    },
    setComponents: function(t, e, i, n) {
      return this.normal.set(t, e, i),
      this.constant = n,
      this
    },
    setFromNormalAndCoplanarPoint: function(t, e) {
      return this.normal.copy(t),
      this.constant = -e.dot(this.normal),
      this
    },
    setFromCoplanarPoints: function() {
      var t = new l,
        e = new l;
      return function(i, n, o) {
        var r = t.subVectors(o, n).cross(e.subVectors(i, n)).normalize();
        return this.setFromNormalAndCoplanarPoint(r, i),
        this
      }
    }(),
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.normal.copy(t.normal),
      this.constant = t.constant,
      this
    },
    normalize: function() {
      var t = 1 / this.normal.length();
      return this.normal.multiplyScalar(t),
      this.constant *= t,
      this
    },
    negate: function() {
      return this.constant *= -1,
      this.normal.negate(),
      this
    },
    distanceToPoint: function(t) {
      return this.normal.dot(t) + this.constant
    },
    distanceToSphere: function(t) {
      return this.distanceToPoint(t.center) - t.radius
    },
    projectPoint: function(t, e) {
      return this.orthoPoint(t, e).sub(t).negate()
    },
    orthoPoint: function(t, e) {
      var i = this.distanceToPoint(t);
      return (e || new l).copy(this.normal).multiplyScalar(i)
    },
    intersectLine: function() {
      var t = new l;
      return function(e, i) {
        var n = i || new l,
          o = e.delta(t),
          r = this.normal.dot(o);
        if (0 !== r) {
          var a = -(e.start.dot(this.normal) + this.constant) / r;
          if (!(a < 0 || a > 1))
            return n.copy(o).multiplyScalar(a).add(e.start)
        } else if (0 === this.distanceToPoint(e.start))
          return n.copy(e.start)
      }
    }(),
    intersectsLine: function(t) {
      var e = this.distanceToPoint(t.start),
        i = this.distanceToPoint(t.end);
      return e < 0 && i > 0 || i < 0 && e > 0
    },
    intersectsBox: function(t) {
      return t.intersectsPlane(this)
    },
    intersectsSphere: function(t) {
      return t.intersectsPlane(this)
    },
    coplanarPoint: function(t) {
      return (t || new l).copy(this.normal).multiplyScalar(-this.constant)
    },
    applyMatrix4: function() {
      var t = new l,
        e = new et;
      return function(i, n) {
        var o = this.coplanarPoint(t).applyMatrix4(i),
          r = n || e.getNormalMatrix(i),
          a = this.normal.applyMatrix3(r).normalize();
        return this.constant = -o.dot(a),
        this
      }
    }(),
    translate: function(t) {
      return this.constant = this.constant - t.dot(this.normal),
      this
    },
    equals: function(t) {
      return t.normal.equals(this.normal) && t.constant === this.constant
    }
  }),
  Object.assign(nt.prototype, {
    set: function(t, e, i, n, o, r) {
      var a = this.planes;
      return a[0].copy(t),
      a[1].copy(e),
      a[2].copy(i),
      a[3].copy(n),
      a[4].copy(o),
      a[5].copy(r),
      this
    },
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      for (var e = this.planes, i = 0; i < 6; i++)
        e[i].copy(t.planes[i]);
      return this
    },
    setFromMatrix: function(t) {
      var e = this.planes,
        i = t.elements,
        n = i[0],
        o = i[1],
        r = i[2],
        a = i[3],
        s = i[4],
        l = i[5],
        c = i[6],
        h = i[7],
        u = i[8],
        d = i[9],
        p = i[10],
        f = i[11],
        m = i[12],
        g = i[13],
        v = i[14],
        y = i[15];
      return e[0].setComponents(a - n, h - s, f - u, y - m).normalize(),
      e[1].setComponents(a + n, h + s, f + u, y + m).normalize(),
      e[2].setComponents(a + o, h + l, f + d, y + g).normalize(),
      e[3].setComponents(a - o, h - l, f - d, y - g).normalize(),
      e[4].setComponents(a - r, h - c, f - p, y - v).normalize(),
      e[5].setComponents(a + r, h + c, f + p, y + v).normalize(),
      this
    },
    intersectsObject: function() {
      var t = new tt;
      return function(e) {
        var i = e.geometry;
        return null === i.boundingSphere && i.computeBoundingSphere(),
        t.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),
        this.intersectsSphere(t)
      }
    }(),
    intersectsSprite: function() {
      var t = new tt;
      return function(e) {
        return t.center.set(0, 0, 0),
        t.radius = .7071067811865476,
        t.applyMatrix4(e.matrixWorld),
        this.intersectsSphere(t)
      }
    }(),
    intersectsSphere: function(t) {
      for (var e = this.planes, i = t.center, n = -t.radius, o = 0; o < 6; o++) {
        if (e[o].distanceToPoint(i) < n)
          return !1
      }
      return !0
    },
    intersectsBox: function() {
      var t = new l,
        e = new l;
      return function(i) {
        for (var n = this.planes, o = 0; o < 6; o++) {
          var r = n[o];
          t.x = r.normal.x > 0
            ? i.min.x
            : i.max.x,
          e.x = r.normal.x > 0
            ? i.max.x
            : i.min.x,
          t.y = r.normal.y > 0
            ? i.min.y
            : i.max.y,
          e.y = r.normal.y > 0
            ? i.max.y
            : i.min.y,
          t.z = r.normal.z > 0
            ? i.min.z
            : i.max.z,
          e.z = r.normal.z > 0
            ? i.max.z
            : i.min.z;
          var a = r.distanceToPoint(t),
            s = r.distanceToPoint(e);
          if (a < 0 && s < 0)
            return !1
        }
        return !0
      }
    }(),
    containsPoint: function(t) {
      for (var e = this.planes, i = 0; i < 6; i++)
        if (e[i].distanceToPoint(t) < 0)
          return !1;
    return !0
    }
  }),
  Object.assign(rt.prototype, {
    set: function(t, e) {
      return this.origin.copy(t),
      this.direction.copy(e),
      this
    },
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.origin.copy(t.origin),
      this.direction.copy(t.direction),
      this
    },
    at: function(t, e) {
      return (e || new l).copy(this.direction).multiplyScalar(t).add(this.origin)
    },
    lookAt: function(t) {
      return this.direction.copy(t).sub(this.origin).normalize(),
      this
    },
    recast: function() {
      var t = new l;
      return function(e) {
        return this.origin.copy(this.at(e, t)),
        this
      }
    }(),
    closestPointToPoint: function(t, e) {
      var i = e || new l;
      i.subVectors(t, this.origin);
      var n = i.dot(this.direction);
      return n < 0
        ? i.copy(this.origin)
        : i.copy(this.direction).multiplyScalar(n).add(this.origin)
    },
    distanceToPoint: function(t) {
      return Math.sqrt(this.distanceSqToPoint(t))
    },
    distanceSqToPoint: function() {
      var t = new l;
      return function(e) {
        var i = t.subVectors(e, this.origin).dot(this.direction);
        return i < 0
          ? this.origin.distanceToSquared(e)
          : (t.copy(this.direction).multiplyScalar(i).add(this.origin), t.distanceToSquared(e))
      }
    }(),
    distanceSqToSegment: function() {
      var t = new l,
        e = new l,
        i = new l;
      return function(n, o, r, a) {
        t.copy(n).add(o).multiplyScalar(.5),
        e.copy(o).sub(n).normalize(),
        i.copy(this.origin).sub(t);
        var s,
          l,
          c,
          h,
          u = .5 * n.distanceTo(o),
          d = -this.direction.dot(e),
          p = i.dot(this.direction),
          f = -i.dot(e),
          m = i.lengthSq(),
          g = Math.abs(1 - d * d);
        if (g > 0)
          if (s = d * f - p, l = d * p - f, h = u * g, s >= 0)
            if (l >= -h)
              if (l <= h) {
                var v = 1 / g;
                s *= v,
                l *= v,
                c = s * (s + d * l + 2 * p) + l * (d * s + l + 2 * f) + m
              }
            else
          l = u,
          s = Math.max(0, -(d * l + p)),
          c = -s * s + l * (l + 2 * f) + m;
        else
          l = -u,
          s = Math.max(0, -(d * l + p)),
          c = -s * s + l * (l + 2 * f) + m;
        else
          l <= -h
            ? (
              s = Math.max(0, -(-d * u + p)), l = s > 0
              ? -u
              : Math.min(Math.max(-u, -f), u),
            c = -s * s + l * (l + 2 * f) + m)
            : l <= h
              ? (s = 0, l = Math.min(Math.max(-u, -f), u), c = l * (l + 2 * f) + m)
              : (
                s = Math.max(0, -(d * u + p)), l = s > 0
                ? u
                : Math.min(Math.max(-u, -f), u),
              c = -s * s + l * (l + 2 * f) + m);
        else
          l = d > 0
            ? -u
            : u,
          s = Math.max(0, -(d * l + p)),
          c = -s * s + l * (l + 2 * f) + m;
        return r && r.copy(this.direction).multiplyScalar(s).add(this.origin),
        a && a.copy(e).multiplyScalar(l).add(t),
        c
      }
    }(),
    intersectSphere: function() {
      var t = new l;
      return function(e, i) {
        t.subVectors(e.center, this.origin);
        var n = t.dot(this.direction),
          o = t.dot(t) - n * n,
          r = e.radius * e.radius;
        if (o > r)
          return null;
        var a = Math.sqrt(r - o),
          s = n - a,
          l = n + a;
        return s < 0 && l < 0
          ? null
          : s < 0
            ? this.at(l, i)
            : this.at(s, i)
      }
    }(),
    intersectsSphere: function(t) {
      return this.distanceToPoint(t.center) <= t.radius
    },
    distanceToPlane: function(t) {
      var e = t.normal.dot(this.direction);
      if (0 === e)
        return 0 === t.distanceToPoint(this.origin)
          ? 0
          : null;
      var i = -(this.origin.dot(t.normal) + t.constant) / e;
      return i >= 0
        ? i
        : null
    },
    intersectPlane: function(t, e) {
      var i = this.distanceToPlane(t);
      return null === i
        ? null
        : this.at(i, e)
    },
    intersectsPlane: function(t) {
      var e = t.distanceToPoint(this.origin);
      return 0 === e || t.normal.dot(this.direction) * e < 0
    },
    intersectBox: function(t, e) {
      var i,
        n,
        o,
        r,
        a,
        s,
        l = 1 / this.direction.x,
        c = 1 / this.direction.y,
        h = 1 / this.direction.z,
        u = this.origin;
      return l >= 0
        ? (i = (t.min.x - u.x) * l, n = (t.max.x - u.x) * l)
        : (i = (t.max.x - u.x) * l, n = (t.min.x - u.x) * l),
      c >= 0
        ? (o = (t.min.y - u.y) * c, r = (t.max.y - u.y) * c)
        : (o = (t.max.y - u.y) * c, r = (t.min.y - u.y) * c),
      i > r || o > n
        ? null
        : (
          (o > i || i !== i) && (i = o), (r < n || n !== n) && (n = r), h >= 0
          ? (a = (t.min.z - u.z) * h, s = (t.max.z - u.z) * h)
          : (a = (t.max.z - u.z) * h, s = (t.min.z - u.z) * h),
        i > s || a > n
          ? null
          : (
            (a > i || i !== i) && (i = a), (s < n || n !== n) && (n = s), n < 0
            ? null
            : this.at(
              i >= 0
              ? i
              : n,
            e)))
    },
    intersectsBox: function() {
      var t = new l;
      return function(e) {
        return null !== this.intersectBox(e, t)
      }
    }(),
    intersectTriangle: function() {
      var t = new l,
        e = new l,
        i = new l,
        n = new l;
      return function(o, r, a, s, l) {
        e.subVectors(r, o),
        i.subVectors(a, o),
        n.crossVectors(e, i);
        var c,
          h = this.direction.dot(n);
        if (h > 0) {
          if (s)
            return null;
          c = 1
        } else {
          if (!(h < 0))
            return null;
          c = -1,
          h = -h
        }
        t.subVectors(this.origin, o);
        var u = c * this.direction.dot(i.crossVectors(t, i));
        if (u < 0)
          return null;
        var d = c * this.direction.dot(e.cross(t));
        if (d < 0)
          return null;
        if (u + d > h)
          return null;
        var p = -c * t.dot(n);
        return p < 0
          ? null
          : this.at(p / h, l)
      }
    }(),
    applyMatrix4: function(t) {
      return this.direction.add(this.origin).applyMatrix4(t),
      this.origin.applyMatrix4(t),
      this.direction.sub(this.origin),
      this.direction.normalize(),
      this
    },
    equals: function(t) {
      return t.origin.equals(this.origin) && t.direction.equals(this.direction)
    }
  }),
  at.RotationOrders = [
    "XYZ",
    "YZX",
    "ZXY",
    "XZY",
    "YXZ",
    "ZYX"
  ],
  at.DefaultOrder = "XYZ",
  Object.defineProperties(at.prototype, {
    x: {
      get: function() {
        return this._x
      },
      set: function(t) {
        this._x = t,
        this.onChangeCallback()
      }
    },
    y: {
      get: function() {
        return this._y
      },
      set: function(t) {
        this._y = t,
        this.onChangeCallback()
      }
    },
    z: {
      get: function() {
        return this._z
      },
      set: function(t) {
        this._z = t,
        this.onChangeCallback()
      }
    },
    order: {
      get: function() {
        return this._order
      },
      set: function(t) {
        this._order = t,
        this.onChangeCallback()
      }
    }
  }),
  Object.assign(at.prototype, {
    isEuler: !0,
    set: function(t, e, i, n) {
      return this._x = t,
      this._y = e,
      this._z = i,
      this._order = n || this._order,
      this.onChangeCallback(),
      this
    },
    clone: function() {
      return new this.constructor(this._x, this._y, this._z, this._order)
    },
    copy: function(t) {
      return this._x = t._x,
      this._y = t._y,
      this._z = t._z,
      this._order = t._order,
      this.onChangeCallback(),
      this
    },
    setFromRotationMatrix: function(t, e, i) {
      var n = gs.clamp,
        o = t.elements,
        r = o[0],
        a = o[4],
        s = o[8],
        l = o[1],
        c = o[5],
        h = o[9],
        u = o[2],
        d = o[6],
        p = o[10];
      return e = e || this._order,
      "XYZ" === e
        ? (
          this._y = Math.asin(n(s, -1, 1)), Math.abs(s) < .99999
          ? (this._x = Math.atan2(-h, p), this._z = Math.atan2(-a, r))
          : (this._x = Math.atan2(d, c), this._z = 0))
        : "YXZ" === e
          ? (
            this._x = Math.asin(-n(h, -1, 1)), Math.abs(h) < .99999
            ? (this._y = Math.atan2(s, p), this._z = Math.atan2(l, c))
            : (this._y = Math.atan2(-u, r), this._z = 0))
          : "ZXY" === e
            ? (
              this._x = Math.asin(n(d, -1, 1)), Math.abs(d) < .99999
              ? (this._y = Math.atan2(-u, p), this._z = Math.atan2(-a, c))
              : (this._y = 0, this._z = Math.atan2(l, r)))
            : "ZYX" === e
              ? (
                this._y = Math.asin(-n(u, -1, 1)), Math.abs(u) < .99999
                ? (this._x = Math.atan2(d, p), this._z = Math.atan2(l, r))
                : (this._x = 0, this._z = Math.atan2(-a, c)))
              : "YZX" === e
                ? (
                  this._z = Math.asin(n(l, -1, 1)), Math.abs(l) < .99999
                  ? (this._x = Math.atan2(-h, c), this._y = Math.atan2(-u, r))
                  : (this._x = 0, this._y = Math.atan2(s, p)))
                : "XZY" === e
                  ? (
                    this._z = Math.asin(-n(a, -1, 1)), Math.abs(a) < .99999
                    ? (this._x = Math.atan2(d, c), this._y = Math.atan2(s, r))
                    : (this._x = Math.atan2(-h, p), this._y = 0))
                  : console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: " + e),
      this._order = e,
      i !== !1 && this.onChangeCallback(),
      this
    },
    setFromQuaternion: function() {
      var t = new c;
      return function(e, i, n) {
        return t.makeRotationFromQuaternion(e),
        this.setFromRotationMatrix(t, i, n)
      }
    }(),
    setFromVector3: function(t, e) {
      return this.set(t.x, t.y, t.z, e || this._order)
    },
    reorder: function() {
      var t = new s;
      return function(e) {
        return t.setFromEuler(this),
        this.setFromQuaternion(t, e)
      }
    }(),
    equals: function(t) {
      return t._x === this._x && t._y === this._y && t._z === this._z && t._order === this._order
    },
    fromArray: function(t) {
      return this._x = t[0],
      this._y = t[1],
      this._z = t[2],
      void 0 !== t[3] && (this._order = t[3]),
      this.onChangeCallback(),
      this
    },
    toArray: function(t, e) {
      return void 0 === t && (t = []),
      void 0 === e && (e = 0),
      t[e] = this._x,
      t[e + 1] = this._y,
      t[e + 2] = this._z,
      t[e + 3] = this._order,
      t
    },
    toVector3: function(t) {
      return t
        ? t.set(this._x, this._y, this._z)
        : new l(this._x, this._y, this._z)
    },
    onChange: function(t) {
      return this.onChangeCallback = t,
      this
    },
    onChangeCallback: function() {}
  }),
  Object.assign(st.prototype, {
    set: function(t) {
      this.mask = 1 << t | 0
    },
    enable: function(t) {
      this.mask |= 1 << t | 0
    },
    toggle: function(t) {
      this.mask ^= 1 << t | 0
    },
    disable: function(t) {
      this.mask &=~ (1 << t | 0)
    },
    test: function(t) {
      return 0 != (this.mask & t.mask)
    }
  });
  var Rs = 0;
  lt.DefaultUp = new l(0, 1, 0),
  lt.DefaultMatrixAutoUpdate = !0,
  Object.assign(lt.prototype, e.prototype, {
    isObject3D: !0,
    applyMatrix: function(t) {
      this.matrix.multiplyMatrices(t, this.matrix),
      this.matrix.decompose(this.position, this.quaternion, this.scale)
    },
    setRotationFromAxisAngle: function(t, e) {
      this.quaternion.setFromAxisAngle(t, e)
    },
    setRotationFromEuler: function(t) {
      this.quaternion.setFromEuler(t, !0)
    },
    setRotationFromMatrix: function(t) {
      this.quaternion.setFromRotationMatrix(t)
    },
    setRotationFromQuaternion: function(t) {
      this.quaternion.copy(t)
    },
    rotateOnAxis: function() {
      var t = new s;
      return function(e, i) {
        return t.setFromAxisAngle(e, i),
        this.quaternion.multiply(t),
        this
      }
    }(),
    rotateX: function() {
      var t = new l(1, 0, 0);
      return function(e) {
        return this.rotateOnAxis(t, e)
      }
    }(),
    rotateY: function() {
      var t = new l(0, 1, 0);
      return function(e) {
        return this.rotateOnAxis(t, e)
      }
    }(),
    rotateZ: function() {
      var t = new l(0, 0, 1);
      return function(e) {
        return this.rotateOnAxis(t, e)
      }
    }(),
    translateOnAxis: function() {
      var t = new l;
      return function(e, i) {
        return t.copy(e).applyQuaternion(this.quaternion),
        this.position.add(t.multiplyScalar(i)),
        this
      }
    }(),
    translateX: function() {
      var t = new l(1, 0, 0);
      return function(e) {
        return this.translateOnAxis(t, e)
      }
    }(),
    translateY: function() {
      var t = new l(0, 1, 0);
      return function(e) {
        return this.translateOnAxis(t, e)
      }
    }(),
    translateZ: function() {
      var t = new l(0, 0, 1);
      return function(e) {
        return this.translateOnAxis(t, e)
      }
    }(),
    localToWorld: function(t) {
      return t.applyMatrix4(this.matrixWorld)
    },
    worldToLocal: function() {
      var t = new c;
      return function(e) {
        return e.applyMatrix4(t.getInverse(this.matrixWorld))
      }
    }(),
    lookAt: function() {
      var t = new c;
      return function(e) {
        this.isCamera
          ? t.lookAt(this.position, e, this.up)
          : t.lookAt(e, this.position, this.up),
        this.quaternion.setFromRotationMatrix(t)
      }
    }(),
    add: function(t) {
      if (arguments.length > 1) {
        for (var e = 0; e < arguments.length; e++)
          this.add(arguments[e]);
        return this
      }
      return t === this
        ? (console.error("THREE.Object3D.add: object can't be added as a child of itself.", t), this)
        : (
          t && t.isObject3D
          ? (null !== t.parent && t.parent.remove(t), t.parent = this, t.dispatchEvent({type: "added"}), this.children.push(t))
          : console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.", t),
        this)
    },
    remove: function(t) {
      if (arguments.length > 1)
        for (var e = 0; e < arguments.length; e++)
          this.remove(arguments[e]);
    var i = this.children.indexOf(t);
      i !== -1 && (t.parent = null, t.dispatchEvent({type: "removed"}), this.children.splice(i, 1))
    },
    getObjectById: function(t) {
      return this.getObjectByProperty("id", t)
    },
    getObjectByName: function(t) {
      return this.getObjectByProperty("name", t)
    },
    getObjectByProperty: function(t, e) {
      if (this[t] === e)
        return this;
      for (var i = 0, n = this.children.length; i < n; i++) {
        var o = this.children[i],
          r = o.getObjectByProperty(t, e);
        if (void 0 !== r)
          return r
      }
    },
    getWorldPosition: function(t) {
      var e = t || new l;
      return this.updateMatrixWorld(!0),
      e.setFromMatrixPosition(this.matrixWorld)
    },
    getWorldQuaternion: function() {
      var t = new l,
        e = new l;
      return function(i) {
        var n = i || new s;
        return this.updateMatrixWorld(!0),
        this.matrixWorld.decompose(t, n, e),
        n
      }
    }(),
    getWorldRotation: function() {
      var t = new s;
      return function(e) {
        var i = e || new at;
        return this.getWorldQuaternion(t),
        i.setFromQuaternion(t, this.rotation.order, !1)
      }
    }(),
    getWorldScale: function() {
      var t = new l,
        e = new s;
      return function(i) {
        var n = i || new l;
        return this.updateMatrixWorld(!0),
        this.matrixWorld.decompose(t, e, n),
        n
      }
    }(),
    getWorldDirection: function() {
      var t = new s;
      return function(e) {
        var i = e || new l;
        return this.getWorldQuaternion(t),
        i.set(0, 0, 1).applyQuaternion(t)
      }
    }(),
    raycast: function() {},
    traverse: function(t) {
      t(this);
      for (var e = this.children, i = 0, n = e.length; i < n; i++)
        e[i].traverse(t)
    },
    traverseVisible: function(t) {
      if (this.visible !== !1) {
        t(this);
        for (var e = this.children, i = 0, n = e.length; i < n; i++)
          e[i].traverseVisible(t)
      }
    },
    traverseAncestors: function(t) {
      var e = this.parent;
      null !== e && (t(e), e.traverseAncestors(t))
    },
    updateMatrix: function() {
      this.matrix.compose(this.position, this.quaternion, this.scale),
      this.matrixWorldNeedsUpdate = !0
    },
    updateMatrixWorld: function(t) {
      this.matrixAutoUpdate && this.updateMatrix(),
      (this.matrixWorldNeedsUpdate || t) && (
        null === this.parent
        ? this.matrixWorld.copy(this.matrix)
        : this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix),
      this.matrixWorldNeedsUpdate = !1,
      t = !0);
      for (var e = this.children, i = 0, n = e.length; i < n; i++)
        e[i].updateMatrixWorld(t)
    },
    toJSON: function(t) {
      function e(e, i) {
        return void 0 === e[i.uuid] && (e[i.uuid] = i.toJSON(t)),
        i.uuid
      }
      function i(t) {
        var e = [];
        for (var i in t) {
          var n = t[i];
          delete n.metadata,
          e.push(n)
        }
        return e
      }
      var n = void 0 === t || "" === t,
        o = {};
      n && (t = {
        geometries: {},
        materials: {},
        textures: {},
        images: {}
      }, o.metadata = {
        version: 4.5,
        type: "Object",
        generator: "Object3D.toJSON"
      });
      var r = {};
      if (r.uuid = this.uuid, r.type = this.type, "" !== this.name && (r.name = this.name), "{}" !== JSON.stringify(this.userData) && (r.userData = this.userData), this.castShadow === !0 && (r.castShadow = !0), this.receiveShadow === !0 && (r.receiveShadow = !0), this.visible === !1 && (r.visible = !1), r.matrix = this.matrix.toArray(), void 0 !== this.geometry && (r.geometry = e(t.geometries, this.geometry)), void 0 !== this.material)
        if (Array.isArray(this.material)) {
          for (var a = [], s = 0, l = this.material.length; s < l; s++)
            a.push(e(t.materials, this.material[s]));
          r.material = a
        } else
          r.material = e(t.materials, this.material);
    if (this.children.length > 0) {
        r.children = [];
        for (var s = 0; s < this.children.length; s++)
          r.children.push(this.children[s].toJSON(t).object)
      }
      if (n) {
        var c = i(t.geometries),
          h = i(t.materials),
          u = i(t.textures),
          d = i(t.images);
        c.length > 0 && (o.geometries = c),
        h.length > 0 && (o.materials = h),
        u.length > 0 && (o.textures = u),
        d.length > 0 && (o.images = d)
      }
      return o.object = r,
      o
    },
    clone: function(t) {
      return (new this.constructor).copy(this, t)
    },
    copy: function(t, e) {
      if (void 0 === e && (e = !0), this.name = t.name, this.up.copy(t.up), this.position.copy(t.position), this.quaternion.copy(t.quaternion), this.scale.copy(t.scale), this.matrix.copy(t.matrix), this.matrixWorld.copy(t.matrixWorld), this.matrixAutoUpdate = t.matrixAutoUpdate, this.matrixWorldNeedsUpdate = t.matrixWorldNeedsUpdate, this.layers.mask = t.layers.mask, this.visible = t.visible, this.castShadow = t.castShadow, this.receiveShadow = t.receiveShadow, this.frustumCulled = t.frustumCulled, this.renderOrder = t.renderOrder, this.userData = JSON.parse(JSON.stringify(t.userData)), e === !0)
        for (var i = 0; i < t.children.length; i++) {
          var n = t.children[i];
          this.add(n.clone())
        }
      return this
    }
  }),
  Object.assign(ct.prototype, {
    set: function(t, e) {
      return this.start.copy(t),
      this.end.copy(e),
      this
    },
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.start.copy(t.start),
      this.end.copy(t.end),
      this
    },
    getCenter: function(t) {
      return (t || new l).addVectors(this.start, this.end).multiplyScalar(.5)
    },
    delta: function(t) {
      return (t || new l).subVectors(this.end, this.start)
    },
    distanceSq: function() {
      return this.start.distanceToSquared(this.end)
    },
    distance: function() {
      return this.start.distanceTo(this.end)
    },
    at: function(t, e) {
      var i = e || new l;
      return this.delta(i).multiplyScalar(t).add(this.start)
    },
    closestPointToPointParameter: function() {
      var t = new l,
        e = new l;
      return function(i, n) {
        t.subVectors(i, this.start),
        e.subVectors(this.end, this.start);
        var o = e.dot(e),
          r = e.dot(t),
          a = r / o;
        return n && (a = gs.clamp(a, 0, 1)),
        a
      }
    }(),
    closestPointToPoint: function(t, e, i) {
      var n = this.closestPointToPointParameter(t, e),
        o = i || new l;
      return this.delta(o).multiplyScalar(n).add(this.start)
    },
    applyMatrix4: function(t) {
      return this.start.applyMatrix4(t),
      this.end.applyMatrix4(t),
      this
    },
    equals: function(t) {
      return t.start.equals(this.start) && t.end.equals(this.end)
    }
  }),
  Object.assign(ht, {
    normal: function() {
      var t = new l;
      return function(e, i, n, o) {
        var r = o || new l;
        r.subVectors(n, i),
        t.subVectors(e, i),
        r.cross(t);
        var a = r.lengthSq();
        return a > 0
          ? r.multiplyScalar(1 / Math.sqrt(a))
          : r.set(0, 0, 0)
      }
    }(),
    barycoordFromPoint: function() {
      var t = new l,
        e = new l,
        i = new l;
      return function(n, o, r, a, s) {
        t.subVectors(a, o),
        e.subVectors(r, o),
        i.subVectors(n, o);
        var c = t.dot(t),
          h = t.dot(e),
          u = t.dot(i),
          d = e.dot(e),
          p = e.dot(i),
          f = c * d - h * h,
          m = s || new l;
        if (0 === f)
          return m.set(-2, -1, -1);
        var g = 1 / f,
          v = (d * u - h * p) * g,
          y = (c * p - h * u) * g;
        return m.set(1 - v - y, y, v)
      }
    }(),
    containsPoint: function() {
      var t = new l;
      return function(e, i, n, o) {
        var r = ht.barycoordFromPoint(e, i, n, o, t);
        return r.x >= 0 && r.y >= 0 && r.x + r.y <= 1
      }
    }()
  }),
  Object.assign(ht.prototype, {
    set: function(t, e, i) {
      return this.a.copy(t),
      this.b.copy(e),
      this.c.copy(i),
      this
    },
    setFromPointsAndIndices: function(t, e, i, n) {
      return this.a.copy(t[e]),
      this.b.copy(t[i]),
      this.c.copy(t[n]),
      this
    },
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      return this.a.copy(t.a),
      this.b.copy(t.b),
      this.c.copy(t.c),
      this
    },
    area: function() {
      var t = new l,
        e = new l;
      return function() {
        return t.subVectors(this.c, this.b),
        e.subVectors(this.a, this.b),
        .5 * t.cross(e).length()
      }
    }(),
    midpoint: function(t) {
      return (t || new l).addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3)
    },
    normal: function(t) {
      return ht.normal(this.a, this.b, this.c, t)
    },
    plane: function(t) {
      return (t || new it).setFromCoplanarPoints(this.a, this.b, this.c)
    },
    barycoordFromPoint: function(t, e) {
      return ht.barycoordFromPoint(t, this.a, this.b, this.c, e)
    },
    containsPoint: function(t) {
      return ht.containsPoint(t, this.a, this.b, this.c)
    },
    closestPointToPoint: function() {
      var t = new it,
        e = [
          new ct, new ct, new ct
        ],
        i = new l,
        n = new l;
      return function(o, r) {
        var a = r || new l,
          s = 1 / 0;
        if (t.setFromCoplanarPoints(this.a, this.b, this.c), t.projectPoint(o, i), this.containsPoint(i) === !0)
          a.copy(i);
        else {
          e[0].set(this.a, this.b),
          e[1].set(this.b, this.c),
          e[2].set(this.c, this.a);
          for (var c = 0; c < e.length; c++) {
            e[c].closestPointToPoint(i, !0, n);
            var h = i.distanceToSquared(n);
            h < s && (s = h, a.copy(n))
          }
        }
        return a
      }
    }(),
    equals: function(t) {
      return t.a.equals(this.a) && t.b.equals(this.b) && t.c.equals(this.c)
    }
  }),
  Object.assign(ut.prototype, {
    clone: function() {
      return (new this.constructor).copy(this)
    },
    copy: function(t) {
      this.a = t.a,
      this.b = t.b,
      this.c = t.c,
      this.normal.copy(t.normal),
      this.color.copy(t.color),
      this.materialIndex = t.materialIndex;
      for (var e = 0, i = t.vertexNormals.length; e < i; e++)
        this.vertexNormals[e] = t.vertexNormals[e].clone();
      for (var e = 0, i = t.vertexColors.length; e < i; e++)
        this.vertexColors[e] = t.vertexColors[e].clone();
      return this
    }
  }),
  dt.prototype = Object.create(K.prototype),
  dt.prototype.constructor = dt,
  dt.prototype.isMeshBasicMaterial = !0,
  dt.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.color.copy(t.color),
    this.map = t.map,
    this.lightMap = t.lightMap,
    this.lightMapIntensity = t.lightMapIntensity,
    this.aoMap = t.aoMap,
    this.aoMapIntensity = t.aoMapIntensity,
    this.specularMap = t.specularMap,
    this.alphaMap = t.alphaMap,
    this.envMap = t.envMap,
    this.combine = t.combine,
    this.reflectivity = t.reflectivity,
    this.refractionRatio = t.refractionRatio,
    this.wireframe = t.wireframe,
    this.wireframeLinewidth = t.wireframeLinewidth,
    this.wireframeLinecap = t.wireframeLinecap,
    this.wireframeLinejoin = t.wireframeLinejoin,
    this.skinning = t.skinning,
    this.morphTargets = t.morphTargets,
    this
  },
  Object.defineProperty(pt.prototype, "needsUpdate", {
    set: function(t) {
      t === !0 && this.version++
    }
  }),
  Object.assign(pt.prototype, {
    isBufferAttribute: !0,
    setArray: function(t) {
      if (Array.isArray(t))
        throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");
      this.count = void 0 !== t
        ? t.length / this.itemSize
        : 0,
      this.array = t
    },
    setDynamic: function(t) {
      return this.dynamic = t,
      this
    },
    copy: function(t) {
      return this.array = new t.array.constructor(t.array),
      this.itemSize = t.itemSize,
      this.count = t.count,
      this.normalized = t.normalized,
      this.dynamic = t.dynamic,
      this
    },
    copyAt: function(t, e, i) {
      t *= this.itemSize,
      i *= e.itemSize;
      for (var n = 0, o = this.itemSize; n < o; n++)
        this.array[t + n] = e.array[i + n];
      return this
    },
    copyArray: function(t) {
      return this.array.set(t),
      this
    },
    copyColorsArray: function(t) {
      for (var e = this.array, i = 0, n = 0, o = t.length; n < o; n++) {
        var r = t[n];
        void 0 === r && (console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined", n), r = new j),
        e[i++] = r.r,
        e[i++] = r.g,
        e[i++] = r.b
      }
      return this
    },
    copyIndicesArray: function(t) {
      for (var e = this.array, i = 0, n = 0, o = t.length; n < o; n++) {
        var r = t[n];
        e[i++] = r.a,
        e[i++] = r.b,
        e[i++] = r.c
      }
      return this
    },
    copyVector2sArray: function(t) {
      for (var e = this.array, n = 0, o = 0, r = t.length; o < r; o++) {
        var a = t[o];
        void 0 === a && (console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined", o), a = new i),
        e[n++] = a.x,
        e[n++] = a.y
      }
      return this
    },
    copyVector3sArray: function(t) {
      for (var e = this.array, i = 0, n = 0, o = t.length; n < o; n++) {
        var r = t[n];
        void 0 === r && (console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined", n), r = new l),
        e[i++] = r.x,
        e[i++] = r.y,
        e[i++] = r.z
      }
      return this
    },
    copyVector4sArray: function(t) {
      for (var e = this.array, i = 0, n = 0, r = t.length; n < r; n++) {
        var a = t[n];
        void 0 === a && (console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined", n), a = new o),
        e[i++] = a.x,
        e[i++] = a.y,
        e[i++] = a.z,
        e[i++] = a.w
      }
      return this
    },
    set: function(t, e) {
      return void 0 === e && (e = 0),
      this.array.set(t, e),
      this
    },
    getX: function(t) {
      return this.array[t * this.itemSize]
    },
    setX: function(t, e) {
      return this.array[t * this.itemSize] = e,
      this
    },
    getY: function(t) {
      return this.array[t * this.itemSize + 1]
    },
    setY: function(t, e) {
      return this.array[t * this.itemSize + 1] = e,
      this
    },
    getZ: function(t) {
      return this.array[t * this.itemSize + 2]
    },
    setZ: function(t, e) {
      return this.array[t * this.itemSize + 2] = e,
      this
    },
    getW: function(t) {
      return this.array[t * this.itemSize + 3]
    },
    setW: function(t, e) {
      return this.array[t * this.itemSize + 3] = e,
      this
    },
    setXY: function(t, e, i) {
      return t *= this.itemSize,
      this.array[t + 0] = e,
      this.array[t + 1] = i,
      this
    },
    setXYZ: function(t, e, i, n) {
      return t *= this.itemSize,
      this.array[t + 0] = e,
      this.array[t + 1] = i,
      this.array[t + 2] = n,
      this
    },
    setXYZW: function(t, e, i, n, o) {
      return t *= this.itemSize,
      this.array[t + 0] = e,
      this.array[t + 1] = i,
      this.array[t + 2] = n,
      this.array[t + 3] = o,
      this
    },
    onUpload: function(t) {
      return this.onUploadCallback = t,
      this
    },
    clone: function() {
      return new this.constructor(this.array, this.itemSize).copy(this)
    }
  }),
  ft.prototype = Object.create(pt.prototype),
  ft.prototype.constructor = ft,
  mt.prototype = Object.create(pt.prototype),
  mt.prototype.constructor = mt,
  gt.prototype = Object.create(pt.prototype),
  gt.prototype.constructor = gt,
  vt.prototype = Object.create(pt.prototype),
  vt.prototype.constructor = vt,
  yt.prototype = Object.create(pt.prototype),
  yt.prototype.constructor = yt,
  Et.prototype = Object.create(pt.prototype),
  Et.prototype.constructor = Et,
  xt.prototype = Object.create(pt.prototype),
  xt.prototype.constructor = xt,
  bt.prototype = Object.create(pt.prototype),
  bt.prototype.constructor = bt,
  wt.prototype = Object.create(pt.prototype),
  wt.prototype.constructor = wt,
  Object.assign(Ct.prototype, {
    computeGroups: function(t) {
      for (var e, i = [], n = void 0, o = t.faces, r = 0; r < o.length; r++) {
        var a = o[r];
        a.materialIndex !== n && (n = a.materialIndex, void 0 !== e && (e.count = 3 * r - e.start, i.push(e)), e = {
          start: 3 *r,
          materialIndex: n
        })
      }
      void 0 !== e && (e.count = 3 * r - e.start, i.push(e)),
      this.groups = i
    },
    fromGeometry: function(t) {
      var e,
        n = t.faces,
        o = t.vertices,
        r = t.faceVertexUvs,
        a = r[0] && r[0].length > 0,
        s = r[1] && r[1].length > 0,
        l = t.morphTargets,
        c = l.length;
      if (c > 0) {
        e = [];
        for (var h = 0; h < c; h++)
          e[h] = [];
        this.morphTargets.position = e
      }
      var u,
        d = t.morphNormals,
        p = d.length;
      if (p > 0) {
        u = [];
        for (var h = 0; h < p; h++)
          u[h] = [];
        this.morphTargets.normal = u
      }
      for (var f = t.skinIndices, m = t.skinWeights, g = f.length === o.length, v = m.length === o.length, h = 0; h < n.length; h++) {
        var y = n[h];
        this.vertices.push(o[y.a], o[y.b], o[y.c]);
        var E = y.vertexNormals;
        if (3 === E.length)
          this.normals.push(E[0], E[1], E[2]);
        else {
          var x = y.normal;
          this.normals.push(x, x, x)
        }
        var b = y.vertexColors;
        if (3 === b.length)
          this.colors.push(b[0], b[1], b[2]);
        else {
          var w = y.color;
          this.colors.push(w, w, w)
        }
        if (a === !0) {
          var C = r[0][h];
          void 0 !== C
            ? this.uvs.push(C[0], C[1], C[2])
            : (console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ", h), this.uvs.push(new i, new i, new i))
        }
        if (s === !0) {
          var C = r[1][h];
          void 0 !== C
            ? this.uvs2.push(C[0], C[1], C[2])
            : (console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ", h), this.uvs2.push(new i, new i, new i))
        }
        for (var T = 0; T < c; T++) {
          var _ = l[T].vertices;
          e[T].push(_[y.a], _[y.b], _[y.c])
        }
        for (var T = 0; T < p; T++) {
          var L = d[T].vertexNormals[h];
          u[T].push(L.a, L.b, L.c)
        }
        g && this.skinIndices.push(f[y.a], f[y.b], f[y.c]),
        v && this.skinWeights.push(m[y.a], m[y.b], m[y.c])
      }
      return this.computeGroups(t),
      this.verticesNeedUpdate = t.verticesNeedUpdate,
      this.normalsNeedUpdate = t.normalsNeedUpdate,
      this.colorsNeedUpdate = t.colorsNeedUpdate,
      this.uvsNeedUpdate = t.uvsNeedUpdate,
      this.groupsNeedUpdate = t.groupsNeedUpdate,
      this
    }
  });
  var Us = 0;
  Object.assign(Lt.prototype, e.prototype, {
    isGeometry: !0,
    applyMatrix: function(t) {
      for (var e = (new et).getNormalMatrix(t), i = 0, n = this.vertices.length; i < n; i++) {
        this.vertices[i].applyMatrix4(t)
      }
      for (var i = 0, n = this.faces.length; i < n; i++) {
        var o = this.faces[i];
        o.normal.applyMatrix3(e).normalize();
        for (var r = 0, a = o.vertexNormals.length; r < a; r++)
          o.vertexNormals[r].applyMatrix3(e).normalize()
      }
      return null !== this.boundingBox && this.computeBoundingBox(),
      null !== this.boundingSphere && this.computeBoundingSphere(),
      this.verticesNeedUpdate = !0,
      this.normalsNeedUpdate = !0,
      this
    },
    rotateX: function() {
      var t = new c;
      return function(e) {
        return t.makeRotationX(e),
        this.applyMatrix(t),
        this
      }
    }(),
    rotateY: function() {
      var t = new c;
      return function(e) {
        return t.makeRotationY(e),
        this.applyMatrix(t),
        this
      }
    }(),
    rotateZ: function() {
      var t = new c;
      return function(e) {
        return t.makeRotationZ(e),
        this.applyMatrix(t),
        this
      }
    }(),
    translate: function() {
      var t = new c;
      return function(e, i, n) {
        return t.makeTranslation(e, i, n),
        this.applyMatrix(t),
        this
      }
    }(),
    scale: function() {
      var t = new c;
      return function(e, i, n) {
        return t.makeScale(e, i, n),
        this.applyMatrix(t),
        this
      }
    }(),
    lookAt: function() {
      var t = new lt;
      return function(e) {
        t.lookAt(e),
        t.updateMatrix(),
        this.applyMatrix(t.matrix)
      }
    }(),
    fromBufferGeometry: function(t) {
      function e(t, e, i, o) {
        var r = void 0 !== s
            ? [
              d[t].clone(),
              d[e].clone(),
              d[i].clone()
            ]
            : [],
          a = void 0 !== c
            ? [
              n.colors[t].clone(),
              n.colors[e].clone(),
              n.colors[i].clone()
            ]
            : [],
          l = new ut(t, e, i, r, a, o);
        n.faces.push(l),
        void 0 !== h && n.faceVertexUvs[0].push([
          p[t].clone(),
          p[e].clone(),
          p[i].clone()
        ]),
        void 0 !== u && n.faceVertexUvs[1].push([
          f[t].clone(),
          f[e].clone(),
          f[i].clone()
        ])
      }
      var n = this,
        o = null !== t.index
          ? t.index.array
          : void 0,
        r = t.attributes,
        a = r.position.array,
        s = void 0 !== r.normal
          ? r.normal.array
          : void 0,
        c = void 0 !== r.color
          ? r.color.array
          : void 0,
        h = void 0 !== r.uv
          ? r.uv.array
          : void 0,
        u = void 0 !== r.uv2
          ? r.uv2.array
          : void 0;
      void 0 !== u && (this.faceVertexUvs[1] = []);
      for (var d = [], p = [], f = [], m = 0, g = 0; m < a.length; m += 3, g += 2)
        n.vertices.push(new l(a[m], a[m + 1], a[m + 2])),
        void 0 !== s && d.push(new l(s[m], s[m + 1], s[m + 2])),
        void 0 !== c && n.colors.push(new j(c[m], c[m + 1], c[m + 2])),
        void 0 !== h && p.push(new i(h[g], h[g + 1])),
        void 0 !== u && f.push(new i(u[g], u[g + 1]));
      var v = t.groups;
      if (v.length > 0)
        for (var m = 0; m < v.length; m++)
          for (var y = v[m], E = y.start, x = y.count, g = E, b = E + x; g < b; g += 3)
            void 0 !== o
              ? e(o[g], o[g + 1], o[g + 2], y.materialIndex)
              : e(g, g + 1, g + 2, y.materialIndex);
        else if (void 0 !== o)
          for (var m = 0; m < o.length; m += 3)
            e(o[m], o[m + 1], o[m + 2]);
    else
        for (var m = 0; m < a.length / 3; m += 3)
          e(m, m + 1, m + 2);
    return this.computeFaceNormals(),
      null !== t.boundingBox && (this.boundingBox = t.boundingBox.clone()),
      null !== t.boundingSphere && (this.boundingSphere = t.boundingSphere.clone()),
      this
    },
    center: function() {
      this.computeBoundingBox();
      var t = this.boundingBox.getCenter().negate();
      return this.translate(t.x, t.y, t.z),
      t
    },
    normalize: function() {
      this.computeBoundingSphere();
      var t = this.boundingSphere.center,
        e = this.boundingSphere.radius,
        i = 0 === e
          ? 1
          : 1 / e,
        n = new c;
      return n.set(i, 0, 0, -i * t.x, 0, i, 0, -i * t.y, 0, 0, i, -i * t.z, 0, 0, 0, 1),
      this.applyMatrix(n),
      this
    },
    computeFaceNormals: function() {
      for (var t = new l, e = new l, i = 0, n = this.faces.length; i < n; i++) {
        var o = this.faces[i],
          r = this.vertices[o.a],
          a = this.vertices[o.b],
          s = this.vertices[o.c];
        t.subVectors(s, a),
        e.subVectors(r, a),
        t.cross(e),
        t.normalize(),
        o.normal.copy(t)
      }
    },
    computeVertexNormals: function(t) {
      void 0 === t && (t = !0);
      var e,
        i,
        n,
        o,
        r,
        a;
      for (a = new Array(this.vertices.length), e = 0, i = this.vertices.length; e < i; e++)
        a[e] = new l;
      if (t) {
        var s,
          c,
          h,
          u = new l,
          d = new l;
        for (n = 0, o = this.faces.length; n < o; n++)
          r = this.faces[n],
          s = this.vertices[r.a],
          c = this.vertices[r.b],
          h = this.vertices[r.c],
          u.subVectors(h, c),
          d.subVectors(s, c),
          u.cross(d),
          a[r.a].add(u),
          a[r.b].add(u),
          a[r.c].add(u)
      } else
        for (this.computeFaceNormals(), n = 0, o = this.faces.length; n < o; n++)
          r = this.faces[n],
          a[r.a].add(r.normal),
          a[r.b].add(r.normal),
          a[r.c].add(r.normal);
    for (e = 0, i = this.vertices.length; e < i; e++)
        a[e].normalize();
      for (n = 0, o = this.faces.length; n < o; n++) {
        r = this.faces[n];
        var p = r.vertexNormals;
        3 === p.length
          ? (p[0].copy(a[r.a]), p[1].copy(a[r.b]), p[2].copy(a[r.c]))
          : (p[0] = a[r.a].clone(), p[1] = a[r.b].clone(), p[2] = a[r.c].clone())
      }
      this.faces.length > 0 && (this.normalsNeedUpdate = !0)
    },
    computeFlatVertexNormals: function() {
      var t,
        e,
        i;
      for (this.computeFaceNormals(), t = 0, e = this.faces.length; t < e; t++) {
        i = this.faces[t];
        var n = i.vertexNormals;
        3 === n.length
          ? (n[0].copy(i.normal), n[1].copy(i.normal), n[2].copy(i.normal))
          : (n[0] = i.normal.clone(), n[1] = i.normal.clone(), n[2] = i.normal.clone())
      }
      this.faces.length > 0 && (this.normalsNeedUpdate = !0)
    },
    computeMorphNormals: function() {
      var t,
        e,
        i,
        n,
        o;
      for (i = 0, n = this.faces.length; i < n; i++)
        for (
          o = this.faces[i], o.__originalFaceNormal
          ? o.__originalFaceNormal.copy(o.normal)
          : o.__originalFaceNormal = o.normal.clone(),
        o.__originalVertexNormals || (o.__originalVertexNormals = []),
        t = 0,
        e = o.vertexNormals.length; t < e; t++)
          o.__originalVertexNormals[t]
            ? o.__originalVertexNormals[t].copy(o.vertexNormals[t])
            : o.__originalVertexNormals[t] = o.vertexNormals[t].clone();
      var r = new Lt;
      for (r.faces = this.faces, t = 0, e = this.morphTargets.length; t < e; t++) {
        if (!this.morphNormals[t]) {
          this.morphNormals[t] = {},
          this.morphNormals[t].faceNormals = [],
          this.morphNormals[t].vertexNormals = [];
          var a,
            s,
            c = this.morphNormals[t].faceNormals,
            h = this.morphNormals[t].vertexNormals;
          for (i = 0, n = this.faces.length; i < n; i++)
            a = new l,
            s = {
              a: new l,
              b: new l,
              c: new l
            }
          ,
          c.push(a),
          h.push(s)
        }
        var u = this.morphNormals[t];
        r.vertices = this.morphTargets[t].vertices,
        r.computeFaceNormals(),
        r.computeVertexNormals();
        var a,
          s;
        for (i = 0, n = this.faces.length; i < n; i++)
          o = this.faces[i],
          a = u.faceNormals[i],
          s = u.vertexNormals[i],
          a.copy(o.normal),
          s.a.copy(o.vertexNormals[0]),
          s.b.copy(o.vertexNormals[1]),
          s.c.copy(o.vertexNormals[2])
      }
      for (i = 0, n = this.faces.length; i < n; i++)
        o = this.faces[i],
        o.normal = o.__originalFaceNormal,
        o.vertexNormals = o.__originalVertexNormals
    },
    computeLineDistances: function() {
      for (var t = 0, e = this.vertices, i = 0, n = e.length; i < n; i++)
        i > 0 && (t += e[i].distanceTo(e[i - 1])),
        this.lineDistances[i] = t
    },
    computeBoundingBox: function() {
      null === this.boundingBox && (this.boundingBox = new $),
      this.boundingBox.setFromPoints(this.vertices)
    },
    computeBoundingSphere: function() {
      null === this.boundingSphere && (this.boundingSphere = new tt),
      this.boundingSphere.setFromPoints(this.vertices)
    },
    merge: function(t, e, i) {
      if ((t && t.isGeometry) === !1)
        return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.", t);
      var n,
        o = this.vertices.length,
        r = this.vertices,
        a = t.vertices,
        s = this.faces,
        l = t.faces,
        c = this.faceVertexUvs[0],
        h = t.faceVertexUvs[0],
        u = this.colors,
        d = t.colors;
      void 0 === i && (i = 0),
      void 0 !== e && (n = (new et).getNormalMatrix(e));
      for (var p = 0, f = a.length; p < f; p++) {
        var m = a[p],
          g = m.clone();
        void 0 !== e && g.applyMatrix4(e),
        r.push(g)
      }
      for (var p = 0, f = d.length; p < f; p++)
        u.push(d[p].clone());
      for (p = 0, f = l.length; p < f; p++) {
        var v,
          y,
          E,
          x = l[p],
          b = x.vertexNormals,
          w = x.vertexColors;
        v = new ut(x.a + o, x.b + o, x.c + o),
        v.normal.copy(x.normal),
        void 0 !== n && v.normal.applyMatrix3(n).normalize();
        for (var C = 0, T = b.length; C < T; C++)
          y = b[C].clone(),
          void 0 !== n && y.applyMatrix3(n).normalize(),
          v.vertexNormals.push(y);
        v.color.copy(x.color);
        for (var C = 0, T = w.length; C < T; C++)
          E = w[C],
          v.vertexColors.push(E.clone());
        v.materialIndex = x.materialIndex + i,
        s.push(v)
      }
      for (p = 0, f = h.length; p < f; p++) {
        var _ = h[p],
          L = [];
        if (void 0 !== _) {
          for (var C = 0, T = _.length; C < T; C++)
            L.push(_[C].clone());
          c.push(L)
        }
      }
    },
    mergeMesh: function(t) {
      if ((t && t.isMesh) === !1)
        return void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.", t);
      t.matrixAutoUpdate && t.updateMatrix(),
      this.merge(t.geometry, t.matrix)
    },
    mergeVertices: function() {
      var t,
        e,
        i,
        n,
        o,
        r,
        a,
        s,
        l = {},
        c = [],
        h = [],
        u = Math.pow(10, 4);
      for (i = 0, n = this.vertices.length; i < n; i++)
        t = this.vertices[i],
        e = Math.round(t.x * u) + "_" + Math.round(t.y * u) + "_" + Math.round(t.z * u),
        void 0 === l[e]
          ? (l[e] = i, c.push(this.vertices[i]), h[i] = c.length - 1)
          : h[i] = h[l[e]];
      var d = [];
      for (i = 0, n = this.faces.length; i < n; i++) {
        o = this.faces[i],
        o.a = h[o.a],
        o.b = h[o.b],
        o.c = h[o.c],
        r = [o.a, o.b, o.c];
        for (var p = 0; p < 3; p++)
          if (r[p] === r[(p + 1) % 3]) {
            d.push(i);
            break
          }
        }
      for (i = d.length - 1; i >= 0; i--) {
        var f = d[i];
        for (this.faces.splice(f, 1), a = 0, s = this.faceVertexUvs.length; a < s; a++)
          this.faceVertexUvs[a].splice(f, 1)
      }
      var m = this.vertices.length - c.length;
      return this.vertices = c,
      m
    },
    sortFacesByMaterialIndex: function() {
      function t(t, e) {
        return t.materialIndex - e.materialIndex
      }
      for (var e = this.faces, i = e.length, n = 0; n < i; n++)
        e[n]._id = n;
      e.sort(t);
      var o,
        r,
        a = this.faceVertexUvs[0],
        s = this.faceVertexUvs[1];
      a && a.length === i && (o = []),
      s && s.length === i && (r = []);
      for (var n = 0; n < i; n++) {
        var l = e[n]._id;
        o && o.push(a[l]),
        r && r.push(s[l])
      }
      o && (this.faceVertexUvs[0] = o),
      r && (this.faceVertexUvs[1] = r)
    },
    toJSON: function() {
      function t(t, e, i) {
        return i
          ? t | 1 << e
          : t &~ (1 << e)
      }
      function e(t) {
        var e = t.x.toString() + t.y.toString() + t.z.toString();
        return void 0 !== d[e]
          ? d[e]
          : (d[e] = u.length / 3, u.push(t.x, t.y, t.z), d[e])
      }
      function i(t) {
        var e = t.r.toString() + t.g.toString() + t.b.toString();
        return void 0 !== f[e]
          ? f[e]
          : (f[e] = p.length, p.push(t.getHex()), f[e])
      }
      function n(t) {
        var e = t.x.toString() + t.y.toString();
        return void 0 !== g[e]
          ? g[e]
          : (g[e] = m.length / 2, m.push(t.x, t.y), g[e])
      }
      var o = {
        metadata: {
          version: 4.5,
          type: "Geometry",
          generator: "Geometry.toJSON"
        }
      };
      if (o.uuid = this.uuid, o.type = this.type, "" !== this.name && (o.name = this.name), void 0 !== this.parameters) {
        var r = this.parameters;
        for (var a in r)
          void 0 !== r[a] && (o[a] = r[a]);
        return o
      }
      for (var s = [], l = 0; l < this.vertices.length; l++) {
        var c = this.vertices[l];
        s.push(c.x, c.y, c.z)
      }
      for (var h = [], u = [], d = {}, p = [], f = {}, m = [], g = {}, l = 0; l < this.faces.length; l++) {
        var v = this.faces[l],
          y = void 0 !== this.faceVertexUvs[0][l],
          E = v.normal.length() > 0,
          x = v.vertexNormals.length > 0,
          b = 1 !== v.color.r || 1 !== v.color.g || 1 !== v.color.b,
          w = v.vertexColors.length > 0,
          C = 0;
        if (C = t(C, 0, 0), C = t(C, 1, !0), C = t(C, 2, !1), C = t(C, 3, y), C = t(C, 4, E), C = t(C, 5, x), C = t(C, 6, b), C = t(C, 7, w), h.push(C), h.push(v.a, v.b, v.c), h.push(v.materialIndex), y) {
          var T = this.faceVertexUvs[0][l];
          h.push(n(T[0]), n(T[1]), n(T[2]))
        }
        if (E && h.push(e(v.normal)), x) {
          var _ = v.vertexNormals;
          h.push(e(_[0]), e(_[1]), e(_[2]))
        }
        if (b && h.push(i(v.color)), w) {
          var L = v.vertexColors;
          h.push(i(L[0]), i(L[1]), i(L[2]))
        }
      }
      return o.data = {},
      o.data.vertices = s,
      o.data.normals = u,
      p.length > 0 && (o.data.colors = p),
      m.length > 0 && (o.data.uvs = [m]),
      o.data.faces = h,
      o
    },
    clone: function() {
      return (new Lt).copy(this)
    },
    copy: function(t) {
      var e,
        i,
        n,
        o,
        r,
        a;
      this.vertices = [],
      this.colors = [],
      this.faces = [],
      this.faceVertexUvs = [
        []
      ],
      this.morphTargets = [],
      this.morphNormals = [],
      this.skinWeights = [],
      this.skinIndices = [],
      this.lineDistances = [],
      this.boundingBox = null,
      this.boundingSphere = null,
      this.name = t.name;
      var s = t.vertices;
      for (e = 0, i = s.length; e < i; e++)
        this.vertices.push(s[e].clone());
      var l = t.colors;
      for (e = 0, i = l.length; e < i; e++)
        this.colors.push(l[e].clone());
      var c = t.faces;
      for (e = 0, i = c.length; e < i; e++)
        this.faces.push(c[e].clone());
      for (e = 0, i = t.faceVertexUvs.length; e < i; e++) {
        var h = t.faceVertexUvs[e];
        for (void 0 === this.faceVertexUvs[e] && (this.faceVertexUvs[e] = []), n = 0, o = h.length; n < o; n++) {
          var u = h[n],
            d = [];
          for (r = 0, a = u.length; r < a; r++) {
            var p = u[r];
            d.push(p.clone())
          }
          this.faceVertexUvs[e].push(d)
        }
      }
      var f = t.morphTargets;
      for (e = 0, i = f.length; e < i; e++) {
        var m = {};
        if (m.name = f[e].name, void 0 !== f[e].vertices)
          for (m.vertices = [], n = 0, o = f[e].vertices.length; n < o; n++)
            m.vertices.push(f[e].vertices[n].clone());
      if (void 0 !== f[e].normals)
          for (m.normals = [], n = 0, o = f[e].normals.length; n < o; n++)
            m.normals.push(f[e].normals[n].clone());
      this.morphTargets.push(m)
      }
      var g = t.morphNormals;
      for (e = 0, i = g.length; e < i; e++) {
        var v = {};
        if (void 0 !== g[e].vertexNormals)
          for (v.vertexNormals = [], n = 0, o = g[e].vertexNormals.length; n < o; n++) {
            var y = g[e].vertexNormals[n],
              E = {};
            E.a = y.a.clone(),
            E.b = y.b.clone(),
            E.c = y.c.clone(),
            v.vertexNormals.push(E)
          }
        if (void 0 !== g[e].faceNormals)
          for (v.faceNormals = [], n = 0, o = g[e].faceNormals.length; n < o; n++)
            v.faceNormals.push(g[e].faceNormals[n].clone());
      this.morphNormals.push(v)
      }
      var x = t.skinWeights;
      for (e = 0, i = x.length; e < i; e++)
        this.skinWeights.push(x[e].clone());
      var b = t.skinIndices;
      for (e = 0, i = b.length; e < i; e++)
        this.skinIndices.push(b[e].clone());
      var w = t.lineDistances;
      for (e = 0, i = w.length; e < i; e++)
        this.lineDistances.push(w[e]);
      var C = t.boundingBox;
      null !== C && (this.boundingBox = C.clone());
      var T = t.boundingSphere;
      return null !== T && (this.boundingSphere = T.clone()),
      this.elementsNeedUpdate = t.elementsNeedUpdate,
      this.verticesNeedUpdate = t.verticesNeedUpdate,
      this.uvsNeedUpdate = t.uvsNeedUpdate,
      this.normalsNeedUpdate = t.normalsNeedUpdate,
      this.colorsNeedUpdate = t.colorsNeedUpdate,
      this.lineDistancesNeedUpdate = t.lineDistancesNeedUpdate,
      this.groupsNeedUpdate = t.groupsNeedUpdate,
      this
    },
    dispose: function() {
      this.dispatchEvent({type: "dispose"})
    }
  }),
  Mt.MaxIndex = 65535,
  Object.assign(Mt.prototype, e.prototype, {
    isBufferGeometry: !0,
    getIndex: function() {
      return this.index
    },
    setIndex: function(t) {
      Array.isArray(t)
        ? this.index = new(
          Tt(t) > 65535
          ? xt
          : yt)(t, 1)
        : this.index = t
    },
    addAttribute: function(t, e) {
      return (e && e.isBufferAttribute) === !1 && (e && e.isInterleavedBufferAttribute) === !1
        ? (console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."), void this.addAttribute(t, new pt(arguments[1], arguments[2])))
        : "index" === t
          ? (console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."), void this.setIndex(e))
          : (this.attributes[t] = e, this)
    },
    getAttribute: function(t) {
      return this.attributes[t]
    },
    removeAttribute: function(t) {
      return delete this.attributes[t],
      this
    },
    addGroup: function(t, e, i) {
      this.groups.push({
        start: t,
        count: e,
        materialIndex: void 0 !== i
          ? i
          : 0
      })
    },
    clearGroups: function() {
      this.groups = []
    },
    setDrawRange: function(t, e) {
      this.drawRange.start = t,
      this.drawRange.count = e
    },
    applyMatrix: function(t) {
      var e = this.attributes.position;
      void 0 !== e && (t.applyToBufferAttribute(e), e.needsUpdate = !0);
      var i = this.attributes.normal;
      if (void 0 !== i) {
        (new et).getNormalMatrix(t).applyToBufferAttribute(i),
        i.needsUpdate = !0
      }
      return null !== this.boundingBox && this.computeBoundingBox(),
      null !== this.boundingSphere && this.computeBoundingSphere(),
      this
    },
    rotateX: function() {
      var t = new c;
      return function(e) {
        return t.makeRotationX(e),
        this.applyMatrix(t),
        this
      }
    }(),
    rotateY: function() {
      var t = new c;
      return function(e) {
        return t.makeRotationY(e),
        this.applyMatrix(t),
        this
      }
    }(),
    rotateZ: function() {
      var t = new c;
      return function(e) {
        return t.makeRotationZ(e),
        this.applyMatrix(t),
        this
      }
    }(),
    translate: function() {
      var t = new c;
      return function(e, i, n) {
        return t.makeTranslation(e, i, n),
        this.applyMatrix(t),
        this
      }
    }(),
    scale: function() {
      var t = new c;
      return function(e, i, n) {
        return t.makeScale(e, i, n),
        this.applyMatrix(t),
        this
      }
    }(),
    lookAt: function() {
      var t = new lt;
      return function(e) {
        t.lookAt(e),
        t.updateMatrix(),
        this.applyMatrix(t.matrix)
      }
    }(),
    center: function() {
      this.computeBoundingBox();
      var t = this.boundingBox.getCenter().negate();
      return this.translate(t.x, t.y, t.z),
      t
    },
    setFromObject: function(t) {
      var e = t.geometry;
      if (t.isPoints || t.isLine) {
        var i = new bt(3 * e.vertices.length, 3),
          n = new bt(3 * e.colors.length, 3);
        if (this.addAttribute("position", i.copyVector3sArray(e.vertices)), this.addAttribute("color", n.copyColorsArray(e.colors)), e.lineDistances && e.lineDistances.length === e.vertices.length) {
          var o = new bt(e.lineDistances.length, 1);
          this.addAttribute("lineDistance", o.copyArray(e.lineDistances))
        }
        null !== e.boundingSphere && (this.boundingSphere = e.boundingSphere.clone()),
        null !== e.boundingBox && (this.boundingBox = e.boundingBox.clone())
      } else
        t.isMesh && e && e.isGeometry && this.fromGeometry(e);
      return this
    },
    updateFromObject: function(t) {
      var e = t.geometry;
      if (t.isMesh) {
        var i = e.__directGeometry;
        if (e.elementsNeedUpdate === !0 && (i = void 0, e.elementsNeedUpdate = !1), void 0 === i)
          return this.fromGeometry(e);
        i.verticesNeedUpdate = e.verticesNeedUpdate,
        i.normalsNeedUpdate = e.normalsNeedUpdate,
        i.colorsNeedUpdate = e.colorsNeedUpdate,
        i.uvsNeedUpdate = e.uvsNeedUpdate,
        i.groupsNeedUpdate = e.groupsNeedUpdate,
        e.verticesNeedUpdate = !1,
        e.normalsNeedUpdate = !1,
        e.colorsNeedUpdate = !1,
        e.uvsNeedUpdate = !1,
        e.groupsNeedUpdate = !1,
        e = i
      }
      var n;
      return e.verticesNeedUpdate === !0 && (n = this.attributes.position, void 0 !== n && (n.copyVector3sArray(e.vertices), n.needsUpdate = !0), e.verticesNeedUpdate = !1),
      e.normalsNeedUpdate === !0 && (n = this.attributes.normal, void 0 !== n && (n.copyVector3sArray(e.normals), n.needsUpdate = !0), e.normalsNeedUpdate = !1),
      e.colorsNeedUpdate === !0 && (n = this.attributes.color, void 0 !== n && (n.copyColorsArray(e.colors), n.needsUpdate = !0), e.colorsNeedUpdate = !1),
      e.uvsNeedUpdate && (n = this.attributes.uv, void 0 !== n && (n.copyVector2sArray(e.uvs), n.needsUpdate = !0), e.uvsNeedUpdate = !1),
      e.lineDistancesNeedUpdate && (n = this.attributes.lineDistance, void 0 !== n && (n.copyArray(e.lineDistances), n.needsUpdate = !0), e.lineDistancesNeedUpdate = !1),
      e.groupsNeedUpdate && (e.computeGroups(t.geometry), this.groups = e.groups, e.groupsNeedUpdate = !1),
      this
    },
    fromGeometry: function(t) {
      return t.__directGeometry = (new Ct).fromGeometry(t),
      this.fromDirectGeometry(t.__directGeometry)
    },
    fromDirectGeometry: function(t) {
      var e = new Float32Array(3 * t.vertices.length);
      if (this.addAttribute("position", new pt(e, 3).copyVector3sArray(t.vertices)), t.normals.length > 0) {
        var i = new Float32Array(3 * t.normals.length);
        this.addAttribute("normal", new pt(i, 3).copyVector3sArray(t.normals))
      }
      if (t.colors.length > 0) {
        var n = new Float32Array(3 * t.colors.length);
        this.addAttribute("color", new pt(n, 3).copyColorsArray(t.colors))
      }
      if (t.uvs.length > 0) {
        var o = new Float32Array(2 * t.uvs.length);
        this.addAttribute("uv", new pt(o, 2).copyVector2sArray(t.uvs))
      }
      if (t.uvs2.length > 0) {
        var r = new Float32Array(2 * t.uvs2.length);
        this.addAttribute("uv2", new pt(r, 2).copyVector2sArray(t.uvs2))
      }
      if (t.indices.length > 0) {
        var a = Tt(t.indices) > 65535
            ? Uint32Array
            : Uint16Array,
          s = new a(3 * t.indices.length);
        this.setIndex(new pt(s, 1).copyIndicesArray(t.indices))
      }
      this.groups = t.groups;
      for (var l in t.morphTargets) {
        for (var c = [], h = t.morphTargets[l], u = 0, d = h.length; u < d; u++) {
          var p = h[u],
            f = new bt(3 * p.length, 3);
          c.push(f.copyVector3sArray(p))
        }
        this.morphAttributes[l] = c
      }
      if (t.skinIndices.length > 0) {
        var m = new bt(4 * t.skinIndices.length, 4);
        this.addAttribute("skinIndex", m.copyVector4sArray(t.skinIndices))
      }
      if (t.skinWeights.length > 0) {
        var g = new bt(4 * t.skinWeights.length, 4);
        this.addAttribute("skinWeight", g.copyVector4sArray(t.skinWeights))
      }
      return null !== t.boundingSphere && (this.boundingSphere = t.boundingSphere.clone()),
      null !== t.boundingBox && (this.boundingBox = t.boundingBox.clone()),
      this
    },
    computeBoundingBox: function() {
      null === this.boundingBox && (this.boundingBox = new $);
      var t = this.attributes.position;
      void 0 !== t
        ? this.boundingBox.setFromBufferAttribute(t)
        : this.boundingBox.makeEmpty(),
      (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) && console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.', this)
    },
    computeBoundingSphere: function() {
      var t = new $,
        e = new l;
      return function() {
        null === this.boundingSphere && (this.boundingSphere = new tt);
        var i = this.attributes.position;
        if (i) {
          var n = this.boundingSphere.center;
          t.setFromBufferAttribute(i),
          t.getCenter(n);
          for (var o = 0, r = 0, a = i.count; r < a; r++)
            e.x = i.getX(r),
            e.y = i.getY(r),
            e.z = i.getZ(r),
            o = Math.max(o, n.distanceToSquared(e));
          this.boundingSphere.radius = Math.sqrt(o),
          isNaN(this.boundingSphere.radius) && console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.', this)
        }
      }
    }(),
    computeFaceNormals: function() {},
    computeVertexNormals: function() {
      var t = this.index,
        e = this.attributes,
        i = this.groups;
      if (e.position) {
        var n = e.position.array;
        if (void 0 === e.normal)
          this.addAttribute("normal", new pt(new Float32Array(n.length), 3));
        else
          for (var o = e.normal.array, r = 0, a = o.length; r < a; r++)
            o[r] = 0;
      var s,
          c,
          h,
          u = e.normal.array,
          d = new l,
          p = new l,
          f = new l,
          m = new l,
          g = new l;
        if (t) {
          var v = t.array;
          0 === i.length && this.addGroup(0, v.length);
          for (var y = 0, E = i.length; y < E; ++y)
            for (var x = i[y], b = x.start, w = x.count, r = b, a = b + w; r < a; r += 3)
              s = 3 * v[r + 0],
              c = 3 * v[r + 1],
              h = 3 * v[r + 2],
              d.fromArray(n, s),
              p.fromArray(n, c),
              f.fromArray(n, h),
              m.subVectors(f, p),
              g.subVectors(d, p),
              m.cross(g),
              u[s] += m.x,
              u[s + 1] += m.y,
              u[s + 2] += m.z,
              u[c] += m.x,
              u[c + 1] += m.y,
              u[c + 2] += m.z,
              u[h] += m.x,
              u[h + 1] += m.y,
              u[h + 2] += m.z
        } else
          for (var r = 0, a = n.length; r < a; r += 9)
            d.fromArray(n, r),
            p.fromArray(n, r + 3),
            f.fromArray(n, r + 6),
            m.subVectors(f, p),
            g.subVectors(d, p),
            m.cross(g),
            u[r] = m.x,
            u[r + 1] = m.y,
            u[r + 2] = m.z,
            u[r + 3] = m.x,
            u[r + 4] = m.y,
            u[r + 5] = m.z,
            u[r + 6] = m.x,
            u[r + 7] = m.y,
            u[r + 8] = m.z;
      this.normalizeNormals(),
        e.normal.needsUpdate = !0
      }
    },
    merge: function(t, e) {
      if ((t && t.isBufferGeometry) === !1)
        return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.", t);
      void 0 === e && (e = 0);
      var i = this.attributes;
      for (var n in i)
        if (void 0 !== t.attributes[n])
          for (var o = i[n], r = o.array, a = t.attributes[n], s = a.array, l = a.itemSize, c = 0, h = l * e; c < s.length; c++, h++)
            r[h] = s[c];
    return this
    },
    normalizeNormals: function() {
      for (var t, e, i, n, o = this.attributes.normal, r = 0, a = o.count; r < a; r++)
        t = o.getX(r),
        e = o.getY(r),
        i = o.getZ(r),
        n = 1 / Math.sqrt(t * t + e * e + i * i),
        o.setXYZ(r, t * n, e * n, i * n)
    },
    toNonIndexed: function() {
      if (null === this.index)
        return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),
        this;
      var t = new Mt,
        e = this.index.array,
        i = this.attributes;
      for (var n in i) {
        for (var o = i[n], r = o.array, a = o.itemSize, s = new r.constructor(e.length * a), l = 0, c = 0, h = 0, u = e.length; h < u; h++) {
          l = e[h] * a;
          for (var d = 0; d < a; d++)
            s[c++] = r[l++]
        }
        t.addAttribute(n, new pt(s, a))
      }
      return t
    },
    toJSON: function() {
      var t = {
        metadata: {
          version: 4.5,
          type: "BufferGeometry",
          generator: "BufferGeometry.toJSON"
        }
      };
      if (t.uuid = this.uuid, t.type = this.type, "" !== this.name && (t.name = this.name), void 0 !== this.parameters) {
        var e = this.parameters;
        for (var i in e)
          void 0 !== e[i] && (t[i] = e[i]);
        return t
      }
      t.data = {
        attributes: {}
      };
      var n = this.index;
      if (null !== n) {
        var o = Array.prototype.slice.call(n.array);
        t.data.index = {
          type: n.array.constructor.name,
          array: o
        }
      }
      var r = this.attributes;
      for (var i in r) {
        var a = r[i],
          o = Array.prototype.slice.call(a.array);
        t.data.attributes[i] = {
          itemSize: a.itemSize,
          type: a.array.constructor.name,
          array: o,
          normalized: a.normalized
        }
      }
      var s = this.groups;
      s.length > 0 && (t.data.groups = JSON.parse(JSON.stringify(s)));
      var l = this.boundingSphere;
      return null !== l && (t.data.boundingSphere = {
        center: l.center.toArray(),
        radius: l.radius
      }),
      t
    },
    clone: function() {
      return (new Mt).copy(this)
    },
    copy: function(t) {
      var e,
        i,
        n;
      this.index = null,
      this.attributes = {},
      this.morphAttributes = {},
      this.groups = [],
      this.boundingBox = null,
      this.boundingSphere = null,
      this.name = t.name;
      var o = t.index;
      null !== o && this.setIndex(o.clone());
      var r = t.attributes;
      for (e in r) {
        var a = r[e];
        this.addAttribute(e, a.clone())
      }
      var s = t.morphAttributes;
      for (e in s) {
        var l = [],
          c = s[e];
        for (i = 0, n = c.length; i < n; i++)
          l.push(c[i].clone());
        this.morphAttributes[e] = l
      }
      var h = t.groups;
      for (i = 0, n = h.length; i < n; i++) {
        var u = h[i];
        this.addGroup(u.start, u.count, u.materialIndex)
      }
      var d = t.boundingBox;
      null !== d && (this.boundingBox = d.clone());
      var p = t.boundingSphere;
      return null !== p && (this.boundingSphere = p.clone()),
      this.drawRange.start = t.drawRange.start,
      this.drawRange.count = t.drawRange.count,
      this
    },
    dispose: function() {
      this.dispatchEvent({type: "dispose"})
    }
  }),
  St.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: St,
    isMesh: !0,
    setDrawMode: function(t) {
      this.drawMode = t
    },
    copy: function(t) {
      return lt.prototype.copy.call(this, t),
      this.drawMode = t.drawMode,
      this
    },
    updateMorphTargets: function() {
      var t = this.geometry.morphTargets;
      if (void 0 !== t && t.length > 0) {
        this.morphTargetInfluences = [],
        this.morphTargetDictionary = {};
        for (var e = 0, i = t.length; e < i; e++)
          this.morphTargetInfluences.push(0),
          this.morphTargetDictionary[t[e].name] = e
      }
    },
    raycast: function() {
      function t(t, e, i, n, o, r, a) {
        return ht.barycoordFromPoint(t, e, i, n, y),
        o.multiplyScalar(y.x),
        r.multiplyScalar(y.y),
        a.multiplyScalar(y.z),
        o.add(r).add(a),
        o.clone()
      }
      function e(t, e, i, n, o, r, a) {
        var s = t.material;
        if (null === (
          s.side === xr
          ? i.intersectTriangle(r, o, n, !0, a)
          : i.intersectTriangle(n, o, r, s.side !== br, a)))
          return null;
        x.copy(a),
        x.applyMatrix4(t.matrixWorld);
        var l = e.ray.origin.distanceTo(x);
        return l < e.near || l > e.far
          ? null
          : {
            distance: l,
            point: x.clone(),
            object: t
          }
      }
      function n(i, n, o, r, a, l, c, d) {
        s.fromBufferAttribute(r, l),
        h.fromBufferAttribute(r, c),
        u.fromBufferAttribute(r, d);
        var p = e(i, n, o, s, h, u, E);
        return p && (a && (m.fromBufferAttribute(a, l), g.fromBufferAttribute(a, c), v.fromBufferAttribute(a, d), p.uv = t(E, s, h, u, m, g, v)), p.face = new ut(l, c, d, ht.normal(s, h, u)), p.faceIndex = l),
        p
      }
      var o = new c,
        r = new rt,
        a = new tt,
        s = new l,
        h = new l,
        u = new l,
        d = new l,
        p = new l,
        f = new l,
        m = new i,
        g = new i,
        v = new i,
        y = new l,
        E = new l,
        x = new l;
      return function(i, l) {
        var c = this.geometry,
          y = this.material,
          x = this.matrixWorld;
        if (void 0 !== y && (null === c.boundingSphere && c.computeBoundingSphere(), a.copy(c.boundingSphere), a.applyMatrix4(x), i.ray.intersectsSphere(a) !== !1 && (o.getInverse(x), r.copy(i.ray).applyMatrix4(o), null === c.boundingBox || r.intersectsBox(c.boundingBox) !== !1))) {
          var b;
          if (c.isBufferGeometry) {
            var w,
              C,
              T,
              _,
              L,
              M = c.index,
              S = c.attributes.position,
              O = c.attributes.uv;
            if (null !== M)
              for (_ = 0, L = M.count; _ < L; _ += 3)
                w = M.getX(_),
                C = M.getX(_ + 1),
                T = M.getX(_ + 2),
                (b = n(this, i, r, S, O, w, C, T)) && (b.faceIndex = Math.floor(_ / 3), l.push(b));
          else
              for (_ = 0, L = S.count; _ < L; _ += 3)
                w = _,
                C = _ + 1,
                T = _ + 2,
                (b = n(this, i, r, S, O, w, C, T)) && (b.index = w, l.push(b))
          } else if (c.isGeometry) {
            var D,
              R,
              U,
              A,
              I = Array.isArray(y),
              P = c.vertices,
              B = c.faces,
              N = c.faceVertexUvs[0];
            N.length > 0 && (A = N);
            for (var k = 0, H = B.length; k < H; k++) {
              var F = B[k],
                G = I
                  ? y[F.materialIndex]
                  : y;
              if (void 0 !== G) {
                if (D = P[F.a], R = P[F.b], U = P[F.c], G.morphTargets === !0) {
                  var V = c.morphTargets,
                    z = this.morphTargetInfluences;
                  s.set(0, 0, 0),
                  h.set(0, 0, 0),
                  u.set(0, 0, 0);
                  for (var q = 0, W = V.length; q < W; q++) {
                    var j = z[q];
                    if (0 !== j) {
                      var X = V[q].vertices;
                      s.addScaledVector(d.subVectors(X[F.a], D), j),
                      h.addScaledVector(p.subVectors(X[F.b], R), j),
                      u.addScaledVector(f.subVectors(X[F.c], U), j)
                    }
                  }
                  s.add(D),
                  h.add(R),
                  u.add(U),
                  D = s,
                  R = h,
                  U = u
                }
                if (b = e(this, i, r, D, R, U, E)) {
                  if (A && A[k]) {
                    var Y = A[k];
                    m.copy(Y[0]),
                    g.copy(Y[1]),
                    v.copy(Y[2]),
                    b.uv = t(E, D, R, U, m, g, v)
                  }
                  b.face = F,
                  b.faceIndex = k,
                  l.push(b)
                }
              }
            }
          }
        }
      }
    }(),
    clone: function() {
      return new this.constructor(this.geometry, this.material).copy(this)
    }
  }),
  Ot.prototype = Object.create(Lt.prototype),
  Ot.prototype.constructor = Ot,
  Dt.prototype = Object.create(Mt.prototype),
  Dt.prototype.constructor = Dt,
  Rt.prototype = Object.create(Lt.prototype),
  Rt.prototype.constructor = Rt,
  Ut.prototype = Object.create(Mt.prototype),
  Ut.prototype.constructor = Ut,
  At.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: At,
    isCamera: !0,
    copy: function(t) {
      return lt.prototype.copy.call(this, t),
      this.matrixWorldInverse.copy(t.matrixWorldInverse),
      this.projectionMatrix.copy(t.projectionMatrix),
      this
    },
    getWorldDirection: function() {
      var t = new s;
      return function(e) {
        var i = e || new l;
        return this.getWorldQuaternion(t),
        i.set(0, 0, -1).applyQuaternion(t)
      }
    }(),
    clone: function() {
      return (new this.constructor).copy(this)
    }
  }),
  It.prototype = Object.assign(Object.create(At.prototype), {
    constructor: It,
    isPerspectiveCamera: !0,
    copy: function(t) {
      return At.prototype.copy.call(this, t),
      this.fov = t.fov,
      this.zoom = t.zoom,
      this.near = t.near,
      this.far = t.far,
      this.focus = t.focus,
      this.aspect = t.aspect,
      this.view = null === t.view
        ? null
        : Object.assign({}, t.view),
      this.filmGauge = t.filmGauge,
      this.filmOffset = t.filmOffset,
      this
    },
    setFocalLength: function(t) {
      var e = .5 * this.getFilmHeight() / t;
      this.fov = 2 * gs.RAD2DEG * Math.atan(e),
      this.updateProjectionMatrix()
    },
    getFocalLength: function() {
      var t = Math.tan(.5 * gs.DEG2RAD * this.fov);
      return.5 * this.getFilmHeight() / t
    },
    getEffectiveFOV: function() {
      return 2 * gs.RAD2DEG * Math.atan(Math.tan(.5 * gs.DEG2RAD * this.fov) / this.zoom)
    },
    getFilmWidth: function() {
      return this.filmGauge * Math.min(this.aspect, 1)
    },
    getFilmHeight: function() {
      return this.filmGauge / Math.max(this.aspect, 1)
    },
    setViewOffset: function(t, e, i, n, o, r) {
      this.aspect = t / e,
      this.view = {
        fullWidth: t,
        fullHeight: e,
        offsetX: i,
        offsetY: n,
        width: o,
        height: r
      },
      this.updateProjectionMatrix()
    },
    clearViewOffset: function() {
      this.view = null,
      this.updateProjectionMatrix()
    },
    updateProjectionMatrix: function() {
      var t = this.near,
        e = t * Math.tan(.5 * gs.DEG2RAD * this.fov) / this.zoom,
        i = 2 * e,
        n = this.aspect * i,
        o = -.5 * n,
        r = this.view;
      if (null !== r) {
        var a = r.fullWidth,
          s = r.fullHeight;
        o += r.offsetX * n / a,
        e -= r.offsetY * i / s,
        n *= r.width / a,
        i *= r.height / s
      }
      var l = this.filmOffset;
      0 !== l && (o += t * l / this.getFilmWidth()),
      this.projectionMatrix.makePerspective(o, o + n, e, e - i, t, this.far)
    },
    toJSON: function(t) {
      var e = lt.prototype.toJSON.call(this, t);
      return e.object.fov = this.fov,
      e.object.zoom = this.zoom,
      e.object.near = this.near,
      e.object.far = this.far,
      e.object.focus = this.focus,
      e.object.aspect = this.aspect,
      null !== this.view && (e.object.view = Object.assign({}, this.view)),
      e.object.filmGauge = this.filmGauge,
      e.object.filmOffset = this.filmOffset,
      e
    }
  }),
  Pt.prototype = Object.assign(Object.create(At.prototype), {
    constructor: Pt,
    isOrthographicCamera: !0,
    copy: function(t) {
      return At.prototype.copy.call(this, t),
      this.left = t.left,
      this.right = t.right,
      this.top = t.top,
      this.bottom = t.bottom,
      this.near = t.near,
      this.far = t.far,
      this.zoom = t.zoom,
      this.view = null === t.view
        ? null
        : Object.assign({}, t.view),
      this
    },
    setViewOffset: function(t, e, i, n, o, r) {
      this.view = {
        fullWidth: t,
        fullHeight: e,
        offsetX: i,
        offsetY: n,
        width: o,
        height: r
      },
      this.updateProjectionMatrix()
    },
    clearViewOffset: function() {
      this.view = null,
      this.updateProjectionMatrix()
    },
    updateProjectionMatrix: function() {
      var t = (this.right - this.left) / (2 * this.zoom),
        e = (this.top - this.bottom) / (2 * this.zoom),
        i = (this.right + this.left) / 2,
        n = (this.top + this.bottom) / 2,
        o = i - t,
        r = i + t,
        a = n + e,
        s = n - e;
      if (null !== this.view) {
        var l = this.zoom / (this.view.width / this.view.fullWidth),
          c = this.zoom / (this.view.height / this.view.fullHeight),
          h = (this.right - this.left) / this.view.width,
          u = (this.top - this.bottom) / this.view.height;
        o += h * (this.view.offsetX / l),
        r = o + h * (this.view.width / l),
        a -= u * (this.view.offsetY / c),
        s = a - u * (this.view.height / c)
      }
      this.projectionMatrix.makeOrthographic(o, r, a, s, this.near, this.far)
    },
    toJSON: function(t) {
      var e = lt.prototype.toJSON.call(this, t);
      return e.object.zoom = this.zoom,
      e.object.left = this.left,
      e.object.right = this.right,
      e.object.top = this.top,
      e.object.bottom = this.bottom,
      e.object.near = this.near,
      e.object.far = this.far,
      null !== this.view && (e.object.view = Object.assign({}, this.view)),
      e
    }
  });
  var As = 0;
  fe.prototype.isFogExp2 = !0,
  fe.prototype.clone = function() {
    return new fe(this.color.getHex(), this.density)
  },
  fe.prototype.toJSON = function(t) {
    return {type: "FogExp2", color: this.color.getHex(), density: this.density}
  },
  me.prototype.isFog = !0,
  me.prototype.clone = function() {
    return new me(this.color.getHex(), this.near, this.far)
  },
  me.prototype.toJSON = function(t) {
    return {type: "Fog", color: this.color.getHex(), near: this.near, far: this.far}
  },
  ge.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: ge,
    copy: function(t, e) {
      return lt.prototype.copy.call(this, t, e),
      null !== t.background && (this.background = t.background.clone()),
      null !== t.fog && (this.fog = t.fog.clone()),
      null !== t.overrideMaterial && (this.overrideMaterial = t.overrideMaterial.clone()),
      this.autoUpdate = t.autoUpdate,
      this.matrixAutoUpdate = t.matrixAutoUpdate,
      this
    },
    toJSON: function(t) {
      var e = lt.prototype.toJSON.call(this, t);
      return null !== this.background && (e.object.background = this.background.toJSON(t)),
      null !== this.fog && (e.object.fog = this.fog.toJSON()),
      e
    }
  }),
  ve.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: ve,
    isLensFlare: !0,
    copy: function(t) {
      lt.prototype.copy.call(this, t),
      this.positionScreen.copy(t.positionScreen),
      this.customUpdateCallback = t.customUpdateCallback;
      for (var e = 0, i = t.lensFlares.length; e < i; e++)
        this.lensFlares.push(t.lensFlares[e]);
      return this
    },
    add: function(t, e, i, n, o, r) {
      void 0 === e && (e = -1),
      void 0 === i && (i = 0),
      void 0 === r && (r = 1),
      void 0 === o && (o = new j(16777215)),
      void 0 === n && (n = Sr),
      i = Math.min(i, Math.max(0, i)),
      this.lensFlares.push({
        texture: t,
        size: e,
        distance: i,
        x: 0,
        y: 0,
        z: 0,
        scale: 1,
        rotation: 0,
        opacity: r,
        color: o,
        blending: n
      })
    },
    updateLensFlares: function() {
      var t,
        e,
        i = this.lensFlares.length,
        n = 2 * -this.positionScreen.x,
        o = 2 * -this.positionScreen.y;
      for (t = 0; t < i; t++)
        e = this.lensFlares[t],
        e.x = this.positionScreen.x + n * e.distance,
        e.y = this.positionScreen.y + o * e.distance,
        e.wantedRotation = e.x * Math.PI * .25,
        e.rotation += .25 * (e.wantedRotation - e.rotation)
    }
  }),
  ye.prototype = Object.create(K.prototype),
  ye.prototype.constructor = ye,
  ye.prototype.isSpriteMaterial = !0,
  ye.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.color.copy(t.color),
    this.map = t.map,
    this.rotation = t.rotation,
    this
  },
  Ee.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: Ee,
    isSprite: !0,
    raycast: function() {
      var t = new l,
        e = new l,
        i = new l;
      return function(n, o) {
        e.setFromMatrixPosition(this.matrixWorld),
        n.ray.closestPointToPoint(e, t),
        i.setFromMatrixScale(this.matrixWorld);
        var r = i.x * i.y / 4;
        if (!(e.distanceToSquared(t) > r)) {
          var a = n.ray.origin.distanceTo(t);
          a < n.near || a > n.far || o.push({distance: a, point: t.clone(), face: null, object: this})
        }
      }
    }(),
    clone: function() {
      return new this.constructor(this.material).copy(this)
    }
  }),
  xe.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: xe,
    copy: function(t) {
      lt.prototype.copy.call(this, t, !1);
      for (var e = t.levels, i = 0, n = e.length; i < n; i++) {
        var o = e[i];
        this.addLevel(o.object.clone(), o.distance)
      }
      return this
    },
    addLevel: function(t, e) {
      void 0 === e && (e = 0),
      e = Math.abs(e);
      for (var i = this.levels, n = 0; n < i.length && !(e < i[n].distance); n++)
      ;
      i.splice(n, 0, {
        distance: e,
        object: t
      }),
      this.add(t)
    },
    getObjectForDistance: function(t) {
      for (var e = this.levels, i = 1, n = e.length; i < n && !(t < e[i].distance); i++)
      ;
      return e[i - 1].object
    },
    raycast: function() {
      var t = new l;
      return function(e, i) {
        t.setFromMatrixPosition(this.matrixWorld);
        var n = e.ray.origin.distanceTo(t);
        this.getObjectForDistance(n).raycast(e, i)
      }
    }(),
    update: function() {
      var t = new l,
        e = new l;
      return function(i) {
        var n = this.levels;
        if (n.length > 1) {
          t.setFromMatrixPosition(i.matrixWorld),
          e.setFromMatrixPosition(this.matrixWorld);
          var o = t.distanceTo(e);
          n[0].object.visible = !0;
          for (var r = 1, a = n.length; r < a && o >= n[r].distance; r++)
            n[r - 1].object.visible = !1,
            n[r].object.visible = !0;
          for (; r < a; r++)
            n[r].object.visible = !1
        }
      }
    }(),
    toJSON: function(t) {
      var e = lt.prototype.toJSON.call(this, t);
      e.object.levels = [];
      for (var i = this.levels, n = 0, o = i.length; n < o; n++) {
        var r = i[n];
        e.object.levels.push({object: r.object.uuid, distance: r.distance})
      }
      return e
    }
  }),
  Object.assign(be.prototype, {
    calculateInverses: function() {
      this.boneInverses = [];
      for (var t = 0, e = this.bones.length; t < e; t++) {
        var i = new c;
        this.bones[t] && i.getInverse(this.bones[t].matrixWorld),
        this.boneInverses.push(i)
      }
    },
    pose: function() {
      var t,
        e,
        i;
      for (e = 0, i = this.bones.length; e < i; e++)
        (t = this.bones[e]) && t.matrixWorld.getInverse(this.boneInverses[e]);
      for (e = 0, i = this.bones.length; e < i; e++)
        (t = this.bones[e]) && (
          t.parent && t.parent.isBone
          ? (t.matrix.getInverse(t.parent.matrixWorld), t.matrix.multiply(t.matrixWorld))
          : t.matrix.copy(t.matrixWorld),
        t.matrix.decompose(t.position, t.quaternion, t.scale))
    },
    update: function() {
      var t = new c,
        e = new c;
      return function() {
        for (var i = this.bones, n = this.boneInverses, o = this.boneMatrices, r = this.boneTexture, a = 0, s = i.length; a < s; a++) {
          var l = i[a]
            ? i[a].matrixWorld
            : e;
          t.multiplyMatrices(l, n[a]),
          t.toArray(o, 16 * a)
        }
        void 0 !== r && (r.needsUpdate = !0)
      }
    }(),
    clone: function() {
      return new be(this.bones, this.boneInverses)
    }
  }),
  we.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: we,
    isBone: !0
  }),
  Ce.prototype = Object.assign(Object.create(St.prototype), {
    constructor: Ce,
    isSkinnedMesh: !0,
    initBones: function() {
      var t,
        e,
        i,
        n,
        o = [];
      if (this.geometry && void 0 !== this.geometry.bones) {
        for (i = 0, n = this.geometry.bones.length; i < n; i++)
          e = this.geometry.bones[i],
          t = new we,
          o.push(t),
          t.name = e.name,
          t.position.fromArray(e.pos),
          t.quaternion.fromArray(e.rotq),
          void 0 !== e.scl && t.scale.fromArray(e.scl);
        for (i = 0, n = this.geometry.bones.length; i < n; i++)
          e = this.geometry.bones[i],
          e.parent !== -1 && null !== e.parent && void 0 !== o[e.parent]
            ? o[e.parent].add(o[i])
            : this.add(o[i])
        }
      return this.updateMatrixWorld(!0),
      o
    },
    bind: function(t, e) {
      this.skeleton = t,
      void 0 === e && (this.updateMatrixWorld(!0), this.skeleton.calculateInverses(), e = this.matrixWorld),
      this.bindMatrix.copy(e),
      this.bindMatrixInverse.getInverse(e)
    },
    pose: function() {
      this.skeleton.pose()
    },
    normalizeSkinWeights: function() {
      var t,
        e;
      if (this.geometry && this.geometry.isGeometry)
        for (e = 0; e < this.geometry.skinWeights.length; e++) {
          var i = this.geometry.skinWeights[e];
          t = 1 / i.lengthManhattan(),
          1 / 0 !== t
            ? i.multiplyScalar(t)
            : i.set(1, 0, 0, 0)
        }
      else if (this.geometry && this.geometry.isBufferGeometry) {
        var n = new o,
          r = this.geometry.attributes.skinWeight;
        for (e = 0; e < r.count; e++)
          n.x = r.getX(e),
          n.y = r.getY(e),
          n.z = r.getZ(e),
          n.w = r.getW(e),
          t = 1 / n.lengthManhattan(),
          1 / 0 !== t
            ? n.multiplyScalar(t)
            : n.set(1, 0, 0, 0),
          r.setXYZW(e, n.x, n.y, n.z, n.w)
      }
    },
    updateMatrixWorld: function(t) {
      St.prototype.updateMatrixWorld.call(this, t),
      "attached" === this.bindMode
        ? this.bindMatrixInverse.getInverse(this.matrixWorld)
        : "detached" === this.bindMode
          ? this.bindMatrixInverse.getInverse(this.bindMatrix)
          : console.warn("THREE.SkinnedMesh: Unrecognized bindMode: " + this.bindMode)
    },
    clone: function() {
      return new this.constructor(this.geometry, this.material).copy(this)
    }
  }),
  Te.prototype = Object.create(K.prototype),
  Te.prototype.constructor = Te,
  Te.prototype.isLineBasicMaterial = !0,
  Te.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.color.copy(t.color),
    this.linewidth = t.linewidth,
    this.linecap = t.linecap,
    this.linejoin = t.linejoin,
    this
  },
  _e.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: _e,
    isLine: !0,
    raycast: function() {
      var t = new c,
        e = new rt,
        i = new tt;
      return function(n, o) {
        var r = n.linePrecision,
          a = r * r,
          s = this.geometry,
          c = this.matrixWorld;
        if (null === s.boundingSphere && s.computeBoundingSphere(), i.copy(s.boundingSphere), i.applyMatrix4(c), n.ray.intersectsSphere(i) !== !1) {
          t.getInverse(c),
          e.copy(n.ray).applyMatrix4(t);
          var h = new l,
            u = new l,
            d = new l,
            p = new l,
            f = this && this.isLineSegments
              ? 2
              : 1;
          if (s.isBufferGeometry) {
            var m = s.index,
              g = s.attributes,
              v = g.position.array;
            if (null !== m)
              for (var y = m.array, E = 0, x = y.length - 1; E < x; E += f) {
                var b = y[E],
                  w = y[E + 1];
                h.fromArray(v, 3 * b),
                u.fromArray(v, 3 * w);
                var C = e.distanceSqToSegment(h, u, p, d);
                if (!(C > a)) {
                  p.applyMatrix4(this.matrixWorld);
                  var T = n.ray.origin.distanceTo(p);
                  T < n.near || T > n.far || o.push({
                    distance: T,
                    point: d.clone().applyMatrix4(this.matrixWorld),
                    index: E,
                    face: null,
                    faceIndex: null,
                    object: this
                  })
                }
              }
            else
              for (var E = 0, x = v.length / 3 - 1; E < x; E += f) {
                h.fromArray(v, 3 * E),
                u.fromArray(v, 3 * E + 3);
                var C = e.distanceSqToSegment(h, u, p, d);
                if (!(C > a)) {
                  p.applyMatrix4(this.matrixWorld);
                  var T = n.ray.origin.distanceTo(p);
                  T < n.near || T > n.far || o.push({
                    distance: T,
                    point: d.clone().applyMatrix4(this.matrixWorld),
                    index: E,
                    face: null,
                    faceIndex: null,
                    object: this
                  })
                }
              }
            } else if (s.isGeometry)
            for (var _ = s.vertices, L = _.length, E = 0; E < L - 1; E += f) {
              var C = e.distanceSqToSegment(_[E], _[E + 1], p, d);
              if (!(C > a)) {
                p.applyMatrix4(this.matrixWorld);
                var T = n.ray.origin.distanceTo(p);
                T < n.near || T > n.far || o.push({
                  distance: T,
                  point: d.clone().applyMatrix4(this.matrixWorld),
                  index: E,
                  face: null,
                  faceIndex: null,
                  object: this
                })
              }
            }
          }
      }
    }(),
    clone: function() {
      return new this.constructor(this.geometry, this.material).copy(this)
    }
  }),
  Le.prototype = Object.assign(Object.create(_e.prototype), {
    constructor: Le,
    isLineSegments: !0
  }),
  Me.prototype = Object.assign(Object.create(_e.prototype), {
    constructor: Me,
    isLineLoop: !0
  }),
  Se.prototype = Object.create(K.prototype),
  Se.prototype.constructor = Se,
  Se.prototype.isPointsMaterial = !0,
  Se.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.color.copy(t.color),
    this.map = t.map,
    this.size = t.size,
    this.sizeAttenuation = t.sizeAttenuation,
    this
  },
  Oe.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: Oe,
    isPoints: !0,
    raycast: function() {
      var t = new c,
        e = new rt,
        i = new tt;
      return function(n, o) {
        function r(t, i) {
          var r = e.distanceSqToPoint(t);
          if (r < d) {
            var s = e.closestPointToPoint(t);
            s.applyMatrix4(c);
            var l = n.ray.origin.distanceTo(s);
            if (l < n.near || l > n.far)
              return;
            o.push({
              distance: l,
              distanceToRay: Math.sqrt(r),
              point: s.clone(),
              index: i,
              face: null,
              object: a
            })
          }
        }
        var a = this,
          s = this.geometry,
          c = this.matrixWorld,
          h = n.params.Points.threshold;
        if (null === s.boundingSphere && s.computeBoundingSphere(), i.copy(s.boundingSphere), i.applyMatrix4(c), i.radius += h, n.ray.intersectsSphere(i) !== !1) {
          t.getInverse(c),
          e.copy(n.ray).applyMatrix4(t);
          var u = h / ((this.scale.x + this.scale.y + this.scale.z) / 3),
            d = u * u,
            p = new l;
          if (s.isBufferGeometry) {
            var f = s.index,
              m = s.attributes,
              g = m.position.array;
            if (null !== f)
              for (var v = f.array, y = 0, E = v.length; y < E; y++) {
                var x = v[y];
                p.fromArray(g, 3 * x),
                r(p, x)
              }
            else
              for (var y = 0, b = g.length / 3; y < b; y++)
                p.fromArray(g, 3 * y),
                r(p, y)
          } else
            for (var w = s.vertices, y = 0, b = w.length; y < b; y++)
              r(w[y], y)
        }
      }
    }(),
    clone: function() {
      return new this.constructor(this.geometry, this.material).copy(this)
    }
  }),
  De.prototype = Object.assign(Object.create(lt.prototype), {constructor: De}),
  Re.prototype = Object.create(n.prototype),
  Re.prototype.constructor = Re,
  Ue.prototype = Object.create(n.prototype),
  Ue.prototype.constructor = Ue,
  Ue.prototype.isCompressedTexture = !0,
  Ae.prototype = Object.create(n.prototype),
  Ae.prototype.constructor = Ae,
  Ie.prototype = Object.create(n.prototype),
  Ie.prototype.constructor = Ie,
  Ie.prototype.isDepthTexture = !0,
  Pe.prototype = Object.create(Mt.prototype),
  Pe.prototype.constructor = Pe,
  Be.prototype = Object.create(Lt.prototype),
  Be.prototype.constructor = Be,
  Ne.prototype = Object.create(Mt.prototype),
  Ne.prototype.constructor = Ne,
  ke.prototype = Object.create(Lt.prototype),
  ke.prototype.constructor = ke,
  He.prototype = Object.create(Mt.prototype),
  He.prototype.constructor = He,
  Fe.prototype = Object.create(Lt.prototype),
  Fe.prototype.constructor = Fe,
  Ge.prototype = Object.create(He.prototype),
  Ge.prototype.constructor = Ge,
  Ve.prototype = Object.create(Lt.prototype),
  Ve.prototype.constructor = Ve,
  ze.prototype = Object.create(He.prototype),
  ze.prototype.constructor = ze,
  qe.prototype = Object.create(Lt.prototype),
  qe.prototype.constructor = qe,
  We.prototype = Object.create(He.prototype),
  We.prototype.constructor = We,
  je.prototype = Object.create(Lt.prototype),
  je.prototype.constructor = je,
  Xe.prototype = Object.create(He.prototype),
  Xe.prototype.constructor = Xe,
  Ye.prototype = Object.create(Lt.prototype),
  Ye.prototype.constructor = Ye,
  Ze.prototype = Object.create(Mt.prototype),
  Ze.prototype.constructor = Ze,
  Ke.prototype = Object.create(Lt.prototype),
  Ke.prototype.constructor = Ke,
  Qe.prototype = Object.create(Mt.prototype),
  Qe.prototype.constructor = Qe,
  Je.prototype = Object.create(Lt.prototype),
  Je.prototype.constructor = Je,
  $e.prototype = Object.create(Mt.prototype),
  $e.prototype.constructor = $e;
  var Is = {
    area: function(t) {
      for (var e = t.length, i = 0, n = e - 1, o = 0; o < e; n = o++)
        i += t[n].x * t[o].y - t[o].x * t[n].y;
      return.5 * i
    },
    triangulate: function() {
      function t(t, e, i, n, o, r) {
        var a,
          s,
          l,
          c,
          h,
          u,
          d,
          p,
          f;
        if (s = t[r[e]].x, l = t[r[e]].y, c = t[r[i]].x, h = t[r[i]].y, u = t[r[n]].x, d = t[r[n]].y, (c - s) * (d - l) - (h - l) * (u - s) <= 0)
          return !1;
        var m,
          g,
          v,
          y,
          E,
          x,
          b,
          w,
          C,
          T,
          _,
          L,
          M,
          S,
          O;
        for (m = u - c, g = d - h, v = s - u, y = l - d, E = c - s, x = h - l, a = 0; a < o; a++)
          if (p = t[r[a]].x, f = t[r[a]].y, !(p === s && f === l || p === c && f === h || p === u && f === d) && (b = p - s, w = f - l, C = p - c, T = f - h, _ = p - u, L = f - d, O = m * T - g * C, M = E * w - x * b, S = v * L - y * _, O >= -Number.EPSILON && S >= -Number.EPSILON && M >= -Number.EPSILON))
            return !1;
      return !0
      }
      return function(e, i) {
        var n = e.length;
        if (n < 3)
          return null;
        var o,
          r,
          a,
          s = [],
          l = [],
          c = [];
        if (Is.area(e) > 0)
          for (r = 0; r < n; r++)
            l[r] = r;
      else
          for (r = 0; r < n; r++)
            l[r] = n - 1 - r;
      var h = n,
          u = 2 * h;
        for (r = h - 1; h > 2;) {
          if (u-- <= 0)
            return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),
            i
              ? c
              : s;
          if (o = r, h <= o && (o = 0), r = o + 1, h <= r && (r = 0), a = r + 1, h <= a && (a = 0), t(e, o, r, a, h, l)) {
            var d,
              p,
              f,
              m,
              g;
            for (d = l[o], p = l[r], f = l[a], s.push([
              e[d], e[p], e[f]
            ]), c.push([
              l[o], l[r], l[a]
            ]), m = r, g = r + 1; g < h; m++, g++)
              l[m] = l[g];
            h--,
            u = 2 * h
          }
        }
        return i
          ? c
          : s
      }
    }(),
    triangulateShape: function(t, e) {
      function i(t) {
        var e = t.length;
        e > 2 && t[e - 1].equals(t[0]) && t.pop()
      }
      function n(t, e, i) {
        return t.x !== e.x
          ? t.x < e.x
            ? t.x <= i.x && i.x <= e.x
            : e.x <= i.x && i.x <= t.x
          : t.y < e.y
            ? t.y <= i.y && i.y <= e.y
            : e.y <= i.y && i.y <= t.y
      }
      function o(t, e, i, o, r) {
        var a = e.x - t.x,
          s = e.y - t.y,
          l = o.x - i.x,
          c = o.y - i.y,
          h = t.x - i.x,
          u = t.y - i.y,
          d = s * l - a * c,
          p = s * h - a * u;
        if (Math.abs(d) > Number.EPSILON) {
          var f;
          if (d > 0) {
            if (p < 0 || p > d)
              return [];
            if ((f = c * h - l * u) < 0 || f > d)
              return []
          } else {
            if (p > 0 || p < d)
              return [];
            if ((f = c * h - l * u) > 0 || f < d)
              return []
          }
          if (0 === f)
            return !r || 0 !== p && p !== d
              ? [t]
              : [];
          if (f === d)
            return !r || 0 !== p && p !== d
              ? [e]
              : [];
          if (0 === p)
            return [i];
          if (p === d)
            return [o];
          var m = f / d;
          return [
            {
              x: t.x + m * a,
              y: t.y + m * s
            }
          ]
        }
        if (0 !== p || c * h != l * u)
          return [];
        var g = 0 === a && 0 === s,
          v = 0 === l && 0 === c;
        if (g && v)
          return t.x !== i.x || t.y !== i.y
            ? []
            : [t];
        if (g)
          return n(i, o, t)
            ? [t]
            : [];
        if (v)
          return n(t, e, i)
            ? [i]
            : [];
        var y,
          E,
          x,
          b,
          w,
          C,
          T,
          _;
        return 0 !== a
          ? (
            t.x < e.x
            ? (y = t, x = t.x, E = e, b = e.x)
            : (y = e, x = e.x, E = t, b = t.x),
          i.x < o.x
            ? (w = i, T = i.x, C = o, _ = o.x)
            : (w = o, T = o.x, C = i, _ = i.x))
          : (
            t.y < e.y
            ? (y = t, x = t.y, E = e, b = e.y)
            : (y = e, x = e.y, E = t, b = t.y),
          i.y < o.y
            ? (w = i, T = i.y, C = o, _ = o.y)
            : (w = o, T = o.y, C = i, _ = i.y)),
        x <= T
          ? b < T
            ? []
            : b === T
              ? r
                ? []
                : [w]
              : b <= _
                ? [w, E]
                : [w, C]
          : x > _
            ? []
            : x === _
              ? r
                ? []
                : [y]
              : b <= _
                ? [y, E]
                : [y, C]
      }
      function r(t, e, i, n) {
        var o = e.x - t.x,
          r = e.y - t.y,
          a = i.x - t.x,
          s = i.y - t.y,
          l = n.x - t.x,
          c = n.y - t.y,
          h = o * s - r * a,
          u = o * c - r * l;
        if (Math.abs(h) > Number.EPSILON) {
          var d = l * s - c * a;
          return h > 0
            ? u >= 0 && d >= 0
            : u >= 0 || d >= 0
        }
        return u > 0
      }
      i(t),
      e.forEach(i);
      for (var a, s, l, c, h, u, d = {}, p = t.concat(), f = 0, m = e.length; f < m; f++)
        Array.prototype.push.apply(p, e[f]);
      for (a = 0, s = p.length; a < s; a++)
        h = p[a].x + ":" + p[a].y,
        void 0 !== d[h] && console.warn("THREE.ShapeUtils: Duplicate point", h, a),
        d[h] = a;
      var g = function(t, e) {
          for (var i, n, a, s, l, c, h, u, d, p, f, m = t.concat(), g = [], v = [], y = 0, E = e.length; y < E; y++)
            g.push(y);
          for (var x = 0, b = 2 * g.length; g.length > 0;) {
            if (--b < 0) {
              console.log("Infinite Loop! Holes left:" + g.length + ", Probably Hole outside Shape!");
              break
            }
            for (a = x; a < m.length; a++) {
              s = m[a],
              n = -1;
              for (var y = 0; y < g.length; y++)
                if (c = g[y], h = s.x + ":" + s.y + ":" + c, void 0 === v[h]) {
                  i = e[c];
                  for (var w = 0; w < i.length; w++)
                    if (l = i[w], function(t, e) {
                      var n = m.length - 1,
                        o = t - 1;
                      o < 0 && (o = n);
                      var a = t + 1;
                      a > n && (a = 0);
                      var s = r(m[t], m[o], m[a], i[e]);
                      if (!s)
                        return !1;
                      var l = i.length - 1,
                        c = e - 1;
                      c < 0 && (c = l);
                      var h = e + 1;
                      return h > l && (h = 0),
                      !!(s = r(i[e], i[c], i[h], m[t]))
                    }(a, w) && !function(t, e) {
                      var i,
                        n,
                        r;
                      for (i = 0; i < m.length; i++)
                        if (n = i + 1, n %= m.length, r = o(t, e, m[i], m[n], !0), r.length > 0)
                          return !0;
                    return !1
                    }(s, l) && !function(t, i) {
                      var n,
                        r,
                        a,
                        s,
                        l;
                      for (n = 0; n < g.length; n++)
                        for (r = e[g[n]], a = 0; a < r.length; a++)
                          if (s = a + 1, s %= r.length, l = o(t, i, r[a], r[s], !0), l.length > 0)
                            return !0;
                    return !1
                    }(s, l)) {
                      n = w,
                      g.splice(y, 1),
                      u = m.slice(0, a + 1),
                      d = m.slice(a),
                      p = i.slice(n),
                      f = i.slice(0, n + 1),
                      m = u.concat(p).concat(f).concat(d),
                      x = a;
                      break
                    }
                  if (n >= 0)
                    break;
                  v[h] = !0
                }
              if (n >= 0)
                break
            }
          }
          return m
        }(t, e),
        v = Is.triangulate(g, !1);
      for (a = 0, s = v.length; a < s; a++)
        for (c = v[a], l = 0; l < 3; l++)
          h = c[l].x + ":" + c[l].y,
          void 0 !== (u = d[h]) && (c[l] = u);
    return v.concat()
    },
    isClockWise: function(t) {
      return Is.area(t) < 0
    }
  };
  ti.prototype = Object.create(Lt.prototype),
  ti.prototype.constructor = ti,
  ei.prototype = Object.create(Mt.prototype),
  ei.prototype.constructor = ei,
  ei.prototype.getArrays = function() {
    var t = this.getAttribute("position"),
      e = t
        ? Array.prototype.slice.call(t.array)
        : [],
      i = this.getAttribute("uv"),
      n = i
        ? Array.prototype.slice.call(i.array)
        : [],
      o = this.index;
    return {
      position: e,
      uv: n,
      index: o
        ? Array.prototype.slice.call(o.array)
        : []
    }
  },
  ei.prototype.addShapeList = function(t, e) {
    var i = t.length;
    e.arrays = this.getArrays();
    for (var n = 0; n < i; n++) {
      var o = t[n];
      this.addShape(o, e)
    }
    this.setIndex(e.arrays.index),
    this.addAttribute("position", new bt(e.arrays.position, 3)),
    this.addAttribute("uv", new bt(e.arrays.uv, 2))
  },
  ei.prototype.addShape = function(t, e) {
    function n(t, e, i) {
      return e || console.error("THREE.ExtrudeGeometry: vec does not exist"),
      e.clone().multiplyScalar(i).add(t)
    }
    function o(t, e, n) {
      var o,
        r,
        a = 1,
        s = t.x - e.x,
        l = t.y - e.y,
        c = n.x - t.x,
        h = n.y - t.y,
        u = s * s + l * l,
        d = s * h - l * c;
      if (Math.abs(d) > Number.EPSILON) {
        var p = Math.sqrt(u),
          f = Math.sqrt(c * c + h * h),
          m = e.x - l / p,
          g = e.y + s / p,
          v = n.x - h / f,
          y = n.y + c / f,
          E = ((v - m) * h - (y - g) * c) / (s * h - l * c);
        o = m + s * E - t.x,
        r = g + l * E - t.y;
        var x = o * o + r * r;
        if (x <= 2)
          return new i(o, r);
        a = Math.sqrt(x / 2)
      } else {
        var b = !1;
        s > Number.EPSILON
          ? c > Number.EPSILON && (b = !0)
          : s < -Number.EPSILON
            ? c < -Number.EPSILON && (b = !0)
            : Math.sign(l) === Math.sign(h) && (b = !0),
        b
          ? (o = -l, r = s, a = Math.sqrt(u))
          : (o = s, r = l, a = Math.sqrt(u / 2))
      }
      return new i(o / a, r / a)
    }
    function r(t, e) {
      var i,
        n;
      for (Q = t.length; --Q >= 0;) {
        i = Q,
        n = Q - 1,
        n < 0 && (n = t.length - 1);
        var o = 0,
          r = S + 2 * _;
        for (o = 0; o < r; o++) {
          var a = Y * o,
            s = Y * (o + 1);
          c(e + i + a, e + n + a, e + n + s, e + i + s, t, o, r, i, n)
        }
      }
    }
    function a(t, e, i) {
      b.push(t),
      b.push(e),
      b.push(i)
    }
    function s(t, e, i) {
      h(t),
      h(e),
      h(i);
      var n = y.length / 3,
        o = R.generateTopUV(P, y, n - 3, n - 2, n - 1);
      u(o[0]),
      u(o[1]),
      u(o[2])
    }
    function c(t, e, i, n, o, r, a, s, l) {
      h(t),
      h(e),
      h(n),
      h(e),
      h(i),
      h(n);
      var c = y.length / 3,
        d = R.generateSideWallUV(P, y, c - 6, c - 3, c - 2, c - 1);
      u(d[0]),
      u(d[1]),
      u(d[3]),
      u(d[1]),
      u(d[2]),
      u(d[3])
    }
    function h(t) {
      E.push(y.length / 3),
      y.push(b[3 * t + 0]),
      y.push(b[3 * t + 1]),
      y.push(b[3 * t + 2])
    }
    function u(t) {
      x.push(t.x),
      x.push(t.y)
    }
    var d,
      p,
      f,
      m,
      g,
      v = e.arrays
        ? e.arrays
        : this.getArrays(),
      y = v.position,
      E = v.index,
      x = v.uv,
      b = [],
      w = void 0 !== e.amount
        ? e.amount
        : 100,
      C = void 0 !== e.bevelThickness
        ? e.bevelThickness
        : 6,
      T = void 0 !== e.bevelSize
        ? e.bevelSize
        : C - 2,
      _ = void 0 !== e.bevelSegments
        ? e.bevelSegments
        : 3,
      L = void 0 === e.bevelEnabled || e.bevelEnabled,
      M = void 0 !== e.curveSegments
        ? e.curveSegments
        : 12,
      S = void 0 !== e.steps
        ? e.steps
        : 1,
      O = e.extrudePath,
      D = !1,
      R = void 0 !== e.UVGenerator
        ? e.UVGenerator
        : ti.WorldUVGenerator;
    O && (
      d = O.getSpacedPoints(S), D = !0, L = !1, p = void 0 !== e.frames
      ? e.frames
      : O.computeFrenetFrames(S, !1),
    f = new l,
    m = new l,
    g = new l),
    L || (_ = 0, C = 0, T = 0);
    var U,
      A,
      I,
      P = this,
      B = t.extractPoints(M),
      N = B.shape,
      k = B.holes,
      H = !Is.isClockWise(N);
    if (H) {
      for (N = N.reverse(), A = 0, I = k.length; A < I; A++)
        U = k[A],
        Is.isClockWise(U) && (k[A] = U.reverse());
      H = !1
    }
    var F = Is.triangulateShape(N, k),
      G = N;
    for (A = 0, I = k.length; A < I; A++)
      U = k[A],
      N = N.concat(U);
    for (var V, z, q, W, j, X, Y = N.length, Z = F.length, K = [], Q = 0, J = G.length, $ = J - 1, tt = Q + 1; Q < J; Q++, $++, tt++)
      $ === J && ($ = 0),
      tt === J && (tt = 0),
      K[Q] = o(G[Q], G[$], G[tt]);
    var et,
      it = [],
      nt = K.concat();
    for (A = 0, I = k.length; A < I; A++) {
      for (U = k[A], et = [], Q = 0, J = U.length, $ = J - 1, tt = Q + 1; Q < J; Q++, $++, tt++)
        $ === J && ($ = 0),
        tt === J && (tt = 0),
        et[Q] = o(U[Q], U[$], U[tt]);
      it.push(et),
      nt = nt.concat(et)
    }
    for (V = 0; V < _; V++) {
      for (q = V / _, W = C * Math.cos(q * Math.PI / 2), z = T * Math.sin(q * Math.PI / 2), Q = 0, J = G.length; Q < J; Q++)
        j = n(G[Q], K[Q], z),
        a(j.x, j.y, -W);
      for (A = 0, I = k.length; A < I; A++)
        for (U = k[A], et = it[A], Q = 0, J = U.length; Q < J; Q++)
          j = n(U[Q], et[Q], z),
          a(j.x, j.y, -W)
    }
    for (z = T, Q = 0; Q < Y; Q++)
      j = L
        ? n(N[Q], nt[Q], z)
        : N[Q],
      D
        ? (m.copy(p.normals[0]).multiplyScalar(j.x), f.copy(p.binormals[0]).multiplyScalar(j.y), g.copy(d[0]).add(m).add(f), a(g.x, g.y, g.z))
        : a(j.x, j.y, 0);
    var ot;
    for (ot = 1; ot <= S; ot++)
      for (Q = 0; Q < Y; Q++)
        j = L
          ? n(N[Q], nt[Q], z)
          : N[Q],
        D
          ? (m.copy(p.normals[ot]).multiplyScalar(j.x), f.copy(p.binormals[ot]).multiplyScalar(j.y), g.copy(d[ot]).add(m).add(f), a(g.x, g.y, g.z))
          : a(j.x, j.y, w / S * ot);
    for (V = _ - 1; V >= 0; V--) {
      for (q = V / _, W = C * Math.cos(q * Math.PI / 2), z = T * Math.sin(q * Math.PI / 2), Q = 0, J = G.length; Q < J; Q++)
        j = n(G[Q], K[Q], z),
        a(j.x, j.y, w + W);
      for (A = 0, I = k.length; A < I; A++)
        for (U = k[A], et = it[A], Q = 0, J = U.length; Q < J; Q++)
          j = n(U[Q], et[Q], z),
          D
            ? a(j.x, j.y + d[S - 1].y, d[S - 1].x + W)
            : a(j.x, j.y, w + W)
      }
    !function() {
      var t = y.length / 3;
      if (L) {
        var i = 0,
          n = Y * i;
        for (Q = 0; Q < Z; Q++)
          X = F[Q],
          s(X[2] + n, X[1] + n, X[0] + n);
        for (i = S + 2 * _, n = Y * i, Q = 0; Q < Z; Q++)
          X = F[Q],
          s(X[0] + n, X[1] + n, X[2] + n)
      } else {
        for (Q = 0; Q < Z; Q++)
          X = F[Q],
          s(X[2], X[1], X[0]);
        for (Q = 0; Q < Z; Q++)
          X = F[Q],
          s(X[0] + Y * S, X[1] + Y * S, X[2] + Y * S)
      }
      P.addGroup(
        t, y.length / 3 - t, void 0 !== e.material
        ? e.material
        : 0)
    }(),
    function() {
      var t = y.length / 3,
        i = 0;
      for (r(G, i), i += G.length, A = 0, I = k.length; A < I; A++)
        U = k[A],
        r(U, i),
        i += U.length;
      P.addGroup(
        t, y.length / 3 - t, void 0 !== e.extrudeMaterial
        ? e.extrudeMaterial
        : 1)
    }(),
    e.arrays || (this.setIndex(E), this.addAttribute("position", new bt(y, 3)), this.addAttribute("uv", new bt(e.arrays.uv, 2)))
  },
  ti.WorldUVGenerator = {
    generateTopUV: function(t, e, n, o, r) {
      var a = e[3 * n],
        s = e[3 * n + 1],
        l = e[3 * o],
        c = e[3 * o + 1],
        h = e[3 * r],
        u = e[3 * r + 1];
      return [
        new i(a, s),
        new i(l, c),
        new i(h, u)
      ]
    },
    generateSideWallUV: function(t, e, n, o, r, a) {
      var s = e[3 * n],
        l = e[3 * n + 1],
        c = e[3 * n + 2],
        h = e[3 * o],
        u = e[3 * o + 1],
        d = e[3 * o + 2],
        p = e[3 * r],
        f = e[3 * r + 1],
        m = e[3 * r + 2],
        g = e[3 * a],
        v = e[3 * a + 1],
        y = e[3 * a + 2];
      return Math.abs(l - u) < .01
        ? [
          new i(s, 1 - c),
          new i(h, 1 - d),
          new i(p, 1 - m),
          new i(g, 1 - y)
        ]
        : [
          new i(l, 1 - c),
          new i(u, 1 - d),
          new i(f, 1 - m),
          new i(v, 1 - y)
        ]
    }
  },
  ii.prototype = Object.create(Lt.prototype),
  ii.prototype.constructor = ii,
  ni.prototype = Object.create(ei.prototype),
  ni.prototype.constructor = ni,
  oi.prototype = Object.create(Lt.prototype),
  oi.prototype.constructor = oi,
  ri.prototype = Object.create(Mt.prototype),
  ri.prototype.constructor = ri,
  ai.prototype = Object.create(Lt.prototype),
  ai.prototype.constructor = ai,
  si.prototype = Object.create(Mt.prototype),
  si.prototype.constructor = si,
  li.prototype = Object.create(Lt.prototype),
  li.prototype.constructor = li,
  ci.prototype = Object.create(Mt.prototype),
  ci.prototype.constructor = ci,
  hi.prototype = Object.create(Lt.prototype),
  hi.prototype.constructor = hi,
  ui.prototype = Object.create(Mt.prototype),
  ui.prototype.constructor = ui,
  di.prototype = Object.create(Mt.prototype),
  di.prototype.constructor = di,
  pi.prototype = Object.create(Lt.prototype),
  pi.prototype.constructor = pi,
  fi.prototype = Object.create(Mt.prototype),
  fi.prototype.constructor = fi,
  mi.prototype = Object.create(pi.prototype),
  mi.prototype.constructor = mi,
  gi.prototype = Object.create(fi.prototype),
  gi.prototype.constructor = gi,
  vi.prototype = Object.create(Lt.prototype),
  vi.prototype.constructor = vi,
  yi.prototype = Object.create(Mt.prototype),
  yi.prototype.constructor = yi;
  var Ps = Object.freeze({
    WireframeGeometry: Pe,
    ParametricGeometry: Be,
    ParametricBufferGeometry: Ne,
    TetrahedronGeometry: Fe,
    TetrahedronBufferGeometry: Ge,
    OctahedronGeometry: Ve,
    OctahedronBufferGeometry: ze,
    IcosahedronGeometry: qe,
    IcosahedronBufferGeometry: We,
    DodecahedronGeometry: je,
    DodecahedronBufferGeometry: Xe,
    PolyhedronGeometry: ke,
    PolyhedronBufferGeometry: He,
    TubeGeometry: Ye,
    TubeBufferGeometry: Ze,
    TorusKnotGeometry: Ke,
    TorusKnotBufferGeometry: Qe,
    TorusGeometry: Je,
    TorusBufferGeometry: $e,
    TextGeometry: ii,
    TextBufferGeometry: ni,
    SphereGeometry: oi,
    SphereBufferGeometry: ri,
    RingGeometry: ai,
    RingBufferGeometry: si,
    PlaneGeometry: Rt,
    PlaneBufferGeometry: Ut,
    LatheGeometry: li,
    LatheBufferGeometry: ci,
    ShapeGeometry: hi,
    ShapeBufferGeometry: ui,
    ExtrudeGeometry: ti,
    ExtrudeBufferGeometry: ei,
    EdgesGeometry: di,
    ConeGeometry: mi,
    ConeBufferGeometry: gi,
    CylinderGeometry: pi,
    CylinderBufferGeometry: fi,
    CircleGeometry: vi,
    CircleBufferGeometry: yi,
    BoxGeometry: Ot,
    BoxBufferGeometry: Dt
  });
  Ei.prototype = Object.create(Q.prototype),
  Ei.prototype.constructor = Ei,
  Ei.prototype.isShadowMaterial = !0,
  xi.prototype = Object.create(Q.prototype),
  xi.prototype.constructor = xi,
  xi.prototype.isRawShaderMaterial = !0,
  bi.prototype = Object.create(K.prototype),
  bi.prototype.constructor = bi,
  bi.prototype.isMeshStandardMaterial = !0,
  bi.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.defines = {
      STANDARD: ""
    },
    this.color.copy(t.color),
    this.roughness = t.roughness,
    this.metalness = t.metalness,
    this.map = t.map,
    this.lightMap = t.lightMap,
    this.lightMapIntensity = t.lightMapIntensity,
    this.aoMap = t.aoMap,
    this.aoMapIntensity = t.aoMapIntensity,
    this.emissive.copy(t.emissive),
    this.emissiveMap = t.emissiveMap,
    this.emissiveIntensity = t.emissiveIntensity,
    this.bumpMap = t.bumpMap,
    this.bumpScale = t.bumpScale,
    this.normalMap = t.normalMap,
    this.normalScale.copy(t.normalScale),
    this.displacementMap = t.displacementMap,
    this.displacementScale = t.displacementScale,
    this.displacementBias = t.displacementBias,
    this.roughnessMap = t.roughnessMap,
    this.metalnessMap = t.metalnessMap,
    this.alphaMap = t.alphaMap,
    this.envMap = t.envMap,
    this.envMapIntensity = t.envMapIntensity,
    this.refractionRatio = t.refractionRatio,
    this.wireframe = t.wireframe,
    this.wireframeLinewidth = t.wireframeLinewidth,
    this.wireframeLinecap = t.wireframeLinecap,
    this.wireframeLinejoin = t.wireframeLinejoin,
    this.skinning = t.skinning,
    this.morphTargets = t.morphTargets,
    this.morphNormals = t.morphNormals,
    this
  },
  wi.prototype = Object.create(bi.prototype),
  wi.prototype.constructor = wi,
  wi.prototype.isMeshPhysicalMaterial = !0,
  wi.prototype.copy = function(t) {
    return bi.prototype.copy.call(this, t),
    this.defines = {
      PHYSICAL: ""
    },
    this.reflectivity = t.reflectivity,
    this.clearCoat = t.clearCoat,
    this.clearCoatRoughness = t.clearCoatRoughness,
    this
  },
  Ci.prototype = Object.create(K.prototype),
  Ci.prototype.constructor = Ci,
  Ci.prototype.isMeshPhongMaterial = !0,
  Ci.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.color.copy(t.color),
    this.specular.copy(t.specular),
    this.shininess = t.shininess,
    this.map = t.map,
    this.lightMap = t.lightMap,
    this.lightMapIntensity = t.lightMapIntensity,
    this.aoMap = t.aoMap,
    this.aoMapIntensity = t.aoMapIntensity,
    this.emissive.copy(t.emissive),
    this.emissiveMap = t.emissiveMap,
    this.emissiveIntensity = t.emissiveIntensity,
    this.bumpMap = t.bumpMap,
    this.bumpScale = t.bumpScale,
    this.normalMap = t.normalMap,
    this.normalScale.copy(t.normalScale),
    this.displacementMap = t.displacementMap,
    this.displacementScale = t.displacementScale,
    this.displacementBias = t.displacementBias,
    this.specularMap = t.specularMap,
    this.alphaMap = t.alphaMap,
    this.envMap = t.envMap,
    this.combine = t.combine,
    this.reflectivity = t.reflectivity,
    this.refractionRatio = t.refractionRatio,
    this.wireframe = t.wireframe,
    this.wireframeLinewidth = t.wireframeLinewidth,
    this.wireframeLinecap = t.wireframeLinecap,
    this.wireframeLinejoin = t.wireframeLinejoin,
    this.skinning = t.skinning,
    this.morphTargets = t.morphTargets,
    this.morphNormals = t.morphNormals,
    this
  },
  Ti.prototype = Object.create(Ci.prototype),
  Ti.prototype.constructor = Ti,
  Ti.prototype.isMeshToonMaterial = !0,
  Ti.prototype.copy = function(t) {
    return Ci.prototype.copy.call(this, t),
    this.gradientMap = t.gradientMap,
    this
  },
  _i.prototype = Object.create(K.prototype),
  _i.prototype.constructor = _i,
  _i.prototype.isMeshNormalMaterial = !0,
  _i.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.bumpMap = t.bumpMap,
    this.bumpScale = t.bumpScale,
    this.normalMap = t.normalMap,
    this.normalScale.copy(t.normalScale),
    this.displacementMap = t.displacementMap,
    this.displacementScale = t.displacementScale,
    this.displacementBias = t.displacementBias,
    this.wireframe = t.wireframe,
    this.wireframeLinewidth = t.wireframeLinewidth,
    this.skinning = t.skinning,
    this.morphTargets = t.morphTargets,
    this.morphNormals = t.morphNormals,
    this
  },
  Li.prototype = Object.create(K.prototype),
  Li.prototype.constructor = Li,
  Li.prototype.isMeshLambertMaterial = !0,
  Li.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.color.copy(t.color),
    this.map = t.map,
    this.lightMap = t.lightMap,
    this.lightMapIntensity = t.lightMapIntensity,
    this.aoMap = t.aoMap,
    this.aoMapIntensity = t.aoMapIntensity,
    this.emissive.copy(t.emissive),
    this.emissiveMap = t.emissiveMap,
    this.emissiveIntensity = t.emissiveIntensity,
    this.specularMap = t.specularMap,
    this.alphaMap = t.alphaMap,
    this.envMap = t.envMap,
    this.combine = t.combine,
    this.reflectivity = t.reflectivity,
    this.refractionRatio = t.refractionRatio,
    this.wireframe = t.wireframe,
    this.wireframeLinewidth = t.wireframeLinewidth,
    this.wireframeLinecap = t.wireframeLinecap,
    this.wireframeLinejoin = t.wireframeLinejoin,
    this.skinning = t.skinning,
    this.morphTargets = t.morphTargets,
    this.morphNormals = t.morphNormals,
    this
  },
  Mi.prototype = Object.create(K.prototype),
  Mi.prototype.constructor = Mi,
  Mi.prototype.isLineDashedMaterial = !0,
  Mi.prototype.copy = function(t) {
    return K.prototype.copy.call(this, t),
    this.color.copy(t.color),
    this.linewidth = t.linewidth,
    this.scale = t.scale,
    this.dashSize = t.dashSize,
    this.gapSize = t.gapSize,
    this
  };
  var Bs = Object.freeze({
      ShadowMaterial: Ei,
      SpriteMaterial: ye,
      RawShaderMaterial: xi,
      ShaderMaterial: Q,
      PointsMaterial: Se,
      MeshPhysicalMaterial: wi,
      MeshStandardMaterial: bi,
      MeshPhongMaterial: Ci,
      MeshToonMaterial: Ti,
      MeshNormalMaterial: _i,
      MeshLambertMaterial: Li,
      MeshDepthMaterial: J,
      MeshBasicMaterial: dt,
      LineDashedMaterial: Mi,
      LineBasicMaterial: Te,
      Material: K
    }),
    Ns = {
      enabled: !1,
      files: {},
      add: function(t, e) {
        this.enabled !== !1 && (this.files[t] = e)
      },
      get: function(t) {
        if (this.enabled !== !1)
          return this.files[t]
      },
      remove: function(t) {
        delete this.files[t]
      },
      clear: function() {
        this.files = {}
      }
    },
    ks = new Si;
  Object.assign(Oi.prototype, {
    load: function(t, e, i, n) {
      void 0 === t && (t = ""),
      void 0 !== this.path && (t = this.path + t);
      var o = this,
        r = Ns.get(t);
      if (void 0 !== r)
        return o.manager.itemStart(t),
        setTimeout(function() {
          e && e(r),
          o.manager.itemEnd(t)
        }, 0),
        r;
      var a = t.match(/^data:(.*?)(;base64)?,(.*)$/);
      if (a) {
        var s = a[1],
          l = !!a[2],
          c = a[3];
        c = window.decodeURIComponent(c),
        l && (c = window.atob(c));
        try {
          var h,
            u = (this.responseType || "").toLowerCase();
          switch (u) {
            case "arraybuffer":
            case "blob":
              h = new ArrayBuffer(c.length);
              for (var d = new Uint8Array(h), p = 0; p < c.length; p++)
                d[p] = c.charCodeAt(p);

              "blob" === u && (h = new Blob([h], {type: s}));
              break;
            case "document":
              var f = new DOMParser;
              h = f.parseFromString(c, s);
              break;
            case "json":
              h = JSON.parse(c);
              break;
            default:
              h = c
          }
          window.setTimeout(function() {
            e && e(h),
            o.manager.itemEnd(t)
          }, 0)
        } catch (e) {
          window.setTimeout(function() {
            n && n(e),
            o.manager.itemEnd(t),
            o.manager.itemError(t)
          }, 0)
        }
      } else {
        var m = new XMLHttpRequest;
        m.open("GET", t, !0),
        m.addEventListener("load", function(i) {
          var r = i.target.response;
          Ns.add(t, r),
          200 === this.status
            ? (e && e(r), o.manager.itemEnd(t))
            : 0 === this.status
              ? (console.warn("THREE.FileLoader: HTTP Status 0 received."), e && e(r), o.manager.itemEnd(t))
              : (n && n(i), o.manager.itemEnd(t), o.manager.itemError(t))
        }, !1),
        void 0 !== i && m.addEventListener("progress", function(t) {
          i(t)
        }, !1),
        m.addEventListener("error", function(e) {
          n && n(e),
          o.manager.itemEnd(t),
          o.manager.itemError(t)
        }, !1),
        void 0 !== this.responseType && (m.responseType = this.responseType),
        void 0 !== this.withCredentials && (m.withCredentials = this.withCredentials),
        m.overrideMimeType && m.overrideMimeType(
          void 0 !== this.mimeType
          ? this.mimeType
          : "text/plain");
        for (var g in this.requestHeader)
          m.setRequestHeader(g, this.requestHeader[g]);
        m.send(null)
      }
      return o.manager.itemStart(t),
      m
    },
    setPath: function(t) {
      return this.path = t,
      this
    },
    setResponseType: function(t) {
      return this.responseType = t,
      this
    },
    setWithCredentials: function(t) {
      return this.withCredentials = t,
      this
    },
    setMimeType: function(t) {
      return this.mimeType = t,
      this
    },
    setRequestHeader: function(t) {
      return this.requestHeader = t,
      this
    }
  }),
  Object.assign(Di.prototype, {
    load: function(t, e, i, n) {
      var o = this,
        r = [],
        a = new Ue;
      a.image = r;
      var s = new Oi(this.manager);
      if (s.setPath(this.path), s.setResponseType("arraybuffer"), Array.isArray(t))
        for (var l = 0, c = 0, h = t.length; c < h; ++c)
          !function(c) {
            s.load(t[c], function(t) {
              var i = o._parser(t, !0);
              r[c] = {
                width: i.width,
                height: i.height,
                format: i.format,
                mipmaps: i.mipmaps
              },
              6 === (l += 1) && (1 === i.mipmapCount && (a.minFilter = Ta), a.format = i.format, a.needsUpdate = !0, e && e(a))
            }, i, n)
          }
        (c);
      else
        s.load(t, function(t) {
          var i = o._parser(t, !0);
          if (i.isCubemap)
            for (var n = i.mipmaps.length / i.mipmapCount, s = 0; s < n; s++) {
              r[s] = {
                mipmaps: []
              };
              for (var l = 0; l < i.mipmapCount; l++)
                r[s].mipmaps.push(i.mipmaps[s * i.mipmapCount + l]),
                r[s].format = i.format,
                r[s].width = i.width,
                r[s].height = i.height
            }
          else
            a.image.width = i.width,
            a.image.height = i.height,
            a.mipmaps = i.mipmaps;

          1 === i.mipmapCount && (a.minFilter = Ta),
          a.format = i.format,
          a.needsUpdate = !0,
          e && e(a)
        }, i, n);
      return a
    },
    setPath: function(t) {
      return this.path = t,
      this
    }
  }),
  Object.assign(Ri.prototype, {
    load: function(t, e, i, n) {
      var o = this,
        r = new h,
        a = new Oi(this.manager);
      return a.setResponseType("arraybuffer"),
      a.load(t, function(t) {
        var i = o._parser(t);
        i && (
          void 0 !== i.image
          ? r.image = i.image
          : void 0 !== i.data && (r.image.width = i.width, r.image.height = i.height, r.image.data = i.data),
        r.wrapS = void 0 !== i.wrapS
          ? i.wrapS
          : Ea,
        r.wrapT = void 0 !== i.wrapT
          ? i.wrapT
          : Ea,
        r.magFilter = void 0 !== i.magFilter
          ? i.magFilter
          : Ta,
        r.minFilter = void 0 !== i.minFilter
          ? i.minFilter
          : La,
        r.anisotropy = void 0 !== i.anisotropy
          ? i.anisotropy
          : 1,
        void 0 !== i.format && (r.format = i.format),
        void 0 !== i.type && (r.type = i.type),
        void 0 !== i.mipmaps && (r.mipmaps = i.mipmaps),
        1 === i.mipmapCount && (r.minFilter = Ta),
        r.needsUpdate = !0,
        e && e(r, i))
      }, i, n),
      r
    }
  }),
  Object.assign(Ui.prototype, {
    load: function(t, e, i, n) {
      void 0 === t && (t = ""),
      void 0 !== this.path && (t = this.path + t);
      var o = this,
        r = Ns.get(t);
      if (void 0 !== r)
        return o.manager.itemStart(t),
        setTimeout(function() {
          e && e(r),
          o.manager.itemEnd(t)
        }, 0),
        r;
      var a = document.createElementNS("http://www.w3.org/1999/xhtml", "img");
      return a.addEventListener("load", function() {
        Ns.add(t, this),
        e && e(this),
        o.manager.itemEnd(t)
      }, !1),
      a.addEventListener("error", function(e) {
        n && n(e),
        o.manager.itemEnd(t),
        o.manager.itemError(t)
      }, !1),
      "data:" !== t.substr(0, 5) && void 0 !== this.crossOrigin && (a.crossOrigin = this.crossOrigin),
      o.manager.itemStart(t),
      a.src = t,
      a
    },
    setCrossOrigin: function(t) {
      return this.crossOrigin = t,
      this
    },
    setPath: function(t) {
      return this.path = t,
      this
    }
  }),
  Object.assign(Ai.prototype, {
    load: function(t, e, i, n) {
      var o = new u,
        r = new Ui(this.manager);
      r.setCrossOrigin(this.crossOrigin),
      r.setPath(this.path);
      for (var a = 0, s = 0; s < t.length; ++s)
        !function(i) {
          r.load(t[i], function(t) {
            o.images[i] = t,
            6 == ++a && (o.needsUpdate = !0, e && e(o))
          }, void 0, n)
        }
      (s);
      return o
    },
    setCrossOrigin: function(t) {
      return this.crossOrigin = t,
      this
    },
    setPath: function(t) {
      return this.path = t,
      this
    }
  }),
  Object.assign(Ii.prototype, {
    load: function(t, e, i, o) {
      var r = new Ui(this.manager);
      r.setCrossOrigin(this.crossOrigin),
      r.setPath(this.path);
      var a = new n;
      return a.image = r.load(t, function() {
        var i = t.search(/\.(jpg|jpeg)$/) > 0 || 0 === t.search(/^data\:image\/jpeg/);
        a.format = i
          ? Fa
          : Ga,
        a.needsUpdate = !0,
        void 0 !== e && e(a)
      }, i, o),
      a
    },
    setCrossOrigin: function(t) {
      return this.crossOrigin = t,
      this
    },
    setPath: function(t) {
      return this.path = t,
      this
    }
  }),
  Pi.prototype = Object.assign(Object.create(lt.prototype), {
    constructor: Pi,
    isLight: !0,
    copy: function(t) {
      return lt.prototype.copy.call(this, t),
      this.color.copy(t.color),
      this.intensity = t.intensity,
      this
    },
    toJSON: function(t) {
      var e = lt.prototype.toJSON.call(this, t);
      return e.object.color = this.color.getHex(),
      e.object.intensity = this.intensity,
      void 0 !== this.groundColor && (e.object.groundColor = this.groundColor.getHex()),
      void 0 !== this.distance && (e.object.distance = this.distance),
      void 0 !== this.angle && (e.object.angle = this.angle),
      void 0 !== this.decay && (e.object.decay = this.decay),
      void 0 !== this.penumbra && (e.object.penumbra = this.penumbra),
      void 0 !== this.shadow && (e.object.shadow = this.shadow.toJSON()),
      e
    }
  }),
  Bi.prototype = Object.assign(Object.create(Pi.prototype), {
    constructor: Bi,
    isHemisphereLight: !0,
    copy: function(t) {
      return Pi.prototype.copy.call(this, t),
      this.groundColor.copy(t.groundColor),
      this
    }
  }),
  Object.assign(Ni.prototype, {
    copy: function(t) {
      return this.camera = t.camera.clone(),
      this.bias = t.bias,
      this.radius = t.radius,
      this.mapSize.copy(t.mapSize),
      this
    },
    clone: function() {
      return (new this.constructor).copy(this)
    },
    toJSON: function() {
      var t = {};
      return 0 !== this.bias && (t.bias = this.bias),
      1 !== this.radius && (t.radius = this.radius),
      512 === this.mapSize.x && 512 === this.mapSize.y || (t.mapSize = this.mapSize.toArray()),
      t.camera = this.camera.toJSON(!1).object,
      delete t.camera.matrix,
      t
    }
  }),
  ki.prototype = Object.assign(Object.create(Ni.prototype), {
    constructor: ki,
    isSpotLightShadow: !0,
    update: function(t) {
      var e = this.camera,
        i = 2 * gs.RAD2DEG * t.angle,
        n = this.mapSize.width / this.mapSize.height,
        o = t.distance || e.far;
      i === e.fov && n === e.aspect && o === e.far || (e.fov = i, e.aspect = n, e.far = o, e.updateProjectionMatrix())
    }
  }),
  Hi.prototype = Object.assign(Object.create(Pi.prototype), {
    constructor: Hi,
    isSpotLight: !0,
    copy: function(t) {
      return Pi.prototype.copy.call(this, t),
      this.distance = t.distance,
      this.angle = t.angle,
      this.penumbra = t.penumbra,
      this.decay = t.decay,
      this.target = t.target.clone(),
      this.shadow = t.shadow.clone(),
      this
    }
  }),
  Fi.prototype = Object.assign(Object.create(Pi.prototype), {
    constructor: Fi,
    isPointLight: !0,
    copy: function(t) {
      return Pi.prototype.copy.call(this, t),
      this.distance = t.distance,
      this.decay = t.decay,
      this.shadow = t.shadow.clone(),
      this
    }
  }),
  Gi.prototype = Object.assign(Object.create(Ni.prototype), {constructor: Gi}),
  Vi.prototype = Object.assign(Object.create(Pi.prototype), {
    constructor: Vi,
    isDirectionalLight: !0,
    copy: function(t) {
      return Pi.prototype.copy.call(this, t),
      this.target = t.target.clone(),
      this.shadow = t.shadow.clone(),
      this
    }
  }),
  zi.prototype = Object.assign(Object.create(Pi.prototype), {
    constructor: zi,
    isAmbientLight: !0
  }),
  qi.prototype = Object.assign(Object.create(Pi.prototype), {
    constructor: qi,
    isRectAreaLight: !0,
    copy: function(t) {
      return Pi.prototype.copy.call(this, t),
      this.width = t.width,
      this.height = t.height,
      this
    },
    toJSON: function(t) {
      var e = Pi.prototype.toJSON.call(this, t);
      return e.object.width = this.width,
      e.object.height = this.height,
      e
    }
  });
  var Hs = {
    arraySlice: function(t, e, i) {
      return Hs.isTypedArray(t)
        ? new t.constructor(t.subarray(
          e, void 0 !== i
          ? i
          : t.length))
        : t.slice(e, i)
    },
    convertArray: function(t, e, i) {
      return !t || !i && t.constructor === e
        ? t
        : "number" == typeof e.BYTES_PER_ELEMENT
          ? new e(t)
          : Array.prototype.slice.call(t)
    },
    isTypedArray: function(t) {
      return ArrayBuffer.isView(t) && !(t instanceof DataView)
    },
    getKeyframeOrder: function(t) {
      function e(e, i) {
        return t[e] - t[i]
      }
      for (var i = t.length, n = new Array(i), o = 0; o !== i; ++o)
        n[o] = o;
      return n.sort(e),
      n
    },
    sortedArray: function(t, e, i) {
      for (var n = t.length, o = new t.constructor(n), r = 0, a = 0; a !== n; ++r)
        for (var s = i[r] * e, l = 0; l !== e; ++l)
          o[a++] = t[s + l];
    return o
    },
    flattenJSON: function(t, e, i, n) {
      for (var o = 1, r = t[0]; void 0 !== r && void 0 === r[n];)
        r = t[o++];
      if (void 0 !== r) {
        var a = r[n];
        if (void 0 !== a)
          if (Array.isArray(a))
            do {
              a = r[n],
              void 0 !== a && (e.push(r.time), i.push.apply(i, a)),
              r = t[o++]
            } while (void 0 !== r);
          else if (void 0 !== a.toArray)
            do {
              a = r[n],
              void 0 !== a && (e.push(r.time), a.toArray(i, i.length)),
              r = t[o++]
            } while (void 0 !== r);
          else
            do {
              a = r[n],
              void 0 !== a && (e.push(r.time), i.push(a)),
              r = t[o++]
            } while (void 0 !== r)
      }
    }
  };
  Object.assign(Wi.prototype, {
    evaluate: function(t) {
      var e = this.parameterPositions,
        i = this._cachedIndex,
        n = e[i],
        o = e[i - 1];
      t : {
        e: {
          var r;
          i: {
            n: if (!(t < n)) {
              for (var a = i + 2;;) {
                if (void 0 === n) {
                  if (t < o)
                    break n;
                  return i = e.length,
                  this._cachedIndex = i,
                  this.afterEnd_(i - 1, t, o)
                }
                if (i === a)
                  break;
                if (o = n, n = e[++i], t < n)
                  break e
              }
              r = e.length;
              break i
          } {
            if(t >= o)
              break t;
            var s = e[1];
            t < s && (i = 2, o = s);
            for (var a = i - 2;;) {
              if (void 0 === o)
                return this._cachedIndex = 0,
                this.beforeStart_(0, t, n);
              if (i === a)
                break;
              if (n = o, o = e[--i - 1], t >= o)
                break e
            }
            r = i,
            i = 0
          }
        }
        for (; i < r;) {
          var l = i + r >>> 1;
          t < e[l]
            ? r = l
            : i = l + 1
        }
        if (n = e[i], void 0 === (o = e[i - 1]))
          return this._cachedIndex = 0,
          this.beforeStart_(0, t, n);
        if (void 0 === n)
          return i = e.length,
          this._cachedIndex = i,
          this.afterEnd_(i - 1, o, t)
      }
      this._cachedIndex = i,
      this.intervalChanged_(i, o, n)
    }
    return this.interpolate_(i, o, t, n)
  },
  settings: null,
  DefaultSettings_: {},
  getSettings_: function() {
    return this.settings || this.DefaultSettings_
  },
  copySampleValue_: function(t) {
    for (var e = this.resultBuffer, i = this.sampleValues, n = this.valueSize, o = t * n, r = 0; r !== n; ++r)
      e[r] = i[o + r];
    return e
  },
  interpolate_: function(t, e, i, n) {
    throw new Error("call to abstract method")
  },
  intervalChanged_: function(t, e, i) {}
}),
Object.assign(Wi.prototype, {
  beforeStart_: Wi.prototype.copySampleValue_,
  afterEnd_: Wi.prototype.copySampleValue_
}),
ji.prototype = Object.assign(Object.create(Wi.prototype), {
  constructor: ji,
  DefaultSettings_: {
    endingStart: ns,
    endingEnd: ns
  },
  intervalChanged_: function(t, e, i) {
    var n = this.parameterPositions,
      o = t - 2,
      r = t + 1,
      a = n[o],
      s = n[r];
    if (void 0 === a)
      switch (this.getSettings_().endingStart) {
        case 2401:
          o = t,
          a = 2 * e - i;
          break;
        case 2402:
          o = n.length - 2,
          a = e + n[o] - n[o + 1];
          break;
        default:
          o = t,
          a = i
      }
    if (void 0 === s)
      switch (this.getSettings_().endingEnd) {
        case 2401:
          r = t,
          s = 2 * i - e;
          break;
        case 2402:
          r = 1,
          s = i + n[1] - n[0];
          break;
        default:
          r = t - 1,
          s = e
      }
    var l = .5 * (i - e),
      c = this.valueSize;
    this._weightPrev = l / (e - a),
    this._weightNext = l / (s - i),
    this._offsetPrev = o * c,
    this._offsetNext = r * c
  },
  interpolate_: function(t, e, i, n) {
    for (var o = this.resultBuffer, r = this.sampleValues, a = this.valueSize, s = t * a, l = s - a, c = this._offsetPrev, h = this._offsetNext, u = this._weightPrev, d = this._weightNext, p = (i - e) / (n - e), f = p * p, m = f * p, g = -u * m + 2 * u * f - u * p, v = (1 + u) * m + (-1.5 - 2 * u) * f + (-.5 + u) * p + 1, y = (-1 - d) * m + (1.5 + d) * f + .5 * p, E = d * m - d * f, x = 0; x !== a; ++x)
      o[x] = g * r[c + x] + v * r[l + x] + y * r[s + x] + E * r[h + x];
    return o
  }
}),
Xi.prototype = Object.assign(Object.create(Wi.prototype), {
  constructor: Xi,
  interpolate_: function(t, e, i, n) {
    for (var o = this.resultBuffer, r = this.sampleValues, a = this.valueSize, s = t * a, l = s - a, c = (i - e) / (n - e), h = 1 - c, u = 0; u !== a; ++u)
      o[u] = r[l + u] * h + r[s + u] * c;
    return o
  }
}),
Yi.prototype = Object.assign(Object.create(Wi.prototype), {
  constructor: Yi,
  interpolate_: function(t, e, i, n) {
    return this.copySampleValue_(t - 1)
  }
});
var Fs;
Fs = {
  TimeBufferType: Float32Array,
  ValueBufferType: Float32Array,
  DefaultInterpolation: 2301,
  InterpolantFactoryMethodDiscrete: function(t) {
    return new Yi(this.times, this.values, this.getValueSize(), t)
  },
  InterpolantFactoryMethodLinear: function(t) {
    return new Xi(this.times, this.values, this.getValueSize(), t)
  },
  InterpolantFactoryMethodSmooth: function(t) {
    return new ji(this.times, this.values, this.getValueSize(), t)
  },
  setInterpolation: function(t) {
    var e;
    switch (t) {
      case 2300:
        e = this.InterpolantFactoryMethodDiscrete;
        break;
      case 2301:
        e = this.InterpolantFactoryMethodLinear;
        break;
      case 2302:
        e = this.InterpolantFactoryMethodSmooth
    }
    if (void 0 === e) {
      var i = "unsupported interpolation for " + this.ValueTypeName + " keyframe track named " + this.name;
      if (void 0 === this.createInterpolant) {
        if (t === this.DefaultInterpolation)
          throw new Error(i);
        this.setInterpolation(this.DefaultInterpolation)
      }
      return void console.warn(i)
    }
    this.createInterpolant = e
  },
  getInterpolation: function() {
    switch (this.createInterpolant) {
      case this.InterpolantFactoryMethodDiscrete:
        return 2300;
      case this.InterpolantFactoryMethodLinear:
        return 2301;
      case this.InterpolantFactoryMethodSmooth:
        return 2302
    }
  },
  getValueSize: function() {
    return this.values.length / this.times.length
  },
  shift: function(t) {
    if (0 !== t)
      for (var e = this.times, i = 0, n = e.length; i !== n; ++i)
        e[i] += t;
  return this
  },
  scale: function(t) {
    if (1 !== t)
      for (var e = this.times, i = 0, n = e.length; i !== n; ++i)
        e[i] *= t;
  return this
  },
  trim: function(t, e) {
    for (var i = this.times, n = i.length, o = 0, r = n - 1; o !== n && i[o] < t;)
      ++o;
    for (; r !== -1 && i[r] > e;)
      --r;
    if (++r, 0 !== o || r !== n) {
      o >= r && (r = Math.max(r, 1), o = r - 1);
      var a = this.getValueSize();
      this.times = Hs.arraySlice(i, o, r),
      this.values = Hs.arraySlice(this.values, o * a, r * a)
    }
    return this
  },
  validate: function() {
    var t = !0,
      e = this.getValueSize();
    e - Math.floor(e) != 0 && (console.error("invalid value size in track", this), t = !1);
    var i = this.times,
      n = this.values,
      o = i.length;
    0 === o && (console.error("track is empty", this), t = !1);
    for (var r = null, a = 0; a !== o; a++) {
      var s = i[a];
      if ("number" == typeof s && isNaN(s)) {
        console.error("time is not a valid number", this, a, s),
        t = !1;
        break
      }
      if (null !== r && r > s) {
        console.error("out of order keys", this, a, s, r),
        t = !1;
        break
      }
      r = s
    }
    if (void 0 !== n && Hs.isTypedArray(n))
      for (var a = 0, l = n.length; a !== l; ++a) {
        var c = n[a];
        if (isNaN(c)) {
          console.error("value is not a valid number", this, a, c),
          t = !1;
          break
        }
      }
    return t
  },
  optimize: function() {
    for (var t = this.times, e = this.values, i = this.getValueSize(), n = 2302 === this.getInterpolation(), o = 1, r = t.length - 1, a = 1; a < r; ++a) {
      var s = !1,
        l = t[a];
      if (l !== t[a + 1] && (1 !== a || l !== l[0]))
        if (n)
          s = !0;
        else
          for (var c = a * i, h = c - i, u = c + i, d = 0; d !== i; ++d) {
            var p = e[c + d];
            if (p !== e[h + d] || p !== e[u + d]) {
              s = !0;
              break
            }
          }
        if (s) {
        if (a !== o) {
          t[o] = t[a];
          for (var f = a * i, m = o * i, d = 0; d !== i; ++d)
            e[m + d] = e[f + d]
        }
        ++o
      }
    }
    if (r > 0) {
      t[o] = t[r];
      for (var f = r * i, m = o * i, d = 0; d !== i; ++d)
        e[m + d] = e[f + d];

      ++o
    }
    return o !== t.length && (this.times = Hs.arraySlice(t, 0, o), this.values = Hs.arraySlice(e, 0, o * i)),
    this
  }
},
Ki.prototype = Object.assign(Object.create(Fs), {
  constructor: Ki,
  ValueTypeName: "vector"
}),
Qi.prototype = Object.assign(Object.create(Wi.prototype), {
  constructor: Qi,
  interpolate_: function(t, e, i, n) {
    for (var o = this.resultBuffer, r = this.sampleValues, a = this.valueSize, l = t * a, c = (i - e) / (n - e), h = l + a; l !== h; l += 4)
      s.slerpFlat(o, 0, r, l - a, r, l, c);
    return o
  }
}),
Ji.prototype = Object.assign(Object.create(Fs), {
  constructor: Ji,
  ValueTypeName: "quaternion",
  DefaultInterpolation: 2301,
  InterpolantFactoryMethodLinear: function(t) {
    return new Qi(this.times, this.values, this.getValueSize(), t)
  },
  InterpolantFactoryMethodSmooth: void 0
}),
$i.prototype = Object.assign(Object.create(Fs), {
  constructor: $i,
  ValueTypeName: "number"
}),
tn.prototype = Object.assign(Object.create(Fs), {
  constructor: tn,
  ValueTypeName: "string",
  ValueBufferType: Array,
  DefaultInterpolation: 2300,
  InterpolantFactoryMethodLinear: void 0,
  InterpolantFactoryMethodSmooth: void 0
}),
en.prototype = Object.assign(Object.create(Fs), {
  constructor: en,
  ValueTypeName: "bool",
  ValueBufferType: Array,
  DefaultInterpolation: 2300,
  InterpolantFactoryMethodLinear: void 0,
  InterpolantFactoryMethodSmooth: void 0
}),
nn.prototype = Object.assign(Object.create(Fs), {
  constructor: nn,
  ValueTypeName: "color"
}),
on.prototype = Fs,
Fs.constructor = on,
Object.assign(on, {
  parse: function(t) {
    if (void 0 === t.type)
      throw new Error("track type undefined, can not parse");
    var e = on._getTrackTypeForValueTypeName(t.type);
    if (void 0 === t.times) {
      var i = [],
        n = [];
      Hs.flattenJSON(t.keys, i, n, "value"),
      t.times = i,
      t.values = n
    }
    return void 0 !== e.parse
      ? e.parse(t)
      : new e(t.name, t.times, t.values, t.interpolation)
  },
  toJSON: function(t) {
    var e,
      i = t.constructor;
    if (void 0 !== i.toJSON)
      e = i.toJSON(t);
    else {
      e = {
        name: t.name,
        times: Hs.convertArray(t.times, Array),
        values: Hs.convertArray(t.values, Array)
      };
      var n = t.getInterpolation();
      n !== t.DefaultInterpolation && (e.interpolation = n)
    }
    return e.type = t.ValueTypeName,
    e
  },
  _getTrackTypeForValueTypeName: function(t) {
    switch (t.toLowerCase()) {
      case "scalar":
      case "double":
      case "float":
      case "number":
      case "integer":
        return $i;
      case "vector":
      case "vector2":
      case "vector3":
      case "vector4":
        return Ki;
      case "color":
        return nn;
      case "quaternion":
        return Ji;
      case "bool":
      case "boolean":
        return en;
      case "string":
        return tn
    }
    throw new Error("Unsupported typeName: " + t)
  }
}),
Object.assign(rn, {
  parse: function(t) {
    for (var e = [], i = t.tracks, n = 1 / (t.fps || 1), o = 0, r = i.length; o !== r; ++o)
      e.push(on.parse(i[o]).scale(n));
    return new rn(t.name, t.duration, e)
  },
  toJSON: function(t) {
    for (var e = [], i = t.tracks, n = {
      name: t.name,
      duration: t.duration,
      tracks: e
    }, o = 0, r = i.length; o !== r; ++o)
      e.push(on.toJSON(i[o]));
    return n
  },
  CreateFromMorphTargetSequence: function(t, e, i, n) {
    for (var o = e.length, r = [], a = 0; a < o; a++) {
      var s = [],
        l = [];
      s.push((a + o - 1) % o, a, (a + 1) % o),
      l.push(0, 1, 0);
      var c = Hs.getKeyframeOrder(s);
      s = Hs.sortedArray(s, 1, c),
      l = Hs.sortedArray(l, 1, c),
      n || 0 !== s[0] || (s.push(o), l.push(l[0])),
      r.push(new $i(".morphTargetInfluences[" + e[a].name + "]", s, l).scale(1 / i))
    }
    return new rn(t, -1, r)
  },
  findByName: function(t, e) {
    var i = t;
    if (!Array.isArray(t)) {
      var n = t;
      i = n.geometry && n.geometry.animations || n.animations
    }
    for (var o = 0; o < i.length; o++)
      if (i[o].name === e)
        return i[o];
  return null
  },
  CreateClipsFromMorphTargetSequences: function(t, e, i) {
    for (var n = {}, o = 0, r = t.length; o < r; o++) {
      var a = t[o],
        s = a.name.match(/^([\w-]*?)([\d]+)$/);
      if (s && s.length > 1) {
        var l = s[1],
          c = n[l];
        c || (n[l] = c = []),
        c.push(a)
      }
    }
    var h = [];
    for (var l in n)
      h.push(rn.CreateFromMorphTargetSequence(l, n[l], e, i));
    return h
  },
  parseAnimation: function(t, e) {
    if (!t)
      return console.error("  no animation in JSONLoader data"),
      null;
    for (var i = function(t, e, i, n, o) {
      if (0 !== i.length) {
        var r = [],
          a = [];
        Hs.flattenJSON(i, r, a, n),
        0 !== r.length && o.push(new t(e, r, a))
      }
    }, n = [], o = t.name || "default", r = t.length || -1, a = t.fps || 30, s = t.hierarchy || [], l = 0; l < s.length; l++) {
      var c = s[l].keys;
      if (c && 0 !== c.length)
        if (c[0].morphTargets) {
          for (var h = {}, u = 0; u < c.length; u++)
            if (c[u].morphTargets)
              for (var d = 0; d < c[u].morphTargets.length; d++)
                h[c[u].morphTargets[d]] = -1;
        for (var p in h) {
            for (var f = [], m = [], d = 0; d !== c[u].morphTargets.length; ++d) {
              var g = c[u];
              f.push(g.time),
              m.push(
                g.morphTarget === p
                ? 1
                : 0)
            }
            n.push(new $i(".morphTargetInfluence[" + p + "]", f, m))
          }
          r = h.length * (a || 1)
        }
      else {
        var v = ".bones[" + e[l].name + "]";
        i(Ki, v + ".position", c, "pos", n),
        i(Ji, v + ".quaternion", c, "rot", n),
        i(Ki, v + ".scale", c, "scl", n)
      }
    }
    return 0 === n.length
      ? null
      : new rn(o, r, n)
  }
}),
Object.assign(rn.prototype, {
  resetDuration: function() {
    for (var t = this.tracks, e = 0, i = 0, n = t.length; i !== n; ++i) {
      var o = this.tracks[i];
      e = Math.max(e, o.times[o.times.length - 1])
    }
    this.duration = e
  },
  trim: function() {
    for (var t = 0; t < this.tracks.length; t++)
      this.tracks[t].trim(0, this.duration);
    return this
  },
  optimize: function() {
    for (var t = 0; t < this.tracks.length; t++)
      this.tracks[t].optimize();
    return this
  }
}),
Object.assign(an.prototype, {
  load: function(t, e, i, n) {
    var o = this,
      r = new Oi(o.manager);
    r.setResponseType("json"),
    r.load(t, function(t) {
      e(o.parse(t))
    }, i, n)
  },
  setTextures: function(t) {
    this.textures = t
  },
  parse: function(t) {
    function e(t) {
      return void 0 === n[t] && console.warn("THREE.MaterialLoader: Undefined texture", t),
      n[t]
    }
    var n = this.textures,
      o = new Bs[t.type];
    if (void 0 !== t.uuid && (o.uuid = t.uuid), void 0 !== t.name && (o.name = t.name), void 0 !== t.color && o.color.setHex(t.color), void 0 !== t.roughness && (o.roughness = t.roughness), void 0 !== t.metalness && (o.metalness = t.metalness), void 0 !== t.emissive && o.emissive.setHex(t.emissive), void 0 !== t.specular && o.specular.setHex(t.specular), void 0 !== t.shininess && (o.shininess = t.shininess), void 0 !== t.clearCoat && (o.clearCoat = t.clearCoat), void 0 !== t.clearCoatRoughness && (o.clearCoatRoughness = t.clearCoatRoughness), void 0 !== t.uniforms && (o.uniforms = t.uniforms), void 0 !== t.vertexShader && (o.vertexShader = t.vertexShader), void 0 !== t.fragmentShader && (o.fragmentShader = t.fragmentShader), void 0 !== t.vertexColors && (o.vertexColors = t.vertexColors), void 0 !== t.fog && (o.fog = t.fog), void 0 !== t.shading && (o.shading = t.shading), void 0 !== t.blending && (o.blending = t.blending), void 0 !== t.side && (o.side = t.side), void 0 !== t.opacity && (o.opacity = t.opacity), void 0 !== t.transparent && (o.transparent = t.transparent), void 0 !== t.alphaTest && (o.alphaTest = t.alphaTest), void 0 !== t.depthTest && (o.depthTest = t.depthTest), void 0 !== t.depthWrite && (o.depthWrite = t.depthWrite), void 0 !== t.colorWrite && (o.colorWrite = t.colorWrite), void 0 !== t.wireframe && (o.wireframe = t.wireframe), void 0 !== t.wireframeLinewidth && (o.wireframeLinewidth = t.wireframeLinewidth), void 0 !== t.wireframeLinecap && (o.wireframeLinecap = t.wireframeLinecap), void 0 !== t.wireframeLinejoin && (o.wireframeLinejoin = t.wireframeLinejoin), void 0 !== t.skinning && (o.skinning = t.skinning), void 0 !== t.morphTargets && (o.morphTargets = t.morphTargets), void 0 !== t.size && (o.size = t.size), void 0 !== t.sizeAttenuation && (o.sizeAttenuation = t.sizeAttenuation), void 0 !== t.map && (o.map = e(t.map)), void 0 !== t.alphaMap && (o.alphaMap = e(t.alphaMap), o.transparent = !0), void 0 !== t.bumpMap && (o.bumpMap = e(t.bumpMap)), void 0 !== t.bumpScale && (o.bumpScale = t.bumpScale), void 0 !== t.normalMap && (o.normalMap = e(t.normalMap)), void 0 !== t.normalScale) {
      var r = t.normalScale;
      Array.isArray(r) === !1 && (r = [r, r]),
      o.normalScale = (new i).fromArray(r)
    }
    return void 0 !== t.displacementMap && (o.displacementMap = e(t.displacementMap)),
    void 0 !== t.displacementScale && (o.displacementScale = t.displacementScale),
    void 0 !== t.displacementBias && (o.displacementBias = t.displacementBias),
    void 0 !== t.roughnessMap && (o.roughnessMap = e(t.roughnessMap)),
    void 0 !== t.metalnessMap && (o.metalnessMap = e(t.metalnessMap)),
    void 0 !== t.emissiveMap && (o.emissiveMap = e(t.emissiveMap)),
    void 0 !== t.emissiveIntensity && (o.emissiveIntensity = t.emissiveIntensity),
    void 0 !== t.specularMap && (o.specularMap = e(t.specularMap)),
    void 0 !== t.envMap && (o.envMap = e(t.envMap)),
    void 0 !== t.reflectivity && (o.reflectivity = t.reflectivity),
    void 0 !== t.lightMap && (o.lightMap = e(t.lightMap)),
    void 0 !== t.lightMapIntensity && (o.lightMapIntensity = t.lightMapIntensity),
    void 0 !== t.aoMap && (o.aoMap = e(t.aoMap)),
    void 0 !== t.aoMapIntensity && (o.aoMapIntensity = t.aoMapIntensity),
    void 0 !== t.gradientMap && (o.gradientMap = e(t.gradientMap)),
    o
  }
}),
Object.assign(sn.prototype, {
  load: function(t, e, i, n) {
    var o = this,
      r = new Oi(o.manager);
    r.setResponseType("json"),
    r.load(t, function(t) {
      e(o.parse(t))
    }, i, n)
  },
  parse: function(t) {
    var e = new Mt,
      i = t.data.index;
    if (void 0 !== i) {
      var n = new Gs[i.type](i.array);
      e.setIndex(new pt(n, 1))
    }
    var o = t.data.attributes;
    for (var r in o) {
      var a = o[r],
        n = new Gs[a.type](a.array);
      e.addAttribute(r, new pt(n, a.itemSize, a.normalized))
    }
    var s = t.data.groups || t.data.drawcalls || t.data.offsets;
    if (void 0 !== s)
      for (var c = 0, h = s.length; c !== h; ++c) {
        var u = s[c];
        e.addGroup(u.start, u.count, u.materialIndex)
      }
    var d = t.data.boundingSphere;
    if (void 0 !== d) {
      var p = new l;
      void 0 !== d.center && p.fromArray(d.center),
      e.boundingSphere = new tt(p, d.radius)
    }
    return e
  }
});
var Gs = {
  Int8Array: Int8Array,
  Uint8Array: Uint8Array,
  Uint8ClampedArray: Uint8ClampedArray,
  Int16Array: Int16Array,
  Uint16Array: Uint16Array,
  Int32Array: Int32Array,
  Uint32Array: Uint32Array,
  Float32Array: Float32Array,
  Float64Array: Float64Array
};
ln.Handlers = {
  handlers: [],
  add: function(t, e) {
    this.handlers.push(t, e)
  },
  get: function(t) {
    for (var e = this.handlers, i = 0, n = e.length; i < n; i += 2) {
      var o = e[i],
        r = e[i + 1];
      if (o.test(t))
        return r
    }
    return null
  }
},
Object.assign(ln.prototype, {
  crossOrigin: void 0,
  extractUrlBase: function(t) {
    var e = t.split("/");
    return 1 === e.length
      ? "./"
      : (e.pop(), e.join("/") + "/")
  },
  initMaterials: function(t, e, i) {
    for (var n = [], o = 0; o < t.length; ++o)
      n[o] = this.createMaterial(t[o], e, i);
    return n
  },
  createMaterial: function() {
    var t = {
        NoBlending: Mr,
        NormalBlending: Sr,
        AdditiveBlending: Or,
        SubtractiveBlending: Dr,
        MultiplyBlending: Rr,
        CustomBlending: Ur
      },
      e = new j,
      i = new Ii,
      n = new an;
    return function(o, r, a) {
      function s(t, e, n, o, s) {
        var c,
          h = r + t,
          u = ln.Handlers.get(h);
        null !== u
          ? c = u.load(h)
          : (i.setCrossOrigin(a), c = i.load(h)),
        void 0 !== e && (c.repeat.fromArray(e), 1 !== e[0] && (c.wrapS = ya), 1 !== e[1] && (c.wrapT = ya)),
        void 0 !== n && c.offset.fromArray(n),
        void 0 !== o && ("repeat" === o[0] && (c.wrapS = ya), "mirror" === o[0] && (c.wrapS = xa), "repeat" === o[1] && (c.wrapT = ya), "mirror" === o[1] && (c.wrapT = xa)),
        void 0 !== s && (c.anisotropy = s);
        var d = gs.generateUUID();
        return l[d] = c,
        d
      }
      var l = {},
        c = {
          uuid: gs.generateUUID(),
          type: "MeshLambertMaterial"
        };
      for (var h in o) {
        var u = o[h];
        switch (h) {
          case "DbgColor":
          case "DbgIndex":
          case "opticalDensity":
          case "illumination":
            break;
          case "DbgName":
            c.name = u;
            break;
          case "blending":
            c.blending = t[u];
            break;
          case "colorAmbient":
          case "mapAmbient":
            console.warn("THREE.Loader.createMaterial:", h, "is no longer supported.");
            break;
          case "colorDiffuse":
            c.color = e.fromArray(u).getHex();
            break;
          case "colorSpecular":
            c.specular = e.fromArray(u).getHex();
            break;
          case "colorEmissive":
            c.emissive = e.fromArray(u).getHex();
            break;
          case "specularCoef":
            c.shininess = u;
            break;
          case "shading":
            "basic" === u.toLowerCase() && (c.type = "MeshBasicMaterial"),
            "phong" === u.toLowerCase() && (c.type = "MeshPhongMaterial"),
            "standard" === u.toLowerCase() && (c.type = "MeshStandardMaterial");
            break;
          case "mapDiffuse":
            c.map = s(u, o.mapDiffuseRepeat, o.mapDiffuseOffset, o.mapDiffuseWrap, o.mapDiffuseAnisotropy);
            break;
          case "mapDiffuseRepeat":
          case "mapDiffuseOffset":
          case "mapDiffuseWrap":
          case "mapDiffuseAnisotropy":
            break;
          case "mapEmissive":
            c.emissiveMap = s(u, o.mapEmissiveRepeat, o.mapEmissiveOffset, o.mapEmissiveWrap, o.mapEmissiveAnisotropy);
            break;
          case "mapEmissiveRepeat":
          case "mapEmissiveOffset":
          case "mapEmissiveWrap":
          case "mapEmissiveAnisotropy":
            break;
          case "mapLight":
            c.lightMap = s(u, o.mapLightRepeat, o.mapLightOffset, o.mapLightWrap, o.mapLightAnisotropy);
            break;
          case "mapLightRepeat":
          case "mapLightOffset":
          case "mapLightWrap":
          case "mapLightAnisotropy":
            break;
          case "mapAO":
            c.aoMap = s(u, o.mapAORepeat, o.mapAOOffset, o.mapAOWrap, o.mapAOAnisotropy);
            break;
          case "mapAORepeat":
          case "mapAOOffset":
          case "mapAOWrap":
          case "mapAOAnisotropy":
            break;
          case "mapBump":
            c.bumpMap = s(u, o.mapBumpRepeat, o.mapBumpOffset, o.mapBumpWrap, o.mapBumpAnisotropy);
            break;
          case "mapBumpScale":
            c.bumpScale = u;
            break;
          case "mapBumpRepeat":
          case "mapBumpOffset":
          case "mapBumpWrap":
          case "mapBumpAnisotropy":
            break;
          case "mapNormal":
            c.normalMap = s(u, o.mapNormalRepeat, o.mapNormalOffset, o.mapNormalWrap, o.mapNormalAnisotropy);
            break;
          case "mapNormalFactor":
            c.normalScale = [u, u];
            break;
          case "mapNormalRepeat":
          case "mapNormalOffset":
          case "mapNormalWrap":
          case "mapNormalAnisotropy":
            break;
          case "mapSpecular":
            c.specularMap = s(u, o.mapSpecularRepeat, o.mapSpecularOffset, o.mapSpecularWrap, o.mapSpecularAnisotropy);
            break;
          case "mapSpecularRepeat":
          case "mapSpecularOffset":
          case "mapSpecularWrap":
          case "mapSpecularAnisotropy":
            break;
          case "mapMetalness":
            c.metalnessMap = s(u, o.mapMetalnessRepeat, o.mapMetalnessOffset, o.mapMetalnessWrap, o.mapMetalnessAnisotropy);
            break;
          case "mapMetalnessRepeat":
          case "mapMetalnessOffset":
          case "mapMetalnessWrap":
          case "mapMetalnessAnisotropy":
            break;
          case "mapRoughness":
            c.roughnessMap = s(u, o.mapRoughnessRepeat, o.mapRoughnessOffset, o.mapRoughnessWrap, o.mapRoughnessAnisotropy);
            break;
          case "mapRoughnessRepeat":
          case "mapRoughnessOffset":
          case "mapRoughnessWrap":
          case "mapRoughnessAnisotropy":
            break;
          case "mapAlpha":
            c.alphaMap = s(u, o.mapAlphaRepeat, o.mapAlphaOffset, o.mapAlphaWrap, o.mapAlphaAnisotropy);
            break;
          case "mapAlphaRepeat":
          case "mapAlphaOffset":
          case "mapAlphaWrap":
          case "mapAlphaAnisotropy":
            break;
          case "flipSided":
            c.side = xr;
            break;
          case "doubleSided":
            c.side = br;
            break;
          case "transparency":
            console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),
            c.opacity = u;
            break;
          case "depthTest":
          case "depthWrite":
          case "colorWrite":
          case "opacity":
          case "reflectivity":
          case "transparent":
          case "visible":
          case "wireframe":
            c[h] = u;
            break;
          case "vertexColors":
            u === !0 && (c.vertexColors = Lr),
            "face" === u && (c.vertexColors = _r);
            break;
          default:
            console.error("THREE.Loader.createMaterial: Unsupported", h, u)
        }
      }
      return "MeshBasicMaterial" === c.type && delete c.emissive,
      "MeshPhongMaterial" !== c.type && delete c.specular,
      c.opacity < 1 && (c.transparent = !0),
      n.setTextures(l),
      n.parse(c)
    }
  }()
}),
Object.assign(cn.prototype, {
  load: function(t, e, i, n) {
    var o = this,
      r = this.texturePath && "string" == typeof this.texturePath
        ? this.texturePath
        : ln.prototype.extractUrlBase(t),
      a = new Oi(this.manager);
    a.setResponseType("json"),
    a.setWithCredentials(this.withCredentials),
    a.load(t, function(i) {
      var n = i.metadata;
      if (void 0 !== n) {
        var a = n.type;
        if (void 0 !== a) {
          if ("object" === a.toLowerCase())
            return void console.error("THREE.JSONLoader: " + t + " should be loaded with THREE.ObjectLoader instead.");
          if ("scene" === a.toLowerCase())
            return void console.error("THREE.JSONLoader: " + t + " should be loaded with THREE.SceneLoader instead.")
        }
      }
      var s = o.parse(i, r);
      e(s.geometry, s.materials)
    }, i, n)
  },
  setTexturePath: function(t) {
    this.texturePath = t
  },
  parse: function() {
    function t(t, e) {
      function n(t, e) {
        return t & 1 << e
      }
      var o,
        r,
        a,
        s,
        c,
        h,
        u,
        d,
        p,
        f,
        m,
        g,
        v,
        y,
        E,
        x,
        b,
        w,
        C,
        T,
        _,
        L,
        M,
        S,
        O,
        D,
        R,
        U = t.faces,
        A = t.vertices,
        I = t.normals,
        P = t.colors,
        B = t.scale,
        N = 0;
      if (void 0 !== t.uvs) {
        for (o = 0; o < t.uvs.length; o++)
          t.uvs[o].length && N++;
        for (o = 0; o < N; o++)
          e.faceVertexUvs[o] = []
      }
      for (s = 0, c = A.length; s < c;)
        w = new l,
        w.x = A[s++] * B,
        w.y = A[s++] * B,
        w.z = A[s++] * B,
        e.vertices.push(w);
      for (s = 0, c = U.length; s < c;)
        if (f = U[s++], m = n(f, 0), g = n(f, 1), v = n(f, 3), y = n(f, 4), E = n(f, 5), x = n(f, 6), b = n(f, 7), m) {
          if (T = new ut, T.a = U[s], T.b = U[s + 1], T.c = U[s + 3], _ = new ut, _.a = U[s + 1], _.b = U[s + 2], _.c = U[s + 3], s += 4, g && (p = U[s++], T.materialIndex = p, _.materialIndex = p), a = e.faces.length, v)
            for (o = 0; o < N; o++)
              for (S = t.uvs[o], e.faceVertexUvs[o][a] = [], e.faceVertexUvs[o][a + 1] = [], r = 0; r < 4; r++)
                d = U[s++],
                D = S[2 * d],
                R = S[2 * d + 1],
                O = new i(D, R),
                2 !== r && e.faceVertexUvs[o][a].push(O),
                0 !== r && e.faceVertexUvs[o][a + 1].push(O);
        if (y && (u = 3 * U[s++], T.normal.set(I[u++], I[u++], I[u]), _.normal.copy(T.normal)), E)
            for (o = 0; o < 4; o++)
              u = 3 * U[s++],
              M = new l(I[u++], I[u++], I[u]),
              2 !== o && T.vertexNormals.push(M),
              0 !== o && _.vertexNormals.push(M);
        if (x && (h = U[s++], L = P[h], T.color.setHex(L), _.color.setHex(L)), b)
            for (o = 0; o < 4; o++)
              h = U[s++],
              L = P[h],
              2 !== o && T.vertexColors.push(new j(L)),
              0 !== o && _.vertexColors.push(new j(L));
        e.faces.push(T),
          e.faces.push(_)
        }
      else {
        if (C = new ut, C.a = U[s++], C.b = U[s++], C.c = U[s++], g && (p = U[s++], C.materialIndex = p), a = e.faces.length, v)
          for (o = 0; o < N; o++)
            for (S = t.uvs[o], e.faceVertexUvs[o][a] = [], r = 0; r < 3; r++)
              d = U[s++],
              D = S[2 * d],
              R = S[2 * d + 1],
              O = new i(D, R),
              e.faceVertexUvs[o][a].push(O);
      if (y && (u = 3 * U[s++], C.normal.set(I[u++], I[u++], I[u])), E)
          for (o = 0; o < 3; o++)
            u = 3 * U[s++],
            M = new l(I[u++], I[u++], I[u]),
            C.vertexNormals.push(M);
      if (x && (h = U[s++], C.color.setHex(P[h])), b)
          for (o = 0; o < 3; o++)
            h = U[s++],
            C.vertexColors.push(new j(P[h]));
      e.faces.push(C)
      }
    }
    function e(t, e) {
      var i = void 0 !== t.influencesPerVertex
        ? t.influencesPerVertex
        : 2;
      if (t.skinWeights)
        for (var n = 0, r = t.skinWeights.length; n < r; n += i) {
          var a = t.skinWeights[n],
            s = i > 1
              ? t.skinWeights[n + 1]
              : 0,
            l = i > 2
              ? t.skinWeights[n + 2]
              : 0,
            c = i > 3
              ? t.skinWeights[n + 3]
              : 0;
          e.skinWeights.push(new o(a, s, l, c))
        }
      if (t.skinIndices)
        for (var n = 0, r = t.skinIndices.length; n < r; n += i) {
          var h = t.skinIndices[n],
            u = i > 1
              ? t.skinIndices[n + 1]
              : 0,
            d = i > 2
              ? t.skinIndices[n + 2]
              : 0,
            p = i > 3
              ? t.skinIndices[n + 3]
              : 0;
          e.skinIndices.push(new o(h, u, d, p))
        }
      e.bones = t.bones,
      e.bones && e.bones.length > 0 && (e.skinWeights.length !== e.skinIndices.length || e.skinIndices.length !== e.vertices.length) && console.warn("When skinning, number of vertices (" + e.vertices.length + "), skinIndices (" + e.skinIndices.length + "), and skinWeights (" + e.skinWeights.length + ") should match.")
    }
    function n(t, e) {
      var i = t.scale;
      if (void 0 !== t.morphTargets)
        for (var n = 0, o = t.morphTargets.length; n < o; n++) {
          e.morphTargets[n] = {},
          e.morphTargets[n].name = t.morphTargets[n].name,
          e.morphTargets[n].vertices = [];
          for (var r = e.morphTargets[n].vertices, a = t.morphTargets[n].vertices, s = 0, c = a.length; s < c; s += 3) {
            var h = new l;
            h.x = a[s] * i,
            h.y = a[s + 1] * i,
            h.z = a[s + 2] * i,
            r.push(h)
          }
        }
      if (void 0 !== t.morphColors && t.morphColors.length > 0) {
        console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');
        for (var u = e.faces, d = t.morphColors[0].colors, n = 0, o = u.length; n < o; n++)
          u[n].color.fromArray(d, 3 * n)
      }
    }
    function r(t, e) {
      var i = [],
        n = [];
      void 0 !== t.animation && n.push(t.animation),
      void 0 !== t.animations && (
        t.animations.length
        ? n = n.concat(t.animations)
        : n.push(t.animations));
      for (var o = 0; o < n.length; o++) {
        var r = rn.parseAnimation(n[o], e.bones);
        r && i.push(r)
      }
      if (e.morphTargets) {
        var a = rn.CreateClipsFromMorphTargetSequences(e.morphTargets, 10);
        i = i.concat(a)
      }
      i.length > 0 && (e.animations = i)
    }
    return function(i, o) {
      void 0 !== i.data && (i = i.data),
      void 0 !== i.scale
        ? i.scale = 1 / i.scale
        : i.scale = 1;
      var a = new Lt;
      return t(i, a),
      e(i, a),
      n(i, a),
      r(i, a),
      a.computeFaceNormals(),
      a.computeBoundingSphere(),
      void 0 === i.materials || 0 === i.materials.length
        ? {
          geometry: a
        }
        : {
          geometry: a,
          materials: ln.prototype.initMaterials(i.materials, o, this.crossOrigin)
        }
    }
  }()
}),
Object.assign(hn.prototype, {
  load: function(t, e, i, n) {
    "" === this.texturePath && (this.texturePath = t.substring(0, t.lastIndexOf("/") + 1));
    var o = this;
    new Oi(o.manager).load(t, function(i) {
      var r = null;
      try {
        r = JSON.parse(i)
      } catch (e) {
        return void 0 !== n && n(e),
        void console.error("THREE:ObjectLoader: Can't parse " + t + ".", e.message)
      }
      var a = r.metadata;
      if (void 0 === a || void 0 === a.type || "geometry" === a.type.toLowerCase())
        return void console.error("THREE.ObjectLoader: Can't load " + t + ". Use THREE.JSONLoader instead.");
      o.parse(r, e)
    }, i, n)
  },
  setTexturePath: function(t) {
    this.texturePath = t
  },
  setCrossOrigin: function(t) {
    this.crossOrigin = t
  },
  parse: function(t, e) {
    var i = this.parseGeometries(t.geometries),
      n = this.parseImages(t.images, function() {
        void 0 !== e && e(a)
      }),
      o = this.parseTextures(t.textures, n),
      r = this.parseMaterials(t.materials, o),
      a = this.parseObject(t.object, i, r);
    return t.animations && (a.animations = this.parseAnimations(t.animations)),
    void 0 !== t.images && 0 !== t.images.length || void 0 !== e && e(a),
    a
  },
  parseGeometries: function(t) {
    var e = {};
    if (void 0 !== t)
      for (var i = new cn, n = new sn, o = 0, r = t.length; o < r; o++) {
        var a,
          s = t[o];
        switch (s.type) {
          case "PlaneGeometry":
          case "PlaneBufferGeometry":
            a = new Ps[s.type](s.width, s.height, s.widthSegments, s.heightSegments);
            break;
          case "BoxGeometry":
          case "BoxBufferGeometry":
          case "CubeGeometry":
            a = new Ps[s.type](s.width, s.height, s.depth, s.widthSegments, s.heightSegments, s.depthSegments);
            break;
          case "CircleGeometry":
          case "CircleBufferGeometry":
            a = new Ps[s.type](s.radius, s.segments, s.thetaStart, s.thetaLength);
            break;
          case "CylinderGeometry":
          case "CylinderBufferGeometry":
            a = new Ps[s.type](s.radiusTop, s.radiusBottom, s.height, s.radialSegments, s.heightSegments, s.openEnded, s.thetaStart, s.thetaLength);
            break;
          case "ConeGeometry":
          case "ConeBufferGeometry":
            a = new Ps[s.type](s.radius, s.height, s.radialSegments, s.heightSegments, s.openEnded, s.thetaStart, s.thetaLength);
            break;
          case "SphereGeometry":
          case "SphereBufferGeometry":
            a = new Ps[s.type](s.radius, s.widthSegments, s.heightSegments, s.phiStart, s.phiLength, s.thetaStart, s.thetaLength);
            break;
          case "DodecahedronGeometry":
          case "IcosahedronGeometry":
          case "OctahedronGeometry":
          case "TetrahedronGeometry":
            a = new Ps[s.type](s.radius, s.detail);
            break;
          case "RingGeometry":
          case "RingBufferGeometry":
            a = new Ps[s.type](s.innerRadius, s.outerRadius, s.thetaSegments, s.phiSegments, s.thetaStart, s.thetaLength);
            break;
          case "TorusGeometry":
          case "TorusBufferGeometry":
            a = new Ps[s.type](s.radius, s.tube, s.radialSegments, s.tubularSegments, s.arc);
            break;
          case "TorusKnotGeometry":
          case "TorusKnotBufferGeometry":
            a = new Ps[s.type](s.radius, s.tube, s.tubularSegments, s.radialSegments, s.p, s.q);
            break;
          case "LatheGeometry":
          case "LatheBufferGeometry":
            a = new Ps[s.type](s.points, s.segments, s.phiStart, s.phiLength);
            break;
          case "BufferGeometry":
            a = n.parse(s);
            break;
          case "Geometry":
            a = i.parse(s, this.texturePath).geometry;
            break;
          default:
            console.warn('THREE.ObjectLoader: Unsupported geometry type "' + s.type + '"');
            continue
        }
        a.uuid = s.uuid,
        void 0 !== s.name && (a.name = s.name),
        e[s.uuid] = a
      }
    return e
  },
  parseMaterials: function(t, e) {
    var i = {};
    if (void 0 !== t) {
      var n = new an;
      n.setTextures(e);
      for (var o = 0, r = t.length; o < r; o++) {
        var a = t[o];
        if ("MultiMaterial" === a.type) {
          for (var s = [], l = 0; l < a.materials.length; l++)
            s.push(n.parse(a.materials[l]));
          i[a.uuid] = s
        } else
          i[a.uuid] = n.parse(a)
      }
    }
    return i
  },
  parseAnimations: function(t) {
    for (var e = [], i = 0; i < t.length; i++) {
      var n = rn.parse(t[i]);
      e.push(n)
    }
    return e
  },
  parseImages: function(t, e) {
    var i = this,
      n = {};
    if (void 0 !== t && t.length > 0) {
      var o = new Si(e),
        r = new Ui(o);
      r.setCrossOrigin(this.crossOrigin);
      for (var a = 0, s = t.length; a < s; a++) {
        var l = t[a],
          c = /^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)
            ? l.url
            : i.texturePath + l.url;
        n[l.uuid] = function(t) {
          return i.manager.itemStart(t),
          r.load(t, function() {
            i.manager.itemEnd(t)
          }, void 0, function() {
            i.manager.itemEnd(t),
            i.manager.itemError(t)
          })
        }(c)
      }
    }
    return n
  },
  parseTextures: function(t, e) {
    function i(t, e) {
      return "number" == typeof t
        ? t
        : (console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.", t), e[t])
    }
    var o = {};
    if (void 0 !== t)
      for (var r = 0, a = t.length; r < a; r++) {
        var s = t[r];
        void 0 === s.image && console.warn('THREE.ObjectLoader: No "image" specified for', s.uuid),
        void 0 === e[s.image] && console.warn("THREE.ObjectLoader: Undefined image", s.image);
        var l = new n(e[s.image]);
        l.needsUpdate = !0,
        l.uuid = s.uuid,
        void 0 !== s.name && (l.name = s.name),
        void 0 !== s.mapping && (l.mapping = i(s.mapping, Vs)),
        void 0 !== s.offset && l.offset.fromArray(s.offset),
        void 0 !== s.repeat && l.repeat.fromArray(s.repeat),
        void 0 !== s.wrap && (l.wrapS = i(s.wrap[0], zs), l.wrapT = i(s.wrap[1], zs)),
        void 0 !== s.minFilter && (l.minFilter = i(s.minFilter, qs)),
        void 0 !== s.magFilter && (l.magFilter = i(s.magFilter, qs)),
        void 0 !== s.anisotropy && (l.anisotropy = s.anisotropy),
        void 0 !== s.flipY && (l.flipY = s.flipY),
        o[s.uuid] = l
      }
    return o
  },
  parseObject: function() {
    var t = new c;
    return function(e, i, n) {
      function o(t) {
        return void 0 === i[t] && console.warn("THREE.ObjectLoader: Undefined geometry", t),
        i[t]
      }
      function r(t) {
        if (void 0 !== t) {
          if (Array.isArray(t)) {
            for (var e = [], i = 0, o = t.length; i < o; i++) {
              var r = t[i];
              void 0 === n[r] && console.warn("THREE.ObjectLoader: Undefined material", r),
              e.push(n[r])
            }
            return e
          }
          return void 0 === n[t] && console.warn("THREE.ObjectLoader: Undefined material", t),
          n[t]
        }
      }
      var a;
      switch (e.type) {
        case "Scene":
          a = new ge,
          void 0 !== e.background && Number.isInteger(e.background) && (a.background = new j(e.background)),
          void 0 !== e.fog && (
            "Fog" === e.fog.type
            ? a.fog = new me(e.fog.color, e.fog.near, e.fog.far)
            : "FogExp2" === e.fog.type && (a.fog = new fe(e.fog.color, e.fog.density)));
          break;
        case "PerspectiveCamera":
          a = new It(e.fov, e.aspect, e.near, e.far),
          void 0 !== e.focus && (a.focus = e.focus),
          void 0 !== e.zoom && (a.zoom = e.zoom),
          void 0 !== e.filmGauge && (a.filmGauge = e.filmGauge),
          void 0 !== e.filmOffset && (a.filmOffset = e.filmOffset),
          void 0 !== e.view && (a.view = Object.assign({}, e.view));
          break;
        case "OrthographicCamera":
          a = new Pt(e.left, e.right, e.top, e.bottom, e.near, e.far);
          break;
        case "AmbientLight":
          a = new zi(e.color, e.intensity);
          break;
        case "DirectionalLight":
          a = new Vi(e.color, e.intensity);
          break;
        case "PointLight":
          a = new Fi(e.color, e.intensity, e.distance, e.decay);
          break;
        case "RectAreaLight":
          a = new qi(e.color, e.intensity, e.width, e.height);
          break;
        case "SpotLight":
          a = new Hi(e.color, e.intensity, e.distance, e.angle, e.penumbra, e.decay);
          break;
        case "HemisphereLight":
          a = new Bi(e.color, e.groundColor, e.intensity);
          break;
        case "SkinnedMesh":
          console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");
        case "Mesh":
          var s = o(e.geometry),
            l = r(e.material);
          a = s.bones && s.bones.length > 0
            ? new Ce(s, l)
            : new St(s, l);
          break;
        case "LOD":
          a = new xe;
          break;
        case "Line":
          a = new _e(o(e.geometry), r(e.material), e.mode);
          break;
        case "LineLoop":
          a = new Me(o(e.geometry), r(e.material));
          break;
        case "LineSegments":
          a = new Le(o(e.geometry), r(e.material));
          break;
        case "PointCloud":
        case "Points":
          a = new Oe(o(e.geometry), r(e.material));
          break;
        case "Sprite":
          a = new Ee(r(e.material));
          break;
        case "Group":
          a = new De;
          break;
        default:
          a = new lt
      }
      if (
        a.uuid = e.uuid, void 0 !== e.name && (a.name = e.name), void 0 !== e.matrix
        ? (t.fromArray(e.matrix), t.decompose(a.position, a.quaternion, a.scale))
        : (void 0 !== e.position && a.position.fromArray(e.position), void 0 !== e.rotation && a.rotation.fromArray(e.rotation), void 0 !== e.quaternion && a.quaternion.fromArray(e.quaternion), void 0 !== e.scale && a.scale.fromArray(e.scale)),
      void 0 !== e.castShadow && (a.castShadow = e.castShadow),
      void 0 !== e.receiveShadow && (a.receiveShadow = e.receiveShadow),
      e.shadow && (void 0 !== e.shadow.bias && (a.shadow.bias = e.shadow.bias), void 0 !== e.shadow.radius && (a.shadow.radius = e.shadow.radius), void 0 !== e.shadow.mapSize && a.shadow.mapSize.fromArray(e.shadow.mapSize), void 0 !== e.shadow.camera && (a.shadow.camera = this.parseObject(e.shadow.camera))),
      void 0 !== e.visible && (a.visible = e.visible),
      void 0 !== e.userData && (a.userData = e.userData),
      void 0 !== e.children)
        for (var c in e.children)
          a.add(this.parseObject(e.children[c], i, n));
    if ("LOD" === e.type)
        for (var h = e.levels, u = 0; u < h.length; u++) {
          var d = h[u],
            c = a.getObjectByProperty("uuid", d.object);
          void 0 !== c && a.addLevel(c, d.distance)
        }
      return a
    }
  }()
});
var Vs = {
    UVMapping: 300,
    CubeReflectionMapping: ua,
    CubeRefractionMapping: da,
    EquirectangularReflectionMapping: pa,
    EquirectangularRefractionMapping: fa,
    SphericalReflectionMapping: ma,
    CubeUVReflectionMapping: ga,
    CubeUVRefractionMapping: va
  },
  zs = {
    RepeatWrapping: ya,
    ClampToEdgeWrapping: Ea,
    MirroredRepeatWrapping: xa
  },
  qs = {
    NearestFilter: ba,
    NearestMipMapNearestFilter: wa,
    NearestMipMapLinearFilter: Ca,
    LinearFilter: Ta,
    LinearMipMapNearestFilter: _a,
    LinearMipMapLinearFilter: La
  };
Object.assign(bn.prototype, {
  getPoint: function() {
    return console.warn("THREE.Curve: .getPoint() not implemented."),
    null
  },
  getPointAt: function(t) {
    var e = this.getUtoTmapping(t);
    return this.getPoint(e)
  },
  getPoints: function(t) {
    void 0 === t && (t = 5);
    for (var e = [], i = 0; i <= t; i++)
      e.push(this.getPoint(i / t));
    return e
  },
  getSpacedPoints: function(t) {
    void 0 === t && (t = 5);
    for (var e = [], i = 0; i <= t; i++)
      e.push(this.getPointAt(i / t));
    return e
  },
  getLength: function() {
    var t = this.getLengths();
    return t[t.length - 1]
  },
  getLengths: function(t) {
    if (void 0 === t && (t = this.arcLengthDivisions), this.cacheArcLengths && this.cacheArcLengths.length === t + 1 && !this.needsUpdate)
      return this.cacheArcLengths;
    this.needsUpdate = !1;
    var e,
      i,
      n = [],
      o = this.getPoint(0),
      r = 0;
    for (n.push(0), i = 1; i <= t; i++)
      e = this.getPoint(i / t),
      r += e.distanceTo(o),
      n.push(r),
      o = e;
    return this.cacheArcLengths = n,
    n
  },
  updateArcLengths: function() {
    this.needsUpdate = !0,
    this.getLengths()
  },
  getUtoTmapping: function(t, e) {
    var i,
      n = this.getLengths(),
      o = 0,
      r = n.length;
    i = e || t * n[r - 1];
    for (var a, s = 0, l = r - 1; s <= l;)
      if (o = Math.floor(s + (l - s) / 2), (a = n[o] - i) < 0)
        s = o + 1;
      else {
        if (!(a > 0)) {
          l = o;
          break
        }
        l = o - 1
      }
    if (o = l, n[o] === i)
      return o / (r - 1);
    var c = n[o];
    return (o + (i - c) / (n[o + 1] - c)) / (r - 1)
  },
  getTangent: function(t) {
    var e = t - 1e-4,
      i = t + 1e-4;
    e < 0 && (e = 0),
    i > 1 && (i = 1);
    var n = this.getPoint(e);
    return this.getPoint(i).clone().sub(n).normalize()
  },
  getTangentAt: function(t) {
    var e = this.getUtoTmapping(t);
    return this.getTangent(e)
  },
  computeFrenetFrames: function(t, e) {
    var i,
      n,
      o,
      r = new l,
      a = [],
      s = [],
      h = [],
      u = new l,
      d = new c;
    for (i = 0; i <= t; i++)
      n = i / t,
      a[i] = this.getTangentAt(n),
      a[i].normalize();
    s[0] = new l,
    h[0] = new l;
    var p = Number.MAX_VALUE,
      f = Math.abs(a[0].x),
      m = Math.abs(a[0].y),
      g = Math.abs(a[0].z);
    for (f <= p && (p = f, r.set(1, 0, 0)), m <= p && (p = m, r.set(0, 1, 0)), g <= p && r.set(0, 0, 1), u.crossVectors(a[0], r).normalize(), s[0].crossVectors(a[0], u), h[0].crossVectors(a[0], s[0]), i = 1; i <= t; i++)
      s[i] = s[i - 1].clone(),
      h[i] = h[i - 1].clone(),
      u.crossVectors(a[i - 1], a[i]),
      u.length() > Number.EPSILON && (u.normalize(), o = Math.acos(gs.clamp(a[i - 1].dot(a[i]), -1, 1)), s[i].applyMatrix4(d.makeRotationAxis(u, o))),
      h[i].crossVectors(a[i], s[i]);
    if (e === !0)
      for (o = Math.acos(gs.clamp(s[0].dot(s[t]), -1, 1)), o /= t, a[0].dot(u.crossVectors(s[0], s[t])) > 0 && (o = -o), i = 1; i <= t; i++)
        s[i].applyMatrix4(d.makeRotationAxis(a[i], o * i)),
        h[i].crossVectors(a[i], s[i]);
  return {tangents: a, normals: s, binormals: h}
  }
}),
wn.prototype = Object.create(bn.prototype),
wn.prototype.constructor = wn,
wn.prototype.isLineCurve = !0,
wn.prototype.getPoint = function(t) {
  if (1 === t)
    return this.v2.clone();
  var e = this.v2.clone().sub(this.v1);
  return e.multiplyScalar(t).add(this.v1),
  e
},
wn.prototype.getPointAt = function(t) {
  return this.getPoint(t)
},
wn.prototype.getTangent = function(t) {
  return this.v2.clone().sub(this.v1).normalize()
},
Cn.prototype = Object.assign(Object.create(bn.prototype), {
  constructor: Cn,
  add: function(t) {
    this.curves.push(t)
  },
  closePath: function() {
    var t = this.curves[0].getPoint(0),
      e = this.curves[this.curves.length - 1].getPoint(1);
    t.equals(e) || this.curves.push(new wn(e, t))
  },
  getPoint: function(t) {
    for (var e = t * this.getLength(), i = this.getCurveLengths(), n = 0; n < i.length;) {
      if (i[n] >= e) {
        var o = i[n] - e,
          r = this.curves[n],
          a = r.getLength(),
          s = 0 === a
            ? 0
            : 1 - o / a;
        return r.getPointAt(s)
      }
      n++
    }
    return null
  },
  getLength: function() {
    var t = this.getCurveLengths();
    return t[t.length - 1]
  },
  updateArcLengths: function() {
    this.needsUpdate = !0,
    this.cacheLengths = null,
    this.getCurveLengths()
  },
  getCurveLengths: function() {
    if (this.cacheLengths && this.cacheLengths.length === this.curves.length)
      return this.cacheLengths;
    for (var t = [], e = 0, i = 0, n = this.curves.length; i < n; i++)
      e += this.curves[i].getLength(),
      t.push(e);
    return this.cacheLengths = t,
    t
  },
  getSpacedPoints: function(t) {
    void 0 === t && (t = 40);
    for (var e = [], i = 0; i <= t; i++)
      e.push(this.getPoint(i / t));
    return this.autoClose && e.push(e[0]),
    e
  },
  getPoints: function(t) {
    t = t || 12;
    for (var e, i = [], n = 0, o = this.curves; n < o.length; n++)
      for (
        var r = o[n], a = r && r.isEllipseCurve
        ? 2 * t
        : r && r.isLineCurve
          ? 1
          : r && r.isSplineCurve
            ? t * r.points.length
            : t,
      s = r.getPoints(a),
      l = 0; l < s.length; l++) {
        var c = s[l];
        e && e.equals(c) || (i.push(c), e = c)
      }
    return this.autoClose && i.length > 1 && !i[i.length - 1].equals(i[0]) && i.push(i[0]),
    i
  },
  createPointsGeometry: function(t) {
    var e = this.getPoints(t);
    return this.createGeometry(e)
  },
  createSpacedPointsGeometry: function(t) {
    var e = this.getSpacedPoints(t);
    return this.createGeometry(e)
  },
  createGeometry: function(t) {
    for (var e = new Lt, i = 0, n = t.length; i < n; i++) {
      var o = t[i];
      e.vertices.push(new l(o.x, o.y, o.z || 0))
    }
    return e
  }
}),
Tn.prototype = Object.create(bn.prototype),
Tn.prototype.constructor = Tn,
Tn.prototype.isEllipseCurve = !0,
Tn.prototype.getPoint = function(t) {
  for (var e = 2 * Math.PI, n = this.aEndAngle - this.aStartAngle, o = Math.abs(n) < Number.EPSILON; n < 0;)
    n += e;
  for (; n > e;)
    n -= e;
  n < Number.EPSILON && (
    n = o
    ? 0
    : e),
  this.aClockwise !== !0 || o || (
    n === e
    ? n = -e
    : n -= e);
  var r = this.aStartAngle + t * n,
    a = this.aX + this.xRadius * Math.cos(r),
    s = this.aY + this.yRadius * Math.sin(r);
  if (0 !== this.aRotation) {
    var l = Math.cos(this.aRotation),
      c = Math.sin(this.aRotation),
      h = a - this.aX,
      u = s - this.aY;
    a = h * l - u * c + this.aX,
    s = h * c + u * l + this.aY
  }
  return new i(a, s)
},
_n.prototype = Object.create(bn.prototype),
_n.prototype.constructor = _n,
_n.prototype.isSplineCurve = !0,
_n.prototype.getPoint = function(t) {
  var e = this.points,
    n = (e.length - 1) * t,
    o = Math.floor(n),
    r = n - o,
    a = e[
      0 === o
        ? o
        : o - 1
    ],
    s = e[o],
    l = e[
      o > e.length - 2
        ? e.length - 1
        : o + 1
    ],
    c = e[
      o > e.length - 3
        ? e.length - 1
        : o + 2
    ];
  return new i(un(r, a.x, s.x, l.x, c.x), un(r, a.y, s.y, l.y, c.y))
},
Ln.prototype = Object.create(bn.prototype),
Ln.prototype.constructor = Ln,
Ln.prototype.getPoint = function(t) {
  var e = this.v0,
    n = this.v1,
    o = this.v2,
    r = this.v3;
  return new i(xn(t, e.x, n.x, o.x, r.x), xn(t, e.y, n.y, o.y, r.y))
},
Mn.prototype = Object.create(bn.prototype),
Mn.prototype.constructor = Mn,
Mn.prototype.getPoint = function(t) {
  var e = this.v0,
    n = this.v1,
    o = this.v2;
  return new i(mn(t, e.x, n.x, o.x), mn(t, e.y, n.y, o.y))
};
var Ws = Object.assign(Object.create(Cn.prototype), {
  fromPoints: function(t) {
    this.moveTo(t[0].x, t[0].y);
    for (var e = 1, i = t.length; e < i; e++)
      this.lineTo(t[e].x, t[e].y)
  },
  moveTo: function(t, e) {
    this.currentPoint.set(t, e)
  },
  lineTo: function(t, e) {
    var n = new wn(this.currentPoint.clone(), new i(t, e));
    this.curves.push(n),
    this.currentPoint.set(t, e)
  },
  quadraticCurveTo: function(t, e, n, o) {
    var r = new Mn(this.currentPoint.clone(), new i(t, e), new i(n, o));
    this.curves.push(r),
    this.currentPoint.set(n, o)
  },
  bezierCurveTo: function(t, e, n, o, r, a) {
    var s = new Ln(this.currentPoint.clone(), new i(t, e), new i(n, o), new i(r, a));
    this.curves.push(s),
    this.currentPoint.set(r, a)
  },
  splineThru: function(t) {
    var e = [this.currentPoint.clone()].concat(t),
      i = new _n(e);
    this.curves.push(i),
    this.currentPoint.copy(t[t.length - 1])
  },
  arc: function(t, e, i, n, o, r) {
    var a = this.currentPoint.x,
      s = this.currentPoint.y;
    this.absarc(t + a, e + s, i, n, o, r)
  },
  absarc: function(t, e, i, n, o, r) {
    this.absellipse(t, e, i, i, n, o, r)
  },
  ellipse: function(t, e, i, n, o, r, a, s) {
    var l = this.currentPoint.x,
      c = this.currentPoint.y;
    this.absellipse(t + l, e + c, i, n, o, r, a, s)
  },
  absellipse: function(t, e, i, n, o, r, a, s) {
    var l = new Tn(t, e, i, n, o, r, a, s);
    if (this.curves.length > 0) {
      var c = l.getPoint(0);
      c.equals(this.currentPoint) || this.lineTo(c.x, c.y)
    }
    this.curves.push(l);
    var h = l.getPoint(1);
    this.currentPoint.copy(h)
  }
});
Sn.prototype = Ws,
Ws.constructor = Sn,
On.prototype = Object.assign(Object.create(Ws), {
  constructor: On,
  getPointsHoles: function(t) {
    for (var e = [], i = 0, n = this.holes.length; i < n; i++)
      e[i] = this.holes[i].getPoints(t);
    return e
  },
  extractAllPoints: function(t) {
    return {shape: this.getPoints(t), holes: this.getPointsHoles(t)}
  },
  extractPoints: function(t) {
    return this.extractAllPoints(t)
  }
}),
Object.assign(Dn.prototype, {
  moveTo: function(t, e) {
    this.currentPath = new Sn,
    this.subPaths.push(this.currentPath),
    this.currentPath.moveTo(t, e)
  },
  lineTo: function(t, e) {
    this.currentPath.lineTo(t, e)
  },
  quadraticCurveTo: function(t, e, i, n) {
    this.currentPath.quadraticCurveTo(t, e, i, n)
  },
  bezierCurveTo: function(t, e, i, n, o, r) {
    this.currentPath.bezierCurveTo(t, e, i, n, o, r)
  },
  splineThru: function(t) {
    this.currentPath.splineThru(t)
  },
  toShapes: function(t, e) {
    function i(t) {
      for (var e = [], i = 0, n = t.length; i < n; i++) {
        var o = t[i],
          r = new On;
        r.curves = o.curves,
        e.push(r)
      }
      return e
    }
    var n = Is.isClockWise,
      o = this.subPaths;
    if (0 === o.length)
      return [];
    if (e === !0)
      return i(o);
    var r,
      a,
      s,
      l = [];
    if (1 === o.length)
      return a = o[0],
      s = new On,
      s.curves = a.curves,
      l.push(s),
      l;
    var c = !n(o[0].getPoints());
    c = t
      ? !c
      : c;
    var h,
      u = [],
      d = [],
      p = [],
      f = 0;
    d[f] = void 0,
    p[f] = [];
    for (var m = 0, g = o.length; m < g; m++)
      a = o[m],
      h = a.getPoints(),
      r = n(h),
      r = t
        ? !r
        : r,
      r
        ? (!c && d[f] && f++, d[f] = {
          s: new On,
          p: h
        }, d[f].s.curves = a.curves, c && f++, p[f] = [])
        : p[f].push({h: a, p: h[0]});
    if (!d[0])
      return i(o);
    if (d.length > 1) {
      for (var v = !1, y = [], E = 0, x = d.length; E < x; E++)
        u[E] = [];
      for (var E = 0, x = d.length; E < x; E++)
        for (var b = p[E], w = 0; w < b.length; w++) {
          for (var C = b[w], T = !0, _ = 0; _ < d.length; _++)
            (function(t, e) {
              for (var i = e.length, n = !1, o = i - 1, r = 0; r < i; o = r++) {
                var a = e[o],
                  s = e[r],
                  l = s.x - a.x,
                  c = s.y - a.y;
                if (Math.abs(c) > Number.EPSILON) {
                  if (c < 0 && (a = e[r], l = -l, s = e[o], c = -c), t.y < a.y || t.y > s.y)
                    continue;
                  if (t.y === a.y) {
                    if (t.x === a.x)
                      return !0
                  } else {
                    var h = c * (t.x - a.x) - l * (t.y - a.y);
                    if (0 === h)
                      return !0;
                    if (h < 0)
                      continue;
                    n = !n
                  }
                } else {
                  if (t.y !== a.y)
                    continue;
                  if (s.x <= t.x && t.x <= a.x || a.x <= t.x && t.x <= s.x)
                    return !0
                }
              }
              return n
            })(C.p, d[_].p) && (
              E !== _ && y.push({froms: E, tos: _, hole: w}), T
              ? (T = !1, u[_].push(C))
              : v = !0);
          T && u[E].push(C)
        }
      y.length > 0 && (v || (p = u))
    }
    for (var L, m = 0, M = d.length; m < M; m++) {
      s = d[m].s,
      l.push(s),
      L = p[m];
      for (var S = 0, O = L.length; S < O; S++)
        s.holes.push(L[S].h)
    }
    return l
  }
}),
Object.assign(Rn.prototype, {
  isFont: !0,
  generateShapes: function(t, e, i) {
    function n(t, e, n, r) {
      var a = o.glyphs[t] || o.glyphs["?"];
      if (a) {
        var s,
          l,
          c,
          h,
          u,
          d,
          p,
          f,
          m,
          g,
          v,
          y = new Dn,
          E = [];
        if (a.o)
          for (var x = a._cachedOutline || (a._cachedOutline = a.o.split(" ")), b = 0, w = x.length; b < w;) {
            var C = x[b++];
            switch (C) {
              case "m":
                s = x[b++] * e + n,
                l = x[b++] * e + r,
                y.moveTo(s, l);
                break;
              case "l":
                s = x[b++] * e + n,
                l = x[b++] * e + r,
                y.lineTo(s, l);
                break;
              case "q":
                if (c = x[b++] * e + n, h = x[b++] * e + r, p = x[b++] * e + n, f = x[b++] * e + r, y.quadraticCurveTo(p, f, c, h), v = E[E.length - 1]) {
                  u = v.x,
                  d = v.y;
                  for (var T = 1; T <= i; T++) {
                    var _ = T / i;
                    mn(_, u, p, c),
                    mn(_, d, f, h)
                  }
                }
                break;
              case "b":
                if (c = x[b++] * e + n, h = x[b++] * e + r, p = x[b++] * e + n, f = x[b++] * e + r, m = x[b++] * e + n, g = x[b++] * e + r, y.bezierCurveTo(p, f, m, g, c, h), v = E[E.length - 1]) {
                  u = v.x,
                  d = v.y;
                  for (var T = 1; T <= i; T++) {
                    var _ = T / i;
                    xn(_, u, p, m, c),
                    xn(_, d, f, g, h)
                  }
                }
            }
          }
        return {
          offsetX: a.ha * e,
          path: y
        }
      }
    }
    void 0 === e && (e = 100),
    void 0 === i && (i = 4);
    for (var o = this.data, r = function(t) {
      for (var i = String(t).split(""), r = e / o.resolution, a = (o.boundingBox.yMax - o.boundingBox.yMin + o.underlineThickness) * r, s = 0, l = 0, c = [], h = 0; h < i.length; h++) {
        var u = i[h];
        if ("\n" === u)
          s = 0,
          l -= a;
        else {
          var d = n(u, r, s, l);
          s += d.offsetX,
          c.push(d.path)
        }
      }
      return c
    }(t), a = [], s = 0, l = r.length; s < l; s++)
      Array.prototype.push.apply(a, r[s].toShapes());
    return a
  }
}),
Object.assign(Un.prototype, {
  load: function(t, e, i, n) {
    var o = this;
    new Oi(this.manager).load(t, function(t) {
      var i;
      try {
        i = JSON.parse(t)
      } catch (e) {
        console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),
        i = JSON.parse(t.substring(65, t.length - 2))
      }
      var n = o.parse(i);
      e && e(n)
    }, i, n)
  },
  parse: function(t) {
    return new Rn(t)
  }
});
var js,
  Xs = {
    getContext: function() {
      return void 0 === js && (js = new(window.AudioContext || window.webkitAudioContext)),
      js
    },
    setContext: function(t) {
      js = t
    }
  };
Object.assign(An.prototype, {
  load: function(t, e, i, n) {
    var o = new Oi(this.manager);
    o.setResponseType("arraybuffer"),
    o.load(t, function(t) {
      Xs.getContext().decodeAudioData(t, function(t) {
        e(t)
      })
    }, i, n)
  }
}),
Object.assign(In.prototype, {
  update: function() {
    var t,
      e,
      i,
      n,
      o,
      r,
      a,
      s,
      l = new c,
      h = new c;
    return function(c) {
      if (t !== this || e !== c.focus || i !== c.fov || n !== c.aspect * this.aspect || o !== c.near || r !== c.far || a !== c.zoom || s !== this.eyeSep) {
        t = this,
        e = c.focus,
        i = c.fov,
        n = c.aspect * this.aspect,
        o = c.near,
        r = c.far,
        a = c.zoom;
        var u = c.projectionMatrix.clone();
        s = this.eyeSep / 2;
        var d,
          p,
          f = s * o / e,
          m = o * Math.tan(gs.DEG2RAD * i * .5) / a;
        h.elements[12] = -s,
        l.elements[12] = s,
        d = -m * n + f,
        p = m * n + f,
        u.elements[0] = 2 * o / (p - d),
        u.elements[8] = (p + d) / (p - d),
        this.cameraL.projectionMatrix.copy(u),
        d = -m * n - f,
        p = m * n - f,
        u.elements[0] = 2 * o / (p - d),
        u.elements[8] = (p + d) / (p - d),
        this.cameraR.projectionMatrix.copy(u)
      }
      this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(h),
      this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(l)
    }
  }()
}),
Pn.prototype = Object.create(lt.prototype),
Pn.prototype.constructor = Pn,
Bn.prototype = Object.assign(Object.create(It.prototype), {
  constructor: Bn,
  isArrayCamera: !0
}),
Nn.prototype = Object.assign(Object.create(lt.prototype), {
  constructor: Nn,
  getInput: function() {
    return this.gain
  },
  removeFilter: function() {
    null !== this.filter && (this.gain.disconnect(this.filter), this.filter.disconnect(this.context.destination), this.gain.connect(this.context.destination), this.filter = null)
  },
  getFilter: function() {
    return this.filter
  },
  setFilter: function(t) {
    null !== this.filter
      ? (this.gain.disconnect(this.filter), this.filter.disconnect(this.context.destination))
      : this.gain.disconnect(this.context.destination),
    this.filter = t,
    this.gain.connect(this.filter),
    this.filter.connect(this.context.destination)
  },
  getMasterVolume: function() {
    return this.gain.gain.value
  },
  setMasterVolume: function(t) {
    this.gain.gain.value = t
  },
  updateMatrixWorld: function() {
    var t = new l,
      e = new s,
      i = new l,
      n = new l;
    return function(o) {
      lt.prototype.updateMatrixWorld.call(this, o);
      var r = this.context.listener,
        a = this.up;
      this.matrixWorld.decompose(t, e, i),
      n.set(0, 0, -1).applyQuaternion(e),
      r.positionX
        ? (r.positionX.setValueAtTime(t.x, this.context.currentTime), r.positionY.setValueAtTime(t.y, this.context.currentTime), r.positionZ.setValueAtTime(t.z, this.context.currentTime), r.forwardX.setValueAtTime(n.x, this.context.currentTime), r.forwardY.setValueAtTime(n.y, this.context.currentTime), r.forwardZ.setValueAtTime(n.z, this.context.currentTime), r.upX.setValueAtTime(a.x, this.context.currentTime), r.upY.setValueAtTime(a.y, this.context.currentTime), r.upZ.setValueAtTime(a.z, this.context.currentTime))
        : (r.setPosition(t.x, t.y, t.z), r.setOrientation(n.x, n.y, n.z, a.x, a.y, a.z))
    }
  }()
}),
kn.prototype = Object.assign(Object.create(lt.prototype), {
  constructor: kn,
  getOutput: function() {
    return this.gain
  },
  setNodeSource: function(t) {
    return this.hasPlaybackControl = !1,
    this.sourceType = "audioNode",
    this.source = t,
    this.connect(),
    this
  },
  setBuffer: function(t) {
    return this.buffer = t,
    this.sourceType = "buffer",
    this.autoplay && this.play(),
    this
  },
  play: function() {
    if (this.isPlaying === !0)
      return void console.warn("THREE.Audio: Audio is already playing.");
    if (this.hasPlaybackControl === !1)
      return void console.warn("THREE.Audio: this Audio has no playback control.");
    var t = this.context.createBufferSource();
    return t.buffer = this.buffer,
    t.loop = this.loop,
    t.onended = this.onEnded.bind(this),
    t.playbackRate.setValueAtTime(this.playbackRate, this.startTime),
    t.start(0, this.startTime),
    this.isPlaying = !0,
    this.source = t,
    this.connect()
  },
  pause: function() {
    return this.hasPlaybackControl === !1
      ? void console.warn("THREE.Audio: this Audio has no playback control.")
      : (this.source.stop(), this.startTime = this.context.currentTime, this.isPlaying = !1, this)
  },
  stop: function() {
    return this.hasPlaybackControl === !1
      ? void console.warn("THREE.Audio: this Audio has no playback control.")
      : (this.source.stop(), this.startTime = 0, this.isPlaying = !1, this)
  },
  connect: function() {
    if (this.filters.length > 0) {
      this.source.connect(this.filters[0]);
      for (var t = 1, e = this.filters.length; t < e; t++)
        this.filters[t - 1].connect(this.filters[t]);
      this.filters[this.filters.length - 1].connect(this.getOutput())
    } else
      this.source.connect(this.getOutput());
    return this
  },
  disconnect: function() {
    if (this.filters.length > 0) {
      this.source.disconnect(this.filters[0]);
      for (var t = 1, e = this.filters.length; t < e; t++)
        this.filters[t - 1].disconnect(this.filters[t]);
      this.filters[this.filters.length - 1].disconnect(this.getOutput())
    } else
      this.source.disconnect(this.getOutput());
    return this
  },
  getFilters: function() {
    return this.filters
  },
  setFilters: function(t) {
    return t || (t = []),
    this.isPlaying === !0
      ? (this.disconnect(), this.filters = t, this.connect())
      : this.filters = t,
    this
  },
  getFilter: function() {
    return this.getFilters()[0]
  },
  setFilter: function(t) {
    return this.setFilters(
      t
      ? [t]
      : [])
  },
  setPlaybackRate: function(t) {
    return this.hasPlaybackControl === !1
      ? void console.warn("THREE.Audio: this Audio has no playback control.")
      : (this.playbackRate = t, this.isPlaying === !0 && this.source.playbackRate.setValueAtTime(this.playbackRate, this.context.currentTime), this)
  },
  getPlaybackRate: function() {
    return this.playbackRate
  },
  onEnded: function() {
    this.isPlaying = !1
  },
  getLoop: function() {
    return this.hasPlaybackControl === !1
      ? (console.warn("THREE.Audio: this Audio has no playback control."), !1)
      : this.loop
  },
  setLoop: function(t) {
    return this.hasPlaybackControl === !1
      ? void console.warn("THREE.Audio: this Audio has no playback control.")
      : (this.loop = t, this.isPlaying === !0 && (this.source.loop = this.loop), this)
  },
  getVolume: function() {
    return this.gain.gain.value
  },
  setVolume: function(t) {
    return this.gain.gain.value = t,
    this
  }
}),
Hn.prototype = Object.assign(Object.create(kn.prototype), {
  constructor: Hn,
  getOutput: function() {
    return this.panner
  },
  getRefDistance: function() {
    return this.panner.refDistance
  },
  setRefDistance: function(t) {
    this.panner.refDistance = t
  },
  getRolloffFactor: function() {
    return this.panner.rolloffFactor
  },
  setRolloffFactor: function(t) {
    this.panner.rolloffFactor = t
  },
  getDistanceModel: function() {
    return this.panner.distanceModel
  },
  setDistanceModel: function(t) {
    this.panner.distanceModel = t
  },
  getMaxDistance: function() {
    return this.panner.maxDistance
  },
  setMaxDistance: function(t) {
    this.panner.maxDistance = t
  },
  updateMatrixWorld: function() {
    var t = new l;
    return function(e) {
      lt.prototype.updateMatrixWorld.call(this, e),
      t.setFromMatrixPosition(this.matrixWorld),
      this.panner.setPosition(t.x, t.y, t.z)
    }
  }()
}),
Object.assign(Fn.prototype, {
  getFrequencyData: function() {
    return this.analyser.getByteFrequencyData(this.data),
    this.data
  },
  getAverageFrequency: function() {
    for (var t = 0, e = this.getFrequencyData(), i = 0; i < e.length; i++)
      t += e[i];
    return t / e.length
  }
}),
Object.assign(Gn.prototype, {
  accumulate: function(t, e) {
    var i = this.buffer,
      n = this.valueSize,
      o = t * n + n,
      r = this.cumulativeWeight;
    if (0 === r) {
      for (var a = 0; a !== n; ++a)
        i[o + a] = i[a];
      r = e
    } else {
      r += e;
      var s = e / r;
      this._mixBufferRegion(i, o, 0, s, n)
    }
    this.cumulativeWeight = r
  },
  apply: function(t) {
    var e = this.valueSize,
      i = this.buffer,
      n = t * e + e,
      o = this.cumulativeWeight,
      r = this.binding;
    if (this.cumulativeWeight = 0, o < 1) {
      var a = 3 * e;
      this._mixBufferRegion(i, n, a, 1 - o, e)
    }
    for (var s = e, l = e + e; s !== l; ++s)
      if (i[s] !== i[s + e]) {
        r.setValue(i, n);
        break
      }
    },
  saveOriginalState: function() {
    var t = this.binding,
      e = this.buffer,
      i = this.valueSize,
      n = 3 * i;
    t.getValue(e, n);
    for (var o = i, r = n; o !== r; ++o)
      e[o] = e[n + o % i];
    this.cumulativeWeight = 0
  },
  restoreOriginalState: function() {
    var t = 3 * this.valueSize;
    this.binding.setValue(this.buffer, t)
  },
  _select: function(t, e, i, n, o) {
    if (n >= .5)
      for (var r = 0; r !== o; ++r)
        t[e + r] = t[i + r]
  },
  _slerp: function(t, e, i, n) {
    s.slerpFlat(t, e, t, e, t, i, n)
  },
  _lerp: function(t, e, i, n, o) {
    for (var r = 1 - n, a = 0; a !== o; ++a) {
      var s = e + a;
      t[s] = t[s] * r + t[i + a] * n
    }
  }
}),
Object.assign(Vn.prototype, {
  getValue: function(t, e) {
    this.bind();
    var i = this._targetGroup.nCachedObjects_,
      n = this._bindings[i];
    void 0 !== n && n.getValue(t, e)
  },
  setValue: function(t, e) {
    for (var i = this._bindings, n = this._targetGroup.nCachedObjects_, o = i.length; n !== o; ++n)
      i[n].setValue(t, e)
  },
  bind: function() {
    for (var t = this._bindings, e = this._targetGroup.nCachedObjects_, i = t.length; e !== i; ++e)
      t[e].bind()
  },
  unbind: function() {
    for (var t = this._bindings, e = this._targetGroup.nCachedObjects_, i = t.length; e !== i; ++e)
      t[e].unbind()
  }
}),
Object.assign(zn, {
  Composite: Vn,
  create: function(t, e, i) {
    return t && t.isAnimationObjectGroup
      ? new zn.Composite(t, e, i)
      : new zn(t, e, i)
  },
  parseTrackName: function() {
    var t = new RegExp("^" + /((?:[\w-]+[\/:])*)/.source + /([\w-\.]+)?/.source + /(?:\.([\w-]+)(?:\[(.+)\])?)?/.source + /\.([\w-]+)(?:\[(.+)\])?/.source + "$"),
      e = ["material", "materials", "bones"];
    return function(i) {
      var n = t.exec(i);
      if (!n)
        throw new Error("PropertyBinding: Cannot parse trackName: " + i);
      var o = {
          nodeName: n[2],
          objectName: n[3],
          objectIndex: n[4],
          propertyName: n[5],
          propertyIndex: n[6]
        },
        r = o.nodeName && o.nodeName.lastIndexOf(".");
      if (void 0 !== r && r !== -1) {
        var a = o.nodeName.substring(r + 1);
        e.indexOf(a) !== -1 && (o.nodeName = o.nodeName.substring(0, r), o.objectName = a)
      }
      if (null === o.propertyName || 0 === o.propertyName.length)
        throw new Error("PropertyBinding: can not parse propertyName from trackName: " + i);
      return o
    }
  }(),
  findNode: function(t, e) {
    if (!e || "" === e || "root" === e || "." === e || e === -1 || e === t.name || e === t.uuid)
      return t;
    if (t.skeleton) {
      var i = function(t) {
        for (var i = 0; i < t.bones.length; i++) {
          var n = t.bones[i];
          if (n.name === e)
            return n
        }
        return null
      }(t.skeleton);
      if (i)
        return i
    }
    if (t.children) {
      var n = function t(i) {
        for (var n = 0; n < i.length; n++) {
          var o = i[n];
          if (o.name === e || o.uuid === e)
            return o;
          var r = t(o.children);
          if (r)
            return r
        }
        return null
      }(t.children);
      if (n)
        return n
    }
    return null
  }
}),
Object.assign(zn.prototype, {
  _getValue_unavailable: function() {},
  _setValue_unavailable: function() {},
  BindingType: {
    Direct: 0,
    EntireArray: 1,
    ArrayElement: 2,
    HasFromToArray: 3
  },
  Versioning: {
    None: 0,
    NeedsUpdate: 1,
    MatrixWorldNeedsUpdate: 2
  },
  GetterByBindingType: [
    function(t, e) {
      t[e] = this.node[this.propertyName]
    },
    function(t, e) {
      for (var i = this.resolvedProperty, n = 0, o = i.length; n !== o; ++n)
        t[e++] = i[n]
    },
    function(t, e) {
      t[e] = this.resolvedProperty[this.propertyIndex]
    },
    function(t, e) {
      this.resolvedProperty.toArray(t, e)
    }
  ],
  SetterByBindingTypeAndVersioning: [
    [
      function(t, e) {
        this.node[this.propertyName] = t[e]
      },
      function(t, e) {
        this.node[this.propertyName] = t[e],
        this.targetObject.needsUpdate = !0
      },
      function(t, e) {
        this.node[this.propertyName] = t[e],
        this.targetObject.matrixWorldNeedsUpdate = !0
      }
    ],
    [
      function(t, e) {
        for (var i = this.resolvedProperty, n = 0, o = i.length; n !== o; ++n)
          i[n] = t[e++]
      },
      function(t, e) {
        for (var i = this.resolvedProperty, n = 0, o = i.length; n !== o; ++n)
          i[n] = t[e++];
        this.targetObject.needsUpdate = !0
      },
      function(t, e) {
        for (var i = this.resolvedProperty, n = 0, o = i.length; n !== o; ++n)
          i[n] = t[e++];
        this.targetObject.matrixWorldNeedsUpdate = !0
      }
    ],
    [
      function(t, e) {
        this.resolvedProperty[this.propertyIndex] = t[e]
      },
      function(t, e) {
        this.resolvedProperty[this.propertyIndex] = t[e],
        this.targetObject.needsUpdate = !0
      },
      function(t, e) {
        this.resolvedProperty[this.propertyIndex] = t[e],
        this.targetObject.matrixWorldNeedsUpdate = !0
      }
    ],
    [
      function(t, e) {
        this.resolvedProperty.fromArray(t, e)
      },
      function(t, e) {
        this.resolvedProperty.fromArray(t, e),
        this.targetObject.needsUpdate = !0
      },
      function(t, e) {
        this.resolvedProperty.fromArray(t, e),
        this.targetObject.matrixWorldNeedsUpdate = !0
      }
    ]
  ],
  getValue: function(t, e) {
    this.bind(),
    this.getValue(t, e)
  },
  setValue: function(t, e) {
    this.bind(),
    this.setValue(t, e)
  },
  bind: function() {
    var t = this.node,
      e = this.parsedPath,
      i = e.objectName,
      n = e.propertyName,
      o = e.propertyIndex;
    if (t || (t = zn.findNode(this.rootNode, e.nodeName) || this.rootNode, this.node = t), this.getValue = this._getValue_unavailable, this.setValue = this._setValue_unavailable, !t)
      return void console.error("  trying to update node for track: " + this.path + " but it wasn't found.");
    if (i) {
      var r = e.objectIndex;
      switch (i) {
        case "materials":
          if (!t.material)
            return void console.error("  can not bind to material as node does not have a material", this);
          if (!t.material.materials)
            return void console.error("  can not bind to material.materials as node.material does not have a materials array", this);
          t = t.material.materials;
          break;
        case "bones":
          if (!t.skeleton)
            return void console.error("  can not bind to bones as node does not have a skeleton", this);
          t = t.skeleton.bones;
          for (var a = 0; a < t.length; a++)
            if (t[a].name === r) {
              r = a;
              break
            }
          break;
        default:
          if (void 0 === t[i])
            return void console.error("  can not bind to objectName of node, undefined", this);
          t = t[i]
      }
      if (void 0 !== r) {
        if (void 0 === t[r])
          return void console.error("  trying to bind to objectIndex of objectName, but is undefined:", this, t);
        t = t[r]
      }
    }
    var s = t[n];
    if (void 0 === s) {
      var l = e.nodeName;
      return void console.error("  trying to update property for track: " + l + "." + n + " but it wasn't found.", t)
    }
    var c = this.Versioning.None;
    void 0 !== t.needsUpdate
      ? (c = this.Versioning.NeedsUpdate, this.targetObject = t)
      : void 0 !== t.matrixWorldNeedsUpdate && (c = this.Versioning.MatrixWorldNeedsUpdate, this.targetObject = t);
    var h = this.BindingType.Direct;
    if (void 0 !== o) {
      if ("morphTargetInfluences" === n) {
        if (!t.geometry)
          return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry", this);
        if (!t.geometry.morphTargets)
          return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets", this);
        for (var a = 0; a < this.node.geometry.morphTargets.length; a++)
          if (t.geometry.morphTargets[a].name === o) {
            o = a;
            break
          }
        }
      h = this.BindingType.ArrayElement,
      this.resolvedProperty = s,
      this.propertyIndex = o
    } else
      void 0 !== s.fromArray && void 0 !== s.toArray
        ? (h = this.BindingType.HasFromToArray, this.resolvedProperty = s)
        : Array.isArray(s)
          ? (h = this.BindingType.EntireArray, this.resolvedProperty = s)
          : this.propertyName = n;
    this.getValue = this.GetterByBindingType[h],
    this.setValue = this.SetterByBindingTypeAndVersioning[h][c]
  },
  unbind: function() {
    this.node = null,
    this.getValue = this._getValue_unbound,
    this.setValue = this._setValue_unbound
  }
}),
Object.assign(zn.prototype, {
  _getValue_unbound: zn.prototype.getValue,
  _setValue_unbound: zn.prototype.setValue
}),
Object.assign(qn.prototype, {
  isAnimationObjectGroup: !0,
  add: function(t) {
    for (var e = this._objects, i = e.length, n = this.nCachedObjects_, o = this._indicesByUUID, r = this._paths, a = this._parsedPaths, s = this._bindings, l = s.length, c = 0, h = arguments.length; c !== h; ++c) {
      var u = arguments[c],
        d = u.uuid,
        p = o[d],
        f = void 0;
      if (void 0 === p) {
        p = i++,
        o[d] = p,
        e.push(u);
        for (var m = 0, g = l; m !== g; ++m)
          s[m].push(new zn(u, r[m], a[m]))
      } else if (p < n) {
        f = e[p];
        var v = --n,
          y = e[v];
        o[y.uuid] = p,
        e[p] = y,
        o[d] = v,
        e[v] = u;
        for (var m = 0, g = l; m !== g; ++m) {
          var E = s[m],
            x = E[v],
            b = E[p];
          E[p] = x,
          void 0 === b && (b = new zn(u, r[m], a[m])),
          E[v] = b
        }
      } else
        e[p] !== f && console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")
    }
    this.nCachedObjects_ = n
  },
  remove: function(t) {
    for (var e = this._objects, i = this.nCachedObjects_, n = this._indicesByUUID, o = this._bindings, r = o.length, a = 0, s = arguments.length; a !== s; ++a) {
      var l = arguments[a],
        c = l.uuid,
        h = n[c];
      if (void 0 !== h && h >= i) {
        var u = i++,
          d = e[u];
        n[d.uuid] = h,
        e[h] = d,
        n[c] = u,
        e[u] = l;
        for (var p = 0, f = r; p !== f; ++p) {
          var m = o[p],
            g = m[u],
            v = m[h];
          m[h] = g,
          m[u] = v
        }
      }
    }
    this.nCachedObjects_ = i
  },
  uncache: function(t) {
    for (var e = this._objects, i = e.length, n = this.nCachedObjects_, o = this._indicesByUUID, r = this._bindings, a = r.length, s = 0, l = arguments.length; s !== l; ++s) {
      var c = arguments[s],
        h = c.uuid,
        u = o[h];
      if (void 0 !== u)
        if (delete o[h], u < n) {
          var d = --n,
            p = e[d],
            f = --i,
            m = e[f];
          o[p.uuid] = u,
          e[u] = p,
          o[m.uuid] = d,
          e[d] = m,
          e.pop();
          for (var g = 0, v = a; g !== v; ++g) {
            var y = r[g],
              E = y[d],
              x = y[f];
            y[u] = E,
            y[d] = x,
            y.pop()
          }
        }
      else {
        var f = --i,
          m = e[f];
        o[m.uuid] = u,
        e[u] = m,
        e.pop();
        for (var g = 0, v = a; g !== v; ++g) {
          var y = r[g];
          y[u] = y[f],
          y.pop()
        }
      }
    }
    this.nCachedObjects_ = n
  },
  subscribe_: function(t, e) {
    var i = this._bindingsIndicesByPath,
      n = i[t],
      o = this._bindings;
    if (void 0 !== n)
      return o[n];
    var r = this._paths,
      a = this._parsedPaths,
      s = this._objects,
      l = s.length,
      c = this.nCachedObjects_,
      h = new Array(l);
    n = o.length,
    i[t] = n,
    r.push(t),
    a.push(e),
    o.push(h);
    for (var u = c, d = s.length; u !== d; ++u) {
      var p = s[u];
      h[u] = new zn(p, t, e)
    }
    return h
  },
  unsubscribe_: function(t) {
    var e = this._bindingsIndicesByPath,
      i = e[t];
    if (void 0 !== i) {
      var n = this._paths,
        o = this._parsedPaths,
        r = this._bindings,
        a = r.length - 1,
        s = r[a];
      e[t[a]] = i,
      r[i] = s,
      r.pop(),
      o[i] = o[a],
      o.pop(),
      n[i] = n[a],
      n.pop()
    }
  }
}),
Object.assign(Wn.prototype, {
  play: function() {
    return this._mixer._activateAction(this),
    this
  },
  stop: function() {
    return this._mixer._deactivateAction(this),
    this.reset()
  },
  reset: function() {
    return this.paused = !1,
    this.enabled = !0,
    this.time = 0,
    this._loopCount = -1,
    this._startTime = null,
    this.stopFading().stopWarping()
  },
  isRunning: function() {
    return this.enabled && !this.paused && 0 !== this.timeScale && null === this._startTime && this._mixer._isActiveAction(this)
  },
  isScheduled: function() {
    return this._mixer._isActiveAction(this)
  },
  startAt: function(t) {
    return this._startTime = t,
    this
  },
  setLoop: function(t, e) {
    return this.loop = t,
    this.repetitions = e,
    this
  },
  setEffectiveWeight: function(t) {
    return this.weight = t,
    this._effectiveWeight = this.enabled
      ? t
      : 0,
    this.stopFading()
  },
  getEffectiveWeight: function() {
    return this._effectiveWeight
  },
  fadeIn: function(t) {
    return this._scheduleFading(t, 0, 1)
  },
  fadeOut: function(t) {
    return this._scheduleFading(t, 1, 0)
  },
  crossFadeFrom: function(t, e, i) {
    if (t.fadeOut(e), this.fadeIn(e), i) {
      var n = this._clip.duration,
        o = t._clip.duration,
        r = o / n,
        a = n / o;
      t.warp(1, r, e),
      this.warp(a, 1, e)
    }
    return this
  },
  crossFadeTo: function(t, e, i) {
    return t.crossFadeFrom(this, e, i)
  },
  stopFading: function() {
    var t = this._weightInterpolant;
    return null !== t && (this._weightInterpolant = null, this._mixer._takeBackControlInterpolant(t)),
    this
  },
  setEffectiveTimeScale: function(t) {
    return this.timeScale = t,
    this._effectiveTimeScale = this.paused
      ? 0
      : t,
    this.stopWarping()
  },
  getEffectiveTimeScale: function() {
    return this._effectiveTimeScale
  },
  setDuration: function(t) {
    return this.timeScale = this._clip.duration / t,
    this.stopWarping()
  },
  syncWith: function(t) {
    return this.time = t.time,
    this.timeScale = t.timeScale,
    this.stopWarping()
  },
  halt: function(t) {
    return this.warp(this._effectiveTimeScale, 0, t)
  },
  warp: function(t, e, i) {
    var n = this._mixer,
      o = n.time,
      r = this._timeScaleInterpolant,
      a = this.timeScale;
    null === r && (r = n._lendControlInterpolant(), this._timeScaleInterpolant = r);
    var s = r.parameterPositions,
      l = r.sampleValues;
    return s[0] = o,
    s[1] = o + i,
    l[0] = t / a,
    l[1] = e / a,
    this
  },
  stopWarping: function() {
    var t = this._timeScaleInterpolant;
    return null !== t && (this._timeScaleInterpolant = null, this._mixer._takeBackControlInterpolant(t)),
    this
  },
  getMixer: function() {
    return this._mixer
  },
  getClip: function() {
    return this._clip
  },
  getRoot: function() {
    return this._localRoot || this._mixer._root
  },
  _update: function(t, e, i, n) {
    if (!this.enabled)
      return void this._updateWeight(t);
    var o = this._startTime;
    if (null !== o) {
      var r = (t - o) * i;
      if (r < 0 || 0 === i)
        return;
      this._startTime = null,
      e = i * r
    }
    e *= this._updateTimeScale(t);
    var a = this._updateTime(e),
      s = this._updateWeight(t);
    if (s > 0)
      for (var l = this._interpolants, c = this._propertyBindings, h = 0, u = l.length; h !== u; ++h)
        l[h].evaluate(a),
        c[h].accumulate(n, s)
  },
  _updateWeight: function(t) {
    var e = 0;
    if (this.enabled) {
      e = this.weight;
      var i = this._weightInterpolant;
      if (null !== i) {
        var n = i.evaluate(t)[0];
        e *= n,
        t > i.parameterPositions[1] && (this.stopFading(), 0 === n && (this.enabled = !1))
      }
    }
    return this._effectiveWeight = e,
    e
  },
  _updateTimeScale: function(t) {
    var e = 0;
    if (!this.paused) {
      e = this.timeScale;
      var i = this._timeScaleInterpolant;
      if (null !== i) {
        e *= i.evaluate(t)[0],
        t > i.parameterPositions[1] && (
          this.stopWarping(), 0 === e
          ? this.paused = !0
          : this.timeScale = e)
      }
    }
    return this._effectiveTimeScale = e,
    e
  },
  _updateTime: function(t) {
    var e = this.time + t;
    if (0 === t)
      return e;
    var i = this._clip.duration,
      n = this.loop,
      o = this._loopCount;
    if (2200 === n) {
      o === -1 && (this._loopCount = 0, this._setEndings(!0, !0, !1));
      t : {
        if(e >= i)
          e = i;
        else {
          if (!(e < 0))
            break t;
          e = 0
        }
        this.clampWhenFinished
          ? this.paused = !0
          : this.enabled = !1,
        this._mixer.dispatchEvent({
          type: "finished",
          action: this,
          direction: t < 0
            ? -1
            : 1
        })
      }
    } else {
      var r = 2202 === n;
      if (o === -1 && (
        t >= 0
        ? (o = 0, this._setEndings(!0, 0 === this.repetitions, r))
        : this._setEndings(0 === this.repetitions, !0, r)), e >= i || e < 0) {
        var a = Math.floor(e / i);
        e -= i * a,
        o += Math.abs(a);
        var s = this.repetitions - o;
        if (s < 0)
          this.clampWhenFinished
            ? this.paused = !0
            : this.enabled = !1,
          e = t > 0
            ? i
            : 0,
          this._mixer.dispatchEvent({
            type: "finished",
            action: this,
            direction: t > 0
              ? 1
              : -1
          });
        else {
          if (0 === s) {
            var l = t < 0;
            this._setEndings(l, !l, r)
          } else
            this._setEndings(!1, !1, r);
          this._loopCount = o,
          this._mixer.dispatchEvent({type: "loop", action: this, loopDelta: a})
        }
      }
      if (r && 1 == (1 & o))
        return this.time = e,
        i - e
    }
    return this.time = e,
    e
  },
  _setEndings: function(t, e, i) {
    var n = this._interpolantSettings;
    i
      ? (n.endingStart = 2401, n.endingEnd = 2401)
      : (
        n.endingStart = t
        ? this.zeroSlopeAtStart
          ? 2401
          : ns
        : 2402,
      n.endingEnd = e
        ? this.zeroSlopeAtEnd
          ? 2401
          : ns
        : 2402)
  },
  _scheduleFading: function(t, e, i) {
    var n = this._mixer,
      o = n.time,
      r = this._weightInterpolant;
    null === r && (r = n._lendControlInterpolant(), this._weightInterpolant = r);
    var a = r.parameterPositions,
      s = r.sampleValues;
    return a[0] = o,
    s[0] = e,
    a[1] = o + t,
    s[1] = i,
    this
  }
}),
Object.assign(jn.prototype, e.prototype, {
  _bindAction: function(t, e) {
    var i = t._localRoot || this._root,
      n = t._clip.tracks,
      o = n.length,
      r = t._propertyBindings,
      a = t._interpolants,
      s = i.uuid,
      l = this._bindingsByRootAndName,
      c = l[s];
    void 0 === c && (c = {}, l[s] = c);
    for (var h = 0; h !== o; ++h) {
      var u = n[h],
        d = u.name,
        p = c[d];
      if (void 0 !== p)
        r[h] = p;
      else {
        if (void 0 !== (p = r[h])) {
          null === p._cacheIndex && (++p.referenceCount, this._addInactiveBinding(p, s, d));
          continue
        }
        var f = e && e._propertyBindings[h].binding.parsedPath;
        p = new Gn(zn.create(i, d, f), u.ValueTypeName, u.getValueSize()), = p.referenceCount + 1,
        this._addInactiveBinding(p, s, d),
        r[h] = p
      }
      a[h].resultBuffer = p.buffer
    }
  },
  _activateAction: function(t) {
    if (!this._isActiveAction(t)) {
      if (null === t._cacheIndex) {
        var e = (t._localRoot || this._root).uuid,
          i = t._clip.uuid,
          n = this._actionsByClip[i];
        this._bindAction(t, n && n.knownActions[0]),
        this._addInactiveAction(t, i, e)
      }
      for (var o = t._propertyBindings, r = 0, a = o.length; r !== a; ++r) {
        var s = o[r];
        0 == s.useCount = &&(this._lendBinding(s), s.saveOriginalState()) + 1
      }
      this._lendAction(t)
    }
  },
  _deactivateAction: function(t) {
    if (this._isActiveAction(t)) {
      for (var e = t._propertyBindings, i = 0, n = e.length; i !== n; ++i) {
        var o = e[i];
        0 == --o.useCount && (o.restoreOriginalState(), this._takeBackBinding(o))
      }
      this._takeBackAction(t)
    }
  },
  _initMemoryManager: function() {
    this._actions = [],
    this._nActiveActions = 0,
    this._actionsByClip = {},
    this._bindings = [],
    this._nActiveBindings = 0,
    this._bindingsByRootAndName = {},
    this._controlInterpolants = [],
    this._nActiveControlInterpolants = 0;
    var t = this;
    this.stats = {
      actions: {
        get total() {
          return t._actions.length
        },
        get inUse() {
          return t._nActiveActions
        }
      },
      bindings: {
        get total() {
          return t._bindings.length
        },
        get inUse() {
          return t._nActiveBindings
        }
      },
      controlInterpolants: {
        get total() {
          return t._controlInterpolants.length
        },
        get inUse() {
          return t._nActiveControlInterpolants
        }
      }
    }
  },
  _isActiveAction: function(t) {
    var e = t._cacheIndex;
    return null !== e && e < this._nActiveActions
  },
  _addInactiveAction: function(t, e, i) {
    var n = this._actions,
      o = this._actionsByClip,
      r = o[e];
    if (void 0 === r)
      r = {
        knownActions: [t],
        actionByRoot: {}
      }
    ,
    t._byClipCacheIndex = 0,
    o[e] = r;
    else {
      var a = r.knownActions;
      t._byClipCacheIndex = a.length,
      a.push(t)
    }
    t._cacheIndex = n.length,
    n.push(t),
    r.actionByRoot[i] = t
  },
  _removeInactiveAction: function(t) {
    var e = this._actions,
      i = e[e.length - 1],
      n = t._cacheIndex;
    i._cacheIndex = n,
    e[n] = i,
    e.pop(),
    t._cacheIndex = null;
    var o = t._clip.uuid,
      r = this._actionsByClip,
      a = r[o],
      s = a.knownActions,
      l = s[s.length - 1],
      c = t._byClipCacheIndex;
    l._byClipCacheIndex = c,
    s[c] = l,
    s.pop(),
    t._byClipCacheIndex = null,
    delete a.actionByRoot[(t._localRoot || this._root).uuid],
    0 === s.length && delete r[o],
    this._removeInactiveBindingsForAction(t)
  },
  _removeInactiveBindingsForAction: function(t) {
    for (var e = t._propertyBindings, i = 0, n = e.length; i !== n; ++i) {
      var o = e[i];
      0 == --o.referenceCount && this._removeInactiveBinding(o)
    }
  },
  _lendAction: function(t) {
    var e = this._actions,
      i = t._cacheIndex,
      n = this._nActiveActions++,
      o = e[n];
    t._cacheIndex = n,
    e[n] = t,
    o._cacheIndex = i,
    e[i] = o
  },
  _takeBackAction: function(t) {
    var e = this._actions,
      i = t._cacheIndex,
      n = --this._nActiveActions,
      o = e[n];
    t._cacheIndex = n,
    e[n] = t,
    o._cacheIndex = i,
    e[i] = o
  },
  _addInactiveBinding: function(t, e, i) {
    var n = this._bindingsByRootAndName,
      o = n[e],
      r = this._bindings;
    void 0 === o && (o = {}, n[e] = o),
    o[i] = t,
    t._cacheIndex = r.length,
    r.push(t)
  },
  _removeInactiveBinding: function(t) {
    var e = this._bindings,
      i = t.binding,
      n = i.rootNode.uuid,
      o = i.path,
      r = this._bindingsByRootAndName,
      a = r[n],
      s = e[e.length - 1],
      l = t._cacheIndex;
    s._cacheIndex = l,
    e[l] = s,
    e.pop(),
    delete a[o];
    t : {
      for(var c in a)
        break t;
      delete r[n]
    }
  },
  _lendBinding: function(t) {
    var e = this._bindings,
      i = t._cacheIndex,
      n = this._nActiveBindings++,
      o = e[n];
    t._cacheIndex = n,
    e[n] = t,
    o._cacheIndex = i,
    e[i] = o
  },
  _takeBackBinding: function(t) {
    var e = this._bindings,
      i = t._cacheIndex,
      n = --this._nActiveBindings,
      o = e[n];
    t._cacheIndex = n,
    e[n] = t,
    o._cacheIndex = i,
    e[i] = o
  },
  _lendControlInterpolant: function() {
    var t = this._controlInterpolants,
      e = this._nActiveControlInterpolants++,
      i = t[e];
    return void 0 === i && (i = new Xi(new Float32Array(2), new Float32Array(2), 1, this._controlInterpolantsResultBuffer), i.__cacheIndex = e, t[e] = i),
    i
  },
  _takeBackControlInterpolant: function(t) {
    var e = this._controlInterpolants,
      i = t.__cacheIndex,
      n = --this._nActiveControlInterpolants,
      o = e[n];
    t.__cacheIndex = n,
    e[n] = t,
    o.__cacheIndex = i,
    e[i] = o
  },
  _controlInterpolantsResultBuffer: new Float32Array(1),
  clipAction: function(t, e) {
    var i = e || this._root,
      n = i.uuid,
      o = "string" == typeof t
        ? rn.findByName(i, t)
        : t,
      r = null !== o
        ? o.uuid
        : t,
      a = this._actionsByClip[r],
      s = null;
    if (void 0 !== a) {
      var l = a.actionByRoot[n];
      if (void 0 !== l)
        return l;
      s = a.knownActions[0],
      null === o && (o = s._clip)
    }
    if (null === o)
      return null;
    var c = new Wn(this, o, e);
    return this._bindAction(c, s),
    this._addInactiveAction(c, r, n),
    c
  },
  existingAction: function(t, e) {
    var i = e || this._root,
      n = i.uuid,
      o = "string" == typeof t
        ? rn.findByName(i, t)
        : t,
      r = o
        ? o.uuid
        : t,
      a = this._actionsByClip[r];
    return void 0 !== a
      ? a.actionByRoot[n] || null
      : null
  },
  stopAllAction: function() {
    var t = this._actions,
      e = this._nActiveActions,
      i = this._bindings,
      n = this._nActiveBindings;
    this._nActiveActions = 0,
    this._nActiveBindings = 0;
    for (var o = 0; o !== e; ++o)
      t[o].reset();
    for (var o = 0; o !== n; ++o)
      i[o].useCount = 0;
    return this
  },
  update: function(t) {
    t *= this.timeScale;
    for (var e = this._actions, i = this._nActiveActions, n = this.time += t, o = Math.sign(t), r = this._accuIndex ^= 1, a = 0; a !== i; ++a) {
      e[a]._update(n, t, o, r)
    }
    for (var s = this._bindings, l = this._nActiveBindings, a = 0; a !== l; ++a)
      s[a].apply(r);
    return this
  },
  getRoot: function() {
    return this._root
  },
  uncacheClip: function(t) {
    var e = this._actions,
      i = t.uuid,
      n = this._actionsByClip,
      o = n[i];
    if (void 0 !== o) {
      for (var r = o.knownActions, a = 0, s = r.length; a !== s; ++a) {
        var l = r[a];
        this._deactivateAction(l);
        var c = l._cacheIndex,
          h = e[e.length - 1];
        l._cacheIndex = null,
        l._byClipCacheIndex = null,
        h._cacheIndex = c,
        e[c] = h,
        e.pop(),
        this._removeInactiveBindingsForAction(l)
      }
      delete n[i]
    }
  },
  uncacheRoot: function(t) {
    var e = t.uuid,
      i = this._actionsByClip;
    for (var n in i) {
      var o = i[n].actionByRoot,
        r = o[e];
      void 0 !== r && (this._deactivateAction(r), this._removeInactiveAction(r))
    }
    var a = this._bindingsByRootAndName,
      s = a[e];
    if (void 0 !== s)
      for (var l in s) {
        var c = s[l];
        c.restoreOriginalState(),
        this._removeInactiveBinding(c)
      }
    },
  uncacheAction: function(t, e) {
    var i = this.existingAction(t, e);
    null !== i && (this._deactivateAction(i), this._removeInactiveAction(i))
  }
}),
Xn.prototype.clone = function() {
  return new Xn(
    void 0 === this.value.clone
    ? this.value
    : this.value.clone())
},
Yn.prototype = Object.assign(Object.create(Mt.prototype), {
  constructor: Yn,
  isInstancedBufferGeometry: !0,
  addGroup: function(t, e, i) {
    this.groups.push({start: t, count: e, materialIndex: i})
  },
  copy: function(t) {
    var e = t.index;
    null !== e && this.setIndex(e.clone());
    var i = t.attributes;
    for (var n in i) {
      var o = i[n];
      this.addAttribute(n, o.clone())
    }
    for (var r = t.groups, a = 0, s = r.length; a < s; a++) {
      var l = r[a];
      this.addGroup(l.start, l.count, l.materialIndex)
    }
    return this
  }
}),
Object.defineProperties(Zn.prototype, {
  count: {
    get: function() {
      return this.data.count
    }
  },
  array: {
    get: function() {
      return this.data.array
    }
  }
}),
Object.assign(Zn.prototype, {
  isInterleavedBufferAttribute: !0,
  setX: function(t, e) {
    return this.data.array[t * this.data.stride + this.offset] = e,
    this
  },
  setY: function(t, e) {
    return this.data.array[t * this.data.stride + this.offset + 1] = e,
    this
  },
  setZ: function(t, e) {
    return this.data.array[t * this.data.stride + this.offset + 2] = e,
    this
  },
  setW: function(t, e) {
    return this.data.array[t * this.data.stride + this.offset + 3] = e,
    this
  },
  getX: function(t) {
    return this.data.array[t * this.data.stride + this.offset]
  },
  getY: function(t) {
    return this.data.array[t * this.data.stride + this.offset + 1]
  },
  getZ: function(t) {
    return this.data.array[t * this.data.stride + this.offset + 2]
  },
  getW: function(t) {
    return this.data.array[t * this.data.stride + this.offset + 3]
  },
  setXY: function(t, e, i) {
    return t = t * this.data.stride + this.offset,
    this.data.array[t + 0] = e,
    this.data.array[t + 1] = i,
    this
  },
  setXYZ: function(t, e, i, n) {
    return t = t * this.data.stride + this.offset,
    this.data.array[t + 0] = e,
    this.data.array[t + 1] = i,
    this.data.array[t + 2] = n,
    this
  },
  setXYZW: function(t, e, i, n, o) {
    return t = t * this.data.stride + this.offset,
    this.data.array[t + 0] = e,
    this.data.array[t + 1] = i,
    this.data.array[t + 2] = n,
    this.data.array[t + 3] = o,
    this
  }
}),
Object.defineProperty(Kn.prototype, "needsUpdate", {
  set: function(t) {
    t === !0 && this.version++
  }
}),
Object.assign(Kn.prototype, {
  isInterleavedBuffer: !0,
  setArray: function(t) {
    if (Array.isArray(t))
      throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");
    this.count = void 0 !== t
      ? t.length / this.stride
      : 0,
    this.array = t
  },
  setDynamic: function(t) {
    return this.dynamic = t,
    this
  },
  copy: function(t) {
    return this.array = new t.array.constructor(t.array),
    this.count = t.count,
    this.stride = t.stride,
    this.dynamic = t.dynamic,
    this
  },
  copyAt: function(t, e, i) {
    t *= this.stride,
    i *= e.stride;
    for (var n = 0, o = this.stride; n < o; n++)
      this.array[t + n] = e.array[i + n];
    return this
  },
  set: function(t, e) {
    return void 0 === e && (e = 0),
    this.array.set(t, e),
    this
  },
  clone: function() {
    return (new this.constructor).copy(this)
  },
  onUpload: function(t) {
    return this.onUploadCallback = t,
    this
  }
}),
Qn.prototype = Object.assign(Object.create(Kn.prototype), {
  constructor: Qn,
  isInstancedInterleavedBuffer: !0,
  copy: function(t) {
    return Kn.prototype.copy.call(this, t),
    this.meshPerAttribute = t.meshPerAttribute,
    this
  }
}),
Jn.prototype = Object.assign(Object.create(pt.prototype), {
  constructor: Jn,
  isInstancedBufferAttribute: !0,
  copy: function(t) {
    return pt.prototype.copy.call(this, t),
    this.meshPerAttribute = t.meshPerAttribute,
    this
  }
}),
Object.assign($n.prototype, {
  linePrecision: 1,
  set: function(t, e) {
    this.ray.set(t, e)
  },
  setFromCamera: function(t, e) {
    e && e.isPerspectiveCamera
      ? (this.ray.origin.setFromMatrixPosition(e.matrixWorld), this.ray.direction.set(t.x, t.y, .5).unproject(e).sub(this.ray.origin).normalize())
      : e && e.isOrthographicCamera
        ? (this.ray.origin.set(t.x, t.y, -1).unproject(e), this.ray.direction.set(0, 0, -1).transformDirection(e.matrixWorld))
        : console.error("THREE.Raycaster: Unsupported camera type.")
  },
  intersectObject: function(t, e) {
    var i = [];
    return eo(t, this, i, e),
    i.sort(to),
    i
  },
  intersectObjects: function(t, e) {
    var i = [];
    if (Array.isArray(t) === !1)
      return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),
      i;
    for (var n = 0, o = t.length; n < o; n++)
      eo(t[n], this, i, e);
    return i.sort(to),
    i
  }
}),
Object.assign(io.prototype, {
  start: function() {
    this.startTime = (
      "undefined" == typeof performance
      ? Date
      : performance).now(),
    this.oldTime = this.startTime,
    this.elapsedTime = 0,
    this.running = !0
  },
  stop: function() {
    this.getElapsedTime(),
    this.running = !1
  },
  getElapsedTime: function() {
    return this.getDelta(),
    this.elapsedTime
  },
  getDelta: function() {
    var t = 0;
    if (this.autoStart && !this.running)
      return this.start(),
      0;
    if (this.running) {
      var e = (
        "undefined" == typeof performance
        ? Date
        : performance).now();
      t = (e - this.oldTime) / 1e3,
      this.oldTime = e,
      this.elapsedTime += t
    }
    return t
  }
}),
Object.assign(no.prototype, {
  set: function(t, e, i) {
    return this.radius = t,
    this.phi = e,
    this.theta = i,
    this
  },
  clone: function() {
    return (new this.constructor).copy(this)
  },
  copy: function(t) {
    return this.radius = t.radius,
    this.phi = t.phi,
    this.theta = t.theta,
    this
  },
  makeSafe: function() {
    return this.phi = Math.max(1e-6, Math.min(Math.PI - 1e-6, this.phi)),
    this
  },
  setFromVector3: function(t) {
    return this.radius = t.length(),
    0 === this.radius
      ? (this.theta = 0, this.phi = 0)
      : (this.theta = Math.atan2(t.x, t.z), this.phi = Math.acos(gs.clamp(t.y / this.radius, -1, 1))),
    this
  }
}),
Object.assign(oo.prototype, {
  set: function(t, e, i) {
    return this.radius = t,
    this.theta = e,
    this.y = i,
    this
  },
  clone: function() {
    return (new this.constructor).copy(this)
  },
  copy: function(t) {
    return this.radius = t.radius,
    this.theta = t.theta,
    this.y = t.y,
    this
  },
  setFromVector3: function(t) {
    return this.radius = Math.sqrt(t.x * t.x + t.z * t.z),
    this.theta = Math.atan2(t.x, t.z),
    this.y = t.y,
    this
  }
}),
ro.prototype = Object.create(St.prototype),
ro.prototype.constructor = ro,
ro.prototype.createAnimation = function(t, e, i, n) {
  var o = {
    start: e,
    end: i,
    length: i - e + 1,
    fps: n,
    duration: (i - e) / n,
    lastFrame: 0,
    currentFrame: 0,
    active: !1,
    time: 0,
    direction: 1,
    weight: 1,
    directionBackwards: !1,
    mirroredLoop: !1
  };
  this.animationsMap[t] = o,
  this.animationsList.push(o)
},
ro.prototype.autoCreateAnimations = function(t) {
  for (var e, i = {}, n = this.geometry, o = 0, r = n.morphTargets.length; o < r; o++) {
    var a = n.morphTargets[o],
      s = a.name.match(/([a-z]+)_?(\d+)/i);
    if (s && s.length > 1) {
      var l = s[1];
      i[l] || (i[l] = {
        start: 1 / 0,
        end: -1 / 0
      });
      var c = i[l];
      o < c.start && (c.start = o),
      o > c.end && (c.end = o),
      e || (e = l)
    }
  }
  for (var l in i) {
    var c = i[l];
    this.createAnimation(l, c.start, c.end, t)
  }
  this.firstAnimation = e
},
ro.prototype.setAnimationDirectionForward = function(t) {
  var e = this.animationsMap[t];
  e && (e.direction = 1, e.directionBackwards = !1)
},
ro.prototype.setAnimationDirectionBackward = function(t) {
  var e = this.animationsMap[t];
  e && (e.direction = -1, e.directionBackwards = !0)
},
ro.prototype.setAnimationFPS = function(t, e) {
  var i = this.animationsMap[t];
  i && (i.fps = e, i.duration = (i.end - i.start) / i.fps)
},
ro.prototype.setAnimationDuration = function(t, e) {
  var i = this.animationsMap[t];
  i && (i.duration = e, i.fps = (i.end - i.start) / i.duration)
},
ro.prototype.setAnimationWeight = function(t, e) {
  var i = this.animationsMap[t];
  i && (i.weight = e)
},
ro.prototype.setAnimationTime = function(t, e) {
  var i = this.animationsMap[t];
  i && (i.time = e)
},
ro.prototype.getAnimationTime = function(t) {
  var e = 0,
    i = this.animationsMap[t];
  return i && (e = i.time),
  e
},
ro.prototype.getAnimationDuration = function(t) {
  var e = -1,
    i = this.animationsMap[t];
  return i && (e = i.duration),
  e
},
ro.prototype.playAnimation = function(t) {
  var e = this.animationsMap[t];
  e
    ? (e.time = 0, e.active = !0)
    : console.warn("THREE.MorphBlendMesh: animation[" + t + "] undefined in .playAnimation()")
},
ro.prototype.stopAnimation = function(t) {
  var e = this.animationsMap[t];
  e && (e.active = !1)
},
ro.prototype.update = function(t) {
  for (var e = 0, i = this.animationsList.length; e < i; e++) {
    var n = this.animationsList[e];
    if (n.active) {
      var o = n.duration / n.length;
      n.time += n.direction * t,
      n.mirroredLoop
        ? (n.time > n.duration || n.time < 0) && (n.direction *= -1, n.time > n.duration && (n.time = n.duration, n.directionBackwards = !0), n.time < 0 && (n.time = 0, n.directionBackwards = !1))
        : (n.time = n.time % n.duration, n.time < 0 && (n.time += n.duration));
      var r = n.start + gs.clamp(Math.floor(n.time / o), 0, n.length - 1),
        a = n.weight;
      r !== n.currentFrame && (this.morphTargetInfluences[n.lastFrame] = 0, this.morphTargetInfluences[n.currentFrame] = 1 * a, this.morphTargetInfluences[r] = 0, n.lastFrame = n.currentFrame, n.currentFrame = r);
      var s = n.time % o / o;
      n.directionBackwards && (s = 1 - s),
      n.currentFrame !== n.lastFrame
        ? (this.morphTargetInfluences[n.currentFrame] = s * a, this.morphTargetInfluences[n.lastFrame] = (1 - s) * a)
        : this.morphTargetInfluences[n.currentFrame] = a
    }
  }
},
ao.prototype = Object.create(lt.prototype),
ao.prototype.constructor = ao,
ao.prototype.isImmediateRenderObject = !0,
so.prototype = Object.create(Le.prototype),
so.prototype.constructor = so,
so.prototype.update = function() {
  var t = new l,
    e = new l,
    i = new et;
  return function() {
    var n = ["a", "b", "c"];
    this.object.updateMatrixWorld(!0),
    i.getNormalMatrix(this.object.matrixWorld);
    var o = this.object.matrixWorld,
      r = this.geometry.attributes.position,
      a = this.object.geometry;
    if (a && a.isGeometry)
      for (var s = a.vertices, l = a.faces, c = 0, h = 0, u = l.length; h < u; h++)
        for (var d = l[h], p = 0, f = d.vertexNormals.length; p < f; p++) {
          var m = s[d[n[p]]],
            g = d.vertexNormals[p];
          t.copy(m).applyMatrix4(o),
          e.copy(g).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),
          r.setXYZ(c, t.x, t.y, t.z),
          c += 1,
          r.setXYZ(c, e.x, e.y, e.z),
          c += 1
        }
      else if (a && a.isBufferGeometry)
        for (var v = a.attributes.position, y = a.attributes.normal, c = 0, p = 0, f = v.count; p < f; p++)
          t.set(v.getX(p), v.getY(p), v.getZ(p)).applyMatrix4(o),
          e.set(y.getX(p), y.getY(p), y.getZ(p)),
          e.applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),
          r.setXYZ(c, t.x, t.y, t.z),
          c += 1,
          r.setXYZ(c, e.x, e.y, e.z),
          c += 1;
  r.needsUpdate = !0
  }
}(),
lo.prototype = Object.create(lt.prototype),
lo.prototype.constructor = lo,
lo.prototype.dispose = function() {
  this.cone.geometry.dispose(),
  this.cone.material.dispose()
},
lo.prototype.update = function() {
  var t = new l,
    e = new l;
  return function() {
    var i = this.light.distance
        ? this.light.distance
        : 1e3,
      n = i * Math.tan(this.light.angle);
    this.cone.scale.set(n, n, i),
    t.setFromMatrixPosition(this.light.matrixWorld),
    e.setFromMatrixPosition(this.light.target.matrixWorld),
    this.cone.lookAt(e.sub(t)),
    this.cone.material.color.copy(this.light.color)
  }
}(),
co.prototype = Object.create(Le.prototype),
co.prototype.constructor = co,
co.prototype.getBoneList = function(t) {
  var e = [];
  t && t.isBone && e.push(t);
  for (var i = 0; i < t.children.length; i++)
    e.push.apply(e, this.getBoneList(t.children[i]));
  return e
},
co.prototype.update = function() {
  var t = new l,
    e = new c,
    i = new c;
  return function() {
    var n = this.geometry,
      o = n.getAttribute("position");
    i.getInverse(this.root.matrixWorld);
    for (var r = 0, a = 0; r < this.bones.length; r++) {
      var s = this.bones[r];
      s.parent && s.parent.isBone && (e.multiplyMatrices(i, s.matrixWorld), t.setFromMatrixPosition(e), o.setXYZ(a, t.x, t.y, t.z), e.multiplyMatrices(i, s.parent.matrixWorld), t.setFromMatrixPosition(e), o.setXYZ(a + 1, t.x, t.y, t.z), a += 2)
    }
    n.getAttribute("position").needsUpdate = !0
  }
}(),
ho.prototype = Object.create(St.prototype),
ho.prototype.constructor = ho,
ho.prototype.dispose = function() {
  this.geometry.dispose(),
  this.material.dispose()
},
ho.prototype.update = function() {
  this.material.color.copy(this.light.color)
},
uo.prototype = Object.create(lt.prototype),
uo.prototype.constructor = uo,
uo.prototype.dispose = function() {
  this.children[0].geometry.dispose(),
  this.children[0].material.dispose()
},
uo.prototype.update = function() {
  var t = this.children[0];
  t.material.color.copy(this.light.color);
  var e = .5 * this.light.width,
    i = .5 * this.light.height,
    n = t.geometry.attributes.position,
    o = n.array;
  o[0] = e,
  o[1] = -i,
  o[2] = 0,
  o[3] = e,
  o[4] = i,
  o[5] = 0,
  o[6] = -e,
  o[7] = i,
  o[8] = 0,
  o[9] = -e,
  o[10] = -i,
  o[11] = 0,
  o[12] = e,
  o[13] = -i,
  o[14] = 0,
  n.needsUpdate = !0
},
po.prototype = Object.create(lt.prototype),
po.prototype.constructor = po,
po.prototype.dispose = function() {
  this.children[0].geometry.dispose(),
  this.children[0].material.dispose()
},
po.prototype.update = function() {
  var t = new l,
    e = new j,
    i = new j;
  return function() {
    var n = this.children[0],
      o = n.geometry.getAttribute("color");
    e.copy(this.light.color),
    i.copy(this.light.groundColor);
    for (var r = 0, a = o.count; r < a; r++) {
      var s = r < a / 2
        ? e
        : i;
      o.setXYZ(r, s.r, s.g, s.b)
    }
    n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate()),
    o.needsUpdate = !0
  }
}(),
fo.prototype = Object.create(Le.prototype),
fo.prototype.constructor = fo,
mo.prototype = Object.create(Le.prototype),
mo.prototype.constructor = mo,
go.prototype = Object.create(Le.prototype),
go.prototype.constructor = go,
go.prototype.update = function() {
  var t = new l,
    e = new l,
    i = new et;
  return function() {
    this.object.updateMatrixWorld(!0),
    i.getNormalMatrix(this.object.matrixWorld);
    for (var n = this.object.matrixWorld, o = this.geometry.attributes.position, r = this.object.geometry, a = r.vertices, s = r.faces, l = 0, c = 0, h = s.length; c < h; c++) {
      var u = s[c],
        d = u.normal;
      t.copy(a[u.a]).add(a[u.b]).add(a[u.c]).divideScalar(3).applyMatrix4(n),
      e.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),
      o.setXYZ(l, t.x, t.y, t.z),
      l += 1,
      o.setXYZ(l, e.x, e.y, e.z),
      l += 1
    }
    o.needsUpdate = !0
  }
}(),
vo.prototype = Object.create(lt.prototype),
vo.prototype.constructor = vo,
vo.prototype.dispose = function() {
  var t = this.children[0],
    e = this.children[1];
  t.geometry.dispose(),
  t.material.dispose(),
  e.geometry.dispose(),
  e.material.dispose()
},
vo.prototype.update = function() {
  var t = new l,
    e = new l,
    i = new l;
  return function() {
    t.setFromMatrixPosition(this.light.matrixWorld),
    e.setFromMatrixPosition(this.light.target.matrixWorld),
    i.subVectors(e, t);
    var n = this.children[0],
      o = this.children[1];
    n.lookAt(i),
    n.material.color.copy(this.light.color),
    o.lookAt(i),
    o.scale.z = i.length()
  }
}(),
yo.prototype = Object.create(Le.prototype),
yo.prototype.constructor = yo,
yo.prototype.update = function() {
  function t(t, r, a, s) {
    n.set(r, a, s).unproject(o);
    var l = i[t];
    if (void 0 !== l)
      for (var c = e.getAttribute("position"), h = 0, u = l.length; h < u; h++)
        c.setXYZ(l[h], n.x, n.y, n.z)
  }
  var e,
    i,
    n = new l,
    o = new At;
  return function() {
    e = this.geometry,
    i = this.pointMap;
    o.projectionMatrix.copy(this.camera.projectionMatrix),
    t("c", 0, 0, -1),
    t("t", 0, 0, 1),
    t("n1", -1, -1, -1),
    t("n2", 1, -1, -1),
    t("n3", -1, 1, -1),
    t("n4", 1, 1, -1),
    t("f1", -1, -1, 1),
    t("f2", 1, -1, 1),
    t("f3", -1, 1, 1),
    t("f4", 1, 1, 1),
    t("u1", .7, 1.1, -1),
    t("u2", -.7, 1.1, -1),
    t("u3", 0, 2, -1),
    t("cf1", -1, 0, 1),
    t("cf2", 1, 0, 1),
    t("cf3", 0, -1, 1),
    t("cf4", 0, 1, 1),
    t("cn1", -1, 0, -1),
    t("cn2", 1, 0, -1),
    t("cn3", 0, -1, -1),
    t("cn4", 0, 1, -1),
    e.getAttribute("position").needsUpdate = !0
  }
}(),
Eo.prototype = Object.create(Le.prototype),
Eo.prototype.constructor = Eo,
Eo.prototype.update = function() {
  var t = new $;
  return function(e) {
    if (void 0 !== e && console.warn("THREE.BoxHelper: .update() has no longer arguments."), void 0 !== this.object && t.setFromObject(this.object), !t.isEmpty()) {
      var i = t.min,
        n = t.max,
        o = this.geometry.attributes.position,
        r = o.array;
      r[0] = n.x,
      r[1] = n.y,
      r[2] = n.z,
      r[3] = i.x,
      r[4] = n.y,
      r[5] = n.z,
      r[6] = i.x,
      r[7] = i.y,
      r[8] = n.z,
      r[9] = n.x,
      r[10] = i.y,
      r[11] = n.z,
      r[12] = n.x,
      r[13] = n.y,
      r[14] = i.z,
      r[15] = i.x,
      r[16] = n.y,
      r[17] = i.z,
      r[18] = i.x,
      r[19] = i.y,
      r[20] = i.z,
      r[21] = n.x,
      r[22] = i.y,
      r[23] = i.z,
      o.needsUpdate = !0,
      this.geometry.computeBoundingSphere()
    }
  }
}(),
Eo.prototype.setFromObject = function(t) {
  return this.object = t,
  this.update(),
  this
};
var Ys,
  Zs;
xo.prototype = Object.create(lt.prototype),
xo.prototype.constructor = xo,
xo.prototype.setDirection = function() {
  var t,
    e = new l;
  return function(i) {
    i.y > .99999
      ? this.quaternion.set(0, 0, 0, 1)
      : i.y < -.99999
        ? this.quaternion.set(1, 0, 0, 0)
        : (e.set(i.z, 0, -i.x).normalize(), t = Math.acos(i.y), this.quaternion.setFromAxisAngle(e, t))
  }
}(),
xo.prototype.setLength = function(t, e, i) {
  void 0 === e && (e = .2 * t),
  void 0 === i && (i = .2 * e),
  this.line.scale.set(1, Math.max(0, t - e), 1),
  this.line.updateMatrix(),
  this.cone.scale.set(i, e, i),
  this.cone.position.y = t,
  this.cone.updateMatrix()
},
xo.prototype.setColor = function(t) {
  this.line.material.color.copy(t),
  this.cone.material.color.copy(t)
},
bo.prototype = Object.create(Le.prototype),
bo.prototype.constructor = bo;
var Ks = new l,
  Qs = new wo,
  Js = new wo,
  $s = new wo;
Co.prototype = Object.create(bn.prototype),
Co.prototype.constructor = Co,
Co.prototype.getPoint = function(t) {
  var e = this.points,
    i = e.length;
  i < 2 && console.log("duh, you need at least 2 points");
  var n = (i - (
      this.closed
      ? 0
      : 1)) * t,
    o = Math.floor(n),
    r = n - o;
  this.closed
    ? o += o > 0
      ? 0
      : (Math.floor(Math.abs(o) / e.length) + 1) * e.length
    : 0 === r && o === i - 1 && (o = i - 2, r = 1);
  var a,
    s,
    c,
    h;
  if (
    this.closed || o > 0
    ? a = e[(o - 1) % i]
    : (Ks.subVectors(e[0], e[1]).add(e[0]), a = Ks),
  s = e[o % i],
  c = e[(o + 1) % i],
  this.closed || o + 2 < i
    ? h = e[(o + 2) % i]
    : (Ks.subVectors(e[i - 1], e[i - 2]).add(e[i - 1]), h = Ks),
  void 0 === this.type || "centripetal" === this.type || "chordal" === this.type) {
    var u = "chordal" === this.type
        ? .5
        : .25,
      d = Math.pow(a.distanceToSquared(s), u),
      p = Math.pow(s.distanceToSquared(c), u),
      f = Math.pow(c.distanceToSquared(h), u);
    p < 1e-4 && (p = 1),
    d < 1e-4 && (d = p),
    f < 1e-4 && (f = p),
    Qs.initNonuniformCatmullRom(a.x, s.x, c.x, h.x, d, p, f),
    Js.initNonuniformCatmullRom(a.y, s.y, c.y, h.y, d, p, f),
    $s.initNonuniformCatmullRom(a.z, s.z, c.z, h.z, d, p, f)
  } else if ("catmullrom" === this.type) {
    var m = void 0 !== this.tension
      ? this.tension
      : .5;
    Qs.initCatmullRom(a.x, s.x, c.x, h.x, m),
    Js.initCatmullRom(a.y, s.y, c.y, h.y, m),
    $s.initCatmullRom(a.z, s.z, c.z, h.z, m)
  }
  return new l(Qs.calc(r), Js.calc(r), $s.calc(r))
},
To.prototype = Object.create(bn.prototype),
To.prototype.constructor = To,
To.prototype.getPoint = function(t) {
  var e = this.v0,
    i = this.v1,
    n = this.v2,
    o = this.v3;
  return new l(xn(t, e.x, i.x, n.x, o.x), xn(t, e.y, i.y, n.y, o.y), xn(t, e.z, i.z, n.z, o.z))
},
_o.prototype = Object.create(bn.prototype),
_o.prototype.constructor = _o,
_o.prototype.getPoint = function(t) {
  var e = this.v0,
    i = this.v1,
    n = this.v2;
  return new l(mn(t, e.x, i.x, n.x), mn(t, e.y, i.y, n.y), mn(t, e.z, i.z, n.z))
},
Lo.prototype = Object.create(bn.prototype),
Lo.prototype.constructor = Lo,
Lo.prototype.getPoint = function(t) {
  if (1 === t)
    return this.v2.clone();
  var e = new l;
  return e.subVectors(this.v2, this.v1),
  e.multiplyScalar(t),
  e.add(this.v1),
  e
},
Mo.prototype = Object.create(Tn.prototype),
Mo.prototype.constructor = Mo;
var tl = {
  createMultiMaterialObject: function(t, e) {
    for (var i = new De, n = 0, o = e.length; n < o; n++)
      i.add(new St(t, e[n]));
    return i
  },
  detach: function(t, e, i) {
    t.applyMatrix(e.matrixWorld),
    e.remove(t),
    i.add(t)
  },
  attach: function(t, e, i) {
    var n = new c;
    n.getInverse(i.matrixWorld),
    t.applyMatrix(n),
    e.remove(t),
    i.add(t)
  }
};
bn.create = function(t, e) {
  return console.log("THREE.Curve.create() has been deprecated"),
  t.prototype = Object.create(bn.prototype),
  t.prototype.constructor = t,
  t.prototype.getPoint = e,
  t
},
Yo.prototype = Object.create(Co.prototype),
Zo.prototype = Object.create(Co.prototype),
Ko.prototype = Object.create(Co.prototype),
Object.assign(Ko.prototype, {
  initFromArray: function(t) {
    console.error("THREE.Spline: .initFromArray() has been removed.")
  },
  getControlPointsArray: function(t) {
    console.error("THREE.Spline: .getControlPointsArray() has been removed.")
  },
  reparametrizeByArcLength: function(t) {
    console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")
  }
}),
fo.prototype.setColors = function() {
  console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")
},
Object.assign(X.prototype, {
  center: function(t) {
    return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),
    this.getCenter(t)
  },
  empty: function() {
    return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),
    this.isEmpty()
  },
  isIntersectionBox: function(t) {
    return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),
    this.intersectsBox(t)
  },
  size: function(t) {
    return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),
    this.getSize(t)
  }
}),
Object.assign($.prototype, {
  center: function(t) {
    return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),
    this.getCenter(t)
  },
  empty: function() {
    return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),
    this.isEmpty()
  },
  isIntersectionBox: function(t) {
    return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),
    this.intersectsBox(t)
  },
  isIntersectionSphere: function(t) {
    return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),
    this.intersectsSphere(t)
  },
  size: function(t) {
    return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),
    this.getSize(t)
  }
}),
ct.prototype.center = function(t) {
  return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),
  this.getCenter(t)
},
gs.random16 = function() {
  return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),
  Math.random()
},
Object.assign(et.prototype, {
  flattenToArrayOffset: function(t, e) {
    return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),
    this.toArray(t, e)
  },
  multiplyVector3: function(t) {
    return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),
    t.applyMatrix3(this)
  },
  multiplyVector3Array: function(t) {
    return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),
    this.applyToVector3Array(t)
  },
  applyToBuffer: function(t, e, i) {
    return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),
    this.applyToBufferAttribute(t)
  },
  applyToVector3Array: function(t, e, i) {
    console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")
  }
}),
Object.assign(c.prototype, {
  extractPosition: function(t) {
    return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),
    this.copyPosition(t)
  },
  flattenToArrayOffset: function(t, e) {
    return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),
    this.toArray(t, e)
  },
  getPosition: function() {
    var t;
    return function() {
      return void 0 === t && (t = new l),
      console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),
      t.setFromMatrixColumn(this, 3)
    }
  }(),
  setRotationFromQuaternion: function(t) {
    return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),
    this.makeRotationFromQuaternion(t)
  },
  multiplyToArray: function() {
    console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")
  },
  multiplyVector3: function(t) {
    return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),
    t.applyMatrix4(this)
  },
  multiplyVector4: function(t) {
    return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),
    t.applyMatrix4(this)
  },
  multiplyVector3Array: function(t) {
    return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),
    this.applyToVector3Array(t)
  },
  rotateAxis: function(t) {
    console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),
    t.transformDirection(this)
  },
  crossVector: function(t) {
    return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),
    t.applyMatrix4(this)
  },
  translate: function() {
    console.error("THREE.Matrix4: .translate() has been removed.")
  },
  rotateX: function() {
    console.error("THREE.Matrix4: .rotateX() has been removed.")
  },
  rotateY: function() {
    console.error("THREE.Matrix4: .rotateY() has been removed.")
  },
  rotateZ: function() {
    console.error("THREE.Matrix4: .rotateZ() has been removed.")
  },
  rotateByAxis: function() {
    console.error("THREE.Matrix4: .rotateByAxis() has been removed.")
  },
  applyToBuffer: function(t, e, i) {
    return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),
    this.applyToBufferAttribute(t)
  },
  applyToVector3Array: function(t, e, i) {
    console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")
  },
  makeFrustum: function(t, e, i, n, o, r) {
    return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),
    this.makePerspective(t, e, n, i, o, r)
  }
}),
it.prototype.isIntersectionLine = function(t) {
  return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),
  this.intersectsLine(t)
},
s.prototype.multiplyVector3 = function(t) {
  return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),
  t.applyQuaternion(this)
},
Object.assign(rt.prototype, {
  isIntersectionBox: function(t) {
    return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),
    this.intersectsBox(t)
  },
  isIntersectionPlane: function(t) {
    return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),
    this.intersectsPlane(t)
  },
  isIntersectionSphere: function(t) {
    return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),
    this.intersectsSphere(t)
  }
}),
Object.assign(On.prototype, {
  extrude: function(t) {
    return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),
    new ti(this, t)
  },
  makeGeometry: function(t) {
    return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),
    new hi(this, t)
  }
}),
Object.assign(i.prototype, {
  fromAttribute: function(t, e, i) {
    return console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),
    this.fromBufferAttribute(t, e, i)
  }
}),
Object.assign(l.prototype, {
  setEulerFromRotationMatrix: function() {
    console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")
  },
  setEulerFromQuaternion: function() {
    console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")
  },
  getPositionFromMatrix: function(t) {
    return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),
    this.setFromMatrixPosition(t)
  },
  getScaleFromMatrix: function(t) {
    return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),
    this.setFromMatrixScale(t)
  },
  getColumnFromMatrix: function(t, e) {
    return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),
    this.setFromMatrixColumn(e, t)
  },
  applyProjection: function(t) {
    return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),
    this.applyMatrix4(t)
  },
  fromAttribute: function(t, e, i) {
    return console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),
    this.fromBufferAttribute(t, e, i)
  }
}),
Object.assign(o.prototype, {
  fromAttribute: function(t, e, i) {
    return console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),
    this.fromBufferAttribute(t, e, i)
  }
}),
Lt.prototype.computeTangents = function() {
  console.warn("THREE.Geometry: .computeTangents() has been removed.")
},
Object.assign(lt.prototype, {
  getChildByName: function(t) {
    return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),
    this.getObjectByName(t)
  },
  renderDepth: function() {
    console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")
  },
  translate: function(t, e) {
    return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),
    this.translateOnAxis(e, t)
  }
}),
Object.defineProperties(lt.prototype, {
  eulerOrder: {
    get: function() {
      return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),
      this.rotation.order
    },
    set: function(t) {
      console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),
      this.rotation.order = t
    }
  },
  useQuaternion: {
    get: function() {
      console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")
    },
    set: function() {
      console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")
    }
  }
}),
Object.defineProperties(xe.prototype, {
  objects: {
    get: function() {
      return console.warn("THREE.LOD: .objects has been renamed to .levels."),
      this.levels
    }
  }
}),
Object.defineProperty(be.prototype, "useVertexTexture", {
  get: function() {
    console.warn("THREE.Skeleton: useVertexTexture has been removed.")
  },
  set: function() {
    console.warn("THREE.Skeleton: useVertexTexture has been removed.")
  }
}),
Object.defineProperty(bn.prototype, "__arcLengthDivisions", {
  get: function() {
    return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),
    this.arcLengthDivisions
  },
  set: function(t) {
    console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),
    this.arcLengthDivisions = t
  }
}),
It.prototype.setLens = function(t, e) {
  console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),
  void 0 !== e && (this.filmGauge = e),
  this.setFocalLength(t)
},
Object.defineProperties(Pi.prototype, {
  onlyShadow: {
    set: function() {
      console.warn("THREE.Light: .onlyShadow has been removed.")
    }
  },
  shadowCameraFov: {
    set: function(t) {
      console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),
      this.shadow.camera.fov = t
    }
  },
  shadowCameraLeft: {
    set: function(t) {
      console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),
      this.shadow.camera.left = t
    }
  },
  shadowCameraRight: {
    set: function(t) {
      console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),
      this.shadow.camera.right = t
    }
  },
  shadowCameraTop: {
    set: function(t) {
      console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),
      this.shadow.camera.top = t
    }
  },
  shadowCameraBottom: {
    set: function(t) {
      console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),
      this.shadow.camera.bottom = t
    }
  },
  shadowCameraNear: {
    set: function(t) {
      console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),
      this.shadow.camera.near = t
    }
  },
  shadowCameraFar: {
    set: function(t) {
      console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),
      this.shadow.camera.far = t
    }
  },
  shadowCameraVisible: {
    set: function() {
      console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")
    }
  },
  shadowBias: {
    set: function(t) {
      console.warn("THREE.Light: .shadowBias is now .shadow.bias."),
      this.shadow.bias = t
    }
  },
  shadowDarkness: {
    set: function() {
      console.warn("THREE.Light: .shadowDarkness has been removed.")
    }
  },
  shadowMapWidth: {
    set: function(t) {
      console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),
      this.shadow.mapSize.width = t
    }
  },
  shadowMapHeight: {
    set: function(t) {
      console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),
      this.shadow.mapSize.height = t
    }
  }
}),
Object.defineProperties(pt.prototype, {
  length: {
    get: function() {
      return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),
      this.array.length
    }
  }
}),
Object.assign(Mt.prototype, {
  addIndex: function(t) {
    console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),
    this.setIndex(t)
  },
  addDrawCall: function(t, e, i) {
    void 0 !== i && console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),
    console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),
    this.addGroup(t, e)
  },
  clearDrawCalls: function() {
    console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),
    this.clearGroups()
  },
  computeTangents: function() {
    console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")
  },
  computeOffsets: function() {
    console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")
  }
}),
Object.defineProperties(Mt.prototype, {
  drawcalls: {
    get: function() {
      return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),
      this.groups
    }
  },
  offsets: {
    get: function() {
      return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),
      this.groups
    }
  }
}),
Object.defineProperties(Xn.prototype, {
  dynamic: {
    set: function() {
      console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")
    }
  },
  onUpdate: {
    value: function() {
      return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),
      this
    }
  }
}),
Object.defineProperties(K.prototype, {
  wrapAround: {
    get: function() {
      console.warn("THREE.Material: .wrapAround has been removed.")
    },
    set: function() {
      console.warn("THREE.Material: .wrapAround has been removed.")
    }
  },
  wrapRGB: {
    get: function() {
      return console.warn("THREE.Material: .wrapRGB has been removed."),
      new j
    }
  }
}),
Object.defineProperties(Ci.prototype, {
  metal: {
    get: function() {
      return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),
      !1
    },
    set: function() {
      console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")
    }
  }
}),
Object.defineProperties(Q.prototype, {
  derivatives: {
    get: function() {
      return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),
      this.extensions.derivatives
    },
    set: function(t) {
      console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),
      this.extensions.derivatives = t
    }
  }
}),
Object.assign(pe.prototype, {
  getCurrentRenderTarget: function() {
    return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),
    this.getRenderTarget()
  },
  supportsFloatTextures: function() {
    return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),
    this.extensions.get("OES_texture_float")
  },
  supportsHalfFloatTextures: function() {
    return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),
    this.extensions.get("OES_texture_half_float")
  },
  supportsStandardDerivatives: function() {
    return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),
    this.extensions.get("OES_standard_derivatives")
  },
  supportsCompressedTextureS3TC: function() {
    return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),
    this.extensions.get("WEBGL_compressed_texture_s3tc")
  },
  supportsCompressedTexturePVRTC: function() {
    return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),
    this.extensions.get("WEBGL_compressed_texture_pvrtc")
  },
  supportsBlendMinMax: function() {
    return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),
    this.extensions.get("EXT_blend_minmax")
  },
  supportsVertexTextures: function() {
    return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),
    this.capabilities.vertexTextures
  },
  supportsInstancedArrays: function() {
    return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),
    this.extensions.get("ANGLE_instanced_arrays")
  },
  enableScissorTest: function(t) {
    console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),
    this.setScissorTest(t)
  },
  initMaterial: function() {
    console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")
  },
  addPrePlugin: function() {
    console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")
  },
  addPostPlugin: function() {
    console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")
  },
  updateShadowMap: function() {
    console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")
  }
}),
Object.defineProperties(pe.prototype, {
  shadowMapEnabled: {
    get: function() {
      return this.shadowMap.enabled
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),
      this.shadowMap.enabled = t
    }
  },
  shadowMapType: {
    get: function() {
      return this.shadowMap.type
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),
      this.shadowMap.type = t
    }
  },
  shadowMapCullFace: {
    get: function() {
      return this.shadowMap.cullFace
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),
      this.shadowMap.cullFace = t
    }
  }
}),
Object.defineProperties(ot.prototype, {
  cullFace: {
    get: function() {
      return this.renderReverseSided
        ? mr
        : fr
    },
    set: function(t) {
      var e = t !== fr;
      console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to " + e + "."),
      this.renderReverseSided = e
    }
  }
}),
Object.defineProperties(r.prototype, {
  wrapS: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),
      this.texture.wrapS
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),
      this.texture.wrapS = t
    }
  },
  wrapT: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),
      this.texture.wrapT
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),
      this.texture.wrapT = t
    }
  },
  magFilter: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),
      this.texture.magFilter
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),
      this.texture.magFilter = t
    }
  },
  minFilter: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),
      this.texture.minFilter
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),
      this.texture.minFilter = t
    }
  },
  anisotropy: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),
      this.texture.anisotropy
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),
      this.texture.anisotropy = t
    }
  },
  offset: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),
      this.texture.offset
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),
      this.texture.offset = t
    }
  },
  repeat: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),
      this.texture.repeat
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),
      this.texture.repeat = t
    }
  },
  format: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),
      this.texture.format
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),
      this.texture.format = t
    }
  },
  type: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),
      this.texture.type
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),
      this.texture.type = t
    }
  },
  generateMipmaps: {
    get: function() {
      return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),
      this.texture.generateMipmaps
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),
      this.texture.generateMipmaps = t
    }
  }
}),
kn.prototype.load = function(t) {
  console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");
  var e = this;
  return (new An).load(t, function(t) {
    e.setBuffer(t)
  }),
  this
},
Fn.prototype.getData = function() {
  return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),
  this.getFrequencyData()
};
var el = {
    merge: function(t, e, i) {
      console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");
      var n;
      e.isMesh && (e.matrixAutoUpdate && e.updateMatrix(), n = e.matrix, e = e.geometry),
      t.merge(e, n, i)
    },
    center: function(t) {
      return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),
      t.center()
    }
  },
  il = {
    crossOrigin: void 0,
    loadTexture: function(t, e, i, n) {
      console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");
      var o = new Ii;
      o.setCrossOrigin(this.crossOrigin);
      var r = o.load(t, i, void 0, n);
      return e && (r.mapping = e),
      r
    },
    loadTextureCube: function(t, e, i, n) {
      console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");
      var o = new Ai;
      o.setCrossOrigin(this.crossOrigin);
      var r = o.load(t, i, void 0, n);
      return e && (r.mapping = e),
      r
    },
    loadCompressedTexture: function() {
      console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")
    },
    loadCompressedTextureCube: function() {
      console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")
    }
  },
  nl = Symbol("newer"),
  ol = Symbol("older");
or.prototype._markEntryAsUsed = function(t) {
  t !== this.newest && (t[nl] && (t === this.oldest && (this.oldest = t[nl]), t[nl][ol] = t[ol]), t[ol] && (t[ol][nl] = t[nl]), t[nl] = void 0, t[ol] = this.newest, this.newest && (this.newest[nl] = t), this.newest = t)
},
or.prototype.assign = function(t) {
  var e = void 0,
    i = this.limit || Number.MAX_VALUE;
  this._keymap.clear();
  for (var n = t[Symbol.iterator](), o = n.next(); !o.done; o = n.next()) {
    var r = new rr(o.value[0], o.value[1]);
    if (
      this._keymap.set(r.key, r), e
      ? (e[nl] = r, r[ol] = e)
      : this.oldest = r,
    e = r,
    0 == i--)
      throw new Error("overflow")
  }
  this.newest = e,
  this.size = this._keymap.size
},
or.prototype.get = function(t) {
  var e = this._keymap.get(t);
  if (e)
    return this._markEntryAsUsed(e),
    e.value
},
or.prototype.set = function(t, e) {
  var i = this._keymap.get(t);
  return i
    ? (i.value = e, this._markEntryAsUsed(i), this)
    : (
      this._keymap.set(t, i = new rr(t, e)), this.newest
      ? (this.newest[nl] = i, i[ol] = this.newest)
      : this.oldest = i,
    this.newest = i, = this.size + 1,
    this.size > this.limit && this.shift(),
    this)
},
or.prototype.shift = function() {
  var t = this.oldest;
  if (t)
    return this.oldest[nl]
      ? (this.oldest = this.oldest[nl], this.oldest[ol] = void 0)
      : (this.oldest = void 0, this.newest = void 0),
    t[nl] = t[ol] = void 0,
    this._keymap.delete(t.key), = this.size + 1,
    [t.key, t.value]
},
or.prototype.find = function(t) {
  var e = this._keymap.get(t);
  return e
    ? e.value
    : void 0
},
or.prototype.has = function(t) {
  return this._keymap.has(t)
},
or.prototype.delete = function(t) {
  var e = this._keymap.get(t);
  if (e)
    return this._keymap.delete(e.key),
    e[nl] && e[ol]
      ? (e[ol][nl] = e[nl], e[nl][ol] = e[ol])
      : e[nl]
        ? (e[nl][ol] = void 0, this.oldest = e[nl])
        : e[ol]
          ? (e[ol][nl] = void 0, this.newest = e[ol])
          : this.oldest = this.newest = void 0,
    this.size--,
    e.value
},
or.prototype.clear = function() {
  this.oldest = this.newest = void 0,
  this.size = 0,
  this._keymap.clear()
},
ar.prototype[Symbol.iterator] = function() {
  return this
},
ar.prototype.next = function() {
  var t = this.entry;
  return t
    ? (this.entry = t[nl], {
      done: !1,
      value: [t.key, t.value]
    })
    : {
      done: !0,
      value: void 0
    }
},
sr.prototype[Symbol.iterator] = function() {
  return this
},
sr.prototype.next = function() {
  var t = this.entry;
  return t
    ? (this.entry = t[nl], {
      done: !1,
      value: t.key
    })
    : {
      done: !0,
      value: void 0
    }
},
lr.prototype[Symbol.iterator] = function() {
  return this
},
lr.prototype.next = function() {
  var t = this.entry;
  return t
    ? (this.entry = t[nl], {
      done: !1,
      value: t.value
    })
    : {
      done: !0,
      value: void 0
    }
},
or.prototype.keys = function() {
  return new sr(this.oldest)
},
or.prototype.values = function() {
  return new lr(this.oldest)
},
or.prototype.entries = function() {
  return this
},
or.prototype[Symbol.iterator] = function() {
  return new ar(this.oldest)
},
or.prototype.forEach = function(t, e) {
  "object" !== (
    void 0 === e
    ? "undefined"
    : _typeof(e)) && (e = this);
  for (var i = this.oldest; i;)
    t.call(e, i.value, i.key, this),
    i = i[nl]
},
or.prototype.toJSON = function() {
  for (var t = new Array(this.size), e = 0, i = this.oldest; i;)
    t[e++] = {
      key: i.key,
      value: i.value
    }
  ,
  i = i[nl];
  return t
},
or.prototype.toString = function() {
  for (var t = "", e = this.oldest; e;)
    t += String(e.key) + ":" + e.value,
    (e = e[nl]) && (t += " < ");
  return t
},
Object.assign(hr.prototype, {
  getCurrentRenderTarget: function() {
    return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),
    this.getRenderTarget()
  },
  supportsFloatTextures: function() {
    return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),
    this.extensions.get("OES_texture_float")
  },
  supportsHalfFloatTextures: function() {
    return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),
    this.extensions.get("OES_texture_half_float")
  },
  supportsStandardDerivatives: function() {
    return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),
    this.extensions.get("OES_standard_derivatives")
  },
  supportsCompressedTextureS3TC: function() {
    return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),
    this.extensions.get("WEBGL_compressed_texture_s3tc")
  },
  supportsCompressedTexturePVRTC: function() {
    return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),
    this.extensions.get("WEBGL_compressed_texture_pvrtc")
  },
  supportsBlendMinMax: function() {
    return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),
    this.extensions.get("EXT_blend_minmax")
  },
  supportsVertexTextures: function() {
    return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),
    this.capabilities.vertexTextures
  },
  supportsInstancedArrays: function() {
    return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),
    this.extensions.get("ANGLE_instanced_arrays")
  },
  enableScissorTest: function(t) {
    console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),
    this.setScissorTest(t)
  },
  initMaterial: function() {
    console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")
  },
  addPrePlugin: function() {
    console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")
  },
  addPostPlugin: function() {
    console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")
  },
  updateShadowMap: function() {
    console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")
  }
}),
Object.defineProperties(hr.prototype, {
  shadowMapEnabled: {
    get: function() {
      return this.shadowMap.enabled
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),
      this.shadowMap.enabled = t
    }
  },
  shadowMapType: {
    get: function() {
      return this.shadowMap.type
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),
      this.shadowMap.type = t
    }
  },
  shadowMapCullFace: {
    get: function() {
      return this.shadowMap.cullFace
    },
    set: function(t) {
      console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),
      this.shadowMap.cullFace = t
    }
  }
}),
t.LRUMap = or,
t.WebGLRendererByIncrement = hr,
t.WebGLRenderTargetCube = a,
t.WebGLRenderTarget = r,
t.WebGLRenderer = pe,
t.ShaderLib = Os,
t.UniformsLib = Ls,
t.UniformsUtils = Ms,
t.ShaderChunk = Ss,
t.FogExp2 = fe,
t.Fog = me,
t.Scene = ge,
t.LensFlare = ve,
t.Sprite = Ee,
t.LOD = xe,
t.SkinnedMesh = Ce,
t.Skeleton = be,
t.Bone = we,
t.Mesh = St,
t.LineSegments = Le,
t.LineLoop = Me,
t.Line = _e,
t.Points = Oe,
t.Group = De,
t.VideoTexture = Re,
t.DataTexture = h,
t.CompressedTexture = Ue,
t.CubeTexture = u,
t.CanvasTexture = Ae,
t.DepthTexture = Ie,
t.Texture = n,
t.CompressedTextureLoader = Di,
t.DataTextureLoader = Ri,
t.CubeTextureLoader = Ai,
t.TextureLoader = Ii,
t.ObjectLoader = hn,
t.MaterialLoader = an,
t.BufferGeometryLoader = sn,
t.DefaultLoadingManager = ks,
t.LoadingManager = Si,
t.JSONLoader = cn,
t.ImageLoader = Ui,
t.FontLoader = Un,
t.FileLoader = Oi,
t.Loader = ln,
t.Cache = Ns,
t.AudioLoader = An,
t.SpotLightShadow = ki,
t.SpotLight = Hi,
t.PointLight = Fi,
t.RectAreaLight = qi,
t.HemisphereLight = Bi,
t.DirectionalLightShadow = Gi,
t.DirectionalLight = Vi,
t.AmbientLight = zi,
t.LightShadow = Ni,
t.Light = Pi,
t.StereoCamera = In,
t.PerspectiveCamera = It,
t.OrthographicCamera = Pt,
t.CubeCamera = Pn,
t.ArrayCamera = Bn,
t.Camera = At,
t.AudioListener = Nn,
t.PositionalAudio = Hn,
t.AudioContext = Xs,
t.AudioAnalyser = Fn,
t.Audio = kn,
t.VectorKeyframeTrack = Ki,
t.StringKeyframeTrack = tn,
t.QuaternionKeyframeTrack = Ji,
t.NumberKeyframeTrack = $i,
t.ColorKeyframeTrack = nn,
t.BooleanKeyframeTrack = en,
t.PropertyMixer = Gn,
t.PropertyBinding = zn,
t.KeyframeTrack = on,
t.AnimationUtils = Hs,
t.AnimationObjectGroup = qn,
t.AnimationMixer = jn,
t.AnimationClip = rn,
t.Uniform = Xn,
t.InstancedBufferGeometry = Yn,
t.BufferGeometry = Mt,
t.GeometryIdCount = _t,
t.Geometry = Lt,
t.InterleavedBufferAttribute = Zn,
t.InstancedInterleavedBuffer = Qn,
t.InterleavedBuffer = Kn,
t.InstancedBufferAttribute = Jn,
t.Face3 = ut,
t.Object3D = lt,
t.Raycaster = $n,
t.Layers = st,
t.EventDispatcher = e,
t.Clock = io,
t.QuaternionLinearInterpolant = Qi,
t.LinearInterpolant = Xi,
t.DiscreteInterpolant = Yi,
t.CubicInterpolant = ji,
t.Interpolant = Wi,
t.Triangle = ht,
t.Math = gs,
t.Spherical = no,
t.Cylindrical = oo,
t.Plane = it,
t.Frustum = nt,
t.Sphere = tt,
t.Ray = rt,
t.Matrix4 = c,
t.Matrix3 = et,
t.Box3 = $,
t.Box2 = X,
t.Line3 = ct,
t.Euler = at,
t.Vector4 = o,
t.Vector3 = l,
t.Vector2 = i,
t.Quaternion = s,
t.Color = j,
t.MorphBlendMesh = ro,
t.ImmediateRenderObject = ao,
t.VertexNormalsHelper = so,
t.SpotLightHelper = lo,
t.SkeletonHelper = co,
t.PointLightHelper = ho,
t.RectAreaLightHelper = uo,
t.HemisphereLightHelper = po,
t.GridHelper = fo,
t.PolarGridHelper = mo,
t.FaceNormalsHelper = go,
t.DirectionalLightHelper = vo,
t.CameraHelper = yo,
t.BoxHelper = Eo,
t.ArrowHelper = xo,
t.AxisHelper = bo,
t.CatmullRomCurve3 = Co,
t.CubicBezierCurve3 = To,
t.QuadraticBezierCurve3 = _o,
t.LineCurve3 = Lo,
t.ArcCurve = Mo,
t.EllipseCurve = Tn,
t.SplineCurve = _n,
t.CubicBezierCurve = Ln,
t.QuadraticBezierCurve = Mn,
t.LineCurve = wn,
t.Shape = On,
t.Path = Sn,
t.ShapePath = Dn,
t.Font = Rn,
t.CurvePath = Cn,
t.Curve = bn,
t.ShapeUtils = Is,
t.SceneUtils = tl,
t.WireframeGeometry = Pe,
t.ParametricGeometry = Be,
t.ParametricBufferGeometry = Ne,
t.TetrahedronGeometry = Fe,
t.TetrahedronBufferGeometry = Ge,
t.OctahedronGeometry = Ve,
t.OctahedronBufferGeometry = ze,
t.IcosahedronGeometry = qe,
t.IcosahedronBufferGeometry = We,
t.DodecahedronGeometry = je,
t.DodecahedronBufferGeometry = Xe,
t.PolyhedronGeometry = ke,
t.PolyhedronBufferGeometry = He,
t.TubeGeometry = Ye,
t.TubeBufferGeometry = Ze,
t.TorusKnotGeometry = Ke,
t.TorusKnotBufferGeometry = Qe,
t.TorusGeometry = Je,
t.TorusBufferGeometry = $e,
t.TextGeometry = ii,
t.TextBufferGeometry = ni,
t.SphereGeometry = oi;
t.SphereBufferGeometry = ri,
t.RingGeometry = ai,
t.RingBufferGeometry = si,
t.PlaneGeometry = Rt,
t.PlaneBufferGeometry = Ut,
t.LatheGeometry = li,
t.LatheBufferGeometry = ci,
t.ShapeGeometry = hi,
t.ShapeBufferGeometry = ui,
t.ExtrudeGeometry = ti,
t.ExtrudeBufferGeometry = ei,
t.EdgesGeometry = di,
t.ConeGeometry = mi,
t.ConeBufferGeometry = gi,
t.CylinderGeometry = pi,
t.CylinderBufferGeometry = fi,
t.CircleGeometry = vi,
t.CircleBufferGeometry = yi,
t.BoxGeometry = Ot,
t.BoxBufferGeometry = Dt,
t.ShadowMaterial = Ei,
t.SpriteMaterial = ye,
t.RawShaderMaterial = xi,
t.ShaderMaterial = Q,
t.PointsMaterial = Se,
t.MeshPhysicalMaterial = wi,
t.MeshStandardMaterial = bi,
t.MeshPhongMaterial = Ci,
t.MeshToonMaterial = Ti,
t.MeshNormalMaterial = _i,
t.MeshLambertMaterial = Li,
t.MeshDepthMaterial = J,
t.MeshBasicMaterial = dt,
t.LineDashedMaterial = Mi,
t.LineBasicMaterial = Te,
t.Material = K,
t.Float64BufferAttribute = wt,
t.Float32BufferAttribute = bt,
t.Uint32BufferAttribute = xt,
t.Int32BufferAttribute = Et,
t.Uint16BufferAttribute = yt,
t.Int16BufferAttribute = vt,
t.Uint8ClampedBufferAttribute = gt,
t.Uint8BufferAttribute = mt,
t.Int8BufferAttribute = ft,
t.BufferAttribute = pt,
t.REVISION = ur,
t.MOUSE = dr,
t.CullFaceNone = pr,
t.CullFaceBack = fr,
t.CullFaceFront = mr,
t.CullFaceFrontBack = 3,
t.FrontFaceDirectionCW = gr,
t.FrontFaceDirectionCCW = 1,
t.BasicShadowMap = 0,
t.PCFShadowMap = vr,
t.PCFSoftShadowMap = yr,
t.FrontSide = Er,
t.BackSide = xr,
t.DoubleSide = br,
t.FlatShading = wr,
t.SmoothShading = Cr,
t.NoColors = Tr,
t.FaceColors = _r,
t.VertexColors = Lr,
t.NoBlending = Mr,
t.NormalBlending = Sr,
t.AdditiveBlending = Or,
t.SubtractiveBlending = Dr,
t.MultiplyBlending = Rr,
t.CustomBlending = Ur,
t.AddEquation = Ar,
t.SubtractEquation = Ir,
t.ReverseSubtractEquation = Pr,
t.MinEquation = Br,
t.MaxEquation = Nr,
t.ZeroFactor = kr,
t.OneFactor = Hr,
t.SrcColorFactor = Fr,
t.OneMinusSrcColorFactor = Gr,
t.SrcAlphaFactor = Vr,
t.OneMinusSrcAlphaFactor = zr,
t.DstAlphaFactor = qr,
t.OneMinusDstAlphaFactor = Wr,
t.DstColorFactor = jr,
t.OneMinusDstColorFactor = Xr,
t.SrcAlphaSaturateFactor = Yr,
t.NeverDepth = Zr,
t.AlwaysDepth = Kr,
t.LessDepth = Qr,
t.LessEqualDepth = Jr,
t.EqualDepth = $r,
t.GreaterEqualDepth = ta,
t.GreaterDepth = ea,
t.NotEqualDepth = ia,
t.MultiplyOperation = na,
t.MixOperation = oa,
t.AddOperation = ra,
t.NoToneMapping = aa,
t.LinearToneMapping = sa,
t.ReinhardToneMapping = la,
t.Uncharted2ToneMapping = ca,
t.CineonToneMapping = ha,
t.UVMapping = 300,
t.CubeReflectionMapping = ua,
t.CubeRefractionMapping = da,
t.EquirectangularReflectionMapping = pa,
t.EquirectangularRefractionMapping = fa,
t.SphericalReflectionMapping = ma,
t.CubeUVReflectionMapping = ga,
t.CubeUVRefractionMapping = va,
t.RepeatWrapping = ya,
t.ClampToEdgeWrapping = Ea,
t.MirroredRepeatWrapping = xa,
t.NearestFilter = ba,
t.NearestMipMapNearestFilter = wa,
t.NearestMipMapLinearFilter = Ca,
t.LinearFilter = Ta,
t.LinearMipMapNearestFilter = _a,
t.LinearMipMapLinearFilter = La,
t.UnsignedByteType = Ma,
t.ByteType = Sa,
t.ShortType = Oa,
t.UnsignedShortType = Da,
t.IntType = Ra,
t.UnsignedIntType = Ua,
t.FloatType = Aa,
t.HalfFloatType = Ia,
t.UnsignedShort4444Type = Pa,
t.UnsignedShort5551Type = Ba,
t.UnsignedShort565Type = Na,
t.UnsignedInt248Type = ka,
t.AlphaFormat = Ha,
t.RGBFormat = Fa,
t.RGBAFormat = Ga,
t.LuminanceFormat = Va,
t.LuminanceAlphaFormat = za,
t.RGBEFormat = qa,
t.DepthFormat = Wa,
t.DepthStencilFormat = ja,
t.RGB_S3TC_DXT1_Format = Xa,
t.RGBA_S3TC_DXT1_Format = Ya,
t.RGBA_S3TC_DXT3_Format = Za,
t.RGBA_S3TC_DXT5_Format = Ka,
t.RGB_PVRTC_4BPPV1_Format = Qa,
t.RGB_PVRTC_2BPPV1_Format = Ja,
t.RGBA_PVRTC_4BPPV1_Format = $a,
t.RGBA_PVRTC_2BPPV1_Format = ts,
t.RGB_ETC1_Format = es,
t.LoopOnce = 2200,
t.LoopRepeat = is,
t.LoopPingPong = 2202,
t.InterpolateDiscrete = 2300,
t.InterpolateLinear = 2301,
t.InterpolateSmooth = 2302,
t.ZeroCurvatureEnding = ns,
t.ZeroSlopeEnding = 2401,
t.WrapAroundEnding = 2402,
t.TrianglesDrawMode = os,
t.TriangleStripDrawMode = rs,
t.TriangleFanDrawMode = as,
t.LinearEncoding = ss,
t.sRGBEncoding = ls,
t.GammaEncoding = cs,
t.RGBEEncoding = hs,
t.LogLuvEncoding = 3003,
t.RGBM7Encoding = us,
t.RGBM16Encoding = ds,
t.RGBDEncoding = ps,
t.BasicDepthPacking = fs,
t.RGBADepthPacking = ms,
t.CubeGeometry = Ot,
t.Face4 = So,
t.LineStrip = 0,
t.LinePieces = 1,
t.MeshFaceMaterial = Oo,
t.MultiMaterial = Do,
t.PointCloud = Ro,
t.Particle = Uo,
t.ParticleSystem = Ao,
t.PointCloudMaterial = Io,
t.ParticleBasicMaterial = Po,
t.ParticleSystemMaterial = Bo,
t.Vertex = No,
t.DynamicBufferAttribute = ko,
t.Int8Attribute = Ho,
t.Uint8Attribute = Fo,
t.Uint8ClampedAttribute = Go,
t.Int16Attribute = Vo,
t.Uint16Attribute = zo,
t.Int32Attribute = qo,
t.Uint32Attribute = Wo,
t.Float32Attribute = jo,
t.Float64Attribute = Xo,
t.ClosedSplineCurve3 = Yo,
t.SplineCurve3 = Zo,
t.Spline = Ko,
t.BoundingBoxHelper = Qo,
t.EdgesHelper = Jo,
t.WireframeHelper = $o;
t.XHRLoader = tr,
t.BinaryTextureLoader = er,
t.GeometryUtils = el,
t.ImageUtils = il,
t.Projector = ir,
t.CanvasRenderer = nr,
Object.defineProperty(t, "__esModule", {
  value: !0
})
}), CLOUD.Version = "20170809", CLOUD.GlobalData = {
SceneSize: 1e3,
TextureResRoot: "images/",
EnableTextureMapping: !1,
SelectionColor: {
  color: 15293,
  side: THREE.DoubleSide
},
DisableAntialias: !1,
EnableDemolishByDClick: !1,
IsMobile: !1,
UseMpkWorker: !1,
MpkWorkerUrl: "../libs/mpkWorker.min.js",
ZipResourcePostfix: "",
UseLayerData: !1,
IncrementRender: !0,
LimitFrameTime: 250,
maxObjectNumInPool: 6e4,
maxDrawCacheNum: 4e4,
OctantDepth: 15,
MaximumDepth: 0,
TargetDistance: 1e4,
ConcurrencyRequestCount: 8,
ShowOctant: !1,
EnableOctant: !0,
DirectionalLight: !1,
IBL: !1,
ToneMapping: 4,
LightIntensityFactor: 2.5,
Hover: !1,
ReverseWheelDirection: !1,
MovementSpeedRate: 1,
OcclusionTranslucentEnabled: !1,
OcclusionOpacity: .5,
OcclusionDistanceToCamera: 1e3,
WireFrame: !1,
DisablePick: !1,
DEBUG: !1
}, CLOUD.EnumStandardView = {
ISO: 0,
Top: 1,
Bottom: 2,
Front: 3,
Back: 4,
Right: 5,
Left: 6,
SouthEast: 7,
SouthWest: 8,
NorthEast: 9,
NorthWest: 10,
BottomFront: 11,
BottomBack: 12,
BottomRight: 13,
BottomLeft: 14,
BottomSouthEast: 15,
BottomSouthWest: 16,
BottomNorthEast: 17,
BottomNorthWest: 18,
RoofFront: 19,
RoofBack: 20,
RoofRight: 21,
RoofLeft: 22,
RoofSouthEast: 23,
RoofSouthWest: 24,
RoofNorthEast: 25,
RoofNorthWest: 26,
TopTurnRight: 27,
TopTurnBack: 28,
TopTurnLeft: 29,
BottomTurnRight: 30,
BottomTurnBack: 31,
BottomTurnLeft: 32,
FrontTurnRight: 33,
FrontTurnTop: 34,
FrontTurnLeft: 35,
RightTurnBack: 36,
RightTurnTop: 37,
RightTurnFront: 38,
BackTurnRight: 39,
BackTurnTop: 40,
BackTurnLeft: 41,
LeftTurnFront: 42,
LeftTurnTop: 43,
LeftTurnBack: 44
}, CLOUD.OPSELECTIONTYPE = {
Clear: 0,
Add: 1,
Remove: 2
}, CLOUD.EVENTS = {
ON_LOAD_START: 0,
ON_LOAD_PROGRESS: 1,
ON_LOAD_COMPLETE: 2,
ON_LOAD_EMPTY_SCENE: 3,
ON_LOAD_CONFIG_FINISH: 4,
ON_LOAD_INVALID_SCENE: 5,
ON_EDITOR_ENTER: 40,
ON_EDITOR_EXIST: 41,
ON_EDITOR_BEGIN: 42,
ON_EDITOR_END: 43,
ON_EDITOR_UPDATEUI: 44,
ON_EDITOR_KEYDOWN: 50,
ON_EDITOR_KEYUP: 51,
ON_SELECTION_CHANGED: 100,
ON_CLICK_PICK: 101,
ON_VERSION_NO_MATCH: 200
}, CLOUD.EnumRenderType = {
RENDER: 0,
RENDER_FINISHED: 1,
RESIZE: 2
}, CLOUD.PrimitiveCount = {
vertexCount: 0,
triangleCount: 0
}, CLOUD.PointRotateMode = {
MOUSEPOINT: 0,
SELECTION: 1,
CENTER: 2,
CAMERA: 3
}, CLOUD.EnumConditionType = {
HIDDEN_OTHERS: 0,
TRANSLUCENT_OTHERS: 1,
OVERRIDE: 2
}, CLOUD.EnumIdBasedType = {
FILE_VISIBLE: 0,
FILE_HIDDEN: 1,
SELECTED: 2,
VISIBLE: 3,
HIDDEN: 4,
TRANSLUCENT: 5,
TRANSLUCENT_OTHERS: 6
}, CLOUD.EnumUserType = {
HIDDEN_DATA: 0,
OVERRIDE_DATA: 1
}, CLOUD.EnumIsolateState = {
HIDDEN: 0,
HIDDEN_OTHERS: 1,
TRANSLUCENT: 2,
TRANSLUCENT_OTHERS: 3
}, CLOUD.EnumSceneState = {
DISABLED: 0,
TRANSLUCENT: 1,
HIDDEN: 2
}, CLOUD.EditorMode = {
ORBIT: "orbit",
PICK: "pick",
PICK_BY_RECT: "pickByRect",
PAN: "pan",
ZOOM: "zoom",
ZOOM_BY_RECT: "zoomByRect",
FLY: "fly",
WALK: "walk",
CLIP_BY_BOX: "clipByBox",
CLIP_FILL: "fillClip"
}, CLOUD.MoveDirection = {
NONE: 0,
UP: 1,
DOWN: 2,
LEFT: 4,
RIGHT: 8,
FORWARD: 16,
BACK: 32
}, CLOUD.Utils = {
box3FromArray: function(t, e) {
  if (t instanceof Array) {
    var i = e || new THREE.Box3;
    return i.min.fromArray(t, 0),
    i.max.fromArray(t, 3),
    i
  }
  return null
},
computeBBox: function(t) {
  for (var e = new THREE.Box3, i = new THREE.Vector3, n = 0, o = t.length; n < o; ++n)
    i.fromArray(t[n], 0),
    e.expandByPoint(i);
  return e
},
mergeBBox: function(t) {
  if (t.length < 1)
    return null;
  for (var e = new THREE.Box3, i = new THREE.Vector3, n = new THREE.Vector3, o = new THREE.Box3, r = 0, a = t.length; r < a; r++)
    i.set(t[r].max.x, t[r].max.y, t[r].max.z),
    n.set(t[r].min.x, t[r].min.y, t[r].min.z),
    o.set(n, i),
    e.union(o);
  return e
},
parseTransform: function(t, e, i) {
  var n = !1;
  if (e.rotation && (t.rotation.fromArray(e.rotation), n = !0), e.position && (t.position.fromArray(e.position), n = !0), e.scale && (t.scale.fromArray(e.scale), n = !0), e.quaternion && (t.quaternion.fromArray(e.quaternion), n = !0), n && t.updateMatrix(), e.matrix && t.matrix.fromArray(e.matrix), i) {
    var o = t.matrix.clone();
    o.multiplyMatrices(i, t.matrix),
    t.matrix = o
  }
  t.matrixAutoUpdate = !1,
  void 0 !== t.boundingBox && (t.boundingBox = CLOUD.Utils.box3FromArray(e.bbox))
},
isMobileDevice: function() {
  var t = navigator.platform;
  return 0 !== t.indexOf("Win") && 0 !== t.indexOf("Mac")
},
isEmptyObject: function(t) {
  if (!t)
    return !0;
  if (t.length > 0)
    return !1;
  if (0 === t.length)
    return !0;
  for (var e in t)
    if (t.hasOwnProperty(e))
      return !1;
return !0
},
findRange: function(t, e) {
  if (e < Math.min.apply(null, t))
    return 0;
  if (e > Math.max.apply(null, t))
    return t.length - 1;
  for (var i = 0, n = 0, o = t.length; n < o; ++n)
    if (t[n] > e) {
      i = n - 1;
      break
    }
  return i
}
}, CLOUD.DomUtil = {
splitStr: function(t) {
  return t.trim().split(/\s+/g)
},
getContainerOffsetToClient: function(t) {
  var e,
    i = function(t) {
      for (var e = 0, i = 0; t;)
        e += t.offsetTop,
        i += t.offsetLeft,
        t = t.offsetParent;
      var n = document.body,
        o = document.documentElement,
        r = window.pageYOffset || o.scrollTop || n.scrollTop,
        a = window.pageXOffset || o.scrollLeft || n.scrollLeft;
      return e -= r,
      i -= a, {
        top: e,
        left: i
      }
    },
    n = function(t) {
      var e = t.getBoundingClientRect(),
        i = document.body,
        n = document.documentElement,
        o = n.clientTop || i.clientTop,
        r = n.clientLeft || i.clientLeft,
        a = e.top - o,
        s = e.left - r;
      return {top: Math.round(a), left: Math.round(s)}
    };
  if (t != document) {
    var o = function(t) {
      return t.getBoundingClientRect
        ? n(t)
        : i(t)
    }(t);
    e = {
      width: t.offsetWidth,
      height: t.offsetHeight,
      left: o.left,
      top: o.top
    }
  } else
    e = {
      width: window.innerWidth,
      height: window.innerHeight,
      left: 0,
      top: 0
    };
  return e
},
setClassName: function(t, e) {
  var i = document.getElementById(t);
  i && (i.className = e)
},
addClassName: function(t, e) {
  var i,
    n,
    o,
    r,
    a,
    s = document.getElementById(t);
  if (s && (n = s, e && "string" == typeof e && (i = e.split(/\s+/), 1 === n.nodeType)))
    if (n.className || 1 !== i.length) {
      for (o = " " + n.className + " ", r = 0, a = i.length; r < a; ++r)
        o.indexOf(" " + i[r] + " ") < 0 && (o += i[0] + " ");
      n.className = String.trim(o)
    } else
      n.className = e
},
removeClassName: function(t, e) {
  var i,
    n,
    o,
    r,
    a,
    s = document.getElementById(t);
  if (s && (o = s, e && "string" == typeof e && (i = (e || "").split(/\s+/), 1 === o.nodeType && o.className))) {
    for (n = (" " + o.className + " ").replace(O, " "), r = 0, a = i.length; r < a; r++)
      for (; n.indexOf(" " + i[r] + " ") >= 0;)
        n = n.replace(" " + i[r] + " ", " ");
  o.className = e
      ? String.trim(n)
      : ""
  }
},
showOrHideElement: function(t, e) {
  var i = document.getElementById(t);
  i && (
    i.style.display = e
    ? ""
    : "none")
},
getStyleString: function(t) {
  var e = [];
  for (var i in t) {
    var n = t[i];
    e.push(i),
    e.push(":"),
    e.push(n),
    e.push("; ")
  }
  return e.join("")
},
cloneStyle: function(t) {
  var e = {};
  for (var i in t)
    e[i] = t[i];
  return e
},
removeStyleAttribute: function(t, e) {
  Array.isArray(e) || (e = [e]),
  e.forEach(function(e) {
    e in t && delete t[e]
  })
},
trimRight: function(t) {
  if (0 === t.length)
    return "";
  for (var e = t.length - 1, i = e; i >= 0; --i)
    if (" " !== t.charAt(i)) {
      e = i;
      break
    }
  return t.substr(0, e + 1)
},
trimLeft: function(t) {
  if (0 === t.length)
    return "";
  for (var e = 0, i = 0; i < t.length; ++i)
    if (" " !== t.charAt(i)) {
      e = i;
      break
    }
  return t.substr(e)
},
matchesSelector: function(t, e) {
  if (t.matches)
    return t.matches(e);
  if (t.matchesSelector)
    return t.matchesSelector(e);
  if (t.webkitMatchesSelector)
    return t.webkitMatchesSelector(e);
  if (t.msMatchesSelector)
    return t.msMatchesSelector(e);
  if (t.mozMatchesSelector)
    return t.mozMatchesSelector(e);
  if (t.oMatchesSelector)
    return t.oMatchesSelector(e);
  if (t.querySelectorAll) {
    for (var i = (t.document || t.ownerDocument).querySelectorAll(e), n = 0; i[n] && i[n] !== element;)
      n++;
    return !!i[n]
  }
  return !1
},
toTranslate3d: function(t, e) {
  return "translate3d(" + t + "px," + e + "px,0)"
},
setCursorStyle: function(t, e) {
  var i;
  switch (e) {
    case "n":
    case "s":
      i = "ns-resize";
      break;
    case "w":
    case "e":
      i = "ew-resize";
      break;
    case "ne":
    case "sw":
      i = "nesw-resize";
      break;
    case "nw":
    case "se":
      i = "nwse-resize"
  }
  t.style.cursor = i
}
}, CLOUD.GeomUtil = {
EmptyGeometry: new THREE.Geometry,
UnitCylinderInstance: new THREE.CylinderBufferGeometry(1, 1, 1, 8, 1, !1),
UnitBoxInstance: new THREE.BoxBufferGeometry(1, 1, 1),
initializeUnitInstances: function() {
  CLOUD.GeomUtil.UnitCylinderInstance.boundingBox || CLOUD.GeomUtil.UnitCylinderInstance.computeBoundingBox(),
  CLOUD.GeomUtil.UnitBoxInstance.boundingBox || CLOUD.GeomUtil.UnitBoxInstance.computeBoundingBox()
},
destroyUnitInstances: function() {
  CLOUD.GeomUtil.UnitCylinderInstance.dispose(),
  CLOUD.GeomUtil.UnitBoxInstance.dispose()
},
getWorldMatrixOfMesh: function(t) {
  for (var e = [], i = t.parent; i;)
    e.push(i.matrix),
    i = i.parent;
  var n = new THREE.Matrix4;
  if (e.length > 0) {
    n = e[e.length - 1];
    for (var o = e.length - 2; o >= 0; --o)
      n.multiply(e[o])
  }
  var r = new THREE.Matrix4;
  return r.multiplyMatrices(n, t.matrix),
  r
},
getWorldPositionOfMesh: function(t, e) {
  e || (e = new THREE.Matrix4);
  var i = new THREE.Matrix4;
  i.getInverse(e);
  var n = t.clone();
  return n.applyMatrix4(i),
  n
},
getBoundingBoxWorldOfMesh: function(t, e) {
  var i = t.boundingBox;
  i || (t.geometry.boundingBox || t.geometry.computeBoundingBox(), i = t.geometry.boundingBox);
  var n = i.clone();
  n.applyMatrix4(t.matrixWorld);
  var o = new THREE.Matrix4;
  return o.getInverse(e),
  n.applyMatrix4(o),
  n
}
}, CLOUD.MaterialUtil = {
DefaultMaterial: new THREE.MeshPhongMaterial({color: 255, side: THREE.DoubleSide}),
createInstancePhongMaterial: function(t) {
  return t.clone()
},
updateBasicMaterial: function(t, e) {
  t.needsUpdate = !0
},
setMatrixUniform: function(t) {
  CLOUD.ShaderMaterial.ShaderLib.base_cust_clip.uniforms.transformMatrix.value = t
},
createPhongMaterial: function(t) {
  var e = new THREE.MeshPhongMaterial(t);
  return e.type = "FillFacePhong",
  e.uniforms = THREE.UniformsUtils.merge([THREE.ShaderLib.fillFacePhong.uniforms]),
  e.vertexShader = THREE.ShaderLib.fillFacePhong.vertexShader,
  e.fragmentShader = THREE.ShaderLib.fillFacePhong.fragmentShader,
  e.side = THREE.DoubleSide,
  e
},
createHighlightMaterial: function() {
  return this.createPhongMaterial(CLOUD.GlobalData.SelectionColor)
},
getMaterialParameters: function(t) {
  var e = {};
  return t.hasOwnProperty("color") && (e.color = t.color),
  t.hasOwnProperty("opacity") && (e.opacity = t.opacity, t.opacity < 1 && (e.transparent = !0)),
  t.hasOwnProperty("side") && (e.side = t.side),
  t.hasOwnProperty("emissive") && (e.emissive = t.emissive),
  t.hasOwnProperty("specular") && (e.specular = t.specular),
  t.hasOwnProperty("shininess") && (e.shininess = t.shininess),
  t.hasOwnProperty("map") && (e.map = t.map),
  t.hasOwnProperty("iblProbe") && (e.iblProbe = t.iblProbe),
  e
},
nextHighestPowerOfTwo: function(t) {
  --t;
  for (var e = 1; e < 32; e <<= 1)
    t |= t >> e;
  return t + 1
},
ensurePowerOfTwo: function(t) {
  if (!THREE.Math.isPowerOfTwo(t.width) || !THREE.Math.isPowerOfTwo(t.height)) {
    var e = document.createElement("canvas");
    e.width = CLOUD.MaterialUtil.nextHighestPowerOfTwo(t.width),
    e.height = CLOUD.MaterialUtil.nextHighestPowerOfTwo(t.height);
    return e.getContext("2d").drawImage(t, 0, 0, t.width, t.height, 0, 0, e.width, e.height),
    e
  }
  return t
}
}, CLOUD.CameraInfo = function(t, e, i, n) {
this.position = t,
this.target = e,
this.up = i,
this.version = void 0 === n
  ? 1
  : n
}, CLOUD.CameraUtil = {
createCameraInfo: function(t) {
  var e = t.camera,
    i = new CameraInfo(e.position, e.target, e.up);
  return JSON.stringify(i)
},
transformCamera: function(t, e) {
  var i = new THREE.Vector3,
    n = function(t) {
      return [
        parseFloat(t[0]),
        parseFloat(t[1]),
        parseFloat(t[2])
      ]
    };
  i.fromArray(n(t.position.split(",")));
  var o = new THREE.Vector3;
  o.fromArray(n(t.direction.split(",")));
  var r = new THREE.Vector3;
  r.fromArray(n(t.up.split(",")));
  var a = new THREE.Vector3;
  a.addVectors(i, o),
  i.applyMatrix4(e.rootNode.matrix),
  a.applyMatrix4(e.rootNode.matrix);
  var s = new THREE.Matrix4;
  return s.makeRotationFromEuler(e.rootNode.rotation),
  r.applyMatrix4(s),
  r.normalize(),
  new CLOUD.CameraInfo(i, a, r)
},
parseCameraInfo: function(t) {
  var e = JSON.parse(t),
    i = new THREE.Vector3;
  i.x = e.position.x,
  i.y = e.position.y,
  i.z = e.position.z;
  var n = new THREE.Vector3;
  n.x = e.target.x,
  n.y = e.target.y,
  n.z = e.target.z;
  var o = new THREE.Vector3;
  o.x = e.up.x,
  o.y = e.up.y,
  o.z = e.up.z;
  var r = void 0 === e.version
    ? 0
    : e.version;
  return new CLOUD.CameraInfo(i, n, o, r)
},
canvasToNormalized: function(t, e, i) {
  var n = {
    x: 0,
    y: 0,
    z: 0
  };
  return n.x = t.x / e * 2 - 1,
  n.y = -t.y / i * 2 + 1,
  n.z = t.z || 0,
  n
},
normalizedToCanvas: function(t, e, i) {
  var n = {
    x: 0,
    y: 0,
    z: 0
  };
  return n.x = Math.floor(.5 * (t.x + 1) * e + .5),
  n.y = Math.floor(-.5 * (t.y - 1) * i + .5),
  n.z = t.z || 0,
  n
},
drawingToCanvas: function(t, e, i, n) {
  var o = new THREE.Vector3(e.x, e.y, e.z);
  return o.project(t),
  Math.abs(o.z) > 1
    ? (console.log("The point is not in the camera frustum!"), null)
    : this.normalizedToCanvas(o, i, n)
},
canvasToDrawing: function(t, e, i, n) {
  var o = this.canvasToNormalized(e, i, n),
    r = new THREE.Vector3(o.x, o.y, o.z);
  return r.unproject(t), {
    x: r.x,
    y: r.y,
    z: r.z
  }
},
intersectBoxByRay: function(t, e) {
  var i,
    n,
    o,
    r,
    a,
    s,
    l = 1 / t.direction.x,
    c = 1 / t.direction.y,
    h = 1 / t.direction.z,
    u = t.origin;
  return l >= 0
    ? (i = (e.min.x - u.x) * l, n = (e.max.x - u.x) * l)
    : (i = (e.max.x - u.x) * l, n = (e.min.x - u.x) * l),
  c >= 0
    ? (o = (e.min.y - u.y) * c, r = (e.max.y - u.y) * c)
    : (o = (e.max.y - u.y) * c, r = (e.min.y - u.y) * c),
  i > r || o > n
    ? null
    : (
      (o > i || i !== i) && (i = o), (r < n || n !== n) && (n = r), h >= 0
      ? (a = (e.min.z - u.z) * h, s = (e.max.z - u.z) * h)
      : (a = (e.max.z - u.z) * h, s = (e.min.z - u.z) * h),
    i > s || a > n
      ? null
      : (
        (a > i || i !== i) && (i = a), (s < n || n !== n) && (n = s), n < 0
        ? null
        : i >= 0
          ? i
          : n))
},
intersectObject: function(t, e, i, n) {
  if (t.visible) {
    var o = t.raycast(e, i);
    if (n === !0 && t.children) {
      var r = t.children;
      if (r.length > 0 && !o)
        return;
      for (var a = 0, s = r.length; a < s; a++)
        CLOUD.CameraUtil.intersectObject(r[a], e, i, !0)
    }
  }
},
intersectObjectWithFrustum: function() {
  var t = new THREE.Box3;
  return function(e, i) {
    if (!e.boundingBox || e instanceof THREE.Mesh) {
      var n = e.geometry;
      null === n.boundingBox && n.computeBoundingBox(),
      t.copy(n.boundingBox)
    } else
      t.copy(e.boundingBox);
    return t.applyMatrix4(e.matrixWorld),
    i.intersectsBox(t)
  }
}()
}, CLOUD.Logger = {
log: function() {
  CLOUD.GlobalData.DEBUG && console.log.apply(console, arguments)
},
debug: function() {
  CLOUD.GlobalData.DEBUG && console.debug.apply(console, arguments)
},
warn: function() {
  CLOUD.GlobalData.DEBUG && console.warn.apply(console, arguments)
},
error: function() {
  CLOUD.GlobalData.DEBUG && console.error.apply(console, arguments)
},
time: function() {
  CLOUD.GlobalData.DEBUG && console.time.apply(console, arguments)
},
timeEnd: function() {
  CLOUD.GlobalData.DEBUG && console.timeEnd.apply(console, arguments)
}
}, CLOUD.UIHelper = {
debugInfoDiv: null,
lastDebugInfoDivShow: null,
showPickedInformation: function(t) {
  function e() {
    var t = o.debugInfoDiv;
    t && "none" !== t.style.display && (t.style.display = "none", o.lastDebugInfoDivShow && (t.removeEventListener("dblclick", e, !1), o.lastDebugInfoDivShow = !1))
  }
  var i = 340,
    n = 320,
    o = this;
  if (!t || !t.intersectInfo)
    return void e();
  var r = t.intersectInfo,
    a = t.screenPos.x,
    s = t.screenPos.y;
  this.debugInfoDiv || (this.debugInfoDiv = document.createElement("div"), this.debugInfoDiv.id = "debugPickedInfo", this.debugInfoDiv.style.display = "block", this.debugInfoDiv.style.position = "absolute", this.debugInfoDiv.style.width = i + "px", this.debugInfoDiv.style.height = n + "px", this.debugInfoDiv.style.backgroundColor = "#ffffdd", this.debugInfoDiv.style.borderWidth = "2px", this.debugInfoDiv.style.borderStyle = "solid", this.debugInfoDiv.style.opacity = "0.8", document.body.appendChild(this.debugInfoDiv)),
  this.debugInfoDiv.style.display = "",
  this.lastDebugInfoDivShow || (this.lastDebugInfoDivShow = !0, this.debugInfoDiv.addEventListener("dblclick", e, !1));
  var l = r.axisGridInfo,
    c = r.worldPosition,
    h = "";
  h += "<span>&#9830;&nbsp;&nbsp;Base Information</span><ul style='width:340px;list-style:none'>",
  h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;border-bottom: 1px solid #ccc;float:left;width:80px;height:66px;text-align:left;line-height:66px'>ID</li>",
  h += "<li style='border:1px solid #ccc;float:left;width:200px;height:66px;text-align:left;'>" + r.selectedObjectId + "</li>",
  h += "</ul>",
  h += "</br><span>&#9830;&nbsp;&nbsp;Position</span><ul style='width:340px;list-style:none'>",
  h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px'>X</li>",
  h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px;border-right: 1px solid #ccc'>" + c.x + "</li>",
  h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px'>Y</li>",
  h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px;border-right: 1px solid #ccc'>" + c.y + "</li>",
  h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px;border-bottom: 1px solid #ccc'>Z</li>",
  h += "<li style='border:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px'>" + c.z + "</li>",
  h += "</ul>",
  l
    ? (h += "</br><span>&#9830;&nbsp;&nbsp;Axis Grid Information</span><ul style='width:340px;list-style:none'>", h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px'>distanceX</li>", h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px;border-right: 1px solid #ccc'>(" + l.numeralName + ", " + l.offsetX + ")</li>", h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px;border-bottom: 1px solid #ccc'>distanceY</li>", h += "<li style='border:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px'>(" + l.abcName + ", " + l.offsetY + ")</li>", h += "</ul>")
    : (h += "</br><span>&#9830;&nbsp;&nbsp;Axis Grid Information</span><ul style='width:340px;list-style:none'>", h += "<li style='border-left:1px solid #ccc;border-top:1px solid #ccc;float:left;width:80px;height:33px;text-align:left;line-height:33px;border-bottom: 1px solid #ccc'>message</li>", h += "<li style='border:1px solid #ccc;float:left;width:200px;height:33px;text-align:left;line-height:33px'><span style='color: red'> not exist axis grid!!!</span></li>", h += "</ul>"),
  this.debugInfoDiv.innerHTML = h + "<br /><br />",
  function(t, e, o) {
    if (t && "none" != t.style.display) {
      var r,
        a,
        s = e + i,
        l = o + n;
      if (void 0 !== e && void 0 !== o)
        if (window.innerWidth)
          r = s > window.innerWidth
            ? window.pageXOffset + (e - i) + "px"
            : window.pageXOffset + e + "px",
          a = l > window.innerHeight
            ? window.pageYOffset + (o - n) + "px"
            : window.pageYOffset + o + "px";
        else {
          var c = document.documentElement;
          r = c.scrollLeft + e + "px",
          a = c.scrollTop + o + "px"
        }
      else if (window.innerWidth)
        r = window.pageXOffset + (window.innerWidth - i) / 2 + "px",
        a = window.pageYOffset + (window.innerHeight - n) / 2 + "px";
      else {
        var c = document.documentElement;
        r = c.scrollLeft + (c.offsetWidth - i) / 2 + "px",
        a = c.scrollTop + (c.offsetHeight - n) / 2 + "px"
      }
      t.style.left = r,
      t.style.top = a
    }
  }(this.debugInfoDiv, a, s)
}
}, CLOUD.OctantNeighborUtil = function(t, e) {
this.camera = t,
this.root = e,
this.searchNeighborOfNeighbor = !1,
this.containChildOfNeighbor = !1,
this.containedOctants = [],
this.father = function(t) {
  return t++,
  t < this.containedOctants.length
    ? this.containedOctants[t]
    : null
},
this.adjFace = function(t, e) {
  return i[8 * t + e]
},
this.adjEdge = function(t, e) {
  return n[8 * t + e]
},
this.adjVertex = function(t, e) {
  return t == e
},
this.refelectFace = function(t, e) {
  return o[8 * t + e]
},
this.refelectEdge = function(t, e) {
  return r[8 * t + e]
},
this.refelectVertex = function(t, e) {
  return this.OctType.MAXTYPEID - e
},
this.common_face_edge = function(t, e) {
  return a[8 * t + e]
},
this.common_face_vertex = function(t, e) {
  return s[8 * t + e]
},
this.common_edge = function(t, e) {
  return l[8 * t + e]
},
this.son = function(t, e) {
  var i,
    n = t.childOctants.length;
  for (i = 0; i < n; i++)
    if (t.childOctants[i].octType == e)
      return t.childOctants[i];
return null
},
this.FaceType = {
  L: 0,
  R: 1,
  D: 2,
  U: 3,
  B: 4,
  F: 5,
  UNKNOWN: 6
},
this.EdgeType = {
  LD: 0,
  LU: 1,
  LB: 2,
  LF: 3,
  RD: 4,
  RU: 5,
  RB: 6,
  RF: 7,
  DB: 8,
  DF: 9,
  UB: 10,
  UF: 11,
  UNKNOWN: 12
},
this.OctType = {
  RUF: 0,
  LUF: 1,
  RDF: 2,
  LDF: 3,
  RUB: 4,
  LUB: 5,
  RDB: 6,
  LDB: 7,
  MAXTYPEID: 7
};
var i = [
    !1,
    !0,
    !1,
    !0,
    !1,
    !0,
    !1,
    !0,
    !0,
    !1,
    !0,
    !1,
    !0,
    !1,
    !0,
    !1,
    !1,
    !1,
    !0,
    !0,
    !1,
    !1,
    !0,
    !0,
    !0,
    !0,
    !1,
    !1,
    !0,
    !0,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !0,
    !0,
    !0,
    !0,
    !0,
    !0,
    !0,
    !0,
    !1,
    !1,
    !1,
    !1
  ],
  n = [
    !1,
    !1,
    !1,
    !0,
    !1,
    !1,
    !1,
    !0,
    !1,
    !0,
    !1,
    !1,
    !1,
    !0,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !0,
    !1,
    !0,
    !1,
    !0,
    !1,
    !0,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !0,
    !1,
    !1,
    !1,
    !0,
    !1,
    !0,
    !1,
    !1,
    !1,
    !0,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !0,
    !1,
    !0,
    !1,
    !0,
    !1,
    !0,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !0,
    !0,
    !1,
    !1,
    !0,
    !0,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1,
    !0,
    !0,
    !1,
    !1,
    !0,
    !0,
    !1,
    !1,
    !1,
    !1,
    !1,
    !1
  ],
  o = [
    1,
    0,
    3,
    2,
    5,
    4,
    7,
    6,
    1,
    0,
    3,
    2,
    5,
    4,
    7,
    6,
    2,
    3,
    0,
    1,
    6,
    7,
    4,
    5,
    2,
    3,
    0,
    1,
    6,
    7,
    4,
    5,
    4,
    5,
    6,
    7,
    0,
    1,
    2,
    3,
    4,
    5,
    6,
    7,
    0,
    1,
    2,
    3
  ],
  r = [
    3,
    2,
    1,
    0,
    7,
    6,
    5,
    4,
    3,
    2,
    1,
    0,
    7,
    6,
    5,
    4,
    5,
    4,
    7,
    6,
    1,
    0,
    3,
    2,
    5,
    4,
    7,
    6,
    1,
    0,
    3,
    2,
    3,
    2,
    1,
    0,
    7,
    6,
    5,
    4,
    3,
    2,
    1,
    0,
    7,
    6,
    5,
    4,
    5,
    4,
    7,
    6,
    1,
    0,
    3,
    2,
    5,
    4,
    7,
    6,
    1,
    0,
    3,
    2,
    6,
    7,
    4,
    5,
    2,
    3,
    0,
    1,
    6,
    7,
    4,
    5,
    2,
    3,
    0,
    1,
    6,
    7,
    4,
    5,
    2,
    3,
    0,
    1,
    6,
    7,
    4,
    5,
    2,
    3,
    0,
    1
  ],
  a = [
    6,
    0,
    2,
    6,
    6,
    0,
    2,
    6,
    3,
    6,
    6,
    0,
    3,
    6,
    6,
    0,
    6,
    0,
    6,
    0,
    4,
    6,
    4,
    6,
    5,
    6,
    5,
    6,
    6,
    0,
    6,
    0,
    1,
    6,
    6,
    2,
    1,
    6,
    6,
    2,
    6,
    3,
    1,
    6,
    6,
    3,
    1,
    6,
    1,
    6,
    1,
    6,
    6,
    4,
    6,
    4,
    6,
    5,
    6,
    5,
    1,
    6,
    1,
    6,
    6,
    6,
    2,
    2,
    4,
    4,
    6,
    6,
    5,
    5,
    6,
    6,
    6,
    6,
    2,
    2,
    3,
    3,
    6,
    6,
    6,
    6,
    4,
    4,
    6,
    6,
    5,
    5,
    3,
    3,
    6,
    6
  ],
  s = [
    6,
    6,
    6,
    5,
    6,
    3,
    1,
    6,
    6,
    6,
    5,
    6,
    3,
    6,
    6,
    0,
    6,
    5,
    6,
    6,
    1,
    6,
    6,
    2,
    5,
    6,
    6,
    6,
    6,
    0,
    2,
    6,
    6,
    3,
    1,
    6,
    6,
    6,
    6,
    4,
    3,
    6,
    6,
    0,
    6,
    6,
    4,
    6,
    1,
    6,
    6,
    2,
    6,
    4,
    6,
    6,
    6,
    0,
    2,
    6,
    1,
    6,
    6,
    6
  ],
  l = [
    12,
    11,
    7,
    12,
    5,
    12,
    12,
    12,
    11,
    12,
    12,
    3,
    12,
    1,
    12,
    12,
    7,
    12,
    12,
    9,
    12,
    12,
    4,
    12,
    12,
    3,
    9,
    12,
    12,
    12,
    12,
    0,
    5,
    12,
    12,
    12,
    12,
    10,
    6,
    12,
    12,
    1,
    12,
    12,
    10,
    12,
    12,
    2,
    12,
    12,
    4,
    12,
    6,
    12,
    12,
    8,
    12,
    12,
    12,
    0,
    12,
    2,
    8,
    12
  ]
}, CLOUD.OctantNeighborUtil.prototype.findFaceNeighborImpl = function(t, e) {
var i = {
    node: null,
    cont: !1
  },
  n = this.containedOctants,
  o = n[t];
if (t >= n.length)
  return i;
if (
  this.father(t) && this.adjFace(e, o.octType)
  ? i = this.findFaceNeighborImpl(t + 1, e)
  : (i.node = this.father(t), i.cont = !0),
i.cont && null !== i.node && i.node.childOctants.length > 0) {
  var r = this.son(i.node, this.refelectFace(e, o.octType));
  return r
    ? {
      node: r,
      cont: !0
    }
    : {
      node: i.node,
      cont: !1
    }
}
return i
}, CLOUD.OctantNeighborUtil.prototype.findFaceNeighbor = function(t, e) {
var i = this.findFaceNeighborImpl(t, e);
return i.node && !i.node.isRoot()
  ? i.node
  : null
}, CLOUD.OctantNeighborUtil.prototype.findEdgeNeighborImpl = function(t, e) {
var i = {
    node: null,
    cont: !1
  },
  n = this.containedOctants,
  o = n[t];
if (t >= n.length)
  return i;
if (this.father(t) && (
  this.adjEdge(e, o.octType)
  ? i = this.findEdgeNeighborImpl(t + 1, e)
  : this.common_face_edge(e, o.octType) !== this.FaceType.UNKNOWN
    ? i = this.findFaceNeighborImpl(t + 1, this.common_face_edge(e, o.octType))
    : (i.node = this.father(t), i.cont = !0)), i.cont && null !== i.node && i.node.childOctants.length > 0) {
  var r = this.son(i.node, this.refelectEdge(e, o.octType));
  return r
    ? {
      node: r,
      cont: !0
    }
    : {
      node: i.node,
      cont: !1
    }
}
return i
}, CLOUD.OctantNeighborUtil.prototype.findEdgeNeighbor = function(t, e) {
var i = this.findEdgeNeighborImpl(t, e);
return i.node && !i.node.isRoot()
  ? i.node
  : null
}, CLOUD.OctantNeighborUtil.prototype.findVertexNeighborImpl = function(t, e) {
var i = {
    node: null,
    cont: !1
  },
  n = this.containedOctants,
  o = n[t];
if (t >= n.length)
  return i;
if (this.father(t) && (
  this.adjVertex(e, o.octType)
  ? i = this.findVertexNeighborImpl(t + 1, e)
  : this.common_edge(e, o.octType) !== this.EdgeType.UNKNOWN
    ? i = this.findVertexNeighborImpl(t + 1, this.common_edge(e, o.octType))
    : this.common_face_vertex(e, o.octType) != this.FaceType.UNKNOWN
      ? i = this.findVertexNeighborImpl(t + 1, this.common_face_vertex(e, o.octType))
      : (i.node = this.father(t), i.cont = !0)), i.cont && null !== i.node && i.node.childOctants.length > 0) {
  var r = this.son(i.node, this.refelectVertex(e, o.octType));
  return r
    ? {
      node: r,
      cont: !0
    }
    : {
      node: i.node,
      cont: !1
    }
}
return i
}, CLOUD.OctantNeighborUtil.prototype.findVertexNeighbor = function(t, e) {
var i = this.findVertexNeighborImpl(t, e);
return i.node && !i.node.isRoot()
  ? i.node
  : null
}, CLOUD.OctantNeighborUtil.prototype.findContainNode = function(t) {
var e,
  i = this.camera,
  n = i.position;
if (!(n.x < t.min.x || n.x > t.max.x || n.y < t.min.y || n.y > t.max.y || n.z < t.min.z || n.z > t.max.z)) {
  if (0 != t.childOctants.length) {
    var o,
      r;
    for (o = 0, r = t.childOctants.length; o < r && (e = t.childOctants[o], !this.findContainNode(e)); ++o) ;
    }
  return this.containedOctants.push(t),
  !0
}
return !1
}, CLOUD.OctantNeighborUtil.prototype.findNeighborNode = function() {
var t,
  e = this.searchNeighborOfNeighbor,
  i = this.containChildOfNeighbor,
  n = this.camera,
  o = this.containedOctants,
  r = this.OctType,
  a = this.EdgeType,
  s = [];
if (0 == o.length)
  return s;
var l,
  c,
  h,
  u,
  d,
  p,
  f,
  m,
  g = n.frustum,
  v = o[0];
f = v.min,
m = v.max;
var y = n.target,
  E = n.position,
  x = new THREE.Vector3(y.x - E.x, y.y - E.y, y.z - E.z),
  b = new THREE.Ray(E, x),
  w = [],
  C = new THREE.Box3(f, m),
  T = b.intersectBox(C);
if (T && (
  T.y == f.y || T.y == m.y
  ? T.x <= m.x && T.x >= f.x && T.z <= m.z && T.z >= f.z && (
    T.y == f.y
    ? w.push(2)
    : w.push(3))
  : T.z == f.z || T.z == m.z
    ? T.x <= m.x && T.x >= f.x && T.y <= m.y && T.y >= f.y && (
      T.z == f.z
      ? w.push(4)
      : w.push(5))
    : T.x != f.x && T.x != m.x || T.z <= m.z && T.z >= f.z && T.y <= m.y && T.y >= f.y && (
      T.x == f.x
      ? w.push(0)
      : w.push(1))), 0 == w.length)
  return s;
u = m.x - f.x,
d = m.y - f.y,
p = m.z - f.z,
d > u && (u = d),
p > u && (u = p);
var _ = u,
  L = new THREE.Vector3;
for (l = 0; l < 6; l++)
  if (l != w[0]) {
    switch (L.copy(v.center), l) {
      case 0:
        L.x -= _;
        break;
      case 1:
        L.x += _;
        break;
      case 2:
        L.y -= _;
        break;
      case 3:
        L.y += _;
        break;
      case 4:
        L.z -= _;
        break;
      case 5:
        L.z += _
    }
    var M = _ / 2,
      S = new THREE.Box3(new THREE.Vector3(L.x - M, L.y - M, L.z - M), new THREE.Vector3(L.x + M, L.y + M, L.z + M));
    g.intersectsBox(S) && w.push(l)
  }
if (w.length > 1 && w.sort(), w.length > 2) {
  var O = 0;
  for (l = 0; l < w.length; l++)
    for (c = l + 1; c < w.length; c++)
      for (h = c + 1; h < w.length; h++) {
        if (1 == w[l] && 3 == w[c] && 5 == w[h])
          O = r.RUF;
        else if (0 == w[l] && 3 == w[c] && 5 == w[h])
          O = r.LUF;
        else if (1 == w[l] && 2 == w[c] && 5 == w[h])
          O = r.RDF;
        else if (0 == w[l] && 2 == w[c] && 5 == w[h])
          O = r.LDF;
        else if (1 == w[l] && 3 == w[c] && 4 == w[h])
          O = r.RUB;
        else if (0 == w[l] && 3 == w[c] && 4 == w[h])
          O = r.LUB;
        else if (1 == w[l] && 2 == w[c] && 4 == w[h])
          O = r.RDB;
        else {
          if (0 != w[l] || 2 != w[c] || 4 != w[h])
            continue;
          O = r.LDB
        }
        t = this.findVertexNeighbor(0, O),
        t && (s.push(t), i && this.getChildOfOctant(t, 2, O, s), e && (t = this.getNeighborOfSecondLevel(t, 2, O)) && s.push(t))
      }
    }
if (w.length > 1) {
  var D = 0;
  for (l = 0; l < w.length; l++)
    for (c = l + 1; c < w.length; c++) {
      if (0 == w[l] && 2 == w[c])
        D = a.LD;
      else if (0 == w[l] && 3 == w[c])
        D = a.LU;
      else if (0 == w[l] && 4 == w[c])
        D = a.LB;
      else if (0 == w[l] && 5 == w[c])
        D = a.LF;
      else if (1 == w[l] && 2 == w[c])
        D = a.RD;
      else if (1 == w[l] && 3 == w[c])
        D = a.RU;
      else if (1 == w[l] && 4 == w[c])
        D = a.RB;
      else if (1 == w[l] && 5 == w[c])
        D = a.RF;
      else if (2 == w[l] && 4 == w[c])
        D = a.DB;
      else if (2 == w[l] && 5 == w[c])
        D = a.DF;
      else if (3 == w[l] && 4 == w[c])
        D = a.UB;
      else {
        if (3 != w[l] || 5 != w[c])
          continue;
        D = a.UF
      }
      t = this.findEdgeNeighbor(0, D),
      t && (s.push(t), i && this.getChildOfOctant(t, 1, D, s), e && (t = this.getNeighborOfSecondLevel(t, 1, D)) && s.push(t))
    }
  }
for (l = 0; l < w.length; l++)
  (t = this.findFaceNeighbor(0, w[l])) && (s.push(t), i && this.getChildOfOctant(t, 0, w[l], s), e && (t = this.getNeighborOfSecondLevel(t, 0, w[l])) && s.push(t));
return s.sort(function(t, e) {
  return t.octantId < e.octantId
    ? -1
    : 1
}),
s
}, CLOUD.OctantNeighborUtil.prototype.getChildOfOctant = function(t, e, i, n) {
if (!(0 == t.childOctants.length || t.depth < 4)) {
  var o = this.FaceType,
    r = [];
  switch (e) {
    case 0:
      r.push(
        i % 2 == 0
        ? i + 1
        : i - 1);
      break;
    case 1:
      var a = this.EdgeType;
      switch (i) {
        case a.LD:
          r.push(o.R),
          r.push(o.U);
          break;
        case a.LU:
          r.push(o.R),
          r.push(o.D);
          break;
        case a.LB:
          r.push(o.R),
          r.push(o.F);
          break;
        case a.LF:
          r.push(o.R),
          r.push(o.B);
          break;
        case a.RD:
          r.push(o.L),
          r.push(o.U);
          break;
        case a.RU:
          r.push(o.L),
          r.push(o.D);
          break;
        case a.RB:
          r.push(o.L),
          r.push(o.F);
          break;
        case a.RF:
          r.push(o.L),
          r.push(o.B);
          break;
        case a.DB:
          r.push(o.U),
          r.push(o.F);
          break;
        case a.DF:
          r.push(o.U),
          r.push(o.B);
          break;
        case a.UB:
          r.push(o.D),
          r.push(o.F);
          break;
        case a.UF:
          r.push(o.D),
          r.push(o.B)
      }
      break;
    case 2:
      var s = this.OctType;
      switch (i) {
        case s.RUF:
          r.push(o.L),
          r.push(o.D),
          r.push(o.B);
          break;
        case s.LUF:
          r.push(o.R),
          r.push(o.D),
          r.push(o.B);
          break;
        case s.RDF:
          r.push(o.L),
          r.push(o.U),
          r.push(o.B);
          break;
        case s.LDF:
          r.push(o.R),
          r.push(o.U),
          r.push(o.B);
          break;
        case s.RUB:
          r.push(o.L),
          r.push(o.D),
          r.push(o.F);
          break;
        case s.LUB:
          r.push(o.R),
          r.push(o.D),
          r.push(o.F);
          break;
        case s.RDB:
          r.push(o.L),
          r.push(o.U),
          r.push(o.F);
          break;
        case s.LDB:
          r.push(o.R),
          r.push(o.U),
          r.push(o.F)
      }
  }
  for (var l = 0; l < r.length; l++)
    this.getFaceChildOfOctant(t, r[l], n)
}
}, CLOUD.OctantNeighborUtil.prototype.getFaceChildOfOctant = function(t, e, i) {
for (var n, o, r = 0, a = t.childOctants.length; r < a; r++)
  if (n = t.childOctants[r], this.adjFace(e, n.octType))
    i.push(n),
    this.getFaceChildOfOctant(n, e, i);
  else {
    o = this.refelectFace(e, n.octType);
    for (var s = 0; s < a && t.childOctants[s].octType != o; s++)
    ;
    s == a && (i.push(n), this.getFaceChildOfOctant(n, e, i))
  }
}, CLOUD.OctantNeighborUtil.prototype.getNeighborOfSecondLevel = function(t, e, i) {
var n = [],
  o = [],
  r = [];
r[0] = t,
this.getAncestorNodes(this.root, r, 0, n, o);
var a = new CLOUD.OctantNeighborUtil(this.camera, this.root);
a.containedOctants = o;
var s = null;
switch (e) {
  case 0:
    s = a.findFaceNeighbor(0, i);
    break;
  case 1:
    s = a.findEdgeNeighbor(0, i);
    break;
  case 2:
    s = a.findVertexNeighbor(0, i)
}
return s
}, CLOUD.OctantNeighborUtil.prototype.getAncestorAndNeighbors = function() {
this.searchNeighborOfNeighbor = !0,
this.containChildOfNeighbor = !0;
var t = this.containedOctants;
this.findContainNode(this.root);
var e = this.findNeighborNode(this.camera, t),
  i = [],
  n = [];
this.getAncestorNodes(this.root, e, 0, i, n);
var o,
  r,
  a = {};
for (o = 0, r = t.length; o < r; o++)
  a[t[o].octantId] = 1;
for (o = 0, r = e.length; o < r; o++)
  a[e[o].octantId] = 1;
for (o = 0, r = n.length; o < r; o++)
  a[n[o].octantId] = 1;
return a
}, CLOUD.OctantNeighborUtil.prototype.getAncestorNodes = function(t, e, i, n, o) {
var r,
  a,
  s;
for (r = 0, a = t.childOctants.length; r < a && i < e.length; r++) {
  if (s = t.childOctants[r], n.push(s), s.octantId == e[i].octantId) {
    for (var l = n.length - 1; l >= 0; l--)
      o.push(n[l]);
    i++
  } else
    (r == a - 1 || t.childOctants[r + 1].octantId > e[i].octantId) && (i = this.getAncestorNodes(s, e, i, n, o));
    n.pop()
  }
  return i
},
CLOUD.OctantNeighborUtil.prototype.outputOctants = function(t, e) {
  console.group(),
  console.log("Node that contains camera: %d", e.octantId);
  var i = "",
    n = 0;
  for (var o in t)
    i += o,
    i += "  ",
    n % 9 == 0 && (i += "\n"),
    n++;
  console.log("nodes: %s", i),
  console.groupEnd()
},
CLOUD.OctantNeighborUtil.prototype.outputOctree = function(t, e) {
  console.group();
  var i,
    n = "";
  for (i = 0; i < t.depth; i++)
    n += "  ";
  console.log("%sNode id: %i, depth: %i, octType: %i, parent: %i", n, t.octantId, t.depth, t.octType, e),
  console.log("%s  size: %f, center: %f, %f, %f", n, t.size, t.center.x, t.center.y, t.center.z),
  console.log("%s  child number: %i", n, t.childOctants.length);
  var o = "";
  for (i = 0; i < t.childOctants.length; i++)
    o += t.childOctants[i].octantId,
    o += "  ";
  for (console.log("%s  children: %i", n, o), i = 0; i < t.childOctants.length; i++)
    this.outputOctree(t.childOctants[i], t.octantId);
  console.groupEnd()
},
CLOUD.RenderGroup = function() {
  function t(t, e) {
    return t.material.id !== e.material.id
      ? t.material.id - e.material.id
      : t.id - e.id
  }
  function e(t, e) {
    return t.z !== e.z
      ? e.z - t.z
      : t.id - e.id
  }
  function i(t, e, i, n, o, r) {
    h = Date.now();
    for (var a = e.length, l = s; l < a; l++) {
      var c = e[l],
        p = c.object,
        f = c.material,
        m = c.group,
        g = c.geometry;
      if (p.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse, p.matrixWorld), p.normalMatrix.getNormalMatrix(p.modelViewMatrix), g = t.updateObject(p), t.renderBufferDirect(i, o, g, f, p, m), u = Date.now(), (d = u - h) > CLOUD.GlobalData.LimitFrameTime)
        return s = l + 1,
        !1
    }
    return s = 0,
    !0
  }
  var n = [],
    o = [],
    r = -1,
    a = -1,
    s = 0,
    l = !1,
    c = !1,
    h = 0,
    u = 0,
    d = 0;
  this.getOpaqueObjects = function() {
    return n
  },
  this.getTransparentObjects = function() {
    return o
  },
  this.destroy = function() {
    n = [],
    o = []
  },
  this.restart = function() {
    s = 0,
    l = !1,
    c = !1
  },
  this.prepare = function() {
    this.restart(),
    r = -1,
    a = -1
  },
  this.renderableCount = function() {
    return r + a
  },
  this.pushRenderItem = function(t, e, i, s, l) {
    var c,
      h;
    i.transparent
      ? (c = o, h = ++a)
      : (c = n, h = ++r);
    var u = c[h];
    void 0 !== u
      ? (u.id = t.id, u.object = t, u.geometry = e, u.material = i, u.z = s, u.group = l)
      : (u = {
        id: t.id,
        object: t,
        geometry: e,
        material: i,
        z: s,
        group: l
      }, c[h] = u)
  },
  this.sortRenderList = function(i) {
    n.length = r + 1,
    o.length = a + 1,
    i && (n.sort(t), o.sort(e))
  },
  this.renderOpaqueObjects = function(t, e, o, r, a) {
    return l || (l = i(t, n, e, o, r, a)),
    l
  },
  this.renderTransparentObjects = function(t, e, n, r, a) {
    return c || (c = i(t, o, e, n, r, a)),
    c
  }
},
CLOUD.OrderedRenderer = function(t) {
  function e() {
    ++l > 1e5 && (l = 0);
    for (var t = 0, e = m.length; t < e; ++t) {
      var i = m[t];
      void 0 !== i && i.prepare()
    }
  }
  function i(t, e, i, n) {
    var o = m[t.renderOrder];
    void 0 === o && (o = new CLOUD.RenderGroup, m[t.renderOrder] = o),
    o.pushRenderItem(t, e, i, n, null)
  }
  function n() {
    for (var t = 0, e = m.length; t < e; ++t) {
      var i = m[t];
      void 0 !== i && i.sortRenderList(c)
    }
  }
  function o(t, e) {
    if (t.visible === !1 || t.alive === !1)
      return !0;
    if (t._cullTicket != l) {
      ++u;
      if (Date.now() - p > 30)
        return !1;
      if (t._cullTicket = l, (t instanceof THREE.Mesh || t instanceof THREE.Line || t instanceof THREE.Points) && (t.frustumCulled === !1 || g.intersectsObject(t) === !0)) {
        var n = t.material,
          r = t.geometry;
        n.transparent
          ? (y.setFromMatrixPosition(t.matrixWorld), y.applyMatrix4(v), i(t, r, n, y.z))
          : i(t, r, n, 0)
      }
    }
    var a = t.children;
    if (a)
      for (var s = 0, c = a.length; s < c; s++)
        if (!o(a[s], e))
          return !1;
  return !0
  }
  function r(t, e) {
    e.length = 0;
    for (var i = t.children, n = 0, o = i.length; n < o; n++) {
      var r = i[n];
      r.isLight && e.push(r)
    }
  }
  function a(t, i, a) {
    if (!E)
      return void(c = !0);
    c && (e(), r(t, a)),
    p = Date.now(),
    c = o(t, i),
    n()
  }
  function s() {
    E && !x || ++f,
    f > 1e4 && (f = 0)
  }
  var l = 0,
    c = !1,
    h = !1,
    u = 0,
    d = 0,
    p = 0,
    f = 0,
    m = [],
    g = null,
    v = null,
    y = new THREE.Vector3,
    E = !0,
    x = !0,
    b = t;
  this.updateObjectList = function(t) {
    E = t
  },
  this.destroy = function() {
    for (var t = 0, e = m.length; t < e; ++t) {
      var i = m[t];
      void 0 !== i && i.destroy()
    }
  },
  this.restart = function() {
    for (var t = 0, e = m.length; t < e; ++t) {
      var i = m[t];
      void 0 !== i && i.restart()
    }
    u = 0,
    d = 0,
    x = !0,
    c = !0
  },
  this.setFilter = function(t) {},
  this.update = function(t, e) {
    v = e,
    g = t
  },
  this.render = function(t, e, i, n, o, r, l) {
    if (s(), x) {
      if (CLOUD.Logger.time("build object list"), a(e, i, n), CLOUD.Logger.timeEnd("build object list"), !c)
        return !1;
      r = !0,
      x = !1,
      t.setupLights(n, i),
      t.setRenderTarget(o)
    }
    CLOUD.Logger.time("increment render object"),
    (t.autoClear || r) && t.clear(t.autoClearColor, t.autoClearDepth, t.autoClearStencil, E);
    var u = e.fog;
    t.setRenderTicket(f),
    l.setBlending(THREE.NoBlending);
    for (var d = m.length - 1; d >= 0; --d) {
      var p = m[d];
      if (void 0 !== p && !(h = p.renderOpaqueObjects(t, i, n, u, E)))
        break
    }
    if (h)
      for (var d = m.length - 1; d >= 0; --d) {
        var p = m[d];
        if (void 0 !== p && !(h = p.renderTransparentObjects(t, i, n, u)))
          break
      }
    return l.buffers.depth.setTest(!0),
    l.buffers.depth.setMask(!0),
    l.buffers.color.setMask(!0),
    CLOUD.Logger.timeEnd("increment render object"),
    h
  },
  this.computeSelectionBBox = function() {
    if (b._isEmptySelections())
      return null;
    b._resetBoundingBoxFromSelections();
    for (var t = m.length - 1; t >= 0; --t) {
      var e = m[t];
      void 0 !== e && (b._calcBoundingBoxFromSelections(e.getOpaqueObjects()), b._calcBoundingBoxFromSelections(e.getTransparentObjects()))
    }
    return b._getBoundingBoxFromSelections()
  },
  this.computeRenderObjectsBox = function() {
    for (var t = new THREE.Box3, e = m.length - 1; e >= 0; --e) {
      var i = m[e];
      if (void 0 !== i) {
        var n = b._getBoundingBoxFromRenderObjects(i.getOpaqueObjects());
        n.isEmpty() || (t.expandByPoint(n.min), t.expandByPoint(n.max));
        var o = b._getBoundingBoxFromRenderObjects(i.getTransparentObjects());
        o.isEmpty() || (t.expandByPoint(o.min), t.expandByPoint(o.max))
      }
    }
    return t
  }
},
CLOUD.BBoxNode = function(t, e) {
  var i = new THREE.BufferGeometry;
  i.addAttribute("position", new THREE.BufferAttribute(new Float32Array(72), 3)),
  THREE.LineSegments.call(this, i, new THREE.LineBasicMaterial({color: e})),
  void 0 !== t && this.updateBBox(t)
},
CLOUD.BBoxNode.prototype = Object.create(THREE.LineSegments.prototype),
CLOUD.BBoxNode.prototype.constructor = CLOUD.BBoxNode,
CLOUD.BBoxNode.prototype.unload = function() {},
CLOUD.BBoxNode.prototype.updateBBox = function(t) {
  var e = t.min,
    i = t.max,
    n = this.geometry.attributes.position.array;
  n[0] = i.x,
  n[1] = i.y,
  n[2] = i.z,
  n[3] = e.x,
  n[4] = i.y,
  n[5] = i.z,
  n[6] = e.x,
  n[7] = i.y,
  n[8] = i.z,
  n[9] = e.x,
  n[10] = e.y,
  n[11] = i.z,
  n[12] = e.x,
  n[13] = e.y,
  n[14] = i.z,
  n[15] = i.x,
  n[16] = e.y,
  n[17] = i.z,
  n[18] = i.x,
  n[19] = e.y,
  n[20] = i.z,
  n[21] = i.x,
  n[22] = i.y,
  n[23] = i.z,
  n[24] = i.x,
  n[25] = i.y,
  n[26] = e.z,
  n[27] = e.x,
  n[28] = i.y,
  n[29] = e.z,
  n[30] = e.x,
  n[31] = i.y,
  n[32] = e.z,
  n[33] = e.x,
  n[34] = e.y,
  n[35] = e.z,
  n[36] = e.x,
  n[37] = e.y,
  n[38] = e.z,
  n[39] = i.x,
  n[40] = e.y,
  n[41] = e.z,
  n[42] = i.x,
  n[43] = e.y,
  n[44] = e.z,
  n[45] = i.x,
  n[46] = i.y,
  n[47] = e.z,
  n[48] = i.x,
  n[49] = i.y,
  n[50] = i.z,
  n[51] = i.x,
  n[52] = i.y,
  n[53] = e.z,
  n[54] = e.x,
  n[55] = i.y,
  n[56] = i.z,
  n[57] = e.x,
  n[58] = i.y,
  n[59] = e.z,
  n[60] = e.x,
  n[61] = e.y,
  n[62] = i.z,
  n[63] = e.x,
  n[64] = e.y,
  n[65] = e.z,
  n[66] = i.x,
  n[67] = e.y,
  n[68] = i.z,
  n[69] = i.x,
  n[70] = e.y,
  n[71] = e.z,
  this.geometry.attributes.position.needsUpdate = !0,
  this.geometry.computeBoundingBox(),
  this.geometry.computeBoundingSphere(),
  this.matrixAutoUpdate = !1
},
THREE.CombinedCamera = function(t, e, i, n, o) {
  THREE.Camera.call(this),
  this.aspect = t / e,
  this.fov = i,
  this.near = n,
  this.far = o,
  this.left = -t / 2,
  this.right = t / 2,
  this.top = e / 2,
  this.bottom = -e / 2,
  this.cameraOrtho = new THREE.OrthographicCamera(this.left, this.right, this.top, this.bottom, this.near, this.far),
  this.cameraPerspective = new THREE.PerspectiveCamera(this.fov, this.aspect, this.near, this.far),
  this.zoom = 1,
  this.toPerspective()
},
THREE.CombinedCamera.prototype = Object.create(THREE.Camera.prototype),
THREE.CombinedCamera.prototype.constructor = THREE.CombinedCamera,
THREE.CombinedCamera.prototype.toPerspective = function() {
  this.near = this.cameraPerspective.near,
  this.far = this.cameraPerspective.far,
  this.cameraPerspective.fov = this.fov / this.zoom,
  this.cameraPerspective.updateProjectionMatrix(),
  this.projectionMatrix = this.cameraPerspective.projectionMatrix,
  this.isPerspective = !0
},
THREE.CombinedCamera.prototype.toOrthographic = function() {
  var t = this.fov,
    e = this.cameraPerspective.aspect,
    i = this.cameraPerspective.near,
    n = this.cameraPerspective.far,
    o = (i + n) / 2,
    r = Math.tan(t * Math.PI / 180 / 2) * o,
    a = 2 * r,
    s = a * e,
    l = s / 2;
  r /= this.zoom,
  l /= this.zoom,
  this.cameraOrtho.left = -l,
  this.cameraOrtho.right = l,
  this.cameraOrtho.top = r,
  this.cameraOrtho.bottom = -r,
  this.cameraOrtho.updateProjectionMatrix(),
  this.near = this.cameraOrtho.near,
  this.far = this.cameraOrtho.far,
  this.projectionMatrix = this.cameraOrtho.projectionMatrix,
  this.isPerspective = !1
},
THREE.CombinedCamera.prototype.setSize = function(t, e) {
  this.cameraPerspective.aspect = t / e,
  this.left = -t / 2,
  this.right = t / 2,
  this.top = e / 2,
  this.bottom = -e / 2,
  this.aspect = t / e
},
THREE.CombinedCamera.prototype.setFov = function(t) {
  this.fov = t,
  this.isPerspective
    ? this.toPerspective()
    : this.toOrthographic()
},
THREE.CombinedCamera.prototype.setNearFar = function(t, e) {
  this.isPerspective
    ? (this.cameraPerspective.near = t, this.cameraPerspective.far = e, this.toPerspective())
    : (this.cameraOrtho.near = t, this.cameraOrtho.far = e, this.toOrthographic())
},
THREE.CombinedCamera.prototype.updateProjectionMatrix = function() {
  this.isPerspective
    ? this.toPerspective()
    : this.toOrthographic()
},
THREE.CombinedCamera.prototype.setLens = function(t, e) {
  void 0 === e && (e = 24);
  var i = 2 * THREE.Math.radToDeg(Math.atan(e / (2 * t)));
  return this.setFov(i),
  i
},
THREE.CombinedCamera.prototype.setZoom = function(t) {
  this.zoom = t,
  this.isPerspective
    ? this.toPerspective()
    : this.toOrthographic()
},
CLOUD.Animation = function() {
  var t = this,
    e = null,
    i = {},
    n = {},
    o = 1e3,
    r = null,
    a = null,
    s = null,
    l = !1,
    c = null,
    h = null,
    u = null;
  this.from = function(t) {
    e = t;
    for (var n in e)
      i[n] = e[n];
    return this
  },
  this.to = function(t, e) {
    return void 0 !== e && (o = e),
    n = t,
    this
  },
  this.onStart = function(t) {
    return c = t,
    this
  },
  this.onUpdate = function(t) {
    return h = t,
    this
  },
  this.onComplete = function(t) {
    return u = t,
    this
  },
  this.start = function(t) {
    l = !1,
    a && clearInterval(a),
    r = Date.now(),
    s = this.interpolate;
    var d = function() {
      var t,
        d = i,
        p = n,
        f = Date.now();
      l === !1 && (null !== c && c.call(e), l = !0),
      t = (f - r) / o,
      t = t > 1
        ? 1
        : t,
      e = s(d, p, t),
      1 === t
        ? (clearInterval(a), null !== u && u.call(e))
        : null !== h && h.call(e, t)
    };
    a = setInterval(d, t)
  },
  this.isAngleGreaterThanPi = function(t, e, i) {
    var n = new THREE.Vector3;
    return n.crossVectors(t, e),
    !(n.dot(i) >= 0)
  },
  this.conicInterpolate = function(t, e, i, n, o) {
    var r = -Math.PI * n;
    o && (r *= -1);
    var a = new THREE.Vector3;
    a.addVectors(e, t).normalize();
    var s = new THREE.Quaternion;
    s.setFromAxisAngle(a, r),
    i.copy(t),
    i.applyQuaternion(s)
  },
  this.slerpInterpolate = function(t, e, i, n, o, r, a, s) {
    var l = (new THREE.Vector3(1, 0, 0), new THREE.Vector3(0, 0, 1), new THREE.Vector3),
      c = 0,
      h = t.dot(e),
      u = new THREE.Quaternion(t.x, t.y, t.z, 1).normalize(),
      d = new THREE.Quaternion(e.x, e.y, e.z, 1).normalize(),
      p = new THREE.Quaternion(0, 0, 0, 1),
      f = new THREE.Quaternion(0, 0, 0, 1);
    void 0 === a && (a = !1),
    void 0 === s && (s = !1),
    r < h
      ? n.copy(e)
      : r < Math.abs(h)
        ? (
          l.crossVectors(t, i).normalize(), p.set(l.x, l.y, l.z, 1).normalize(), o < .5
          ? (c = 2 * o, THREE.Quaternion.slerp(u, p, f, c), n.set(f.x, f.y, f.z))
          : (c = 2 * (o - .5), THREE.Quaternion.slerp(p, d, f, c), n.set(f.x, f.y, f.z)))
        : a
          ? this.conicInterpolate(t, e, n, o, s)
          : (THREE.Quaternion.slerp(u, d, f, o), n.set(f.x, f.y, f.z)),
    n.normalize()
  },
  this.linearInterpolate = function(t, e, i, n, o) {
    var r = new THREE.Vector3(1, 0, 0),
      a = new THREE.Vector3(0, 0, 1),
      s = new THREE.Vector3,
      l = 0,
      c = t.dot(e);
    o < c
      ? i.copy(e)
      : o < -c
        ? (
          o > Math.abs(t.dot(a))
          ? s.crossVectors(t, a).normalize()
          : s.crossVectors(t, r).normalize(),
        n < .5
          ? (l = 2 * n, i.lerpVectors(t, s, l))
          : (l = 2 * (n - .5), i.lerpVectors(s, e, l)))
        : i.lerpVectors(t, e, n),
    i.normalize()
  },
  this.interpolate = function(e, i, n) {
    var o = new THREE.Vector3,
      r = new THREE.Vector3,
      a = new THREE.Vector3,
      s = new THREE.Vector3,
      l = e.animDir,
      c = e.animUp,
      h = i.animDir,
      u = i.animUp;
    o.crossVectors(l, c),
    r.crossVectors(h, u);
    var d = o.dot(r),
      p = d < .9995 - 1,
      f = t.isAngleGreaterThanPi(l, h, c);
    return t.slerpInterpolate(l, h, c, a, n, .9995, p, f),
    t.linearInterpolate(c, u, s, n, .9995), {
      animDir: a,
      animUp: s
    }
  }
},
CLOUD.CameraAnimator = function() {
  var t = 500,
    e = 13,
    i = !1,
    n = new CLOUD.Animation;
  this.setDuration = function(e) {
    t = e
  },
  this.setFrameTime = function(t) {
    e = t
  },
  this.setStandardView = function(o, r, a, s, l) {
    i = !1;
    var c = function(t, e) {
        var i = t.camera.zoomToBBox(e, s);
        t.cameraControl.updateCamera(i),
        t.render(),
        l && l()
      },
      h = r.camera,
      u = CLOUD.GlobalData.SceneSize / 2,
      d = h.getWorldDirection().clone();
    d.normalize();
    var p = new THREE.Vector3;
    p.copy(h.realUp || h.up),
    p.normalize();
    var f = h.setStandardView(o, a),
      m = h.getWorldDirection().clone();
    m.normalize();
    var g = new THREE.Vector3;
    g.copy(h.realUp || h.up),
    g.normalize();
    var v = d.dot(m),
      y = p.dot(g);
    .9995 < v && .9995 < y
      ? (c(r, a), h.up.copy(THREE.Object3D.DefaultUp))
      : (i = !0, n.from({animDir: d, animUp: p}).to({
        animDir: m,
        animUp: g
      }, t).onUpdate(function() {
        r.viewHouse && (r.viewHouse.isAnimationFinish = !1);
        var t = this.animDir,
          e = this.animUp;
        r.camera.LookAt(f, t, e, u),
        c(r, a)
      }).onComplete(function() {
        r.viewHouse && (r.viewHouse.isAnimationFinish = !0),
        r.camera.LookAt(f, m, g, u),
        c(r, a),
        i = !1,
        r.camera.up.copy(THREE.Object3D.DefaultUp)
      }).start(e))
  },
  this.isPlaying = function() {
    return i
  }
},
CLOUD.PhongLightingMaterial = function(t) {
  THREE.ShaderMaterial.call(this),
  this.type = "PhoneLightingMaterial",
  this.color = new THREE.Color(16777215),
  this.specular = new THREE.Color(1118481),
  this.shininess = 30,
  this.emissive = new THREE.Color(0),
  this.defines = {},
  this.uniforms = THREE.UniformsUtils.merge([
    THREE.UniformsLib.lights, {
      diffuse: {
        value: new THREE.Color(16711680)
      },
      opacity: {
        value: 1
      },
      specular: {
        value: new THREE.Color(1118481)
      },
      shininess: {
        value: 30
      },
      emissive: {
        value: new THREE.Color(0)
      }
    }
  ]),
  this.vertexShader = [
    "varying vec3 vViewPosition;",
    "varying vec3 vNormal;",
    "void main() {",
    "   #include <begin_vertex>",
    "   #include <project_vertex>",
    "   #include <beginnormal_vertex>",
    "   #include <defaultnormal_vertex>",
    "   vNormal = normalize( transformedNormal );",
    "   vViewPosition = - mvPosition.xyz;",
    "}"
  ].join("\n"),
  this.fragmentShader = [
    "uniform vec3 diffuse;",
    "uniform float opacity;",
    "uniform vec3 specular;",
    "uniform float shininess;",
    "uniform vec3 emissive;",
    "#include <common>",
    "#include <packing>",
    "#include <bsdfs>",
    "#include <lights_pars>",
    "#include <lights_phong_pars_fragment>",
    "#include <specularmap_pars_fragment>",
    "void main() {",
    "   vec4 diffuseColor = vec4( diffuse, opacity );",
    "   ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",
    "   vec3 totalEmissiveRadiance = emissive;",
    "   float specularStrength = 1.0;",
    "   #include <normal_flip>",
    "   #include <normal_fragment>",
    "   #include <lights_phong_fragment>",
    "   #include <lights_template>",
    "   vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;",
    "   gl_FragColor = vec4( outgoingLight, diffuseColor.a );",
    "   #if defined( TONE_MAPPING )",
    "       gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );",
    "   #endif",
    "   gl_FragColor = linearToOutputTexel( gl_FragColor );",
    "}"
  ].join("\n"),
  this.lights = !0,
  this.defaultAttributeValues = {
    color: [
      1, 1, 1
    ],
    uv: [
      0, 0
    ],
    uv2: [0, 0]
  },
  void 0 !== t && (void 0 !== t.attributes && console.error("PhoneLightingMaterial: attributes should now be defined in THREE.BufferGeometry instead."), this.setValues(t)),
  this.refreshUniforms()
},
CLOUD.PhongLightingMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype),
CLOUD.PhongLightingMaterial.prototype.constructor = CLOUD.PhongLightingMaterial,
CLOUD.PhongLightingMaterial.prototype.isShaderMaterial = !0,
CLOUD.PhongLightingMaterial.prototype.copy = function(t) {
  return THREE.ShaderMaterial.prototype.copy.call(this, t),
  this.color.copy(t.color),
  this.specular.copy(t.specular),
  this.shininess = t.shininess,
  this.emissive.copy(t.emissive),
  this
},
CLOUD.PhongLightingMaterial.prototype.refreshUniforms = function() {
  this.uniforms.diffuse.value.set(this.color),
  this.uniforms.opacity.value = this.opacity,
  this.uniforms.specular.value.set(this.specular),
  this.uniforms.shininess.value = this.shininess,
  this.uniforms.emissive.value.set(this.emissive)
},
CLOUD.MeshEx = function() {
  THREE.Mesh.call(this),
  this.type = "MeshEx",
  this.matrixAutoUpdate = !1,
  this.alive = !1,
  this.geometry = CLOUD.GeomUtil.EmptyGeometry,
  this.material = CLOUD.MaterialUtil.DefaultMaterial
},
CLOUD.MeshEx.prototype = Object.create(THREE.Mesh.prototype),
CLOUD.MeshEx.prototype.constructor = CLOUD.MeshEx,
CLOUD.MeshEx.prototype.init = function(t) {
  t && t.parent && t.parent.add(this)
},
CLOUD.MeshEx.prototype.destroy = function() {
  this.parent && this.parent.remove(this),
  this.userData && (this.userData = null),
  this.geometry = null,
  this.material = null
},
CLOUD.MeshEx.prototype.spawn = function(t) {
  void 0 !== t.userId
    ? this.name = t.userId
    : void 0 !== t.nodeId && (this.name = t.nodeId),
  t.geometry && (this.geometry = t.geometry),
  t.material && (this.material = t.material),
  t.matrix
    ? (this.matrix.copy(t.matrix), this.updateMatrixWorld(!0))
    : (this.matrix.identity(), this.updateMatrixWorld(!0)),
  t.databagId
    ? this.databagId = t.databagId
    : this.databagId = "",
  t.userData
    ? this.userData = t.userData
    : this.userData && (this.userData = null),
  t.renderOrder && (this.renderOrder = t.renderOrder),
  this.alive = !0,
  this.frustumCulled = !1,
  this.material.visible = !0
},
CLOUD.MeshEx.prototype.clear = function() {
  this.geometry = CLOUD.GeomUtil.EmptyGeometry,
  this.material = CLOUD.MaterialUtil.DefaultMaterial,
  this.alive = !1,
  this.visible = !0,
  this.frustumCulled = !0,
  this.material.visible = !1
},
CLOUD.MeshEx.prototype.intersectBoxWithDistance = function() {
  var t = new THREE.Box3;
  return function(e) {
    var i = this.geometry,
      n = this.material,
      o = this.matrixWorld;
    return void 0 === n
      ? -1
      : (null === i.boundingBox && i.computeBoundingBox(), t.copy(i.boundingBox), t.applyMatrix4(o), e.ray.intersectBoxWithDistance(t))
  }
}(),
CLOUD.PointsEx = function(t, e) {
  THREE.Points.call(this, t, e),
  this.radius = 1
},
CLOUD.PointsEx.prototype = Object.create(THREE.Points.prototype),
CLOUD.PointsEx.prototype.constructor = CLOUD.PointsEx,
CLOUD.PointsEx.prototype.raycast = function() {
  var t = new THREE.Matrix4,
    e = new THREE.Ray,
    i = new THREE.Sphere;
  return function(n, o) {
    function r(t, i) {
      var r = e.distanceSqToPoint(t);
      if (r < d) {
        var s = e.closestPointToPoint(t);
        s.applyMatrix4(l);
        var c = n.ray.origin.distanceTo(s);
        if (c < n.near || c > n.far)
          return;
        o.push({
          distance: c,
          distanceToRay: Math.sqrt(r),
          point: s.clone(),
          index: i,
          face: null,
          object: a
        })
      }
    }
    var a = this,
      s = this.geometry,
      l = this.matrixWorld,
      c = this.radius;
    if (null === s.boundingSphere && s.computeBoundingSphere(), i.copy(s.boundingSphere), i.applyMatrix4(l), i.radius += c, n.ray.intersectsSphere(i) !== !1) {
      t.getInverse(l),
      e.copy(n.ray).applyMatrix4(t);
      var h = this.getWorldScale(),
        u = c / ((h.x + h.y + h.z) / 3),
        d = u * u,
        p = new THREE.Vector3;
      if (s.isBufferGeometry) {
        var f = s.index,
          m = s.attributes,
          g = m.position.array;
        if (null !== f)
          for (var v = f.array, y = 0, E = v.length; y < E; y++) {
            var x = v[y];
            p.fromArray(g, 3 * x),
            r(p, x)
          }
        else
          for (var y = 0, b = g.length / 3; y < b; y++)
            p.fromArray(g, 3 * y),
            r(p, y)
      } else
        for (var w = s.vertices, y = 0, b = w.length; y < b; y++)
          r(w[y], y)
    }
  }
}(),
CLOUD.MaterialEx = function() {
  this.materialDefaultParams = {
    color: 14540253,
    opacity: .5,
    transparent: !0,
    side: THREE.DoubleSide
  },
  this.material = CLOUD.MaterialUtil.createPhongMaterial(this.materialDefaultParams)
},
CLOUD.MaterialEx.prototype.destroy = function() {
  this.material = null
},
CLOUD.MaterialEx.prototype.resetColor = function() {
  this.material.color.setHex(this.materialDefaultParams.color)
},
CLOUD.MaterialEx.prototype.resetOpacity = function() {
  this.material.opacity = this.materialDefaultParams.opacity
},
CLOUD.MaterialEx.prototype.reset = function() {
  this.material.color.setHex(this.materialDefaultParams.color),
  this.material.opacity = this.materialDefaultParams.opacity,
  this.material.transparent = this.materialDefaultParams.transparent,
  this.material.side = this.materialDefaultParams.side,
  this.material.needsUpdate = !0
},
CLOUD.ObjectPool = function(t, e) {
  this.cls = t,
  this.size = e || 1e3,
  this._pool = [],
  this.counter = 0
},
CLOUD.ObjectPool.prototype.init = function(t) {
  for (var e = 0, i = this.size; e < i; ++e) {
    var n = new this.cls;
    n.init(t),
    this._pool[e] = n
  }
},
CLOUD.ObjectPool.prototype.resize = function(t, e) {
  this.size = t || 1e3,
  this.collect(),
  this.init(e)
},
CLOUD.ObjectPool.prototype.get = function(t) {
  return this.counter >= this.size
    ? -1
    : (this._pool[this.counter].spawn(t), ++this.counter - 1)
},
CLOUD.ObjectPool.prototype.clear = function() {
  for (var t = 0, e = this.size; t < e; ++t)
    this._pool[t].clear();
  this.counter = 0
},
CLOUD.ObjectPool.prototype.destroy = function() {
  this.collect()
},
CLOUD.ObjectPool.prototype.collect = function() {
  this._pool = [],
  this.counter = 0
},
CLOUD.ObjectPool.prototype.getObjects = function() {
  return this._pool
},
CLOUD.ExpandableObjectPool = function() {
  this.size = 0,
  this.counter = 0,
  this.expansion = 1,
  this._pool = null
},
CLOUD.ExpandableObjectPool.prototype.init = function(t, e) {
  this.classType = t,
  this._pool = [],
  this._expand(e)
},
CLOUD.ExpandableObjectPool.prototype._expand = function(t) {
  this.size += t;
  for (var e = 0; e < t; e++)
    this._pool.push(new this.classType)
},
CLOUD.ExpandableObjectPool.prototype.acquire = function() {
  return this.counter >= this.size && (this.expansion = Math.round(1.2 * this.expansion) + 1, this._expand(this.expansion), console.log("_expand")),
  this._pool[this.counter++]
},
CLOUD.ExpandableObjectPool.prototype.clear = function() {
  this.counter = 0
},
CLOUD.ExpandableObjectPool.prototype.destroy = function() {
  for (var t = 0, e = this.size; t < e; ++t)
    this._pool[t].destroy();
  this.counter = 0,
  this.size = 0,
  this.expansion = 1,
  this._pool = null
},
CLOUD.ExpandableObjectPool.prototype.getObjects = function() {
  return this._pool
};
var lights_fillFace_template = [
    "GeometricContext geometry;",
    "geometry.position = - vViewPosition;",
    "#if NUM_CLIPPING_PLANES == 1",
    "\tif (gl_FrontFacing) geometry.normal = normal;",
    "\telse if (fillFaceClipDistance < 0.0) geometry.normal = -clippingPlanes[0].xyz;",
    "\telse geometry.normal = -normal;",
    "#else",
    "\tgeometry.normal = normal;",
    "#endif",
    "geometry.viewDir = normalize( vViewPosition );",
    "IncidentLight directLight;",
    "#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )",
    "\tPointLight pointLight;",
    "\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {",
    "\t\tpointLight = pointLights[ i ];",
    "\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );",
    "\t\t#ifdef USE_SHADOWMAP",
    "\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;",
    "\t\t#endif",
    "\t\tRE_Direct( directLight, geometry, material, reflectedLight );",
    "\t}",
    "#endif",
    "#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )",
    "\tSpotLight spotLight;",
    "\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {",
    "\t\tspotLight = spotLights[ i ];",
    "\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );",
    "\t\t#ifdef USE_SHADOWMAP",
    "\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;",
    "\t\t#endif",
    "\tRE_Direct( directLight, geometry, material, reflectedLight );",
    "\t}",
    "#endif",
    "#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )",
    "\tDirectionalLight directionalLight;",
    "\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {",
    "\t\tdirectionalLight = directionalLights[ i ];",
    "\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );",
    "\t\t#ifdef USE_SHADOWMAP",
    "\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;",
    "\t\t#endif",
    "\t\tRE_Direct( directLight, geometry, material, reflectedLight );",
    "\t}",
    "#endif",
    "#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )",
    "\tRectAreaLight rectAreaLight;",
    "\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {",
    "\t\trectAreaLight = rectAreaLights[ i ];",
    "\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );",
    "\t}",
    "#endif",
    "#if defined( RE_IndirectDiffuse )",
    "\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );",
    "\t#ifdef USE_LIGHTMAP",
    "\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;",
    "\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS",
    "\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage",
    "\t\t#endif",
    "\t\tirradiance += lightMapIrradiance;",
    "\t#endif",
    "\t#if ( NUM_HEMI_LIGHTS > 0 )",
    "\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {",
    "\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );",
    "\t\t}",
    "\t#endif",
    "\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )",
    "\t\tirradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, 8 );",
    "\t#endif",
    "\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );",
    "#endif",
    "#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )",
    "\tvec3 radiance = getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry, Material_BlinnShininessExponent( material ), 8 );",
    "\t#ifndef STANDARD",
    "\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );",
    "\t#else",
    "\t\tvec3 clearCoatRadiance = vec3( 0.0 );",
    "\t#endif",
    "\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );",
    "#endif"
  ].join("\n"),
  fillFaceFragment = [
    "#define PHONG",
    "uniform vec3 diffuse;",
    "uniform vec3 emissive;",
    "uniform vec3 specular;",
    "uniform float shininess;",
    "uniform float opacity;",
    "#include <common>",
    "#include <packing>",
    "#include <dithering_pars_fragment>",
    "#include <color_pars_fragment>",
    "#include <uv_pars_fragment>",
    "#include <uv2_pars_fragment>",
    "#include <map_pars_fragment>",
    "#include <alphamap_pars_fragment>",
    "#include <aomap_pars_fragment>",
    "#include <lightmap_pars_fragment>",
    "#include <emissivemap_pars_fragment>",
    "#include <envmap_pars_fragment>",
    "#include <gradientmap_pars_fragment>",
    "#include <fog_pars_fragment>",
    "#include <bsdfs>",
    "#include <lights_pars>",
    "#include <lights_phong_pars_fragment>",
    "#include <shadowmap_pars_fragment>",
    "#include <bumpmap_pars_fragment>",
    "#include <normalmap_pars_fragment>",
    "#include <specularmap_pars_fragment>",
    "#include <logdepthbuf_pars_fragment>",
    "#include <clipping_planes_pars_fragment>",
    "void main() {",
    "\t#include <clipping_planes_fragment>",
    "\tvec4 diffuseColor = vec4( diffuse, opacity );",
    "\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",
    "\tvec3 totalEmissiveRadiance = emissive;",
    "\t#include <logdepthbuf_fragment>",
    "\t#include <map_fragment>",
    "\t#include <color_fragment>",
    "\t#include <alphamap_fragment>",
    "\t#include <alphatest_fragment>",
    "\t#include <specularmap_fragment>",
    "\t#include <normal_flip>",
    "\t#include <normal_fragment>",
    "\t#include <emissivemap_fragment>",
    "   float fillFaceClipDistance = 0.0;",
    "   #if NUM_CLIPPING_PLANES == 1",
    "       vec4 plane = clippingPlanes[ 0 ];",
    "\t    fillFaceClipDistance = dot( vViewPosition, plane.xyz ) - plane.w;",
    "   #endif",
    "\t#include <lights_phong_fragment>",
    "\t#include <lights_fillFace_template>",
    "\t#include <aomap_fragment>",
    "\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;",
    "\t#include <envmap_fragment>",
    "\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );",
    "\t#include <tonemapping_fragment>",
    "\t#include <encodings_fragment>",
    "\t#include <fog_fragment>",
    "\t#include <premultiplied_alpha_fragment>",
    "\t#include <dithering_fragment>",
    "}"
  ].join("\n");
THREE.ShaderChunk.lights_fillFace_template = lights_fillFace_template,
THREE.ShaderChunk.fillFaceFragment = fillFaceFragment,
THREE.ShaderLib.fillFacePhong = {
  uniforms: THREE.UniformsUtils.merge([
    THREE.UniformsLib.common,
    THREE.UniformsLib.aomap,
    THREE.UniformsLib.lightmap,
    THREE.UniformsLib.emissivemap,
    THREE.UniformsLib.bumpmap,
    THREE.UniformsLib.normalmap,
    THREE.UniformsLib.displacementmap,
    THREE.UniformsLib.gradientmap,
    THREE.UniformsLib.fog,
    THREE.UniformsLib.lights, {
      emissive: {
        value: new THREE.Color(0)
      },
      specular: {
        value: new THREE.Color(1118481)
      },
      shininess: {
        value: 30
      }
    }
  ]),
  vertexShader: THREE.ShaderChunk.meshphong_vert,
  fragmentShader: THREE.ShaderChunk.fillFaceFragment
},
CLOUD.Marker3D = function(t, e) {
  function i(t) {
    void 0 === c[t] && (c[t] = h.load(t))
  }
  function n() {
    for (var t in c)
      c.hasOwnProperty(t) && delete c[t]
  }
  var o = t.getScene(),
    r = new CLOUD.Group;
  r.tag = "Marker3D",
  r.matrixAutoUpdate = !1;
  var a;
  a = e
    ? o.highPriorityGroup
    : o,
  a.add(r),
  o.addToPickGroups(r);
  var s = !1,
    l = {},
    c = {},
    h = new THREE.TextureLoader;
  h.setCrossOrigin("anonymous"),
  this.add = function(t) {
    var e,
      n,
      o = [];
    if (t && t instanceof Array)
      for (e = 0, n = t.length; e < n; ++e) {
        var r = t[e],
          a = {
            id: r.id
              ? r.id
              : THREE.Math.generateUUID(),
            position: {
              x: r.position.x,
              y: r.position.y,
              z: r.position.z
            },
            size: r.size
              ? r.size
              : 32,
            iconUrl: r.iconUrl
              ? r.iconUrl
              : null,
            tooltip: r.tooltip
          },
          s = "";
        a.iconUrl
          ? (s = a.iconUrl, o.push(a.iconUrl))
          : s = 8747392,
        s += "_",
        s += a.size,
        void 0 === l[s] && (l[s] = []),
        l[s].push(a)
      }
    for (e = 0, n = o.length; e < n; ++e)
      i(o[e])
  },
  this.remove = function(t) {
    if (t) {
      var e = t.iconUrl
        ? t.iconUrl + "_" + t.size
        : t.color + "_" + t.size;
      if (void 0 !== l[e])
        for (var i = l[e], n = 0, o = i.length; n < o; ++n)
          if (i[n].id === t.id)
            return void i.splice(n, 1)
    }
  },
  this.removeById = function(t) {
    for (var e in l)
      if (l.hasOwnProperty(e))
        for (var i = l[e], n = 0, o = i.length; n < o; ++n)
          if (i[n].id === t)
            return void i.splice(n, 1)
  },
  this.getItemById = function(t) {
    for (var e in l)
      if (l.hasOwnProperty(e))
        for (var i = l[e], n = 0, o = i.length; n < o; ++n) {
          var r = i[n];
          if (r.id === t)
            return {
              id: r.id,
              position: {
                x: r.position.x,
                y: r.position.y,
                z: r.position.z
              },
              size: r.size,
              iconUrl: r.iconUrl,
              tooltip: r.tooltip
            }
          }
      return null
  },
  this.getItems = function() {
    var t = [];
    for (var e in l)
      if (l.hasOwnProperty(e))
        for (var i = l[e], n = 0, o = i.length; n < o; ++n) {
          var r = i[n];
          t.push({
            id: r.id,
            position: {
              x: r.position.x,
              y: r.position.y,
              z: r.position.z
            },
            size: r.size,
            iconUrl: r.iconUrl,
            tooltip: r.tooltip
          })
        }
      return t.length > 0
      ? t
      : null
  },
  this.clear = function() {
    r.children.length = 0,
    n();
    for (var t in l)
      l.hasOwnProperty(t) && delete l[t]
  },
  this.activate = function() {
    this.clear(),
    r.parent !== a && (o.addToPickGroups(r), a.add(r))
  },
  this.deactivate = function() {
    this.clear(),
    r.parent === a && (o.removeFromPickGroups(r), a.remove(r))
  },
  this.show = function() {
    r.pickEnabled = !0,
    s = !1,
    this.update()
  },
  this.hide = function() {
    r.pickEnabled = !1,
    s = !0,
    this.update()
  },
  this.load = function(t) {
    this.clear(),
    this.add(t),
    this.update()
  },
  this.update = function() {
    if (r.matrixWorld.copy(o.getMatrixGlobal()), r.children.length = 0, !s)
      for (var t in l)
        if (l.hasOwnProperty(t)) {
          var e = l[t],
            i = e.length;
          if (i < 1)
            continue;
          for (var n = t.lastIndexOf("_"), a = c[t.substring(0, n)], h = parseInt(t.substring(n + 1)), u = new THREE.Geometry, d = 0; d < i; ++d) {
            var p = new THREE.Vector3(e[d].position.x, e[d].position.y, e[d].position.z);
            u.vertices.push(p)
          }
          var f = new THREE.PointsMaterial({
            size: h,
            sizeAttenuation: !1,
            map: a,
            depthTest: !0,
            transparent: !0
          });
          f.color.setHex(8747392);
          var m = new CLOUD.PointsEx(u, f);
          m.name = t,
          m.radius = h,
          r.add(m),
          m.matrixAutoUpdate = !1,
          m.updateMatrixWorld(!0)
        }
      },
  this.getItemByKeyAndIdx = function(t, e) {
    if (l.hasOwnProperty(t)) {
      var i = l[t][e];
      if (i)
        return {
          id: i.id,
          position: {
            x: i.position.x,
            y: i.position.y,
            z: i.position.z
          },
          size: i.size,
          iconUrl: i.iconUrl,
          tooltip: i.tooltip
        }
      }
    return null
  },
  this.getItemByPick = function(t) {
    var e = t.selectedObjectId,
      i = t.index;
    return this.getItemByKeyAndIdx(e, i)
  }
},
CLOUD.SceneStateHelper = function(t, e) {
  this.modelManager = t,
  this.filter = e
},
CLOUD.SceneStateHelper.prototype = {
  constructor: CLOUD.SceneStateHelper,
  _checkSelectionChange: function(t) {
    var e = this.filter._getSelectedIds(),
      i = t.length !== e.length;
    if (!i) {
      t.sort(),
      e.sort();
      for (var n = 0; n < t.length; n++)
        if (t[n] !== e[n]) {
          i = !0;
          break
        }
      }
    i && this.modelManager.dispatchEvent({type: CLOUD.EVENTS.ON_SELECTION_CHANGED, selectionList: e})
  },
  clearSelection: function() {
    var t = this.filter._getSelectedIds();
    this.filter.clearIdList(CLOUD.EnumIdBasedType.SELECTED),
    t.length > 0 && this.modelManager.dispatchEvent({type: CLOUD.EVENTS.ON_SELECTION_CHANGED, selectionList: []})
  },
  addSelection: function(t) {
    var e = this.filter._getSelectedIds();
    this.filter.addToIdList(CLOUD.EnumIdBasedType.SELECTED, t),
    this._checkSelectionChange(e)
  },
  setSelection: function(t) {
    var e = this.filter._getSelectedIds();
    this.filter.setIdList(CLOUD.EnumIdBasedType.SELECTED, t),
    this._checkSelectionChange(e)
  },
  removeSelection: function(t) {
    var e = this.filter._getSelectedIds();
    this.filter.removeFromIdList(CLOUD.EnumIdBasedType.SELECTED, t),
    this._checkSelectionChange(e)
  },
  getSelection: function() {
    return this.filter._getSelectedIds()
  }
},
CLOUD.MaterialSelector = function() {
  var t = [
      {
        name: "scene",
        param: {
          name: "scene",
          color: 8947848,
          opacity: .4,
          transparent: !0,
          side: THREE.DoubleSide
        }
      }, {
        name: "darkRed",
        param: {
          name: "darkRed",
          color: 10496040,
          opacity: 1,
          transparent: !1,
          side: THREE.DoubleSide
        }
      }, {
        name: "lightBlue",
        param: {
          name: "lightBlue",
          color: 1275840,
          opacity: 1,
          transparent: !1,
          side: THREE.DoubleSide
        }
      }, {
        name: "black",
        param: {
          name: "black",
          color: 0,
          opacity: .3,
          transparent: !0,
          side: THREE.DoubleSide
        }
      }, {
        name: "add",
        param: {
          name: "add",
          color: 65280,
          opacity: 1,
          transparent: !0,
          side: THREE.DoubleSide
        }
      }, {
        name: "delete",
        param: {
          name: "delete",
          color: 16711680,
          opacity: .5,
          transparent: !0,
          side: THREE.DoubleSide
        }
      }, {
        name: "beforeEdit",
        param: {
          name: "beforeEdit",
          color: 16432389,
          opacity: .5,
          transparent: !0,
          side: THREE.DoubleSide
        }
      }, {
        name: "afterEdit",
        param: {
          name: "afterEdit",
          color: 16432389,
          opacity: 1,
          transparent: !0,
          side: THREE.DoubleSide
        }
      }
    ],
    e = {};
  e.selection = CLOUD.MaterialUtil.createHighlightMaterial(),
  e.selection.name = "selection";
  for (var i = 0, n = t.length; i < n; ++i) {
    var o = t[i],
      r = o.name,
      a = o.param;
    e[r] = CLOUD.MaterialUtil.createPhongMaterial(a)
  }
  e.red = e.delete,
  e.green = e.add,
  e.yellow = e.beforeEdit,
  e.blue = e.selection;
  var s = {
      color: 14540253,
      opacity: .9,
      transparent: !0,
      side: THREE.DoubleSide
    },
    l = CLOUD.MaterialUtil.createPhongMaterial(s);
  l.name = "hover";
  var c = {
      color: 8947848,
      opacity: .2,
      transparent: !0,
      side: THREE.DoubleSide
    },
    h = CLOUD.MaterialUtil.createPhongMaterial(c);
  h.name = "isolate",
  this.getDefaultMaterialName = function() {
    return "lightBlue"
  },
  this.get = function(t) {
    return e[t]
  },
  this.getAll = function() {
    return e
  },
  this.add = function(t) {
    var i,
      n,
      o = {};
    return t && t.color
      ? (
        o.color = t.color, o.side = THREE.DoubleSide, t.opacity
        ? (o.opacity = t.opacity, o.transparent = !0, i = t.color + "_" + t.opacity)
        : i = t.color)
      : i = t + "",
    n = e[i],
    n || (o.name = i, n = CLOUD.MaterialUtil.createPhongMaterial(o), e[i] = n),
    i
  },
  this.remove = function(t) {
    var i,
      n;
    i = t.color
      ? t.opacity
        ? t.color + "_" + t.opacity
        : t.color
      : t + "",
    (n = e[i]) && delete e[i]
  },
  this.has = function(t) {
    return !!e[t]
  },
  this.getMaterialNameByColor = function(t) {
    var i,
      n;
    return i = t.color
      ? t.opacity
        ? t.color + "_" + t.opacity
        : t.color
      : t + "",
    n = e[i],
    n
      ? i
      : this.add(t)
  },
  this.setIsolateMaterial = function(t) {
    void 0 !== t.color
      ? h.color.setHex(t.color)
      : h.color.setHex(c.color),
    void 0 !== t.opacity
      ? h.opacity = t.opacity
      : h.opacity = c.opacity,
    void 0 !== t.transparent
      ? h.transparent = t.transparent
      : h.transparent = c.transparent,
    void 0 !== t.side
      ? h.side = t.side
      : h.side = c.side,
    h.needsUpdate = !0
  },
  this.getIsolateMaterial = function() {
    return h
  },
  this.resetIsolateMaterial = function() {
    h.color.setHex(c.color),
    h.opacity = c.opacity,
    h.transparent = c.transparent,
    h.side = c.side,
    h.needsUpdate = !0
  },
  this.setHoverMaterial = function(t) {
    void 0 !== t.color
      ? l.color.setHex(t.color)
      : l.color.setHex(s.color),
    void 0 !== t.opacity
      ? l.opacity = t.opacity
      : l.opacity = s.opacity,
    void 0 !== t.transparent
      ? l.transparent = t.transparent
      : l.transparent = s.transparent,
    void 0 !== t.side
      ? l.side = t.side
      : l.side = s.side,
    l.needsUpdate = !0
  },
  this.getHoverMaterial = function(t) {
    if (t && t.color) {
      var e = t.color.clone();
      e.r += .3 * e.r,
      e.g += .3 * e.g,
      e.b += .3 * e.b,
      e.r > 1 && (e.r = 1),
      e.g > 1 && (e.g = 1),
      e.b > 1 && (e.b = 1),
      1 === e.r && 1 === e.g && 1 === e.b && (e.r = .87, e.g = .87, e.b = .87);
      var i = {
        color: e.getHex(),
        opacity: t.opacity,
        transparent: t.transparent,
        side: t.side
      };
      this.setHoverMaterial(i)
    }
    return l
  }
},
CLOUD.FilterManager = function() {
  this._filterImpl = new CLOUD.FilterManager2;
  var t = CLOUD.EnumIdBasedType,
    e = new THREE.Box3;
  this._isEmptySelections = function() {
    return this._filterImpl._isEmptySelections()
  },
  this._resetBoundingBoxFromSelections = function() {
    e.makeEmpty()
  },
  this._getBoundingBoxFromSelections = function() {
    return e
  },
  this._calcBoundingBoxFromSelections = function(t) {
    var i = this._filterImpl._getSelected();
    if (CLOUD.Utils.isEmptyObject(i))
      return !1;
    for (var n = 0, o = t.length; n < o; ++n) {
      var r = t[n].object,
        a = r.geometry;
      if (a) {
        if (void 0 !== i[r.name]) {
          a.boundingBox || a.computeBoundingBox();
          var s = a.boundingBox;
          if (s) {
            var l = s.clone();
            r.matrixWorld && l.applyMatrix4(r.matrixWorld),
            e.expandByPoint(l.min),
            e.expandByPoint(l.max)
          }
        }
      } else
        CLOUD.Logger.log("empty geometry!")
    }
    return !0
  },
  this._getBoundingBoxFromRenderObjects = function(t) {
    for (var e = new THREE.Box3, i = 0, n = t.length; i < n; ++i) {
      var o = t[i].object;
      if (this._isVisible(o) && !o.customTag) {
        var r = o.geometry;
        if (r) {
          null == r.boundingBox && r.computeBoundingBox();
          var a = r.boundingBox;
          if (a) {
            var s = a.clone();
            o.matrixWorld && s.applyMatrix4(o.matrixWorld),
            e.expandByPoint(s.min),
            e.expandByPoint(s.max)
          }
        } else
          CLOUD.Logger.log("empty geometry!")
      }
    }
    return e
  },
  this._setHoverMaterial = function(t) {
    this._filterImpl._setHoverMaterial(t)
  },
  this._setHoverId = function(t) {
    this._filterImpl._setHoverId(t)
  },
  this._clearHoverId = function() {
    this._filterImpl._clearHoverId()
  },
  this._getSelectedIds = function() {
    return this._filterImpl._getSelectedIds()
  },
  this._isVisible = function(t) {
    return this._filterImpl._isVisible(t)
  },
  this._isSelectable = function(t) {
    return this._filterImpl._isSelectable(t)
  },
  this._getOverrideMaterial = function(t) {
    return this._filterImpl._getOverrideMaterial(t)
  },
  this._hasOverrideMaterial = function(t) {
    return this._filterImpl._hasHighPriorityOverrideMaterial(t)
  },
  this._hasHighPriorityOverrideMaterial = function(t) {
    return this._filterImpl._hasHighPriorityOverrideMaterial(t)
  },
  this._isHiddenFileId = function(t) {
    return this._filterImpl._isHiddenFileId(t)
  },
  this._hasHiddenFileIdFilter = function() {
    return this._filterImpl._hasHiddenFileIdFilter()
  },
  this._hasVisibleFilter = function() {
    return this._filterImpl._hasVisibleFilter()
  },
  this._hasSelectableFilter = function() {
    return this._filterImpl._hasSelectableFilter()
  },
  this._hasOverrideMaterialFilter = function() {
    return this._filterImpl._hasOverrideMaterialFilter()
  },
  this._hasLowPriorityOverride = function() {
    return this._filterImpl._hasLowPriorityOverride()
  },
  this.saveState = function() {
    return this._filterImpl.saveState()
  },
  this.loadState = function(t) {
    return this._filterImpl.loadState(t)
  },
  this.clear = function() {
    return this._filterImpl.clear()
  },
  this.clearAll = function() {
    return this._filterImpl.clearAll()
  },
  this.clearIsolate = function() {
    return this._filterImpl.clearIsolate()
  },
  this.getSelectionSet = function() {
    return this._filterImpl._getSelected()
  },
  this.setSelectionColor = function(t) {
    return this._filterImpl.setSelectionColor(t)
  },
  this.clearFrozenList = function() {
    return this._filterImpl.clearFrozenList()
  },
  this.addToFrozenList = function(t) {
    return this._filterImpl.addToFrozenList(t)
  },
  this.removeFromFrozenList = function(t) {
    return this._filterImpl.removeFromFrozenList(t)
  },
  this.setFrozenList = function(t) {
    return this._filterImpl.setFrozenList(t)
  },
  this.setFrozenConditions = function(t) {
    this._filterImpl.setFrozenConditions(t)
  },
  this.getFrozenConditions = function() {
    return this._filterImpl.getFrozenConditions()
  },
  this.clearFrozenConditions = function() {
    this._filterImpl.clearFrozenConditions()
  },
  this.clearFrozen = function() {
    this.clearFrozenList(),
    this.clearFrozenConditions()
  },
  this.clearAllIdList = function() {
    return this._filterImpl.clearAllIdList()
  },
  this.clearIdList = function(t) {
    return this._filterImpl.clearIdList(t)
  },
  this.addToIdList = function(t, e) {
    return this._filterImpl.addToIdList(t, e)
  },
  this.removeFromIdList = function(t, e) {
    return this._filterImpl.removeFromIdList(t, e)
  },
  this.setIdList = function(t, e) {
    return this._filterImpl.setIdList(t, e)
  },
  this.clearAllOverrideList = function() {
    this._filterImpl.clearAllOverrideList()
  },
  this.clearOverrideList = function(t) {
    return this._filterImpl.clearOverrideList(t)
  },
  this.addToOverrideList = function(t, e, i) {
    return this._filterImpl.addToOverrideList(t, e, i)
  },
  this.removeFromOverrideList = function(t, e) {
    return this._filterImpl.removeFromOverrideList(t, e)
  },
  this.setOverrideList = function(t, e, i) {
    return this._filterImpl.setOverrideList(t, e, i)
  },
  this.addToOverrideListByColor = function(t, e, i) {
    return this._filterImpl.addToOverrideListByColor(t, e, i)
  },
  this.setOverrideListByColor = function(t, e, i) {
    return this._filterImpl.setOverrideListByColor(t, e, i)
  },
  this.clearAllUserList = function() {
    return this._filterImpl.clearAllUserList()
  },
  this.clearUserListByType = function(t) {
    return this._filterImpl.clearUserListByType(t)
  },
  this.clearUserList = function(t, e) {
    return this._filterImpl.clearUserList(t, e)
  },
  this.addToUserList = function(t, e, i, n) {
    return this._filterImpl.addToUserList(t, e, i, n)
  },
  this.removeFromUserList = function(t, e, i) {
    this._filterImpl.removeFromUserList(t, e, i)
  },
  this.setUserList = function(t, e, i, n) {
    this._filterImpl.setUserList(t, e, i, n)
  },
  this.isIsolate = function() {
    return this._filterImpl.isIsolate()
  },
  this.isFiltering = function() {
    return this._filterImpl.isFiltering()
  },
  this.setIsolateMaterial = function(t) {
    this._filterImpl.setIsolateMaterial(t)
  },
  this.getIsolateMaterial = function() {
    return this._filterImpl.getIsolateMaterial()
  },
  this.resetIsolateMaterial = function() {
    this._filterImpl.resetIsolateMaterial()
  },
  this.clearAllIsolateList = function() {
    this._filterImpl.clearAllIsolateList()
  },
  this.clearIsolateList = function(t) {
    this._filterImpl.clearIsolateList(t)
  },
  this.addToIsolateList = function(t, e) {
    this._filterImpl.addToIsolateList(t, e)
  },
  this.removeFromIsolateList = function(t, e) {
    this._filterImpl.removeFromIsolateList(t, e)
  },
  this.setIsolateList = function(t, e) {
    this._filterImpl.setIsolateList(t, e)
  },
  this.isolateSelections = function(t) {
    this._filterImpl.isolateSelections(t)
  },
  this.removeSelectionsFromIsolateList = function(t) {
    this._filterImpl.removeSelectionsFromIsolateList(t)
  },
  this.setIsolateConditions = function(t, e) {
    this._filterImpl.setIsolateConditions(t, e)
  },
  this.getIsolateConditions = function(t) {
    return this._filterImpl.getIsolateConditions(t)
  },
  this.clearIsolateConditions = function(t) {
    this._filterImpl.clearIsolateConditions(t)
  },
  this.clearAllIsolateConditions = function() {
    this._filterImpl.clearAllIsolateConditions()
  },
  this.setConditions = function(t, e) {
    this._filterImpl.setConditions(t, e)
  },
  this.getConditions = function(t) {
    return this._filterImpl.getConditions(t)
  },
  this.clearConditions = function(t) {
    this._filterImpl.clearConditions(t)
  },
  this.clearAllConditions = function() {
    this._filterImpl.clearAllConditions()
  },
  this.makeSceneTranslucent = function() {
    this._filterImpl.makeSceneTranslucent()
  },
  this.cancelSceneTranslucent = function() {
    this._filterImpl.cancelSceneTranslucent()
  },
  this.hideScene = function() {
    this._filterImpl.hideScene()
  },
  this.showScene = function() {
    this._filterImpl.showScene()
  },
  this.setSceneState = function(t) {
    this._filterImpl.setSceneState(t)
  },
  this.getSceneState = function() {
    return this._filterImpl.getSceneState()
  },
  this.hideSelections = function() {
    this._filterImpl.hideSelections()
  },
  this.hideUnselections = function() {
    this._filterImpl.hideUnselections()
  },
  this.cancelHidden = function() {
    this._filterImpl.cancelHidden()
  },
  this.makeSelectedTranslucent = function() {
    this._filterImpl.makeSelectedTranslucent()
  },
  this.makeSelectedOthersTranslucent = function() {
    this._filterImpl.makeSelectedOthersTranslucent()
  },
  this.cancelTranslucent = function() {
    this._filterImpl.cancelTranslucent()
  },
  this.hideByIds = function(e) {
    this._filterImpl._addIdsToFilter(t.HIDDEN, e)
  },
  this.showByIds = function(e) {
    this._filterImpl._addIdsToFilter(t.VISIBLE, e)
  },
  this.makeTranslucentByIds = function(e) {
    this._filterImpl._addIdsToFilter(t.TRANSLUCENT, e)
  },
  this.makeTranslucentOthersByIds = function(e) {
    this._filterImpl._addIdsToFilter(t.TRANSLUCENT_OTHERS, e)
  },
  this.getFilterType = function() {
    return this._filterImpl._getFilterType()
  }
},
CLOUD.FilterManager2 = function() {
  var t,
    e,
    i,
    n = CLOUD.EnumIdBasedType,
    o = CLOUD.EnumSceneState,
    r = CLOUD.FilterResultMode,
    a = {
      IDFILTER_OFFSET: 0,
      FILE_VISIBLE: 0,
      FILE_HIDDEN: 1,
      SELECTED: 2,
      VISIBLE: 3,
      HIDDEN: 4,
      TRANSLUCENT: 5,
      TRANSLUCENT_OTHERS: 6,
      IDFILTER_ENDOFFSET: 6,
      ISOLATEFILTER_OFFSET: 7,
      ISOLATE_HIDDEN: 7,
      ISOLATE_HIDDEN_OTHERS: 8,
      ISOLATE_TRANSLUCENT: 9,
      ISOLATE_TRANSLUCENT_OTHERS: 10,
      ISOLATEFILTER_ENDOFFSET: 10,
      USERFILTER_OFFSET: 11,
      USER_HIDDEN: 11,
      USER_OVERRIDE: 12,
      USERFILTER_ENDOFFSET: 12,
      CONDITIONFILTER_OFFSET: 13,
      CONDITION_HIDDEN_OTHERS: 13,
      CONDITION_TRANSLUCENT_OTHERS: 14,
      CONDITION_OVERRIDE: 15,
      CONDITIONFILTER_ENDOFFSET: 15,
      ISOLATECONDITIONFILTER_OFFSET: 16,
      ISOLATE_CONDITION_HIDDEN: 16,
      ISOLATE_CONDITION_HIDDEN_OTHERS: 17,
      ISOLATE_CONDITION_TRANSLUCENT: 18,
      ISOLATE_CONDITION_TRANSLUCENT_OTHERS: 19,
      ISOLATECONDITIONFILTER_ENDOFFSET: 19,
      FROZENFILTER: 20,
      FROZENCONDITIONFILTER: 21,
      OVERRIDEFILTER: 22,
      BASICFILTER_COUNT: 22
    },
    s = new CLOUD.CompoundFilter(!0),
    l = new CLOUD.CompoundFilter(!0),
    c = new CLOUD.CompoundFilter(!1),
    h = new CLOUD.CompoundFilter(!0),
    u = new CLOUD.CompoundFilter(!1),
    d = [],
    p = o.DISABLED,
    f = new CLOUD.MaterialSelector,
    m = void 0;
  !function() {
    d[a.FILE_VISIBLE] = new CLOUD.FileIdFilter(a.FILE_VISIBLE),
    d[a.FILE_HIDDEN] = new CLOUD.FileIdFilter(a.FILE_HIDDEN),
    t = new CLOUD.GeneralIdFilter(a.SELECTED),
    d[a.SELECTED] = t,
    d[a.VISIBLE] = new CLOUD.GeneralIdFilter(a.VISIBLE),
    d[a.HIDDEN] = new CLOUD.GeneralIdFilter(a.HIDDEN),
    d[a.TRANSLUCENT] = new CLOUD.GeneralIdFilter(a.TRANSLUCENT),
    d[a.TRANSLUCENT_OTHERS] = new CLOUD.GeneralIdFilter(a.TRANSLUCENT_OTHERS),
    d[a.ISOLATE_HIDDEN] = new CLOUD.GeneralIdFilter(a.ISOLATE_HIDDEN),
    d[a.ISOLATE_HIDDEN_OTHERS] = new CLOUD.GeneralIdFilter(a.ISOLATE_HIDDEN_OTHERS),
    d[a.ISOLATE_TRANSLUCENT] = new CLOUD.GeneralIdFilter(a.ISOLATE_TRANSLUCENT),
    d[a.ISOLATE_TRANSLUCENT_OTHERS] = new CLOUD.GeneralIdFilter(a.ISOLATE_TRANSLUCENT_OTHERS),
    d[a.USER_HIDDEN] = new CLOUD.UserListFilter(a.USER_HIDDEN),
    d[a.USER_OVERRIDE] = new CLOUD.UserListFilter(a.USER_OVERRIDE),
    d[a.CONDITION_HIDDEN_OTHERS] = new CLOUD.ConditionFilter(a.CONDITION_HIDDEN_OTHERS),
    d[a.CONDITION_TRANSLUCENT_OTHERS] = new CLOUD.ConditionFilter(a.CONDITION_TRANSLUCENT_OTHERS),
    d[a.CONDITION_OVERRIDE] = new CLOUD.MultiConditionFilter(a.CONDITION_OVERRIDE),
    d[a.ISOLATE_CONDITION_HIDDEN] = new CLOUD.ConditionFilter(a.ISOLATE_CONDITION_HIDDEN),
    d[a.ISOLATE_CONDITION_HIDDEN_OTHERS] = new CLOUD.ConditionFilter(a.ISOLATE_CONDITION_HIDDEN_OTHERS),
    d[a.ISOLATE_CONDITION_TRANSLUCENT] = new CLOUD.ConditionFilter(a.ISOLATE_CONDITION_TRANSLUCENT),
    d[a.ISOLATE_CONDITION_TRANSLUCENT_OTHERS] = new CLOUD.ConditionFilter(a.ISOLATE_CONDITION_TRANSLUCENT_OTHERS),
    i = new CLOUD.GeneralIdFilter(a.FROZENFILTER),
    d[a.FROZENCONDITIONFILTER] = new CLOUD.ConditionFilter(a.FROZENCONDITIONFILTER),
    d[a.FROZENFILTER] = i,
    e = new CLOUD.OverrideListFilter(a.OVERRIDEFILTER),
    d[a.OVERRIDEFILTER] = e;
    var n,
      o = {};
    o[a.HIDDEN] = r.MATCH_RETURN_FALSE,
    o[a.VISIBLE] = r.NOMATCH_RETURN_FALSE,
    o[a.USER_HIDDEN] = r.MATCH_RETURN_FALSE,
    o[a.CONDITION_HIDDEN_OTHERS] = r.NOMATCH_RETURN_FALSE,
    o[a.ISOLATE_HIDDEN] = r.MATCH_RETURN_FALSE,
    o[a.ISOLATE_HIDDEN_OTHERS] = r.NOMATCH_RETURN_FALSE,
    o[a.ISOLATE_CONDITION_HIDDEN_OTHERS] = r.NOMATCH_RETURN_FALSE,
    s.setFilterMode(o);
    for (n in o)
      d[n].registerToCompoundFilter(s);
    var p = {};
    p[a.FROZENFILTER] = r.MATCH_RETURN_FALSE,
    p[a.FROZENCONDITIONFILTER] = r.MATCH_RETURN_FALSE,
    p[a.TRANSLUCENT] = r.MATCH_RETURN_FALSE,
    p[a.TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_FALSE,
    p[a.CONDITION_TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_FALSE,
    p[a.ISOLATE_TRANSLUCENT] = r.MATCH_RETURN_FALSE,
    p[a.ISOLATE_TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_FALSE,
    p[a.ISOLATE_CONDITION_TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_FALSE,
    h.setFilterMode(p);
    for (n in p)
      d[n].registerToCompoundFilter(h);
    var f = {};
    f[a.ISOLATE_TRANSLUCENT] = r.MATCH_RETURN_TRUE,
    f[a.ISOLATE_TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_TRUE,
    f[a.ISOLATE_CONDITION_TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_TRUE,
    f[a.CONDITION_TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_TRUE,
    f[a.TRANSLUCENT] = r.MATCH_RETURN_TRUE,
    f[a.TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_TRUE,
    f[a.SELECTED] = r.MATCH_RETURN_TRUE,
    f[a.OVERRIDEFILTER] = r.MATCH_RETURN_TRUE,
    f[a.USER_OVERRIDE] = r.MATCH_RETURN_TRUE,
    f[a.CONDITION_OVERRIDE] = r.MATCH_RETURN_TRUE,
    f[a.FROZENFILTER] = r.MATCH_RETURN_TRUE,
    f[a.FROZENCONDITIONFILTER] = r.MATCH_RETURN_TRUE;
    var m = {};
    m[a.ISOLATE_TRANSLUCENT] = 5,
    m[a.ISOLATE_TRANSLUCENT_OTHERS] = 5,
    m[a.ISOLATE_CONDITION_TRANSLUCENT_OTHERS] = 5,
    m[a.CONDITION_TRANSLUCENT_OTHERS] = 5,
    m[a.TRANSLUCENT] = 5,
    m[a.TRANSLUCENT_OTHERS] = 5,
    m[a.SELECTED] = 2,
    m[a.OVERRIDEFILTER] = 0,
    m[a.USER_OVERRIDE] = 0,
    m[a.CONDITION_OVERRIDE] = 0,
    m[a.FROZENFILTER] = 3,
    m[a.FROZENCONDITIONFILTER] = 3,
    l.setFilterMode(f),
    l.setFilterPriority(m);
    for (n in f)
      d[n].registerToCompoundFilter(l);
    var g = {};
    g[a.SELECTED] = r.MATCH_RETURN_TRUE,
    g[a.OVERRIDEFILTER] = r.MATCH_RETURN_TRUE,
    g[a.USER_OVERRIDE] = r.MATCH_RETURN_TRUE,
    g[a.CONDITION_OVERRIDE] = r.MATCH_RETURN_TRUE,
    g[a.CONDITION_TRANSLUCENT_OTHERS] = r.MATCH_RETURN_TRUE,
    g[a.ISOLATE_CONDITION_TRANSLUCENT_OTHERS] = r.NOMATCH_RETURN_TRUE,
    c.setFilterMode(g);
    for (n in g)
      d[n].registerToCompoundFilter(c);
    var v = {};
    v[a.FILE_VISIBLE] = r.NOMATCH_RETURN_TRUE,
    v[a.FILE_HIDDEN] = r.MATCH_RETURN_TRUE,
    u.setFilterMode(v);
    for (n in v)
      d[n].registerToCompoundFilter(u)
  }(),
  this.saveState = function() {
    for (var t, e = {}, i = 0, n = d.length; i < n; i++)
      t = d[i],
      e[i] = t.getAll();
    return e.sceneState = this.getSceneState(),
    e
  },
  this.loadState = function(t) {
    for (var e in t)
      "sceneState" !== e && d[e].setByData(t[e]);
    this.setSceneState(t.sceneState)
  },
  this.clear = function() {
    for (var t = 0, e = d.length; t < e; t++)
      d[t].getType() !== a.FROZENFILTER && d[t].clearAll();
    this.setSceneState(o.DISABLED),
    m = void 0
  },
  this.clearAll = function() {
    for (var t = 0, e = d.length; t < e; t++)
      d[t].clearAll();
    this.setSceneState(o.DISABLED),
    m = void 0
  },
  this.clearIsolate = function() {
    this.clearAllIsolateList(),
    this.clearAllIsolateConditions()
  },
  this.setSelectionColor = function(t) {
    var e = f.get("selection");
    e.color.setHex(t),
    e.needsUpdate = !0
  },
  this.clearFrozenList = function() {
    i.clearAll()
  },
  this.addToFrozenList = function(t) {
    i.add(t)
  },
  this.removeFromFrozenList = function(t) {
    i.remove(t)
  },
  this.setFrozenList = function(t) {
    this.clearFrozenList(),
    this.addToFrozenList(t)
  },
  this.setFrozenConditions = function(t) {
    d[a.FROZENCONDITIONFILTER].setByData(t)
  },
  this.getFrozenConditions = function() {
    return d[a.FROZENCONDITIONFILTER].getAll()
  },
  this.clearFrozenConditions = function() {
    d[a.FROZENCONDITIONFILTER].clear()
  },
  this.clearFrozen = function() {
    this.clearFrozenList(),
    this.clearFrozenConditions()
  },
  this.clearAllIdList = function() {
    var t;
    for (t = a.IDFILTER_OFFSET; t <= IDFILTER_ENDOFFSET; t++)
      d[t].clearAll()
  },
  this.clearIdList = function(t) {
    var e = a.IDFILTER_OFFSET + t;
    e >= a.IDFILTER_OFFSET && e <= a.IDFILTER_ENDOFFSET && d[e].clear()
  },
  this.addToIdList = function(t, e) {
    var i = a.IDFILTER_OFFSET + t;
    i >= a.IDFILTER_OFFSET && i <= a.IDFILTER_ENDOFFSET && d[i].add(e)
  },
  this.removeFromIdList = function(t, e) {
    var i = a.IDFILTER_OFFSET + t;
    i >= a.IDFILTER_OFFSET && i <= a.IDFILTER_ENDOFFSET && d[i].remove(e)
  },
  this.setIdList = function(t, e) {
    this.clearIdList(t),
    this.addToIdList(t, e)
  },
  this.clearAllOverrideList = function() {
    e.clearAll()
  },
  this.clearOverrideList = function(t) {
    e.clear(t)
  },
  this.addToOverrideList = function(t, i, n) {
    i && i.length > 0 && (f.has(n) || (n = f.getDefaultMaterialName()), e.add(t, i, n))
  },
  this.removeFromOverrideList = function(t, i) {
    e.remove(t, i)
  },
  this.setOverrideList = function(t, e, i) {
    this.clearOverrideList(t),
    this.addToOverrideList(t, e, i)
  },
  this.addToOverrideListByColor = function(t, i, n) {
    var o = f.add(n);
    e.add(t, i, o)
  },
  this.setOverrideListByColor = function(t, e, i) {
    this.clearOverrideList(t),
    this.addToOverrideListByColor(t, e, i)
  },
  this.clearAllUserList = function() {
    var t;
    for (t = a.USERFILTER_OFFSET; t <= a.USERFILTER_ENDOFFSET; t++)
      d[t].clearAll()
  },
  this.clearUserListByType = function(t) {
    var e = a.USERFILTER_OFFSET + t;
    e >= a.USERFILTER_OFFSET && e <= a.USERFILTER_ENDOFFSET && d[e].clearAll()
  },
  this.clearUserList = function(t, e) {
    var i = a.USERFILTER_OFFSET + t;
    i >= a.USERFILTER_OFFSET && i <= a.USERFILTER_ENDOFFSET && d[i].clear(e)
  },
  this.addToUserList = function(t, e, i, n) {
    var o = a.USERFILTER_OFFSET + t;
    o >= a.USERFILTER_OFFSET && o <= a.USERFILTER_ENDOFFSET && d[o].add(e, i, n)
  },
  this.removeFromUserList = function(t, e, i) {
    var n = a.USERFILTER_OFFSET + t;
    n >= a.USERFILTER_OFFSET && n <= a.USERFILTER_ENDOFFSET && d[n].remove(e, i)
  },
  this.setUserList = function(t, e, i, n) {
    this.clearUserList(t, e),
    this.addToUserList(t, e, i, n)
  },
  this.isIsolate = function() {
    var t;
    for (t = a.ISOLATEFILTER_OFFSET; t <= a.ISOLATEFILTER_ENDOFFSET; t++)
      if (!d[t].isEmpty())
        return !0;
  return !1
  },
  this.isFiltering = function() {
    return !!this.isIsolate() || !(d[a.HIDDEN].isEmpty() && d[a.VISIBLE].isEmpty() && d[a.TRANSLUCENT].isEmpty() && d[a.TRANSLUCENT_OTHERS].isEmpty() && this.getSceneState() === o.DISABLED)
  },
  this.setIsolateMaterial = function(t) {
    f.setIsolateMaterial(t)
  },
  this.getIsolateMaterial = function() {
    return f.getIsolateMaterial()
  },
  this.resetIsolateMaterial = function() {
    f.resetIsolateMaterial()
  },
  this.clearAllIsolateList = function() {
    var t;
    for (t = a.ISOLATEFILTER_OFFSET; t <= a.ISOLATEFILTER_ENDOFFSET; t++)
      d[t].clear()
  },
  this.clearIsolateList = function(t) {
    var e = a.ISOLATEFILTER_OFFSET + t;
    e >= a.ISOLATEFILTER_OFFSET && e <= a.ISOLATEFILTER_ENDOFFSET && d[e].clear()
  },
  this.addToIsolateList = function(t, e) {
    var i = a.ISOLATEFILTER_OFFSET + t;
    i >= a.ISOLATEFILTER_OFFSET && i <= a.ISOLATEFILTER_ENDOFFSET && d[i].add(e)
  },
  this.removeFromIsolateList = function(t, e) {
    var i = a.ISOLATEFILTER_OFFSET + t;
    i >= a.ISOLATEFILTER_OFFSET && i <= a.ISOLATEFILTER_ENDOFFSET && d[i].remove(e)
  },
  this.setIsolateList = function(t, e) {
    this.clearIsolateList(t),
    this.addToIsolateList(t, e)
  },
  this.isolateSelections = function(t) {
    this.clearAllIsolateList();
    var e = a.ISOLATEFILTER_OFFSET + t;
    e >= a.ISOLATEFILTER_OFFSET && e <= a.ISOLATEFILTER_ENDOFFSET && d[e].add(this._getSelectedIds())
  },
  this.removeSelectionsFromIsolateList = function(t) {
    this.removeFromIsolateList(t, this._getSelectedIds())
  },
  this.setIsolateConditions = function(t, e) {
    var i = a.ISOLATECONDITIONFILTER_OFFSET + e;
    i >= a.ISOLATECONDITIONFILTER_OFFSET && i <= a.ISOLATECONDITIONFILTER_ENDOFFSET && d[i].setByData(t)
  },
  this.getIsolateConditions = function(t) {
    var e = null,
      i = a.ISOLATECONDITIONFILTER_OFFSET + t;
    return i >= a.ISOLATECONDITIONFILTER_OFFSET && i <= a.ISOLATECONDITIONFILTER_ENDOFFSET && (e = d[i].getAll()),
    e
  },
  this.clearIsolateConditions = function(t) {
    var e = a.ISOLATECONDITIONFILTER_OFFSET + t;
    e >= a.ISOLATECONDITIONFILTER_OFFSET && e <= a.ISOLATECONDITIONFILTER_ENDOFFSET && d[e].clear()
  },
  this.clearAllIsolateConditions = function() {
    var t;
    for (t = a.ISOLATECONDITIONFILTER_OFFSET; t <= a.ISOLATECONDITIONFILTER_ENDOFFSET; t++)
      d[t].clearAll()
  },
  this.setConditions = function(t, e) {
    var i = a.CONDITIONFILTER_OFFSET + t;
    i >= a.CONDITIONFILTER_OFFSET && i <= a.CONDITIONFILTER_ENDOFFSET && d[i].setByData(e)
  },
  this.getConditions = function(t) {
    var e = null,
      i = a.CONDITIONFILTER_OFFSET + t;
    return i >= a.CONDITIONFILTER_OFFSET && i <= a.CONDITIONFILTER_ENDOFFSET && (e = d[i].get()),
    e
  },
  this.clearConditions = function(t) {
    var e = a.CONDITIONFILTER_OFFSET + t;
    e >= a.CONDITIONFILTER_OFFSET && e <= a.CONDITIONFILTER_ENDOFFSET && d[e].clearAll()
  },
  this.clearAllConditions = function() {
    var t;
    for (t = a.CONDITIONFILTER_OFFSET; t <= a.CONDITIONFILTER_ENDOFFSET; t++)
      d[t].clear()
  },
  this.makeSceneTranslucent = function() {
    this.setSceneState(o.TRANSLUCENT)
  },
  this.cancelSceneTranslucent = function() {
    this.setSceneState(o.DISABLED)
  },
  this.hideScene = function() {
    this.setSceneState(o.HIDDEN)
  },
  this.showScene = function() {
    this.setSceneState(o.DISABLED)
  },
  this.setSceneState = function(t) {
    p = t
  },
  this.getSceneState = function() {
    return p
  },
  this.hideSelections = function() {
    d[a.HIDDEN].add(this._getSelectedIds())
  },
  this.hideUnselections = function() {
    d[a.VISIBLE].add(this._getSelectedIds()),
    d[a.VISIBLE].forceEnable()
  },
  this.cancelHidden = function() {
    this.clearIdList(n.VISIBLE),
    this.clearIdList(n.HIDDEN)
  },
  this.makeSelectedTranslucent = function() {
    d[a.TRANSLUCENT].add(this._getSelectedIds())
  },
  this.makeSelectedOthersTranslucent = function() {
    d[a.TRANSLUCENT_OTHERS].add(this._getSelectedIds()),
    d[a.TRANSLUCENT_OTHERS].forceEnable()
  },
  this.cancelTranslucent = function() {
    this.clearIdList(n.TRANSLUCENT),
    this.clearIdList(n.TRANSLUCENT_OTHERS)
  },
  this._addIdsToFilter = function(t, e) {
    var i = a.IDFILTER_OFFSET + t;
    i >= a.IDFILTER_OFFSET && i <= a.IDFILTER_ENDOFFSET && d[i].add(e)
  },
  this.hideByIds = function(t) {
    this._addIdsToFilter(n.HIDDEN, t)
  },
  this.showByIds = function(t) {
    this._addIdsToFilter(n.VISIBLE, t)
  },
  this.makeTranslucentByIds = function(t) {
    this._addIdsToFilter(n.TRANSLUCENT, t)
  },
  this.makeTranslucentOthersByIds = function(t) {
    this._addIdsToFilter(n.TRANSLUCENT_OTHERS, t)
  },
  this._isVisible = function(t) {
    return this.getSceneState() !== o.HIDDEN && s.apply(t)
  },
  this._isSelectable = function(t) {
    return this.getSceneState() !== o.TRANSLUCENT && h.apply(t, this.getSceneState())
  },
  this._getOverrideMaterial = function(t) {
    if (this.getSceneState() === o.TRANSLUCENT)
      return f.get("scene");
    var e = !0,
      i = l.getApplyFilterId(t),
      n = null,
      r = "";
    switch (i) {
      case a.ISOLATE_TRANSLUCENT:
      case a.ISOLATE_TRANSLUCENT_OTHERS:
      case a.ISOLATE_CONDITION_TRANSLUCENT_OTHERS:
        n = this.getIsolateMaterial(),
        e = !1;
        break;
      case a.CONDITION_TRANSLUCENT_OTHERS:
      case a.TRANSLUCENT:
      case a.TRANSLUCENT_OTHERS:
        n = f.get("scene"),
        e = !1;
        break;
      case a.SELECTED:
        n = f.get("selection");
        break;
      case a.OVERRIDEFILTER:
        r = d[a.OVERRIDEFILTER].getMatchItem(t);
        break;
      case a.USER_OVERRIDE:
        var s = d[a.USER_OVERRIDE].getMatchItem(t);
        r = s.color
          ? f.getMaterialNameByColor(s)
          : s.material
            ? s.material
            : s;
        break;
      case a.CONDITION_OVERRIDE:
        s = d[a.CONDITION_OVERRIDE].getMatchItem(t),
        r = s.color
          ? f.getMaterialNameByColor(s.color)
          : s.material;
        break;
      case a.FROZENFILTER:
      case a.FROZENCONDITIONFILTER:
        e = !1
    }
    return n || "" === r || (f.has(r) || (r = f.getDefaultMaterialName()), n = f.get(r)),
    m && m === t.name && e && (n = f.getHoverMaterial(n || null)),
    n
  },
  this._hasHighPriorityOverrideMaterial = function(t) {
    return !(!m || m !== t.name) || c.apply(t)
  },
  this._isHiddenFileId = function(t) {
    return u.apply(t)
  },
  this._hasHiddenFileIdFilter = function() {
    return !u.isEmpty()
  },
  this._hasVisibleFilter = function() {
    return this.getSceneState() === o.HIDDEN || !s.isEmpty()
  },
  this._hasSelectableFilter = function() {
    return this.getSceneState() === o.TRANSLUCENT || !h.isEmpty()
  },
  this._hasOverrideMaterialFilter = function() {
    return this.getSceneState() === o.TRANSLUCENT || void 0 !== m || !l.isEmpty()
  },
  this._hasLowPriorityOverride = function() {
    return !l.isEmpty() && l.hasFilterNotIn(c)
  },
  this._isEmptySelections = function() {
    return t.isEmpty()
  },
  this._setHoverMaterial = function(t) {
    f.setHoverMaterial(t)
  },
  this._setHoverId = function(t) {
    m = t
  },
  this._clearHoverId = function() {
    m = void 0
  },
  this._getSelectedIds = function() {
    var e = t.get(),
      i = [];
    for (var n in e)
      i.push(n);
    return i
  },
  this._getSelected = function() {
    return t.get()
  },
  this._getFilterType = function() {
    return a
  }
},
CLOUD.BasicFilter = function(t) {
  this._type = t,
  this._enabled = !1,
  this._items = {},
  this._relatedCompoundFilterList = []
},
CLOUD.BasicFilter.prototype.getType = function() {
  return this._type
},
CLOUD.BasicFilter.prototype.get = function() {
  return this._items
},
CLOUD.BasicFilter.prototype.getAll = function() {
  return this._items
},
CLOUD.BasicFilter.prototype.clearAll = function() {
  var t = this;
  t._items = {},
  t._enabled && (t._enabled = !1, t.enableStateChanged())
},
CLOUD.BasicFilter.prototype.clear = function() {
  this.clearAll()
},
CLOUD.BasicFilter.prototype.isEmpty = function() {
  return !this._enabled
},
CLOUD.BasicFilter.prototype.forceEnable = function() {
  this._enabled || (this._enabled = !0, this.enableStateChanged())
},
CLOUD.BasicFilter.prototype.setByData = function(t) {
  var e = this;
  !function(t) {
    if (null == t)
      return !0;
    if ("object" !== (
      void 0 === t
      ? "undefined"
      : _typeof(t)))
      return !0;
    for (var e in t)
      if (t.hasOwnProperty(e))
        return !1;
  return !0
  }(t)
    ? (e._items = t, e._enabled || (e._enabled = !0, e.enableStateChanged()))
    : (e._items = {}, e._enabled && (e._enabled = !1, e.enableStateChanged()))
},
CLOUD.BasicFilter.prototype.match = function(t) {
  return !1
},
CLOUD.BasicFilter.prototype.registerToCompoundFilter = function(t) {
  this._relatedCompoundFilterList.push(t)
},
CLOUD.BasicFilter.prototype.enableStateChanged = function() {
  for (var t = this, e = 0, i = t._relatedCompoundFilterList.length; e < i; e++)
    t._enabled
      ? t._relatedCompoundFilterList[e].addBaseFilter(t)
      : t._relatedCompoundFilterList[e].removeBaseFilter(t)
  },
CLOUD.BasicIdFilter = function(t) {
  CLOUD.BasicFilter.call(this, t)
},
CLOUD.BasicIdFilter.prototype = Object.create(CLOUD.BasicFilter.prototype),
CLOUD.BasicIdFilter.prototype.constructor = CLOUD.BasicIdFilter,
CLOUD.BasicIdFilter.prototype.add = function(t) {
  var e = this,
    i = e._items;
  if (t && t.length > 0) {
    for (var n = 0, o = t.length; n < o; ++n)
      i[t[n]] = !0;
    e._enabled || (e._enabled = !0, e.enableStateChanged())
  }
},
CLOUD.BasicIdFilter.prototype.remove = function(t) {
  var e = this,
    i = e._items;
  if (t && t.length > 0) {
    for (var n = 0, o = t.length; n < o; ++n) {
      var r = t[n];
      i.hasOwnProperty(r) && delete i[r]
    }
    0 === i.length && e._enabled && (e._enabled = !1, e.enableStateChanged())
  }
},
CLOUD.ListFilter = function(t) {
  CLOUD.BasicFilter.call(this, t)
},
CLOUD.ListFilter.prototype = Object.create(CLOUD.BasicFilter.prototype),
CLOUD.ListFilter.prototype.constructor = CLOUD.ListFilter,
CLOUD.ListFilter.prototype.remove = function(t, e) {
  var i = this,
    n = i._items[t];
  if (n && e && e.length > 0) {
    for (var o = 0, r = e.length; o < r; ++o) {
      var a = e[o];
      n.hasOwnProperty(a) && delete n[a]
    }
    CLOUD.Utils.isEmptyObject(i._items) && i._enabled && (i._enabled = !1, i.enableStateChanged())
  }
},
CLOUD.ListFilter.prototype.add = function(t, e, i) {
  var n = this,
    o = n._items,
    r = o[t];
  if (e && e.length > 0) {
    void 0 === i && (i = !0),
    r || (r = o[t] = {});
    for (var a = 0, s = e.length; a < s; ++a)
      r[e[a]] = i;
    n._enabled || (n._enabled = !0, n.enableStateChanged())
  }
},
CLOUD.ListFilter.prototype.clear = function(t) {
  var e = this,
    i = e._items;
  i.hasOwnProperty(t) && (delete i[t], CLOUD.Utils.isEmptyObject(i) && e._enabled && (e._enabled = !1, e.enableStateChanged()))
},
CLOUD.UserListFilter = function(t) {
  CLOUD.BasicFilter.call(this, t)
},
CLOUD.UserListFilter.prototype = Object.create(CLOUD.ListFilter.prototype),
CLOUD.UserListFilter.prototype.constructor = CLOUD.UserListFilter,
CLOUD.UserListFilter.prototype.match = function(t) {
  return null !== this.getMatchItem(t)
},
CLOUD.UserListFilter.prototype.getMatchItem = function(t) {
  var e = this._items,
    i = t.userData;
  if (i)
    for (var n in e) {
      var o = e[n],
        r = i[n];
      if (r && void 0 !== o[r])
        return o[r]
    }
  return null
},
CLOUD.OverrideListFilter = function(t) {
  CLOUD.BasicFilter.call(this, t)
},
CLOUD.OverrideListFilter.prototype = Object.create(CLOUD.ListFilter.prototype),
CLOUD.OverrideListFilter.prototype.constructor = CLOUD.OverrideListFilter,
CLOUD.OverrideListFilter.prototype.match = function(t) {
  return null !== this.getMatchItem(t)
},
CLOUD.OverrideListFilter.prototype.getMatchItem = function(t) {
  var e = this._items,
    i = t.name;
  for (var n in e) {
    var o = e[n];
    if (o[i])
      return o[i]
  }
  return null
},
CLOUD.ConditionFilter = function(t) {
  CLOUD.BasicFilter.call(this, t)
},
CLOUD.ConditionFilter.prototype = Object.create(CLOUD.BasicFilter.prototype),
CLOUD.ConditionFilter.prototype.constructor = CLOUD.ConditionFilter,
CLOUD.ConditionFilter.prototype.match = function(t) {
  var e = t.userData;
  return !(e && !function(t, e) {
    for (var i, n = 0, o = t.length; n < o; ++n) {
      i = !0;
      var r = t[n];
      for (var a in r)
        if (r[a] != e[a]) {
          i = !1;
          break
        }
      if (i)
        return !0
    }
    return !1
  }(this._items, e))
},
CLOUD.MultiConditionFilter = function(t) {
  CLOUD.BasicFilter.call(this, t)
},
CLOUD.MultiConditionFilter.prototype = Object.create(CLOUD.BasicFilter.prototype),
CLOUD.MultiConditionFilter.prototype.constructor = CLOUD.MultiConditionFilter,
CLOUD.MultiConditionFilter.prototype.match = function(t) {
  return null !== this.getMatchItem(t)
},
CLOUD.MultiConditionFilter.prototype.getMatchItem = function(t) {
  var e,
    i = this._items,
    n = t.userData;
  if (n)
    for (var o = i.length, r = 0; r < o; ++r) {
      var a = i[r],
        s = a.condition;
      e = !0;
      for (var l in s)
        if (s[l] != n[l]) {
          e = !1;
          break
        }
      if (e)
        return a
    }
  return null
},
CLOUD.FileIdFilter = function(t) {
  CLOUD.BasicIdFilter.call(this, t)
},
CLOUD.FileIdFilter.prototype = Object.create(CLOUD.BasicIdFilter.prototype),
CLOUD.FileIdFilter.prototype.constructor = CLOUD.FileIdFilter,
CLOUD.FileIdFilter.prototype.match = function(t) {
  var e = t.userData;
  if (e) {
    var i = e.sceneId;
    if (i)
      return !!this._items[i]
  }
  return !1
},
CLOUD.GeneralIdFilter = function(t) {
  CLOUD.BasicIdFilter.call(this, t)
},
CLOUD.GeneralIdFilter.prototype = Object.create(CLOUD.BasicIdFilter.prototype),
CLOUD.GeneralIdFilter.prototype.constructor = CLOUD.GeneralIdFilter,
CLOUD.GeneralIdFilter.prototype.match = function(t) {
  return !!this._items[t.name]
},
CLOUD.FilterResultMode = {
  MATCH_RETURN_TRUE: 0,
  MATCH_RETURN_FALSE: 1,
  NOMATCH_RETURN_TRUE: 2,
  NOMATCH_RETURN_FALSE: 3
},
CLOUD.CompoundFilter = function(t) {
  this._activeFilterList = [],
  this._filterResultModes = {},
  this._defaultRetValue = t,
  this._filterPriority = null
},
CLOUD.CompoundFilter.prototype.setFilterMode = function(t) {
  this._filterResultModes = t
},
CLOUD.CompoundFilter.prototype.setFilterPriority = function(t) {
  this._filterPriority = t
},
CLOUD.CompoundFilter.prototype.addBaseFilter = function(t) {
  var e = this._activeFilterList,
    i = e.indexOf(t);
  if (null === this._filterPriority)
    i === -1
      ? e.push(t)
      : i !== e.length - 1 && (e.splice(i, 1), e.push(t));
  else if (0 === e.length)
    e.push(t);
  else {
    i !== -1 && i !== e.length - 1 && e.splice(i, 1);
    for (var n = this._filterPriority[t.getType()], o = 0, r = e.length; o < r; o++)
      if (this._filterPriority[e[o].getType()] > n) {
        e.splice(o, 0, t);
        break
      }
    o === r && e.push(t)
  }
},
CLOUD.CompoundFilter.prototype.removeBaseFilter = function(t) {
  var e = this._activeFilterList.indexOf(t);
  e !== -1 && this._activeFilterList.splice(e, 1)
},
CLOUD.CompoundFilter.prototype.isEmpty = function() {
  return 0 === this._activeFilterList.length
},
CLOUD.CompoundFilter.prototype.hasFilterNotIn = function(t) {
  for (var e = this._activeFilterList, i = e.length - 1; i >= 0; i--) {
    var n = e[i];
    if (void 0 === t._filterResultModes[n.getType()])
      return !0
  }
  return !1
},
CLOUD.CompoundFilter.prototype.apply = function(t) {
  for (var e, i = this, n = CLOUD.FilterResultMode, o = i._activeFilterList.length - 1; o >= 0; o--)
    switch (e = i._activeFilterList[o], i._filterResultModes[e.getType()]) {
      case n.MATCH_RETURN_TRUE:
        if (e.match(t))
          return !0;
        break;
      case n.MATCH_RETURN_FALSE:
        if (e.match(t))
          return !1;
        break;
      case n.NOMATCH_RETURN_TRUE:
        if (!e.match(t))
          return !0;
        break;
      case n.NOMATCH_RETURN_FALSE:
        if (!e.match(t))
          return !1
      }
  return i._defaultRetValue
},
CLOUD.CompoundFilter.prototype.getApplyFilterId = function(t) {
  for (var e, i = this, n = CLOUD.FilterResultMode, o = i._activeFilterList.length - 1; o >= 0; o--)
    switch (e = i._activeFilterList[o], i._filterResultModes[e.getType()]) {
      case n.MATCH_RETURN_TRUE:
      case n.MATCH_RETURN_FALSE:
        if (e.match(t))
          return e.getType();
        break;
      case n.NOMATCH_RETURN_TRUE:
      case n.NOMATCH_RETURN_FALSE:
        if (!e.match(t))
          return e.getType()
      }
  return -1
};
var CloudTouch = CloudTouch || {};
!function() {
  var t = {
      touchstart: 1,
      touchmove: 2,
      touchend: 4,
      touchcancel: 8
    },
    e = [
      "x", "y"
    ],
    i = [
      "clientX", "clientY"
    ],
    n = function(e, i) {
      var n = e,
        o = {
          pointers: i.touches,
          changedPointers: i.changedTouches,
          pointerType: "touch",
          srcEvent: i
        },
        r = i.touches.length,
        s = i.changedTouches.length,
        l = t[i.type],
        c = 1 & l && r - s == 0,
        h = 12 & l && r - s == 0;
      o.isFirst = !!c,
      o.isFinal = !!h,
      c && (n.session = {}),
      o.eventType = l,
      a(n, o),
      n.session.prevInput = o
    },
    o = function(t) {
      for (var e = [], i = 0; i < t.pointers.length;)
        e[i] = {
          clientX: Math.round(t.pointers[i].clientX),
          clientY: Math.round(t.pointers[i].clientY)
        }
      ,
      i++;
      return {
        timeStamp: Date.now(),
        pointers: e,
        center: r(e),
        deltaX: t.deltaX || 0,
        deltaY: t.deltaY || 0
      }
    },
    r = function(t) {
      var e = t.length;
      if (1 === e)
        return {
          x: Math.round(t[0].clientX),
          y: Math.round(t[0].clientY)
        };
      for (var i = 0, n = 0, o = 0; o < e;)
        i += t[o].clientX,
        n += t[o].clientY,
        o++;
      return {
        x: Math.round(i / e),
        y: Math.round(n / e)
      }
    },
    a = function(t, e) {
      var i = t.session,
        n = e.pointers,
        a = n.length;
      i.firstInput || (i.firstInput = o(e)),
      a > 1 && !i.firstMultiple
        ? i.firstMultiple = o(e)
        : 1 === a && (i.firstMultiple = !1);
      var p = i.firstInput,
        f = i.firstMultiple,
        m = f
          ? f.center
          : p.center,
        g = e.center = r(n);
      e.timeStamp = Date.now(),
      e.deltaTime = e.timeStamp - p.timeStamp,
      e.angle = h(m, g),
      e.distance = c(m, g),
      e.scale = f
        ? d(f.pointers, n)
        : 1,
      e.rotation = f
        ? u(f.pointers, n)
        : 0,
      s(i, e),
      e.offsetDirection = l(e.deltaX, e.deltaY),
      e.maxPointers = i.prevInput
        ? e.pointers.length > i.prevInput.maxPointers
          ? e.pointers.length
          : i.prevInput.maxPointers
        : e.pointers.length
    },
    s = function(t, e) {
      var i = e.center,
        n = t.offsetDelta || {},
        o = t.prevDelta || {},
        r = t.prevInput || {};
      1 !== e.eventType && 4 !== r.eventType || (o = t.prevDelta = {
        x: r.deltaX || 0,
        y: r.deltaY || 0
      }, n = t.offsetDelta = {
        x: i.x,
        y: i.y
      }),
      e.deltaX = o.x + (i.x - n.x),
      e.deltaY = o.y + (i.y - n.y),
      1 === e.eventType
        ? (e.relativeDeltaX = 0, e.relativeDeltaY = 0, e.relativeRotation = 0, e.relativeScale = 1, e.deltaAngle = 0)
        : (e.relativeDeltaX = i.x - r.center.x, e.relativeDeltaY = i.y - r.center.y, e.relativeRotation = e.rotation - r.rotation, e.relativeScale = e.scale / r.scale, e.deltaAngle = e.angle - r.angle)
    },
    l = function(t, e) {
      return t === e
        ? 1
        : Math.abs(t) >= Math.abs(e)
          ? t < 0
            ? 2
            : 4
          : e < 0
            ? 8
            : 16
    },
    c = function(t, i, n) {
      n || (n = e);
      var o = i[n[0]] - t[n[0]],
        r = i[n[1]] - t[n[1]];
      return Math.sqrt(o * o + r * r)
    },
    h = function(t, i, n) {
      n || (n = e);
      var o = i[n[0]] - t[n[0]],
        r = i[n[1]] - t[n[1]];
      return Math.atan2(r, o)
    },
    u = function(t, e) {
      return h(e[1], e[0], i) + h(t[1], t[0], i)
    },
    d = function(t, e) {
      return c(e[0], e[1], i) / c(t[0], t[1], i)
    };
  CloudTouch.proxy = {
    INPUT_START: 1,
    INPUT_MOVE: 2,
    INPUT_END: 4,
    INPUT_CANCEL: 8,
    DIRECTION_NONE: 1,
    DIRECTION_LEFT: 2,
    DIRECTION_RIGHT: 4,
    DIRECTION_UP: 8,
    DIRECTION_DOWN: 16,
    DIRECTION_HORIZONTAL: 6,
    DIRECTION_VERTICAL: 24,
    DIRECTION_ALL: 30,
    touchsHandler: n
  }
}(),
CLOUD.CameraControl = function(t, e, i, n) {
  function o() {
    return 2 * Math.PI / 60 / 60 * y.autoRotateSpeed
  }
  function r() {
    return Math.pow(.95, y.zoomSpeed)
  }
  function a() {
    var t = y.camera,
      e = t.position,
      i = y.camera.target.clone().sub(e);
    i.normalize();
    var n = new THREE.Plane;
    n.setFromNormalAndCoplanarPoint(i.clone().negate(), y.pivotBall.position),
    n.normalize();
    var o = n.distanceToPoint(e),
      r = o * Math.tan(.5 * t.fov),
      a = y.getContainerDimensions();
    return 2 * r / (a.height - a.top)
  }
  function s(t) {
    x.set(t.touches[0].clientX, t.touches[0].clientY)
  }
  function l(t) {
    var e = t.touches[0].clientX - t.touches[1].clientX,
      i = t.touches[0].clientY - t.touches[1].clientY;
    D.set(0, Math.sqrt(e * e + i * i))
  }
  function c(t) {
    var e = .5 * (t.touches[0].clientX + t.touches[1].clientX),
      i = .5 * (t.touches[0].clientY + t.touches[1].clientY);
    C.set(e, i)
  }
  function h(t) {
    b.set(t.touches[0].clientX, t.touches[0].clientY),
    w.subVectors(b, x);
    var e = y.domElement === document
      ? y.domElement.body
      : y.domElement;
    P -= 2 * Math.PI * w.x / e.clientWidth * y.rotateSpeed,
    I -= 2 * Math.PI * w.y / e.clientHeight * y.rotateSpeed,
    x.copy(b);
    var i = a();
    y.pivotBall.scale.set(i, i, i),
    y.pivotCenter.scale.set(i, i, i),
    y.pivotBall.updateMatrixWorld(),
    y.pivotCenter.updateMatrixWorld()
  }
  function u(t) {
    var e = t.touches[0].clientX - t.touches[1].clientX,
      i = t.touches[0].clientY - t.touches[1].clientY,
      n = Math.sqrt(e * e + i * i);
    R.set(0, n),
    U.subVectors(R, D),
    Math.abs(U.y) < 3 || (
      U.y > 0
      ? B /= r()
      : U.y < 0 && (B *= r()),
    D.copy(R),
    A.x = .5 * (t.touches[0].clientX + t.touches[1].clientX),
    A.y = .5 * (t.touches[0].clientY + t.touches[1].clientY),
    y.dolly())
  }
  function d(t) {
    var e = .5 * (t.touches[0].clientX + t.touches[1].clientX),
      i = .5 * (t.touches[0].clientY + t.touches[1].clientY);
    T.set(e, i),
    _.subVectors(T, C),
    Math.abs(_.x) < 3 && Math.abs(_.y) < 3 || (O = y.getWorldDimension(e, i), S.set(0, 0, 0), y.panOnWorld(), C.copy(T))
  }
  this.viewer = t,
  this.camera = e,
  this.domElement = i,
  this.intersector = new CLOUD.IntersectHelper(t.getFilters()),
  this.enabled = !0,
  this.pivot = null;
  var p = new THREE.SphereBufferGeometry(15, 64, 64);
  this.pivotBall = new THREE.Mesh(p, new THREE.MeshPhongMaterial({
    color: 16777215,
    depthTest: !1,
    opacity: .5,
    transparent: !0
  })),
  p = new THREE.SphereBufferGeometry(1, 64, 64),
  this.pivotCenter = new THREE.Mesh(p, new THREE.MeshPhongMaterial({
    color: 16711680,
    depthTest: !1,
    opacity: .5,
    transparent: !0
  })),
  this.movementSpeed = 8e-4 * CLOUD.GlobalData.SceneSize,
  this.defaultMovementSpeed = this.movementSpeed,
  this.minMovementSpeed = .01,
  this.minDollyDistance = 2,
  this.noZoom = !1,
  this.zoomSpeed = .2,
  this.minDistance = .1,
  this.maxDistance = e.far - 2 * CLOUD.GlobalData.SceneSize,
  this.defaultThroughOutDistance = .1,
  this.noRotate = !1,
  this.rotateSpeed = 1,
  this.noPan = !1,
  this.keyPanSpeed = 2,
  this.defaultKeyPanSpeed = this.keyPanSpeed,
  this.minKeyPanSpeed = .01,
  this.autoRotate = !0,
  this.autoRotateSpeed = 2,
  this.minPolarAngle = 0,
  this.maxPolarAngle = Math.PI,
  this.minAzimuthAngle = -1 / 0,
  this.maxAzimuthAngle = 1 / 0,
  this.enablePassThrough = !0,
  this.isDisableRotate = !1,
  this.noKeys = !1,
  this.keys = {
    ALT: 18,
    BACKSPACE: 8,
    LEFT: 37,
    UP: 38,
    RIGHT: 39,
    DOWN: 40,
    A: 65,
    D: 68,
    E: 69,
    Q: 81,
    S: 83,
    W: 87,
    PLUS: 187,
    SUB: 189,
    ZERO: 48,
    ESC: 27
  },
  this.isConstrainedAxisZ = !1;
  var f,
    m,
    g,
    v = new THREE.Vector3(0, 1, 0),
    y = this,
    E = 1e-6,
    x = new THREE.Vector2,
    b = new THREE.Vector2,
    w = new THREE.Vector2,
    C = new THREE.Vector2,
    T = new THREE.Vector2,
    _ = new THREE.Vector2,
    L = new THREE.Vector3,
    M = new THREE.Vector3,
    S = new THREE.Vector3,
    O = new THREE.Vector2,
    D = new THREE.Vector2,
    R = new THREE.Vector2,
    U = new THREE.Vector2,
    A = new THREE.Vector2,
    I = 0,
    P = 0,
    B = 1,
    N = new THREE.Vector3,
    k = new THREE.Quaternion,
    H = {
      NONE: -1,
      ROTATE: 0,
      DOLLY: 1,
      PAN: 2
    },
    F = H.NONE,
    G = CLOUD.PointRotateMode.MOUSEPOINT;
  this.setPointRotateMode = function(t) {
    G = t
  },
  this.getPointRotateMode = function() {
    return G
  },
  this.destroy = function() {
    this.viewer = null
  },
  this.IsIdle = function() {
    return F === H.NONE
  },
  this.getFrustum = function() {
    return this.camera.getFrustum()
  },
  this.getCamera = function() {
    return this.camera
  },
  this._handleRotation = function() {
    var t = this.camera,
      e = t.position,
      i = t.target,
      n = t.getWorldDirection(),
      o = i.clone().sub(e),
      r = o.length(),
      a = null,
      s = this.pivot,
      l = function(t) {
        var a,
          l,
          c,
          h = new THREE.Vector3;
        s
          ? (a = e.clone().sub(s), l = a.length(), a.normalize(), c = a.clone().applyQuaternion(t).normalize(), e.copy(s).add(c.multiplyScalar(l)), n.applyQuaternion(t).normalize(), h.copy(e).add(n.multiplyScalar(r)), i.copy(h))
          : (a = o.clone(), l = r, a.normalize(), c = a.clone().applyQuaternion(t).normalize(), h.copy(e).add(c.multiplyScalar(l)), i.copy(h))
      },
      c = t.realUp || t.up,
      h = n.clone().cross(c).normalize(),
      u = h.clone().cross(n).normalize();
    t.realUp.copy(u);
    var d;
    this.isConstrainedAxisZ
      ? Math.abs(P) > Math.abs(I) && (d = v, a = (new THREE.Quaternion).setFromAxisAngle(d, P), l(a), t.realUp.applyQuaternion(a).normalize())
      : Math.abs(P) > Math.abs(I)
        ? (d = t.up.clone().normalize(), a = (new THREE.Quaternion).setFromAxisAngle(d, P), l(a), t.realUp.applyQuaternion(a).normalize())
        : Math.abs(I) > .01 && (d = n.clone().cross(c).normalize(), a = (new THREE.Quaternion).setFromAxisAngle(d, I), l(a), t.realUp.applyQuaternion(a).normalize(), this.adjustCameraUp())
  },
  this.update = function() {
    return function(t, e) {
      var i = this.camera;
      F !== H.NONE && this.dirtyCamera(!0),
      this.isDisableRotate || F !== H.ROTATE || this._handleRotation(),
      F === H.PAN && (i.target.add(M), i.position.add(M));
      var o = new THREE.Vector3;
      o.copy(i.up),
      i.up.copy(i.realUp),
      i.lookAt(i.target),
      i.up.copy(o),
      i.updateMVP(),
      P = 0,
      I = 0,
      B = 1,
      M.set(0, 0, 0),
      t
        ? (void 0 !== e && this.needUpdateRenderList(e), n(), this.dirtyCamera(!1), N.copy(i.position), k.copy(i.quaternion))
        : (N.distanceToSquared(i.position) > E || 8 * (1 - k.dot(i.quaternion)) > E) && (n(), this.dirtyCamera(!1), N.copy(i.position), k.copy(i.quaternion))
    }
  }(),
  this.updateAuto = function() {
    var t = new THREE.Vector3,
      i = (new THREE.Quaternion).setFromUnitVectors(e.up, new THREE.Vector3(0, 1, 0)),
      o = i.clone().inverse(),
      r = new THREE.Vector3,
      a = new THREE.Quaternion;
    return function() {
      var e = this.camera.position;
      t.copy(e).sub(this.camera.target),
      t.applyQuaternion(i),
      f = Math.atan2(t.x, t.z),
      m = Math.atan2(Math.sqrt(t.x * t.x + t.z * t.z), t.y),
      f += P,
      m += I,
      f = Math.max(this.minAzimuthAngle, Math.min(this.maxAzimuthAngle, f)),
      m = Math.max(this.minPolarAngle, Math.min(this.maxPolarAngle, m)),
      m = Math.max(E, Math.min(Math.PI - E, m));
      var s = t.length() * B;
      return s = Math.max(this.minDistance, Math.min(this.maxDistance, s)),
      this.camera.target.add(L),
      t.x = s * Math.sin(m) * Math.sin(f),
      t.y = s * Math.cos(m),
      t.z = s * Math.sin(m) * Math.cos(f),
      t.applyQuaternion(o),
      e.copy(this.camera.target).add(t),
      this.camera.lookAt(this.camera.target),
      P = 0,
      I = 0,
      B = 1,
      L.set(0, 0, 0),
      r.copy(this.camera.position),
      a.copy(this.camera.quaternion),
      n(),
      !0
    }
  }(),
  this.lockAxisZ = function(t) {
    this.isConstrainedAxisZ = t
  },
  this.updateView = function(t) {
    void 0 !== t && this.needUpdateRenderList(t),
    n()
  },
  this.needUpdateRenderList = function(t) {
    this.viewer.editorManager.isUpdateRenderList = t
  },
  this.disableRotate = function(t) {
    this.isDisableRotate = t
  },
  this.rotateLeft = function(t) {
    void 0 === t && (t = o()),
    P -= t
  },
  this.rotateUp = function(t) {
    void 0 === t && (t = o()),
    I -= t
  },
  this.pan = function(t, e) {
    function i(t) {
      var e = y.camera.matrix.elements;
      r.set(e[0], e[1], e[2]),
      r.multiplyScalar(-t),
      y.camera.target.add(r),
      y.camera.position.add(r)
    }
    function n(t) {
      var e = y.camera.matrix.elements;
      r.set(e[4], e[5], e[6]),
      r.multiplyScalar(t),
      y.camera.target.add(r),
      y.camera.position.add(r)
    }
    var o = y.domElement === document
        ? y.domElement.body
        : y.domElement,
      r = new THREE.Vector3;
    if (void 0 !== y.camera.fov) {
      var a = y.camera.position,
        s = a.clone().sub(y.camera.target).length();
      s *= Math.tan(y.camera.fov / 2 * Math.PI / 180),
      i(2 * t * s / o.clientHeight),
      n(2 * e * s / o.clientHeight)
    } else
      void 0 !== y.camera.top
        ? (i(t * (y.camera.right - y.camera.left) / o.clientWidth), n(e * (y.camera.top - y.camera.bottom) / o.clientHeight))
        : CLOUD.Logger.warn("WARNING: CloudPickEditor.js encountered an unknown camera type - pan disabled.")
    },
  this.panOnWorld = function() {
    var t = new THREE.Vector3,
      e = new THREE.Vector3,
      i = new THREE.Vector3;
    return function() {
      var n = this.getContainerDimensions(),
        o = C.x - n.left,
        r = C.y - n.top;
      t.x = o / n.width,
      t.y = r / n.height,
      o = T.x - n.left,
      r = T.y - n.top,
      e.x = o / n.width,
      e.y = r / n.height,
      i.subVectors(e, t);
      var a = -i.x * O.x,
        s = i.y * O.y,
        l = this.getWorldRight().multiplyScalar(a),
        c = this.getWorldUp().multiplyScalar(s);
      S.addVectors(l, c),
      M.add(S)
    }
  }(),
  this.dolly = function() {
    var t = new THREE.Vector2(A.x, A.y),
      e = this.getIntersectContext(t),
      i = this.intersector.hitTest(e);
    if (null != i) {
      if (Math.abs(B - 1) < E)
        return;
      var n = this.camera.position,
        o = this.getWorldEye(),
        r = new THREE.Vector3;
      r.subVectors(i, n);
      var a = r.multiplyScalar(B - 1).length(),
        s = new THREE.Vector3;
      Math.abs(a) < this.minDollyDistance
        ? s.addVectors(n, r.normalize().multiplyScalar(this.minDollyDistance))
        : s.addVectors(n, r),
      this.camera.position.copy(s),
      this.camera.target.copy(o.add(s))
    } else
      y.dollyByCenter()
  },
  this.dollyIn = function(t) {
    void 0 === t && (t = r()),
    B /= t
  },
  this.dollyOut = function(t) {
    void 0 === t && (t = r()),
    B *= t
  },
  this.dollyByPoint = function(t, e) {
    if (!(Math.abs(B - 1) < E)) {
      var i = (this.minDollyDistance, this.camera.position),
        n = this.getWorldEye(),
        o = this.getTrackingPoint(t, e),
        r = new THREE.Vector3;
      r.subVectors(o, i);
      var a = r.multiplyScalar(B - 1).length(),
        s = new THREE.Vector3;
      Math.abs(a) < this.minDollyDistance
        ? s.addVectors(i, r.normalize().multiplyScalar(this.minDollyDistance))
        : s.addVectors(i, r),
      this.camera.position.copy(s),
      this.camera.target.copy(n.add(s))
    }
  },
  this.dollyByCenter = function() {
    if (!(Math.abs(B - 1) < E)) {
      var t = this.getWorldEye(),
        e = t.length(),
        i = e * B,
        n = i - e,
        o = t.clone().normalize();
      o.multiplyScalar(n),
      this.camera.position.add(o),
      this.camera.target.addVectors(this.camera.position, t)
    }
  },
  this.updateCamera = function(t, e) {
    this.dirtyCamera(!0),
    N.copy(this.camera.position),
    k.copy(this.camera.quaternion),
    this.camera.target.copy(t),
    e || y.reset()
  },
  this.dirtyCamera = function(t) {
    this.camera.dirty = t
  },
  this.modelView = function(t, e) {
    F !== H.NONE && this.dirtyCamera(!0);
    var i = null !== this.pivot
        ? this.pivot
        : this.viewer.getScene().getBoundingBox().getCenter(),
      n = this;
    if (F == H.ROTATE) {
      var o = this.camera.position,
        r = this.camera.target.clone().sub(o),
        s = r.length(),
        l = o.clone().sub(i),
        c = l.length(),
        h = null,
        u = this.camera.getWorldDirection();
      l.normalize();
      var d = function(t) {
          var e = new THREE.Vector3,
            r = l.clone().applyQuaternion(t).normalize();
          o.copy(i).add(r.multiplyScalar(c)),
          u.applyQuaternion(t).normalize(),
          e.copy(o).add(u.multiplyScalar(s)),
          n.camera.target.copy(e)
        },
        p = this.camera.realUp || this.camera.up,
        f = u.clone().cross(p).normalize(),
        m = f.clone().cross(u).normalize();
      this.camera.realUp.copy(m);
      var g;
      if (this.isConstrainedAxisZ)
        Math.abs(P) > Math.abs(I) && (g = v, h = (new THREE.Quaternion).setFromAxisAngle(g, P), d(h), this.camera.realUp.applyQuaternion(h).normalize());
      else if (Math.abs(P) > Math.abs(I))
        g = this.camera.up.clone().normalize(),
        h = (new THREE.Quaternion).setFromAxisAngle(g, P),
        d(h),
        this.camera.realUp.applyQuaternion(h).normalize();
      else if (Math.abs(I) > .01) {
        g = u.clone().cross(p).normalize();
        var y = new THREE.Vector3(0, 1, 0).clone().cross(p),
          E = y.dot(f),
          x = Math.asin(y.length());
        E < 0 && (x = -x),
        x + I > Math.PI / 2 - 1e-6
          ? I = Math.PI / 2 - 1e-6 - x
          : x + I < -Math.PI / 2 + 1e-6 && (I = -Math.PI / 2 + 1e-6 - x),
        h = (new THREE.Quaternion).setFromAxisAngle(g, I),
        d(h),
        this.camera.realUp.applyQuaternion(h).normalize(),
        this.adjustCameraUp()
      }
      if (null != n.pivot) {
        n.pivotBall.position.copy(n.pivot),
        n.pivotCenter.position.copy(n.pivot);
        var b = a();
        n.pivotBall.scale.set(b, b, b),
        n.pivotCenter.scale.set(b, b, b)
      } else {
        var w = n.viewer.getScene(),
          C = w.getBoundingBox().getCenter();
        n.pivotBall.position.copy(C),
        n.pivotCenter.position.copy(C);
        var b = a();
        n.pivotBall.scale.set(b, b, b),
        n.pivotCenter.scale.set(b, b, b)
      }
      n.pivotBall.updateMatrixWorld(),
      n.viewer.getScene().add(n.pivotBall),
      n.pivotCenter.updateMatrixWorld(),
      n.viewer.getScene().add(n.pivotCenter)
    }
  },
  this.getScene = function() {
    return this.viewer.getScene()
  },
  this.personView = function(t, e) {
    F !== H.NONE && this.dirtyCamera(!0);
    var i = this;
    if (F == H.ROTATE) {
      var n = this.camera.position,
        o = this.camera.target.clone().sub(n),
        r = o.length(),
        a = this.camera.getWorldDirection(),
        s = this.camera.realUp || this.camera.up,
        l = a.clone().cross(s).normalize(),
        c = l.clone().cross(a).normalize();
      this.camera.realUp.copy(c);
      var h,
        u;
      if (Math.abs(P) > Math.abs(I))
        h = v,
        u = P;
      else if (!this.isConstrainedAxisZ) {
        h = l;
        var d = new THREE.Vector3(0, 1, 0).clone().cross(s),
          p = d.dot(l),
          f = Math.asin(d.length());
        p < 0 && (f = -f),
        f + I > Math.PI / 4 - E
          ? I = Math.PI / 4 - E - f
          : f + I < -Math.PI / 4 + E && (I = -Math.PI / 4 + E - f),
        u = I
      }
      var m = (new THREE.Quaternion).setFromAxisAngle(h, u);
      !function(t) {
        var e = new THREE.Vector3;
        a.applyQuaternion(t).normalize(),
        e.copy(n).add(a.multiplyScalar(r)),
        i.camera.target.copy(e)
      }(m),
      this.camera.realUp.applyQuaternion(m).normalize()
    }
  },
  this.touchUpdate = function() {
    var t = new THREE.Vector3,
      e = new THREE.Quaternion;
    return function(i, o) {
      var r = this.camera.position;
      this.viewer.getScene().getBoundingBox().containsPoint(r)
        ? this.personView(i, o)
        : this.modelView(i, o),
      this.camera.target.add(M),
      this.camera.position.add(M);
      var a = new THREE.Vector3;
      a.copy(this.camera.up),
      this.camera.up.copy(this.camera.realUp),
      this.camera.lookAt(this.camera.target),
      this.camera.up.copy(a),
      this.camera.updateMVP(),
      P = 0,
      I = 0,
      B = 1,
      M.set(0, 0, 0),
      i
        ? (void 0 !== o && this.needUpdateRenderList(o), n(), this.dirtyCamera(!1), t.copy(this.camera.position), e.copy(this.camera.quaternion))
        : (t.distanceToSquared(this.camera.position) > E || 8 * (1 - e.dot(this.camera.quaternion)) > E) && (n(), this.dirtyCamera(!1), t.copy(this.camera.position), e.copy(this.camera.quaternion))
    }
  }(),
  this.setState = function(t) {
    F = t
  },
  this.reset = function() {
    F = H.NONE,
    this.update(!0)
  },
  this.beginRotate = function(t, e) {
    y.noRotate !== !0 && (F = H.ROTATE, x.set(t, e), g = null)
  },
  this.beginZoom = function(t, e) {
    y.noZoom !== !0 && (F = H.DOLLY, D.set(t, e))
  },
  this.beginPan = function(t, e) {
    y.noPan !== !0 && (F = H.PAN, C.set(t, e), O = this.getWorldDimension(t, e), S.set(0, 0, 0))
  },
  this.endOperation = function() {
    F = H.NONE,
    this.intersector.lastIntersect = null,
    this.pivot = null
  },
  this.zoom = function(t, e, i) {
    F = H.DOLLY,
    void 0 === e || void 0 === i
      ? (
        t > 0
        ? this.dollyIn(1 - t)
        : this.dollyOut(1 + t),
      this.dollyByCenter(),
      this.update())
      : (
        t > 0
        ? this.dollyIn(1 - t)
        : this.dollyOut(1 + t),
      this.dollyByPoint(e, i),
      this.update()),
    F = H.NONE
  },
  this.fly = function(t, e) {
    this.camera.translateX(t.x),
    this.camera.translateY(t.y),
    this.camera.translateZ(t.z),
    this.camera.quaternion.multiply(e),
    this.camera.rotation.setFromQuaternion(this.camera.quaternion, this.camera.rotation.order),
    this.camera.target.copy(this.camera.position).add(this.camera.getWorldDirection()),
    n()
  },
  this.flyOnWorld = function() {
    var t = this.camera.up.clone();
    this.camera.realUp && this.camera.up.copy(this.camera.realUp),
    this.camera.lookAt(this.camera.target),
    this.camera.realUp && this.camera.up.copy(t),
    n()
  },
  this.walkWithParallelEye = function(t) {
    var e = this.camera,
      i = this.getWorldEye(),
      n = i.length(),
      o = new THREE.Vector3;
    o.subVectors(t, e.position);
    var r = o.length();
    o.y = 0,
    o.normalize(),
    o.multiplyScalar(r),
    e.position.subVectors(t, o),
    e.target.addVectors(e.position, o.normalize().multiplyScalar(n));
    var a = new THREE.Vector3(0, 1, 0);
    e.up.copy(a),
    e.realUp.copy(a),
    F = H.NONE,
    this.update(!0)
  },
  this.processRotate = function(t) {
    var e = F;
    F = H.ROTATE;
    var i = y.domElement === document
      ? y.domElement.body
      : y.domElement;
    y.rotateLeft(2 * Math.PI * t.x / i.clientWidth * y.rotateSpeed),
    y.rotateUp(2 * Math.PI * t.y / i.clientHeight * y.rotateSpeed),
    y.update(),
    F = e
  },
  this.process = function(t, e, i) {
    var n = y.domElement === document
      ? y.domElement.body
      : y.domElement;
    if (F === H.ROTATE) {
      if (y.noRotate === !0)
        return;
      if (b.set(t, e), w.subVectors(b, x), 0 == w.x && 0 == w.y)
        return;
      y.rotateLeft(2 * Math.PI * w.x / n.clientWidth * y.rotateSpeed),
      y.rotateUp(2 * Math.PI * w.y / n.clientHeight * y.rotateSpeed),
      x.copy(b)
    } else if (F === H.DOLLY) {
      if (y.noZoom === !0)
        return;
      if (R.set(t, e), U.subVectors(R, D), 0 == U.x && 0 == U.y)
        return;
      U.y > 0
        ? y.dollyOut()
        : y.dollyIn(),
      y.dollyByCenter(),
      D.copy(R)
    } else if (F === H.PAN) {
      if (y.noPan === !0)
        return;
      if (T.set(t, e), _.subVectors(T, C), 0 == _.x && 0 == _.y)
        return;
      y.panOnWorld(),
      C.copy(T)
    }
    F !== H.NONE && y.update(i)
  },
  this.processTouch = function(t, e) {
    if (t.pointers.length > 1) {
      if (y.noRotate !== !0) {
        F = H.ROTATE;
        var i = y.domElement === document
            ? y.domElement.body
            : y.domElement,
          n = .5 * Math.PI / 180;
        t.deltaAngle < n && t.deltaAngle > -n
          ? I += 2 * Math.PI * t.relativeDeltaY / i.clientWidth * y.rotateSpeed
          : P += t.relativeRotation
      }
      y.noZoom !== !0 && (F = H.DOLLY, B /= t.relativeScale)
    } else if (y.noPan !== !0) {
      F = H.PAN;
      var o = t.relativeDeltaX,
        r = t.relativeDeltaY;
      y.pan(o, r)
    }
    F !== H.NONE && y.update(e)
  },
  this.getContainerDimensions = function() {
    return CLOUD.DomUtil.getContainerOffsetToClient(this.domElement)
  },
  this.computeFrustum = function() {
    var t = new THREE.Matrix4,
      e = new THREE.Matrix4;
    return function(i, n, o, r, a, s) {
      var l = this.camera,
        c = l.near * Math.tan(THREE.Math.degToRad(.5 * l.fov)),
        h = c * l.aspect,
        u = (i - s.left) / s.width * 2 - 1,
        d = (n - s.left) / s.width * 2 - 1,
        p = -(o - s.top) / s.height * 2 + 1,
        f = -(r - s.top) / s.height * 2 + 1;
      t.makePerspective(u * h, d * h, p * c, f * c, l.near, l.far),
      l.updateMatrixWorld(),
      l.matrixWorldInverse.getInverse(l.matrixWorld),
      e.multiplyMatrices(t, l.matrixWorldInverse),
      a.setFromMatrix(e)
    }
  }(),
  this.screenToCanvas = function(t, e) {
    var i = this.getContainerDimensions();
    return {
      x: t - i.left,
      y: e - i.top
    }
  },
  this.mapScreenToLocal = function(t, e, i) {
    var n = this.getContainerDimensions();
    i.set(t - n.left, n.height - (e - n.top))
  },
  this.mapWindowToViewport = function(t, e, i) {
    var n = this.getContainerDimensions(),
      o = i || new THREE.Vector2;
    return o.x = (t - n.left) / n.width * 2 - 1,
    o.y = -(e - n.top) / n.height * 2 + 1,
    o
  },
  this.getCameraInfo = function() {
    var t = new CLOUD.CameraInfo(this.camera.position, this.camera.target, this.camera.up);
    return JSON.stringify(t)
  },
  this.isKeepZoom = function(t, e, i) {
    void 0 === e && (e = this.minDistance),
    void 0 === i && (i = this.maxDistance);
    var n = this.camera.position,
      o = this.camera.target,
      r = new THREE.Vector3;
    r.copy(n).sub(o);
    var a = r.length() * (2 - t);
    return !(a < e || a > i)
  },
  this.computeRotation = function() {
    var t = new THREE.Matrix4;
    t.lookAt(this.camera.position, this.camera.target, this.camera.up);
    var e = new THREE.Quaternion;
    e.setFromRotationMatrix(t);
    var i = new THREE.Euler;
    return i.setFromQuaternion(e, void 0, !1),
    i
  },
  this.adjustCameraUp = function() {
    this.camera.realUp.y > 0
      ? this.camera.up = new THREE.Vector3(0, 1, 0)
      : this.camera.realUp.y < 0
        ? this.camera.up = new THREE.Vector3(0, -1, 0)
        : this.camera.realUp.x > 0
          ? this.camera.up = new THREE.Vector3(1, 0, 0)
          : this.camera.realUp.x < 0
            ? this.camera.up = new THREE.Vector3(-1, 0, 0)
            : this.camera.realUp.z > 0
              ? this.camera.up = new THREE.Vector3(0, 0, 1)
              : this.camera.realUp.z < 0 && (this.camera.up = new THREE.Vector3(0, 0, -1))
  },
  this.getWorldEye = function() {
    return this.camera.target.clone().sub(this.camera.position)
  },
  this.getWorldRight = function() {
    var t = new THREE.Vector3,
      e = this.camera.up,
      i = this.getWorldEye();
    return t.crossVectors(i, e),
    0 === t.lengthSq() && (
      e.z > e.y
      ? i.y -= 1e-4
      : i.z += 1e-4,
    t.crossVectors(i, e)),
    t.normalize()
  },
  this.getWorldUp = function() {
    var t = this.getWorldRight(),
      e = this.getWorldEye();
    return t.cross(e).normalize()
  },
  this.getWorldDimension = function(t, e) {
    var i = this.camera.position,
      n = this.getWorldEye().normalize(),
      o = this.getTrackingPoint(t, e),
      r = o.clone().sub(i),
      a = Math.abs(n.dot(r)),
      s = this.getContainerDimensions(),
      l = s.width / s.height,
      c = 2 * a * Math.tan(THREE.Math.degToRad(.5 * this.camera.fov)),
      h = c * l;
    return new THREE.Vector2(h, c)
  },
  this.pointToWorld = function(t, i) {
    var n = new THREE.Vector3(t, i, 0);
    return n.unproject(e),
    n
  },
  this.getTrackingPoint = function(t, e) {
    var i = new THREE.Vector2(t, e),
      n = this.getIntersectContext(i),
      o = this.intersector.hitTest(n);
    if (!o) {
      var r = n.mouse,
        a = this.camera.position,
        s = this.getWorldEye().normalize(),
        l = this.pointToWorld(r.x, r.y),
        c = new THREE.Ray;
      if (c.origin.copy(a), c.direction.copy(l.clone().sub(a).normalize()), g) {
        var h = new THREE.Plane;
        if (h.setFromNormalAndCoplanarPoint(s, g), o = c.intersectPlane(h)) {
          o.distanceTo(a) < E && (o = this.getTrackingPointFromBoundingBox(s, c))
        } else
          o = this.getTrackingPointFromBoundingBox(s, c)
      } else
        o = this.getTrackingPointFromBoundingBox(s, c);
      o || (CLOUD.Logger.log("tracking point is default!"), o = l)
    }
    return g = o.clone(),
    o
  },
  this.getTrackingPointFromBoundingBox = function(t, e) {
    return this.viewer.getScene().getTrackingPointFromBoundingBox(t, e)
  },
  this.updateCameraPosition = function(t) {
    var e = this.getWorldEye(),
      i = e.length(),
      n = e.clone();
    n.y = 0,
    n.normalize(),
    n.setLength(i);
    var o = new THREE.Vector3(0, 1, 0);
    this.camera.up = o,
    this.camera.realUp = o.clone(),
    this.camera.position.copy(t),
    this.camera.target.addVectors(this.camera.position, n)
  },
  this.flyToPointWithParallelEye = function(t) {
    var e = this.getWorldEye(),
      i = e.length(),
      n = e.clone();
    n.y = 0,
    n.normalize(),
    n.setLength(i);
    var o = new THREE.Vector3(0, 1, 0);
    this.camera.up = o,
    this.camera.realUp = o.clone(),
    this.camera.position.copy(t),
    this.camera.target.addVectors(this.camera.position, n),
    this.update(!0)
  },
  this.flyToPoint = function(t) {
    var e = this.camera.position,
      i = this.getWorldEye(),
      n = i.clone().normalize(),
      o = t.clone().sub(e),
      r = Math.abs(n.dot(o)),
      a = n.clone().multiplyScalar(r);
    this.camera.position.subVectors(t, a),
    this.camera.target.addVectors(this.camera.position, i),
    this.update(!0)
  },
  this.moveBackward = function(t, e) {
    var i = this.camera.position,
      n = this.camera.target;
    if (e) {
      var o = new THREE.Vector3(n.x - i.x, 0, n.z - i.z),
        r = o.length(),
        a = t / r,
        s = new THREE.Vector3(-o.x * a, 0, -o.z * a);
      i.add(s),
      n.add(s)
    } else {
      var l = n.clone().sub(i);
      this.camera.translateZ(t),
      n.addVectors(i, l)
    }
  },
  this.moveForward = function(t, e) {
    var i = this.camera.position,
      n = this.camera.target;
    if (e) {
      var o = new THREE.Vector3(n.x - i.x, 0, n.z - i.z),
        r = o.length(),
        a = t / r,
        s = new THREE.Vector3(o.x * a, 0, o.z * a);
      i.add(s),
      n.add(s)
    } else {
      var l = n.clone().sub(i);
      this.camera.translateZ(-t),
      n.addVectors(i, l)
    }
  },
  this.getIntersectContext = function(t) {
    var e = new CLOUD.IntersectContext,
      i = this;
    return e.scene = i.viewer.getScene(),
    e.camera = this.camera,
    i.mapWindowToViewport(t.x, t.y, e.mouse),
    e.octreeRoots = i.viewer.modelManager.getOctreeRoots(),
    e.octantMap = i.viewer.modelManager.octantToObjectMap,
    e
  },
  this.getLastIntersect = function() {
    return this.intersector.lastIntersect
  },
  this._calcPivotByMouse = function(t) {
    var e = this,
      i = e.getIntersectContext(t),
      n = e.intersector.hitTest(i);
    if (n)
      e.pivot = n;
    else {
      var o = e.viewer.getScene();
      e.pivot = o.getBoundingBox().getCenter()
    }
  },
  this.updatePivot = function(t) {
    var e = this,
      i = this.viewer,
      n = i.getScene();
    switch (this.getPointRotateMode()) {
      case CLOUD.PointRotateMode.SELECTION:
        var o = i.renderer.computeSelectionBBox();
        null == o || o.isEmpty()
          ? e._calcPivotByMouse(t)
          : this.pivot = o.getCenter(this.pivot);
        break;
      case CLOUD.PointRotateMode.CENTER:
        this.pivot = n.getBoundingBox().getCenter();
        break;
      case CLOUD.PointRotateMode.CAMERA:
        this.pivot = null;
        break;
      default:
        this._calcPivotByMouse(t)
    }
  },
  this.touchStartHandler = function(t) {
    switch (t.touches.length) {
      case 1:
        if (this.noRotate === !0)
          return;
        s(t),
        F = H.ROTATE;
        break;
      case 2:
        this.noZoom !== !0 && l(t),
        this.noPan !== !0 && c(t);
        break;
      default:
        F = H.NONE
    }
  },
  this.touchMoveHandler = function(t) {
    switch (this.viewer.editorManager.cameraChange = !0, t.touches.length) {
      case 1:
        this.noRotate !== !0 && h(t);
        break;
      case 2:
        this.viewer.getScene().remove(this.pivotBall),
        this.viewer.getScene().remove(this.pivotCenter),
        this.noZoom !== !0 && (u(t), F = H.DOLLY),
        this.noPan !== !0 && (d(t), F = H.PAN);
        break;
      default:
        F = H.NONE
    }
    this.touchUpdate()
  },
  this.touchEndHandler = function(t) {
    this.viewer.editorManager.cameraChange = !1,
    F = H.NONE,
    this.viewer.getScene().remove(this.pivotBall),
    this.viewer.getScene().remove(this.pivotCenter),
    this.touchUpdate()
  },
  this.fitAndRotateBySelection = function() {
    var t = this.viewer;
    t.setPointRotateMode(CLOUD.PointRotateMode.SELECTION),
    t.zoomToSelection()
  },
  this.setRoamingWalkAbsoluteHeight = function(t) {},
  this.setRoamingWalkHeight = function(t, e) {
    if (!(t instanceof Array))
      return void console.log("elevations is not arry");
    void 0 === this.roamingWalkHeight
      ? this.roamingWalkHeight = []
      : this.roamingWalkHeight.length = 0;
    for (var i = 0, n = t.length; i < n; ++i)
      this.roamingWalkHeight[i] = t[i] + e
  },
  this.updateRoamingWalkState = function() {
    if (this.roamingWalkHeight) {
      var t = this.getCamera(),
        e = this.viewer.getScene(),
        i = t.position.y;
      if (this.lastCameraHeight !== i) {
        var n = e.drawingToWorld(t.position),
          o = CLOUD.Utils.findRange(this.roamingWalkHeight, n.z),
          r = this.roamingWalkHeight[o],
          a = e.worldToDrawing({x: n.x, y: n.y, z: r});
        this.updateCameraPosition(a),
        this.lastCameraHeight = a.y
      }
    }
  }
},
CLOUD.IntersectHelper = function(t) {
  this.raycaster = new CLOUD.Raycaster,
  this.filter = t,
  this.lastIntersect = null
},
CLOUD.IntersectHelper.prototype.destroy = function() {
  this.raycaster = null,
  this.lastIntersect = null
},
CLOUD.IntersectContext = function() {
  this.scene = null,
  this.camera = null,
  this.octreeRoots = null,
  this.octantMap = null,
  this.mouse = new THREE.Vector2
},
CLOUD.IntersectHelper.prototype.intersectMeshesWithDistance = function(t, e, i, n, o) {
  var r,
    a,
    s,
    l,
    c,
    h = this.raycaster,
    u = [],
    d = [];
  for (r = 0; r < e.length; r++)
    this.raycaster.intersectOctantForNode(e[r], d);
  var p = this.filter,
    f = p._hasVisibleFilter(),
    m = p._hasSelectableFilter();
  for (o.near += -1e-6, r = 0, s = d.length; r < s; r++) {
    var g = i[d[r].octantId];
    if (g)
      for (a = 0; a < g.length; a += 2)
        for (var v = g[a]; v <= g[a + 1]; v++)
          l = t._pool[v],
          (c = l.intersectBoxWithDistance(h)) >= o.near && c <= o.far && u.push({object: l, distance: c})
  }
  u.sort(function(t, e) {
    return t.distance - e.distance
  });
  var y = [],
    E = [],
    x = o.far;
  for (r = 0; r < u.length; r++)
    if (!(u[r].distance > x || u[r].distance < o.near || (l = u[r].object, n && function(t) {
      return f && !p._isVisible(t) || m && !p._isSelectable(t)
    }(l) || (y = [], l.raycast(h, y), !(y.length > 0)))))
      for (y.sort(function(t, e) {
        return t.distance - e.distance
      }), a = 0; a < y.length; a++)
        if (y[a].distance < x && y[a].distance > o.near) {
          x = y[a].distance - -1e-6,
          E.push(y[a]);
          break
        }
      return E.sort(function(t, e) {
    return t.distance - e.distance
  }),
  E
},
CLOUD.IntersectHelper.prototype.intersect = function(t, e, i) {
  var n = this,
    o = n.raycaster;
  if (null === e)
    o.setFromCamera(t.mouse, t.camera);
  else {
    var r = e.origin,
      a = e.direction;
    o.set(r, a)
  }
  console.log("request intersect");
  var s = {
    near: t.camera.near,
    far: t.camera.far
  };
  t.scene.shrinkScopeByClipPlane(o, s);
  var l = this.intersectMeshesWithDistance(t.scene.pool, t.octreeRoots, t.octantMap, i, s),
    c = l.length;
  if (c > 0)
    for (var h = 0; h < c; ++h) {
      var u = l[h],
        d = u.object;
      if (d.geometry)
        return u.userId = d.name,
        u.databagId = d.databagId,
        this.lastIntersect = u,
        u
    }
  return this.lastIntersect = null,
  null
},
CLOUD.IntersectHelper.prototype.hitTest = function(t) {
  var e = this.intersect(t, null, !1);
  return null !== e
    ? e.point
    : null
},
CLOUD.IntersectHelper.prototype.pick = function(t, e) {
  var i = this.intersect(t, null, !0);
  return e && e(i),
  i
},
CLOUD.IntersectHelper.prototype.getIntersectByRay = function(t, e) {
  return this.intersect(t, e, !0)
},
CLOUD.PickUtil = {
  pickByRect: function(t, e, i, n) {
    function o(t) {
      if (f.set(t.min, t.max), e.intersectsBox(f)) {
        c.push(t);
        for (var i = 0, n = t.childOctants.length; i < n; ++i) {
          o(t.childOctants[i])
        }
      }
    }
    var r,
      a,
      s,
      l = [],
      c = [],
      h = t.pool,
      u = n.getOctreeRoots(),
      d = n.octantToObjectMap,
      p = n.sceneState,
      f = new THREE.Box3,
      m = new THREE.Vector3,
      g = new THREE.Vector3,
      v = n.filter,
      y = v._hasVisibleFilter(),
      E = v._hasSelectableFilter();
    if (i === CLOUD.OPSELECTIONTYPE.Clear)
      return void p.clearSelection();
    for (r = 0; r < u.length; r++)
      o(u[r], c);
    for (r = 0, s = c.length; r < s; r++) {
      var x = d[c[r].octantId];
      if (x)
        for (a = 0; a < x.length; a += 2)
          for (var b = x[a]; b <= x[a + 1]; b++) {
            var w = h._pool[b];
            if (!function(t) {
              return y && !v._isVisible(t) || E && !v._isSelectable(t)
            }(w)) {
              var C = w.geometry,
                T = w.material,
                _ = w.matrixWorld;
              void 0 !== T && (null === C.boundingBox && C.computeBoundingBox(), f.copy(C.boundingBox), f.applyMatrix4(_), function(t, e) {
                for (var i = 0, n = t.planes, o = 0; o < 6; o++) {
                  var r = n[o];
                  m.x = r.normal.x > 0
                    ? e.min.x
                    : e.max.x,
                  g.x = r.normal.x > 0
                    ? e.max.x
                    : e.min.x,
                  m.y = r.normal.y > 0
                    ? e.min.y
                    : e.max.y,
                  g.y = r.normal.y > 0
                    ? e.max.y
                    : e.min.y,
                  m.z = r.normal.z > 0
                    ? e.min.z
                    : e.max.z,
                  g.z = r.normal.z > 0
                    ? e.max.z
                    : e.min.z;
                  var a = r.distanceToPoint(m),
                    s = r.distanceToPoint(g);
                  if (a < 0 && s < 0)
                    return !1;
                  a * s >= 0 && ++i
                }
                return 6 === i
              }(e, f) && l.push(w.name))
            }
          }
        }
    l.length > 0 && (
      CLOUD.OPSELECTIONTYPE.Remove === i
      ? p.removeSelection(l)
      : CLOUD.OPSELECTIONTYPE.Add === i && p.addSelection(l))
  }
},
CLOUD.Object3DIdCount = 0,
CLOUD.Object3D = function() {
  function t() {
    o.setFromEuler(n, !1)
  }
  function e() {
    n.setFromQuaternion(o, void 0, !1)
  }
  Object.defineProperty(this, "id", {
    value: CLOUD.Object3DIdCount++
  }),
  this.name = "",
  this.type = "Object3D",
  this.parent = null,
  this.children = [],
  this.layers = new THREE.Layers;
  var i = new THREE.Vector3,
    n = new THREE.Euler,
    o = new THREE.Quaternion,
    r = new THREE.Vector3(1, 1, 1);
  n.onChange(t),
  o.onChange(e),
  Object.defineProperties(this, {
    position: {
      enumerable: !0,
      value: i
    },
    rotation: {
      enumerable: !0,
      value: n
    },
    quaternion: {
      enumerable: !0,
      value: o
    },
    scale: {
      enumerable: !0,
      value: r
    },
    modelViewMatrix: {
      value: new THREE.Matrix4
    },
    normalMatrix: {
      value: new THREE.Matrix3
    }
  }),
  this.matrix = new THREE.Matrix4,
  this.matrixWorld = new THREE.Matrix4,
  this.matrixWorldNeedsUpdate = !0,
  this.visible = !0,
  this.renderOrder = 0
},
CLOUD.Object3D.prototype = {
  constructor: CLOUD.Object3D,
  applyMatrix: function(t) {
    this.matrix.multiplyMatrices(t, this.matrix)
  },
  localToWorld: function(t) {
    return t.applyMatrix4(this.matrixWorld)
  },
  worldToLocal: function() {
    var t = new THREE.Matrix4;
    return function(e) {
      return e.applyMatrix4(t.getInverse(this.matrixWorld))
    }
  }(),
  getWorldPosition: function(t) {
    return (t || new THREE.Vector3).setFromMatrixPosition(this.matrixWorld)
  },
  raycast: function() {},
  traverse: function(t) {
    t(this)
  },
  traverseVisible: function(t) {
    this.visible !== !1 && t(this)
  },
  traverseAncestors: function(t) {
    var e = this.parent;
    null !== e && (t(e), e.traverseAncestors(t))
  },
  updateMatrix: function() {
    this.matrix.compose(this.position, this.quaternion, this.scale),
    this.matrixWorldNeedsUpdate = !0
  },
  updateMatrixWorld: function(t) {
    if ((this.matrixWorldNeedsUpdate === !0 || t) && (
      null === this.parent
      ? this.matrixWorld.copy(this.matrix)
      : this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix),
    this.matrixWorldNeedsUpdate = !1,
    t = !0), this.children)
      for (var e = 0, i = this.children.length; e < i; e++)
        this.children[e].updateMatrixWorld(t)
  }
},
Object.assign(CLOUD.Object3D.prototype, THREE.EventDispatcher.prototype),
CLOUD.Group = function() {
  CLOUD.Object3D.call(this),
  this.type = "Group",
  this.children = [],
  this.boundingBox = null,
  this.pickEnabled = !0,
  this.tag = ""
},
CLOUD.Group.prototype = Object.create(CLOUD.Object3D.prototype),
CLOUD.Group.prototype.constructor = CLOUD.Group,
CLOUD.Group.prototype.raycast = function() {
  var t = new THREE.Matrix4,
    e = new THREE.Ray;
  return function(i, n) {
    var o = this.boundingBox;
    return t.getInverse(this.matrixWorld),
    e.copy(i.ray).applyMatrix4(t),
    null === o || e.intersectsBox(o) !== !1
  }
}(),
CLOUD.Group.prototype.add = function(t) {
  if (arguments.length > 1) {
    for (var e = 0; e < arguments.length; e++)
      this.add(arguments[e]);
    return this
  }
  return t === this
    ? (console.error("CLOUD.Object3D.add: object can't be added as a child of itself.", t), this)
    : (
      t instanceof CLOUD.Object3D || t instanceof THREE.Object3D
      ? (null !== t.parent && t.parent.remove(t), t.parent = this, t.dispatchEvent({type: "added"}), this.children.push(t))
      : console.error("CLOUD.Object3D.add: object not an instance of Object3D.", t),
    this)
},
CLOUD.Group.prototype.remove = function(t) {
  if (arguments.length > 1)
    for (var e = 0; e < arguments.length; e++)
      this.remove(arguments[e]);
var i = this.children.indexOf(t);
  i !== -1 && (t.parent = null, t.dispatchEvent({type: "removed"}), this.children.splice(i, 1))
},
CLOUD.Group.prototype.traverseVisible = function(t) {
  if (this.visible !== !1) {
    t(this);
    for (var e = this.children, i = 0, n = e.length; i < n; ++i)
      e[i].traverseVisible(t)
  }
},
CLOUD.Group.prototype.traverse = function(t) {
  t(this);
  for (var e = this.children, i = 0, n = e.length; i < n; ++i)
    e[i].traverse(t)
},
CLOUD.Camera = function(t, e, i, n, o) {
  THREE.CombinedCamera.call(this, t, e, i, n, o),
  this.realUp = this.up.clone(),
  this.target = new THREE.Vector3,
  this.dirty = !1,
  this.positionPlane = new THREE.Plane,
  this.projScreenMatrix = new THREE.Matrix4,
  this.viewProjInverse = new THREE.Matrix4,
  this.frustum = new THREE.Frustum
},
CLOUD.Camera.prototype = Object.create(THREE.CombinedCamera.prototype),
CLOUD.Camera.prototype.constructor = CLOUD.Camera,
CLOUD.Camera.prototype._updatePositionPlane = function() {
  this.positionPlane.setFromNormalAndCoplanarPoint(this.getWorldDirection(), this.position)
},
CLOUD.Camera.prototype._updateFrustum = function() {
  this.frustum.setFromMatrix(this.projScreenMatrix)
},
CLOUD.Camera.prototype.updateMVP = function() {
  null === this.parent && this.updateMatrixWorld(),
  this.matrixWorldInverse.getInverse(this.matrixWorld),
  this.projScreenMatrix.multiplyMatrices(this.projectionMatrix, this.matrixWorldInverse),
  this.viewProjInverse.getInverse(this.projScreenMatrix),
  this._updateFrustum(),
  this._updatePositionPlane()
},
CLOUD.Camera.prototype.getFrustum = function(t) {
  return void 0 === t && (t = !0),
  t && this.updateMVP(),
  this.frustum
},
CLOUD.Camera.prototype.LookAt = function(t, e, i, n) {
  var o = new THREE.Vector3;
  o.copy(e),
  void 0 !== n && o.setLength(n),
  this.position.subVectors(t, o),
  this.up = i,
  this.lookAt(t),
  this.realUp = i.clone(),
  this.target = t.clone()
},
CLOUD.Camera.prototype.clone = function() {
  var t = new CLOUD.Camera(2 * this.right, 2 * this.top, this.fov, this.near, this.far);
  return t.position.copy(this.position),
  t.up.copy(this.up),
  t.realUp.copy(this.realUp),
  t.target.copy(this.target),
  t.aspect = this.aspect,
  t.fov = this.fov,
  t.near = this.near,
  t.far = this.far,
  t.left = this.left,
  t.right = this.right,
  t.top = this.top,
  t.bottom = this.bottom,
  t.zoom = this.zoom,
  t.isPerspective = this.isPerspective,
  t.updateProjectionMatrix(),
  t.updateMVP(),
  t
},
CLOUD.Camera.prototype.copy = function(t) {
  return this.position.copy(t.position),
  this.target.copy(t.target),
  this.up.copy(t.up),
  this.realUp.copy(t.realUp),
  this.aspect = t.aspect,
  this.fov = t.fov,
  this.near = t.near,
  this.far = t.far,
  this.left = t.left,
  this.right = t.right,
  this.top = t.top,
  this.bottom = t.bottom,
  this.zoom = t.zoom,
  this.isPerspective = t.isPerspective,
  this.updateProjectionMatrix(),
  this.updateMVP(),
  this
},
CLOUD.Camera.prototype.setStandardView = function(t, e) {
  var i;
  i = e
    ? e.getCenter()
    : new THREE.Vector3(0, 0, 0);
  var n = CLOUD.GlobalData.SceneSize,
    o = n / 2;
  switch (t) {
    case CLOUD.EnumStandardView.ISO:
      var r = new THREE.Vector3(-n, n, n),
        a = new THREE.Vector3,
        s = new THREE.Vector3(0, 0, 0);
      a.subVectors(s, r),
      this.LookAt(i, a, THREE.Object3D.DefaultUp);
      break;
    case CLOUD.EnumStandardView.Top:
      this.LookAt(i, new THREE.Vector3(0, -1, 0), new THREE.Vector3(0, 0, -1), o);
      break;
    case CLOUD.EnumStandardView.Bottom:
      this.LookAt(i, new THREE.Vector3(0, 1, 0), new THREE.Vector3(0, 0, 1), o);
      break;
    case CLOUD.EnumStandardView.Front:
      this.LookAt(i, new THREE.Vector3(0, 0, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.Back:
      this.LookAt(i, new THREE.Vector3(0, 0, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.Right:
      this.LookAt(i, new THREE.Vector3(-1, 0, 0), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.Left:
      this.LookAt(i, new THREE.Vector3(1, 0, 0), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.SouthEast:
      this.LookAt(i, new THREE.Vector3(-1, 0, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.SouthWest:
      this.LookAt(i, new THREE.Vector3(1, 0, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.NorthWest:
      this.LookAt(i, new THREE.Vector3(1, 0, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.NorthEast:
      this.LookAt(i, new THREE.Vector3(-1, 0, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomFront:
      this.LookAt(i, new THREE.Vector3(0, 1, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomBack:
      this.LookAt(i, new THREE.Vector3(0, 1, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomRight:
      this.LookAt(i, new THREE.Vector3(-1, 1, 0), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomLeft:
      this.LookAt(i, new THREE.Vector3(1, 1, 0), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomSouthEast:
      this.LookAt(i, new THREE.Vector3(-1, 1, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomSouthWest:
      this.LookAt(i, new THREE.Vector3(1, 1, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomNorthWest:
      this.LookAt(i, new THREE.Vector3(1, 1, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomNorthEast:
      this.LookAt(i, new THREE.Vector3(-1, 1, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.RoofFront:
      this.LookAt(i, new THREE.Vector3(0, -1, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.RoofBack:
      this.LookAt(i, new THREE.Vector3(0, -1, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.RoofRight:
      this.LookAt(i, new THREE.Vector3(-1, -1, 0), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.RoofLeft:
      this.LookAt(i, new THREE.Vector3(1, -1, 0), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.RoofSouthEast:
      this.LookAt(i, new THREE.Vector3(-1, -1, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.RoofSouthWest:
      this.LookAt(i, new THREE.Vector3(1, -1, -1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.RoofNorthWest:
      this.LookAt(i, new THREE.Vector3(1, -1, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.RoofNorthEast:
      this.LookAt(i, new THREE.Vector3(-1, -1, 1), new THREE.Vector3(0, 1, 0), o);
      break;
    case CLOUD.EnumStandardView.TopTurnRight:
      this.LookAt(i, new THREE.Vector3(0, -1, 0), new THREE.Vector3(-1, 0, 0), o);
      break;
    case CLOUD.EnumStandardView.TopTurnBack:
      this.LookAt(i, new THREE.Vector3(0, -1, 0), new THREE.Vector3(0, 0, 1), o);
      break;
    case CLOUD.EnumStandardView.TopTurnLeft:
      this.LookAt(i, new THREE.Vector3(0, -1, 0), new THREE.Vector3(1, 0, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomTurnRight:
      this.LookAt(i, new THREE.Vector3(0, 1, 0), new THREE.Vector3(-1, 0, 0), o);
      break;
    case CLOUD.EnumStandardView.BottomTurnBack:
      this.LookAt(i, new THREE.Vector3(0, 1, 0), new THREE.Vector3(0, 0, -1), o);
      break;
    case CLOUD.EnumStandardView.BottomTurnLeft:
      this.LookAt(i, new THREE.Vector3(0, 1, 0), new THREE.Vector3(1, 0, 0), o);
      break;
    case CLOUD.EnumStandardView.FrontTurnTop:
      this.LookAt(i, new THREE.Vector3(0, 0, -1), new THREE.Vector3(0, -1, 0), o);
      break;
    case CLOUD.EnumStandardView.FrontTurnLeft:
      this.LookAt(i, new THREE.Vector3(0, 0, -1), new THREE.Vector3(1, 0, 0), o);
      break;
    case CLOUD.EnumStandardView.FrontTurnRight:
      this.LookAt(i, new THREE.Vector3(0, 0, -1), new THREE.Vector3(-1, 0, 0), o);
      break;
    case CLOUD.EnumStandardView.RightTurnTop:
      this.LookAt(i, new THREE.Vector3(-1, 0, 0), new THREE.Vector3(0, -1, 0), o);
      break;
    case CLOUD.EnumStandardView.RightTurnFront:
      this.LookAt(i, new THREE.Vector3(-1, 0, 0), new THREE.Vector3(0, 0, -1), o);
      break;
    case CLOUD.EnumStandardView.RightTurnBack:
      this.LookAt(i, new THREE.Vector3(-1, 0, 0), new THREE.Vector3(0, 0, 1), o);
      break;
    case CLOUD.EnumStandardView.BackTurnTop:
      this.LookAt(i, new THREE.Vector3(0, 0, 1), new THREE.Vector3(0, -1, 0), o);
      break;
    case CLOUD.EnumStandardView.BackTurnLeft:
      this.LookAt(i, new THREE.Vector3(0, 0, 1), new THREE.Vector3(-1, 0, 0), o);
      break;
    case CLOUD.EnumStandardView.BackTurnRight:
      this.LookAt(i, new THREE.Vector3(0, 0, 1), new THREE.Vector3(1, 0, 0), o);
      break;
    case CLOUD.EnumStandardView.LeftTurnTop:
      this.LookAt(i, new THREE.Vector3(1, 0, 0), new THREE.Vector3(0, -1, 0), o);
      break;
    case CLOUD.EnumStandardView.LeftTurnBack:
      this.LookAt(i, new THREE.Vector3(1, 0, 0), new THREE.Vector3(0, 0, 1), o);
      break;
    case CLOUD.EnumStandardView.LeftTurnFront:
      this.LookAt(i, new THREE.Vector3(1, 0, 0), new THREE.Vector3(0, 0, -1), o)
  }
  return this.updateProjectionMatrix(),
  i
},
CLOUD.Camera.prototype.zoomToBBox = function(t, e, i, n) {
  i = i || 1,
  e = e || 0,
  e = e < -1
    ? -1
    : e;
  var o = new THREE.Box3;
  if (o.copy(t), 0 !== e) {
    var r = .5 * t.getSize().length(),
      a = new THREE.Vector3;
    a.subVectors(o.min, o.max).normalize(),
    a.multiplyScalar(r * e),
    o.expandByVector(a)
  }
  var s = n || this.getWorldDirection(),
    l = this.up,
    c = this.aspect,
    h = THREE.Math.degToRad(.5 * this.fov),
    u = o.getSize(),
    d = o.getCenter(),
    p = .5 * u.length(),
    f = p / Math.sin(h) * i,
    m = new THREE.Vector3;
  m.copy(s),
  m.setLength(f);
  var g = new THREE.Vector3;
  g.subVectors(d, m);
  var v = new THREE.Vector3;
  v.crossVectors(s, l),
  v.normalize();
  var y = new THREE.Vector3;
  y.crossVectors(s, v),
  y.normalize();
  var E = new THREE.Plane;
  E.setFromNormalAndCoplanarPoint(v, g);
  var x = new THREE.Plane;
  x.setFromNormalAndCoplanarPoint(y, g);
  var b = 0,
    w = 0,
    C = 0,
    T = 0,
    _ = [
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3
    ];
  _[0].set(o.min.x, o.min.y, o.min.z),
  _[1].set(o.min.x, o.min.y, o.max.z),
  _[2].set(o.min.x, o.max.y, o.min.z),
  _[3].set(o.min.x, o.max.y, o.max.z),
  _[4].set(o.max.x, o.min.y, o.min.z),
  _[5].set(o.max.x, o.min.y, o.max.z),
  _[6].set(o.max.x, o.max.y, o.min.z),
  _[7].set(o.max.x, o.max.y, o.max.z);
  for (var L = 0; L < 8; L++) {
    var M = new THREE.Vector3;
    M.subVectors(_[L], g);
    var S = Math.abs(M.dot(s)),
      O = Math.abs(x.distanceToPoint(_[L])),
      D = O * c,
      R = Math.abs(E.distanceToPoint(_[L])),
      U = R / c,
      A = Math.max(O, U),
      I = Math.max(D, R);
    (!b || !w || A > b * S / w) && (b = A, w = S),
    (!C || !T || I > C * S / T) && (C = I, T = S)
  }
  var P = b / Math.tan(h) + (f - w);
  if (c < 1 && (P = C / Math.tan(h) + (f - T)), P < this.near) {
    this.near = (P * P + .001 * P) / 16777.216
  }
  return m.copy(s).normalize().setLength(P),
  g.subVectors(d, m),
  this.position.copy(g),
  this.lookAt(d),
  this.updateProjectionMatrix(),
  this.target.copy(d),
  d
},
CLOUD.Camera.prototype.computeRay = function(t, e, i) {
  var n = new THREE.Vector2;
  if (void 0 === i)
    n.x = window.innerWidth,
    n.y = window.innerHeight;
  else {
    var o = i === document
      ? i.body
      : i;
    n.x = o.offsetWidth,
    n.y = o.offsetHeight
  }
  var r = new THREE.Vector2;
  r.x = t / n.x * 2 - 1,
  r.y = -e / n.y * 2 + 1;
  var a = new THREE.Ray;
  return this.isPerspective
    ? (a.origin.copy(this.position), a.direction.set(r.x, r.y, .5).unproject(this).sub(this.position).normalize())
    : (a.origin.set(r.x, r.y, -1).unproject(this), a.direction.set(0, 0, -1).transformDirection(this.matrixWorld)),
  a
},
CLOUD.Camera.prototype.screenToWorld = function(t, e, i, n) {
  var o = this.computeRay(t, e, i),
    r = this.getWorldDirection().normalize(),
    a = new THREE.Plane(r);
  return a.setFromNormalAndCoplanarPoint(r, n),
  o.intersectPlane(a, n)
},
CLOUD.Camera.prototype.distanceFromWorldToDrawing = function(t, e) {
  var i = this.position.clone(),
    n = this.target.clone();
  n.subVectors(this.target, this.position),
  n.normalize();
  var o = new THREE.Matrix4;
  return o.getInverse(t),
  n.add(i).applyMatrix4(o),
  i.applyMatrix4(o),
  n.sub(i),
  n.normalize().multiplyScalar(e),
  n.add(i).applyMatrix4(t),
  n.sub(this.position),
  n.length()
},
CLOUD.Camera.drawingToWorld = function(t, e) {
  var i = t.position.clone(),
    n = t.target.clone(),
    o = t.up.clone(),
    r = new THREE.Matrix4;
  return r.getInverse(e),
  o.add(i),
  o.applyMatrix4(r),
  i.applyMatrix4(r),
  n.applyMatrix4(r),
  o.sub(i),
  o.normalize(), {
    position: i,
    target: n,
    up: o
  }
},
CLOUD.Camera.worldToDrawing = function(t, e) {
  var i = t.position.clone(),
    n = t.target.clone(),
    o = t.up.clone();
  return o.add(i),
  o.applyMatrix4(e),
  i.applyMatrix4(e),
  n.applyMatrix4(e),
  o.sub(i),
  o.normalize(), {
    position: i,
    target: n,
    up: o
  }
},
CLOUD.Scene = function() {
  if (CLOUD.Group.call(this), this.type = "Scene", this.autoUpdate = !1, this.highPriorityGroup = new CLOUD.Group, this.add(this.highPriorityGroup), this.rootNode = new CLOUD.Group, this.rootNode.sceneRoot = !0, this.add(this.rootNode), this.clipPlanes = null, this.fillClipPlane = null, this.pool = new CLOUD.ObjectPool(CLOUD.MeshEx, CLOUD.GlobalData.maxObjectNumInPool), this.pool.init({parent: this.rootNode}), this.transformMatrix = new THREE.Matrix4, this.IBLcfg = null, this.IBLIndex = 0, this.iblProbe = null, CLOUD.GlobalData.DirectionalLight) {
    var t = .3;
    this.hemisphereLight = new THREE.HemisphereLight(16777215, 16777215, t * CLOUD.GlobalData.LightIntensityFactor),
    this.hemisphereLight.initIntensity = t,
    this.hemisphereLight.position.set(0, 500, 0),
    this.hemisphereLight.updateMatrixWorld(!0),
    this.add(this.hemisphereLight),
    t = .7,
    this.dirLight = new THREE.DirectionalLight(16777215, t * CLOUD.GlobalData.LightIntensityFactor),
    this.dirLight.initIntensity = t,
    this.dirLight.color.setHSL(.1, 1, .95),
    this.dirLight.position.set(-1, .75, 1),
    this.dirLight.position.multiplyScalar(50),
    this.add(this.dirLight)
  } else {
    this.lightOffset = new THREE.Vector3(-1, -1, -1),
    this.lightOffset.normalize();
    var t = .35;
    this.lampHead = new THREE.DirectionalLight(16777215, t * CLOUD.GlobalData.LightIntensityFactor),
    this.lampHead.initIntensity = t,
    this.lampAssist = new THREE.DirectionalLight(16777215, t * CLOUD.GlobalData.LightIntensityFactor),
    this.lampAssist.initIntensity = t,
    t = .3,
    this.hemisphereLight = new THREE.HemisphereLight(16777215, 16777215, t * CLOUD.GlobalData.LightIntensityFactor),
    this.hemisphereLight.initIntensity = t,
    this.hemisphereLight.updateMatrixWorld(!0),
    this.add(this.hemisphereLight),
    this.add(this.lampHead),
    this.add(this.lampAssist)
  }
  this.groupOctreeBox = new THREE.Group,
  this.add(this.groupOctreeBox),
  this.pickGroups = [],
  this.pickGroups.push(this.rootNode)
},
CLOUD.Scene.prototype = Object.create(CLOUD.Group.prototype),
CLOUD.Scene.prototype.constructor = CLOUD.Scene,
CLOUD.Scene.prototype.destroy = function() {
  this.hemisphereLight && (this.remove(this.hemisphereLight), this.hemisphereLight = null),
  this.dirLight && (this.remove(this.dirLight), this.dirLight = null),
  this.lampHead && (this.remove(this.lampHead), this.lampHead = null),
  this.lampAssist && (this.remove(this.lampAssist), this.lampAssist = null),
  this.clearAll(),
  this.pool.destroy(),
  this.pool = null,
  this.clipPlanes = null,
  this.fillClipPlane = null
},
CLOUD.Scene.prototype.resizePool = function(t) {
  this.rootNode.children = [],
  this.pool.resize(t, {parent: this.rootNode})
},
CLOUD.Scene.prototype.clearAll = function() {
  this.pool.clear(),
  this.autoUpdate = !1
},
CLOUD.Scene.prototype.getRootNode = function() {
  return this.rootNode
},
CLOUD.Scene.prototype.isLoaded = function() {
  return null !== this.rootNode.boundingBox
},
CLOUD.Scene.prototype.getBoundingBoxDefault = function() {
  var t = .5 * CLOUD.GlobalData.SceneSize,
    e = new THREE.Vector3(-t, -t, -t),
    i = new THREE.Vector3(t, t, t);
  return new THREE.Box3(e, i)
},
CLOUD.Scene.prototype.getBoundingBox = function() {
  var t = new THREE.Box3;
  return function() {
    return t.copy(this.rootNode.boundingBox),
    t.applyMatrix4(this.rootNode.matrix),
    t
  }
}(),
CLOUD.Scene.prototype.getBoundingBoxWorld = function() {
  return this.rootNode.boundingBox
},
CLOUD.Scene.prototype.getTransformMatrixGlobal = function() {
  return this.transformMatrix
},
CLOUD.Scene.prototype.getMatrixGlobal = function() {
  return this.rootNode.matrix
},
CLOUD.Scene.prototype.getMatrixWorldGlobal = function() {
  return this.rootNode.matrixWorld
},
CLOUD.Scene.prototype.getRotationGlobal = function() {
  if (this.rootNode.matrix) {
    var t = new THREE.Matrix4;
    t.extractRotation(this.rootNode.matrix);
    var e = new THREE.Euler;
    return e.setFromRotationMatrix(t),
    e
  }
  return null
},
CLOUD.Scene.prototype.getTrackingPointFromBoundingBox = function(t, e) {
  if (!this.rootNode.boundingBox)
    return null;
  var i = e.origin,
    n = this.getBoundingBox(),
    o = 0,
    r = [
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3,
      new THREE.Vector3
    ];
  r[0].set(n.min.x, n.min.y, n.min.z),
  r[1].set(n.min.x, n.min.y, n.max.z),
  r[2].set(n.min.x, n.max.y, n.min.z),
  r[3].set(n.min.x, n.max.y, n.max.z),
  r[4].set(n.max.x, n.min.y, n.min.z),
  r[5].set(n.max.x, n.min.y, n.max.z),
  r[6].set(n.max.x, n.max.y, n.min.z),
  r[7].set(n.max.x, n.max.y, n.max.z);
  for (var a = 0; a < 8; a++) {
    var s = new THREE.Vector3;
    s.subVectors(r[a], i);
    var l = s.dot(t);
    o < l && (o = l)
  }
  var c = t.clone().multiplyScalar(o),
    h = i.clone().add(c),
    u = new THREE.Plane;
  return u.setFromNormalAndCoplanarPoint(t, h),
  e.intersectPlane(u)
},
CLOUD.Scene.prototype.getNearDepthByRect = function() {
  function t(t) {
    r.setFromMatrixPosition(t.matrixWorld),
    r.applyProjection(o);
    var e = r.z;
    e < n && e >= 0 && e <= 1 && (n = e)
  }
  function e(t, e) {
    if (!e.boundingBox || e instanceof THREE.Mesh) {
      var n = e.geometry;
      null === n.boundingBox && n.computeBoundingBox(),
      i.copy(n.boundingBox),
      i.applyMatrix4(e.matrixWorld)
    } else
      i.copy(e.boundingBox),
      i.applyMatrix4(e.matrixWorld);
    return t.intersectsBox(i)
  }
  var i = new THREE.Box3,
    n = 1 / 0,
    o = new THREE.Matrix4,
    r = new THREE.Vector3;
  return function(i, r) {
    function a(n) {
      if (n instanceof CLOUD.MeshEx) {
        if (!e(i, n))
          return;
        t(n)
      } else if (n.worldBoundingBox) {
        if (!i.intersectsBox(n.worldBoundingBox))
          return;
        t(n)
      }
      var o = n.children;
      if (o)
        for (var r = 0, s = o.length; r < s; r++) {
          var l = o[r];
          l.visible && a(l)
        }
      }
    n = 1 / 0,
    o.multiplyMatrices(r.projectionMatrix, r.matrixWorldInverse);
    for (var s = this.rootNode.children, l = 0, c = s.length; l < c; l++) {
      var h = s[l];
      h.visible && a(h)
    }
    return n
  }
}(),
CLOUD.Scene.prototype.getClipPlanes = function() {
  if (null == this.clipPlanes) {
    var t = new THREE.Box3;
    t.copy(this.rootNode.boundingBox),
    t.applyMatrix4(this.rootNode.matrix),
    this.clipPlanes = new CLOUD.ClipPlanes(t.getSize(), t.getCenter()),
    this.highPriorityGroup.add(this.clipPlanes)
  }
  return this.clipPlanes
},
CLOUD.Scene.prototype.getFillClipPlane = function() {
  if (null == this.fillClipPlane) {
    var t = new THREE.Box3;
    t.copy(this.rootNode.boundingBox),
    t.applyMatrix4(this.rootNode.matrix),
    this.fillClipPlane = new CLOUD.FillClipPlane(t.getSize(), t.getCenter()),
    this.add(this.fillClipPlane)
  }
  return this.fillClipPlane
},
CLOUD.Scene.prototype.shrinkScopeByClipPlane = function(t, e) {
  if (this.clipPlanes && this.clipPlanes.isEnabled()) {
    var i = this.clipPlanes.hitTest(t);
    if (null == i.distance)
      return;
    i.sign
      ? i.distance > e.near && (e.near = i.distance)
      : i.distance < e.far && (e.far = i.distance)
  }
},
CLOUD.Scene.prototype.traverseIf = function(t) {
  function e(t, i) {
    for (var n = t.children, o = 0, r = n.length; o < r; o++) {
      var a = n[o];
      if (!i(a, t))
        break;
      a.visible && e(a, i)
    }
  }
  for (var i = this.rootNode.children, n = 0, o = i.length; n < o; n++) {
    e(i[n], t)
  }
},
CLOUD.Scene.prototype.findNode = function(t) {
  for (var e = this.rootNode.children, i = 0, n = e.length; i < n; i++) {
    var o = e[i];
    if (o.userData && t == o.userData.sceneId)
      return o
  }
  return null
},
CLOUD.Scene.prototype.getNodeById = function(t) {
  for (var e = this.rootNode.children, i = 0, n = e.length; i < n; i++) {
    var o = e[i];
    if (t === o.name)
      return o
  }
  return null
},
CLOUD.Scene.prototype.showNodes = function(t, e) {
  for (var i = this.rootNode.children, n = 0, o = i.length; n < o; n++) {
    var r = i[n];
    r.databagId === t.databagId && (r.visible = e)
  }
},
CLOUD.Scene.prototype.containsBoxInFrustum = function() {
  var t = new THREE.Vector3,
    e = new THREE.Vector3;
  return function(i, n) {
    for (var o = i.planes, r = 0; r < 6; r++) {
      var a = o[r];
      t.x = a.normal.x > 0
        ? n.min.x
        : n.max.x,
      e.x = a.normal.x > 0
        ? n.max.x
        : n.min.x,
      t.y = a.normal.y > 0
        ? n.min.y
        : n.max.y,
      e.y = a.normal.y > 0
        ? n.max.y
        : n.min.y,
      t.z = a.normal.z > 0
        ? n.min.z
        : n.max.z,
      e.z = a.normal.z > 0
        ? n.max.z
        : n.min.z;
      var s = a.distanceToPoint(t),
        l = a.distanceToPoint(e);
      if (s < 0 || l < 0)
        return !1
    }
    return !0
  }
}(),
CLOUD.Scene.prototype.prepareScene = function() {},
CLOUD.Scene.prototype.parseRootNode = function(t) {
  var e = this.rootNode,
    i = t.view,
    n = CLOUD.Utils.box3FromArray(i.bbox),
    o = i.transform,
    r = new THREE.Vector3,
    a = new THREE.Quaternion,
    s = new THREE.Vector3(1, 1, 1);
  if (i.rotation) {
    var l = new THREE.Euler;
    l.fromArray(i.rotation),
    a.setFromEuler(l, !1)
  }
  var c = new THREE.Vector3,
    h = new THREE.Vector3(1, 1, 1);
  if (i.position && c.fromArray(i.position), i.scale && h.fromArray(i.scale), this.transformMatrix.compose(c, a, h), void 0 === o || 1 === o)
    null === e.boundingBox || e.boundingBox.isEmpty()
      ? (e.boundingBox = n, i.position && r.fromArray(i.position), i.scale && s.fromArray(i.scale), e.matrix.compose(r, a, s), e.matrixAutoUpdate = !1, e.updateMatrixWorld(!0))
      : (e.boundingBox.expandByPoint(n.min), e.boundingBox.expandByPoint(n.max));
  else {
    null === e.boundingBox || e.boundingBox.isEmpty()
      ? e.boundingBox = n
      : (e.boundingBox.expandByPoint(n.min), e.boundingBox.expandByPoint(n.max));
    var u = CLOUD.GlobalData.SceneSize,
      d = e.boundingBox.size(),
      p = Math.max(d.x, d.y, d.z),
      f = u / p;
    s.multiplyScalar(f),
    e.matrix.compose(r, a, s),
    e.matrixAutoUpdate = !1,
    e.updateMatrixWorld(!0)
  }
},
CLOUD.Scene.prototype.updateLights = function(t) {
  if (CLOUD.GlobalData.DirectionalLight) {
    var e = this.dirLight;
    e.intensity = e.initIntensity * CLOUD.GlobalData.LightIntensityFactor,
    e.updateMatrixWorld(!0);
    var i = this.hemisphereLight;
    i.intensity = i.initIntensity * CLOUD.GlobalData.LightIntensityFactor
  } else {
    var n = this.lampHead;
    n.intensity = n.initIntensity * CLOUD.GlobalData.LightIntensityFactor,
    n.position.copy(t.getWorldDirection()).multiplyScalar(-1),
    n.updateMatrixWorld(!0);
    var o = this.lampAssist;
    o.intensity = o.initIntensity * CLOUD.GlobalData.LightIntensityFactor,
    o.position.copy(n.position).add(this.lightOffset).normalize(),
    o.updateMatrixWorld();
    var i = this.hemisphereLight;
    i.intensity = i.initIntensity * CLOUD.GlobalData.LightIntensityFactor
  }
},
CLOUD.Scene.prototype.updateOctreeBox = function(t) {
  function e(t) {
    for (var n = 0, o = t.childOctants.length; n < o; n++) {
      var r = t.childOctants[n],
        a = new THREE.Box3(r.min, r.max),
        s = 255;
      s <<= 5 * r.depth;
      var l = new CLOUD.BBoxNode(a, s);
      i.add(l),
      l.updateMatrixWorld(!0),
      e(r)
    }
  }
  var i = this.groupOctreeBox;
  if (CLOUD.GlobalData.ShowOctant) {
    if (i.visible = !0, 0 === i.children.length) {
      var n = new THREE.Box3(t.min, t.max),
        o = new CLOUD.BBoxNode(n, 16711680);
      i.add(o),
      o.updateMatrixWorld(!0),
      e(t)
    }
  } else
    i.visible = !1
},
CLOUD.Scene.prototype.intersectToWorld = function(t) {
  var e = this.getMatrixGlobal();
  t.worldPosition = CLOUD.GeomUtil.getWorldPositionOfMesh(t.point, e),
  t.worldBoundingBox = CLOUD.GeomUtil.getBoundingBoxWorldOfMesh(t.object, e)
},
CLOUD.Scene.prototype.worldToDrawing = function(t) {
  var e = this.getMatrixGlobal(),
    i = new THREE.Vector3(t.x, t.y, t.z);
  return i.applyMatrix4(e),
  i
},
CLOUD.Scene.prototype.drawingToWorld = function(t) {
  var e = this.getMatrixGlobal(),
    i = new THREE.Matrix4;
  i.getInverse(e);
  var n = new THREE.Vector3(t.x, t.y, t.z);
  return n.applyMatrix4(i),
  n
},
CLOUD.Scene.prototype.getBoundingBoxWorldByMesh = function(t) {
  var e = this.getMatrixGlobal(),
    i = t.boundingBox;
  i || (t.geometry.boundingBox || t.geometry.computeBoundingBox(), i = t.geometry.boundingBox);
  var n = i.clone();
  n.applyMatrix4(t.matrixWorld);
  var o = new THREE.Matrix4;
  return o.getInverse(e),
  n.applyMatrix4(o),
  n
},
CLOUD.Scene.prototype.getObjectPool = function() {
  return this.pool
},
CLOUD.Scene.prototype.setBoundingBoxWorld = function(t) {
  this.rootNode.boundingBox = t
},
CLOUD.Scene.prototype.clearPickGroups = function() {
  this.pickGroups.length = 0
},
CLOUD.Scene.prototype.addToPickGroups = function(t) {
  for (var e = !1, i = 0, n = this.pickGroups.length; i < n; ++i)
    if (this.pickGroups[i] === t) {
      e = !0;
      break
    }
  e || this.pickGroups.push(t)
},
CLOUD.Scene.prototype.removeFromPickGroups = function(t) {
  for (var e = 0, i = this.pickGroups.length; e < i; ++e)
    if (this.pickGroups[e] === t) {
      this.pickGroups.splice(e, 1);
      break
    }
  },
CLOUD.Raycaster = function(t, e, i, n) {
  this.ray = new THREE.Ray(t, e),
  this.near = i || 0,
  this.far = n || 1 / 0,
  this.params = {
    Sprite: {},
    Mesh: {},
    Points: {
      threshold: 1
    },
    LOD: {},
    Line: {}
  }
},
CLOUD.Raycaster.prototype = {
  constructor: CLOUD.Raycaster,
  precision: 1e-4,
  linePrecision: 1,
  descSort: function(t, e) {
    return t.distance - e.distance
  },
  set: function(t, e) {
    this.ray.set(t, e)
  },
  setFromCamera: function(t, e) {
    e instanceof THREE.CombinedCamera
      ? e.isPerspective
        ? (this.ray.origin.copy(e.position), this.ray.direction.set(t.x, t.y, .5).unproject(e).sub(e.position).normalize())
        : (this.ray.origin.set(t.x, t.y, -1).unproject(e), this.ray.direction.set(0, 0, -1).transformDirection(e.matrixWorld))
      : e instanceof THREE.PerspectiveCamera
        ? (this.ray.origin.copy(e.position), this.ray.direction.set(t.x, t.y, .5).unproject(e).sub(e.position).normalize())
        : e instanceof THREE.OrthographicCamera
          ? (this.ray.origin.set(t.x, t.y, -1).unproject(e), this.ray.direction.set(0, 0, -1).transformDirection(e.matrixWorld))
          : console.error("CLOUD.Raycaster: Unsupported camera type.")
  },
  intersectObject: function(t, e) {
    var i = [];
    return CLOUD.CameraUtil.intersectObject(t, this, i, e),
    i
  },
  intersectObjects: function(t, e) {
    for (var i = [], n = 0, o = t.length; n < o; n++)
      CLOUD.CameraUtil.intersectObject(t[n], this, i, e);
    return i
  },
  intersectOctantForNode: function(t, e) {
    function i(t) {
      var r,
        a;
      if (o.set(t.min, t.max), n.ray.intersectBox(o) && (e.push(t), t.childOctants))
        for (r = 0, a = t.childOctants.length; r < a; r++)
          i(t.childOctants[r])
    }
    var n = this,
      o = new THREE.Box3;
    i(t)
  }
},
THREE.Ray.prototype.intersectBoxWithDistance = function(t) {
  var e,
    i,
    n,
    o,
    r,
    a,
    s = 1 / this.direction.x,
    l = 1 / this.direction.y,
    c = 1 / this.direction.z,
    h = this.origin;
  if (
    s >= 0
    ? (e = (t.min.x - h.x) * s, i = (t.max.x - h.x) * s)
    : (e = (t.max.x - h.x) * s, i = (t.min.x - h.x) * s),
  l >= 0
    ? (n = (t.min.y - h.y) * l, o = (t.max.y - h.y) * l)
    : (n = (t.max.y - h.y) * l, o = (t.min.y - h.y) * l),
  e > o || n > i)
    return -1;
  if (
    (n > e || e !== e) && (e = n), (o < i || i !== i) && (i = o), c >= 0
    ? (r = (t.min.z - h.z) * c, a = (t.max.z - h.z) * c)
    : (r = (t.max.z - h.z) * c, a = (t.min.z - h.z) * c),
  e > a || r > i)
    return -1;
  if ((r > e || e !== e) && (e = r), (a < i || i !== i) && (i = a), i < 0)
    return -1;
  if (e < 0)
    return 0;
  var u = this.at(
      e >= 0
      ? e
      : i),
    d = u.x - h.x,
    p = u.y - h.y,
    f = u.z - h.z;
  return Math.sqrt(d * d + p * p + f * f)
},
CLOUD.BaseEditor = function(t, e, i) {
  this.name = "",
  this.scene = e,
  this.domElement = void 0 !== i
    ? i
    : document,
  this.cameraControl = t,
  this.mouseButtons = {
    ORBIT: THREE.MOUSE.RIGHT,
    PAN2: THREE.MOUSE.MIDDLE,
    PAN: THREE.MOUSE.LEFT
  },
  this.mouseMoveAlwaysAllowed = !1,
  this.pickHelper = new CLOUD.PickHelper(e, t)
},
CLOUD.BaseEditor.prototype.getName = function() {
  return this.name
},
CLOUD.BaseEditor.prototype.destroy = function() {
  this.pickHelper.destroy(),
  this.pickHelper = null,
  this.scene = null,
  this.domElement = null,
  this.cameraControl = null,
  this.mouseButtons = null
},
CLOUD.BaseEditor.prototype.onExist = function() {},
CLOUD.BaseEditor.prototype.resize = function() {},
CLOUD.BaseEditor.prototype.onEnter = function() {},
CLOUD.BaseEditor.prototype.onMouseDown = function(t) {},
CLOUD.BaseEditor.prototype.onMouseMove = function(t) {},
CLOUD.BaseEditor.prototype.onMouseUp = function(t) {},
CLOUD.BaseEditor.prototype.onMouseWheel = function(t) {},
CLOUD.BaseEditor.prototype.onMouseDoubleClick = function(t) {},
CLOUD.BaseEditor.prototype.onKeyDown = function(t) {},
CLOUD.BaseEditor.prototype.onKeyUp = function(t) {},
CLOUD.BaseEditor.prototype.touchstart = function(t) {},
CLOUD.BaseEditor.prototype.touchmove = function(t) {},
CLOUD.BaseEditor.prototype.touchend = function(t) {},
CLOUD.BaseEditor.prototype.onHover = function(t) {},
CLOUD.BaseEditor.prototype.moveTo = function(t) {},
CLOUD.BaseEditor.prototype.dispatchEvent = function(t) {
  this.cameraControl.viewer.modelManager.dispatchEvent(t)
},
CLOUD.BaseEditor.prototype.getDomElement = function() {
  return this.domElement
},
CLOUD.BaseEditor.prototype.updateButtons = function(t) {
  void 0 !== t.ORBIT && (this.mouseButtons.ORBIT = t.ORBIT),
  void 0 !== t.PAN && (this.mouseButtons.PAN = t.PAN),
  void 0 !== t.PAN2 && (this.mouseButtons.PAN2 = t.PAN2),
  void 0 !== t.ZOOM && (this.mouseButtons.ZOOM = t.ZOOM)
},
CLOUD.BaseEditor.prototype.getReverseWheelDirection = function() {
  return this.cameraControl.viewer.getReverseWheelDirection()
},
CLOUD.BaseEditor.prototype.getSpeedRate = function() {
  return this.cameraControl.viewer.getMovementSpeedRate()
},
CLOUD.PickHelper = function(t, e) {
  this.cameraControl = e,
  this.scene = t,
  this.timerId = null
},
CLOUD.PickHelper.prototype = {
  constructor: CLOUD.PickHelper,
  destroy: function() {
    this.cameraControl = null,
    this.scene = null,
    this.filter = null
  },
  click: function(t, e) {
    function i() {
      n.handleMousePick(t, !1, e)
    }
    var n = this;
    this.timerId && clearTimeout(this.timerId),
    this.timerId = setTimeout(i, 300)
  },
  doubleClick: function(t) {
    t.preventDefault(),
    this.timerId && clearTimeout(this.timerId),
    this.handleMousePick(t, !0, null)
  },
  handleMousePick: function(t, e, i) {
    function n(i) {
      o.viewer.modelManager.dispatchEvent({
        type: CLOUD.EVENTS.ON_CLICK_PICK,
        event: t,
        doubleClick: e,
        canvasPos: {
          x: c.x,
          y: c.y
        },
        intersectInfo: i
          ? {
            tag: i.tag,
            selectedObjectId: i.userId,
            modelId: i.databagId,
            worldPosition: i.worldPosition,
            worldBoundingBox: i.worldBoundingBox,
            point: i.point,
            index: i.index,
            innnerDebugging: i.innnerDebugging
          }
          : null
      })
    }
    var o = this.cameraControl;
    if (o.enabled === !1)
      return !1;
    if (!e && CLOUD.GlobalData.DisablePick)
      return !1;
    var r,
      a = o.viewer.modelManager.sceneState,
      s = this,
      l = new THREE.Vector2(t.clientX, t.clientY),
      c = o.screenToCanvas(t.clientX, t.clientY);
    if (i)
      r = i;
    else {
      for (var h = this.scene.pickGroups, u = [], d = 0, p = h.length; d < p; ++d) {
        var f = null,
          m = h[d];
        if (m.sceneRoot) {
          var g = o.getIntersectContext(l);
          f = o.intersector.pick(g, null)
        } else
          m.pickEnabled && (f = this.pick(l, o.camera, m)) && (f.tag = m.tag);
        f && u.push(f)
      }
      if (u.length > 0 && (u.sort(function(t, e) {
        return t.distance - e.distance
      }), r = u[0]), !r)
        return void(
          void 0 !== s.lastPickedUserId
          ? (a.clearSelection(), s.lastPickedUserId = void 0, n(null), o.updateView(!0))
          : n(null))
      }
    var v = r.userId;
    s.lastPickedUserId = v,
    CLOUD.Utils.isMobileDevice() && (o.pivot = r.point),
    s.scene.intersectToWorld(r),
    e
      ? CLOUD.GlobalData.EnableDemolishByDClick
        ? (a.addSelection([v]), o.updateView(!0))
        : (a.setSelection([v]), o.fitAndRotateBySelection())
      : (
        r.innnerDebugging = t.altKey, r.cx = l.x, r.cy = l.y, t.ctrlKey
        ? a.addSelection([v])
        : a.setSelection([v]),
      n(r),
      o.updateView(!0))
  },
  handleMouseHover: function(t) {
    if (CLOUD.GlobalData.Hover) {
      var e = this,
        i = this.cameraControl,
        n = i.viewer.getFilters(),
        o = new THREE.Vector2(t.clientX, t.clientY),
        r = i.getIntersectContext(o);
      i.intersector.pick(r, function(t) {
        if (t) {
          var o = t.userId;
          if (e.lastHoverUserId !== o) {
            e.lastHoverUserId = o;
            var r = t.object.material;
            if (r.color) {
              var a = r.color.clone();
              a.r += .3 * a.r,
              a.g += .3 * a.g,
              a.b += .3 * a.b,
              a.r > 1 && (a.r = 1),
              a.g > 1 && (a.g = 1),
              a.b > 1 && (a.b = 1),
              1 === a.r && 1 === a.g && 1 === a.b && (a.r = .87, a.g = .87, a.b = .87);
              var s = {
                color: a.getHex(),
                opacity: r.opacity,
                transparent: r.transparent,
                side: r.side
              };
              n._setHoverMaterial(s),
              n._setHoverId(t.userId),
              i.updateView(!0)
            }
          }
        } else
          void 0 !== e.lastHoverUserId && (e.lastHoverUserId = void 0, n._clearHoverId(), i.updateView(!0))
      })
    }
  },
  pick: function(t, e, i) {
    var n = this.cameraControl.mapWindowToViewport(t.x, t.y),
      o = this.cameraControl.intersector.raycaster;
    o.setFromCamera(n, e);
    var r = o.intersectObjects(i.children, !0),
      a = r.length;
    if (a > 0) {
      r.sort(function(t, e) {
        return t.distance - e.distance
      });
      for (var s = 0; s < a; ++s) {
        var l = r[s];
        if (!(l.distance <= e.near)) {
          var c = l.object;
          if (c.geometry)
            return l.userId = c.name,
            l
        }
      }
    }
    return null
  }
},
CLOUD.OrbitEditor = function(t, e, i) {
  CLOUD.BaseEditor.call(this, t, e, i),
  this.mouseButtons = {
    ORBIT: THREE.MOUSE.RIGHT,
    PAN2: THREE.MOUSE.MIDDLE,
    PAN: THREE.MOUSE.LEFT
  },
  this.isMouseClick = !1,
  this.oldMouseX = -1,
  this.oldMouseY = -1,
  this.timeoutId = null,
  this.intersectOfMouseDown = null
},
CLOUD.OrbitEditor.prototype = Object.create(CLOUD.BaseEditor.prototype),
CLOUD.OrbitEditor.prototype.constructor = CLOUD.OrbitEditor,
CLOUD.OrbitEditor.prototype.destroy = function() {
  CLOUD.BaseEditor.prototype.destroy.call(this),
  this.intersectOfMouseDown = null,
  this.timeoutId = null
},
CLOUD.OrbitEditor.prototype._delayHandle = function() {
  function t() {
    e.update(!0, !0)
  }
  var e = this.cameraControl;
  this.timeoutId && clearTimeout(this.timeoutId),
  this.timeoutId = setTimeout(t, 200),
  e.needUpdateRenderList(!1)
},
CLOUD.OrbitEditor.prototype.onMouseDown = function(t) {
  return this.processMouseDown(t)
},
CLOUD.OrbitEditor.prototype.onMouseMove = function(t) {
  this.processMouseMove(t)
},
CLOUD.OrbitEditor.prototype.onMouseUp = function(t) {
  return this.processMouseUp(t)
},
CLOUD.OrbitEditor.prototype.onMouseWheel = function(t) {
  this.processMouseWheel(t)
},
CLOUD.OrbitEditor.prototype.onMouseDoubleClick = function(t) {},
CLOUD.OrbitEditor.prototype.onKeyDown = function(t) {
  this.processKeyDown(t)
},
CLOUD.OrbitEditor.prototype.onKeyUp = function(t) {
  this.processKeyUp(t)
},
CLOUD.OrbitEditor.prototype.touchstart = function(t) {
  this.processTouchStart(t)
},
CLOUD.OrbitEditor.prototype.touchmove = function(t) {
  this.processTouchMove(t)
},
CLOUD.OrbitEditor.prototype.touchend = function(t) {
  this.processTouchEnd(t)
},
CLOUD.OrbitEditor.prototype.onHover = function(t) {
  this.processMouseHover(t)
},
CLOUD.OrbitEditor.prototype.processMouseDown = function(t) {
  this.isMouseClick = !1,
  this.oldMouseX = t.clientX,
  this.oldMouseY = t.clientY;
  var e = this,
    i = this.cameraControl;
  if (i.enabled === !1)
    return !1;
  if (this.intersectOfMouseDown = null, t.preventDefault(), t.button === e.mouseButtons.ORBIT) {
    if (i.noRotate === !0)
      return !1;
    i.updatePivot({x: t.clientX, y: t.clientY}),
    i.beginRotate(t.clientX, t.clientY)
  } else if (t.button === e.mouseButtons.ZOOM) {
    if (i.noZoom === !0)
      return !1;
    i.beginZoom(t.clientX, t.clientY)
  } else if (t.button === e.mouseButtons.PAN || t.button === e.mouseButtons.PAN2) {
    if (i.noPan === !0)
      return !1;
    i.beginPan(t.clientX, t.clientY),
    this.intersectOfMouseDown = i.getLastIntersect()
  }
  return i.IsIdle() === !1
},
CLOUD.OrbitEditor.prototype.processMouseMove = function(t) {
  var e = this.cameraControl;
  return e.enabled !== !1 && (t.preventDefault(), e.process(t.clientX, t.clientY, !0), !0)
},
CLOUD.OrbitEditor.prototype.processMouseUp = function(t) {
  this.intersectOfMouseDown = null,
  this.oldMouseX == t.clientX && this.oldMouseY == t.clientY
    ? this.isMouseClick = !0
    : (this.oldMouseX = t.clientX, this.oldMouseY = t.clientY);
  var e = this.cameraControl;
  return e.enabled !== !1 && (e.IsIdle() !== !0 && (this.isMouseClick || e.update(!0), e.endOperation(), !0))
},
CLOUD.OrbitEditor.prototype.processMouseWheel = function(t) {
  var e = this.cameraControl;
  if (e.enabled !== !1 && e.noZoom !== !0) {
    t.preventDefault(),
    t.stopPropagation();
    var i = 0;
    t.wheelDelta
      ? i = t.wheelDelta
      : t.detail && (i = 40 * -t.detail),
    i *= 5e-4,
    this.getReverseWheelDirection() && (i *= -1),
    e.zoom(i, t.clientX, t.clientY),
    this._delayHandle()
  }
},
CLOUD.OrbitEditor.prototype.processKeyDown = function(t) {
  var e = this.cameraControl;
  if (e.enabled !== !1 && e.noKeys !== !0 && e.noPan !== !0) {
    this._delayHandle();
    var i = e.movementSpeed * this.getSpeedRate(),
      n = e.keyPanSpeed * this.getSpeedRate();
    switch (t.keyCode) {
      case e.keys.ZERO:
        e.keyPanSpeed = e.defaultKeyPanSpeed,
        e.movementSpeed = e.defaultMovementSpeed;
        break;
      case e.keys.PLUS:
        e.keyPanSpeed *= 1.1,
        e.movementSpeed *= 1.1;
        break;
      case e.keys.SUB:
        e.keyPanSpeed *= .9,
        e.keyPanSpeed < e.minKeyPanSpeed && (e.keyPanSpeed = this.minKeyPanSpeed),
        e.movementSpeed *= .9,
        e.movementSpeed < e.minMovementSpeed && (e.movementSpeed = this.minMovementSpeed);
        break;
      case e.keys.Q:
        e.pan(0, n),
        e.update(!0);
        break;
      case e.keys.E:
        e.pan(0, -n),
        e.update(!0);
        break;
      case e.keys.LEFT:
      case e.keys.A:
        e.pan(n, 0),
        e.update(!0);
        break;
      case e.keys.RIGHT:
      case e.keys.D:
        e.pan(-n, 0),
        e.update(!0);
        break;
      case e.keys.UP:
      case e.keys.W:
        e.moveForward(i, !t.shiftKey),
        e.update(!0);
        break;
      case e.keys.DOWN:
      case e.keys.S:
        e.moveBackward(i, !t.shiftKey),
        e.update(!0)
    }
  }
},
CLOUD.OrbitEditor.prototype.processKeyUp = function(t) {
  var e = this.cameraControl;
  if (e.enabled !== !1 && e.noKeys !== !0 && e.noPan !== !0)
    switch (t.keyCode) {
      case e.keys.ESC:
        this.clearSelection()
    }
  },
CLOUD.OrbitEditor.prototype.processTouchStart = function(t) {
  var e = this.cameraControl;
  e.enabled !== !1 && e.touchStartHandler(t)
},
CLOUD.OrbitEditor.prototype.processTouchMove = function(t) {
  var e = this.cameraControl;
  e.enabled !== !1 && (t.preventDefault(), e.touchMoveHandler(t))
},
CLOUD.OrbitEditor.prototype.processTouchEnd = function(t) {
  var e = this.cameraControl;
  e.enabled !== !1 && e.touchEndHandler(t)
},
CLOUD.OrbitEditor.prototype.processMouseHover = function(t) {
  this.pickHelper.handleMouseHover(t)
},
CLOUD.OrbitEditor.prototype.moveTo = function(t) {
  if (void 0 !== t) {
    var e = this.cameraControl;
    if (e.enabled !== !1 && e.noKeys !== !0 && e.noPan !== !0) {
      var i = e.movementSpeed * this.getSpeedRate(),
        n = e.keyPanSpeed * this.getSpeedRate(),
        o = CLOUD.MoveDirection;
      switch (t) {
        case o.FORWARD:
          e.moveForward(i, !0);
          break;
        case o.BACK:
          e.moveBackward(i, !0);
          break;
        case o.LEFT:
          e.pan(n, 0);
          break;
        case o.RIGHT:
          e.pan(-n, 0);
          break;
        case o.UP:
          e.pan(0, n);
          break;
        case o.DOWN:
          e.pan(0, -n);
          break;
        default:
          t = o.NONE
      }
      t !== o.NONE && e.update(!0, !0)
    }
  }
},
CLOUD.OrbitEditor.prototype.clearSelection = function() {
  this.cameraControl.viewer.filter.clearIdList(CLOUD.EnumIdBasedType.SELECTED),
  this.dispatchEvent({type: CLOUD.EVENTS.ON_SELECTION_CHANGED, intersect: null, click: 1})
},
CLOUD.PickEditor = function(t, e, i) {
  CLOUD.OrbitEditor.call(this, t, e, i)
},
CLOUD.PickEditor.prototype = Object.create(CLOUD.OrbitEditor.prototype),
CLOUD.PickEditor.prototype.constructor = CLOUD.PickEditor,
CLOUD.PickEditor.prototype.processMouseUp = function(t) {
  this.oldMouseX == t.clientX && this.oldMouseY == t.clientY
    ? this.pickHelper.click(t, this.intersectOfMouseDown)
    : this.cameraControl.update(!0),
  this.intersectOfMouseDown = null
},
CLOUD.PickEditor.prototype.onMouseUp = function(t) {
  t.preventDefault(),
  t.button === THREE.MOUSE.LEFT && this.processMouseUp(t),
  this.cameraControl.setState(-1)
},
CLOUD.PickEditor.prototype.onMouseDoubleClick = function(t) {
  t.button === THREE.MOUSE.LEFT && this.pickHelper.doubleClick(t)
},
CLOUD.RectPickEditor = function(t, e, i) {
  CLOUD.OrbitEditor.call(this, t, e, i),
  this.startPt = new THREE.Vector2,
  this.endPt = new THREE.Vector2,
  this.frustum = new THREE.Frustum,
  this.timeId = null,
  this.longTapFlag = !1,
  CLOUD.Utils.isMobileDevice()
    ? this.selectPad = new CLOUD.SelectPad(this)
    : this.selectPad = null;
  var n = this;
  this.longTap = function() {
    n.longTapFlag = !0,
    CLOUD.Logger.log("long tap"),
    n.selectPad && n.selectPad.showOverlay(n.startPt)
  }
},
CLOUD.RectPickEditor.prototype = Object.create(CLOUD.OrbitEditor.prototype),
CLOUD.RectPickEditor.prototype.constructor = CLOUD.RectPickEditor,
CLOUD.RectPickEditor.prototype.destroy = function() {
  CLOUD.OrbitEditor.prototype.destroy.call(this),
  this.selectPad && (this.selectPad = null),
  this.startPt = null,
  this.endPt = null,
  this.frustum = null,
  this.timeId = null
},
CLOUD.RectPickEditor.prototype.onUpdateUI = function(t) {
  this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_UPDATEUI, data: t, editor: this.name})
},
CLOUD.RectPickEditor.prototype.getDomElement = function() {
  return this.domElement
},
CLOUD.RectPickEditor.prototype.updateFrustum = function(t, e) {
  var i = this.startPt.x,
    n = this.endPt.x,
    o = this.startPt.y,
    r = this.endPt.y;
  if (i > n) {
    var a = i;
    i = n,
    n = a
  }
  if (o > r) {
    var s = o;
    o = r,
    r = s
  }
  if (n - i == 0 || r - o == 0)
    return !1;
  var l = this.cameraControl,
    c = l.getContainerDimensions();
  return t && l.computeFrustum(i, n, o, r, this.frustum, c),
  e && this.onUpdateUI({
    visible: !0,
    dir: this.startPt.x < this.endPt.x,
    left: i - c.left,
    top: o - c.top,
    width: n - i,
    height: r - o
  }),
  !0
},
CLOUD.RectPickEditor.prototype.onMouseDoubleClick = function(t) {
  this.pickHelper.doubleClick(t)
},
CLOUD.RectPickEditor.prototype.onMouseDown = function(t) {
  return t.preventDefault(),
  t.button === THREE.MOUSE.LEFT && this.startPt.set(t.clientX, t.clientY),
  this.processMouseDown(t)
},
CLOUD.RectPickEditor.prototype.onMouseMove = function(t) {
  if (t.preventDefault(), (t.shiftKey || t.ctrlKey || t.altKey) && t.button === THREE.MOUSE.LEFT)
    return this.endPt.set(t.clientX, t.clientY),
    this.updateFrustum(!1, !0),
    !0;
  this.processMouseMove(t)
},
CLOUD.RectPickEditor.prototype.onMouseUp = function(t) {
  if (t.preventDefault(), this.onUpdateUI({
    visible: !1
  }), t.button === THREE.MOUSE.LEFT) {
    if (Math.abs(this.startPt.x - t.clientX) < 2 && Math.abs(this.startPt.y - t.clientY) < 2)
      return this.pickHelper.click(t, this.intersectOfMouseDown),
      this.intersectOfMouseDown = null,
      !0;
    if (t.shiftKey || t.ctrlKey || t.altKey) {
      if (this.endPt.set(t.clientX, t.clientY), !this.updateFrustum(!0, !1))
        return this.pickHelper.click(t),
        !1;
      var e = CLOUD.OPSELECTIONTYPE.Clear;
      return t.ctrlKey
        ? e = CLOUD.OPSELECTIONTYPE.Add
        : t.altKey && (e = CLOUD.OPSELECTIONTYPE.Remove),
      CLOUD.PickUtil.pickByRect(this.scene, this.frustum, e, this.cameraControl.viewer.modelManager),
      this.pickHelper.lastPickedUserId = "",
      this.cameraControl.updateView(!0),
      !0
    }
  }
  return this.processMouseUp(t)
},
CLOUD.RectPickEditor.prototype.touchstart = function(t) {
  this.startPt.set(t.touches[0].clientX, t.touches[0].clientY),
  this.processTouchStart(t),
  this.timeId && clearTimeout(this.timeId);
  var e = this;
  e.timeId = setTimeout(e.longTap, 400),
  this.selectPad && this.selectPad.hideOverlay()
},
CLOUD.RectPickEditor.prototype.touchmove = function(t) {
  this.timeId && clearTimeout(this.timeId),
  t.preventDefault(),
  t.stopPropagation(),
  this.processTouchMove(t)
},
CLOUD.RectPickEditor.prototype.touchend = function(t) {
  this.processTouchEnd(t),
  this.timeId && clearTimeout(this.timeId),
  this.longTapFlag && (this.longTapFlag = !1, t.preventDefault())
},
CLOUD.ZoomEditor = function(t, e, i) {
  CLOUD.OrbitEditor.call(this, t, e, i),
  this.mouseButtons = {
    ZOOM: THREE.MOUSE.LEFT,
    PAN2: THREE.MOUSE.MIDDLE,
    PAN: THREE.MOUSE.RIGHT
  }
},
CLOUD.ZoomEditor.prototype = Object.create(CLOUD.OrbitEditor.prototype),
CLOUD.ZoomEditor.prototype.constructor = CLOUD.ZoomEditor,
CLOUD.ZoomEditor.prototype.updateButtons = function() {},
CLOUD.RectZoomEditor = function(t, e, i) {
  CLOUD.OrbitEditor.call(this, t, e, i),
  this.startPt = new THREE.Vector2,
  this.endPt = new THREE.Vector2,
  this.frustum = new THREE.Frustum,
  this.activateZoom = !1
},
CLOUD.RectZoomEditor.prototype = Object.create(CLOUD.OrbitEditor.prototype),
CLOUD.RectZoomEditor.prototype.constructor = CLOUD.RectZoomEditor,
CLOUD.RectZoomEditor.prototype.onUpdateUI = function(t) {
  this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_UPDATEUI, data: t, editor: this.name})
},
CLOUD.RectZoomEditor.prototype.updateFrustum = function(t, e) {
  var i = this.startPt.x,
    n = this.endPt.x,
    o = this.startPt.y,
    r = this.endPt.y;
  if (i > n) {
    var a = i;
    i = n,
    n = a
  }
  if (o > r) {
    var s = o;
    o = r,
    r = s
  }
  if (n - i == 0 || r - o == 0)
    return !1;
  var l = this.cameraControl,
    c = l.getContainerDimensions();
  return t && l.computeFrustum(i, n, o, r, this.frustum, c),
  e && this.onUpdateUI({
    visible: !0,
    dir: this.startPt.x < this.endPt.x,
    left: i - c.left,
    top: o - c.top,
    width: n - i,
    height: r - o
  }),
  !0
},
CLOUD.RectZoomEditor.prototype.onMouseDown = function(t) {
  return t.preventDefault(),
  t.stopPropagation(),
  t.button === THREE.MOUSE.LEFT && (this.startPt.set(t.clientX, t.clientY), this.activateZoom = !0),
  this.processMouseDown(t)
},
CLOUD.RectZoomEditor.prototype.onMouseMove = function(t) {
  if (t.preventDefault(), this.activateZoom)
    return this.endPt.set(t.clientX, t.clientY),
    this.updateFrustum(!1, !0),
    !0;
  this.processMouseMove(t)
},
CLOUD.RectZoomEditor.prototype.onMouseUp = function(t) {
  return t.preventDefault(),
  t.stopPropagation(),
  this.activateZoom = !1,
  this.onUpdateUI({
    visible: !1
  }),
  t.button === THREE.MOUSE.LEFT
    ? this.startPt.x == t.clientX && this.startPt.y == t.clientY || (this.endPt.set(t.clientX, t.clientY), !!this.updateFrustum(!0, !1) && (this.zoomToRectangle(), !0))
    : this.processMouseUp(t)
},
CLOUD.RectZoomEditor.prototype.zoomToRectangle = function() {
  var t = this.cameraControl.camera,
    e = this.cameraControl.camera.target,
    i = (t.near, this.cameraControl.getContainerDimensions()),
    n = this.startPt.x,
    o = this.startPt.y,
    r = this.endPt.x,
    a = this.endPt.y,
    s = Math.abs(r - n),
    l = Math.abs(o - a);
  if (0 !== s && 0 !== l) {
    var c,
      h = new THREE.Vector2((n + r) / 2, (o + a) / 2),
      u = t.position.clone(),
      d = e.clone().sub(u),
      p = d.length(),
      f = this.cameraControl.getIntersectContext(h),
      m = this.cameraControl.intersector.hitTest(f);
    if (m) {
      var g = s / l > i.width / i.height
          ? s / i.width
          : l / i.height,
        v = m.distanceTo(u),
        y = v * g;
      d.normalize(),
      c = d.clone().negate().multiplyScalar(y)
    } else {
      var E = {};
      E.left = Math.min(n, r),
      E.top = Math.min(o, a),
      E.right = Math.max(n, r),
      E.bottom = Math.max(o, a);
      var x = this.scene.getNearDepthByRect(this.frustum, t);
      if (1 / 0 === x)
        return;
      var b = new THREE.Vector3((n + r) / 2, (o + a) / 2, x),
        w = new THREE.Vector3(E.left, E.top, x),
        C = this.clientToWorld(b),
        T = this.clientToWorld(w),
        y = C.clone().sub(T).length();
      m = C.clone(),
      d.normalize(),
      c = d.clone().negate().multiplyScalar(y)
    }
    u = m.clone().add(c),
    t.position.copy(u),
    e.copy(u).sub(c.clone().normalize().multiplyScalar(p)),
    this.cameraControl.updateView(!0)
  }
},
CLOUD.RectZoomEditor.prototype.worldToClient = function(t) {
  var e = this.cameraControl.camera,
    i = new THREE.Vector3(t.x, t.y, t.z);
  return i.project(e),
  i
},
CLOUD.RectZoomEditor.prototype.clientToWorld = function(t) {
  var e = this.cameraControl.getContainerDimensions(),
    i = this.cameraControl.camera,
    n = new THREE.Vector3;
  return n.x = t.x / e.width * 2 - 1,
  n.y = -t.y / e.height * 2 + 1,
  n.z = t.z,
  n.unproject(i),
  n
},
CLOUD.PanEditor = function(t, e, i) {
  CLOUD.OrbitEditor.call(this, t, e, i)
},
CLOUD.PanEditor.prototype = Object.create(CLOUD.OrbitEditor.prototype),
CLOUD.PanEditor.prototype.constructor = CLOUD.PanEditor,
CLOUD.PanEditor.prototype.updateButtons = function() {},
CLOUD.FlyEditor = function(t, e, i) {
  CLOUD.BaseEditor.call(this, t, e, i),
  this.movementSpeed = .005 * CLOUD.GlobalData.SceneSize,
  this.defaultMovementSpeed = this.movementSpeed,
  this.minMovementSpeed = .001,
  this.lookSpeed = .001,
  this.constrainPitch = !0,
  this.pitchMin = THREE.Math.degToRad(5) - .5 * Math.PI,
  this.pitchMax = .5 * Math.PI - this.pitchMin,
  this.pitchDeltaTotal = 0,
  this.processState = {
    NONE: -1,
    ROTATE: 0,
    DOLLY: 1,
    PAN: 2
  },
  this.currentProcessState = this.processState.NONE,
  this.moveState = CLOUD.MoveDirection.NONE,
  this.deltaYaw = 0,
  this.deltaPitch = 0,
  this.rotateStart = new THREE.Vector2,
  this.rotateEnd = new THREE.Vector2,
  this.rotateDelta = new THREE.Vector2,
  this.lastMousePoint = new THREE.Vector2,
  this.timeoutId = null,
  this.isLockHeight = !1,
  this.lockedHeight = 0,
  this.pickHelper = new CLOUD.PickHelper(e, t),
  this.intersectOfMouseDown = null
},
CLOUD.FlyEditor.prototype = Object.create(CLOUD.BaseEditor.prototype),
CLOUD.FlyEditor.prototype.constructor = CLOUD.FlyEditor,
CLOUD.FlyEditor.prototype._update = function() {
  var t = this.movementSpeed * this.getSpeedRate(),
    e = this.cameraControl,
    i = e.camera,
    n = i.position,
    o = i.target,
    r = o.clone().sub(n);
  e.dirtyCamera(!0);
  var a = CLOUD.MoveDirection;
  this.moveState & a.FORWARD && this._goForward(t),
  this.moveState & a.BACK && this._goBack(t),
  this.moveState & a.LEFT && this._goLeft(t),
  this.moveState & a.RIGHT && this._goRight(t),
  this.moveState & a.UP && this._goUp(t),
  this.moveState & a.DOWN && this._goDown(t),
  this.cameraControl.isConstrainedAxisZ && (this.deltaPitch = 0);
  var s = new THREE.Vector3(0, 1, 0),
    l = i.realUp || i.up,
    c = r.clone().cross(l).normalize();
  if (0 != this.deltaPitch) {
    var h = (new THREE.Quaternion).setFromAxisAngle(c, -this.deltaPitch),
      u = r.clone();
    u.applyQuaternion(h);
    var d = u.angleTo(s);
    d -= .5 * Math.PI,
    d >= this.pitchMin && d <= this.pitchMax && r.applyQuaternion(h),
    this.deltaPitch = 0
  }
  if (0 != this.deltaYaw) {
    var p = (new THREE.Quaternion).setFromAxisAngle(s, -this.deltaYaw);
    r.applyQuaternion(p),
    this.deltaYaw = 0
  }
  o.addVectors(n, r),
  e.flyOnWorld(),
  e.dirtyCamera(!1)
},
CLOUD.FlyEditor.prototype._goForward = function(t) {
  this.cameraControl.camera.translateZ(-t)
},
CLOUD.FlyEditor.prototype._goBack = function(t) {
  this.cameraControl.camera.translateZ(t)
},
CLOUD.FlyEditor.prototype._goLeft = function(t) {
  this.cameraControl.camera.translateX(-t)
},
CLOUD.FlyEditor.prototype._goRight = function(t) {
  this.cameraControl.camera.translateX(t)
},
CLOUD.FlyEditor.prototype._goUp = function(t) {
  this.cameraControl.camera.translateY(t)
},
CLOUD.FlyEditor.prototype._goDown = function(t) {
  this.cameraControl.camera.translateY(-t)
},
CLOUD.FlyEditor.prototype._goTurn = function(t) {
  var e = this.cameraControl.camera.position,
    i = this.cameraControl.camera.target,
    n = new THREE.Vector3(i.x - e.x, 0, i.z - e.z),
    o = Math.cos(t),
    r = Math.sin(t),
    a = new THREE.Vector3(n.x * o - n.z * r, 0, n.x * r + n.z * o);
  i.x = e.x + a.x,
  i.z = e.z + a.z
},
CLOUD.FlyEditor.prototype._goPitch = function(t) {
  var e = this.cameraControl.camera.position,
    i = this.cameraControl.camera.target,
    n = i.x - e.x,
    o = i.z - e.z,
    r = Math.sqrt(n * n + o * o),
    a = new THREE.Vector3(r, i.y - e.y, 0),
    s = Math.cos(t),
    l = Math.sin(t),
    c = new THREE.Vector3(a.x * s - a.y * l, a.x * l + a.y * s, 0),
    h = c.x / r;
  i.x = e.x + h * n,
  i.y = e.y + c.y,
  i.z = e.z + h * o
},
CLOUD.FlyEditor.prototype._delayHandle = function() {
  function t() {
    e.needUpdateRenderList(!0),
    e.flyOnWorld()
  }
  var e = this.cameraControl;
  this.timeoutId && clearTimeout(this.timeoutId),
  this.timeoutId = setTimeout(t, 200),
  e.needUpdateRenderList(!1)
},
CLOUD.FlyEditor.prototype.destroy = function() {
  this.cameraControl = null,
  this.scene = null,
  this.domElement = null
},
CLOUD.FlyEditor.prototype.handleEvent = function(t) {
  "function" == typeof this[t.type] && this[t.type](t)
},
CLOUD.FlyEditor.prototype.onKeyDown = function(t) {
  this.processKeyDown(t)
},
CLOUD.FlyEditor.prototype.onKeyUp = function(t) {
  this.processKeyUp(t)
},
CLOUD.FlyEditor.prototype.onMouseDown = function(t) {
  return this.lastMousePoint.set(t.clientX, t.clientY),
  this.processMouseDown(t)
},
CLOUD.FlyEditor.prototype.onMouseMove = function(t) {
  this.processMouseMove(t)
},
CLOUD.FlyEditor.prototype.onMouseUp = function(t) {
  return t.button === THREE.MOUSE.LEFT && this.lastMousePoint.x === t.clientX && this.lastMousePoint.y === t.clientY
    ? (this.pickHelper.click(t, this.intersectOfMouseDown), !0)
    : (this.intersectOfMouseDown = null, this.processMouseUp(t))
},
CLOUD.FlyEditor.prototype.onMouseWheel = function(t) {
  this.processMouseWheel(t)
},
CLOUD.FlyEditor.prototype.processMouseDown = function(t) {
  t.preventDefault(),
  t.stopPropagation();
  var e = this.cameraControl;
  if (e.enabled === !1)
    return !1;
  this.intersectOfMouseDown = null;
  var i = this.processState;
  if (t.button === this.mouseButtons.ORBIT)
    this.rotateStart.set(t.clientX, t.clientY),
    this.currentProcessState = i.ROTATE,
    this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_BEGIN, name: "look", editor: this.name});
  else if (t.button === this.mouseButtons.PAN || t.button === this.mouseButtons.PAN2) {
    if (e.noPan === !0)
      return !1;
    e.beginPan(t.clientX, t.clientY),
    this.intersectOfMouseDown = e.getLastIntersect(),
    this.currentProcessState = i.PAN,
    this.isLockHeight && (this.lockedHeight = t.clientY)
  }
  return !0
},
CLOUD.FlyEditor.prototype.processMouseMove = function(t) {
  if (this.cameraControl.enabled !== !1) {
    t.preventDefault();
    var e = this.currentProcessState,
      i = this.processState;
    e === i.ROTATE
      ? (this.rotateEnd.set(t.clientX, t.clientY), this.rotateDelta.subVectors(this.rotateEnd, this.rotateStart), this.rotateStart.copy(this.rotateEnd), 0 == this.rotateDelta.x && 0 == this.rotateDelta.y || (this.deltaYaw += this.rotateDelta.x * this.lookSpeed, this.deltaPitch += this.rotateDelta.y * this.lookSpeed, this.isFirstPerson = !t.shiftKey, this._update()))
      : e === i.PAN && (
        this.isLockHeight
        ? this.cameraControl.process(t.clientX, this.lockedHeight, !0)
        : this.cameraControl.process(t.clientX, t.clientY, !0))
  }
},
CLOUD.FlyEditor.prototype.processMouseUp = function(t) {
  t.preventDefault(),
  t.stopPropagation();
  var e = this.cameraControl;
  return t.button === this.mouseButtons.ORBIT
    ? (this.rotateDelta.set(0, 0), this.deltaYaw = 0, this.deltaPitch = 0, this.isFirstPerson = !t.shiftKey, this._update(), this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_END, name: "look", editor: this.name}))
    : t.button === this.mouseButtons.PAN && (
      this.isLockHeight
      ? e.process(t.clientX, this.lockedHeight, !0)
      : e.process(t.clientX, t.clientY, !0),
    e.endOperation()),
  this.currentProcessState = this.processState.NONE,
  !0
},
CLOUD.FlyEditor.prototype.processMouseWheel = function(t) {
  t.preventDefault(),
  t.stopPropagation();
  var e = this.cameraControl;
  if (e.enabled !== !1 && e.noZoom !== !0) {
    var i = t.wheelDelta || t.detail;
    i = Math.abs(i) > 10
      ? i
      : 40 * -i,
    i *= 5e-4,
    this.getReverseWheelDirection() && (i *= -1),
    this._delayHandle();
    var n = e.getContainerDimensions(),
      o = n.left + .5 * n.width,
      r = n.top + .5 * n.height;
    e.zoom(i, o, r)
  }
},
CLOUD.FlyEditor.prototype.processKeyDown = function(t) {
  if (!t.altKey) {
    var e = CLOUD.MoveDirection,
      i = e.NONE;
    switch (t.keyCode) {
      case 48:
        this.movementSpeed = this.defaultMovementSpeed;
        break;
      case 187:
        this.movementSpeed *= 1.1;
        break;
      case 189:
        this.movementSpeed *= .9,
        this.movementSpeed < this.minMovementSpeed && (this.movementSpeed = this.minMovementSpeed);
        break;
      case 38:
      case 87:
        i = e.FORWARD;
        break;
      case 40:
      case 83:
        i = e.BACK;
        break;
      case 37:
      case 65:
        i = e.LEFT;
        break;
      case 39:
      case 68:
        i = e.RIGHT;
        break;
      case 81:
        i = e.UP;
        break;
      case 69:
        i = e.DOWN
    }
    i !== e.NONE && (this.moveState |= i, this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_KEYUP, event: t, state: i, direction: e, editor: this.name})),
    this._delayHandle(),
    this.isFirstPerson = !t.shiftKey,
    this._update()
  }
},
CLOUD.FlyEditor.prototype.processKeyUp = function(t) {
  var e = CLOUD.MoveDirection,
    i = e.NONE;
  switch (t.keyCode) {
    case 38:
    case 87:
      i = e.FORWARD;
      break;
    case 40:
    case 83:
      i = e.BACK;
      break;
    case 37:
    case 65:
      i = e.LEFT;
      break;
    case 39:
    case 68:
      i = e.RIGHT;
      break;
    case 81:
      i = e.UP;
      break;
    case 69:
      i = e.DOWN
  }
  i !== e.NONE && (this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_KEYUP, event: t, state: i, direction: e, editor: this.name}), this.moveState &=~ i)
};
CLOUD.FlyEditor.prototype.moveTo = function(t) {
  this.moveState = t,
  this._update(),
  this.moveState = CLOUD.MoveDirection.NONE
},
CLOUD.WalkEditor = function(t, e, i) {
  CLOUD.BaseEditor.call(this, t, e, i),
  this.mouseButtons = {
    ORBIT: THREE.MOUSE.LEFT,
    PAN2: THREE.MOUSE.MIDDLE,
    PAN: THREE.MOUSE.RIGHT
  },
  this.mouseMoveAlwaysAllowed = !0,
  this.movementSpeed = 1e3,
  this.defaultMovementSpeed = this.movementSpeed,
  this.minMovementSpeed = .001,
  this.lookSpeed = .001,
  this.constrainPitch = !0,
  this.pitchMin = THREE.Math.degToRad(5) - .5 * Math.PI,
  this.pitchMax = .5 * Math.PI - this.pitchMin,
  this.pitchDeltaTotal = 0,
  this.processState = {
    NONE: -1,
    ROTATE: 0,
    DOLLY: 1,
    PAN: 2
  },
  this.currentProcessState = this.processState.NONE,
  this.moveState = CLOUD.MoveDirection.NONE,
  this.deltaYaw = 0,
  this.deltaPitch = 0,
  this.rotateStart = new THREE.Vector2,
  this.rotateEnd = new THREE.Vector2,
  this.rotateDelta = new THREE.Vector2,
  this.lastMousePoint = new THREE.Vector2,
  this.timeoutId = null,
  this.isLockHeight = !1,
  this.lockedHeight = 0,
  this.isLookMousePressed = !0,
  this.firstMouseMove = !0,
  this.mousePressed = !1,
  this.delayTime = 200
},
CLOUD.WalkEditor.prototype = Object.create(CLOUD.BaseEditor.prototype),
CLOUD.WalkEditor.prototype.constructor = CLOUD.WalkEditor,
CLOUD.WalkEditor.prototype.updateButtons = function() {},
CLOUD.WalkEditor.prototype.getStepDiff = function(t, e, i, n) {
  var o = new THREE.Matrix4;
  o.getInverse(e);
  var r = new THREE.Vector3(t.position.x, t.position.y, t.position.z),
    a = r.clone();
  a.applyMatrix4(o);
  var s = new THREE.Vector3(i.x, i.y, i.z);
  return s.add(r),
  s.applyMatrix4(o),
  s.sub(a).normalize().multiplyScalar(n),
  s.add(a),
  s.applyMatrix4(e),
  s.sub(r),
  s
},
CLOUD.WalkEditor.prototype.stepCameraForWalk = function(t, e) {
  var i,
    n = this.cameraControl.getCamera(),
    o = n.position,
    r = n.target,
    a = new THREE.Vector3(r.x - o.x, 0, r.z - o.z).normalize(),
    s = new THREE.Vector3(0, 1, 0),
    l = a.clone().cross(s),
    c = this.cameraControl.getScene().getMatrixGlobal();
  switch (t) {
    case CLOUD.MoveDirection.FORWARD:
      i = this.getStepDiff(n, c, a, e),
      i.y = 0;
      break;
    case CLOUD.MoveDirection.BACK:
      a.multiplyScalar(-1),
      i = this.getStepDiff(n, c, a, e),
      i.y = 0;
      break;
    case CLOUD.MoveDirection.LEFT:
      l.multiplyScalar(-1),
      i = this.getStepDiff(n, c, l, e),
      i.y = 0;
      break;
    case CLOUD.MoveDirection.RIGHT:
      i = this.getStepDiff(n, c, l, e),
      i.y = 0
  }
  o.add(i),
  r.add(i)
},
CLOUD.WalkEditor.prototype._goUp = function(t) {
  var e = this.cameraControl.getCamera(),
    i = e.position,
    n = e.target,
    o = new THREE.Vector3(0, 1, 0),
    r = this.cameraControl.getScene().getMatrixGlobal(),
    a = this.getStepDiff(e, r, o, t);
  i.y += a.y,
  n.y += a.y
},
CLOUD.WalkEditor.prototype._goDown = function(t) {
  var e = this.cameraControl.getCamera(),
    i = e.position,
    n = e.target,
    o = new THREE.Vector3(0, 1, 0),
    r = this.cameraControl.getScene().getMatrixGlobal(),
    a = this.getStepDiff(e, r, o, t);
  i.y -= a.y,
  n.y -= a.y
},
CLOUD.WalkEditor.prototype._goTurn = function(t) {
  var e = this.cameraControl.getCamera(),
    i = e.position,
    n = e.target,
    o = new THREE.Vector3(n.x - i.x, 0, n.z - i.z),
    r = Math.cos(t),
    a = Math.sin(t),
    s = new THREE.Vector3(o.x * r - o.z * a, 0, o.x * a + o.z * r);
  n.x = i.x + s.x,
  n.z = i.z + s.z
},
CLOUD.WalkEditor.prototype._goPitch = function(t) {
  var e = this.cameraControl.getCamera(),
    i = e.position,
    n = e.target,
    o = n.x - i.x,
    r = n.z - i.z,
    a = Math.sqrt(o * o + r * r),
    s = new THREE.Vector3(a, n.y - i.y, 0),
    l = Math.cos(t),
    c = Math.sin(t),
    h = new THREE.Vector3(s.x * l - s.y * c, s.x * c + s.y * l, 0);
  n.y = i.y + h.y
},
CLOUD.WalkEditor.prototype._delayHandle = function() {
  function t() {
    e.needUpdateRenderList(!0),
    e.flyOnWorld()
  }
  var e = this.cameraControl;
  this.timeoutId && clearTimeout(this.timeoutId),
  this.timeoutId = setTimeout(t, this.delayTime),
  e.needUpdateRenderList(!1)
},
CLOUD.WalkEditor.prototype.destroy = function() {
  CLOUD.BaseEditor.prototype.destroy.call(this),
  this.rotateStart = null,
  this.rotateEnd = null,
  this.rotateDelta = null,
  this.lastMousePoint = null,
  this.timeoutId = null
},
CLOUD.WalkEditor.prototype.handleEvent = function(t) {
  "function" == typeof this[t.type] && this[t.type](t)
},
CLOUD.WalkEditor.prototype.onKeyDown = function(t) {
  this.processKeyDown(t)
},
CLOUD.WalkEditor.prototype.onKeyUp = function(t) {
  this.processKeyUp(t)
},
CLOUD.WalkEditor.prototype.onMouseDown = function(t) {
  return this.lastMousePoint.set(t.clientX, t.clientY),
  this.mousePressed = !0,
  this.firstMouseMove = !0,
  this.processMouseDown(t)
},
CLOUD.WalkEditor.prototype.onMouseMove = function(t) {
  this.processMouseMove(t)
},
CLOUD.WalkEditor.prototype.onMouseUp = function(t) {
  return this.mousePressed = !1,
  t.button === THREE.MOUSE.LEFT && Math.abs(this.lastMousePoint.x - t.clientX) < 2 && Math.abs(this.lastMousePoint.y - t.clientY) < 2
    ? (this.pickHelper.click(t), !0)
    : this.processMouseUp(t)
},
CLOUD.WalkEditor.prototype.onMouseWheel = function(t) {
  this.processMouseWheel(t)
},
CLOUD.WalkEditor.prototype.processMouseDown = function(t) {
  if (t.preventDefault(), t.stopPropagation(), this.cameraControl.enabled === !1)
    return !1;
  var e = this.processState;
  return t.button === this.mouseButtons.ORBIT && (this.rotateStart.set(t.clientX, t.clientY), this.currentProcessState = e.ROTATE, this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_BEGIN, name: "look", editor: this.name})),
  !0
},
CLOUD.WalkEditor.prototype.processMouseMove = function(t) {
  if (this.cameraControl.enabled !== !1) {
    t.preventDefault();
    var e = !1;
    this.isLookMousePressed
      ? this.mousePressed && (e = !0)
      : this.mousePressed || (this.firstMouseMove && (this.firstMouseMove = !1, this.rotateStart.set(t.clientX, t.clientY)), this.currentProcessState = this.processState.ROTATE, e = !0),
    e && this.currentProcessState === this.processState.ROTATE && (this.rotateEnd.set(t.clientX, t.clientY), this.rotateDelta.subVectors(this.rotateEnd, this.rotateStart), this.rotateStart.copy(this.rotateEnd), 0 == this.rotateDelta.x && 0 == this.rotateDelta.y || (this.deltaYaw += this.rotateDelta.x * this.lookSpeed, this.deltaPitch += this.rotateDelta.y * this.lookSpeed, this.update()))
  }
},
CLOUD.WalkEditor.prototype.processMouseUp = function(t) {
  if (t.preventDefault(), t.stopPropagation(), this.cameraControl.enabled !== !1)
    return this.currentProcessState === this.processState.ROTATE && (this.rotateDelta.set(0, 0), this.deltaYaw = 0, this.deltaPitch = 0, this.update(), this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_END, name: "look", editor: this.name})),
    this.currentProcessState = this.processState.NONE,
    !0
},
CLOUD.WalkEditor.prototype.processMouseWheel = function(t) {
  t.preventDefault(),
  t.stopPropagation();
  var e = this.cameraControl;
  if (e.enabled !== !1 && e.noZoom !== !0) {
    var i = t.wheelDelta || t.detail;
    i = Math.abs(i) > 10
      ? i
      : 40 * -i,
    i *= 5e-4,
    this.getReverseWheelDirection() && (i *= -1),
    this._delayHandle();
    var n = e.getContainerDimensions(),
      o = n.left + .5 * n.width,
      r = n.top + .5 * n.height;
    e.zoom(i, o, r)
  }
},
CLOUD.WalkEditor.prototype.processKeyDown = function(t) {
  if (!t.altKey) {
    var e = CLOUD.MoveDirection,
      i = e.NONE,
      n = this.cameraControl.keys;
    switch (t.keyCode) {
      case n.ZERO:
        this.movementSpeed = this.defaultMovementSpeed;
        break;
      case n.PLUS:
        this.movementSpeed *= 1.1;
        break;
      case n.SUB:
        this.movementSpeed *= .9,
        this.movementSpeed < this.minMovementSpeed && (this.movementSpeed = this.minMovementSpeed);
        break;
      case n.UP:
      case n.W:
        i = e.FORWARD;
        break;
      case n.DOWN:
      case n.S:
        i = e.BACK;
        break;
      case n.LEFT:
      case n.A:
        i = e.LEFT;
        break;
      case n.RIGHT:
      case n.D:
        i = e.RIGHT;
        break;
      case n.Q:
        i = e.UP;
        break;
      case n.E:
        i = e.DOWN
    }
    i !== e.NONE && (this.moveState |= i, this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_KEYUP, event: t, state: i, direction: e, editor: this.name})),
    this._delayHandle(),
    this.update()
  }
},
CLOUD.WalkEditor.prototype.processKeyUp = function(t) {
  var e = CLOUD.MoveDirection,
    i = e.NONE,
    n = this.cameraControl.keys;
  switch (t.keyCode) {
    case n.UP:
    case n.W:
      i = e.FORWARD;
      break;
    case n.DOWN:
    case n.S:
      i = e.BACK;
      break;
    case n.LEFT:
    case n.A:
      i = e.LEFT;
      break;
    case n.RIGHT:
    case n.D:
      i = e.RIGHT;
      break;
    case n.Q:
      i = e.UP;
      break;
    case n.E:
      i = e.DOWN
  }
  i !== e.NONE && (this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_KEYUP, event: t, state: i, direction: e, editor: this.name}), this.moveState &=~ i)
},
CLOUD.WalkEditor.prototype.update = function() {
  var t = this.movementSpeed * this.getSpeedRate(),
    e = this.cameraControl;
  e.dirtyCamera(!0);
  var i = CLOUD.MoveDirection;
  this.moveState & i.FORWARD && this.stepCameraForWalk(CLOUD.MoveDirection.FORWARD, t),
  this.moveState & i.BACK && this.stepCameraForWalk(CLOUD.MoveDirection.BACK, t),
  this.moveState & i.LEFT && this.stepCameraForWalk(CLOUD.MoveDirection.LEFT, t),
  this.moveState & i.RIGHT && this.stepCameraForWalk(CLOUD.MoveDirection.RIGHT, t),
  this.moveState & i.UP && (this.isLockHeight || this._goUp(.5 * t)),
  this.moveState & i.DOWN && (this.isLockHeight || this._goDown(.5 * t)),
  this.cameraControl.isConstrainedAxisZ && (this.deltaPitch = 0),
  this.pitchDeltaTotal += this.deltaPitch,
  this._goTurn(this.deltaYaw),
  this.deltaYaw = 0,
  0 !== this.deltaPitch && (
    this.constrainPitch
    ? this.pitchDeltaTotal < this.pitchMax && this.pitchDeltaTotal > this.pitchMin && (this._goPitch(-this.deltaPitch), this.deltaPitch = 0)
    : (this._goPitch(-this.deltaPitch), this.deltaPitch = 0)),
  this.pitchDeltaTotal = THREE.Math.clamp(this.pitchDeltaTotal, this.pitchMin, this.pitchMax),
  e.flyOnWorld()
},
CLOUD.WalkEditor.prototype.onEnter = function() {
  var t = this.cameraControl.getCamera();
  t.isPerspective || t.toPerspective(),
  this.cameraControl.walkWithParallelEye(this.scene.getBoundingBox().getCenter())
},
CLOUD.WalkEditor.prototype.moveTo = function(t) {
  this.moveState = t,
  this.update(),
  this.moveState = CLOUD.MoveDirection.NONE
},
CLOUD.WalkEditor.prototype.setHeightLocked = function(t) {
  this.isLockHeight = t
},
CLOUD.WalkEditor.prototype.setLookMousePressed = function(t) {
  this.isLookMousePressed = t
},
CLOUD.WalkEditor.prototype.setSpeedRate = function(t) {
  CLOUD.GlobalData.MovementSpeedRate = t
},
CLOUD.ClipPlanesEditor = function(t) {
  function e(t, e) {
    var i = null !== t
        ? t.length
        : 0,
      n = null,
      o = new THREE.Plane;
    if (0 !== i) {
      var r = 4 * i,
        a = e.matrixWorldInverse,
        s = new THREE.Matrix3;
      s.getNormalMatrix(a),
      (null === n || n.length < r) && (n = new Float32Array(r));
      for (var l = 0, c = 0; l !== i; ++l, c += 4)
        o.copy(t[l]).applyMatrix4(a, s),
        o.normal.toArray(n, c),
        n[c + 3] = o.constant
    }
    return n
  }
  CLOUD.OrbitEditor.call(this, t.cameraControl, t.getScene(), t.domElement),
  this.viewer = t,
  this.enablePick = !1;
  for (var i = [], n = 0; n < 6; ++n)
    i.push(new THREE.Plane);
  var o = this.scene.getClipPlanes();
  o.updateClippingParams = function(n) {
    if (0 == n.iClipPlane.value)
      t.renderer.clippingPlanes = Object.freeze([]);
    else {
      for (var o = 0, r = n.iClipPlane.value; o < r; ++o) {
        var a = n.vClipPlane.value[o],
          s = i[o];
        s.setComponents(-a.x, -a.y, -a.z, -a.w),
        s.normalize()
      }
      t.renderer.clippingPlanes = i
    }
    if (CLOUD.GlobalData.IBL) {
      var l = e(i, t.camera);
      t.modelManager.updateMaterialsValue("clippingPlanes", l)
    }
  },
  o.init(),
  this.startPt = new THREE.Vector2,
  this.endPt = new THREE.Vector2,
  this.frustum = new THREE.Frustum,
  this.selectIndex = null,
  this.planeDistance = 0,
  this.offsetSpeed = .02,
  this.toggle = function(t, e) {
    o.enable(t, e)
  },
  this.visible = function(t) {
    o.visible = t
  },
  this.rotatable = function(t) {
    o.rotatable = t
  },
  this.store = function() {
    return o.store()
  },
  this.restore = function(t) {
    o.restore(t)
  },
  this.reset = function() {
    o.reset()
  },
  this.pointToScreen = function(t) {
    var e = this.cameraControl.camera,
      i = new THREE.Matrix4;
    i.multiplyMatrices(e.projectionMatrix, e.matrixWorldInverse);
    var n = new THREE.Vector4(t.x, t.y, t.z, 1);
    n.applyMatrix4(i);
    var o = new THREE.Vector2;
    o.x = (n.x / n.w + 1) / 2,
    o.y = 1 - (n.y / n.w + 1) / 2;
    var r = this.cameraControl.getContainerDimensions();
    return o.x = o.x * r.width + r.left,
    o.y = o.y * r.height + r.top,
    o
  },
  this.getPlaneDistanceInScreen = function() {
    if (null == this.selectIndex)
      return null;
    if (this.selectIndex < 2) {
      var t = o.center.clone(),
        e = o.center.clone();
      t.x -= o.cubeSize.x,
      e.x += o.cubeSize.x;
      var i = this.pointToScreen(t),
        n = this.pointToScreen(e);
      return i.x - n.x
    }
    var r = o.center.clone(),
      a = o.center.clone();
    a.y -= o.cubeSize.y,
    r.y += o.cubeSize.y;
    var s = this.pointToScreen(a),
      l = this.pointToScreen(r);
    return s.y - l.y
  },
  this.getPickPoint = function(t, e) {
    var i = this.cameraControl.camera,
      n = this.cameraControl.getContainerDimensions(),
      o = t - n.left,
      r = e - n.top,
      a = o / n.width * 2 - 1,
      s = (n.height - r) / n.height * 2 - 1,
      l = new CLOUD.Raycaster;
    return l.setFromCamera(new THREE.Vector2(a, s), i),
    l.ray.intersectPlane(this.plane)
  },
  this.getSelectIndex = function() {
    return o.selectIndex
  },
  this._isVisible = function() {
    return o.visible
  },
  this.isRotate = function() {
    return o.rotatable
  },
  this.offset = function(t) {
    var e = Math.floor(this.selectIndex / 2);
    this.selectIndex <= 3
      ? o.offset(this.selectIndex, -t * o.cubeSize.getComponent(e) * 2)
      : this.selectIndex % 2 == 1
        ? o.offset(this.selectIndex, -t * o.cubeSize.getComponent(e) * 2)
        : o.offset(this.selectIndex, t * o.cubeSize.getComponent(e) * 2)
  },
  this.rotate = function(t, e) {
    2 == this.selectIndex || 3 == this.selectIndex
      ? o.rotX(e / 180 * Math.PI * .1)
      : o.rotY(t / 180 * Math.PI * .1)
  },
  this.update = function(t) {
    o.update(t)
  },
  this.cancelHighLight = function() {
    o.cancelHighLight()
  },
  this.highLight = function() {
    o.highLight()
  }
},
CLOUD.ClipPlanesEditor.prototype = Object.create(CLOUD.OrbitEditor.prototype),
CLOUD.ClipPlanesEditor.prototype.constructor = CLOUD.ClipPlanesEditor,
CLOUD.ClipPlanesEditor.prototype.destroy = function() {
  this.domElement = null,
  this.cameraControl = null,
  this.intersectPoint = null,
  this.selectIndex = null,
  this.normal = null,
  this.plane = null,
  this.pickHelper = null,
  this.scene = null,
  this.viewer = null
},
CLOUD.ClipPlanesEditor.prototype.onExist = function() {
  this.toggle(!1, !1)
},
CLOUD.ClipPlanesEditor.prototype.onUpdateUI = function(t) {
  this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_UPDATEUI, data: t, editor: this.name})
},
CLOUD.ClipPlanesEditor.prototype.updateFrustum = function(t) {
  var e = this.startPt.x,
    i = this.endPt.x,
    n = this.startPt.y,
    o = this.endPt.y;
  if (e > i) {
    var r = e;
    e = i,
    i = r
  }
  if (n > o) {
    var a = n;
    n = o,
    o = a
  }
  if (i - e == 0 || o - n == 0)
    return !1;
  var s = this.cameraControl,
    l = s.getContainerDimensions();
  return s.computeFrustum(e, i, n, o, this.frustum, l),
  t && this.onUpdateUI({
    visible: !0,
    dir: this.startPt.x < this.endPt.x,
    left: e - l.left,
    top: n - l.top,
    width: i - e,
    height: o - n
  }),
  !0
},
CLOUD.ClipPlanesEditor.prototype.processMouseDown = function(t) {
  this.startPt.set(t.clientX, t.clientY),
  this.enablePick || t.button !== THREE.MOUSE.LEFT || (this.intersectPoint = this.cameraControl.getTrackingPoint(t.clientX, t.clientY), this.selectIndex = this.getSelectIndex(), this.planeDistance = this.getPlaneDistanceInScreen()),
  null != this.selectIndex
    ? (this.highLight(), this.cameraControl.needUpdateRenderList(!0), this.cameraControl.update(!0))
    : CLOUD.OrbitEditor.prototype.processMouseDown.call(this, t),
  this.update()
},
CLOUD.ClipPlanesEditor.prototype.processMouseUp = function(t) {
  if (this.selectIndex = null, this.planeDistance = 0, this.onUpdateUI({
    visible: !1
  }), this.enablePick && t.button === THREE.MOUSE.LEFT)
    if (this.startPt.x == t.clientX && this.startPt.y == t.clientY)
      this.pickHelper.click(t);
    else {
      var e = t.shiftKey || t.ctrlKey || t.altKey;
      if (e) {
        if (this.endPt.set(t.clientX, t.clientY), !this.updateFrustum())
          return this.pickHelper.click(t),
          !1;
        var i = CLOUD.OPSELECTIONTYPE.Clear;
        t.ctrlKey
          ? i = CLOUD.OPSELECTIONTYPE.Add
          : t.altKey && (i = CLOUD.OPSELECTIONTYPE.Remove);
        var n = this;
        return this.scene.pickByRect(this.frustum, i, function() {
          n.pickHelper.notifySelectionChanged(null, 0, t)
        }),
        this.cameraControl.updateView(!0),
        !0
      }
    }
  return CLOUD.OrbitEditor.prototype.processMouseUp.call(this, t),
  this.cameraControl.needUpdateRenderList(!0),
  this.cancelHighLight(),
  this.cameraControl.update(!0),
  this.update(),
  !0
},
CLOUD.ClipPlanesEditor.prototype.processMouseMove = function(t) {
  if ((t.shiftKey || t.ctrlKey || t.altKey) && t.button === THREE.MOUSE.LEFT)
    return this.endPt.set(t.clientX, t.clientY),
    this.updateFrustum(!0),
    !0;
  if (null != this.selectIndex) {
    if (this.isRotate())
      this.rotate(t.clientX - this.startPt.x, t.clientY - this.startPt.y),
      this.startPt.set(t.clientX, t.clientY);
    else {
      var e = 0;
      e = this.selectIndex < 2
        ? t.clientX - this.startPt.x
        : t.clientY - this.startPt.y,
      this.offset(e / this.planeDistance),
      this.startPt.set(t.clientX, t.clientY)
    }
    this.cameraControl.update(!0)
  } else
    CLOUD.OrbitEditor.prototype.processMouseMove.call(this, t);
  this.update()
},
CLOUD.ClipPlanesEditor.prototype.onMouseWheel = function(t) {
  CLOUD.OrbitEditor.prototype.onMouseWheel.call(this, t),
  this.update()
},
CLOUD.ClipPlanesEditor.prototype.touchstart = function(t) {
  t.preventDefault(),
  this.startPt.set(t.touches[0].clientX, t.touches[0].clientY),
  this.enablePick || (this.cameraControl.getTrackingPoint(t.touches[0].clientX, t.touches[0].clientY), this.selectIndex = this.getSelectIndex(), this.planeDistance = this.getPlaneDistanceInScreen()),
  null != this.selectIndex
    ? (this.highLight(), this.cameraControl.needUpdateRenderList(!0), this.cameraControl.update(!0))
    : this.cameraControl.touchStartHandler(t),
  this.update()
},
CLOUD.ClipPlanesEditor.prototype.touchmove = function(t) {
  if (t.preventDefault(), null != this.selectIndex) {
    if (this.isRotate())
      this.rotate(t.touches[0].clientX - this.startPt.x, t.touches[0].clientY - this.startPt.y),
      this.startPt.set(t.touches[0].clientX, t.touches[0].clientY);
    else {
      var e = 0;
      e = this.selectIndex < 2
        ? t.touches[0].clientX - this.startPt.x
        : t.touches[0].clientY - this.startPt.y,
      this.offset(e / this.planeDistance),
      this.startPt.set(t.touches[0].clientX, t.touches[0].clientY)
    }
    this.cameraControl.update(!0)
  } else
    this.cameraControl.touchMoveHandler(t);
  this.update()
},
CLOUD.ClipPlanesEditor.prototype.touchend = function(t) {
  return t.preventDefault(),
  this.selectIndex = null,
  this.planeDistance = 0,
  this.enablePick && (this.onUpdateUI({
    visible: !1
  }), this.startPt.x == t.touches[0].clientX && this.startPt.y == t.touches[0].clientY && this.pickHelper.click(t)),
  this.cameraControl.touchEndHandler(t),
  this.cameraControl.needUpdateRenderList(!0),
  this.cancelHighLight(),
  this.cameraControl.update(!0),
  this.update(),
  !0
},
CLOUD.FillClipPlaneEditor = function(t) {
  CLOUD.OrbitEditor.call(this, t.cameraControl, t.getScene(), t.domElement),
  this.viewer = t,
  this.enablePick = !1,
  this.rotX = !0;
  var e = this.scene.getFillClipPlane();
  e.updateClippingParams = function(e) {
    if (0 == e.iClipPlane.value)
      t.renderer.clippingPlanes = Object.freeze([]);
    else {
      var i = [new THREE.Plane],
        n = e.vClipPlane.value[0],
        o = i[0];
      o.setComponents(-n.x, -n.y, -n.z, -n.w),
      o.normalize(),
      t.renderer.clippingPlanes = i
    }
  },
  e.init(),
  this.startPt = new THREE.Vector2,
  this.endPt = new THREE.Vector2,
  this.frustum = new THREE.Frustum,
  this.planeDistance = 0,
  this.offsetSpeed = .02,
  this.toggle = function(t, i) {
    e.enable(t, i),
    e.update()
  },
  this.visible = function(t) {
    e.visible = t,
    e.update()
  },
  this.rotatable = function(t) {
    e.rotatable = t,
    e.update()
  },
  this.hit = function() {
    return e.hit
  },
  this.pointToScreen = function(t) {
    var e = this.cameraControl.camera,
      i = new THREE.Matrix4;
    i.multiplyMatrices(e.projectionMatrix, e.matrixWorldInverse);
    var n = new THREE.Vector4(t.x, t.y, t.z, 1);
    n.applyMatrix4(i);
    var o = new THREE.Vector2;
    o.x = (n.x / n.w + 1) / 2,
    o.y = 1 - (n.y / n.w + 1) / 2;
    var r = this.cameraControl.getContainerDimensions();
    return o.x = o.x * r.width + r.left,
    o.y = o.y * r.height + r.top,
    o
  },
  this.getPlaneDistanceInScreen = function() {
    if (null == this.selectIndex)
      return null;
    if (this.selectIndex < 2) {
      var t = clipPlanes.center.clone(),
        e = clipPlanes.center.clone();
      t.x -= clipPlanes.cubeSize.x,
      e.x += clipPlanes.cubeSize.x;
      var i = this.pointToScreen(t),
        n = this.pointToScreen(e);
      return i.x - n.x
    }
    var o = clipPlanes.center.clone(),
      r = clipPlanes.center.clone();
    r.y -= clipPlanes.cubeSize.y,
    o.y += clipPlanes.cubeSize.y;
    var a = this.pointToScreen(r),
      s = this.pointToScreen(o);
    return a.y - s.y
  },
  this.getPickPoint = function(t, e) {
    var i = this.cameraControl.camera,
      n = this.cameraControl.getContainerDimensions(),
      o = t - n.left,
      r = e - n.top,
      a = o / n.width * 2 - 1,
      s = (n.height - r) / n.height * 2 - 1,
      l = new CLOUD.Raycaster;
    return l.setFromCamera(new THREE.Vector2(a, s), i),
    l.ray.intersectPlane(this.plane)
  },
  this._isVisible = function() {
    return e.visible
  },
  this.isRotate = function() {
    return e.rotatable
  },
  this.offset = function(t) {
    e.offset(t)
  },
  this.setOffset = function(t) {
    e.setOffset(t)
  },
  this.rotate = function(t, i) {
    this.rotX
      ? e.rotX(i / 180 * Math.PI * .1)
      : e.rotY(t / 180 * Math.PI * .1)
  },
  this.changeNormal = function(t) {
    e.changeNormal(t)
  },
  this.update = function(t) {
    e.update(t)
  },
  this.cancelHighLight = function() {
    e.cancelHighLight()
  },
  this.highLight = function() {
    e.highLight()
  }
},
CLOUD.FillClipPlaneEditor.prototype = Object.create(CLOUD.OrbitEditor.prototype),
CLOUD.FillClipPlaneEditor.prototype.constructor = CLOUD.FillClipPlaneEditor,
CLOUD.FillClipPlaneEditor.prototype.destroy = function() {
  this.domElement = null,
  this.cameraControl = null,
  this.intersectPoint = null,
  this.normal = null,
  this.plane = null,
  this.pickHelper = null,
  this.scene = null,
  this.viewer = null
},
CLOUD.FillClipPlaneEditor.prototype.onExist = function() {
  this.toggle(!1, !1)
},
CLOUD.FillClipPlaneEditor.prototype.onUpdateUI = function(t) {
  this.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_UPDATEUI, data: t, editor: this.name})
},
CLOUD.FillClipPlaneEditor.prototype.updateFrustum = function(t) {
  var e = this.startPt.x,
    i = this.endPt.x,
    n = this.startPt.y,
    o = this.endPt.y;
  if (e > i) {
    var r = e;
    e = i,
    i = r
  }
  if (n > o) {
    var a = n;
    n = o,
    o = a
  }
  if (i - e == 0 || o - n == 0)
    return !1;
  var s = this.cameraControl,
    l = s.getContainerDimensions();
  return s.computeFrustum(e, i, n, o, this.frustum, l),
  t && this.onUpdateUI({
    visible: !0,
    dir: this.startPt.x < this.endPt.x,
    left: e - l.left,
    top: n - l.top,
    width: i - e,
    height: o - n
  }),
  !0
},
CLOUD.FillClipPlaneEditor.prototype.processMouseDown = function(t) {
  this.startPt.set(t.clientX, t.clientY),
  this.enablePick || t.button !== THREE.MOUSE.LEFT || (this.intersectPoint = this.cameraControl.getTrackingPoint(t.clientX, t.clientY)),
  this.hit()
    ? (this.highLight(), this.cameraControl.needUpdateRenderList(!0), this.cameraControl.update(!0))
    : CLOUD.OrbitEditor.prototype.processMouseDown.call(this, t)
},
CLOUD.FillClipPlaneEditor.prototype.processMouseUp = function(t) {
  if (this.planeDistance = 0, this.onUpdateUI({
    visible: !1
  }), this.enablePick && t.button === THREE.MOUSE.LEFT)
    if (this.startPt.x == t.clientX && this.startPt.y == t.clientY)
      this.pickHelper.click(t);
    else {
      var e = t.shiftKey || t.ctrlKey || t.altKey;
      if (e) {
        if (this.endPt.set(t.clientX, t.clientY), !this.updateFrustum())
          return this.pickHelper.click(t),
          !1;
        var i = CLOUD.OPSELECTIONTYPE.Clear;
        t.ctrlKey
          ? i = CLOUD.OPSELECTIONTYPE.Add
          : t.altKey && (i = CLOUD.OPSELECTIONTYPE.Remove);
        var n = this;
        return this.scene.pickByRect(this.frustum, i, function() {
          n.pickHelper.notifySelectionChanged(null, 0, t)
        }),
        this.cameraControl.updateView(!0),
        !0
      }
    }
  return CLOUD.OrbitEditor.prototype.processMouseUp.call(this, t),
  this.cameraControl.needUpdateRenderList(!0),
  this.cancelHighLight(),
  this.cameraControl.update(!0),
  !0
},
CLOUD.FillClipPlaneEditor.prototype.processMouseMove = function(t) {
  if ((t.shiftKey || t.ctrlKey || t.altKey) && t.button === THREE.MOUSE.LEFT)
    return this.endPt.set(t.clientX, t.clientY),
    this.updateFrustum(!0),
    !0;
  if (t.button === THREE.MOUSE.LEFT && this.hit()) {
    if (this.isRotate())
      this.rotate(t.clientX - this.startPt.x, t.clientY - this.startPt.y),
      this.startPt.set(t.clientX, t.clientY);
    else {
      var e = 0;
      e = t.clientX - this.startPt.x,
      this.offset(1 * e),
      this.startPt.set(t.clientX, t.clientY)
    }
    this.cameraControl.update(!0)
  } else
    CLOUD.OrbitEditor.prototype.processMouseMove.call(this, t)
},
CLOUD.FillClipPlaneEditor.prototype.touchstart = function(t) {
  t.preventDefault(),
  this.startPt.set(t.touches[0].clientX, t.touches[0].clientY),
  this.enablePick || this.cameraControl.getTrackingPoint(t.touches[0].clientX, t.touches[0].clientY),
  this.hit()
    ? (this.highLight(), this.cameraControl.needUpdateRenderList(!0), this.cameraControl.update(!0))
    : this.cameraControl.touchStartHandler(t)
},
CLOUD.FillClipPlaneEditor.prototype.touchmove = function(t) {
  if (t.preventDefault(), this.hit()) {
    if (this.isRotate())
      this.rotate(t.touches[0].clientX - this.startPt.x, t.touches[0].clientY - this.startPt.y),
      this.startPt.set(t.touches[0].clientX, t.touches[0].clientY);
    else {
      var e = 0;
      e = t.touches[0].clientX - this.startPt.x,
      this.offset(1 * e),
      this.startPt.set(t.touches[0].clientX, t.touches[0].clientY)
    }
    this.cameraControl.update(!0)
  } else
    this.cameraControl.touchMoveHandler(t)
},
CLOUD.FillClipPlaneEditor.prototype.touchend = function(t) {
  return t.preventDefault(),
  this.enablePick && (this.onUpdateUI({
    visible: !1
  }), this.startPt.x == t.touches[0].clientX && this.startPt.y == t.touches[0].clientY && this.pickHelper.click(t)),
  this.cameraControl.touchEndHandler(t),
  this.cameraControl.needUpdateRenderList(!0),
  this.cancelHighLight(),
  this.cameraControl.update(!0),
  !0
},
CLOUD.EditorManager = function() {
  function t(t) {
    u.editor.touchmove(t)
  }
  function e(t) {
    u.editor.touchstart(t)
  }
  function i(t) {
    u.editor.touchend(t)
  }
  function n(t) {
    u.editor.onKeyDown(t)
  }
  function o(t) {
    u.editor.onKeyUp(t)
  }
  function r(t) {
    u.cameraChange = !0,
    u.editor.onMouseWheel(t)
  }
  function a(t) {
    if (h(), d = !0, u.isUpdateRenderList = !1, u.isAnimating())
      return void(u.cameraChange = !1);
    u.editor.onMouseDown(t)
  }
  function s(t) {
    if (u.isAnimating())
      return void(u.cameraChange = !1);
    d
      ? (u.isUpdateRenderList = !1, u.cameraChange = !0, u.editor.onMouseMove(t))
      : (u.editor.mouseMoveAlwaysAllowed && (u.isUpdateRenderList = !1, u.cameraChange = !0, u.editor.onMouseMove(t)), u.editor.onHover(t))
  }
  function l(t) {
    var e = u.isAnimating();
    u.isUpdateRenderList = !0;
    var i = d;
    d = !1,
    e || (i || u.editor.mouseMoveAlwaysAllowed) && u.editor.onMouseUp(t)
  }
  function c(t) {
    u.editor.onMouseDoubleClick(t)
  }
  function h() {
    var t = u.editor.getDomElement();
    if (t) {
      var e = t.querySelector("#cloud-main-canvas");
      e && e.focus && e.focus()
    }
  }
  this.editor = null,
  this.editors = {},
  this.animationDuration = 500,
  this.animationFrameTime = 13,
  this.enableAnimation = !0,
  this.isUpdateRenderList = !0,
  this.mouseButtons = {
    ORBIT: THREE.MOUSE.RIGHT,
    PAN2: THREE.MOUSE.MIDDLE,
    PAN: THREE.MOUSE.LEFT
  },
  this.movePad = null;
  var u = this,
    d = !1;
  this.isMouseMoving = function() {
    return d
  },
  this.registerDomEventListeners = function(u) {
    u.addEventListener("contextmenu", function(t) {
      t.preventDefault()
    }, !1),
    u.addEventListener("mousedown", a, !1),
    u.addEventListener("mousewheel", r, !1),
    u.addEventListener("DOMMouseScroll", r, !1),
    u.addEventListener("dblclick", c, !1),
    window.addEventListener("mousemove", s, !1),
    window.addEventListener("mouseup", l, !1),
    u.addEventListener("touchstart", e, !1),
    u.addEventListener("touchend", i, !1),
    u.addEventListener("touchmove", t, !1),
    u.addEventListener("keydown", n, !1),
    u.addEventListener("keyup", o, !1),
    h()
  },
  this.unregisterDomEventListeners = function(h) {
    h.removeEventListener("contextmenu", function(t) {
      t.preventDefault()
    }, !1),
    h.removeEventListener("mousedown", a, !1),
    h.removeEventListener("mousewheel", r, !1),
    h.removeEventListener("DOMMouseScroll", r, !1),
    h.removeEventListener("dblclick", c, !1),
    window.removeEventListener("mousemove", s, !1),
    window.removeEventListener("mouseup", l, !1),
    h.removeEventListener("touchstart", e, !1),
    h.removeEventListener("touchend", i, !1),
    h.removeEventListener("touchmove", t, !1),
    h.removeEventListener("keydown", n, !1),
    h.removeEventListener("keyup", o, !1)
  }
},
CLOUD.EditorManager.prototype = {
  constructor: CLOUD.EditorManager,
  destroy: function() {
    this.editor = null;
    for (var t in this.editors) {
      this.editors[t].destroy()
    }
    this.editors = {},
    this.movePad = null
  },
  updateButtons: function(t, e) {
    this.mouseButtons = t,
    this.editor && this.editor.updateButtons(this.mouseButtons, e)
  },
  getCurrentEditorName: function() {
    return this.editor
      ? this.editor.name
      : ""
  },
  _getEditorByName: function(t, e) {
    var i = this.editors[e];
    if (i)
      return i;
    var n = CLOUD.EditorMode,
      o = t.cameraControl,
      r = t.getScene(),
      a = t.domElement;
    switch (e) {
      case n.ORBIT:
        i = new CLOUD.OrbitEditor(o, r, a);
        break;
      case n.PICK:
        i = new CLOUD.PickEditor(o, r, a);
        break;
      case n.PICK_BY_RECT:
        i = new CLOUD.RectPickEditor(o, r, a);
        break;
      case n.PAN:
        i = new CLOUD.PanEditor(o, r, a);
        break;
      case n.ZOOM:
        i = new CLOUD.ZoomEditor(o, r, a);
        break;
      case n.ZOOM_BY_RECT:
        i = new CLOUD.RectZoomEditor(o, r, a);
        break;
      case n.FLY:
        i = new CLOUD.FlyEditor(o, r, a);
        break;
      case n.WALK:
        i = new CLOUD.WalkEditor(o, r, a);
        break;
      case n.CLIP_BY_BOX:
        i = new CLOUD.ClipPlanesEditor(t);
        break;
      case n.CLIP_FILL:
        i = new CLOUD.FillClipPlaneEditor(t);
        break;
      default:
        i = null,
        console.error("invalid editor name")
    }
    return i && (i.name = e, this.editors[e] = i),
    i
  },
  getCurrentEditorMode: function() {
    return this.editor
  },
  setEditorMode: function(t, e) {
    var i = this._getEditorByName(t, e);
    i && this.editor !== i && (null !== this.editor && (this.editor.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_EXIST, name: this.editor.getName()}), this.editor.onExist()), this.editor = i, this.editor.onEnter(), this.editor.dispatchEvent({type: CLOUD.EVENTS.ON_EDITOR_ENTER, name: this.editor.getName()}), this.editor.updateButtons(this.mouseButtons))
  },
  zoomIn: function(t, e) {
    void 0 === t && (t = .1),
    t < 0 && (t = 0),
    e.cameraControl.zoom(t)
  },
  zoomOut: function(t, e) {
    void 0 === t && (t = .1),
    t > 0
      ? t *= -1
      : t = 0,
    e.cameraControl.zoom(t)
  },
  zoomToBBox: function(t, e, i, n, o) {
    var r = t.camera.zoomToBBox(e, i, n, o);
    t.cameraControl.updateCamera(r, !0),
    t.render()
  },
  isAnimating: function() {
    return this.enableAnimation && this.animator && this.animator.isPlaying()
  },
  setStandardView: function(t, e, i, n) {
    var o,
      r = e.camera;
    if (o = e.getScene().getBoundingBox(), this.enableAnimation)
      this.animator || (this.animator = new CLOUD.CameraAnimator),
      this.animator.setDuration(this.animationDuration),
      this.animator.setFrameTime(this.animationFrameTime),
      this.animator.setStandardView(t, e, o, i, n);
    else {
      r.setStandardView(t, o);
      var a = e.camera.zoomToBBox(o, i);
      e.cameraControl.updateCamera(a, !0),
      e.render(),
      n && n(),
      r.up.copy(THREE.Object3D.DefaultUp)
    }
  },
  setStandardViewWithBox: function(t, e, i, n, o) {
    var r = t.camera;
    r.setStandardView(e, i);
    var a = r.zoomToBBox(i, n, o);
    t.cameraControl.updateCamera(a),
    t.render(),
    r.up.copy(THREE.Object3D.DefaultUp)
  },
  resize: function() {
    this.editor && this.editor.resize()
  }
},
CLOUD.SelectPad = function(t) {
  this.editor = t,
  this.cameraControl = t.cameraControl,
  this.dim = this.cameraControl.getContainerDimensions(),
  this.pad = null,
  this.padSize = 96,
  this.startPt = new THREE.Vector2,
  this.position = new THREE.Vector2,
  this.callback = null,
  this.intersect = null,
  this.init = function() {
    window.addEventListener("resize", this.padInitBind, !1),
    this.pad = document.createElement("div"),
    this.padInit(),
    this.cameraControl.domElement.appendChild(this.pad),
    this.addEventListener()
  },
  this.addEventListener = function() {
    this.pad.addEventListener("touchstart", this.padOnTouchStartBind, !1),
    this.pad.addEventListener("touchmove", this.padOnTouchMoveBind, !1),
    this.pad.addEventListener("touchend", this.padOnTouchEndBind, !1)
  },
  this.padInit = function() {
    null != this.pad && (this.pad.style.backgroundImage = "url(images/selectPad.png)", this.pad.style.backgroundSize = "100%", this.pad.style.position = "absolute", this.pad.style.width = this.padSize.toString() + "px", this.pad.style.height = this.padSize.toString() + "px", this.pad.style.zIndex = "10", this.pad.style.display = "none")
  },
  this.showOverlay = function(t) {
    this.position = t,
    this.pad.style.left = this.position.x.toString() + "px",
    this.pad.style.top = (this.position.y - this.dim.top).toString() + "px",
    this.pad.style.display = "",
    this.pick()
  },
  this.hideOverlay = function() {
    this.pad.style.display = "none"
  },
  this.pick = function() {
    var t = this.position.x,
      e = this.position.y,
      i = this.cameraControl,
      n = (this.editor.pickHelper, i.viewer.getFilters()),
      o = this,
      r = new THREE.Vector2(t, e),
      a = i.getIntersectContext(r);
    i.intersector.pick(a, function(t) {
      if (n.clearIdList(CLOUD.EnumIdBasedType.SELECTED), !t)
        return i.updateView(!0),
        void(o.intersect = null);
      var e = t.userId;
      i.viewer.getScene().intersectToWorld(t),
      n.addToIdList(CLOUD.EnumIdBasedType.SELECTED, [e]),
      o.intersect = t,
      i.updateView(!0)
    }),
    null != o.intersect && (o.intersect.cx = t, o.intersect.cy = e)
  },
  this.onTouchStart = function(t) {
    1 === t.touches.length && (t.stopPropagation(), t.preventDefault(), this.startPt.set(t.touches[0].clientX, t.touches[0].clientY))
  },
  this.onTouchMove = function(t) {
    if (1 === t.touches.length) {
      t.stopPropagation(),
      t.preventDefault();
      var e = t.touches[0].clientX - this.startPt.x,
        i = t.touches[0].clientY - this.startPt.y;
      this.position.x += e,
      this.position.y += i,
      this.pad.style.left = this.position.x.toString() + "px",
      this.pad.style.top = (this.position.y - this.dim.top).toString() + "px",
      this.startPt.set(t.touches[0].clientX, t.touches[0].clientY),
      this.pick(t)
    }
  },
  this.onTouchEnd = function(t) {
    t.stopPropagation(),
    null != this.callback
      ? this.callback(this.intersect)
      : console.log("selectPad click", this.intersect)
  },
  this.padInitBind = this.padInit.bind(this),
  this.padOnTouchStartBind = this.onTouchStart.bind(this),
  this.padOnTouchEndBind = this.onTouchEnd.bind(this),
  this.padOnTouchMoveBind = this.onTouchMove.bind(this),
  this.init()
},
CLOUD.Loader = CLOUD.Loader || {},
CLOUD.Loader.Url = function(t, e) {
  this.serverUrl = t,
  this.databagId = e
},
CLOUD.Loader.Url.prototype.projectUrl = function() {
  return this.serverUrl + this.databagId + "/config.json"
},
CLOUD.Loader.Url.prototype.sceneUrl = function(t) {
  return t = t || 0,
  this.serverUrl + this.databagId + "/scene/scene_" + t + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.sceneIdUrl = function() {
  return this.serverUrl + this.databagId + "/scene/scene_id" + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.userIdUrl = function() {
  return this.serverUrl + this.databagId + "/scene/user_id" + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.octreeUrl = function(t) {
  return t = t || "o",
  this.serverUrl + this.databagId + "/scene/octree_" + t + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.symbolUrl = function() {
  return this.serverUrl + this.databagId + "/symbol/symbol" + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.mpkUrl = function(t) {
  return t = t || 0,
  this.serverUrl + this.databagId + "/mpk/mpk_" + t + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.meshIdUrl = function() {
  return this.serverUrl + this.databagId + "/mpk/mesh_id" + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.materialUrl = function() {
  return this.serverUrl + this.databagId + "/material/material" + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.materialIdUrl = function() {
  return this.serverUrl + this.databagId + "/material/material_id" + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.userDataUrl = function() {
  return this.serverUrl + this.databagId + "/userdata/userdata" + CLOUD.GlobalData.ZipResourcePostfix
},
CLOUD.Loader.Url.prototype.textureUrl = function(t) {
  return this.serverUrl + this.databagId + "/texture/" + t
},
CLOUD.Loader.OctreeNode = function(t, e) {
  void 0 === t && alert("Invalid Octant Id"),
  this.octantId = t,
  this.childOctants = new Array,
  this.min = null,
  this.max = null,
  this.depth = e || 0,
  this.center = null,
  this.size = -1,
  this.priority = -1,
  this.octType = -1
},
CLOUD.Loader.OctreeNode.prototype.isRoot = function() {
  return 0 == this.depth
},
CLOUD.Loader.OctreeNode.prototype.add = function(t) {
  t.depth = this.depth + 1,
  this.childOctants.push(t)
},
CLOUD.Loader.OctreeNode.prototype.updateMaxDepth = function() {
  this.depth > CLOUD.GlobalData.MaximumDepth && (CLOUD.GlobalData.MaximumDepth = this.depth)
},
CLOUD.Loader.IdReader = function(t) {
  var e = new Uint32Array(t, 0, 2);
  this.size = e[0],
  this.count = e[1],
  this.cache = {},
  this.idBuffer = t.slice(8),
  e = null
},
CLOUD.Loader.IdReader.prototype = {
  constructor: CLOUD.Loader.IdReader,
  getSize: function() {
    return this.size
  },
  getCount: function() {
    return this.count
  },
  getString: function(t) {
    if (void 0 !== this.cache[t])
      return this.cache[t];
    if (t >= 0 && t < this.count) {
      var e = new Uint8Array(this.idBuffer, this.size * t, this.size),
        i = String.fromCharCode.apply(null, e),
        n = i.indexOf("\0");
      return this.cache[t] = n !== -1
        ? i.substring(0, n)
        : i,
      this.cache[t]
    }
  },
  getIndex: function(t) {
    if (void 0 == t)
      return -1;
    for (var e = 0, i = this.count - 1, n = t.length; e <= i;) {
      var o = Math.floor((e + i) / 2),
        r = new Uint8Array(this.idBuffer, this.size * o, n),
        a = String.fromCharCode.apply(null, r),
        s = a.indexOf("\0"),
        l = 0;
      if (0 == (
        l = s !== -1
        ? t.localeCompare(a.substring(0, s))
        : t.localeCompare(a)))
        return o;
      l < 0
        ? i = o - 1
        : l > 0 && (e = o + 1)
    }
    return -1
  }
},
CLOUD.Loader.UserDataReader = function(t) {
  this.userData = JSON.parse(t),
  this.count = 0;
  for (var e in this.userData)
    this.userData.hasOwnProperty(e) && this.count++;
  this.getCount = function() {
    return this.count
  },
  this.getData = function() {
    return this.userData
  },
  this.getUserData = function(t) {
    if (t >= 0 && t < this.count)
      return this.userData[t + ""]
  }
},
CLOUD.Loader.OctNode = function(t, e) {
  var i = new Uint32Array(t, e, 5);
  this.cell_id = i[0],
  this.child_s = i[3],
  this.child_e = i[4];
  var n = new Float32Array(t, e + 20, 6);
  this.boundingBox = new THREE.Box3(new THREE.Vector3(n[0], n[1], n[2]), new THREE.Vector3(n[3], n[4], n[5]))
},
CLOUD.Loader.OctreeReader = function(t) {
  var e = new Uint32Array(t, 0, 1);
  this.count = e[0],
  this.data = new Array(this.count);
  for (var i = 0; i < this.count; ++i)
    this.data[i] = new CLOUD.Loader.OctNode(t, 4 * (1 + 11 * i))
},
CLOUD.Loader.OctreeReader.prototype = {
  constructor: CLOUD.Loader.OctreeReader,
  getCount: function() {
    return this.count
  },
  getNode: function(t) {
    if (t >= 0 && t < this.count)
      return this.data[t]
  }
},
CLOUD.Loader.Material = function(t, e) {
  var i = new Uint32Array(t, e, 8);
  this.id = i[0],
  this.type = i[1],
  this.metal = i[2],
  this.color = i[3],
  this.emissive = i[4],
  this.specular = i[5],
  this.side = i[6],
  this.texture_n = i[7],
  this.texture_id = new Uint32Array(t, e + 32, 8);
  var n = new Float32Array(t, e + 64, 3);
  this.shininess = n[0],
  this.opacity = n[1],
  this.reflectivity = n[2],
  i = null,
  n = null
},
CLOUD.Loader.Texture = function(t, e) {
  var i = new Uint32Array(t, e, 4);
  this.id = i[0],
  this.type = i[1],
  this.repeat_u = i[2],
  this.repeat_v = i[3];
  var n = new Float32Array(t, e + 16, 5);
  this.angle = n[0],
  this.offset_u = n[1],
  this.offset_v = n[2],
  this.scale_u = n[3],
  this.scale_v = n[4];
  var o = new Uint8Array(t, e + 36, 8),
    r = String.fromCharCode.apply(null, o);
  this.file_name_ext = r.substring(0, r.indexOf("\0")),
  i = null,
  n = null,
  o = null
},
CLOUD.Loader.MaterialReader = function(t) {
  var e = new Uint32Array(t, 0, 4);
  this.materialCount = e[0],
  this.materialOffset = e[1],
  this.textureCount = e[2],
  this.textureOffset = e[3],
  this.materialSize = 76,
  this.textureSize = 44,
  this.materialBuffer = t.slice(this.materialOffset, this.materialOffset + this.materialCount * this.materialSize),
  this.textureBuffer = t.slice(this.textureOffset, this.textureOffset + this.textureCount * this.textureSize),
  this.material_id = -1,
  this.texture_id = -1;
  var i = new ArrayBuffer(this.materialSize);
  this.material_cur = new CLOUD.Loader.Material(i, 0),
  this.texture_cur = new CLOUD.Loader.Texture(i, 0),
  e = null,
  i = null
},
CLOUD.Loader.MaterialReader.prototype = {
  constructor: CLOUD.Loader.MaterialReader,
  getMaterial: function(t) {
    if (t >= 0 && t < this.materialCount)
      return new CLOUD.Loader.Material(this.materialBuffer, t * this.materialSize)
  },
  getTexture: function(t) {
    if (t >= 0 && t < this.textureCount)
      return new CLOUD.Loader.Texture(this.textureBuffer, t * this.textureSize)
  },
  getMaterialInfo: function(t) {
    if (t == this.material_id)
      return this.material_cur;
    if (t >= 0 && t < this.materialCount) {
      var e = new Uint32Array(this.materialBuffer, t * this.materialSize, 8);
      this.material_cur.id = e[0],
      this.material_cur.type = e[1],
      this.material_cur.metal = e[2],
      this.material_cur.color = e[3],
      this.material_cur.emissive = e[4],
      this.material_cur.specular = e[5],
      this.material_cur.side = e[6],
      this.material_cur.texture_n = e[7],
      this.material_cur.texture_id = new Uint32Array(this.materialBuffer, t * this.materialSize + 32, 8);
      var i = new Float32Array(this.materialBuffer, t * this.materialSize + 64, 3);
      return this.material_cur.shininess = i[0],
      this.material_cur.opacity = i[1],
      this.material_cur.reflectivity = i[2],
      e = null,
      i = null,
      this.material_id = t,
      this.material_cur
    }
  },
  getTextureInfo: function(t) {
    if (t == this.texture_id)
      return this.texture_cur;
    if (t >= 0 && t < this.textureCount) {
      var e = new Uint32Array(this.textureBuffer, t * this.textureSize, 4);
      this.texture_cur.id = e[0],
      this.texture_cur.type = e[1],
      this.texture_cur.repeat_u = e[2],
      this.texture_cur.repeat_v = e[3];
      var i = new Float32Array(this.textureBuffer, t * this.textureSize + 16, 5);
      this.texture_cur.angle = i[0],
      this.texture_cur.offset_u = i[1],
      this.texture_cur.offset_v = i[2],
      this.texture_cur.scale_u = i[3],
      this.texture_cur.scale_v = i[4];
      var n = new Uint8Array(this.textureBuffer, t * this.textureSize + 36, 8),
        o = String.fromCharCode.apply(null, n);
      return this.texture_cur.file_name_ext = o.substring(0, o.indexOf("\0")),
      e = null,
      i = null,
      n = null,
      this.texture_id = t,
      this.texture_cur
    }
  }
},
CLOUD.Loader.SymbolHeader = function(t) {
  var e = new Uint32Array(t, 0, 9);
  this.blockId = e[0],
  this.symbolCount = e[1],
  this.itemCount = e[2],
  this.matrixCount = e[3],
  this.geomBuffSize = e[4],
  this.symbolOffset = e[5],
  this.itemOffset = e[6],
  this.matrixOffset = e[7],
  this.geomOffset = e[8];
  var i = new Float32Array(t, 36, 6);
  this.boundingBox = new THREE.Box3(new THREE.Vector3(i[0], i[1], i[2]), new THREE.Vector3(i[3], i[4], i[5])),
  e = null,
  i = null
},
CLOUD.Loader.Symbol = function(t, e) {
  var i = new Int32Array(t, e, 3);
  this.symbolId = i[0],
  this.itemIndex = i[1],
  this.itemCount = i[2];
  var n = new Float32Array(t, e + 12, 6);
  this.boundingBox = new THREE.Box3(new THREE.Vector3(n[0], n[1], n[2]), new THREE.Vector3(n[3], n[4], n[5])),
  i = null,
  n = null
},
CLOUD.Loader.SymbolReader = function(t) {
  this.header = new CLOUD.Loader.SymbolHeader(t),
  this.symbolSize = 36,
  this.itemSize = 52,
  this.matrixSize = 64,
  this.geomSize = 32,
  this.maxSize = 256,
  this.symbolBuffer = t.slice(this.header.symbolOffset, this.header.symbolOffset + this.header.symbolCount * this.symbolSize),
  this.itemBuffer = t.slice(this.header.itemOffset, this.header.itemOffset + this.header.itemCount * this.itemSize),
  this.matrixBuffer = t.slice(this.header.matrixOffset, this.header.matrixOffset + this.header.matrixCount * this.matrixSize),
  this.geomBuffer = t.slice(this.header.geomOffset, this.header.geomOffset + this.header.geomBuffSize),
  this.matr_cur_id = -1,
  this.pt_symb_min = new THREE.Vector3(0, 0, 0),
  this.pt_symb_max = new THREE.Vector3(0, 0, 0),
  this.pt_item_min = new THREE.Vector3(0, 0, 0),
  this.pt_item_max = new THREE.Vector3(0, 0, 0);
  var e = new ArrayBuffer(this.maxSize);
  this.symb_cur = new CLOUD.Loader.Symbol(e, 0),
  this.item_cur = new CLOUD.Loader.Item(e, 0),
  this.matr_cur = new CLOUD.Loader.Matrix(e, 0),
  this.pipe_cur = new CLOUD.Loader.GeomPipe(e, 0),
  this.symb_cur.boundingBox.set(this.pt_symb_min, this.pt_symb_max),
  this.item_cur.boundingBox.set(this.pt_item_min, this.pt_item_max)
},
CLOUD.Loader.SymbolReader.prototype = {
  constructor: CLOUD.Loader.SymbolReader,
  getSymbol: function(t) {
    if (t >= 0 && t < this.header.symbolCount)
      return new CLOUD.Loader.Symbol(this.symbolBuffer, t * this.symbolSize)
  },
  getItem: function(t) {
    if (t >= 0 && t < this.header.itemCount)
      return new CLOUD.Loader.Item(this.itemBuffer, t * this.itemSize)
  },
  getMatrix: function(t) {
    if (t >= 0 && t < this.header.matrixCount)
      return new CLOUD.Loader.Matrix(this.matrixBuffer, t * this.matrixSize)
  },
  getGeomPipe: function(t) {
    if (t >= 0 && index < this.header.geomBuffSize)
      return new CLOUD.Loader.GeomPipe(this.geomBuffer, t)
  },
  getSymbolInfo: function(t) {
    if (t >= 0 && t < this.header.symbolCount) {
      var e = new Int32Array(this.symbolBuffer, t * this.symbolSize, 3);
      this.symb_cur.symbolId = e[0],
      this.symb_cur.itemIndex = e[1],
      this.symb_cur.itemCount = e[2];
      var i = new Float32Array(this.symbolBuffer, t * this.symbolSize + 12, 6);
      return this.pt_symb_min.set(i[0], i[1], i[2]),
      this.pt_symb_max.set(i[3], i[4], i[5]),
      this.symb_cur.boundingBox.set(this.pt_symb_min, this.pt_symb_max),
      this.symb_cur
    }
  },
  getItemInfo: function(t) {
    if (t >= 0 && t < this.header.itemCount) {
      var e = new Int32Array(this.itemBuffer, t * this.itemSize, 7);
      this.item_cur.ItemId = e[0],
      this.item_cur.originalId = e[1],
      this.item_cur.materialId = e[2],
      this.item_cur.userDataId = e[3],
      this.item_cur.matrixId = e[4],
      this.item_cur.type = e[5],
      this.item_cur.toData = e[6];
      var i = new Float32Array(this.itemBuffer, t * this.itemSize + 28, 6);
      return this.pt_item_min.set(i[0], i[1], i[2]),
      this.pt_item_max.set(i[3], i[4], i[5]),
      this.item_cur.boundingBox.set(this.pt_item_min, this.pt_item_max),
      this.item_cur
    }
  },
  getMatrixInfo: function(t) {
    if (t == this.matr_cur_id)
      return this.matr_cur;
    if (t >= 0 && t < this.header.matrixCount) {
      var e = new Float32Array(this.matrixBuffer, t * this.matrixSize, 16);
      return this.matr_cur.matrix.fromArray(e),
      this.matr_cur_id = t,
      this.matr_cur
    }
  },
  getGeomPipeInfo: function(t) {
    if (t >= 0 && t < this.header.geomBuffSize) {
      var e = new Float32Array(this.geomBuffer, t, 8);
      return this.pipe_cur.startPt.set(e[0], e[1], e[2]),
      this.pipe_cur.endPt.set(e[3], e[4], e[5]),
      this.pipe_cur.radius = e[6],
      this.pipe_cur.thickness = e[7],
      this.pipe_cur
    }
  },
  getMpkID: function(t) {
    return parseInt(t / 65536)
  },
  getMeshIndex: function(t) {
    return parseInt(t % 65536)
  }
},
CLOUD.Loader.MPKHeader = function(t) {
  var e = new Uint32Array(t, 0, 7);
  this.blockId = e[0],
  this.startId = e[1],
  this.vtFormat = e[2],
  this.meshCount = e[3],
  this.meshOffset = e[4],
  this.bufferSize = e[5],
  this.bufferOffset = e[6],
  e = null
},
CLOUD.Loader.MeshData = function(t, e) {
  var i = new Uint32Array(t, e, 4);
  this.mesh_id = i[0],
  this.ptCount = i[1],
  this.idxCount = i[2],
  this.dataOffset = i[3];
  var n = new Float32Array(t, e + 16, 4);
  this.baseScale = n[0],
  this.baseVector = new THREE.Vector3(n[1], n[2], n[3]),
  i = null,
  n = null
},
CLOUD.Loader.MPKReader = function(t) {
  this.header = new CLOUD.Loader.MPKHeader(t),
  this.meshSize = 32,
  this.maxSize = 256,
  this.meshBuffer = t.slice(this.header.meshOffset, this.header.meshOffset + this.header.meshCount * this.meshSize),
  this.geomBuffer = t.slice(this.header.bufferOffset, this.header.bufferOffset + this.header.bufferSize),
  this.mesh_cur_id = -1,
  this.pt_pos = new THREE.Vector3(0, 0, 0);
  var e = new ArrayBuffer(this.maxSize);
  this.mesh_cur = new CLOUD.Loader.MeshData(e, 0),
  this.mesh_cur.baseVector = this.pt_pos
},
CLOUD.Loader.MPKReader.prototype = {
  constructor: CLOUD.Loader.MPKReader,
  getMeshData: function(t) {
    var e = t - this.header.startId;
    if (e >= 0 && e < this.header.meshCount)
      return new CLOUD.Loader.MeshData(this.meshBuffer, e * this.meshSize)
  },
  getMeshInfo: function(t) {
    if (t == this.mesh_cur_id)
      return this.mesh_cur;
    var e = t - this.header.startId;
    if (e >= 0 && e < this.header.meshCount) {
      var i = new Uint32Array(this.meshBuffer, e * this.meshSize, 4);
      this.mesh_cur.mesh_id = i[0],
      this.mesh_cur.ptCount = i[1],
      this.mesh_cur.idxCount = i[2],
      this.mesh_cur.dataOffset = i[3];
      var n = new Float32Array(this.meshBuffer, e * this.meshSize + 16, 4);
      return this.mesh_cur.baseScale = n[0],
      this.mesh_cur.baseVector.set(n[1], n[2], n[3]),
      this.mesh_cur_id = t,
      this.mesh_cur
    }
  },
  getPtBuffer: function(t) {
    var e = t - this.header.startId;
    if (e >= 0 && e < this.header.meshCount) {
      var i = this.getMeshInfo(t);
      if (void 0 === i)
        return;
      return 0 == i.baseScale
        ? new Float32Array(this.geomBuffer, i.dataOffset, 3 * i.ptCount)
        : new Uint16Array(this.geomBuffer, i.dataOffset, 3 * i.ptCount)
    }
  },
  getIdxBuffer: function(t) {
    var e = t - this.header.startId;
    if (e >= 0 && e < this.header.meshCount) {
      var i = this.getMeshInfo(t);
      if (void 0 === i)
        return;
      var n = i.dataOffset;
      return 0 == i.baseScale
        ? n += 3 * i.ptCount * 4
        : (n += 3 * i.ptCount * 2, i.ptCount % 2 == 1 && (n += 2)),
      i.ptCount > 65535
        ? new Uint32Array(this.geomBuffer, n, i.idxCount)
        : new Uint16Array(this.geomBuffer, n, i.idxCount)
    }
  },
  getNormalBuffer: function(t) {
    var e = t - this.header.startId;
    if (2 == (2 & this.header.vtFormat) && e >= 0 && e < this.header.meshCount) {
      var i = this.getMeshInfo(t);
      if (void 0 === i)
        return;
      var n = i.dataOffset;
      return 0 == i.baseScale
        ? n += 3 * i.ptCount * 4
        : (n += 3 * i.ptCount * 2, i.ptCount % 2 == 1 && (n += 2)),
      i.ptCount > 65535
        ? n += 4 * i.idxCount
        : (n += 2 * i.idxCount, i.idxCount % 2 == 1 && (n += 2)),
      new Float32Array(this.geomBuffer, n, 3 * i.ptCount)
    }
  }
},
CLOUD.Loader.SceneHeader = function(t) {
  var e = new Uint32Array(t, 0, 11);
  this.blockId = e[0],
  this.cellCount = e[1],
  this.itemCount = e[2],
  this.matrixCount = e[3],
  this.geomBuffSize = e[4],
  this.layerBuffSize = e[5],
  this.cellOffset = e[6],
  this.itemOffset = e[7],
  this.matrixOffset = e[8],
  this.geomOffset = e[9],
  this.layerOffset = e[10];
  var i = new Float32Array(t, 44, 6);
  this.boundingBox = new THREE.Box3(new THREE.Vector3(i[0], i[1], i[2]), new THREE.Vector3(i[3], i[4], i[5])),
  e = null,
  i = null
},
CLOUD.Loader.Cell = function(t, e) {
  var i = new Int32Array(t, e, 5);
  this.cellId = i[0],
  this.depth = i[1],
  this.itemIndex = i[2],
  this.itemCount = i[3],
  this.layerType = i[4],
  this.layerSize = new Int32Array(t, e + 20, 8),
  this.layerOffset = new Int32Array(t, e + 52, 8);
  var n = new Float32Array(t, e + 84, 6);
  this.boundingBox = new THREE.Box3(new THREE.Vector3(n[0], n[1], n[2]), new THREE.Vector3(n[3], n[4], n[5])),
  i = null,
  n = null
},
CLOUD.Loader.Item = function(t, e) {
  var i = new Int32Array(t, e, 7);
  this.ItemId = i[0],
  this.originalId = i[1],
  this.materialId = i[2],
  this.userDataId = i[3],
  this.matrixId = i[4],
  this.type = i[5],
  this.toData = i[6];
  var n = new Float32Array(t, e + 28, 6);
  this.boundingBox = new THREE.Box3(new THREE.Vector3(n[0], n[1], n[2]), new THREE.Vector3(n[3], n[4], n[5])),
  i = null,
  n = null
},
CLOUD.Loader.Matrix = function(t, e) {
  var i = new Float32Array(t, e, 16);
  this.matrix = (new THREE.Matrix4).fromArray(i),
  i = null
},
CLOUD.Loader.GeomPipe = function(t, e) {
  var i = new Float32Array(t, e, 8);
  this.startPt = new THREE.Vector3(i[0], i[1], i[2]),
  this.endPt = new THREE.Vector3(i[3], i[4], i[5]),
  this.radius = i[6],
  this.thickness = i[7],
  i = null
},
CLOUD.Loader.SceneReader = function(t) {
  this.header = new CLOUD.Loader.SceneHeader(t),
  this.cellSize = 108,
  this.itemSize = 52,
  this.matrixSize = 64,
  this.maxSize = 1024,
  this.cellBuffer = t.slice(this.header.cellOffset, this.header.cellOffset + this.header.cellCount * this.cellSize),
  this.itemBuffer = t.slice(this.header.itemOffset, this.header.itemOffset + this.header.itemCount * this.itemSize),
  this.matrixBuffer = t.slice(this.header.matrixOffset, this.header.matrixOffset + this.header.matrixCount * this.matrixSize),
  this.geomBuffer = t.slice(this.header.geomOffset, this.header.geomOffset + this.header.geomBuffSize),
  this.layerBuffer = t.slice(this.header.layerOffset, this.header.layerOffset + this.header.layerBuffSize),
  this.matr_cur_id = -1,
  this.pt_cell_min = new THREE.Vector3(0, 0, 0),
  this.pt_cell_max = new THREE.Vector3(0, 0, 0),
  this.pt_item_min = new THREE.Vector3(0, 0, 0),
  this.pt_item_max = new THREE.Vector3(0, 0, 0);
  var e = new ArrayBuffer(this.maxSize);
  this.cell_cur = new CLOUD.Loader.Cell(e, 0),
  this.item_cur = new CLOUD.Loader.Item(e, 0),
  this.matr_cur = new CLOUD.Loader.Matrix(e, 0),
  this.pipe_cur = new CLOUD.Loader.GeomPipe(e, 0),
  this.cell_cur.boundingBox.set(this.pt_cell_min, this.pt_cell_max),
  this.item_cur.boundingBox.set(this.pt_item_min, this.pt_item_max)
},
CLOUD.Loader.SceneReader.prototype = {
  constructor: CLOUD.Loader.SceneReader,
  getCellMpks: function(t) {
    if (t >= 0 && t < this.header.cellCount) {
      for (var e = [], i = this.getCellInfo(t), n = i.itemIndex; n < i.itemCount; ++n) {
        var o = this.getItemInfo(n);
        if (1 === o.type) {
          var r = this.getMpkID(o.toData);
          e.push(r)
        }
      }
      for (var a = {}, s = [], l = 0; l < e.length; ++l)
        a[e[l]] || (a[e[l]] = !0, s.push(e[l]));
      return s
    }
  },
  getCell: function(t) {
    if (t >= 0 && t < this.header.cellCount)
      return new CLOUD.Loader.Cell(this.cellBuffer, t * this.cellSize)
  },
  getItem: function(t) {
    if (t >= 0 && t < this.header.itemCount)
      return new CLOUD.Loader.Item(this.itemBuffer, t * this.itemSize)
  },
  getMatrix: function(t) {
    if (t >= 0 && t < this.header.matrixCount)
      return new CLOUD.Loader.Matrix(this.matrixBuffer, t * this.matrixSize)
  },
  getGeomPipe: function(t) {
    if (t >= 0 && t < this.header.geomBuffSize)
      return new CLOUD.Loader.GeomPipe(this.geomBuffer, t)
  },
  getCellInfo: function(t) {
    if (t >= 0 && t < this.header.cellCount) {
      var e = new Int32Array(this.cellBuffer, t * this.cellSize, 5);
      this.cell_cur.cellId = e[0],
      this.cell_cur.depth = e[1],
      this.cell_cur.itemIndex = e[2],
      this.cell_cur.itemCount = e[3],
      this.cell_cur.layerType = e[4],
      this.cell_cur.layerSize = new Int32Array(this.cellBuffer, t * this.cellSize + 20, 8),
      this.cell_cur.layerOffset = new Int32Array(this.cellBuffer, t * this.cellSize + 52, 8);
      var i = new Float32Array(this.cellBuffer, t * this.cellSize + 84, 6);
      return this.pt_cell_min.set(i[0], i[1], i[2]),
      this.pt_cell_max.set(i[3], i[4], i[5]),
      this.cell_cur.boundingBox.set(this.pt_cell_min, this.pt_cell_max),
      this.cell_cur
    }
  },
  getItemInfo: function(t) {
    if (t >= 0 && t < this.header.itemCount) {
      var e = new Int32Array(this.itemBuffer, t * this.itemSize, 7);
      this.item_cur.ItemId = e[0],
      this.item_cur.originalId = e[1],
      this.item_cur.materialId = e[2],
      this.item_cur.userDataId = e[3],
      this.item_cur.matrixId = e[4],
      this.item_cur.type = e[5],
      this.item_cur.toData = e[6];
      var i = new Float32Array(this.itemBuffer, t * this.itemSize + 28, 6);
      return this.pt_item_min.set(i[0], i[1], i[2]),
      this.pt_item_max.set(i[3], i[4], i[5]),
      this.item_cur.boundingBox.set(this.pt_item_min, this.pt_item_max),
      this.item_cur
    }
  },
  getMatrixInfo: function(t) {
    if (t == this.matr_cur_id)
      return this.matr_cur;
    if (t >= 0 && t < this.header.matrixCount) {
      var e = new Float32Array(this.matrixBuffer, t * this.matrixSize, 16);
      return this.matr_cur.matrix.fromArray(e),
      this.matr_cur_id = t,
      this.matr_cur
    }
  },
  getGeomPipeInfo: function(t) {
    if (t >= 0 && t < this.header.geomBuffSize) {
      var e = new Float32Array(this.geomBuffer, t, 8);
      return this.pipe_cur.startPt.set(e[0], e[1], e[2]),
      this.pipe_cur.endPt.set(e[3], e[4], e[5]),
      this.pipe_cur.radius = e[6],
      this.pipe_cur.thickness = e[7],
      this.pipe_cur
    }
  },
  getLayerInfo: function(t, e) {
    if (t >= 0 && t + e < this.header.layerBuffSize) {
      new Uint32Array(this.layerBuffer, t, e);
      return this.data
    }
  },
  getMpkID: function(t) {
    return parseInt(t / 65536)
  },
  getMeshIndex: function(t) {
    return parseInt(t % 65536)
  }
},
CLOUD.TaskWorker = function(t, e) {
  this.MaxThreadCount = t || 8;
  var i = this;
  i.todoList = {},
  i.todoCount = 0,
  i.doingCount = 0,
  this.hasTask = function() {
    return i.todoCount > 0
  },
  this.addItem = function(t, e) {
    i.todoList[t] = e,
    i.todoCount++
  },
  this.clearTasks = function() {
    i.todoList = {},
    i.todoCount = 0
  },
  this.run = function(t, i, n) {
    function o(t) {
      if (t >= c)
        return void(r.doingCount < 1 && e());
      var n = a[t];
      i(n, t + h, o)
    }
    var r = this;
    if (!(r.doingCount > 0)) {
      var a = [],
        s = r.todoList;
      for (var l in s)
        s.hasOwnProperty(l) && a.push(l);
      r.todoList = {},
      r.todoCount = 0;
      var c = a.length;
      if (0 != c) {
        n && a.sort(n),
        c = Math.min(c, CLOUD.GlobalData.ConcurrencyRequestCount);
        var h = Math.min(this.MaxThreadCount, c);
        r.doingCount = c;
        for (var u = 0; u < h; ++u)
          o(u)
      }
    }
  }
},
CLOUD.MpkTaskWorker = function(t) {
  this.MaxThreadCount = t || 8,
  this.todoList = [],
  this.doingCount = 0,
  this.listners = [],
  this.addItem = function(t) {
    if (void 0 === t)
      return void console.log("undefined mpkId");
    this.todoList.push(t)
  },
  this.run = function(t, e) {
    function i(n) {
      if (n >= s)
        if (a.doingCount < 1) {
          e(0, s);
          for (var r = 0, h = l.length; r < h; ++r)
            l[r](0, s);
          l = [],
          a.run(t, function() {})
        } else
          e(a.doingCount, s);
    else {
        n >= c && e(a.doingCount, s);
        var u = o[n];
        t(u, n + c, i)
      }
    }
    if (this.doingCount > 0)
      return void this.listners.push(e);
    var n = this.todoList;
    this.todoList = [];
    var o = [];
    for (var r in n)
      n.hasOwnProperty(r) && o.push(r);
    var a = this,
      s = o.length;
    if (0 == s)
      return void e();
    var l = this.listners;
    this.listners = [],
    a.doingCount = s;
    for (var c = Math.min(this.MaxThreadCount, s), h = 0; h < c; ++h)
      i(h)
  }
},
CLOUD.TaskManager = function(t) {
  this.manager = t,
  this.mpkWorker = new CLOUD.MpkTaskWorker(8)
},
CLOUD.TaskManager.prototype = {
  constructor: CLOUD.TaskManager,
  addMpkTask: function(t) {
    this.mpkWorker.addItem(t)
  },
  processMpkTasks: function(t) {
    function e(t, e, n) {
      i.manager.loadMpk(t, function() {
        --i.mpkWorker.doingCount,
        n(e)
      })
    }
    var i = this;
    this.mpkWorker.run(e, t || function() {})
  }
},
CLOUD.Loader.ModelLoader = function(t, e) {
  THREE.LoadingManager.call(this),
  this.model = t,
  this.taskManager = new CLOUD.TaskManager(this),
  this.url = new CLOUD.Loader.Url(e.serverUrl, e.databagId),
  this.loader = new THREE.FileLoader(this),
  this.loadTaskCount = 0,
  this.maxLoadTaskCount = 0,
  this.octreeRootNode = null,
  this.octreeRootNodeI = null,
  this.symbolReader = null,
  this.userIdReader = null,
  this.userDataReader = null,
  this.sceneReaderArray = null
},
CLOUD.Loader.ModelLoader.prototype = Object.create(THREE.LoadingManager.prototype),
CLOUD.Loader.ModelLoader.prototype.constructor = CLOUD.Loader.ModelLoader,
CLOUD.Loader.ModelLoader.prototype._onTaskFinished = function() {
  var t = this.model;
  if (this.loadTaskCount++, this.notifyProgress) {
    var e = {
      total: this.maxLoadTaskCount,
      loaded: this.loadTaskCount
    };
    t.dispatchEvent({type: CLOUD.EVENTS.ON_LOAD_PROGRESS, progress: e})
  }
  if (this.loadTaskCount >= this.maxLoadTaskCount) {
    t.loaded = !0;
    var i = this.model.manager.scene;
    if (CLOUD.GlobalData.IBL && null != i.iblProbe && i.iblProbe.isComputed) {
      this.model.updateMaterials();
      var n = i.IBLcfg,
        o = Object.keys(n),
        r = n[o[i.IBLIndex]];
      for (var a in r)
        this.model.updateMaterialsValue(a, r[a])
    }
    t.dispatchEvent({type: CLOUD.EVENTS.ON_LOAD_COMPLETE})
  }
},
CLOUD.Loader.ModelLoader.prototype._loadScene = function(t, e, i) {
  var n = this;
  t.setResponseType("arraybuffer"),
  t.load(e.sceneUrl(i), function(t) {
    var e = new CLOUD.Loader.SceneReader(t),
      i = e.header.blockId;
    i < n.sceneCount && (n.sceneReaderArray[i] = e),
    e = null,
    n._onTaskFinished()
  })
},
CLOUD.Loader.ModelLoader.prototype._loadMaterial = function(t, e) {
  var i = this;
  t.setResponseType("arraybuffer"),
  t.load(e.materialUrl(), function(t) {
    i._parseMaterial(t, e),
    i._onTaskFinished()
  })
},
CLOUD.Loader.ModelLoader.prototype._loadSymbol = function(t, e) {
  var i = this;
  t.setResponseType("arraybuffer"),
  t.load(e.symbolUrl(), function(t) {
    i.symbolReader = new CLOUD.Loader.SymbolReader(t),
    i._onTaskFinished()
  })
},
CLOUD.Loader.ModelLoader.prototype._loadOctreeInner = function(t, e, i) {
  var n = this;
  t.load(e.octreeUrl("i"), function(t) {
    n._parseOctree(t, i, !0),
    n._onTaskFinished()
  })
},
CLOUD.Loader.ModelLoader.prototype._loadOctreeOuter = function(t, e, i) {
  var n = this;
  t.load(e.octreeUrl("o"), function(t) {
    n._parseOctree(t, i, !1),
    n._onTaskFinished()
  })
},
CLOUD.Loader.ModelLoader.prototype._loadUserId = function(t, e) {
  var i = this;
  t.setResponseType("arraybuffer"),
  t.load(e.userIdUrl(), function(t) {
    i.userIdReader = new CLOUD.Loader.IdReader(t),
    i._onTaskFinished()
  }, void 0, function(t) {
    i._onTaskFinished()
  })
},
CLOUD.Loader.ModelLoader.prototype._loadUserData = function(t, e) {
  var i = this;
  t.setResponseType(""),
  t.load(e.userDataUrl(), function(t) {
    i.userDataReader = new CLOUD.Loader.UserDataReader(t),
    i._onTaskFinished()
  })
},
CLOUD.Loader.ModelLoader.prototype._loadTexture = function(t, e, i, n) {
  var o,
    r = THREE.Loader.Handlers.get(t),
    a = this;
  return null !== r
    ? o = r.load(t, e)
    : (o = new THREE.Texture, r = new THREE.ImageLoader(a), r.setCrossOrigin("anonymous"), r.load(t, function(t) {
      o.image = CLOUD.MaterialUtil.ensurePowerOfTwo(t),
      o.needsUpdate = !0,
      e && e(o)
    }, i, n)),
  o
},
CLOUD.Loader.ModelLoader.prototype._loadMpks = function(t, e, i) {
  for (var n = this.taskManager, o = 0; o < i; ++o)
    n.addMpkTask(o);
  n.processMpkTasks()
},
CLOUD.Loader.ModelLoader.prototype._parseMpk = function(t) {
  for (var e = this.model.getReferencedMeshCache(), i = new MPK.MPKReader(t), n = i.header.meshCount, o = 0; o < n; ++o) {
    var r = i.getPtBuffer(o),
      a = i.getIdxBuffer(o),
      s = i.getNormalBuffer(o),
      l = i.getMeshData(o),
      c = i.getUVBuffer(o);
    if (void 0 != r && void 0 != a && void 0 != s) {
      e[l.mesh_id] = {
        P: r,
        I: a,
        N: s,
        M: l,
        UV: c
      }
    } else
      CLOUD.Logger.log("Error Geometry!")
  }
  i = null
},
CLOUD.Loader.ModelLoader.prototype._parseMaterial = function(t, e) {
  var i = this.model.getMaterials(),
    n = this.model.getTextures(),
    o = new CLOUD.Loader.MaterialReader(t),
    r = o.materialCount;
  if (!(r < 0)) {
    for (var a = this.model.manager.scene, s = 0; s < r; ++s) {
      var l = {},
        c = o.getMaterial(s);
      void 0 !== c.color && (l.color = c.color),
      void 0 !== c.opacity && (l.opacity = c.opacity, c.opacity < 1 && (l.transparent = !0)),
      void 0 !== c.side && c.side && (l.side = THREE.DoubleSide),
      void 0 !== c.emissive && (l.emissive = c.emissive),
      void 0 !== c.specular && (l.specular = c.specular),
      void 0 !== c.shininess && (l.shininess = c.shininess);
      var h = c.texture_n,
        u = null;
      if (h > 0 && (u = o.getTexture(c.texture_id[0])), u) {
        var d = u.id + u.file_name_ext,
          p = this._loadTexture(e.textureUrl(d));
        p.repeat.fromArray([u.scale_u, u.scale_v]),
        p.offset.fromArray([u.offset_u, u.offset_v]),
        p.setRotateAngle && p.setRotateAngle(u.angle),
        u.repeat_u && (p.wrapS = THREE.RepeatWrapping),
        u.repeat_v && (p.wrapT = THREE.RepeatWrapping),
        p && (n[s] = p)
      }
      if (CLOUD.GlobalData.IBL) {
        l.iblProbe = a.iblProbe;
        var f = new ImageBasedLighting.IBLMaterial(l);
        f.type = "IBL"
      } else
        var f = CLOUD.MaterialUtil.createPhongMaterial(l);
      f.name = s,
      i[s] = f,
      l = null
    }
    o = null
  }
},
CLOUD.Loader.ModelLoader.prototype._parseOctree = function(t, e, i) {
  function n(t, i) {
    t.childStart = i.child_s,
    t.childEnd = i.child_e,
    e && i.boundingBox.applyMatrix4(e);
    var n = t.min = i.boundingBox.min,
      o = t.max = i.boundingBox.max;
    t.center = new THREE.Vector3(.5 * (o.x + n.x), .5 * (o.y + n.y), .5 * (o.z + n.z));
    var r = o.x - n.x,
      a = o.y - n.y,
      s = o.z - n.z;
    t.size = r * r + a * a + s * s
  }
  function o(t, e) {
    t.octType = 0,
    t.center.x < e.center.x && (t.octType += 1),
    t.center.y < e.center.y && (t.octType += 2),
    t.center.z < e.center.z && (t.octType += 4)
  }
  function r(t, e) {
    for (var i = t.childStart, a = t.childEnd, s = i; s < a; ++s) {
      var l = e.getNode(s),
        c = l.cell_id,
        h = new CLOUD.Loader.OctreeNode(c, t.depth);
      n(h, l),
      t.add(h),
      o(h, t),
      h.updateMaxDepth(),
      r(h, e)
    }
  }
  var a = null,
    s = new CLOUD.Loader.OctreeReader(t);
  if (s.getCount() > 0) {
    var l = s.getNode(0),
      c = l.cell_id;
    a = new CLOUD.Loader.OctreeNode(c, 0),
    n(a, l),
    r(a, s)
  }
  i
    ? this.octreeRootNodeI = a
    : this.octreeRootNode = a,
  CLOUD.Logger.log("Maximum Depth:", CLOUD.GlobalData.MaximumDepth)
},
CLOUD.Loader.ModelLoader.prototype.destroy = function() {
  this.taskManager = null,
  this.url = null,
  this.model = null,
  this.loader = null,
  this.octreeRootNode = null,
  this.octreeRootNodeI = null,
  this.userIdReader = null,
  this.userDataReader = null,
  this.symbolReader = null,
  this.sceneReaderArray = null
},
CLOUD.Loader.ModelLoader.prototype.getOctreeRootNodeInner = function() {
  return this.octreeRootNodeI
},
CLOUD.Loader.ModelLoader.prototype.getOctreeRootNodeOuter = function() {
  return this.octreeRootNode
},
CLOUD.Loader.ModelLoader.prototype.getSceneReaderArray = function() {
  return this.sceneReaderArray
},
CLOUD.Loader.ModelLoader.prototype.getSymbolReader = function() {
  return this.symbolReader
},
CLOUD.Loader.ModelLoader.prototype.getUserIdReader = function() {
  return this.userIdReader
},
CLOUD.Loader.ModelLoader.prototype.getUserDataReader = function() {
  return this.userDataReader
},
CLOUD.Loader.ModelLoader.prototype.setCrossOrigin = function(t) {
  this.loader.setCrossOrigin(t)
},
CLOUD.Loader.ModelLoader.prototype.load = function(t) {
  var e = this,
    i = this.url,
    n = this.loader,
    o = this.model,
    r = o.manager.scene;
  this.notifyProgress = t,
  o.dispatchEvent({type: CLOUD.EVENTS.ON_LOAD_START}),
  n.setResponseType(""),
  n.load(i.projectUrl(), function(t) {
    var a;
    o.loaded = !1;
    try {
      a = JSON.parse(t)
    } catch (t) {
      return console.log("Config data exceptions!"),
      void o.dispatchEvent({type: CLOUD.EVENTS.ON_LOAD_INVALID_SCENE})
    }
    var s = a.metadata,
      l = e.sceneCount = s.scenes;
    if (0 === l)
      return void o.dispatchEvent({type: CLOUD.EVENTS.ON_LOAD_EMPTY_SCENE});
    var c = s.mpks,
      h = s.symbol,
      u = s.octree_o,
      d = s.octree_i,
      p = s.material || 0,
      f = s.userdata || 0,
      m = a.view.transform;
    e.sceneReaderArray = new Array(l),
    e.maxLoadTaskCount = 0,
    e.maxLoadTaskCount += 1,
    c > 0 && (e.maxLoadTaskCount += c),
    e.maxLoadTaskCount += h,
    e.maxLoadTaskCount += u,
    e.maxLoadTaskCount += d,
    e.maxLoadTaskCount += p,
    e.maxLoadTaskCount += f,
    e.maxLoadTaskCount += 1,
    o.parseRootNode(a),
    e._loadScene(n, i, 0),
    e._loadMpks(n, i, c),
    e._loadMaterial(n, i),
    h > 0 && e._loadSymbol(n, i);
    var g;
    g = void 0 !== m && 1 !== m
      ? r.getMatrixWorldGlobal()
      : null,
    u > 0 && e._loadOctreeOuter(n, i, g),
    d > 0 && e._loadOctreeInner(n, i, g),
    e._loadUserId(n, i),
    f > 0 && e._loadUserData(n, i),
    o.dispatchEvent({type: CLOUD.EVENTS.ON_LOAD_CONFIG_FINISH})
  }, void 0, function() {
    console.log("config load error!"),
    o.dispatchEvent({type: CLOUD.EVENTS.ON_LOAD_INVALID_SCENE})
  })
},
CLOUD.Loader.ModelLoader.prototype.loadMpk = function(t, e) {
  var i = this,
    n = this.model.getReferencedMeshCache(),
    o = this.loader,
    r = this.url,
    a = CLOUD.GlobalData.MpkWorkerUrl;
  CLOUD.GlobalData.UseMpkWorker
    ? (o.setResponseType("arraybuffer"), o.load(r.mpkUrl(t), function(t) {
      var o = new Worker(a);
      o.onmessage = function(t) {
        var o = t.data;
        for (var r in o)
          o.hasOwnProperty(r) && (n[r] = o[r]);
        e(),
        i._onTaskFinished()
      },
      o.postMessage({msg: t})
    }))
    : (o.setResponseType("arraybuffer"), o.load(r.mpkUrl(t), function(t) {
      i._parseMpk(t),
      e(),
      i._onTaskFinished()
    }))
},
CLOUD.Model = function(t, e) {
  this.manager = t,
  this.databagId = e.databagId,
  this.loader = new CLOUD.Loader.ModelLoader(this, e),
  this.pool = t.getObjectPool(),
  this.renderableCount = 0,
  this.renderableTotal = CLOUD.GlobalData.maxObjectNumInPool,
  this.numOfElements = 0,
  this.numOfTriangles = 0,
  this.boundingBoxWorld = null,
  this.cache = {
    cells: {},
    geometries: {},
    materials: {},
    textures: {},
    vertices: [],
    indices: []
  },
  this.wireFrame = null,
  this.visibleOctant = [],
  this.occlusionVisibleOctant = [],
  this.containsCamera = !1,
  this.loaded = !1,
  this.visible = !0,
  this.referencedMeshCache = {},
  this.nodePriority = {
    high: [],
    medium: [],
    low: []
  }
},
CLOUD.Model.prototype.destroy = function() {
  this.loader.destroy(),
  this.loader = null,
  this._clearNodePriority(!0),
  this.nodePriority = null,
  this._clearCache(),
  this.cache = null,
  this.pool = null,
  this.manager = null,
  this.visibleOctant = null,
  this.occlusionVisibleOctant = null,
  this.occlusionCamera && (this.occlusionCamera = null),
  this.renderableTotal = CLOUD.GlobalData.maxObjectNumInPool,
  this.numOfElements = 0,
  this.numOfTriangles = 0
},
CLOUD.Model.prototype._clearCache = function() {
  var t,
    e,
    i = this.cache,
    n = i.geometries,
    o = i.materials;
  for (var r in n)
    t = n[r],
    t.dispose();
  for (r in o)
    e = o[r],
    e.dispose();
  i.cells = {},
  i.geometries = {},
  i.materials = {},
  i.textures = {}
},
CLOUD.Model.prototype._updateTextureMapping = function() {
  var t = CLOUD.GlobalData.EnableTextureMapping;
  if (this.lastTextureEnabled !== t) {
    var e,
      i,
      n = this.cache.textures,
      o = this.cache.materials;
    if (t) {
      for (e in o)
        if (o.hasOwnProperty(e)) {
          i = o[e];
          var r = n[e];
          r && (i.map = r, CLOUD.GlobalData.IBL && i.refreshUniforms(), i.needsUpdate = !0)
        }
      } else
      for (e in o)
        o.hasOwnProperty(e) && (i = o[e], i.map = null, i.needsUpdate = !0);
  this.lastTextureEnabled = t
  }
},
CLOUD.Model.prototype.getOctreeRoots = function(t) {
  var e = this.loader,
    i = e.getOctreeRootNodeOuter();
  i && t.push(i);
  var n = e.getOctreeRootNodeInner();
  n && t.push(n)
},
CLOUD.Model.prototype._clearNodePriority = function(t) {
  var e = this.nodePriority;
  e.high = [],
  e.medium = [],
  t && (e.low = [])
},
CLOUD.Model.prototype._readMeshInfo = function(t, e, i, n, o, r) {
  var a,
    s,
    l,
    c = this.loader,
    h = this.cache.cells[e],
    u = this.cache.geometries;
  null === n
    ? (a = i.userDataId, s = i.originalId, l = i.materialId)
    : (
      a = n.userDataId, s = n.originalId, l = n.materialId > -1
      ? n.materialId
      : i.materialId);
  var d = c.getUserIdReader(),
    p = d
      ? d.getString(s)
      : s,
    f = null;
  if (
    1 === i.type
    ? f = this._getMeshNodeAttribute(t, i, n)
    : 2 === i.type
      ? f = this._getMeshNodeAttrOfTube(u, t, i, n)
      : 3 === i.type
        ? f = this._getMeshNodeAttrOfPipe(u, t, i, n)
        : 4 === i.type && (f = this._getMeshNodeAttrOfBox(u, t, i, n)),
  f) {
    var m = f.nodeId,
      g = c.getUserDataReader(),
      v = g
        ? g.getUserData(a)
        : null,
      y = f.matrix.clone(),
      E = {
        nodeId: m,
        name: p,
        userData: v,
        meshId: f.meshId,
        matrix: y,
        materialId: l,
        categoryId: o,
        cellDepth: r
      };
    h.push(E),
    f = null
  }
},
CLOUD.Model.prototype._readSymbolInfo = function(t, e, i, n, o) {
  var r = this.loader.getSymbolReader();
  if (r) {
    var a = r.header.symbolCount;
    if (t >= 0 && t < a)
      for (var s = r.getSymbolInfo(t), l = s.itemIndex; l < s.itemCount; ++l) {
        var c = r.getItemInfo(l);
        0 !== c.type && this._readMeshInfo(r, e, c, i, n, o)
      }
    }
},
CLOUD.Model.prototype._getMeshNodeAttribute = function(t, e, i) {
  var n = t.getMatrixInfo(e.matrixId).matrix.clone(),
    o = i
      ? i.ItemId + "_" + e.ItemId
      : e.ItemId,
    r = e.toData,
    a = this.referencedMeshCache,
    s = a[r].M;
  if (void 0 === s)
    return CLOUD.Logger.log("No mesh information."),
    null;
  var l = this.cache.geometries,
    c = l[r];
  if (!c) {
    var h = a[r].P,
      u = a[r].I,
      d = a[r].N,
      p = a[r].UV;
    c = new THREE.BufferGeometry,
    c.setIndex(new THREE.BufferAttribute(u, 1)),
    c.addAttribute("position", new THREE.BufferAttribute(h, 3)),
    d && c.addAttribute("normal", new THREE.BufferAttribute(d, 3)),
    p && c.addAttribute("uv", new THREE.BufferAttribute(p, 2)),
    l[r] = c
  }
  var f = new THREE.Matrix4;
  return f.setPosition(new THREE.Vector3(s.baseX, s.baseY, s.baseZ)),
  f.scale(new THREE.Vector3(s.baseScale, s.baseScale, s.baseScale)),
  0 !== s.baseScale && n.multiply(f),
  i && n.multiplyMatrices(i.matrix, n),
  f = null, {
    nodeId: o,
    meshId: r,
    matrix: n
  }
},
CLOUD.Model.prototype._getMeshNodeAttrOfTube = function(t, e, i, n) {
  var o = e.getGeomPipeInfo(i.toData),
    r = e.getMatrixInfo(i.matrixId).matrix.clone(),
    a = n
      ? n.ItemId + "_" + i.ItemId
      : i.ItemId,
    s = t.tube;
  s || (s = CLOUD.GeomUtil.UnitCylinderInstance, t.tube = s);
  var l = o.startPt,
    c = o.endPt,
    h = new THREE.Vector3;
  h.subVectors(c, l);
  var u = h.length();
  h.normalize();
  var d = o.radius;
  d <= 1 && (d = 100);
  var p = new THREE.Vector3(0, 1, 0),
    f = new THREE.Vector3(d, u, d),
    m = (new THREE.Quaternion).setFromUnitVectors(p, h),
    g = l.clone().addScaledVector(h, .5 * u),
    v = (new THREE.Matrix4).compose(g, m, f);
  return r.multiply(v),
  n && r.multiplyMatrices(n.matrix, r),
  o = null, {
    nodeId: a,
    meshId: "tube",
    matrix: r
  }
},
CLOUD.Model.prototype._getMeshNodeAttrOfPipe = function(t, e, i, n) {
  var o = e.getGeomPipeInfo(i.toData),
    r = e.getMatrixInfo(i.matrixId).matrix.clone(),
    a = n
      ? n.ItemId + "_" + i.ItemId
      : i.ItemId,
    s = t.pipe;
  s || (s = CLOUD.GeomUtil.UnitCylinderInstance, t.pipe = s);
  var l = o.startPt,
    c = o.endPt,
    h = new THREE.Vector3;
  h.subVectors(c, l);
  var u = h.length();
  h.normalize();
  var d = o.radius;
  d <= 1 && (d = 100);
  var p = new THREE.Vector3(0, 1, 0),
    f = new THREE.Vector3(d, u, d),
    m = (new THREE.Quaternion).setFromUnitVectors(p, h),
    g = l.clone().addScaledVector(h, .5 * u),
    v = (new THREE.Matrix4).compose(g, m, f);
  return r.multiply(v),
  n && r.multiplyMatrices(n.matrix, r),
  o = null, {
    nodeId: a,
    meshId: "pipe",
    matrix: r
  }
},
CLOUD.Model.prototype._getMeshNodeAttrOfBox = function(t, e, i, n) {
  var o = e.getMatrixInfo(i.matrixId).matrix.clone(),
    r = i.boundingBox,
    a = r.getSize(),
    s = r.getCenter(),
    l = n
      ? n.ItemId + "_" + i.ItemId
      : i.ItemId,
    c = t.box;
  c || (c = CLOUD.GeomUtil.UnitBoxInstance, t.box = c);
  var h = (new THREE.Matrix4).scale(new THREE.Vector3(a.x, a.y, a.z));
  h.setPosition(s),
  o.multiply(h),
  n && o.multiplyMatrices(n.matrix, o);
  for (var u = CLOUD.GeomUtil.UnitBoxInstance.getAttribute("position"), d = u.array, p = new THREE.Vector3, f = 0; f < u.count; ++f)
    p.set(d[3 * f], d[3 * f + 1], d[3 * f + 2]),
    p.applyMatrix4(o),
    this.cache.vertices.push(p.x, p.y, p.z);
  for (var m = this.cache.indices.length / 2, g = 0; g < 6; ++g)
    this.cache.indices.push(4 * g + m, 4 * g + 1 + m),
    this.cache.indices.push(4 * g + 1 + m, 4 * g + 3 + m),
    this.cache.indices.push(4 * g + 3 + m, 4 * g + 2 + m),
    this.cache.indices.push(4 * g + 2 + m, 4 * g + m);
  return {nodeId: l, meshId: "box", matrix: o}
},
CLOUD.Model.prototype._overrideOcclusionMaterial = function(t) {
  var e = t.material;
  if (e && e.transparent === !1) {
    var i = this.manager.acquireMaterial(),
      n = i.material;
    e.color
      ? n.color.copy(e.color)
      : i.resetColor(),
    n.opacity = CLOUD.GlobalData.OcclusionOpacity,
    t.material = n,
    t.material.needsUpdate = !0
  }
},
CLOUD.Model.prototype._occlusionTest = function() {
  if (CLOUD.GlobalData.OcclusionTranslucentEnabled) {
    var t = this.pool.getObjects(),
      e = this.manager.octantToObjectMap,
      i = this.occlusionVisibleOctant.length;
    if (i > 0)
      for (var n = this.manager.getFrustumFromOcclusionCamera(), o = 0; o < i; ++o) {
        var r = this.occlusionVisibleOctant[o].octantId,
          a = e[r];
        if (a && a.length > 0)
          for (j = 0; j < a.length; j += 2)
            for (var s = a[j]; s <= a[j + 1]; s++) {
              var l = t[s];
              CLOUD.CameraUtil.intersectObjectWithFrustum(l, n) && this._overrideOcclusionMaterial(l)
            }
          }
    }
},
CLOUD.Model.prototype._sortVisibleOctant = function(t) {
  var e = this,
    i = null;
  if (e.containsCamera && null != e.loader.octreeRootNodeI) {
    var n = new CLOUD.OctantNeighborUtil(t, e.loader.octreeRootNodeI);
    i = n.getAncestorAndNeighbors()
  }
  this.visibleOctant.sort(function(t, e) {
    if (null != i) {
      if (void 0 != i[t.octantId])
        return -1;
      if (void 0 != i[e.octantId])
        return 1
    }
    return t.priority > e.priority
      ? -1
      : t.priority < e.priority
        ? 1
        : 0
  })
},
CLOUD.Model.prototype._readItemData = function(t, e, i, n, o) {
  var r = t.getItemInfo(e);
  if (void 0 !== r)
    if (0 === r.type) {
      var a = t.getMatrixInfo(r.matrixId).matrix.clone(),
        s = {
          matrix: a,
          ItemId: r.ItemId,
          originalId: r.originalId,
          userDataId: r.userDataId,
          materialId: r.materialId
        };
      this._readSymbolInfo(r.toData, i, s, n, o),
      s = null
    } else
      this._readMeshInfo(t, i, r, null, n, o)
},
CLOUD.Model.prototype._updateMeshNodes = function(t) {
  for (var e = this.pool, i = this.manager, n = i.filter, o = this.databagId, r = this.cache, a = r.geometries, s = r.materials, l = this.nodePriority, c = [
    l.high, l.medium, l.low
  ], h = new THREE.Matrix4, u = n._hasLowPriorityOverride(), d = 0, p = -1, f = -1, m = 0, g = c.length; m < g; ++m)
    for (var v = c[m], y = 0, E = v.length; y < E && !(++d > t); ++y) {
      var x = v[y],
        b = x.nodeId,
        w = x.name,
        C = x.userData,
        T = x.meshId;
      h = x.matrix;
      var _ = a[T],
        L = x.materialId,
        M = null;
      (u || 0 === m) && (M = n._getOverrideMaterial(x)),
      M = M || s[L];
      var S = {
          databagId: o,
          nodeId: b,
          userId: w,
          userData: C,
          geometry: _,
          matrix: h,
          material: M,
          renderOrder: CLOUD.GlobalData.MaximumDepth - x.cellDepth
        },
        O = e.get(S);
      O >= 0 && f !== x.octantId && (O > 0 && i.addObjectRangeToOctantMap(f, p, O - 1), p = O, f = x.octantId),
      S = null
    }
  p !== -1 && i.addObjectRangeToOctantMap(f, p, e.counter - 1),
  c = null
},
CLOUD.Model.prototype.load = function(t) {
  this.loader.load(t)
},
CLOUD.Model.prototype.setCrossOrigin = function(t) {
  this.loader.setCrossOrigin(t)
},
CLOUD.Model.prototype.setupWireframe = function() {
  if (CLOUD.GlobalData.WireFrame && null == this.wireFrame) {
    var t = new THREE.BufferGeometry;
    t.addAttribute("position", new THREE.Float32BufferAttribute(this.cache.vertices, 3)),
    t.setIndex(this.cache.indices);
    var e = new THREE.LineBasicMaterial({color: 0, linewidth: 2}),
      i = new THREE.LineSegments(t, e);
    i.name = "Wireframes",
    i.customTag = !0,
    i.frustumCulled = !1,
    this.manager.scene.add(i),
    i.matrixWorld = this.manager.scene.rootNode.matrixWorld.clone(),
    this.wireFrame = i,
    this.manager.scene.add(this.wireFrame)
  } else
    CLOUD.GlobalData.WireFrame || null == this.wireFrame || (this.manager.scene.remove(this.wireFrame), this.wireFrame = null)
},
CLOUD.Model.prototype.prepare = function(t) {
  var e = this.loader.getSceneReaderArray();
  if ((
    e
    ? e.length
    : 0) < 1)
    return void CLOUD.Logger.log("model load not started!");
  if (!this.loaded)
    return void console.log("model is not loaded!");
  var i = e[0];
  if (!i)
    return void CLOUD.Logger.log("Empty scene");
  CLOUD.Logger.time("prepareScene"),
  this._clearNodePriority(!1),
  0 === this.nodePriority.low.length && (this.nodePriority.low.length = this.renderableCount);
  var n = 0,
    o = 0,
    r = 0;
  if (CLOUD.GlobalData.EnableOctant) {
    var a = this.containsCamera;
    if (a) {
      this.visibleOctant.length = 0;
      var s = this.loader.getOctreeRootNodeInner();
      void 0 !== s && this._frustumCull(t, s, a);
      var l = this.loader.getOctreeRootNodeOuter();
      void 0 !== l && this._frustumCull(t, l, !a),
      (r = this.visibleOctant.length) > 0 && (this._sortVisibleOctant(t), o = this._logicCull(i, a, o, r))
    } else {
      var l = this.loader.getOctreeRootNodeOuter();
      if (void 0 !== l && (this.visibleOctant.length = 0, this._frustumCull(t, l, !a), (r = this.visibleOctant.length) > 0 && (this._sortVisibleOctant(t), o = this._logicCull(i, !a, o, r))), n = o + this.nodePriority.high.length + this.nodePriority.medium.length, CLOUD.Logger.log("mesh count outdoor:", n), n < this.renderableCount) {
        var s = this.loader.getOctreeRootNodeInner();
        void 0 !== s && (this.visibleOctant.length = 0, this._frustumCull(t, s, a, o), (r = this.visibleOctant.length) > 0 && (this._sortVisibleOctant(t), o = this._logicCull(i, a, o, r)))
      }
    }
  } else {
    if (0 === (r = i.header.cellCount))
      return;
    o = this._logicCull(i, !0, o, r)
  }
  n = o + this.nodePriority.high.length + this.nodePriority.medium.length,
  this._updateTextureMapping(),
  CLOUD.Logger.time("updateMeshNodes"),
  n > this.renderableCount && (n = this.renderableCount),
  this._updateMeshNodes(n),
  CLOUD.Logger.timeEnd("updateMeshNodes"),
  this.setupWireframe(),
  this._occlusionTest(),
  CLOUD.Logger.log("mesh count:", this.pool.counter, n),
  CLOUD.Logger.timeEnd("prepareScene")
},
CLOUD.Model.prototype._frustumCull = function(t, e, i) {
  function n(t, e, i) {
    var o,
      l;
    if (e && t.depth < i && (s.set(t.min, t.max), o = e.intersectsBox(s)), o === !0) {
      var c = s.applyMatrix4(a),
        h = c.getSize().length(),
        u = c.getCenter().z;
      u = u > 1e-6
        ? u
        : 1e-6,
      t.priority = h / u,
      r.visibleOctant.push(t);
      for (var d = 0, p = t.childOctants.length; d < p; ++d)
        l = t.childOctants[d],
        n(l, e, i)
    }
  }
  function o(t, e, i) {
    var n,
      a;
    if (e && t.depth < i && (s.set(t.min, t.max), n = e.intersectsBox(s)), n === !0) {
      r.occlusionVisibleOctant.push(t);
      for (var l = 0, c = t.childOctants.length; l < c; ++l)
        a = t.childOctants[l],
        o(a, e, i)
    }
  }
  if (!e)
    return CLOUD.Logger.log("octree load is not finish!"),
    !1;
  var r = this;
  this.manager.updateOctreeBox(e);
  var a = t.projScreenMatrix,
    s = new THREE.Box3,
    l = t.getFrustum(!1),
    c = CLOUD.GlobalData.OctantDepth,
    h = null,
    u = CLOUD.GlobalData.OcclusionTranslucentEnabled;
  return u && (h = this.manager.getFrustumFromOcclusionCamera()),
  this.occlusionVisibleOctant.length = 0,
  null !== e && (n(e, l, c), u && o(e, h, c)),
  !0
},
CLOUD.Model.prototype._logicCull = function(t, e, i, n) {
  var o = this.manager,
    r = o.filter,
    a = r._hasHiddenFileIdFilter(),
    s = r._hasVisibleFilter(),
    l = r._hasOverrideMaterialFilter(),
    c = this.cache.cells,
    h = this.nodePriority.high,
    u = this.nodePriority.medium,
    d = this.nodePriority.low,
    p = this.nodePriority.low.length;
  CLOUD.Logger.time("collectNodeInfo");
  var f = o.getCategoriesFromHighPriority("outer");
  e === !0 && (f = o.getCategoriesFromHighPriority("inner"));
  for (var m, g = CLOUD.GlobalData.EnableOctant, v = 0, y = 0; y < n; ++y) {
    var E,
      x = 0;
    g
      ? (E = this.visibleOctant[y].octantId, x = this.visibleOctant[y].depth)
      : E = y;
    var b = c[E];
    if (void 0 === b) {
      b = c[E] = [];
      var w = t.getCellInfo(E);
      for (m = w.itemIndex; m < w.itemCount; ++m)
        this._readItemData(t, m, E, void 0, x);
      for (m = 0, v = b.length; m < v; ++m)
        b[m].octantId = E
    }
    for (m = 0, v = b.length; m < v; ++m)
      !function(t, e) {
        var n = t.userData,
          o = n
            ? n.categoryId
            : void 0,
          c = !1;
        if (!(a && r._isHiddenFileId(t) || s && r._isVisible(t) === !1)) {
          var f = l && r._hasHighPriorityOverrideMaterial(t);
          e && o && e[o] && (c = !0),
          f
            ? h.push(t)
            : c
              ? u.push(t)
              : i < p && (d[i] = t, i++)
        }
      }
    (b[m], f)
  }
  return CLOUD.Logger.timeEnd("collectNodeInfo"),
  i
},
CLOUD.Model.prototype.clearCells = function() {
  this.cache.cells = {}
},
CLOUD.Model.prototype.dispatchEvent = function(t) {
  this.manager.dispatchEvent(t)
},
CLOUD.Model.prototype.parseRootNode = function(t) {
  var e = t.view;
  void 0 !== t.count && (
    void 0 !== t.count.mesh_face && (this.numOfTriangles += t.count.mesh_face), this.renderableTotal = 0, void 0 !== t.count.geom_box && void 0 !== t.count.geom_pipe && void 0 !== t.count.geom_tube && void 0 !== t.count.mesh
    ? (this.renderableTotal += t.count.geom_box, this.renderableTotal += t.count.geom_pipe, this.renderableTotal += t.count.geom_tube, this.renderableTotal += t.count.mesh, this.numOfTriangles += 12 * t.count.geom_box, this.numOfTriangles += 32 * t.count.geom_pipe, this.numOfTriangles += 32 * t.count.geom_tube)
    : void 0 !== t.count.geom && void 0 !== t.count.mesh && (this.renderableTotal += t.count.geom, this.renderableTotal += t.count.mesh, this.numOfTriangles += 12 * t.count.geom, this.numOfElements = this.renderableTotal),
  void 0 !== t.count.item && (this.numOfElements = t.count.item)),
  this.boundingBoxWorld = CLOUD.Utils.box3FromArray(e.bbox),
  this.manager.parseSceneRootNode(t)
},
CLOUD.Model.prototype.getTextures = function() {
  return this.cache.textures
},
CLOUD.Model.prototype.getMaterials = function() {
  return this.cache.materials
},
CLOUD.Model.prototype.updateMaterials = function() {
  var t = this.cache.materials;
  for (var e in t)
    if (t.hasOwnProperty(e)) {
      var i = t[e];
      i.iblProbe = this.manager.scene.iblProbe,
      i.refreshUniforms()
    }
  },
CLOUD.Model.prototype.updateMaterialsValue = function(t, e) {
  var i = this.cache.materials;
  for (var n in i)
    if (i.hasOwnProperty(n)) {
      var o = i[n];
      o.hasOwnProperty(t) && (o[t] = e, o.refreshUniforms(), o.needsUpdate = !0)
    }
  },
CLOUD.Model.prototype.changeAllMaterials = function(t) {
  var e = this.cache.materials;
  for (var i in e)
    if (e.hasOwnProperty(i)) {
      var n,
        o = e[i],
        r = CLOUD.MaterialUtil.getMaterialParameters(o);
      t
        ? (n = new ImageBasedLighting.IBLMaterial(r), n.type = "IBL")
        : (delete r.iblProbe, n = CLOUD.MaterialUtil.createPhongMaterial(r)),
      n.name = i,
      e[i] = n,
      r = null
    }
  },
CLOUD.Model.prototype.getReferencedMeshCache = function() {
  return this.referencedMeshCache
},
CLOUD.Model.prototype.isLoaded = function() {
  return this.loaded
},
CLOUD.Model.prototype.isVisible = function() {
  return this.visible
},
CLOUD.Model.prototype.setVisible = function(t) {
  this.visible = t
},
CLOUD.Model.prototype.calculateCameraModelRelation = function(t) {
  var e = this.loader.getOctreeRootNodeInner();
  e && (
    t.x < e.min.x || t.x > e.max.x || t.y < e.min.y || t.y > e.max.y || t.z < e.min.z || t.z > e.max.z
    ? this.containsCamera = !1
    : this.containsCamera = !0)
},
CLOUD.Model.prototype.getBoundingBoxWorld = function() {
  return this.boundingBoxWorld
},
CLOUD.Model.prototype.getRenderableTotal = function() {
  return this.renderableTotal
},
CLOUD.Model.prototype.setRenderableCount = function(t) {
  this.renderableCount = t
},
CLOUD.ModelManager = function(t) {
  CLOUD.GlobalData.IsMobile && (CLOUD.GlobalData.maxObjectNumInPool = 6e3, CLOUD.GlobalData.maxDrawCacheNum = 4e3),
  this.scene = new CLOUD.Scene,
  this.crossOrigin = !0,
  this.models = {},
  this.filter = t,
  this.materialPool = new CLOUD.ExpandableObjectPool,
  this.materialPool.init(CLOUD.MaterialEx, 50),
  this.occlusionCamera = null,
  this.containsCamera = !1,
  this.highPriorityCategories = {
    inner: {},
    outer: {}
  },
  this.octantToObjectMap = {},
  this.sceneState = new CLOUD.SceneStateHelper(this, t)
},
CLOUD.ModelManager.prototype.destroy = function() {
  for (var t in this.models)
    this.models[t].destroy();
  this.models = null,
  this.octantToObjectMap = null,
  this.scene.destroy(),
  this.scene = null,
  this.materialPool.destroy(),
  this.materialPool = null,
  this.occlusionCamera && (this.occlusionCamera = null)
},
CLOUD.ModelManager.prototype._updateOcclusionCamera = function(t) {
  var e = t.near,
    i = t.distanceFromWorldToDrawing(this.getMatrixWorldGlobal(), CLOUD.GlobalData.OcclusionDistanceToCamera);
  this.occlusionCamera
    ? this.occlusionCamera.copy(t)
    : this.occlusionCamera = t.clone(),
  this.occlusionCamera.setNearFar(e, i),
  this.occlusionCamera.updateMVP()
},
CLOUD.ModelManager.prototype._clearMaterialPool = function() {
  this.materialPool.clear()
},
CLOUD.ModelManager.prototype.acquireMaterial = function() {
  return this.materialPool.acquire()
},
CLOUD.ModelManager.prototype.getObjectPool = function() {
  return this.scene.getObjectPool()
},
CLOUD.ModelManager.prototype.getFrustumFromOcclusionCamera = function() {
  return this.occlusionCamera.getFrustum(!1)
},
CLOUD.ModelManager.prototype.getOcclusionCamera = function() {
  return this.occlusionCamera
},
CLOUD.ModelManager.prototype.addObjectRangeToOctantMap = function(t, e, i) {
  var n = this.octantToObjectMap;
  void 0 === n[t] && (n[t] = []),
  n[t].push(e),
  n[t].push(i)
},
CLOUD.ModelManager.prototype.getOctreeRoots = function() {
  var t = [],
    e = this.models;
  for (var i in e)
    if (e.hasOwnProperty(i)) {
      var n = e[i];
      n.isLoaded() && n.getOctreeRoots(t)
    }
  return t
},
CLOUD.ModelManager.prototype.prepareScene = function(t) {
  var e = this.models;
  this.clearPool(),
  this.octantToObjectMap = {},
  CLOUD.GlobalData.OcclusionTranslucentEnabled && (this._clearMaterialPool(), this._updateOcclusionCamera(t));
  for (var i in e)
    if (e.hasOwnProperty(i)) {
      var n = e[i];
      n.isLoaded() && n.isVisible() && n.prepare(t)
    }
  },
CLOUD.ModelManager.prototype.clearPool = function() {
  this.scene.getObjectPool().clear()
},
CLOUD.ModelManager.prototype.load = function(t) {
  var e = this.models[t.databagId];
  return void 0 !== e
    ? (e.isVisible() || (e.setVisible(!0), e.dispatchEvent({type: CLOUD.EVENTS.ON_LOAD_COMPLETE})), e)
    : (e = new CLOUD.Model(this, t), this.models[t.databagId] = e, e.load(t.notifyProgress), e)
},
CLOUD.ModelManager.prototype.unload = function(t) {
  var e = this.models[t];
  return !!e && (e.destroy(), delete this.models[t], this.updateSceneBoundingBox(), this.updateModelRenderable(), !0)
},
CLOUD.ModelManager.prototype.unloadAll = function() {
  for (var t = this.getDataBagIds(), e = 0, i = t.length; e < i; ++e)
    this.unload(t[e]);
  this.clearPool(),
  this.models = {}
},
CLOUD.ModelManager.prototype.showModel = function(t) {
  var e = this.models[t];
  return !!e && (e.setVisible(!0), !0)
},
CLOUD.ModelManager.prototype.hideModel = function(t) {
  var e = this.models[t];
  return !!e && (e.setVisible(!1), !0)
},
CLOUD.ModelManager.prototype.getDataBagIds = function() {
  var t = this.models,
    e = [];
  for (var i in t)
    t.hasOwnProperty(i) && e.push(i);
  return e
},
CLOUD.ModelManager.prototype.updateSceneBoundingBox = function() {
  var t = this.models,
    e = new THREE.Box3;
  for (var i in t)
    if (t.hasOwnProperty(i)) {
      var n = t[i],
        o = n.getBoundingBoxWorld();
      e.isEmpty()
        ? e.copy(o)
        : (e.expandByPoint(o.min), e.expandByPoint(o.max))
    }
  this.scene.setBoundingBoxWorld(e)
},
CLOUD.ModelManager.prototype.parseSceneRootNode = function(t) {
  this.scene.parseRootNode(t),
  this.updateModelRenderable()
},
CLOUD.ModelManager.prototype.updateModelRenderable = function() {
  var t = this.models,
    e = CLOUD.GlobalData.maxObjectNumInPool,
    i = [],
    n = 0;
  for (var o in t)
    if (t.hasOwnProperty(o)) {
      var r = t[o];
      n += r.getRenderableTotal(),
      i.push(o)
    }
  for (var a = 0, s = 0, l = i.length; s < l; ++s) {
    var o = i[s],
      r = t[o],
      c = Math.floor(r.getRenderableTotal() / n * e);
    c > r.getRenderableTotal() && (c = r.getRenderableTotal()),
    r.setRenderableCount(c),
    a += c
  }
  this.scene.resizePool(
    a > e
    ? e
    : a)
},
CLOUD.ModelManager.prototype.updateMaterials = function() {
  var t = this.models;
  for (var e in this.models)
    if (t.hasOwnProperty(e)) {
      var i = t[e];
      i.isLoaded() && i.updateMaterials()
    }
  },
CLOUD.ModelManager.prototype.updateMaterialsValue = function(t, e) {
  var i = this.models;
  for (var n in this.models)
    if (i.hasOwnProperty(n)) {
      var o = i[n];
      o.isLoaded() && o.updateMaterialsValue(t, e)
    }
  },
CLOUD.ModelManager.prototype.changeAllMaterials = function(t) {
  var e = this.models;
  for (var i in this.models)
    if (e.hasOwnProperty(i)) {
      var n = e[i];
      n.changeAllMaterials(t)
    }
  },
CLOUD.ModelManager.prototype.clearScene = function() {
  var t = this.models;
  for (var e in t)
    if (t.hasOwnProperty(e)) {
      var i = t[e];
      i.clearCells()
    }
  },
CLOUD.ModelManager.prototype.setCrossOrigin = function(t) {
  this.crossOrigin = t
};
CLOUD.ModelManager.prototype.getMatrixWorldGlobal = function() {
  return this.scene.getMatrixWorldGlobal()
},
CLOUD.ModelManager.prototype.getWorldFrustum = function(t, e) {
  var i = new THREE.Matrix4,
    n = new THREE.Frustum;
  if (e)
    i.getInverse(t.matrixWorld),
    n.setFromMatrix((new THREE.Matrix4).multiplyMatrices(t.projectionMatrix, i));
  else {
    var o = t.clone(),
      r = t.target,
      a = r.clone().sub(t.position).length(),
      s = this.getMatrixWorldGlobal(),
      l = new THREE.Matrix4;
    l.getInverse(s);
    var c = new THREE.Matrix4;
    c.extractRotation(s);
    var h = new THREE.Quaternion;
    h.setFromRotationMatrix(c),
    h.inverse(),
    o.position.applyMatrix4(l);
    var u = r.clone();
    u.applyMatrix4(l);
    var d = u.clone().sub(o.position),
      p = d.length();
    d.normalize();
    var f = p / a;
    o.far = t.far * f,
    o.up.applyQuaternion(h).normalize(),
    o.realUp.applyQuaternion(h).normalize(),
    o.updateProjectionMatrix(),
    o.updateMatrixWorld(),
    i.getInverse(o.matrixWorld),
    n.setFromMatrix((new THREE.Matrix4).multiplyMatrices(o.projectionMatrix, i)),
    o = null
  }
  return n
},
CLOUD.ModelManager.prototype.hasModel = function() {
  var t = this.models;
  for (var e in t)
    if (t.hasOwnProperty(e)) {
      var i = t[e];
      if (i.isLoaded())
        return !0
    }
  return !1
},
CLOUD.ModelManager.prototype.getModel = function(t) {
  var e = this.models[t];
  return e && e.isLoaded()
    ? e
    : null
},
CLOUD.ModelManager.prototype.updateOctreeBox = function(t) {
  this.scene.updateOctreeBox(t)
},
CLOUD.ModelManager.prototype.setCategoriesToHighPriority = function(t, e) {
  var i = t.length;
  if (!(i < 1))
    for (var n = this.highPriorityCategories[e] = {}, o = 0; o < i; ++o)
      n[t[o]] = !0
},
CLOUD.ModelManager.prototype.getCategoriesFromHighPriority = function(t) {
  return this.highPriorityCategories[t]
},
CLOUD.ModelManager.prototype.clearCategoriesFromHighPriority = function(t) {
  this.highPriorityCategories[t] = {}
},
CLOUD.ModelManager.prototype.clearAllCategoriesFromHighPriority = function() {
  this.clearCategoriesFromHighPriority("inner"),
  this.clearCategoriesFromHighPriority("outer")
},
CLOUD.ModelManager.prototype.calculateCameraModelRelation = function(t) {
  var e = !1,
    i = this.models;
  for (var n in i)
    if (i.hasOwnProperty(n)) {
      var o = i[n];
      o.calculateCameraModelRelation(t),
      e = e || o.containsCamera
    }
  this.containsCamera = e
},
CLOUD.ModelManager.prototype.getNumOfElements = function() {
  var t = this.models,
    e = 0;
  for (var i in this.models)
    if (t.hasOwnProperty(i)) {
      var n = t[i];
      e += n.numOfElements
    }
  return e
},
CLOUD.ModelManager.prototype.getNumOfRenderables = function() {
  var t = this.models,
    e = 0;
  for (var i in this.models)
    if (t.hasOwnProperty(i)) {
      var n = t[i];
      e += n.renderableTotal
    }
  return e
},
CLOUD.ModelManager.prototype.getNumOfTriangles = function() {
  var t = this.models,
    e = 0;
  for (var i in this.models)
    if (t.hasOwnProperty(i)) {
      var n = t[i];
      e += n.numOfTriangles
    }
  return e
},
Object.assign(CLOUD.ModelManager.prototype, THREE.EventDispatcher.prototype);
var MPK = MPK || {};
MPK.MPKHeader = function(t) {
  var e = new Uint32Array(t, 0, 6);
  this.blockId = e[0],
  this.vtFormat = e[1],
  this.meshCount = e[2],
  this.meshOffset = e[3],
  this.bufferSize = e[4],
  this.bufferOffset = e[5],
  e = null
},
MPK.MeshData = function(t, e) {
  var i = new Uint32Array(t, e, 5);
  this.mesh_id = i[0],
  this.ptCount = i[1],
  this.idxCount = i[2],
  this.dataOffset = i[3],
  this.vertexFormat = i[4];
  var n = new Float32Array(t, e + 20, 4);
  this.baseScale = n[0],
  this.baseX = n[1],
  this.baseY = n[2],
  this.baseZ = n[3],
  i = null,
  n = null
},
MPK.MPKReader = function(t) {
  this.header = new MPK.MPKHeader(t),
  this.meshSize = 36,
  this.maxSize = 256,
  this.meshBuffer = t.slice(this.header.meshOffset, this.header.meshOffset + this.header.meshCount * this.meshSize),
  this.geomBuffer = t.slice(this.header.bufferOffset, this.header.bufferOffset + this.header.bufferSize),
  this.mesh_cur_id = -1;
  var e = new ArrayBuffer(this.maxSize);
  this.mesh_cur = new MPK.MeshData(e, 0)
},
MPK.MPKReader.prototype = {
  constructor: MPK.MPKReader,
  getMeshData: function(t) {
    if (t >= 0 && t < this.header.meshCount)
      return new MPK.MeshData(this.meshBuffer, t * this.meshSize)
  },
  getMeshInfo: function(t) {
    if (t == this.mesh_cur_id)
      return this.mesh_cur;
    if (t >= 0 && t < this.header.meshCount) {
      var e = new Uint32Array(this.meshBuffer, t * this.meshSize, 5);
      this.mesh_cur.mesh_id = e[0],
      this.mesh_cur.ptCount = e[1],
      this.mesh_cur.idxCount = e[2],
      this.mesh_cur.dataOffset = e[3],
      this.mesh_cur.vertexFormat = e[4];
      var i = new Float32Array(this.meshBuffer, t * this.meshSize + 20, 4);
      return this.mesh_cur.baseScale = i[0],
      this.mesh_cur.baseX = i[1],
      this.mesh_cur.baseY = i[2],
      this.mesh_cur.baseZ = i[3],
      this.mesh_cur_id = t,
      this.mesh_cur
    }
  },
  getPtBuffer: function(t) {
    if (t >= 0 && t < this.header.meshCount) {
      var e = this.getMeshInfo(t);
      if (void 0 === e)
        return;
      return 0 == e.baseScale
        ? new Float32Array(this.geomBuffer, e.dataOffset, 3 * e.ptCount)
        : new Uint16Array(this.geomBuffer, e.dataOffset, 3 * e.ptCount)
    }
  },
  getIdxBuffer: function(t) {
    if (t >= 0 && t < this.header.meshCount) {
      var e = this.getMeshInfo(t);
      if (void 0 === e)
        return;
      var i = e.dataOffset;
      return 0 == e.baseScale
        ? i += 3 * e.ptCount * 4
        : (i += 3 * e.ptCount * 2, e.ptCount % 2 == 1 && (i += 2)),
      e.ptCount > 65535
        ? new Uint32Array(this.geomBuffer, i, e.idxCount)
        : new Uint16Array(this.geomBuffer, i, e.idxCount)
    }
  },
  getNormalBuffer: function(t) {
    if (2 == (2 & this.header.vtFormat) && t >= 0 && t < this.header.meshCount) {
      var e = this.getMeshInfo(t);
      if (void 0 === e)
        return;
      var i = e.dataOffset;
      return 0 == e.baseScale
        ? i += 3 * e.ptCount * 4
        : (i += 3 * e.ptCount * 2, e.ptCount % 2 == 1 && (i += 2)),
      e.ptCount > 65535
        ? i += 4 * e.idxCount
        : (i += 2 * e.idxCount, e.idxCount % 2 == 1 && (i += 2)),
      new Float32Array(this.geomBuffer, i, 3 * e.ptCount)
    }
  },
  getUVBuffer: function(t) {
    if (t >= 0 && t < this.header.meshCount) {
      var e = this.getMeshInfo(t);
      if (void 0 === e || 4 != (4 & e.vertexFormat))
        return;
      var i = e.dataOffset;
      return 0 == e.baseScale
        ? i += 3 * e.ptCount * 4
        : (i += 3 * e.ptCount * 2, e.ptCount % 2 == 1 && (i += 2)),
      e.ptCount > 65535
        ? i += 4 * e.idxCount
        : (i += 2 * e.idxCount, e.idxCount % 2 == 1 && (i += 2)),
      2 == (2 & this.header.vtFormat) && (i += 3 * e.ptCount * 4),
      new Float32Array(this.geomBuffer, i, 2 * e.ptCount)
    }
  }
},
CLOUD.ClipPlanes = function(t, e) {
  THREE.Object3D.call(this);
  var i = [];
  i.push("clipPlane_right"),
  i.push("clipPlane_left"),
  i.push("clipPlane_top"),
  i.push("clipPlane_bottom"),
  i.push("clipPlane_front"),
  i.push("clipPlane_back"),
  this.cubeSize = t.clone(),
  this.center = e.clone(),
  this.visible = !1,
  this.rotatable = !1,
  this.selectIndex = null,
  this.planeOffset = new Array(6),
  this.uniforms = {
    iClipPlane: {
      type: "i",
      value: 0
    },
    vClipPlane: {
      type: "v4v",
      value: new Array(new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4)
    }
  },
  this.clipplanes = null,
  this.calculation = !0,
  this.getPlaneNormal = function(t) {
    var e = new THREE.Vector4,
      i = Math.floor(t / 2),
      n = t % 2;
    return e.setComponent(i, Math.pow(-1, n)),
    e.w = .5 * -this.cubeSize.getComponent(i),
    this.planeOffset[t] = 0,
    e
  },
  this.planeMaterial = new CLOUD.PhongLightingMaterial({
    color: 6724044,
    opacity: .3,
    transparent: !0,
    side: THREE.DoubleSide,
    lights: !0
  }),
  this.planeHighLightMatrial = new CLOUD.PhongLightingMaterial({
    color: 65408,
    opacity: .3,
    transparent: !0,
    side: THREE.DoubleSide,
    lights: !0
  }),
  this.initPlaneModel = function(t) {
    var e = Math.floor(t / 2),
      n = t % 2,
      o = 0 == e
        ? this.cubeSize.z
        : this.cubeSize.x,
      r = 1 == e
        ? this.cubeSize.z
        : this.cubeSize.y,
      a = new THREE.PlaneGeometry(o, r),
      s = new THREE.Mesh(a, this.planeMaterial.clone());
    s.name = i[t],
    s.customTag = !0,
    s.position.setComponent(e, Math.pow(-1, n) * this.cubeSize.getComponent(e) * .5),
    0 == e
      ? s.rotation.y = Math.pow(-1, n) * Math.PI * .5
      : 1 == e && (s.rotation.x = Math.pow(-1, n) * Math.PI * .5),
    this.add(s)
  },
  this.initWireframes = function() {
    var t = [
        .5 * -this.cubeSize.x,
        .5 * -this.cubeSize.y,
        .5 * -this.cubeSize.z,
        .5 * this.cubeSize.x,
        .5 * -this.cubeSize.y,
        .5 * -this.cubeSize.z,
        .5 * this.cubeSize.x,
        .5 * this.cubeSize.y,
        .5 * -this.cubeSize.z,
        .5 * -this.cubeSize.x,
        .5 * this.cubeSize.y,
        .5 * -this.cubeSize.z,
        .5 * -this.cubeSize.x,
        .5 * -this.cubeSize.y,
        .5 * this.cubeSize.z,
        .5 * this.cubeSize.x,
        .5 * -this.cubeSize.y,
        .5 * this.cubeSize.z,
        .5 * this.cubeSize.x,
        .5 * this.cubeSize.y,
        .5 * this.cubeSize.z,
        .5 * -this.cubeSize.x,
        .5 * this.cubeSize.y,
        .5 * this.cubeSize.z
      ],
      e = [
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1,
        1
      ],
      i = [
        0,
        1,
        1,
        2,
        2,
        3,
        3,
        0,
        4,
        5,
        5,
        6,
        6,
        7,
        7,
        4,
        0,
        4,
        3,
        7,
        1,
        5,
        2,
        6
      ],
      n = new THREE.BufferGeometry,
      o = new CLOUD.PhongLightingMaterial({
        color: 16777215,
        lights: !0
      });
    n.setIndex(i),
    n.addAttribute("position", new THREE.Float32BufferAttribute(t, 3)),
    n.addAttribute("color", new THREE.Float32BufferAttribute(e, 3)),
    n.computeBoundingSphere();
    var r = new THREE.LineSegments(n, o);
    r.name = "Wireframes",
    r.customTag = !0,
    this.add(r)
  },
  this.updateClippingParams = function(t) {},
  this.enable = function(t, e) {
    this.visible = e,
    this.uniforms.iClipPlane.value = t
      ? 6
      : 0,
    this.updateClippingParams(this.uniforms)
  },
  this.isEnabled = function() {
    return 0 != this.uniforms.iClipPlane.value
  };
  var n = function(t, e, i, n, o, r, a, s, l, c) {
    this.enable = t,
    this.visible = e,
    this.rotatable = i,
    this.calculation = n,
    this.planeOffset = o.slice(0),
    this.position = r,
    this.scale = a,
    this.quaternion = s,
    this.cubeSize = l,
    this.center = c
  };
  this.store = function() {
    return new n(!!this.uniforms.iClipPlane.value, this.visible, this.rotatable, this.calculation, this.planeOffset, this.position.clone(), this.scale.clone(), this.quaternion.clone(), this.cubeSize.clone(), this.center.clone())
  },
  this.restore = function(t) {
    this.calculation = !0,
    this.calculationPlanes(t.cubeSize, t.center),
    this.enable(t.enable, t.visible),
    this.rotatable = t.rotatable,
    this.calculation = t.calculation;
    for (var e = 0; e < 6; ++e)
      this.planeOffset[e] = t.planeOffset[e];
    this.position.copy(t.position),
    this.scale.copy(t.scale),
    this.quaternion._w = t.quaternion._w,
    this.quaternion._x = t.quaternion._x,
    this.quaternion._y = t.quaternion._y,
    this.quaternion._z = t.quaternion._z,
    this.update()
  },
  this.reset = function() {
    this.calculation = !0;
    for (var t = 0; t < 6; ++t)
      this.planeOffset[t] = 0;
    this.position.copy(this.center),
    this.scale.copy(new THREE.Vector3(1, 1, 1)),
    this.quaternion.copy(new THREE.Quaternion),
    this.update()
  },
  this.calculationPlanes = function(t, e) {
    if (this.calculation) {
      this.cubeSize.copy(t),
      this.center.copy(e);
      for (var i = this.children.length, n = i - 1; n >= 0; --n)
        this.remove(this.children[n]);
      for (var n = 0; n < 6; ++n)
        this.uniforms.vClipPlane.value[n] = this.getPlaneNormal(n),
        this.initPlaneModel(n);
      this.initWireframes(),
      this.clipplanes = this.uniforms.vClipPlane.value.slice(0),
      this.reset()
    }
  },
  this.update = function() {
    this.updateMatrixWorld();
    var t = new THREE.Matrix4;
    t.getInverse(this.matrix),
    t.transpose();
    for (var e = 0; e < 6; ++e)
      this.uniforms.vClipPlane.value[e] = this.clipplanes[e].clone().applyMatrix4(t);
    this.updateClippingParams(this.uniforms)
  },
  this.offset = function(t, e) {
    this.calculation = !1;
    var i = Math.floor(t / 2),
      n = t % 2;
    this.planeOffset[t] += e;
    var o = .5 * this.cubeSize.getComponent(i);
    0 == n && this.planeOffset[t] > o
      ? (this.planeOffset[t] -= e, e = o - this.planeOffset[t], this.planeOffset[t] = o)
      : 1 == n && this.planeOffset[t] < -o && (this.planeOffset[t] -= e, e = -o - this.planeOffset[t], this.planeOffset[t] = -o);
    for (var r = new THREE.Vector3, a = 0; a < 6; ++a) {
      var s = this.clipplanes[a].clone(),
        l = this.planeOffset[a],
        c = new THREE.Vector3(s.x * l, s.y * l, s.z * l);
      r.add(c)
    }
    var h = 1 + r.getComponent(i) / this.cubeSize.getComponent(i);
    if (h > 0 && h < 2) {
      this.scale.setComponent(i, h);
      var u = this.uniforms.vClipPlane.value[t].clone(),
        d = new THREE.Vector3(u.x, u.y, u.z);
      d.normalize();
      var c = e,
        p = new THREE.Vector3(d.x * c, d.y * c, d.z * c);
      t % 2 == 1
        ? this.position.sub(p.multiplyScalar(.5))
        : this.position.add(p.multiplyScalar(.5)),
      this.update()
    } else
      this.planeOffset[t] -= e
  };
  var o = new THREE.Quaternion,
    r = new THREE.Vector3(1, 0, 0);
  this.rotX = function(t) {
    this.calculation = !1,
    o.setFromAxisAngle(r, t),
    this.quaternion.multiply(o),
    this.update()
  };
  var a = new THREE.Vector3(0, 1, 0);
  this.rotY = function(t) {
    this.calculation = !1,
    o.setFromAxisAngle(a, t),
    this.quaternion.multiply(o),
    this.update()
  },
  this.highLight = function() {
    null != this.selectIndex && (this.children[this.selectIndex].material = this.planeHighLightMatrial.clone())
  },
  this.cancelHighLight = function() {
    null != this.selectIndex && (this.children[this.selectIndex].material = this.planeMaterial.clone(), this.selectIndex = null)
  }
},
CLOUD.ClipPlanes.prototype = Object.create(THREE.Object3D.prototype),
CLOUD.ClipPlanes.prototype.constructor = CLOUD.ClipPlanes,
CLOUD.ClipPlanes.prototype.init = function() {
  this.calculationPlanes(this.cubeSize, this.center)
},
CLOUD.ClipPlanes.prototype.hitTest = function(t) {
  var e = null,
    i = null;
  if (this.raycast(t), null != this.selectIndex) {
    var n = t.ray,
      o = new THREE.Plane,
      r = this.uniforms.vClipPlane.value[this.selectIndex];
    o.setComponents(r.x, r.y, r.z, r.w),
    e = n.distanceToPlane(o),
    i = n.direction.dot(o.normal) < 0
  }
  return {sign: i, distance: e}
},
CLOUD.ClipPlanes.prototype.raycast = function() {
  return function(t, e) {
    for (var i, n = [], o = 0; o < 6; o++)
      if (CLOUD.CameraUtil.intersectObject(this.children[o], t, n, !0), n.length > 0)
        if (i) {
          var r = n.pop();
          r.distance < i.distance && (i = r, this.selectIndex = o)
        }
      else
      i = n.pop(),
      this.selectIndex = o;
    return i || (this.selectIndex = null),
    !1
  }
}(),
CLOUD.FillClipPlane = function(t, e) {
  THREE.Object3D.call(this),
  this.cubeSize = t.clone(),
  this.center = e.clone(),
  this.planeOffset = 0,
  this.visible = !1,
  this.rotatable = !1,
  this.hit = !1,
  this.clipplane = new THREE.Vector4,
  this.uniforms = {
    iClipPlane: {
      value: 0
    },
    vClipPlane: {
      value: new Array(new THREE.Vector4)
    }
  },
  this.planeMaterial = new CLOUD.PhongLightingMaterial({
    color: 6724044,
    opacity: .3,
    transparent: !0,
    side: THREE.DoubleSide,
    lights: !0
  }),
  this.planeHighLightMatrial = new CLOUD.PhongLightingMaterial({
    color: 65408,
    opacity: .3,
    transparent: !0,
    side: THREE.DoubleSide,
    lights: !0
  }),
  this.initPlaneModel = function() {
    var t = Math.max(this.cubeSize.x, this.cubeSize.y),
      e = new THREE.PlaneGeometry(t, t),
      i = new THREE.Mesh(e, this.planeMaterial.clone());
    i.name = "fillClipPlane",
    i.customTag = !0,
    this.position.copy(this.center),
    this.clipplane.set(0, 0, 1, 0),
    this.add(i)
  },
  this.updateClippingParams = function(t) {},
  this.enable = function(t, e) {
    this.visible = e,
    this.uniforms.iClipPlane.value = t
      ? 1
      : 0,
    this.updateClippingParams(this.uniforms)
  },
  this.isEnabled = function() {
    return 0 != this.uniforms.iClipPlane.value
  },
  this.update = function() {
    this.updateMatrixWorld();
    var t = new THREE.Matrix4;
    t.getInverse(this.matrix),
    t.transpose(),
    this.uniforms.vClipPlane.value[0] = this.clipplane.clone().applyMatrix4(t),
    this.updateClippingParams(this.uniforms)
  },
  this.offset = function(t) {
    var e = this.uniforms.vClipPlane.value[0].clone(),
      i = new THREE.Vector3(e.x, e.y, e.z);
    i.normalize();
    var n = new THREE.Vector3(i.x * t, i.y * t, i.z * t);
    this.position.add(n),
    this.update()
  },
  this.setOffset = function(t) {
    var e = this.uniforms.vClipPlane.value[0].clone(),
      i = new THREE.Vector3(e.x, e.y, e.z);
    i.normalize();
    var n = new THREE.Vector3(i.x * t, i.y * t, i.z * t);
    this.position.copy(this.center).add(n),
    this.update()
  },
  this.changeNormal = function(t) {
    var e = this.children[0];
    0 == t
      ? (this.clipplane.set(1, 0, 0, 0), e.rotation.set(0, Math.PI / 2, 0))
      : 1 == t
        ? (this.clipplane.set(-1, 0, 0, 0), e.rotation.set(0, -Math.PI / 2, 0))
        : 2 == t
          ? (this.clipplane.set(0, 0, -1, 0), e.rotation.set(Math.PI, 0, 0))
          : 3 == t
            ? (this.clipplane.set(0, 0, 1, 0), e.rotation.set(0, 0, 0))
            : 4 == t
              ? (this.clipplane.set(0, 1, 0, 0), e.rotation.set(-Math.PI / 2, 0, 0))
              : 5 == t && (this.clipplane.set(0, -1, 0, 0), e.rotation.set(Math.PI / 2, 0, 0)),
    e.updateMatrixWorld(),
    this.update()
  };
  var i = new THREE.Quaternion,
    n = new THREE.Vector3(1, 0, 0);
  this.rotX = function(t) {
    i.setFromAxisAngle(n, t),
    this.quaternion.multiply(i),
    this.update()
  };
  var o = new THREE.Vector3(0, 1, 0);
  this.rotY = function(t) {
    i.setFromAxisAngle(o, t),
    this.quaternion.multiply(i),
    this.update()
  },
  this.highLight = function() {
    this.children[0].material = this.planeHighLightMatrial.clone()
  },
  this.cancelHighLight = function() {
    this.children[0].material = this.planeMaterial.clone(),
    this.hit = !1
  }
},
CLOUD.FillClipPlane.prototype = Object.create(THREE.Object3D.prototype),
CLOUD.FillClipPlane.prototype.constructor = CLOUD.FillClipPlane,
CLOUD.FillClipPlane.prototype.init = function() {
  this.initPlaneModel()
},
CLOUD.FillClipPlane.prototype.hitTest = function(t) {
  var e = null,
    i = null;
  if (this.raycast(t), this.hit) {
    var n = t.ray,
      o = new THREE.Plane,
      r = this.uniforms.vClipPlane.value[0];
    o.setComponents(r.x, r.y, r.z, r.w),
    e = n.distanceToPlane(o),
    i = n.direction.dot(o.normal) < 0
  }
  return {sign: i, distance: e}
},
CLOUD.FillClipPlane.prototype.raycast = function() {
  return function(t, e) {
    this.hit = !1;
    var i = [];
    return CLOUD.CameraUtil.intersectObject(this.children[0], t, i, !0),
    i.length > 0 && (this.hit = !0),
    !1
  }
}(),
CLOUD.ClipPlaneService = function(t) {
  this.viewer = t,
  this.planes = [];
  for (var e = 0; e < 6; ++e)
    this.planes.push(new THREE.Plane)
},
CLOUD.ClipPlaneService.prototype = {
  construtor: CLOUD.ClipPlaneService,
  destroy: function() {
    this.viewer = null,
    this.planes = []
  },
  update: function(t) {
    var e = this.getEditor();
    e && (e.update(t), this.viewer.render())
  },
  getEditor: function() {
    return viewer.editorManager.editors[CLOUD.EditorMode.CLIP_BY_BOX]
  },
  toggle: function(t, e) {
    this.getEditor().toggle(t, e)
  },
  setVisible: function(t) {
    this.getEditor().visible(t)
  },
  setRotatable: function(t) {
    this.getEditor().rotatable(t)
  },
  enablePick: function(t) {
    this.getEditor().enablePick = t
  },
  saveState: function() {
    return this.getEditor().store()
  },
  loadState: function(t) {
    this.getEditor().restore(t)
  },
  reset: function() {
    this.getEditor().reset()
  }
};
var ImageBasedLighting = ImageBasedLighting || {};
ImageBasedLighting.brdf_vs = ["varying vec2 vUV;", "void main() {", "\tvUV = uv;", "\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);", "}"].join("\n"),
ImageBasedLighting.brdf_fs = [
  "varying vec2 vUV;",
  "uniform sampler2D HammersleyTable;",
  "const float PI = 3.14159265358979;",
  "float GGX(float NdotV, float alpha)",
  "{",
  "\tfloat alpha2 = pow(alpha, 2.0);",
  "\treturn 2.0 * NdotV / (NdotV + sqrt(alpha2 + (1.0 - alpha2) * NdotV * NdotV));",
  "}",
  "float G_Smith(float NdotV, float NdotL, float roughness)",
  "{",
  "\tfloat alpha = pow(roughness, 2.0);",
  "\treturn GGX(NdotV, alpha) * GGX(NdotL, alpha);",
  "}",
  "vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)",
  "{",
  "\tfloat a = roughness * roughness;",
  "\tfloat Phi = 2.0 * PI * Xi.x; ",
  "\tfloat CosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a * a - 1.0) * Xi.y)); ",
  "\tfloat SinTheta = sqrt(1.0 - CosTheta * CosTheta);",
  "\tvec3 H;",
  "\tH.x = SinTheta * cos(Phi); ",
  "\tH.y = SinTheta * sin(Phi); ",
  "\tH.z = CosTheta;",
  "\tvec3 UpVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0); ",
  "\tvec3 TangentX = normalize(cross(UpVector, N)); ",
  "\tvec3 TangentY = cross(N, TangentX);",
  "\treturn normalize(TangentX * H.x + TangentY * H.y + N * H.z);",
  "}",
  "vec2 IntegrateBRDF(float NdotV, float roughness)",
  "{",
  "\tvec3 N = vec3(0.0, 0.0, 1.0);",
  "\tvec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);",
  "\tvec2 result = vec2(0.0, 0.0);",
  "\tconst int NumSamples = 1024;",
  "\tfor (int i = 0; i < NumSamples; i++)",
  "\t{",
  "\t\tfloat u = float(i) / float(NumSamples);",
  "\t\tvec2 Xi = vec2(u, texture2D(HammersleyTable, vec2(u)).r);",
  "\t\tvec3 H = ImportanceSampleGGX(Xi, N, roughness);",
  "\t\tvec3 L = 2.0 * dot(V, H) * H - V;",
  "\t\tfloat NdotL = saturate(L.z);",
  "\t\tfloat NdotH = saturate(H.z);",
  "\t\tfloat VdotH = saturate(dot(V, H));",
  "\t\tfloat NdotV = saturate(dot(N, V));",
  "\t\tif (NdotL > 0.0)",
  "\t\t{",
  "\t\t\tfloat G = G_Smith(NdotV, NdotL, roughness);",
  "\t\t\tfloat G_Vis = G * VdotH / (NdotH * NdotV); ",
  "\t\t\tfloat F = pow(1.0 - VdotH, 5.0);",
  "\t\t\tresult.x += (1.0 - F) * G_Vis;",
  "\t\t\tresult.y += F * G_Vis;",
  "\t\t}",
  "\t}",
  "\treturn result / float(NumSamples);",
  "}",
  "void main()",
  "{",
  "\tvec2 brdf = IntegrateBRDF(vUV.x, vUV.y);",
  "\tgl_FragColor = vec4(brdf, 0.0, 1.0);",
  "}"
].join("\n"),
ImageBasedLighting.BRDFMap = function(t, e) {
  this.texture = null,
  this.resolution = e || 512,
  this.brdfMaterial = new THREE.ShaderMaterial({
    vertexShader: ImageBasedLighting.brdf_vs,
    fragmentShader: ImageBasedLighting.brdf_fs,
    uniforms: {
      HammersleyTable: {
        value: t
      }
    },
    lights: !1
  }),
  this.quad = new THREE.Mesh(new THREE.PlaneBufferGeometry(window.innerWidth, window.innerHeight), this.brdfMaterial),
  this.quad.position.z = -100
},
ImageBasedLighting.BRDFMap.prototype.constructor = ImageBasedLighting.BRDFMap,
ImageBasedLighting.BRDFMap.prototype.generateMap = function(t) {
  var e = new THREE.Scene;
  e.add(this.quad);
  var i = new THREE.OrthographicCamera(window.innerWidth / -2, window.innerWidth / 2, window.innerHeight / 2, window.innerHeight / -2, -1e4, 1e4);
  i.position.z = 100;
  var n = new THREE.WebGLRenderTarget(this.resolution, this.resolution, {
    minFilter: THREE.LinearFilter,
    magFilter: THREE.NearestFilter,
    format: THREE.RGBFormat
  });
  t.render(e, i, n, !0),
  this.texture = n.texture
},
THREE.HDRCubeTextureLoader = function(t) {
  this.manager = void 0 !== t
    ? t
    : THREE.DefaultLoadingManager,
  this.hdrLoader = new THREE.RGBELoader
},
THREE.HDRCubeTextureLoader.prototype.load = function(t, e, i, n, o) {
  var r = function(t, e, i, n) {
      var o = t[e + 3],
        r = Math.pow(2, o - 128) / 255;
      i[n + 0] = t[e + 0] * r,
      i[n + 1] = t[e + 1] * r,
      i[n + 2] = t[e + 2] * r
    },
    a = function() {
      function t(t) {
        e[0] = t;
        var n = i[0],
          o = n >> 16 & 32768,
          r = n >> 12 & 2047,
          a = n >> 23 & 255;
        return a < 103
          ? o
          : a > 142
            ? (o |= 31744, o |= (
              255 == a
              ? 0
              : 1) && 8388607 & n)
            : a < 113
              ? (r |= 2048, o |= (r >> 114 - a) + (r >> 113 - a & 1))
              : (o |= a - 112 << 10 | r >> 1, o += 1 & r)
      }
      var e = new Float32Array(1),
        i = new Int32Array(e.buffer);
      return function(e, i, n, o) {
        var r = e[i + 3],
          a = Math.pow(2, r - 128) / 255;
        n[o + 0] = t(e[i + 0] * a),
        n[o + 1] = t(e[i + 1] * a),
        n[o + 2] = t(e[i + 2] * a)
      }
    }(),
    s = new THREE.CubeTexture;
  s.type = t,
  s.encoding = t === THREE.UnsignedByteType
    ? THREE.RGBEEncoding
    : THREE.LinearEncoding,
  s.format = t === THREE.UnsignedByteType
    ? THREE.RGBAFormat
    : THREE.RGBFormat,
  s.minFilter = s.encoding === THREE.RGBEEncoding
    ? THREE.NearestFilter
    : THREE.LinearFilter,
  s.magFilter = s.encoding === THREE.RGBEEncoding
    ? THREE.NearestFilter
    : THREE.LinearFilter,
  s.generateMipmaps = s.encoding !== THREE.RGBEEncoding,
  s.anisotropy = 0;
  for (var l = this.hdrLoader, c = 0, h = 0; h < e.length; h++)
    !function(i, n, o, h) {
      var u = new THREE.FileLoader(this.manager);
      u.setResponseType("arraybuffer"),
      u.load(e[i], function(e) {
        c++;
        var o = l._parser(e);
        if (o) {
          if (t === THREE.FloatType) {
            for (var h = o.data.length / 4 * 3, u = new Float32Array(h), d = 0; d < h; d++)
              r(o.data, 4 * d, u, 3 * d);
            o.data = u
          } else if (t === THREE.HalfFloatType) {
            for (var h = o.data.length / 4 * 3, p = new Uint16Array(h), d = 0; d < h; d++)
              a(o.data, 4 * d, p, 3 * d);
            o.data = p
          }
          if (void 0 !== o.image)
            s[i].images = o.image;
          else if (void 0 !== o.data) {
            var f = new THREE.DataTexture(o.data, o.width, o.height);
            f.format = s.format,
            f.type = s.type,
            f.encoding = s.encoding,
            f.minFilter = s.minFilter,
            f.magFilter = s.magFilter,
            f.generateMipmaps = s.generateMipmaps,
            s.images[i] = f
          }
          6 === c && (s.needsUpdate = !0, n && n(s))
        }
      }, o, h)
    }
  (h, i, n, o);
  return s
},
ImageBasedLighting.HDRTextureLoader = function(t) {
  this.manager = void 0 !== t
    ? t
    : THREE.DefaultLoadingManager,
  this.hdrLoader = new THREE.RGBELoader
},
ImageBasedLighting.HDRTextureLoader.prototype.load = function(t, e, i, n) {
  var o = new THREE.DataTexture;
  return this.hdrLoader.load(t, function(t, i) {
    t.flipY = !0,
    t.type = THREE.FloatType,
    t.format = THREE.RGBFormat,
    t.minFilter = THREE.LinearFilter,
    t.magFilter = THREE.LinearFilter;
    for (var n = t.image.width * t.image.height * 3, r = new Float32Array(n), a = 0; a < n; a++)
      !function(t, e, i, n) {
        var o = t[e + 3],
          r = Math.pow(2, o - 128) / 256;
        i[n + 0] = t[e + 0] * r,
        i[n + 1] = t[e + 1] * r,
        i[n + 2] = t[e + 2] * r
      }
    (t.image.data, 4 * a, r, 3 * a);
    t.image.data = r,
    o = t,
    e && e(o)
  }, i, n),
  o
},
ImageBasedLighting.equirectangular_vs = ["varying vec3 pos;", "void main() {", "\tpos = vec3(modelMatrix * vec4(position, 1.0));", "\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);", "}"].join("\n"),
ImageBasedLighting.equirectangular_fs = [
  "varying vec3 pos;",
  "uniform sampler2D map;",
  "const float PI = 3.14159265358979;",
  "const float INV_PI = 1.0 / PI;",
  "vec2 sampleSphericalMap(vec3 v)",
  "{",
  "\tvec2 uv = vec2(atan(v.z, v.x), asin(v.y));",
  "\tuv *= vec2(INV_PI * 0.5, INV_PI);",
  "\tuv += 0.5;",
  "\treturn uv;",
  "}",
  "void main() {",
  "\tvec2 uv = sampleSphericalMap(normalize(pos));",
  "\tvec4 color = texture2D(map, uv);",
  "\tgl_FragColor = vec4(color.rgb, 1.0);",
  "}"
].join("\n"),
ImageBasedLighting.EquirectangularMaterial = function(t) {
  THREE.ShaderMaterial.call(this),
  this.type = "EquirectangularMaterial",
  this.map = null,
  this.lights = !1,
  this.side = THREE.BackSide,
  this.defines = {},
  this.uniforms = THREE.UniformsUtils.merge([
    {
      map: {
        value: null
      }
    }
  ]),
  this.vertexShader = ImageBasedLighting.equirectangular_vs,
  this.fragmentShader = ImageBasedLighting.equirectangular_fs,
  this.defaultAttributeValues = {
    color: [
      1, 1, 1
    ],
    uv: [
      0, 0
    ],
    uv2: [0, 0]
  },
  void 0 !== t && (void 0 !== t.attributes && console.error("IBLMaterial: attributes should now be defined in THREE.BufferGeometry instead."), this.setValues(t)),
  this.refreshUniforms()
},
ImageBasedLighting.EquirectangularMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype),
ImageBasedLighting.EquirectangularMaterial.prototype.constructor = ImageBasedLighting.EquirectangularMaterial,
ImageBasedLighting.EquirectangularMaterial.prototype.isShaderMaterial = !0,
ImageBasedLighting.EquirectangularMaterial.prototype.copy = function(t) {
  return THREE.ShaderMaterial.prototype.copy.call(this, t),
  this.map = t.map,
  this
},
ImageBasedLighting.EquirectangularMaterial.prototype.refreshUniforms = function() {
  this.uniforms.map.value = this.map
},
ImageBasedLighting.HDRToCubeMap = function(t, e, i, n) {
  var o = new THREE.CubeCamera(.1, 10, n || 512);
  if (i) {
    var r = {
      type: THREE.FloatType,
      format: THREE.RGBFormat,
      magFilter: THREE.LinearFilter,
      minFilter: THREE.LinearFilter
    };
    o.renderTarget = new THREE.WebGLRenderTargetCube(n || 512, n || 512, r)
  }
  var a = new THREE.Scene,
    s = new EquirectangularMaterial({map: t}),
    l = new THREE.Mesh(new THREE.BoxBufferGeometry(2, 2, 2), s);
  return a.add(l),
  o.updateCubeMap(e, a),
  o.renderTarget.texture
},
ImageBasedLighting.IBLMaterial = function(t) {
  THREE.ShaderMaterial.call(this),
  this.type = "IBLMaterial",
  this.debug = 0,
  this.gamma = 1,
  this.color = new THREE.Color(16777215),
  this.roughness = .8,
  this.metallic = .4,
  this.opacity = 1,
  this.map = null,
  this.iblProbe = null,
  this.shift = .18,
  this.A = .27,
  this.B = .29,
  this.C = .052,
  this.D = .2,
  this.E = 0,
  this.F = .18,
  this.scale = .897105,
  this.emissive = new THREE.Color,
  this.specular = new THREE.Color,
  this.shininess = 0,
  this.defines = {},
  this.uniforms = THREE.UniformsUtils.merge([
    {
      clippingPlanes: {
        value: null
      },
      debug: {
        value: 0
      },
      gamma: {
        value: 1
      },
      albedo: {
        value: new THREE.Color(16777215)
      },
      metallic: {
        value: .8
      },
      roughness: {
        value: .4
      },
      opacity: {
        value: 1
      },
      map: {
        value: null
      },
      irradianceMap: {
        value: null
      },
      prefilterMap: {
        value: null
      },
      brdfMap: {
        value: null
      },
      shift: {
        value: .18
      },
      A: {
        value: .27
      },
      B: {
        value: .29
      },
      C: {
        value: .052
      },
      D: {
        value: .2
      },
      E: {
        value: 0
      },
      F: {
        value: .18
      },
      scale: {
        value: .897105
      }
    }
  ]),
  this.lights = !1,
  this.vertexShader = ImageBasedLighting.IBLVertexShader,
  this.fragmentShader = ImageBasedLighting.IBLFragmentShader,
  this.defaultAttributeValues = {
    color: [
      1, 1, 1
    ],
    uv: [
      0, 0
    ],
    uv2: [0, 0]
  },
  void 0 !== t && (void 0 !== t.attributes && console.error("IBLMaterial: attributes should now be defined in THREE.BufferGeometry instead."), this.setValues(t))
},
ImageBasedLighting.IBLMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype),
ImageBasedLighting.IBLMaterial.prototype.constructor = ImageBasedLighting.IBLMaterial,
ImageBasedLighting.IBLMaterial.prototype.isShaderMaterial = !0,
ImageBasedLighting.IBLMaterial.prototype.copy = function(t) {
  return THREE.ShaderMaterial.prototype.copy.call(this, t),
  this.debug = t.debug,
  this.gamma = t.gamma,
  this.color.copy(t.color),
  this.metallic = t.metallic,
  this.roughness = t.roughness,
  this.opacity = t.opacity,
  this.map = t.map,
  this.iblProbe = t.iblProbe,
  this.shift = t.shift,
  this.A = t.A,
  this.B = t.B,
  this.C = t.C,
  this.D = t.D,
  this.E = t.E,
  this.F = t.F,
  this.scale = t.scale,
  this
},
ImageBasedLighting.IBLMaterial.prototype.refreshUniforms = function() {
  this.uniforms.clippingPlanes.value = this.clippingPlanes,
  this.uniforms.debug.value = this.debug,
  this.uniforms.gamma.value = this.gamma,
  this.uniforms.albedo.value.set(this.color),
  this.uniforms.metallic.value = this.metallic,
  this.uniforms.roughness.value = this.roughness,
  this.uniforms.opacity.value = this.opacity,
  this.uniforms.map.value = this.map,
  this.uniforms.irradianceMap.value = this.iblProbe.irradianceMap.cubeTexture,
  this.uniforms.prefilterMap.value = this.iblProbe.prefilterMap.cubeTexture,
  this.uniforms.brdfMap.value = this.iblProbe.brdfMap.texture,
  this.uniforms.shift.value = this.shift,
  this.uniforms.A.value = this.A,
  this.uniforms.B.value = this.B,
  this.uniforms.C.value = this.C,
  this.uniforms.D.value = this.D,
  this.uniforms.E.value = this.E,
  this.uniforms.F.value = this.F,
  this.uniforms.scale.value = this.scale
},
ImageBasedLighting.IBLProbe = function(t, e, i, n, o, r, a) {
  this.environmentMap = t,
  this.hammersleyTable = null,
  this.irradianceMap = null,
  this.prefilterMap = null,
  this.brdfMap = null,
  this.hammersleyUrl = e,
  this.irradianceResolution = n || 32,
  this.prefilterResolution = o || 128,
  this.brdfResolution = r || 512,
  this.maxMipLevel = a || 1,
  this.isHDR = !1,
  this.isComputed = !1,
  this.onSuccess = i,
  this.loadHammersleyTable()
},
ImageBasedLighting.IBLProbe.prototype.constructor = ImageBasedLighting.IBLProbe,
ImageBasedLighting.IBLProbe.prototype.loadHammersleyTable = function() {
  var t = this;
  (new THREE.TextureLoader).load(this.hammersleyUrl, function(e) {
    t.hammersleyTable = e,
    t.initMap(),
    t.onSuccess && t.onSuccess()
  })
},
ImageBasedLighting.IBLProbe.prototype.initMap = function() {
  this.irradianceMap = new ImageBasedLighting.IrradianceMap(this.environmentMap, this.irradianceResolution),
  this.prefilterMap = new ImageBasedLighting.PrefilterMap(this.environmentMap, this.hammersleyTable, this.prefilterResolution, this.maxMipLevel),
  this.brdfMap = new ImageBasedLighting.BRDFMap(this.hammersleyTable, this.brdfResolution)
},
ImageBasedLighting.IBLProbe.prototype.setEnvironmentMap = function(t) {
  this.environmentMap = t,
  this.irradianceMap.irradianceMaterial.uniforms.environmentMap.value = this.environmentMap,
  this.prefilterMap.prefilterMaterial.uniforms.environmentMap.value = this.environmentMap
},
ImageBasedLighting.IBLProbe.prototype.computed = function(t) {
  this.irradianceMap.generateMap(t, this.isHDR),
  this.prefilterMap.generateMap(t, this.isHDR),
  this.brdfMap.generateMap(t),
  this.isComputed = !0
},
ImageBasedLighting.IBLVertexShader = [
  "varying vec2 vUV;",
  "varying vec3 Normal;",
  "varying vec3 Pos;",
  "varying vec3 mvPosition;",
  "void main()",
  "{",
  "\tvUV = uv;",
  "\tPos = vec3(modelMatrix * vec4(position, 1.0));",
  "\tNormal = normalize(mat3(modelMatrix) * normal);",
  "\tmvPosition = vec3(modelViewMatrix * vec4(position, 1.0));",
  "\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",
  "}"
].join("\n"),
ImageBasedLighting.IBLFragmentShader = [
  "varying vec2 vUV;",
  "varying vec3 Normal;",
  "varying vec3 Pos;",
  "varying vec3 mvPosition;",
  "#if NUM_CLIPPING_PLANES > 0",
  "\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];",
  "#endif",
  "uniform int debug;",
  "uniform float gamma;",
  "uniform vec3 albedo;",
  "uniform float metallic;",
  "uniform float roughness;",
  "uniform float opacity;",
  "#ifdef USE_MAP",
  "\tuniform sampler2D map;",
  "#endif",
  "uniform samplerCube irradianceMap;",
  "uniform samplerCube prefilterMap;",
  "uniform sampler2D brdfMap;",
  "uniform float shift;",
  "uniform float A;",
  "uniform float B;",
  "uniform float C;",
  "uniform float D;",
  "uniform float E;",
  "uniform float F;",
  "uniform float scale;",
  "const float PI = 3.14159265358979;",
  "float D_GGX(float NdotH, float roughness)",
  "{",
  "\tfloat alpha = pow(roughness, 2.0);",
  "\tfloat alpha2 = pow(alpha, 2.0);",
  "\treturn alpha2 / (PI * pow(NdotH * NdotH * (alpha2 - 1.0) + 1.0, 2.0));",
  "}",
  "float GGX_Schlick(float NdotV, float alpha)",
  "{",
  "\tfloat k = alpha * 0.5;",
  "\treturn NdotV / (NdotV * (1.0 - k) + k);",
  "}",
  "float G_Smith(float NdotV, float NdotL, float roughness)",
  "{",
  "\tfloat alpha = pow(roughness, 2.0);",
  "\treturn GGX_Schlick(NdotV, alpha) * GGX_Schlick(NdotL, alpha);",
  "}",
  "float F_Schlick(float F0, float HdotV)",
  "{",
  "\treturn F0 + (1.0 - F0) * pow((1.0 - HdotV), 5.0);",
  "}",
  "vec3 F_SchlickRoughness(float NdotV, vec3 F0, float roughness)",
  "{",
  "\treturn F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - NdotV, 5.0);",
  "}",
  "vec3 toneMapCanonFilmic(vec3 color)",
  "{",
  "\tcolor *= (1.0 / shift);",
  "\treturn (((color * (A * color + C * B)) / (color * (A * color + B) + D * F))) * (1.0 / scale);",
  "}",
  "void main()",
  "{",
  "#if NUM_CLIPPING_PLANES > 0",
  " vec3 vViewPosition = -mvPosition;",
  "\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {",
  "\t\tvec4 plane = clippingPlanes[ i ];",
  "\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;",
  "\t}",
  "\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES",
  "\t\tbool clipped = true;",
  "\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {",
  "\t\t\tvec4 plane = clippingPlanes[ i ];",
  "\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;",
  "\t\t}",
  "\t\tif ( clipped ) discard;",
  "\t#endif",
  "#endif",
  "\tvec3 N = Normal;",
  "\tvec3 V = normalize(cameraPosition - Pos);",
  "\tvec3 R = reflect(-V, N);",
  "\tvec3 baseColor = albedo;",
  "#ifdef USE_MAP",
  "\tbaseColor = texture2D(map, vUV).rgb;",
  "#endif",
  "\tvec3 F0 = vec3(0.04);",
  "\tF0 = mix(F0, baseColor, metallic);",
  "\tvec3 F = F_SchlickRoughness(max(dot(N, V), 0.0), F0, roughness);",
  "\tvec3 kS = F;",
  "\tvec3 kD = 1.0 - kS;",
  "\tkD *= 1.0 - metallic;",
  "\tvec3 irradiance = textureCube(irradianceMap, N, 0.0).rgb;",
  "\tirradiance = pow(irradiance, vec3(gamma));",
  "\tvec3 diffuse = irradiance * baseColor;",
  "\tconst float MAX_REFLECTION_LOD = 1.0;",
  "\tvec3 prefilteredColor = textureCube(prefilterMap, R, roughness * MAX_REFLECTION_LOD).rgb;",
  "\tprefilteredColor = pow(prefilteredColor, vec3(gamma));",
  "\tvec2 brdf = texture2D(brdfMap, vec2(max(dot(N, V), 0.0), roughness)).rg;",
  "\tvec3 specular = prefilteredColor * (F * brdf.x + brdf.y);",
  "\tvec3 color = kD * diffuse + specular;",
  "\tcolor = toneMapCanonFilmic(color);",
  "\tcolor = pow(color, vec3(1.0 / gamma));",
  "\tif (debug == 1) ",
  "\t{",
  "\t\tgl_FragColor = vec4(baseColor, opacity);",
  "\t}",
  "\telse if (debug == 2)",
  "\t{",
  "\t\tgl_FragColor = vec4(irradiance, opacity);",
  "\t}",
  "\telse if (debug == 3)",
  "\t{",
  "\t\tgl_FragColor = vec4(prefilteredColor, opacity);",
  "\t}",
  "\telse if (debug == 4)",
  "\t{",
  "\t\tgl_FragColor = vec4(diffuse, opacity);",
  "\t}",
  "\telse if (debug == 5)",
  "\t{",
  "\t\tgl_FragColor = vec4(specular, opacity);",
  "\t}",
  "\telse if (debug == 6)",
  "\t{",
  "\t\tgl_FragColor = vec4(brdf, 0.0, opacity);",
  "\t}",
  "\telse if (debug == 7)",
  "\t{",
  "\t\tgl_FragColor = vec4(Normal, opacity);",
  "\t}",
  "\telse",
  "\t{",
  "\t\tgl_FragColor = vec4(color, opacity);",
  "\t}",
  "}"
].join("\n"),
ImageBasedLighting.cube_vs = [
  "varying vec3 pos;",
  "void main() {",
  "\tpos = position;",
  "\tgl_Position = projectionMatrix * mat4(mat3(viewMatrix)) * modelMatrix * vec4(position, 1.0);",
  "\tgl_Position = gl_Position.xyww;",
  "}"
].join("\n"),
ImageBasedLighting.cube_fs = [
  "varying vec3 pos;",
  "uniform samplerCube environmentMap;",
  "uniform bool hdr;",
  "uniform float shift;",
  "uniform float A;",
  "uniform float B;",
  "uniform float C;",
  "uniform float D;",
  "uniform float E;",
  "uniform float F;",
  "uniform float scale;",
  "vec3 toneMapCanonFilmic(vec3 color)",
  "{",
  "\tcolor *= (1.0 / shift);",
  "\treturn (((color * (A * color + C * B)) / (color * (A * color + B) + D * F))) * (1.0 / scale);",
  "}",
  "void main() {",
  "\tvec3 envColor = textureCube(environmentMap, pos, 0.0).rgb;",
  "\tif (hdr)",
  "\t{",
  "\t\tenvColor = toneMapCanonFilmic(envColor);",
  "\t}",
  "\tgl_FragColor = vec4(envColor, 1.0);",
  "}"
].join("\n"),
ImageBasedLighting.irradiance_vs = ["varying vec3 pos;", "void main() {", "\tpos = vec3(modelMatrix * vec4(position, 1.0));", "\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);", "}"].join("\n"),
ImageBasedLighting.irradiance_fs = [
  "varying vec3 pos;",
  "uniform samplerCube environmentMap;",
  "const float PI = 3.14159265358979;",
  "vec3 caluIrradiance(vec3 normal, vec3 up, vec3 right)",
  "{",
  "\tvec3 irradiance = vec3(0.0);",
  "\tint count = 0;",
  "\tconst int phiSampleCount = 1024;",
  "\tconst int thetaSampleCount = phiSampleCount / 4;",
  "\tfloat phiDelta = 2.0 * PI / float(phiSampleCount);",
  "\tfloat thetaDelta = 0.5 * PI / float(thetaSampleCount);",
  "\tfor(int i = 0; i < phiSampleCount; ++i)",
  "\t{",
  "\t\tfloat phi = float(i) * phiDelta;",
  "\t\tfor(int j = 0; j < thetaSampleCount; ++j)",
  "\t\t{",
  "\t\t\tfloat theta = float(j) * thetaDelta;",
  "\t\t\tvec3 tangentSample = vec3(sin(theta) * cos(phi), sin(theta) * sin(phi), cos(theta));",
  "\t\t\tvec3 sampleVec = tangentSample.x * right + tangentSample.y * up + tangentSample.z * normal; ",
  "\t\t\tirradiance += textureCube(environmentMap, sampleVec, 0.0).rgb * cos(theta) * sin(theta);",
  "\t\t\t++count;",
  "\t\t}",
  "\t}",
  "\tirradiance = PI * irradiance * (1.0 / float(count));",
  "\treturn irradiance;",
  "}",
  "void main()",
  "{",
  "\tvec3 normal = normalize(pos);",
  "\tvec3 up = vec3(0.0, 1.0, 0.0);",
  "\tvec3 right = cross(up, normal);",
  "\tup = cross(normal, right);",
  "\tvec3 irradiance = caluIrradiance(normal, up, right);",
  "\tgl_FragColor = vec4(irradiance, 1.0);",
  "}"
].join("\n"),
ImageBasedLighting.IrradianceMap = function(t, e) {
  this.cubeTexture = null,
  this.resolution = e || 32,
  this.irradianceMaterial = new THREE.ShaderMaterial({
    vertexShader: ImageBasedLighting.irradiance_vs,
    fragmentShader: ImageBasedLighting.irradiance_fs,
    uniforms: {
      environmentMap: {
        value: t
      }
    },
    lights: !1,
    side: THREE.BackSide
  }),
  this.cube = new THREE.Mesh(new THREE.BoxBufferGeometry(2, 2, 2), this.irradianceMaterial)
},
ImageBasedLighting.IrradianceMap.prototype.constructor = ImageBasedLighting.IrradianceMap,
ImageBasedLighting.IrradianceMap.prototype.generateMap = function(t, e) {
  var i = new THREE.Scene;
  i.add(this.cube);
  var n = new THREE.CubeCamera(.1, 10, this.resolution);
  if (e) {
    var o = {
      type: THREE.FloatType,
      format: THREE.RGBFormat,
      magFilter: THREE.LinearFilter,
      minFilter: THREE.LinearFilter
    };
    n.renderTarget = new THREE.WebGLRenderTargetCube(this.resolution, this.resolution, o)
  }
  n.updateCubeMap(t, i),
  this.cubeTexture = n.renderTarget.texture
},
ImageBasedLighting.prefilter_vs = [
  "varying vec3 pos;",
  "varying vec3 Normal;",
  "void main() {",
  "\tpos = vec3(modelMatrix * vec4(position, 1.0));",
  "\tNormal = mat3(modelMatrix) * normal;",
  "\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",
  "}"
].join("\n"),
ImageBasedLighting.prefilter_fs = [
  "varying vec3 pos;",
  "varying vec3 Normal;",
  "uniform float roughness;",
  "uniform samplerCube environmentMap;",
  "uniform sampler2D HammersleyTable;",
  "const float PI = 3.14159265358979;",
  "float D_GGX(float NdotH, float roughness)",
  "{",
  "\tfloat alpha = pow(roughness, 2.0);",
  "\tfloat alpha2 = pow(alpha, 2.0);",
  "\treturn alpha2 / (PI * pow(NdotH * NdotH * (alpha2 - 1.0) + 1.0, 2.0));",
  "}",
  "vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness) ",
  "{",
  "\tfloat a = roughness * roughness;",
  "\tfloat Phi = 2.0 * PI * Xi.x; ",
  "\tfloat CosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a * a - 1.0) * Xi.y)); ",
  "\tfloat SinTheta = sqrt(1.0 - CosTheta * CosTheta);",
  "\tvec3 H;",
  "\tH.x = SinTheta * cos(Phi); ",
  "\tH.y = SinTheta * sin(Phi); ",
  "\tH.z = CosTheta;",
  "\tvec3 UpVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0); ",
  "\tvec3 TangentX = normalize(cross(UpVector, N)); ",
  "\tvec3 TangentY = cross(N, TangentX);",
  "\treturn normalize(TangentX * H.x + TangentY * H.y + N * H.z);",
  "}",
  "void main()",
  "{",
  "\tvec3 N = normalize(pos);",
  "\tvec3 R = N;",
  "\tvec3 V = R;",
  "\tconst int sampleCount = 1024;",
  "\tfloat totalWeight = 0.0;",
  "\tvec3 prefilteredColor = vec3(0.0);",
  "\tfor (int i = 0; i < sampleCount; ++i) {",
  "\t\tfloat u = float(i) / float(sampleCount);",
  "\t\tvec2 Xi = vec2(u, texture2D(HammersleyTable, vec2(u)).r);",
  "\t\tvec3 H = ImportanceSampleGGX(Xi, N, roughness);",
  "\t\tvec3 L = normalize(2.0 * dot(V, H) * H - V);",
  "\t\tfloat NdotL = max(dot(N, L), 0.0);",
  "\t\tif(NdotL > 0.0)",
  "\t\t{",
  "\t\t\tfloat NdotH = max(dot(N, H), 0.0);",
  "\t\t\tfloat D = D_GGX(NdotH, roughness);",
  "\t\t\tfloat HdotV = max(dot(H, V), 0.0);",
  "\t\t\tfloat pdf = D * NdotH / (4.0 * HdotV);",
  "\t\t\tfloat resolution = 2048.0; // resolution of source cubemap (per face)",
  "\t\t\tfloat solidAngleTexel= 4.0 * PI / (6.0 * resolution * resolution);",
  "\t\t\tfloat solidAngleSample = 1.0 / (float(sampleCount) * pdf);",
  "\t\t\tfloat mipLevel = roughness == 0.0 ? 0.0 : 0.5 * log2(solidAngleSample / solidAngleTexel);",
  "\t\t\tprefilteredColor += textureCube(environmentMap, L, mipLevel).rgb * NdotL;",
  "\t\t\ttotalWeight += NdotL;",
  "\t\t}",
  "\t}",
  "\tprefilteredColor = prefilteredColor / totalWeight;",
  "\tgl_FragColor = vec4(prefilteredColor, 1.0);",
  "}"
].join("\n"),
ImageBasedLighting.PrefilterMap = function(t, e, i, n) {
  this.cubeTexture = null,
  this.resolution = i || 128,
  this.maxMipLevel = n || 1,
  this.prefilterMaterial = new THREE.ShaderMaterial({
    vertexShader: ImageBasedLighting.prefilter_vs,
    fragmentShader: ImageBasedLighting.prefilter_fs,
    uniforms: {
      roughness: {
        value: 0
      },
      environmentMap: {
        value: t
      },
      HammersleyTable: {
        value: e
      }
    },
    lights: !1,
    side: THREE.BackSide
  }),
  this.cube = new THREE.Mesh(new THREE.BoxBufferGeometry(2, 2, 2), this.prefilterMaterial)
},
ImageBasedLighting.PrefilterMap.prototype.constructor = ImageBasedLighting.PrefilterMap,
ImageBasedLighting.PrefilterMap.prototype.generateMap = function(t, e) {
  var i = new THREE.Scene;
  i.add(this.cube);
  var n = new THREE.CubeCamera(.1, 10, this.resolution);
  if (e) {
    var o = {
      type: THREE.FloatType,
      format: THREE.RGBFormat,
      magFilter: THREE.LinearFilter,
      minFilter: THREE.LinearFilter
    };
    n.renderTarget = new THREE.WebGLRenderTargetCube(this.resolution, this.resolution, o)
  }
  for (
    var r = this.maxMipLevel <= 1
    ? 1
    : this.maxMipLevel - 1,
  a = 0; a < this.maxMipLevel; a++) {
    var s = this.resolution * Math.pow(.5, a);
    n.renderTarget.width = n.renderTarget.height = s;
    var l = a / r;
    this.prefilterMaterial.uniforms.roughness.value = l,
    n.renderTarget.activeMipMapLevel = a,
    n.updateCubeMap(t, i)
  }
  this.cubeTexture = n.renderTarget.texture
},
THREE.HDRLoader = THREE.RGBELoader = function(t) {
  this.manager = void 0 !== t
    ? t
    : THREE.DefaultLoadingManager
},
THREE.RGBELoader.prototype = Object.create(THREE.DataTextureLoader.prototype),
THREE.RGBELoader.prototype._parser = function(t) {
  var e = function(t, e) {
      switch (t) {
        case 1:
          console.error("THREE.RGBELoader Read Error: " + (
          e || ""));
          break;
        case 2:
          console.error("THREE.RGBELoader Write Error: " + (
          e || ""));
          break;
        case 3:
          console.error("THREE.RGBELoader Bad File Format: " + (
          e || ""));
          break;
        default:
        case 4:
          console.error("THREE.RGBELoader: Error: " + (
          e || ""))
      }
      return -1
    },
    i = function(t, e, i) {
      e = e || 1024;
      for (var n = t.pos, o = -1, r = 0, a = "", s = String.fromCharCode.apply(null, new Uint16Array(t.subarray(n, n + 128))); 0 > (o = s.indexOf("\n")) && r < e && n < t.byteLength;)
        a += s,
        r += s.length,
        n += 128,
        s += String.fromCharCode.apply(null, new Uint16Array(t.subarray(n, n + 128)));
      return -1 < o && (!1 !== i && (t.pos += r + o + 1), a + s.slice(0, o))
    },
    n = new Uint8Array(t);
  n.byteLength;
  n.pos = 0;
  var o = function(t) {
    var n,
      o,
      r = {
        valid: 0,
        string: "",
        comments: "",
        programtype: "RGBE",
        format: "",
        gamma: 1,
        exposure: 1,
        width: 0,
        height: 0
      };
    if (t.pos >= t.byteLength || !(n = i(t)))
      return e(1, "no header found");
    if (!(o = n.match(/^#\?(\S+)$/)))
      return e(3, "bad initial token");
    for (r.valid |= 1, r.programtype = o[1], r.string += n + "\n";;) {
      if (!1 === (n = i(t)))
        break;
      if (r.string += n + "\n", "#" !== n.charAt(0)) {
        if ((o = n.match(/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/)) && (r.gamma = parseFloat(o[1], 10)), (o = n.match(/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/)) && (r.exposure = parseFloat(o[1], 10)), (o = n.match(/^\s*FORMAT=(\S+)\s*$/)) && (r.valid |= 2, r.format = o[1]), (o = n.match(/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/)) && (r.valid |= 4, r.height = parseInt(o[1], 10), r.width = parseInt(o[2], 10)), 2 & r.valid && 4 & r.valid)
          break
      } else
        r.comments += n + "\n"
    }
    return 2 & r.valid
      ? 4 & r.valid
        ? r
        : e(3, "missing image size specifier")
      : e(3, "missing format specifier")
  }(n);
  if (-1 !== o) {
    var r = o.width,
      a = o.height,
      s = function(t, i, n) {
        var o,
          r,
          a,
          s,
          l,
          c,
          h,
          u,
          d,
          p,
          f,
          m,
          g,
          v = i,
          y = n;
        if (v < 8 || v > 32767 || 2 !== t[0] || 2 !== t[1] || 128 & t[2])
          return new Uint8Array(t);
        if (v !== (t[2] << 8 | t[3]))
          return e(3, "wrong scanline width");
        if (!(o = new Uint8Array(4 * i * n)) || !o.length)
          return e(4, "unable to allocate buffer space");
        for (r = 0, a = 0, u = 4 * v, g = new Uint8Array(4), c = new Uint8Array(u); y > 0 && a < t.byteLength;) {
          if (a + 4 > t.byteLength)
            return e(1);
          if (g[0] = t[a++], g[1] = t[a++], g[2] = t[a++], g[3] = t[a++], 2 != g[0] || 2 != g[1] || (g[2] << 8 | g[3]) != v)
            return e(3, "bad rgbe scanline format");
          for (h = 0; h < u && a < t.byteLength;) {
            if (s = t[a++], m = s > 128, m && (s -= 128), 0 === s || h + s > u)
              return e(3, "bad scanline data");
            if (m)
              for (l = t[a++], d = 0; d < s; d++)
                c[h++] = l;
          else
              c.set(t.subarray(a, a + s), h),
              h += s,
              a += s
          }
          for (p = v, d = 0; d < p; d++)
            f = 0,
            o[r] = c[d + f],
            f += v,
            o[r + 1] = c[d + f],
            f += v,
            o[r + 2] = c[d + f],
            f += v,
            o[r + 3] = c[d + f],
            r += 4;
          y--
        }
        return o
      }(n.subarray(n.pos), r, a);
    if (-1 !== s)
      return {
        width: r,
        height: a,
        data: s,
        header: o.string,
        gamma: o.gamma,
        exposure: o.exposure,
        format: THREE.RGBEFormat,
        type: THREE.UnsignedByteType
      }
    }
  return null
},
CLOUD.Viewer = function() {
  function t() {
    e.goToInitialView(),
    e.zoomAll(),
    e.modelManager.removeEventListener(CLOUD.EVENTS.ON_LOAD_CONFIG_FINISH, t)
  }
  this.domElement = null,
  this.camera = null,
  this.renderer = null,
  this.countRenderRequest = 0,
  this.maxCountRenderRequest = 1e4,
  this.rendering = !1,
  this.incrementRenderHandle = 0,
  this.callbacks = {},
  this.services = {},
  this.tmpBox = new THREE.Box3,
  this.enableCameraNearFar = !0,
  this.currentHomeView = CLOUD.EnumStandardView.ISO,
  this.initialView = CLOUD.EnumStandardView.ISO,
  this.filter = new CLOUD.FilterManager,
  this.modelManager = new CLOUD.ModelManager(this.filter),
  this.editorManager = new CLOUD.EditorManager,
  this.isRecalculationPlanes = !1,
  this.calculationPlanesBind = this.calculationPlanes.bind(this),
  this.addRenderFinishedCallback(this.calculationPlanesBind),
  this.isHDR = !0,
  this.environmentCubeMap = null,
  this.cubeMesh = null;
  var e = this;
  this.modelManager.addEventListener(CLOUD.EVENTS.ON_LOAD_CONFIG_FINISH, t)
},
CLOUD.Viewer.prototype = {
  constructor: CLOUD.Viewer,
  addCallbacks: function(t, e) {
    var i = this.callbacks[t];
    i || (i = [], this.callbacks[t] = i),
    i.indexOf(e) === -1 && i.push(e)
  },
  removeCallbacks: function(t, e) {
    var i = this.callbacks[t];
    if (i) {
      var n = i.indexOf(e);
      n !== -1 && i.splice(n, 1)
    }
  },
  removeAllCallbacks: function() {
    for (var t in this.callbacks)
      for (var e = this.callbacks[t], i = 0, n = e.length; i < n; i++)
        e.splice(0, 1);
  for (var t in this.callbacks)
      delete this.callbacks[t];
    this.callbacks = {}
  },
  onCallbacks: function(t) {
    var e = this.callbacks[t];
    if (e)
      for (var i = 0; i < e.length; i++)
        e[i] && e[i]()
  },
  addRenderCallback: function(t) {
    this.addCallbacks("render", t)
  },
  removeRenderCallback: function(t) {
    this.removeCallbacks("render", t)
  },
  onRenderCallback: function() {
    this.onCallbacks("render")
  },
  addRenderFinishedCallback: function(t) {
    this.addCallbacks("renderFinished", t)
  },
  removeRenderFinishedCallback: function(t) {
    this.removeCallbacks("renderFinished", t)
  },
  onRenderFinishedCallback: function() {
    this.onCallbacks("renderFinished")
  },
  destroy: function() {
    this.removeAllCallbacks(),
    this.editorManager.unregisterDomEventListeners(this.domElement),
    this.domElement.removeChild(this.domElement.childNodes[0]),
    this.domElement = null;
    for (var t in this.services) {
      this.services[t].destroy()
    }
    this.services = {},
    this.editorManager.destroy(),
    this.modelManager.destroy(),
    this.renderer && this.renderer.destroy && this.renderer.destroy(),
    this.renderer = null,
    this.modelManager = null,
    this.editorManager = null
  },
  init: function(t) {
    console.log("Web3D: " + CLOUD.Version);
    var e = this;
    this.domElement = t;
    var i,
      n = CLOUD.GlobalData.IncrementRender,
      o = CLOUD.GlobalData.maxDrawCacheNum,
      r = {
        alpha: !0,
        preserveDrawingBuffer: !0,
        antialias: !0,
        maxDrawCacheNum: o
      };
    try {
      i = document.createElement("canvas");
      i.getContext("webgl", r) || i.getContext("experimental-webgl", r) || (r.antialias = !1)
    } catch (t) {
      return !1
    }
    CLOUD.GeomUtil.initializeUnitInstances(),
    r.canvas = i,
    n
      ? (this.renderer = new THREE.WebGLRendererByIncrement(r), this.orderedRenderer = new CLOUD.OrderedRenderer(this.filter), this.renderer.setRenderer(this.orderedRenderer), this.renderer.setRenderTicket(0))
      : (this.renderer = new THREE.WebGLRenderer(r), CLOUD.GlobalData.IncrementRender = !1),
    this.renderer.domElement.addEventListener("webglcontextlost", function(t) {
      t.preventDefault(),
      e.incrementRenderHandle > 0 && (cancelAnimationFrame(e.incrementRenderHandle), console.log("---------------- webglcontextlost --------------"))
    }, !1);
    var a = t.offsetWidth,
      s = t.offsetHeight;
    this.renderer.setClearColor(0, 0),
    this.renderer.setPixelRatio(window.devicePixelRatio),
    this.renderer.setSize(a, s),
    this.renderer.toneMapping = CLOUD.GlobalData.ToneMapping,
    this.renderer.domElement.setAttribute("tabindex", "0"),
    this.renderer.domElement.setAttribute("id", "cloud-main-canvas"),
    this.domElement.appendChild(this.renderer.domElement),
    this.camera = new CLOUD.Camera(a, s, 45, .1, 20 * CLOUD.GlobalData.SceneSize);
    var l = this.camera;
    return this.cameraControl = new CLOUD.CameraControl(this, l, t, function() {
      e.render()
    }),
    this.setEditorDefault(),
    this.editorManager.registerDomEventListeners(this.domElement),
    this.modelManager.onUpdateViewer = function() {
      e.render(!0)
    },
    CLOUD.GlobalData.IBL && this.loadIBLcfg("data/IBLConfig.json"),
    !0
  },
  render: function() {
    var t = this,
      e = this.camera,
      i = this.modelManager,
      n = this.renderer,
      o = this.getScene(),
      r = CLOUD.GlobalData.IncrementRender;
    if (!this.isModelLoaded) {
      if (!i.hasModel())
        return void CLOUD.Logger.log("model not loaded!");
      this.isModelLoaded = !0
    }
    if (!CLOUD.GlobalData.IBL || null == this.getScene().iblProbe || this.getScene().iblProbe.isComputed)
      if (r) {
        if (++this.countRenderRequest, this.countRenderRequest > this.maxCountRenderRequest && (this.countRenderRequest = 0), this.rendering)
          return;
        this.rendering = !0,
        i.calculateCameraModelRelation(e.position),
        this.calculateNearFar();
        for (var a in this.services) {
          var s = this.services[a];
          s.update(e)
        }
        o.updateLights(e);
        var l = this.editorManager.isUpdateRenderList;
        n.resetIncrementRender(),
        n.setObjectListUpdateState(l),
        this.incrementRenderHandle = requestAnimationFrame(function i(r, a) {
          var s = r;
          return function() {
            n.autoClear = a,
            t.editorManager.cameraChange
              ? (n.resetIncrementRender(), n.autoClear = !0, t.editorManager.cameraChange = !1)
              : n.autoClear = a,
            n.render(o, e) || s !== t.countRenderRequest
              ? (
                t.rendering = !1, s !== t.countRenderRequest
                ? t.render()
                : t.onRenderFinishedCallback())
              : t.incrementRenderHandle = requestAnimationFrame(i(s, !1))
          }
        }(t.countRenderRequest, !0)),
        l && i.prepareScene(e),
        this.onRenderCallback()
      } else
        this.calculateNearFar(),
        o.updateLights(e),
        i.prepareScene(e),
        CLOUD.Logger.time("webgl render"),
        n.render(o, e),
        CLOUD.Logger.timeEnd("webgl render"),
        this.onRenderCallback(),
        this.onRenderFinishedCallback()
  },
  resize: function(t, e) {
    var i = this.camera;
    i.setSize(t, e),
    i.updateProjectionMatrix(),
    this.renderer.setSize(t, e),
    this.editorManager.resize(),
    this.onCallbacks("resize"),
    this.render()
  },
  calculateNearFar: function() {
    var t = this.getScene(),
      e = t.getBoundingBoxWorld(),
      i = this.camera;
    if (null != e) {
      var n = this.tmpBox;
      n.copy(e),
      n.applyMatrix4(t.getMatrixGlobal());
      var o = n.getCenter(),
        r = i.position,
        a = r.clone().sub(o),
        s = a.length(),
        l = Math.sqrt((n.max.x - n.min.x) * (n.max.x - n.min.x) + (n.max.y - n.min.y) * (n.max.y - n.min.y) + (n.max.z - n.min.z) * (n.max.z - n.min.z));
      if (this.modelManager.containsCamera || !this.enableCameraNearFar)
        i.setNearFar(.1, l);
      else {
        var c = (s * s + .001 * s) / 16777.216;
        i.setNearFar(c, s + l / 2)
      }
    }
  },
  registerDomEventListeners: function() {
    this.domElement && this.editorManager.registerDomEventListeners(this.domElement)
  },
  unregisterDomEventListeners: function() {
    this.domElement && this.editorManager.unregisterDomEventListeners(this.domElement)
  },
  registerEventListener: function(t, e) {
    this.modelManager.addEventListener(t, e)
  },
  load: function(t, e, i, n) {
    return i = i || !0,
    this.modelManager.load({databagId: t, serverUrl: e, notifyProgress: i, debug: n})
  },
  unload: function(t) {
    this.modelManager.unload(t) && this.render()
  },
  unloadAll: function() {
    this.modelManager.unloadAll(),
    this.render()
  },
  showModel: function(t) {
    this.modelManager.showModel(t) && this.render()
  },
  hideModel: function(t) {
    this.modelManager.hideModel(t) && this.render()
  },
  showScene: function(t, e) {
    t && (t.setVisible(e), this.render())
  },
  clearAll: function() {
    this.getScene().clearAll()
  },
  getScene: function() {
    return this.modelManager.scene
  },
  getFilters: function() {
    return this.filter
  },
  getCurrentEditorName: function() {
    return this.editorManager.getCurrentEditorName()
  },
  getCurrentEditorMode: function() {
    return this.editorManager.getCurrentEditorMode()
  },
  setEditorMode: function(t) {
    this.editorManager.setEditorMode(this, t),
    this.render()
  },
  setEditorDefault: function() {
    this.setEditorMode(CLOUD.EditorMode.PICK_BY_RECT)
  },
  setPickMode: function() {
    console.warn("CLOUD.Viewer.setPickMode() has been deprecated. Use CLOUD.Viewer.setEditorMode(name) instead."),
    this.setEditorMode(CLOUD.EditorMode.PICK)
  },
  setRectPickMode: function() {
    console.warn("CLOUD.Viewer.setRectPickMode() has been deprecated. Use CLOUD.Viewer.setEditorMode(name) instead."),
    this.setEditorMode(CLOUD.EditorMode.PICK_BY_RECT)
  },
  setOrbitMode: function() {
    console.warn("CLOUD.Viewer.setOrbitMode() has been deprecated. Use CLOUD.Viewer.setEditorMode(name) instead."),
    this.setEditorMode(CLOUD.EditorMode.ORBIT)
  },
  setZoomMode: function() {
    console.warn("CLOUD.Viewer.setZoomMode() has been deprecated. Use CLOUD.Viewer.setEditorMode(name) instead."),
    this.setEditorMode(CLOUD.EditorMode.ZOOM)
  },
  setRectZoomMode: function() {
    console.warn("CLOUD.Viewer.setRectZoomMode() has been deprecated. Use CLOUD.Viewer.setEditorMode(name) instead."),
    this.setEditorMode(CLOUD.EditorMode.ZOOM_BY_RECT)
  },
  setPanMode: function() {
    console.warn("CLOUD.Viewer.setPanMode() has been deprecated. Use CLOUD.Viewer.setEditorMode(name) instead."),
    this.setEditorMode(CLOUD.EditorMode.PAN)
  },
  setFlyMode: function() {
    console.warn("CLOUD.Viewer.setFlyMode() has been deprecated. Use CLOUD.Viewer.setEditorMode(name) instead."),
    this.setEditorMode(CLOUD.EditorMode.FLY)
  },
  setClipPlanesMode: function() {
    console.warn("CLOUD.Viewer.setClipPlanesMode() has been deprecated. Use CLOUD.Viewer.setEditorMode(name) instead."),
    this.setEditorMode(CLOUD.EditorMode.CLIP_BY_BOX)
  },
  getBoundingBoxWorld: function() {
    return this.getScene().getBoundingBoxWorld()
  },
  getBoundingBox: function() {
    return this.getScene().getBoundingBox()
  },
  zoomIn: function(t) {
    this.editorManager.zoomIn(t, this)
  },
  zoomOut: function(t) {
    this.editorManager.zoomOut(t, this)
  },
  zoomAll: function(t, e) {
    var i = this.getScene().getBoundingBox();
    this.editorManager.zoomToBBox(this, i, t, e)
  },
  zoomToBuilding: function(t, e) {
    this.zoomAll(t, e)
  },
  zoomToSelection: function(t, e) {
    var i = this.renderer.computeSelectionBBox();
    (null == i || i.isEmpty()) && (i = this.getScene().getBoundingBox()),
    this.editorManager.zoomToBBox(this, i, t, e)
  },
  zoomToBBox: function(t, e, i) {
    t
      ? t.applyMatrix4(this.getScene().getMatrixGlobal())
      : t = this.getScene().getBoundingBox(),
    this.editorManager.zoomToBBox(this, t, e, i)
  },
  zoomToBBoxByDirection: function(t, e, i, n) {
    if (!e)
      return void this.zoomToBBox(t, i, n);
    if (e && t) {
      var o = t.clone(),
        r = o.getCenter().clone().add(e);
      o.applyMatrix4(this.getScene().getMatrixGlobal()),
      r.applyMatrix4(this.getScene().getMatrixGlobal());
      var a = r.clone().sub(o.getCenter());
      a.length() > 1e-4
        ? (a.normalize(), viewer.camera.realUp.copy(THREE.Object3D.DefaultUp), this.editorManager.zoomToBBox(this, o, i, n, a))
        : this.editorManager.zoomToBBox(this, o, i, n)
    }
  },
  zoomToBBoxWithOuterBox: function(t, e, i, n) {
    if (!e)
      return void this.zoomToBBox(t, i, n);
    if (e && t) {
      var o = t.clone(),
        r = e.getCenter();
      o.applyMatrix4(this.getScene().getMatrixGlobal()),
      r.applyMatrix4(this.getScene().getMatrixGlobal());
      var a = r.clone().sub(o.getCenter());
      a.length() > 1e-4
        ? (a.normalize(), this.camera.realUp.copy(THREE.Object3D.DefaultUp), this.editorManager.zoomToBBox(this, o, i, n, a))
        : this.editorManager.zoomToBBox(this, o, i, n)
    }
  },
  setStandardView: function(t, e, i) {
    this.editorManager.setStandardView(t, this, e, i)
  },
  setStandardViewWithBox: function(t, e, i, n) {
    e
      ? e.applyMatrix4(this.getScene().getMatrixGlobal())
      : e = this.getScene().getBoundingBox(),
    this.editorManager.setStandardViewWithBox(this, t, e, i, n)
  },
  setTopView: function(t, e, i) {
    this.setStandardViewWithBox(CLOUD.EnumStandardView.ISO, t, e, i)
  },
  setInitialViewType: function(t) {
    console.warn("CLOUD.Viewer.setInitialViewType() has been deprecated. Use CLOUD.Viewer.setInitialView() instead."),
    this.setInitialView(t)
  },
  setInitialView: function(t) {
    this.initialView = t
  },
  goToInitialView: function(t) {
    this.setStandardView(this.initialView, t, null)
  },
  setHomeViewType: function(t) {
    console.warn("CLOUD.Viewer.setHomeViewType() has been deprecated. Use CLOUD.Viewer.setHomeView() instead."),
    this.setHomeView(t)
  },
  setHomeView: function(t) {
    this.currentHomeView = t
  },
  goToHomeView: function(t) {
    this.setStandardView(this.currentHomeView, t, null)
  },
  lookAt: function(t, e, i) {
    var n = new THREE.Vector3;
    n.subVectors(e, t),
    this.camera.LookAt(e, n, i),
    this.cameraControl.updateCamera(e),
    this.render()
  },
  setImageResPath: function(t) {
    CLOUD.GlobalData.TextureResRoot = t
  },
  setLightIntensityFactor: function(t) {
    CLOUD.GlobalData.LightIntensityFactor = t
  },
  setLimitFrameTime: function(t) {
    CLOUD.GlobalData.IncrementRender && (t <= 0 && (t = 30), CLOUD.GlobalData.LimitFrameTime = t)
  },
  limitFrameRate: function(t) {
    CLOUD.GlobalData.IncrementRender && (t <= 0 && (t = 4), CLOUD.GlobalData.LimitFrameTime = 1e3 / t)
  },
  transformCamera: function(t) {
    return CLOUD.CameraUtil.transformCamera(t, this.modelManager.scene)
  },
  getCamera: function() {
    var t = this.getScene(),
      e = t.getMatrixGlobal(),
      i = this.cameraControl.getCamera(),
      n = new CLOUD.CameraInfo(i.position, i.target, i.up);
    n = CLOUD.Camera.drawingToWorld(n, e);
    var o = new CLOUD.CameraInfo(n.position, n.target, n.up);
    return JSON.stringify(o)
  },
  setCamera: function(t) {
    var e = CLOUD.CameraUtil.parseCameraInfo(t);
    if (e.version) {
      var i = this.getScene(),
        n = i.getMatrixGlobal();
      e = CLOUD.Camera.worldToDrawing(e, n)
    }
    this.lookAt(e.position, e.target, e.up)
  },
  getRenderBufferScreenShot: function(t, e) {
    var i = this.renderer.domElement,
      n = i.toDataURL("image/png"),
      o = i.width,
      r = i.height,
      a = window.devicePixelRatio || 1,
      s = o / a,
      l = r / a;
    if (!s || !l)
      return e
        ? (e(n), null)
        : n;
    var c,
      h,
      u = 0,
      d = 0;
    if (
      s > l || o / r < s / l
      ? (c = s, h = r / o * s, d = l / 2 - h / 2)
      : (h = l, c = o / r * l, u = s / 2 - c / 2),
    e) {
      var p = new Image;
      return p.onload = function() {
        var i = document.createElement("canvas"),
          n = i.getContext("2d");
        i.width = s,
        i.height = l,
        t && (n.fillStyle = t, n.fillRect(0, 0, s, l)),
        n.drawImage(p, u, d, c, h);
        var o = i.toDataURL("image/png");
        e(o)
      },
      p.src = n,
      null
    }
    var p = new Image;
    p.src = n;
    var f = document.createElement("canvas"),
      m = f.getContext("2d");
    return f.width = s,
    f.height = l,
    t && (m.fillStyle = t, m.fillRect(0, 0, s, l)),
    m.drawImage(p, u, d, c, h),
    f.toDataURL("image/png")
  },
  screenShot: function(t, e, i) {
    var n = this,
      o = function(t, e, i) {
        var o = n.renderer.domElement,
          r = o.toDataURL("image/png"),
          a = o.width,
          s = o.height,
          l = (window.devicePixelRatio, t),
          c = e;
        if (!l || !c)
          return i
            ? (i(r), null)
            : r;
        var h,
          u,
          d = 0,
          p = 0;
        if (
          l > c || a / s < l / c
          ? (h = l, u = s / a * l, p = c / 2 - u / 2)
          : (u = c, h = a / s * c, d = l / 2 - h / 2),
        i) {
          var f = new Image;
          return f.onload = function() {
            var t = document.createElement("canvas"),
              e = t.getContext("2d");
            t.width = l,
            t.height = c,
            e.drawImage(f, d, p, h, u);
            var n = t.toDataURL("image/png");
            i(n)
          },
          f.src = r,
          null
        }
      }(t, e, i);
    return this.render(),
    o
  },
  canvas2image: function(t, e) {
    var i,
      n = this;
    return e
      ? (this.getRenderBufferScreenShot(t, function(t) {
        e(t),
        n.render()
      }), null)
      : (i = this.getRenderBufferScreenShot(t), this.render(), i)
  },
  lockAxisZ: function(t) {
    this.cameraControl && this.cameraControl.lockAxisZ(t)
  },
  enableTranslucentByDClick: function(t) {
    CLOUD.GlobalData.EnableDemolishByDClick = t
  },
  disableRotate: function(t) {
    this.cameraControl && this.cameraControl.disableRotate(t)
  },
  rotateCamera: function(t) {
    this.cameraControl.processRotate(t)
  },
  getActiveCameraInfo: function() {
    var t = {};
    t.up = new THREE.Vector3,
    t.dir = new THREE.Vector3;
    var e = this.camera,
      i = e.getWorldDirection();
    return t.up.copy(e.realUp || e.up),
    t.dir.copy(i),
    t
  },
  calculationPlanes: function() {
    if (this.isRecalculationPlanes) {
      this.isRecalculationPlanes = !1;
      var t = this.getScene(),
        e = this.renderer.computeRenderObjectsBox();
      t.getClipPlanes().calculationPlanes(e.getSize(), e.getCenter()),
      this.render()
    }
  },
  recalculationPlanes: function() {
    this.isRecalculationPlanes = !0
  },
  setOctantDepth: function(t) {
    CLOUD.GlobalData.OctantDepth = t
  },
  resizePool: function(t) {
    CLOUD.GlobalData.maxObjectNumInPool = t,
    this.modelManager.updateModelRenderable()
  },
  setCategoriesToHighPriority: function(t, e) {
    var i = 0 == e
      ? "inner"
      : "outer";
    this.modelManager.setCategoriesToHighPriority(t, i)
  },
  clearCategoriesFromHighPriority: function(t) {
    var e = 0 == t
      ? "inner"
      : "outer";
    this.modelManager.clearCategoriesFromHighPriority(e)
  },
  clearAllCategoriesFromHighPriority: function() {
    this.modelManager.clearAllCategoriesFromHighPriority()
  },
  isolate: function(t, e) {
    var i = this.getFilters();
    switch (e) {
      case "hide":
        i.setIsolateConditions(t, CLOUD.EnumIsolateState.HIDDEN_OTHERS);
        break;
      case "translucent":
        i.setIsolateConditions(t, CLOUD.EnumIsolateState.TRANSLUCENT_OTHERS);
        break;
      default:
        console.log("no this isolate state : " + e)
    }
  },
  setIsolateMaterial: function(t) {
    this.getFilters().setIsolateMaterial(t)
  },
  resetIsolateMaterial: function() {
    this.getFilters().resetIsolateMaterial()
  },
  setOrbitButton: function(t) {
    "left" === t
      ? this.editorManager.updateButtons({ORBIT: THREE.MOUSE.LEFT, PAN2: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT})
      : "right" === t && this.editorManager.updateButtons({ORBIT: THREE.MOUSE.RIGHT, PAN2: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.LEFT})
  },
  showPickedInformation: function(t) {
    CLOUD.UIHelper.showPickedInformation(t)
  },
  setSelectPadCallback: function(t) {
    var e = this.editorManager.editors[CLOUD.EditorMode.PICK_BY_RECT];
    e && e.selectPad && (e.selectPad.callback = t)
  },
  setDeviceMobile: function(t) {
    CLOUD.GlobalData.IsMobile = t || !1
  },
  setPointRotateMode: function(t) {
    this.cameraControl && this.cameraControl.setPointRotateMode(t)
  },
  worldToDrawing: function(t) {
    if (!this.cameraControl)
      return console.log("camera is not initialized!!!"),
      null;
    var e = this.getScene(),
      i = e.worldToDrawing(t);
    return {x: i.x, y: i.y, z: i.z}
  },
  drawingToWorld: function(t) {
    if (!this.cameraControl)
      return console.log("camera is not initialized!!!"),
      null;
    var e = this.getScene(),
      i = e.drawingToWorld(t);
    return {x: i.x, y: i.y, z: i.z}
  },
  worldToCanvas: function(t) {
    var e = this.cameraControl;
    if (!e)
      return console.log("camera is not initialized!!!"),
      null;
    var i = e.getContainerDimensions();
    if (!i)
      return null;
    var n = e.getCamera(),
      o = this.getScene(),
      r = o.worldToDrawing(t);
    return CLOUD.CameraUtil.drawingToCanvas(n, r, i.width, i.height)
  },
  canvasToWorld: function(t) {
    var e = this.cameraControl;
    if (!e)
      return console.log("camera is not initialized!!!"),
      null;
    var i = e.getContainerDimensions();
    if (!i)
      return null;
    var n = e.getCamera(),
      o = this.getScene(),
      r = CLOUD.CameraUtil.canvasToDrawing(n, t, i.width, i.height),
      a = o.drawingToWorld(r);
    return {x: a.x, y: a.y, z: a.z}
  },
  worldToClient: function(t) {
    var e = this.cameraControl;
    if (!e)
      return console.log("camera is not initialized!!!"),
      null;
    var i = e.getContainerDimensions();
    if (!i)
      return null;
    var n = e.getCamera(),
      o = this.getScene(),
      r = o.worldToDrawing(t),
      a = CLOUD.CameraUtil.drawingToCanvas(n, r, i.width, i.height);
    return a
      ? (a.x += i.left, a.y += i.top, a)
      : null
  },
  clientToWorld: function(t) {
    var e = this.cameraControl;
    if (!e)
      return console.log("camera is not initialized!!!"),
      null;
    var i = e.getContainerDimensions();
    if (!i)
      return null;
    var n = {
      x: t.x,
      y: t.y,
      z: t.z
    };
    n.x -= i.left,
    n.y -= i.top;
    var o = e.getCamera(),
      r = this.getScene(),
      n = CLOUD.CameraUtil.canvasToDrawing(o, n, i.width, i.height),
      a = r.drawingToWorld(n);
    return {x: a.x, y: a.y, z: a.z}
  },
  insideCamera: function(t) {
    var e = this.cameraControl;
    if (!e)
      return console.log("camera is not initialized!!!"),
      !1;
    var i = this.getScene(),
      n = i.worldToDrawing(t);
    return e.getFrustum().containsPoint(n)
  },
  locateToPointWithParallelEye: function(t) {
    var e = this.cameraControl;
    if (!e)
      return console.log("camera is not initialized!!!"),
      !1;
    var i = this.getScene(),
      n = i.worldToDrawing(t);
    e.flyToPointWithParallelEye(n)
  },
  locateToPoint: function(t) {
    var e = this.cameraControl;
    if (!e)
      return console.log("camera is not initialized!!!"),
      !1;
    var i = this.getScene(),
      n = i.worldToDrawing(t);
    e.flyToPoint(n)
  },
  enableHover: function(t) {
    CLOUD.GlobalData.Hover = t
  },
  enableIBL: function(t) {
    CLOUD.GlobalData.IBL !== t && (
      CLOUD.GlobalData.IBL = t, this.modelManager.changeAllMaterials(t), t
      ? this.initIBLByIndex(this.getScene().IBLIndex)
      : this.removeCubeMap())
  },
  loadIBLcfg: function(t) {
    var e = this;
    (new THREE.FileLoader).load(t, function(t) {
      e.getScene().IBLcfg = JSON.parse(t),
      CLOUD.GlobalData.IBL && e.initIBLByIndex(0)
    })
  },
  initIBLByIndex: function(t) {
    if (CLOUD.GlobalData.IBL) {
      var e = this.getScene().IBLcfg;
      if (null != e) {
        var i = Object.keys(e);
        if (i.length > t) {
          var n = e[i[t]];
          this.loadIBLMaps(n.url, n.isHDR, n.uniforms),
          this.getScene().IBLIndex = t
        } else
          new Error("Index is out of range.")
      } else
        new Error("IBLConfig is not exist")
    }
  },
  loadIBLMaps: function(t, e, i) {
    function n() {
      for (var n = [
        "posx.hdr",
        "negx.hdr",
        "posy.hdr",
        "negy.hdr",
        "posz.hdr",
        "negz.hdr"
      ], a = [], s = 0; s < 6; ++s)
        a.push(t + "/EnvMap_" + n[s]);
      var l = e
        ? new THREE.HDRCubeTextureLoader
        : new THREE.CubeTextureLoader;
      l.load(THREE.FloatType, a, function(a) {
        r.iblProbe.environmentMap = a,
        o.environmentCubeMap = a,
        o.addCubeMap(e, i);
        for (var s = [], c = 0; c < 6; ++c)
          s.push(t + "/IrradianceMap_" + n[c]);
        l.load(THREE.FloatType, s, function(a) {
          r.iblProbe.irradianceMap.cubeTexture = a;
          for (var s = [], c = 0; c < 6; ++c)
            s.push(t + "/PrefilterMap_" + n[c]);
          l.load(THREE.FloatType, s, function(n) {
            r.iblProbe.prefilterMap.cubeTexture = n;
            var a = e
                ? new ImageBasedLighting.HDRTextureLoader
                : new THREE.TextureLoader,
              s = e
                ? t + "/brdf.hdr"
                : t + "/brdf.png";
            a.load(s, function(t) {
              r.iblProbe.brdfMap.texture = t,
              r.iblProbe.isComputed = !0,
              o.modelManager.updateMaterials();
              for (var e in i)
                o.modelManager.updateMaterialsValue(e, i[e]);
              o.render()
            })
          })
        })
      })
    }
    if (CLOUD.GlobalData.IBL) {
      var o = this,
        r = (this.renderer, this.getScene());
      null == r.iblProbe
        ? r.iblProbe = new ImageBasedLighting.IBLProbe(o.environmentCubeMap, "images/Hammersley.jpg", function(t) {
          r.iblProbe.isHDR = e,
          n()
        })
        : n()
    }
  },
  addCubeMap: function(t, e) {
    var t = t || this.isHDR;
    if (
      this.isHDR = t, null == this.cubeMesh
      ? this.cubeMesh = new THREE.Mesh(new THREE.BoxBufferGeometry(2e3, 2e3, 2e3), new THREE.ShaderMaterial({
        uniforms: {
          environmentMap: {
            value: this.environmentCubeMap
          },
          hdr: {
            value: t
          },
          shift: {
            value: .18
          },
          A: {
            value: .27
          },
          B: {
            value: .29
          },
          C: {
            value: .052
          },
          D: {
            value: .2
          },
          E: {
            value: 0
          },
          F: {
            value: .18
          },
          scale: {
            value: .897105
          }
        },
        vertexShader: ImageBasedLighting.cube_vs,
        fragmentShader: ImageBasedLighting.cube_fs,
        side: THREE.BackSide,
        depthTest: !0,
        depthWrite: !0,
        fog: !1
      }))
      : (this.cubeMesh.material.uniforms.environmentMap.value = this.environmentCubeMap, this.cubeMesh.material.uniforms.hdr.value = t),
    e) {
      var i = this.cubeMesh.material;
      for (var n in e)
        i.uniforms.hasOwnProperty(n) && (i.uniforms[n].value = e[n])
    }
    this.getScene().add(this.cubeMesh),
    this.render()
  },
  removeCubeMap: function() {
    null != this.cubeMesh && (this.getScene().remove(this.cubeMesh), this.render())
  },
  addPlane: function(t, e, i) {
    var n = new THREE.Vector3;
    n.addVectors(new THREE.Vector3(t.x, t.y, t.z), new THREE.Vector3(e.x, e.y, e.z)),
    n.multiplyScalar(.5);
    var o = new THREE.PlaneBufferGeometry(e.x - t.x, e.y - t.y),
      r = new THREE.Mesh(o, new THREE.MeshBasicMaterial({
        side: THREE.DoubleSide,
        transparent: !0,
        depthTest: !0
      }));
    return r.position.copy(n),
    r.renderOrder = 10,
    this.getScene().rootNode.add(r),
    r.updateMatrixWorld(!0),
    (new THREE.TextureLoader).load(i, function(t) {
      r.material.map = t,
      r.material.needsUpdate = !0
    }),
    r
  },
  removePlane: function(t) {
    this.getScene().rootNode.remove(t)
  },
  enableTextureMapping: function(t) {
    CLOUD.GlobalData.EnableTextureMapping = t
  },
  setReverseWheelDirection: function(t) {
    CLOUD.GlobalData.ReverseWheelDirection = !!t
  },
  getReverseWheelDirection: function() {
    return CLOUD.GlobalData.ReverseWheelDirection
  },
  setMovementSpeedRate: function(t) {
    void 0 !== t && (CLOUD.GlobalData.MovementSpeedRate = t)
  },
  getMovementSpeedRate: function() {
    return CLOUD.GlobalData.MovementSpeedRate
  },
  moveTo: function(t) {
    var e = this.editorManager.editor;
    e && e.moveTo(t)
  },
  enableOcclusionTranslucent: function(t) {
    CLOUD.GlobalData.OcclusionTranslucentEnabled = !!t
  },
  setOcclusionOpacity: function(t) {
    CLOUD.GlobalData.OcclusionOpacity = t
  },
  setOcclusionDistanceToCamera: function(t) {
    CLOUD.GlobalData.OcclusionDistanceToCamera = t
  },
  fitAndRotateBySelection: function() {
    this.cameraControl && this.cameraControl.fitAndRotateBySelection()
  },
  setRoamingWalkHeight: function(t, e) {
    this.cameraControl && this.cameraControl.setRoamingWalkHeight(t, e)
  },
  setRoamingWalkAbsoluteHeight: function(t) {
    this.cameraControl && this.cameraControl.setRoamingWalkAbsoluteHeight(t)
  },
  moveCameraToLocate: function(t) {
    this.cameraControl && this.cameraControl.locateToPointWithParallelEye(t)
  },
  pickByPointWithNormal: function(t, e) {
    var i = this.getScene(),
      n = this.cameraControl;
    if (n.enabled === !1)
      return !1;
    var o = new THREE.Vector2(t.x, t.y),
      r = n.getIntersectContext(o);
    n.intersector.pick(r, function(t) {
      if (!t)
        return void e(null);
      i.intersectToWorld(t),
      t.cx = o.x,
      t.cy = o.y;
      var a = [];
      a.push(t);
      var s = i.getMatrixGlobal(),
        l = t.face.normal.clone(),
        c = t.worldPosition.clone(),
        h = new THREE.Ray(c, l);
      h.applyMatrix4(s);
      var u = n.intersector.getIntersectByRay(r, h);
      u && (i.intersectToWorld(u), a.push(u)),
      e(a)
    })
  },
  convertAnnotationsToV3: function(t) {
    function e(t, e, i) {
      var n;
      n = "string" == typeof t
        ? JSON.parse(window.atob(t))
        : {
          position: {
            x: t.position.x,
            y: t.position.y,
            z: t.position.z
          },
          target: {
            x: t.target.x,
            y: t.target.y,
            z: t.target.z
          },
          up: {
            x: t.up.x,
            y: t.up.y,
            z: t.up.z
          }
        };
      var o = new THREE.Vector3(n.position.x, n.position.y, n.position.z),
        r = new THREE.Vector3(n.target.x, n.target.y, n.target.z),
        a = new THREE.Vector3(n.up.x, n.up.y, n.up.z),
        s = new CLOUD.CameraInfo(o, r, a);
      return s = CLOUD.Camera.drawingToWorld(s, e),
      s = new CLOUD.CameraInfo(s.position, s.target, s.up),
      s = CLOUD.Camera.worldToDrawing(s, i),
      n.position.x = s.position.x,
      n.position.y = s.position.y,
      n.position.z = s.position.z,
      n.target.x = s.target.x,
      n.target.y = s.target.y,
      n.target.z = s.target.z,
      n.up.x = s.up.x,
      n.up.y = s.up.y,
      n.up.z = s.up.z,
      "string" == typeof t && (n = window.btoa(JSON.stringify(n))),
      n
    }
    var i = JSON.parse(t);
    if (i.filter) {
      var n = JSON.parse(i.filter);
      if (n.filter || n.basicIds) {
        var o = this.getScene(),
          r = o.getTransformMatrixGlobal();
        (new THREE.Matrix4).getInverse(r);
        var a = o.getMatrixGlobal();
        (new THREE.Matrix4).getInverse(a);
        var s = this.getFilters().getFilterType(),
          l = {};
        l.state = {},
        n.filter
          ? (n.fileFilter && (l.state[s.FILE_HIDDEN] = n.fileFilter), n.selectionSet && (l.state[s.SELECTED] = n.selectionSet), n.filter.visibleIds && (l.state[s.VISIBLE] = n.filter.visibleIds), n.filter.invisibleIds && (l.state[s.HIDDEN] = n.filter.invisibleIds), n.filter.conditions && (l.state[s.CONDITION_HIDDEN_OTHERS] = n.filter.conditions), n.filter.filters && (l.state[s.USER_HIDDEN] = n.filter.filters), n.frozenSet && (l.state[s.FROZENFILTER] = n.frozenSet), n.isolateSet && (l.state[s.ISOLATE_HIDDEN_OTHERS] = n.isolateSet), n.overriderByIds && (l.state[s.OVERRIDEFILTER] = n.overriderByIds), n.overriderByData && (l.state[s.USER_OVERRIDE] = n.overriderByData), n.overriderCondition && (l.state[s.CONDITION_OVERRIDE] = n.overriderCondition), n.isolateCondition && (l.state[s.ISOLATE_CONDITION_HIDDEN_OTHERS] = n.isolateCondition), l.state.sceneState = n.overriderByScene)
          : n.basicIds && (n.basicIds[1] && (l.state[s.FILE_HIDDEN] = n.basicIds[1]), n.basicIds[2] && (l.state[s.SELECTED] = n.basicIds[2]), n.basicIds[3] && (l.state[s.VISIBLE] = n.basicIds[3]), n.basicIds[4] && (l.state[s.HIDDEN] = n.basicIds[4]), n.conditions[0] && (l.state[s.CONDITION_HIDDEN_OTHERS] = n.conditions[0]), n.userHiddenIds && (l.state[s.USER_HIDDEN] = n.userHiddenIds), n.frozenIds && (l.state[s.FROZENFILTER] = n.frozenIds), n.isolateIds && (l.state[s.ISOLATE_HIDDEN_OTHERS] = n.isolateIds), n.overrideByIds && (l.state[s.OVERRIDEFILTER] = n.overrideByIds), n.overrideByData && (l.state[s.USER_OVERRIDE] = n.overrideByData), n.conditions[2] && (l.state[s.CONDITION_OVERRIDE] = n.conditions[2]), n.isolateConditions && (n.isolateConditions[0] && (l.state[s.ISOLATE_CONDITION_HIDDEN] = n.isolateConditions[0]), n.isolateConditions[1] && (l.state[s.ISOLATE_CONDITION_HIDDEN_OTHERS] = n.isolateConditions[1]), n.isolateConditions[2] && (l.state[s.ISOLATE_CONDITION_TRANSLUCENT] = n.isolateConditions[2]), n.isolateConditions[3] && (l.state[s.ISOLATE_CONDITION_TRANSLUCENT_OTHERS] = n.isolateConditions[3])), l.state.sceneState = n.sceneState),
        n.camera
          ? l.camera = e(n.camera, r, a)
          : l.camera = e(i.camera, r, a),
        n = l,
        i.filter = JSON.stringify(n)
      }
    }
    return i
  },
  clearSelection: function() {
    this.modelManager.sceneState.clearSelection()
  },
  addToSelection: function(t) {
    this.modelManager.sceneState.addSelection(t)
  },
  removeFromSelection: function(t) {
    this.modelManager.sceneState.removeSelection(t)
  },
  setSelection: function(t) {
    this.modelManager.sceneState.setSelection(t)
  },
  getSelection: function() {
    return this.modelManager.sceneState.getSelection()
  },
  getNumOfElements: function() {
    return this.modelManager.getNumOfElements()
  },
  getNumOfRenderables: function() {
    return this.modelManager.getNumOfRenderables()
  },
  getNumOfTriangles: function() {
    return this.modelManager.getNumOfTriangles()
  },
  setWalkHeightLocked: function(t) {
    var e = this.getCurrentEditorMode();
    return !(!e || e.name !== CLOUD.EditorMode.WALK) && (e.setHeightLocked(t), !0)
  },
  setWalkLookMousePressed: function(t) {
    var e = this.getCurrentEditorMode();
    return !(!e || e.name !== CLOUD.EditorMode.WALK) && (e.setLookMousePressed(t), !0)
  },
  setWalkSpeedRate: function(t) {
    var e = this.getCurrentEditorMode();
    return !(!e || e.name !== CLOUD.EditorMode.WALK) && (e.setSpeedRate(t), !0)
  },
  setPickDisabled: function(t) {
    CLOUD.GlobalData.DisablePick = t
  }
},
CLOUD.Version2D = "20161009",
CLOUD.DomUtil = CLOUD.DomUtil || {
  splitStr: function(t) {
    return t.trim().split(/\s+/g)
  },
  getContainerOffsetToClient: function(t) {
    var e,
      i = function(t) {
        for (var e = 0, i = 0; t;)
          e += t.offsetTop,
          i += t.offsetLeft,
          t = t.offsetParent;
        var n = document.body,
          o = document.documentElement,
          r = window.pageYOffset || o.scrollTop || n.scrollTop,
          a = window.pageXOffset || o.scrollLeft || n.scrollLeft;
        return e -= r,
        i -= a, {
          top: e,
          left: i
        }
      },
      n = function(t) {
        var e = t.getBoundingClientRect(),
          i = document.body,
          n = document.documentElement,
          o = n.clientTop || i.clientTop,
          r = n.clientLeft || i.clientLeft,
          a = e.top - o,
          s = e.left - r;
        return {top: Math.round(a), left: Math.round(s)}
      };
    if (t != document) {
      var o = function(t) {
        return t.getBoundingClientRect
          ? n(t)
          : i(t)
      }(t);
      e = {
        width: t.offsetWidth,
        height: t.offsetHeight,
        left: o.left,
        top: o.top
      }
    } else
      e = {
        width: window.innerWidth,
        height: window.innerHeight,
        left: 0,
        top: 0
      };
    return e
  },
  setClassName: function(t, e) {
    var i = document.getElementById(t);
    i && (i.className = e)
  },
  addClassName: function(t, e) {
    var i,
      n,
      o,
      r,
      a,
      s = document.getElementById(t);
    if (s && (n = s, e && "string" == typeof e && (i = e.split(/\s+/), 1 === n.nodeType)))
      if (n.className || 1 !== i.length) {
        for (o = " " + n.className + " ", r = 0, a = i.length; r < a; ++r)
          o.indexOf(" " + i[r] + " ") < 0 && (o += i[0] + " ");
        n.className = String.trim(o)
      } else
        n.className = e
  },
  removeClassName: function(t, e) {
    var i,
      n,
      o,
      r,
      a,
      s = document.getElementById(t);
    if (s && (o = s, e && "string" == typeof e && (i = (e || "").split(/\s+/), 1 === o.nodeType && o.className))) {
      for (n = (" " + o.className + " ").replace(O, " "), r = 0, a = i.length; r < a; r++)
        for (; n.indexOf(" " + i[r] + " ") >= 0;)
          n = n.replace(" " + i[r] + " ", " ");
    o.className = e
        ? String.trim(n)
        : ""
    }
  },
  showOrHideElement: function(t, e) {
    var i = document.getElementById(t);
    i && (
      i.style.display = e
      ? ""
      : "none")
  },
  getStyleString: function(t) {
    var e = [];
    for (var i in t) {
      var n = t[i];
      e.push(i),
      e.push(":"),
      e.push(n),
      e.push("; ")
    }
    return e.join("")
  },
  cloneStyle: function(t) {
    var e = {};
    for (var i in t)
      e[i] = t[i];
    return e
  },
  removeStyleAttribute: function(t, e) {
    Array.isArray(e) || (e = [e]),
    e.forEach(function(e) {
      e in t && delete t[e]
    })
  },
  trimRight: function(t) {
    if (0 === t.length)
      return "";
    for (var e = t.length - 1, i = e; i >= 0; --i)
      if (" " !== t.charAt(i)) {
        e = i;
        break
      }
    return t.substr(0, e + 1)
  },
  trimLeft: function(t) {
    if (0 === t.length)
      return "";
    for (var e = 0, i = 0; i < t.length; ++i)
      if (" " !== t.charAt(i)) {
        e = i;
        break
      }
    return t.substr(e)
  },
  matchesSelector: function(t, e) {
    if (t.matches)
      return t.matches(e);
    if (t.matchesSelector)
      return t.matchesSelector(e);
    if (t.webkitMatchesSelector)
      return t.webkitMatchesSelector(e);
    if (t.msMatchesSelector)
      return t.msMatchesSelector(e);
    if (t.mozMatchesSelector)
      return t.mozMatchesSelector(e);
    if (t.oMatchesSelector)
      return t.oMatchesSelector(e);
    if (t.querySelectorAll) {
      for (var i = (t.document || t.ownerDocument).querySelectorAll(e), n = 0; i[n] && i[n] !== element;)
        n++;
      return !!i[n]
    }
    return !1
  },
  toTranslate3d: function(t, e) {
    return "translate3d(" + t + "px," + e + "px,0)"
  },
  setCursorStyle: function(t, e) {
    var i;
    switch (e) {
      case "n":
      case "s":
        i = "ns-resize";
        break;
      case "w":
      case "e":
        i = "ew-resize";
        break;
      case "ne":
      case "sw":
        i = "nesw-resize";
        break;
      case "nw":
      case "se":
        i = "nwse-resize"
    }
    t.style.cursor = i
  }
},
function(t) {
  if ("object" == (
    "undefined" == typeof exports
    ? "undefined"
    : _typeof(exports)) && "undefined" != typeof module)
    module.exports = t();
  else if ("function" == typeof define && define.amd)
    define([], t);
  else {
    var e;
    "undefined" != typeof window
      ? e = window
      : "undefined" != typeof global
        ? e = global
        : "undefined" != typeof self && (e = self),
    e.html2canvas = t()
  }
}(function() {
  var t;
  return function t(e, i, n) {
    function o(a, s) {
      if (!i[a]) {
        if (!e[a]) {
          var l = "function" == typeof require && require;
          if (!s && l)
            return l(a, !0);
          if (r)
            return r(a, !0);
          var c = new Error("Cannot find module '" + a + "'");
          throw c.code = "MODULE_NOT_FOUND",
          c
        }
        var h = i[a] = {
          exports: {}
        };
        e[a][0].call(h.exports, function(t) {
          var i = e[a][1][t];
          return o(i || t)
        }, h, h.exports, t, e, i, n)
      }
      return i[a].exports
    }
    for (var r = "function" == typeof require && require, a = 0; a < n.length; a++)
      o(n[a]);
    return o
  }({
    1: [
      function(e, i, n) {
        (function(e) {
          !function(o) {
            function r(t) {
              throw RangeError(I[t])
            }
            function a(t, e) {
              for (var i = t.length; i--;)
                t[i] = e(t[i]);
              return t
            }
            function s(t, e) {
              return a(t.split(A), e).join(".")
            }
            function l(t) {
              for (var e, i, n = [], o = 0, r = t.length; o < r;)
                e = t.charCodeAt(o++),
                e >= 55296 && e <= 56319 && o < r
                  ? (
                    i = t.charCodeAt(o++), 56320 == (64512 & i)
                    ? n.push(((1023 & e) << 10) + (1023 & i) + 65536)
                    : (n.push(e), o--))
                  : n.push(e);
              return n
            }
            function c(t) {
              return a(t, function(t) {
                var e = "";
                return t > 65535 && (t -= 65536, e += N(t >>> 10 & 1023 | 55296), t = 56320 | 1023 & t),
                e += N(t)
              }).join("")
            }
            function h(t) {
              return t - 48 < 10
                ? t - 22
                : t - 65 < 26
                  ? t - 65
                  : t - 97 < 26
                    ? t - 97
                    : C
            }
            function u(t, e) {
              return t + 22 + 75 * (t < 26) - ((0 != e) << 5)
            }
            function d(t, e, i) {
              var n = 0;
              for (
                t = i
                ? B(t / M)
                : t >> 1,
              t += B(t / e); t > P * _ >> 1; n += C)
                t = B(t / P);
              return B(n + (P + 1) * t / (t + L))
            }
            function p(t) {
              var e,
                i,
                n,
                o,
                a,
                s,
                l,
                u,
                p,
                f,
                m = [],
                g = t.length,
                v = 0,
                y = O,
                E = S;
              for (i = t.lastIndexOf(D), i < 0 && (i = 0), n = 0; n < i; ++n)
                t.charCodeAt(n) >= 128 && r("not-basic"),
                m.push(t.charCodeAt(n));
              for (
                o = i > 0
                ? i + 1
                : 0; o < g;) {
                for (
                  a = v, s = 1, l = C; o >= g && r("invalid-input"), u = h(t.charCodeAt(o++)), (u >= C || u > B((w - v) / s)) && r("overflow"), v += u * s, p = l <= E
                  ? T
                  : l >= E + _
                    ? _
                    : l - E,
                !(u < p); l += C)
                  f = C - p,
                  s > B(w / f) && r("overflow"),
                  s *= f;
                e = m.length + 1,
                E = d(v - a, e, 0 == a),
                B(v / e) > w - y && r("overflow"),
                y += B(v / e),
                v %= e,
                m.splice(v++, 0, y)
              }
              return c(m)
            }
            function f(t) {
              var e,
                i,
                n,
                o,
                a,
                s,
                c,
                h,
                p,
                f,
                m,
                g,
                v,
                y,
                E,
                x = [];
              for (t = l(t), g = t.length, e = O, i = 0, a = S, s = 0; s < g; ++s)
                (m = t[s]) < 128 && x.push(N(m));
              for (n = o = x.length, o && x.push(D); n < g;) {
                for (c = w, s = 0; s < g; ++s)
                  (m = t[s]) >= e && m < c && (c = m);
                for (v = n + 1, c - e > B((w - i) / v) && r("overflow"), i += (c - e) * v, e = c, s = 0; s < g; ++s)
                  if (m = t[s], m < e && ++i > w && r("overflow"), m == e) {
                    for (
                      h = i, p = C; f = p <= a
                      ? T
                      : p >= a + _
                        ? _
                        : p - a,
                    !(h < f); p += C)
                      E = h - f,
                      y = C - f,
                      x.push(N(u(f + E % y, 0))),
                      h = B(E / y);
                    x.push(N(u(h, 0))),
                    a = d(i, v, n == o),
                    i = 0,
                    ++n
                  }
                ++i,
                ++e
              }
              return x.join("")
            }
            function m(t) {
              return s(t, function(t) {
                return R.test(t)
                  ? p(t.slice(4).toLowerCase())
                  : t
              })
            }
            function g(t) {
              return s(t, function(t) {
                return U.test(t)
                  ? "xn--" + f(t)
                  : t
              })
            }
            var v = "object" == (
                void 0 === n
                ? "undefined"
                : _typeof(n)) && n,
              y = "object" == (
                void 0 === i
                ? "undefined"
                : _typeof(i)) && i && i.exports == v && i,
              E = "object" == (
                void 0 === e
                ? "undefined"
                : _typeof(e)) && e;
            E.global !== E && E.window !== E || (o = E);
            var x,
              b,
              w = 2147483647,
              C = 36,
              T = 1,
              _ = 26,
              L = 38,
              M = 700,
              S = 72,
              O = 128,
              D = "-",
              R = /^xn--/,
              U = /[^ -~]/,
              A = /\x2E|\u3002|\uFF0E|\uFF61/g,
              I = {
                overflow: "Overflow: input needs wider integers to process",
                "not-basic": "Illegal input >= 0x80 (not a basic code point)",
                "invalid-input": "Invalid input"
              },
              P = C - T,
              B = Math.floor,
              N = String.fromCharCode;
            if (x = {
              version: "1.2.4",
              ucs2: {
                decode: l,
                encode: c
              },
              decode: p,
              encode: f,
              toASCII: g,
              toUnicode: m
            }, "function" == typeof t && "object" == _typeof(t.amd) && t.amd)
              t("punycode", function() {
                return x
              });
            else if (v && !v.nodeType)
              if (y)
                y.exports = x;
              else
                for (b in x)
                  x.hasOwnProperty(b) && (v[b] = x[b]);
          else
              o.punycode = x
          }(this)
        }).call(
          this, "undefined" != typeof global
          ? global
          : "undefined" != typeof self
            ? self
            : "undefined" != typeof window
              ? window
              : {})
      }, {}
    ],
    2: [
      function(t, e, i) {
        function n(t, e, i) {
          !t.defaultView || e === t.defaultView.pageXOffset && i === t.defaultView.pageYOffset || t.defaultView.scrollTo(e, i)
        }
        function o(t, e) {
          try {
            e && (e.width = t.width, e.height = t.height, e.getContext("2d").putImageData(t.getContext("2d").getImageData(0, 0, t.width, t.height), 0, 0))
          } catch (e) {
            s("Unable to copy canvas content from", t, e)
          }
        }
        function r(t, e) {
          for (
            var i = 3 === t.nodeType
            ? document.createTextNode(t.nodeValue)
            : t.cloneNode(!1),
          n = t.firstChild; n;)
            e !== !0 && 1 === n.nodeType && "SCRIPT" === n.nodeName || i.appendChild(r(n, e)),
            n = n.nextSibling;
          return 1 === t.nodeType && (
            i._scrollTop = t.scrollTop, i._scrollLeft = t.scrollLeft, "CANVAS" === t.nodeName
            ? o(t, i)
            : "TEXTAREA" !== t.nodeName && "SELECT" !== t.nodeName || (i.value = t.value)),
          i
        }
        function a(t) {
          if (1 === t.nodeType) {
            t.scrollTop = t._scrollTop,
            t.scrollLeft = t._scrollLeft;
            for (var e = t.firstChild; e;)
              a(e),
              e = e.nextSibling
          }
        }
        var s = t("./log");
        e.exports = function(t, e, i, o, s, l, c) {
          var h = r(t.documentElement, s.javascriptEnabled),
            u = e.createElement("iframe");
          return u.className = "html2canvas-container",
          u.style.visibility = "hidden",
          u.style.position = "fixed",
          u.style.left = "-10000px",
          u.style.top = "0px",
          u.style.border = "0",
          u.width = i,
          u.height = o,
          u.scrolling = "no",
          e.body.appendChild(u),
          new Promise(function(e) {
            var i = u.contentWindow.document;
            u.contentWindow.onload = u.onload = function() {
              var t = setInterval(function() {
                i.body.childNodes.length > 0 && (a(i.documentElement), clearInterval(t), "view" === s.type && (u.contentWindow.scrollTo(l, c), !/(iPad|iPhone|iPod)/g.test(navigator.userAgent) || u.contentWindow.scrollY === c && u.contentWindow.scrollX === l || (i.documentElement.style.top = -c + "px", i.documentElement.style.left = -l + "px", i.documentElement.style.position = "absolute")), e(u))
              }, 50)
            },
            i.open(),
            i.write("<!DOCTYPE html><html></html>"),
            n(t, l, c),
            i.replaceChild(i.adoptNode(h), i.documentElement),
            i.close()
          })
        }
      }, {
        "./log": 13
      }
    ],
    3: [
      function(t, e, i) {
        function n(t) {
          this.r = 0,
          this.g = 0,
          this.b = 0,
          this.a = null;
          this.fromArray(t) || this.namedColor(t) || this.rgb(t) || this.rgba(t) || this.hex6(t) || this.hex3(t)
        }
        n.prototype.darken = function(t) {
          var e = 1 - t;
          return new n([
            Math.round(this.r * e),
            Math.round(this.g * e),
            Math.round(this.b * e),
            this.a
          ])
        },
        n.prototype.isTransparent = function() {
          return 0 === this.a
        },
        n.prototype.isBlack = function() {
          return 0 === this.r && 0 === this.g && 0 === this.b
        },
        n.prototype.fromArray = function(t) {
          return Array.isArray(t) && (this.r = Math.min(t[0], 255), this.g = Math.min(t[1], 255), this.b = Math.min(t[2], 255), t.length > 3 && (this.a = t[3])),
          Array.isArray(t)
        };
        n.prototype.hex3 = function(t) {
          var e = null;
          return null !== (e = t.match(/^#([a-f0-9]{3})$/i)) && (this.r = parseInt(e[1][0] + e[1][0], 16), this.g = parseInt(e[1][1] + e[1][1], 16), this.b = parseInt(e[1][2] + e[1][2], 16)),
          null !== e
        };
        n.prototype.hex6 = function(t) {
          var e = null;
          return null !== (e = t.match(/^#([a-f0-9]{6})$/i)) && (this.r = parseInt(e[1].substring(0, 2), 16), this.g = parseInt(e[1].substring(2, 4), 16), this.b = parseInt(e[1].substring(4, 6), 16)),
          null !== e
        };
        n.prototype.rgb = function(t) {
          var e = null;
          return null !== (e = t.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/)) && (this.r = Number(e[1]), this.g = Number(e[2]), this.b = Number(e[3])),
          null !== e
        };
        n.prototype.rgba = function(t) {
          var e = null;
          return null !== (e = t.match(/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?\.?\d+)\s*\)$/)) && (this.r = Number(e[1]), this.g = Number(e[2]), this.b = Number(e[3]), this.a = Number(e[4])),
          null !== e
        },
        n.prototype.toString = function() {
          return null !== this.a && 1 !== this.a
            ? "rgba(" + [this.r, this.g, this.b, this.a].join(",") + ")"
            : "rgb(" + [this.r, this.g, this.b].join(",") + ")"
        },
        n.prototype.namedColor = function(t) {
          t = t.toLowerCase();
          var e = o[t];
          if (e)
            this.r = e[0],
            this.g = e[1],
            this.b = e[2];
          else if ("transparent" === t)
            return this.r = this.g = this.b = this.a = 0,
            !0;
          return !!e
        },
        n.prototype.isColor = !0;
        var o = {
          aliceblue: [
            240, 248, 255
          ],
          antiquewhite: [
            250, 235, 215
          ],
          aqua: [
            0, 255, 255
          ],
          aquamarine: [
            127, 255, 212
          ],
          azure: [
            240, 255, 255
          ],
          beige: [
            245, 245, 220
          ],
          bisque: [
            255, 228, 196
          ],
          black: [
            0, 0, 0
          ],
          blanchedalmond: [
            255, 235, 205
          ],
          blue: [
            0, 0, 255
          ],
          blueviolet: [
            138, 43, 226
          ],
          brown: [
            165, 42, 42
          ],
          burlywood: [
            222, 184, 135
          ],
          cadetblue: [
            95, 158, 160
          ],
          chartreuse: [
            127, 255, 0
          ],
          chocolate: [
            210, 105, 30
          ],
          coral: [
            255, 127, 80
          ],
          cornflowerblue: [
            100, 149, 237
          ],
          cornsilk: [
            255, 248, 220
          ],
          crimson: [
            220, 20, 60
          ],
          cyan: [
            0, 255, 255
          ],
          darkblue: [
            0, 0, 139
          ],
          darkcyan: [
            0, 139, 139
          ],
          darkgoldenrod: [
            184, 134, 11
          ],
          darkgray: [
            169, 169, 169
          ],
          darkgreen: [
            0, 100, 0
          ],
          darkgrey: [
            169, 169, 169
          ],
          darkkhaki: [
            189, 183, 107
          ],
          darkmagenta: [
            139, 0, 139
          ],
          darkolivegreen: [
            85, 107, 47
          ],
          darkorange: [
            255, 140, 0
          ],
          darkorchid: [
            153, 50, 204
          ],
          darkred: [
            139, 0, 0
          ],
          darksalmon: [
            233, 150, 122
          ],
          darkseagreen: [
            143, 188, 143
          ],
          darkslateblue: [
            72, 61, 139
          ],
          darkslategray: [
            47, 79, 79
          ],
          darkslategrey: [
            47, 79, 79
          ],
          darkturquoise: [
            0, 206, 209
          ],
          darkviolet: [
            148, 0, 211
          ],
          deeppink: [
            255, 20, 147
          ],
          deepskyblue: [
            0, 191, 255
          ],
          dimgray: [
            105, 105, 105
          ],
          dimgrey: [
            105, 105, 105
          ],
          dodgerblue: [
            30, 144, 255
          ],
          firebrick: [
            178, 34, 34
          ],
          floralwhite: [
            255, 250, 240
          ],
          forestgreen: [
            34, 139, 34
          ],
          fuchsia: [
            255, 0, 255
          ],
          gainsboro: [
            220, 220, 220
          ],
          ghostwhite: [
            248, 248, 255
          ],
          gold: [
            255, 215, 0
          ],
          goldenrod: [
            218, 165, 32
          ],
          gray: [
            128, 128, 128
          ],
          green: [
            0, 128, 0
          ],
          greenyellow: [
            173, 255, 47
          ],
          grey: [
            128, 128, 128
          ],
          honeydew: [
            240, 255, 240
          ],
          hotpink: [
            255, 105, 180
          ],
          indianred: [
            205, 92, 92
          ],
          indigo: [
            75, 0, 130
          ],
          ivory: [
            255, 255, 240
          ],
          khaki: [
            240, 230, 140
          ],
          lavender: [
            230, 230, 250
          ],
          lavenderblush: [
            255, 240, 245
          ],
          lawngreen: [
            124, 252, 0
          ],
          lemonchiffon: [
            255, 250, 205
          ],
          lightblue: [
            173, 216, 230
          ],
          lightcoral: [
            240, 128, 128
          ],
          lightcyan: [
            224, 255, 255
          ],
          lightgoldenrodyellow: [
            250, 250, 210
          ],
          lightgray: [
            211, 211, 211
          ],
          lightgreen: [
            144, 238, 144
          ],
          lightgrey: [
            211, 211, 211
          ],
          lightpink: [
            255, 182, 193
          ],
          lightsalmon: [
            255, 160, 122
          ],
          lightseagreen: [
            32, 178, 170
          ],
          lightskyblue: [
            135, 206, 250
          ],
          lightslategray: [
            119, 136, 153
          ],
          lightslategrey: [
            119, 136, 153
          ],
          lightsteelblue: [
            176, 196, 222
          ],
          lightyellow: [
            255, 255, 224
          ],
          lime: [
            0, 255, 0
          ],
          limegreen: [
            50, 205, 50
          ],
          linen: [
            250, 240, 230
          ],
          magenta: [
            255, 0, 255
          ],
          maroon: [
            128, 0, 0
          ],
          mediumaquamarine: [
            102, 205, 170
          ],
          mediumblue: [
            0, 0, 205
          ],
          mediumorchid: [
            186, 85, 211
          ],
          mediumpurple: [
            147, 112, 219
          ],
          mediumseagreen: [
            60, 179, 113
          ],
          mediumslateblue: [
            123, 104, 238
          ],
          mediumspringgreen: [
            0, 250, 154
          ],
          mediumturquoise: [
            72, 209, 204
          ],
          mediumvioletred: [
            199, 21, 133
          ],
          midnightblue: [
            25, 25, 112
          ],
          mintcream: [
            245, 255, 250
          ],
          mistyrose: [
            255, 228, 225
          ],
          moccasin: [
            255, 228, 181
          ],
          navajowhite: [
            255, 222, 173
          ],
          navy: [
            0, 0, 128
          ],
          oldlace: [
            253, 245, 230
          ],
          olive: [
            128, 128, 0
          ],
          olivedrab: [
            107, 142, 35
          ],
          orange: [
            255, 165, 0
          ],
          orangered: [
            255, 69, 0
          ],
          orchid: [
            218, 112, 214
          ],
          palegoldenrod: [
            238, 232, 170
          ],
          palegreen: [
            152, 251, 152
          ],
          paleturquoise: [
            175, 238, 238
          ],
          palevioletred: [
            219, 112, 147
          ],
          papayawhip: [
            255, 239, 213
          ],
          peachpuff: [
            255, 218, 185
          ],
          peru: [
            205, 133, 63
          ],
          pink: [
            255, 192, 203
          ],
          plum: [
            221, 160, 221
          ],
          powderblue: [
            176, 224, 230
          ],
          purple: [
            128, 0, 128
          ],
          rebeccapurple: [
            102, 51, 153
          ],
          red: [
            255, 0, 0
          ],
          rosybrown: [
            188, 143, 143
          ],
          royalblue: [
            65, 105, 225
          ],
          saddlebrown: [
            139, 69, 19
          ],
          salmon: [
            250, 128, 114
          ],
          sandybrown: [
            244, 164, 96
          ],
          seagreen: [
            46, 139, 87
          ],
          seashell: [
            255, 245, 238
          ],
          sienna: [
            160, 82, 45
          ],
          silver: [
            192, 192, 192
          ],
          skyblue: [
            135, 206, 235
          ],
          slateblue: [
            106, 90, 205
          ],
          slategray: [
            112, 128, 144
          ],
          slategrey: [
            112, 128, 144
          ],
          snow: [
            255, 250, 250
          ],
          springgreen: [
            0, 255, 127
          ],
          steelblue: [
            70, 130, 180
          ],
          tan: [
            210, 180, 140
          ],
          teal: [
            0, 128, 128
          ],
          thistle: [
            216, 191, 216
          ],
          tomato: [
            255, 99, 71
          ],
          turquoise: [
            64, 224, 208
          ],
          violet: [
            238, 130, 238
          ],
          wheat: [
            245, 222, 179
          ],
          white: [
            255, 255, 255
          ],
          whitesmoke: [
            245, 245, 245
          ],
          yellow: [
            255, 255, 0
          ],
          yellowgreen: [154, 205, 50]
        };
        e.exports = n
      }, {}
    ],
    4: [
      function(e, i, n) {
        function o(t, e) {
          var i = C++;
          if (
            e = e || {}, e.logging && (v.options.logging = !0, v.options.start = Date.now()), e.async = void 0 === e.async || e.async, e.allowTaint = void 0 !== e.allowTaint && e.allowTaint, e.removeContainer = void 0 === e.removeContainer || e.removeContainer, e.javascriptEnabled = void 0 !== e.javascriptEnabled && e.javascriptEnabled, e.imageTimeout = void 0 === e.imageTimeout
            ? 1e4
            : e.imageTimeout,
          e.renderer = "function" == typeof e.renderer
            ? e.renderer
            : p,
          e.strict = !!e.strict,
          "string" == typeof t) {
            if ("string" != typeof e.proxy)
              return Promise.reject("Proxy must be used when rendering url");
            var n = null != e.width
                ? e.width
                : window.innerWidth,
              o = null != e.height
                ? e.height
                : window.innerHeight;
            return x(u(t), e.proxy, document, n, o, e).then(function(t) {
              return a(t.contentWindow.document.documentElement, t, e, n, o)
            })
          }
          var s = (
            void 0 === t
            ? [document.documentElement]
            : t.length
              ? t
              : [t])[0];
          return s.setAttribute(w + i, i),
          r(s.ownerDocument, e, s.ownerDocument.defaultView.innerWidth, s.ownerDocument.defaultView.innerHeight, i).then(function(t) {
            return "function" == typeof e.onrendered && (v("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"), e.onrendered(t)),
            t
          })
        }
        function r(t, e, i, n, o) {
          return E(t, t, i, n, e, t.defaultView.pageXOffset, t.defaultView.pageYOffset).then(function(r) {
            v("Document cloned");
            var s = w + o,
              l = "[" + s + "='" + o + "']";
            t.querySelector(l).removeAttribute(s);
            var c = r.contentWindow,
              h = c.document.querySelector(l);
            return (
              "function" == typeof e.onclone
              ? Promise.resolve(e.onclone(c.document))
              : Promise.resolve(!0)).then(function() {
              return a(h, r, e, i, n)
            })
          })
        }
        function a(t, e, i, n, o) {
          var r = e.contentWindow,
            a = new d(r.document),
            u = new f(i, a),
            p = b(t),
            g = "view" === i.type
              ? n
              : c(r.document),
            y = "view" === i.type
              ? o
              : h(r.document),
            E = new i.renderer(g, y, u, i, document);
          return new m(t, E, a, u, i).ready.then(function() {
            v("Finished rendering");
            var n;
            return n = "view" === i.type
              ? l(E.canvas, {
                width: E.canvas.width,
                height: E.canvas.height,
                top: 0,
                left: 0,
                x: 0,
                y: 0
              })
              : t === r.document.body || t === r.document.documentElement || null != i.canvas
                ? E.canvas
                : l(E.canvas, {
                  width: null != i.width
                    ? i.width
                    : p.width,
                  height: null != i.height
                    ? i.height
                    : p.height,
                  top: p.top,
                  left: p.left,
                  x: 0,
                  y: 0
                }),
            s(e, i),
            n
          })
        }
        function s(t, e) {
          e.removeContainer && (t.parentNode.removeChild(t), v("Cleaned up container"))
        }
        function l(t, e) {
          var i = document.createElement("canvas"),
            n = Math.min(t.width - 1, Math.max(0, e.left)),
            o = Math.min(t.width, Math.max(1, e.left + e.width)),
            r = Math.min(t.height - 1, Math.max(0, e.top)),
            a = Math.min(t.height, Math.max(1, e.top + e.height));
          i.width = e.width,
          i.height = e.height;
          var s = o - n,
            l = a - r;
          return v("Cropping canvas at:", "left:", e.left, "top:", e.top, "width:", s, "height:", l),
          v("Resulting crop with width", e.width, "and height", e.height, "with x", n, "and y", r),
          i.getContext("2d").drawImage(t, n, r, s, l, e.x, e.y, s, l),
          i
        }
        function c(t) {
          return Math.max(Math.max(t.body.scrollWidth, t.documentElement.scrollWidth), Math.max(t.body.offsetWidth, t.documentElement.offsetWidth), Math.max(t.body.clientWidth, t.documentElement.clientWidth))
        }
        function h(t) {
          return Math.max(Math.max(t.body.scrollHeight, t.documentElement.scrollHeight), Math.max(t.body.offsetHeight, t.documentElement.offsetHeight), Math.max(t.body.clientHeight, t.documentElement.clientHeight))
        }
        function u(t) {
          var e = document.createElement("a");
          return e.href = t,
          e.href = e.href,
          e
        }
        var d = e("./support"),
          p = e("./renderers/canvas"),
          f = e("./imageloader"),
          m = e("./nodeparser"),
          g = e("./nodecontainer"),
          v = e("./log"),
          y = e("./utils"),
          E = e("./clone"),
          x = e("./proxy").loadUrlDocument,
          b = y.getBounds,
          w = "data-html2canvas-node",
          C = 0;
        o.CanvasRenderer = p,
        o.NodeContainer = g,
        o.log = v,
        o.utils = y;
        var T = "undefined" == typeof document || "function" != typeof Object.create || "function" != typeof document.createElement("canvas").getContext
          ? function() {
            return Promise.reject("No canvas support")
          }
          : o;
        i.exports = T,
        "function" == typeof t && t.amd && t("html2canvas", [], function() {
          return T
        })
      }, {
        "./clone": 2,
        "./imageloader": 11,
        "./log": 13,
        "./nodecontainer": 14,
        "./nodeparser": 15,
        "./proxy": 16,
        "./renderers/canvas": 20,
        "./support": 22,
        "./utils": 26
      }
    ],
    5: [
      function(t, e, i) {
        function n(t) {
          if (this.src = t, o("DummyImageContainer for", t), !this.promise || !this.image) {
            o("Initiating DummyImageContainer"),
            n.prototype.image = new Image;
            var e = this.image;
            n.prototype.promise = new Promise(function(t, i) {
              e.onload = t,
              e.onerror = i,
              e.src = r(),
              e.complete === !0 && t(e)
            })
          }
        }
        var o = t("./log"),
          r = t("./utils").smallImage;
        e.exports = n
      }, {
        "./log": 13,
        "./utils": 26
      }
    ],
    6: [
      function(t, e, i) {
        function n(t, e) {
          var i,
            n,
            r = document.createElement("div"),
            a = document.createElement("img"),
            s = document.createElement("span");
          r.style.visibility = "hidden",
          r.style.fontFamily = t,
          r.style.fontSize = e,
          r.style.margin = 0,
          r.style.padding = 0,
          document.body.appendChild(r),
          a.src = o(),
          a.width = 1,
          a.height = 1,
          a.style.margin = 0,
          a.style.padding = 0,
          a.style.verticalAlign = "baseline",
          s.style.fontFamily = t,
          s.style.fontSize = e,
          s.style.margin = 0,
          s.style.padding = 0,
          s.appendChild(document.createTextNode("Hidden Text")),
          r.appendChild(s),
          r.appendChild(a),
          i = a.offsetTop - s.offsetTop + 1,
          r.removeChild(s),
          r.appendChild(document.createTextNode("Hidden Text")),
          r.style.lineHeight = "normal",
          a.style.verticalAlign = "super",
          n = a.offsetTop - r.offsetTop + 1,
          document.body.removeChild(r),
          this.baseline = i,
          this.lineWidth = 1,
          this.middle = n
        }
        var o = t("./utils").smallImage;
        e.exports = n
      }, {
        "./utils": 26
      }
    ],
    7: [
      function(t, e, i) {
        function n() {
          this.data = {}
        }
        var o = t("./font");
        n.prototype.getMetrics = function(t, e) {
          return void 0 === this.data[t + "-" + e] && (this.data[t + "-" + e] = new o(t, e)),
          this.data[t + "-" + e]
        },
        e.exports = n
      }, {
        "./font": 6
      }
    ],
    8: [
      function(t, e, i) {
        function n(e, i, n) {
          this.image = null,
          this.src = e;
          var o = this,
            a = r(e);
          this.promise = (
            i
            ? new Promise(function(t) {
              "about:blank" === e.contentWindow.document.URL || null == e.contentWindow.document.documentElement
                ? e.contentWindow.onload = e.onload = function() {
                  t(e)
                }
                : t(e)
            })
            : this.proxyLoad(n.proxy, a, n)).then(function(e) {
            return t("./core")(e.contentWindow.document.documentElement, {
              type: "view",
              width: e.width,
              height: e.height,
              proxy: n.proxy,
              javascriptEnabled: n.javascriptEnabled,
              removeContainer: n.removeContainer,
              allowTaint: n.allowTaint,
              imageTimeout: n.imageTimeout / 2
            })
          }).then(function(t) {
            return o.image = t
          })
        }
        var o = t("./utils"),
          r = o.getBounds,
          a = t("./proxy").loadUrlDocument;
        n.prototype.proxyLoad = function(t, e, i) {
          var n = this.src;
          return a(n.src, t, n.ownerDocument, e.width, e.height, i)
        },
        e.exports = n
      }, {
        "./core": 4,
        "./proxy": 16,
        "./utils": 26
      }
    ],
    9: [
      function(t, e, i) {
        function n(t) {
          this.src = t.value,
          this.colorStops = [],
          this.type = null,
          this.x0 = .5,
          this.y0 = .5,
          this.x1 = .5,
          this.y1 = .5,
          this.promise = Promise.resolve(!0)
        }
        n.TYPES = {
          LINEAR: 1,
          RADIAL: 2
        },
        n.REGEXP_COLORSTOP = /^\s*(rgba?\(\s*\d{1,3},\s*\d{1,3},\s*\d{1,3}(?:,\s*[0-9\.]+)?\s*\)|[a-z]{3,20}|#[a-f0-9]{3,6})(?:\s+(\d{1,3}(?:\.\d+)?)(%|px)?)?(?:\s|$)/i,
        e.exports = n
      }, {}
    ],
    10: [
      function(t, e, i) {
        function n(t, e) {
          this.src = t,
          this.image = new Image;
          var i = this;
          this.tainted = null,
          this.promise = new Promise(function(n, o) {
            i.image.onload = n,
            i.image.onerror = o,
            e && (i.image.crossOrigin = "anonymous"),
            i.image.src = t,
            i.image.complete === !0 && n(i.image)
          })
        }
        e.exports = n
      }, {}
    ],
    11: [
      function(t, e, i) {
        function n(t, e) {
          this.link = null,
          this.options = t,
          this.support = e,
          this.origin = this.getOrigin(window.location.href)
        }
        var o = t("./log"),
          r = t("./imagecontainer"),
          a = t("./dummyimagecontainer"),
          s = t("./proxyimagecontainer"),
          l = t("./framecontainer"),
          c = t("./svgcontainer"),
          h = t("./svgnodecontainer"),
          u = t("./lineargradientcontainer"),
          d = t("./webkitgradientcontainer"),
          p = t("./utils").bind;
        n.prototype.findImages = function(t) {
          var e = [];
          return t.reduce(function(t, e) {
            switch (e.node.nodeName) {
              case "IMG":
                return t.concat([
                  {
                    args: [e.node.src],
                    method: "url"
                  }
                ]);
              case "svg":
              case "IFRAME":
                return t.concat([
                  {
                    args: [e.node],
                    method: e.node.nodeName
                  }
                ])
            }
            return t
          }, []).forEach(this.addImage(e, this.loadImage), this),
          e
        },
        n.prototype.findBackgroundImage = function(t, e) {
          return e.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(t, this.loadImage), this),
          t
        },
        n.prototype.addImage = function(t, e) {
          return function(i) {
            i.args.forEach(function(n) {
              this.imageExists(t, n) || (t.splice(0, 0, e.call(this, i)), o(
                "Added image #" + t.length, "string" == typeof n
                ? n.substring(0, 100)
                : n))
            }, this)
          }
        },
        n.prototype.hasImageBackground = function(t) {
          return "none" !== t.method
        },
        n.prototype.loadImage = function(t) {
          if ("url" === t.method) {
            var e = t.args[0];
            return !this.isSVG(e) || this.support.svg || this.options.allowTaint
              ? e.match(/data:image\/.*;base64,/i)
                ? new r(e.replace(/url\(['"]{0,}|['"]{0,}\)$/gi, ""), !1)
                : this.isSameOrigin(e) || this.options.allowTaint === !0 || this.isSVG(e)
                  ? new r(e, !1)
                  : this.support.cors && !this.options.allowTaint && this.options.useCORS
                    ? new r(e, !0)
                    : this.options.proxy
                      ? new s(e, this.options.proxy)
                      : new a(e)
              : new c(e)
          }
          return "linear-gradient" === t.method
            ? new u(t)
            : "gradient" === t.method
              ? new d(t)
              : "svg" === t.method
                ? new h(t.args[0], this.support.svg)
                : "IFRAME" === t.method
                  ? new l(t.args[0], this.isSameOrigin(t.args[0].src), this.options)
                  : new a(t)
        },
        n.prototype.isSVG = function(t) {
          return "svg" === t.substring(t.length - 3).toLowerCase() || c.prototype.isInline(t)
        },
        n.prototype.imageExists = function(t, e) {
          return t.some(function(t) {
            return t.src === e
          })
        },
        n.prototype.isSameOrigin = function(t) {
          return this.getOrigin(t) === this.origin
        },
        n.prototype.getOrigin = function(t) {
          var e = this.link || (this.link = document.createElement("a"));
          return e.href = t,
          e.href = e.href,
          e.protocol + e.hostname + e.port
        },
        n.prototype.getPromise = function(t) {
          return this.timeout(t, this.options.imageTimeout).catch(function() {
            return new a(t.src).promise.then(function(e) {
              t.image = e
            })
          })
        },
        n.prototype.get = function(t) {
          var e = null;
          return this.images.some(function(i) {
            return (e = i).src === t
          })
            ? e
            : null
        },
        n.prototype.fetch = function(t) {
          return this.images = t.reduce(p(this.findBackgroundImage, this), this.findImages(t)),
          this.images.forEach(function(t, e) {
            t.promise.then(function() {
              o("Succesfully loaded image #" + (
              e + 1), t)
            }, function(i) {
              o("Failed loading image #" + (
              e + 1), t, i)
            })
          }),
          this.ready = Promise.all(this.images.map(this.getPromise, this)),
          o("Finished searching images"),
          this
        },
        n.prototype.timeout = function(t, e) {
          var i,
            n = Promise.race([
              t.promise,
              new Promise(function(n, r) {
                i = setTimeout(function() {
                  o("Timed out loading image", t),
                  r(t)
                }, e)
              })
            ]).then(function(t) {
              return clearTimeout(i),
              t
            });
          return n.catch(function() {
            clearTimeout(i)
          }),
          n
        },
        e.exports = n
      }, {
        "./dummyimagecontainer": 5,
        "./framecontainer": 8,
        "./imagecontainer": 10,
        "./lineargradientcontainer": 12,
        "./log": 13,
        "./proxyimagecontainer": 17,
        "./svgcontainer": 23,
        "./svgnodecontainer": 24,
        "./utils": 26,
        "./webkitgradientcontainer": 27
      }
    ],
    12: [
      function(t, e, i) {
        function n(t) {
          o.apply(this, arguments),
          this.type = o.TYPES.LINEAR;
          var e = n.REGEXP_DIRECTION.test(t.args[0]) || !o.REGEXP_COLORSTOP.test(t.args[0]);
          e
            ? t.args[0].split(/\s+/).reverse().forEach(function(t, e) {
              switch (t) {
                case "left":
                  this.x0 = 0,
                  this.x1 = 1;
                  break;
                case "top":
                  this.y0 = 0,
                  this.y1 = 1;
                  break;
                case "right":
                  this.x0 = 1,
                  this.x1 = 0;
                  break;
                case "bottom":
                  this.y0 = 1,
                  this.y1 = 0;
                  break;
                case "to":
                  var i = this.y0,
                    n = this.x0;
                  this.y0 = this.y1,
                  this.x0 = this.x1,
                  this.x1 = n,
                  this.y1 = i;
                  break;
                case "center":
                  break;
                default:
                  var o = .01 * parseFloat(t, 10);
                  if (isNaN(o))
                    break;

                  0 === e
                    ? (this.y0 = o, this.y1 = 1 - this.y0)
                    : (this.x0 = o, this.x1 = 1 - this.x0)
                }
            }, this)
            : (this.y0 = 0, this.y1 = 1),
          this.colorStops = t.args.slice(
            e
            ? 1
            : 0).map(function(t) {
            var e = t.match(o.REGEXP_COLORSTOP),
              i = + e[2],
              n = 0 === i
                ? "%"
                : e[3];
            return {
              color: new r(e[1]),
              stop: "%" === n
                ? i / 100
                : null
            }
          }),
          null === this.colorStops[0].stop && (this.colorStops[0].stop = 0),
          null === this.colorStops[this.colorStops.length - 1].stop && (this.colorStops[this.colorStops.length - 1].stop = 1),
          this.colorStops.forEach(function(t, e) {
            null === t.stop && this.colorStops.slice(e).some(function(i, n) {
              return null !== i.stop && (t.stop = (i.stop - this.colorStops[e - 1].stop) / (n + 1) + this.colorStops[e - 1].stop, !0)
            }, this)
          }, this)
        }
        var o = t("./gradientcontainer"),
          r = t("./color");
        n.prototype = Object.create(o.prototype),
        n.REGEXP_DIRECTION = /^\s*(?:to|left|right|top|bottom|center|\d{1,3}(?:\.\d+)?%?)(?:\s|$)/i,
        e.exports = n
      }, {
        "./color": 3,
        "./gradientcontainer": 9
      }
    ],
    13: [
      function(t, e, i) {
        var n = function t() {
          t.options.logging && window.console && window.console.log && Function.prototype.bind.call(window.console.log, window.console).apply(window.console, [
            Date.now() - t.options.start + "ms",
            "html2canvas:"
          ].concat([].slice.call(arguments, 0)))
        };
        n.options = {
          logging: !1
        },
        e.exports = n
      }, {}
    ],
    14: [
      function(t, e, i) {
        function n(t, e) {
          this.node = t,
          this.parent = e,
          this.stack = null,
          this.bounds = null,
          this.borders = null,
          this.clip = [],
          this.backgroundClip = [],
          this.offsetBounds = null,
          this.visible = null,
          this.computedStyles = null,
          this.colors = {},
          this.styles = {},
          this.backgroundImages = null,
          this.transformData = null,
          this.transformMatrix = null,
          this.isPseudoElement = !1,
          this.opacity = null
        }
        function o(t) {
          var e = t.options[t.selectedIndex || 0];
          return e
            ? e.text || ""
            : ""
        }
        function r(t) {
          if (t && "matrix" === t[1])
            return t[2].split(",").map(function(t) {
              return parseFloat(t.trim())
            });
          if (t && "matrix3d" === t[1]) {
            var e = t[2].split(",").map(function(t) {
              return parseFloat(t.trim())
            });
            return [
              e[0],
              e[1],
              e[4],
              e[5],
              e[12],
              e[13]
            ]
          }
        }
        function a(t) {
          return t.toString().indexOf("%") !== -1
        }
        function s(t) {
          return t.replace("px", "")
        }
        function l(t) {
          return parseFloat(t)
        }
        var c = t("./color"),
          h = t("./utils"),
          u = h.getBounds,
          d = h.parseBackgrounds,
          p = h.offsetBounds;
        n.prototype.cloneTo = function(t) {
          t.visible = this.visible,
          t.borders = this.borders,
          t.bounds = this.bounds,
          t.clip = this.clip,
          t.backgroundClip = this.backgroundClip,
          t.computedStyles = this.computedStyles,
          t.styles = this.styles,
          t.backgroundImages = this.backgroundImages,
          t.opacity = this.opacity
        },
        n.prototype.getOpacity = function() {
          return null === this.opacity
            ? this.opacity = this.cssFloat("opacity")
            : this.opacity
        },
        n.prototype.assignStack = function(t) {
          this.stack = t,
          t.children.push(this)
        },
        n.prototype.isElementVisible = function() {
          return this.node.nodeType === Node.TEXT_NODE
            ? this.parent.visible
            : "none" !== this.css("display") && "hidden" !== this.css("visibility") && !this.node.hasAttribute("data-html2canvas-ignore") && ("INPUT" !== this.node.nodeName || "hidden" !== this.node.getAttribute("type"))
        },
        n.prototype.css = function(t) {
          return this.computedStyles || (
            this.computedStyles = this.isPseudoElement
            ? this.parent.computedStyle(
              this.before
              ? ":before"
              : ":after")
            : this.computedStyle(null)),
          this.styles[t] || (this.styles[t] = this.computedStyles[t])
        },
        n.prototype.prefixedCss = function(t) {
          var e = [
              "webkit", "moz", "ms", "o"
            ],
            i = this.css(t);
          return void 0 === i && e.some(function(e) {
            return void 0 !== (i = this.css(e + t.substr(0, 1).toUpperCase() + t.substr(1)))
          }, this),
          void 0 === i
            ? null
            : i
        },
        n.prototype.computedStyle = function(t) {
          return this.node.ownerDocument.defaultView.getComputedStyle(this.node, t)
        },
        n.prototype.cssInt = function(t) {
          var e = parseInt(this.css(t), 10);
          return isNaN(e)
            ? 0
            : e
        },
        n.prototype.color = function(t) {
          return this.colors[t] || (this.colors[t] = new c(this.css(t)))
        },
        n.prototype.cssFloat = function(t) {
          var e = parseFloat(this.css(t));
          return isNaN(e)
            ? 0
            : e
        },
        n.prototype.fontWeight = function() {
          var t = this.css("fontWeight");
          switch (parseInt(t, 10)) {
            case 401:
              t = "bold";
              break;
            case 400:
              t = "normal"
          }
          return t
        },
        n.prototype.parseClip = function() {
          var t = this.css("clip").match(this.CLIP);
          return t
            ? {
              top: parseInt(t[1], 10),
              right: parseInt(t[2], 10),
              bottom: parseInt(t[3], 10),
              left: parseInt(t[4], 10)
            }
            : null
        },
        n.prototype.parseBackgroundImages = function() {
          return this.backgroundImages || (this.backgroundImages = d(this.css("backgroundImage")))
        },
        n.prototype.cssList = function(t, e) {
          var i = (this.css(t) || "").split(",");
          return i = i[e || 0] || i[0] || "auto",
          i = i.trim().split(" "),
          1 === i.length && (i = [
            i[0],
            a(i[0])
              ? "auto"
              : i[0]
          ]),
          i
        },
        n.prototype.parseBackgroundSize = function(t, e, i) {
          var n,
            o,
            r = this.cssList("backgroundSize", i);
          if (a(r[0]))
            n = t.width * parseFloat(r[0]) / 100;
          else {
            if (/contain|cover/.test(r[0])) {
              var s = t.width / t.height,
                l = e.width / e.height;
              return s < l ^ "contain" === r[0]
                ? {
                  width: t.height * l,
                  height: t.height
                }
                : {
                  width: t.width,
                  height: t.width / l
                }
            }
            n = parseInt(r[0], 10)
          }
          return o = "auto" === r[0] && "auto" === r[1]
            ? e.height
            : "auto" === r[1]
              ? n / e.width * e.height
              : a(r[1])
                ? t.height * parseFloat(r[1]) / 100
                : parseInt(r[1], 10),
          "auto" === r[0] && (n = o / e.height * e.width), {
            width: n,
            height: o
          }
        },
        n.prototype.parseBackgroundPosition = function(t, e, i, n) {
          var o,
            r,
            s = this.cssList("backgroundPosition", i);
          return o = a(s[0])
            ? (t.width - (n || e).width) * (parseFloat(s[0]) / 100)
            : parseInt(s[0], 10),
          r = "auto" === s[1]
            ? o / e.width * e.height
            : a(s[1])
              ? (t.height - (n || e).height) * parseFloat(s[1]) / 100
              : parseInt(s[1], 10),
          "auto" === s[0] && (o = r / e.height * e.width), {
            left: o,
            top: r
          }
        },
        n.prototype.parseBackgroundRepeat = function(t) {
          return this.cssList("backgroundRepeat", t)[0]
        },
        n.prototype.parseTextShadows = function() {
          var t = this.css("textShadow"),
            e = [];
          if (t && "none" !== t)
            for (var i = t.match(this.TEXT_SHADOW_PROPERTY), n = 0; i && n < i.length; n++) {
              var o = i[n].match(this.TEXT_SHADOW_VALUES);
              e.push({
                color: new c(o[0]),
                offsetX: o[1]
                  ? parseFloat(o[1].replace("px", ""))
                  : 0,
                offsetY: o[2]
                  ? parseFloat(o[2].replace("px", ""))
                  : 0,
                blur: o[3]
                  ? o[3].replace("px", "")
                  : 0
              })
            }
          return e
        },
        n.prototype.parseTransform = function() {
          if (!this.transformData)
            if (this.hasTransform()) {
              var t = this.parseBounds(),
                e = this.prefixedCss("transformOrigin").split(" ").map(s).map(l);
              e[0] += t.left,
              e[1] += t.top,
              this.transformData = {
                origin: e,
                matrix: this.parseTransformMatrix()
              }
            } else
              this.transformData = {
                origin: [
                  0, 0
                ],
                matrix: [
                  1,
                  0,
                  0,
                  1,
                  0,
                  0
                ]
              };
        return this.transformData
        },
        n.prototype.parseTransformMatrix = function() {
          if (!this.transformMatrix) {
            var t = this.prefixedCss("transform"),
              e = t
                ? r(t.match(this.MATRIX_PROPERTY))
                : null;
            this.transformMatrix = e || [
              1,
              0,
              0,
              1,
              0,
              0
            ]
          }
          return this.transformMatrix
        },
        n.prototype.parseBounds = function() {
          return this.bounds || (
            this.bounds = this.hasTransform()
            ? p(this.node)
            : u(this.node))
        },
        n.prototype.hasTransform = function() {
          return "1,0,0,1,0,0" !== this.parseTransformMatrix().join(",") || this.parent && this.parent.hasTransform()
        },
        n.prototype.getValue = function() {
          var t = this.node.value || "";
          return "SELECT" === this.node.tagName
            ? t = o(this.node)
            : "password" === this.node.type && (t = Array(t.length + 1).join("")),
          0 === t.length
            ? this.node.placeholder || ""
            : t
        },
        n.prototype.MATRIX_PROPERTY = /(matrix|matrix3d)\((.+)\)/,
        n.prototype.TEXT_SHADOW_PROPERTY = /((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,
        n.prototype.TEXT_SHADOW_VALUES = /(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,
        n.prototype.CLIP = /^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/,
        e.exports = n
      }, {
        "./color": 3,
        "./utils": 26
      }
    ],
    15: [
      function(t, e, i) {
        function n(t, e, i, n, o) {
          F("Starting NodeParser"),
          this.renderer = e,
          this.options = o,
          this.range = null,
          this.support = i,
          this.renderQueue = [],
          this.stack = new X(!0, 1, t.ownerDocument, null);
          var r = new V(t, null);
          if (o.background && e.rectangle(0, 0, e.width, e.height, new j(o.background)), t === t.ownerDocument.documentElement) {
            var a = new V(
              r.color("backgroundColor").isTransparent()
              ? t.ownerDocument.body
              : t.ownerDocument.documentElement,
            null);
            e.rectangle(0, 0, e.width, e.height, a.color("backgroundColor"))
          }
          r.visibile = r.isElementVisible(),
          this.createPseudoHideStyles(t.ownerDocument),
          this.disableAnimations(t.ownerDocument),
          this.nodes = P([r].concat(this.getChildren(r)).filter(function(t) {
            return t.visible = t.isElementVisible()
          }).map(this.getPseudoElements, this)),
          this.fontMetrics = new W,
          F("Fetched nodes, total:", this.nodes.length),
          F("Calculate overflow clips"),
          this.calculateOverflowClips(),
          F("Start fetching images"),
          this.images = n.fetch(this.nodes.filter(M)),
          this.ready = this.images.ready.then(Z(function() {
            return F("Images loaded, starting parsing"),
            F("Creating stacking contexts"),
            this.createStackingContexts(),
            F("Sorting stacking contexts"),
            this.sortStackingContexts(this.stack),
            this.parse(this.stack),
            F("Render queue created with " + this.renderQueue.length + " items"),
            new Promise(Z(function(t) {
              o.async
                ? "function" == typeof o.async
                  ? o.async.call(this, this.renderQueue, t)
                  : this.renderQueue.length > 0
                    ? (this.renderIndex = 0, this.asyncRenderer(this.renderQueue, t))
                    : t()
                : (this.renderQueue.forEach(this.paint, this), t())
            }, this))
          }, this))
        }
        function o(t) {
          return t.parent && t.parent.clip.length
        }
        function r(t) {
          return t.replace(/(\-[a-z])/g, function(t) {
            return t.toUpperCase().replace("-", "")
          })
        }
        function a() {}
        function s(t, e, i, n) {
          return t.map(function(o, r) {
            if (o.width > 0) {
              var a = e.left,
                s = e.top,
                l = e.width,
                c = e.height - t[2].width;
              switch (r) {
                case 0:
                  c = t[0].width,
                  o.args = u({
                    c1: [
                      a, s
                    ],
                    c2: [
                      a + l,
                      s
                    ],
                    c3: [
                      a + l - t[1].width,
                      s + c
                    ],
                    c4: [
                      a + t[3].width,
                      s + c
                    ]
                  }, n[0], n[1], i.topLeftOuter, i.topLeftInner, i.topRightOuter, i.topRightInner);
                  break;
                case 1:
                  a = e.left + e.width - t[1].width,
                  l = t[1].width,
                  o.args = u({
                    c1: [
                      a + l,
                      s
                    ],
                    c2: [
                      a + l,
                      s + c + t[2].width
                    ],
                    c3: [
                      a, s + c
                    ],
                    c4: [
                      a, s + t[0].width
                    ]
                  }, n[1], n[2], i.topRightOuter, i.topRightInner, i.bottomRightOuter, i.bottomRightInner);
                  break;
                case 2:
                  s = s + e.height - t[2].width,
                  c = t[2].width,
                  o.args = u({
                    c1: [
                      a + l,
                      s + c
                    ],
                    c2: [
                      a, s + c
                    ],
                    c3: [
                      a + t[3].width,
                      s
                    ],
                    c4: [
                      a + l - t[3].width,
                      s
                    ]
                  }, n[2], n[3], i.bottomRightOuter, i.bottomRightInner, i.bottomLeftOuter, i.bottomLeftInner);
                  break;
                case 3:
                  l = t[3].width,
                  o.args = u({
                    c1: [
                      a, s + c + t[2].width
                    ],
                    c2: [
                      a, s
                    ],
                    c3: [
                      a + l,
                      s + t[0].width
                    ],
                    c4: [
                      a + l,
                      s + c
                    ]
                  }, n[3], n[0], i.bottomLeftOuter, i.bottomLeftInner, i.topLeftOuter, i.topLeftInner)
              }
            }
            return o
          })
        }
        function l(t, e, i, n) {
          var o = (Math.sqrt(2) - 1) / 3 * 4,
            r = i * o,
            a = n * o,
            s = t + i,
            l = e + n;
          return {
            topLeft: h({
              x: t,
              y: l
            }, {
              x: t,
              y: l - a
            }, {
              x: s - r,
              y: e
            }, {
              x: s,
              y: e
            }),
            topRight: h({
              x: t,
              y: e
            }, {
              x: t + r,
              y: e
            }, {
              x: s,
              y: l - a
            }, {
              x: s,
              y: l
            }),
            bottomRight: h({
              x: s,
              y: e
            }, {
              x: s,
              y: e + a
            }, {
              x: t + r,
              y: l
            }, {
              x: t,
              y: l
            }),
            bottomLeft: h({
              x: s,
              y: l
            }, {
              x: s - r,
              y: l
            }, {
              x: t,
              y: e + a
            }, {
              x: t,
              y: e
            })
          }
        }
        function c(t, e, i) {
          var n = t.left,
            o = t.top,
            r = t.width,
            a = t.height,
            s = e[0][0] < r / 2
              ? e[0][0]
              : r / 2,
            c = e[0][1] < a / 2
              ? e[0][1]
              : a / 2,
            h = e[1][0] < r / 2
              ? e[1][0]
              : r / 2,
            u = e[1][1] < a / 2
              ? e[1][1]
              : a / 2,
            d = e[2][0] < r / 2
              ? e[2][0]
              : r / 2,
            p = e[2][1] < a / 2
              ? e[2][1]
              : a / 2,
            f = e[3][0] < r / 2
              ? e[3][0]
              : r / 2,
            m = e[3][1] < a / 2
              ? e[3][1]
              : a / 2,
            g = r - h,
            v = a - p,
            y = r - d,
            E = a - m;
          return {
            topLeftOuter: l(n, o, s, c).topLeft.subdivide(.5),
            topLeftInner: l(n + i[3].width, o + i[0].width, Math.max(0, s - i[3].width), Math.max(0, c - i[0].width)).topLeft.subdivide(.5),
            topRightOuter: l(n + g, o, h, u).topRight.subdivide(.5),
            topRightInner: l(
              n + Math.min(g, r + i[3].width), o + i[0].width, g > r + i[3].width
              ? 0
              : h - i[3].width,
            u - i[0].width).topRight.subdivide(.5),
            bottomRightOuter: l(n + y, o + v, d, p).bottomRight.subdivide(.5),
            bottomRightInner: l(n + Math.min(y, r - i[3].width), o + Math.min(v, a + i[0].width), Math.max(0, d - i[1].width), p - i[2].width).bottomRight.subdivide(.5),
            bottomLeftOuter: l(n, o + E, f, m).bottomLeft.subdivide(.5),
            bottomLeftInner: l(n + i[3].width, o + E, Math.max(0, f - i[3].width), m - i[2].width).bottomLeft.subdivide(.5)
          }
        }
        function h(t, e, i, n) {
          var o = function(t, e, i) {
            return {
              x: t.x + (e.x - t.x) * i,
              y: t.y + (e.y - t.y) * i
            }
          };
          return {
            start: t,
            startControl: e,
            endControl: i,
            end: n,
            subdivide: function(r) {
              var a = o(t, e, r),
                s = o(e, i, r),
                l = o(i, n, r),
                c = o(a, s, r),
                u = o(s, l, r),
                d = o(c, u, r);
              return [
                h(t, a, c, d),
                h(d, u, l, n)
              ]
            },
            curveTo: function(t) {
              t.push([
                "bezierCurve",
                e.x,
                e.y,
                i.x,
                i.y,
                n.x,
                n.y
              ])
            },
            curveToReversed: function(n) {
              n.push([
                "bezierCurve",
                i.x,
                i.y,
                e.x,
                e.y,
                t.x,
                t.y
              ])
            }
          }
        }
        function u(t, e, i, n, o, r, a) {
          var s = [];
          return e[0] > 0 || e[1] > 0
            ? (s.push([
              "line", n[1].start.x,
              n[1].start.y
            ]), n[1].curveTo(s))
            : s.push([
              "line", t.c1[0], t.c1[1]
            ]),
          i[0] > 0 || i[1] > 0
            ? (s.push([
              "line", r[0].start.x,
              r[0].start.y
            ]), r[0].curveTo(s), s.push([
              "line", a[0].end.x,
              a[0].end.y
            ]), a[0].curveToReversed(s))
            : (s.push([
              "line", t.c2[0], t.c2[1]
            ]), s.push([
              "line", t.c3[0], t.c3[1]
            ])),
          e[0] > 0 || e[1] > 0
            ? (s.push([
              "line", o[1].end.x,
              o[1].end.y
            ]), o[1].curveToReversed(s))
            : s.push([
              "line", t.c4[0], t.c4[1]
            ]),
          s
        }
        function d(t, e, i, n, o, r, a) {
          e[0] > 0 || e[1] > 0
            ? (t.push([
              "line", n[0].start.x,
              n[0].start.y
            ]), n[0].curveTo(t), n[1].curveTo(t))
            : t.push(["line", r, a]),
          (i[0] > 0 || i[1] > 0) && t.push([
            "line", o[0].start.x,
            o[0].start.y
          ])
        }
        function p(t) {
          return t.cssInt("zIndex") < 0
        }
        function f(t) {
          return t.cssInt("zIndex") > 0
        }
        function m(t) {
          return 0 === t.cssInt("zIndex")
        }
        function g(t) {
          return ["inline", "inline-block", "inline-table"].indexOf(t.css("display")) !== -1
        }
        function v(t) {
          return t instanceof X
        }
        function y(t) {
          return t.node.data.trim().length > 0
        }
        function E(t) {
          return /^(normal|none|0px)$/.test(t.parent.css("letterSpacing"))
        }
        function x(t) {
          return ["TopLeft", "TopRight", "BottomRight", "BottomLeft"].map(function(e) {
            var i = t.css("border" + e + "Radius"),
              n = i.split(" ");
            return n.length <= 1 && (n[1] = n[0]),
            n.map(U)
          })
        }
        function b(t) {
          return t.nodeType === Node.TEXT_NODE || t.nodeType === Node.ELEMENT_NODE
        }
        function w(t) {
          var e = t.css("position");
          return "auto" !== (
            ["absolute", "relative", "fixed"].indexOf(e) !== -1
            ? t.css("zIndex")
            : "auto")
        }
        function C(t) {
          return "static" !== t.css("position")
        }
        function T(t) {
          return "none" !== t.css("float")
        }
        function _(t) {
          return ["inline-block", "inline-table"].indexOf(t.css("display")) !== -1
        }
        function L(t) {
          var e = this;
          return function() {
            return !t.apply(e, arguments)
          }
        }
        function M(t) {
          return t.node.nodeType === Node.ELEMENT_NODE
        }
        function S(t) {
          return t.isPseudoElement === !0
        }
        function O(t) {
          return t.node.nodeType === Node.TEXT_NODE
        }
        function D(t) {
          return function(e, i) {
            return e.cssInt("zIndex") + t.indexOf(e) / t.length - (i.cssInt("zIndex") + t.indexOf(i) / t.length)
          }
        }
        function R(t) {
          return t.getOpacity() < 1
        }
        function U(t) {
          return parseInt(t, 10)
        }
        function A(t) {
          return t.width
        }
        function I(t) {
          return t.node.nodeType !== Node.ELEMENT_NODE || [
            "SCRIPT",
            "HEAD",
            "TITLE",
            "OBJECT",
            "BR",
            "OPTION"
          ].indexOf(t.node.nodeName) === -1
        }
        function P(t) {
          return [].concat.apply([], t)
        }
        function B(t) {
          var e = t.substr(0, 1);
          return e === t.substr(t.length - 1) && e.match(/'|"/)
            ? t.substr(1, t.length - 2)
            : t
        }
        function N(t) {
          for (var e, i = [], n = 0, o = !1; t.length;)
            k(t[n]) === o
              ? (e = t.splice(0, n), e.length && i.push(G.ucs2.encode(e)), o = !o, n = 0)
              : n++,
            n >= t.length && (e = t.splice(0, n), e.length && i.push(G.ucs2.encode(e)));
          return i
        }
        function k(t) {
          return [32, 13, 10, 9, 45].indexOf(t) !== -1
        }
        function H(t) {
          return /[^\u0000-\u00ff]/.test(t)
        }
        var F = t("./log"),
          G = t("punycode"),
          V = t("./nodecontainer"),
          z = t("./textcontainer"),
          q = t("./pseudoelementcontainer"),
          W = t("./fontmetrics"),
          j = t("./color"),
          X = t("./stackingcontext"),
          Y = t("./utils"),
          Z = Y.bind,
          K = Y.getBounds,
          Q = Y.parseBackgrounds,
          J = Y.offsetBounds;
        n.prototype.calculateOverflowClips = function() {
          this.nodes.forEach(function(t) {
            if (M(t)) {
              S(t) && t.appendToDOM(),
              t.borders = this.parseBorders(t);
              var e = "hidden" === t.css("overflow")
                  ? [t.borders.clip]
                  : [],
                i = t.parseClip();
              i && ["absolute", "fixed"].indexOf(t.css("position")) !== -1 && e.push([
                [
                  "rect", t.bounds.left + i.left,
                  t.bounds.top + i.top,
                  i.right - i.left,
                  i.bottom - i.top
                ]
              ]),
              t.clip = o(t)
                ? t.parent.clip.concat(e)
                : e,
              t.backgroundClip = "hidden" !== t.css("overflow")
                ? t.clip.concat([t.borders.clip])
                : t.clip,
              S(t) && t.cleanDOM()
            } else
              O(t) && (
                t.clip = o(t)
                ? t.parent.clip
                : []);
            S(t) || (t.bounds = null)
          }, this)
        },
        n.prototype.asyncRenderer = function(t, e, i) {
          i = i || Date.now(),
          this.paint(t[this.renderIndex++]),
          t.length === this.renderIndex
            ? e()
            : i + 20 > Date.now()
              ? this.asyncRenderer(t, e, i)
              : setTimeout(Z(function() {
                this.asyncRenderer(t, e)
              }, this), 0)
        },
        n.prototype.createPseudoHideStyles = function(t) {
          this.createStyles(t, "." + q.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + ':before { content: "" !important; display: none !important; }.' + q.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER + ':after { content: "" !important; display: none !important; }')
        },
        n.prototype.disableAnimations = function(t) {
          this.createStyles(t, "* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")
        },
        n.prototype.createStyles = function(t, e) {
          var i = t.createElement("style");
          i.innerHTML = e,
          t.body.appendChild(i)
        },
        n.prototype.getPseudoElements = function(t) {
          var e = [
            [t]
          ];
          if (t.node.nodeType === Node.ELEMENT_NODE) {
            var i = this.getPseudoElement(t, ":before"),
              n = this.getPseudoElement(t, ":after");
            i && e.push(i),
            n && e.push(n)
          }
          return P(e)
        },
        n.prototype.getPseudoElement = function(t, e) {
          var i = t.computedStyle(e);
          if (!i || !i.content || "none" === i.content || "-moz-alt-content" === i.content || "none" === i.display)
            return null;
          for (var n = B(i.content), o = "url" === n.substr(0, 3), a = document.createElement(
            o
            ? "img"
            : "html2canvaspseudoelement"), s = new q(a, t, e), l = i.length - 1; l >= 0; l--) {
            var c = r(i.item(l));
            a.style[c] = i[c]
          }
          if (a.className = q.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + " " + q.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER, o)
            return a.src = Q(n)[0].args[0],
            [s];
          var h = document.createTextNode(n);
          return a.appendChild(h),
          [
            s,
            new z(h, s)
          ]
        },
        n.prototype.getChildren = function(t) {
          return P([].filter.call(t.node.childNodes, b).map(function(e) {
            var i = [
              e.nodeType === Node.TEXT_NODE
                ? new z(e, t)
                : new V(e, t)
            ].filter(I);
            return e.nodeType === Node.ELEMENT_NODE && i.length && "TEXTAREA" !== e.tagName
              ? i[0].isElementVisible()
                ? i.concat(this.getChildren(i[0]))
                : []
              : i
          }, this))
        },
        n.prototype.newStackingContext = function(t, e) {
          var i = new X(e, t.getOpacity(), t.node, t.parent);
          t.cloneTo(i),
          (
            e
            ? i.getParentStack(this)
            : i.parent.stack).contexts.push(i),
          t.stack = i
        },
        n.prototype.createStackingContexts = function() {
          this.nodes.forEach(function(t) {
            M(t) && (this.isRootElement(t) || R(t) || w(t) || this.isBodyWithTransparentRoot(t) || t.hasTransform())
              ? this.newStackingContext(t, !0)
              : M(t) && (C(t) && m(t) || _(t) || T(t))
                ? this.newStackingContext(t, !1)
                : t.assignStack(t.parent.stack)
          }, this)
        },
        n.prototype.isBodyWithTransparentRoot = function(t) {
          return "BODY" === t.node.nodeName && t.parent.color("backgroundColor").isTransparent()
        },
        n.prototype.isRootElement = function(t) {
          return null === t.parent
        },
        n.prototype.sortStackingContexts = function(t) {
          t.contexts.sort(D(t.contexts.slice(0))),
          t.contexts.forEach(this.sortStackingContexts, this)
        },
        n.prototype.parseTextBounds = function(t) {
          return function(e, i, n) {
            if ("none" !== t.parent.css("textDecoration").substr(0, 4) || 0 !== e.trim().length) {
              if (this.support.rangeBounds && !t.parent.hasTransform()) {
                var o = n.slice(0, i).join("").length;
                return this.getRangeBounds(t.node, o, e.length)
              }
              if (t.node && "string" == typeof t.node.data) {
                var r = t.node.splitText(e.length),
                  a = this.getWrapperBounds(t.node, t.parent.hasTransform());
                return t.node = r,
                a
              }
            } else
              this.support.rangeBounds && !t.parent.hasTransform() || (t.node = t.node.splitText(e.length));
            return {}
          }
        },
        n.prototype.getWrapperBounds = function(t, e) {
          var i = t.ownerDocument.createElement("html2canvaswrapper"),
            n = t.parentNode,
            o = t.cloneNode(!0);
          i.appendChild(t.cloneNode(!0)),
          n.replaceChild(i, t);
          var r = e
            ? J(i)
            : K(i);
          return n.replaceChild(o, i),
          r
        },
        n.prototype.getRangeBounds = function(t, e, i) {
          var n = this.range || (this.range = t.ownerDocument.createRange());
          return n.setStart(t, e),
          n.setEnd(t, e + i),
          n.getBoundingClientRect()
        },
        n.prototype.parse = function(t) {
          var e = t.contexts.filter(p),
            i = t.children.filter(M),
            n = i.filter(L(T)),
            o = n.filter(L(C)).filter(L(g)),
            r = i.filter(L(C)).filter(T),
            s = n.filter(L(C)).filter(g),
            l = t.contexts.concat(n.filter(C)).filter(m),
            c = t.children.filter(O).filter(y),
            h = t.contexts.filter(f);
          e.concat(o).concat(r).concat(s).concat(l).concat(c).concat(h).forEach(function(t) {
            this.renderQueue.push(t),
            v(t) && (this.parse(t), this.renderQueue.push(new a))
          }, this)
        },
        n.prototype.paint = function(t) {
          try {
            t instanceof a
              ? this.renderer.ctx.restore()
              : O(t)
                ? (S(t.parent) && t.parent.appendToDOM(), this.paintText(t), S(t.parent) && t.parent.cleanDOM())
                : this.paintNode(t)
          } catch (t) {
            if (F(t), this.options.strict)
              throw t
          }
        },
        n.prototype.paintNode = function(t) {
          v(t) && (this.renderer.setOpacity(t.opacity), this.renderer.ctx.save(), t.hasTransform() && this.renderer.setTransform(t.parseTransform())),
          "INPUT" === t.node.nodeName && "checkbox" === t.node.type
            ? this.paintCheckbox(t)
            : "INPUT" === t.node.nodeName && "radio" === t.node.type
              ? this.paintRadio(t)
              : this.paintElement(t)
        },
        n.prototype.paintElement = function(t) {
          var e = t.parseBounds();
          this.renderer.clip(t.backgroundClip, function() {
            this.renderer.renderBackground(t, e, t.borders.borders.map(A))
          }, this),
          this.renderer.clip(t.clip, function() {
            this.renderer.renderBorders(t.borders.borders)
          }, this),
          this.renderer.clip(t.backgroundClip, function() {
            switch (t.node.nodeName) {
              case "svg":
              case "IFRAME":
                var i = this.images.get(t.node);
                i
                  ? this.renderer.renderImage(t, e, t.borders, i)
                  : F("Error loading <" + t.node.nodeName + ">", t.node);
                break;
              case "IMG":
                var n = this.images.get(t.node.src);
                n
                  ? this.renderer.renderImage(t, e, t.borders, n)
                  : F("Error loading <img>", t.node.src);
                break;
              case "CANVAS":
                this.renderer.renderImage(t, e, t.borders, {image: t.node});
                break;
              case "SELECT":
              case "INPUT":
              case "TEXTAREA":
                this.paintFormValue(t)
            }
          }, this)
        },
        n.prototype.paintCheckbox = function(t) {
          var e = t.parseBounds(),
            i = Math.min(e.width, e.height),
            n = {
              width: i - 1,
              height: i - 1,
              top: e.top,
              left: e.left
            },
            o = [
              3, 3
            ],
            r = [
              o, o, o, o
            ],
            a = [1, 1, 1, 1].map(function(t) {
              return {color: new j("#A5A5A5"), width: t}
            }),
            l = c(n, r, a);
          this.renderer.clip(t.backgroundClip, function() {
            this.renderer.rectangle(n.left + 1, n.top + 1, n.width - 2, n.height - 2, new j("#DEDEDE")),
            this.renderer.renderBorders(s(a, n, l, r)),
            t.node.checked && (this.renderer.font(new j("#424242"), "normal", "normal", "bold", i - 3 + "px", "arial"), this.renderer.text("", n.left + i / 6, n.top + i - 1))
          }, this)
        },
        n.prototype.paintRadio = function(t) {
          var e = t.parseBounds(),
            i = Math.min(e.width, e.height) - 2;
          this.renderer.clip(t.backgroundClip, function() {
            this.renderer.circleStroke(e.left + 1, e.top + 1, i, new j("#DEDEDE"), 1, new j("#A5A5A5")),
            t.node.checked && this.renderer.circle(Math.ceil(e.left + i / 4) + 1, Math.ceil(e.top + i / 4) + 1, Math.floor(i / 2), new j("#424242"))
          }, this)
        },
        n.prototype.paintFormValue = function(t) {
          var e = t.getValue();
          if (e.length > 0) {
            var i = t.node.ownerDocument,
              n = i.createElement("html2canvaswrapper");
            [
              "lineHeight",
              "textAlign",
              "fontFamily",
              "fontWeight",
              "fontSize",
              "color",
              "paddingLeft",
              "paddingTop",
              "paddingRight",
              "paddingBottom",
              "width",
              "height",
              "borderLeftStyle",
              "borderTopStyle",
              "borderLeftWidth",
              "borderTopWidth",
              "boxSizing",
              "whiteSpace",
              "wordWrap"
            ].forEach(function(e) {
              try {
                n.style[e] = t.css(e)
              } catch (t) {
                F("html2canvas: Parse: Exception caught in renderFormValue: " + t.message)
              }
            });
            var o = t.parseBounds();
            n.style.position = "fixed",
            n.style.left = o.left + "px",
            n.style.top = o.top + "px",
            n.textContent = e,
            i.body.appendChild(n),
            this.paintText(new z(n.firstChild, t)),
            i.body.removeChild(n)
          }
        },
        n.prototype.paintText = function(t) {
          t.applyTextTransform();
          var e = G.ucs2.decode(t.node.data),
            i = this.options.letterRendering && !E(t) || H(t.node.data)
              ? e.map(function(t) {
                return G.ucs2.encode([t])
              })
              : N(e),
            n = t.parent.fontWeight(),
            o = t.parent.css("fontSize"),
            r = t.parent.css("fontFamily"),
            a = t.parent.parseTextShadows();
          this.renderer.font(t.parent.color("color"), t.parent.css("fontStyle"), t.parent.css("fontVariant"), n, o, r),
          a.length
            ? this.renderer.fontShadow(a[0].color, a[0].offsetX, a[0].offsetY, a[0].blur)
            : this.renderer.clearShadow(),
          this.renderer.clip(t.parent.clip, function() {
            i.map(this.parseTextBounds(t), this).forEach(function(e, n) {
              e && (this.renderer.text(i[n], e.left, e.bottom), this.renderTextDecoration(t.parent, e, this.fontMetrics.getMetrics(r, o)))
            }, this)
          }, this)
        },
        n.prototype.renderTextDecoration = function(t, e, i) {
          switch (t.css("textDecoration").split(" ")[0]) {
            case "underline":
              this.renderer.rectangle(e.left, Math.round(e.top + i.baseline + i.lineWidth), e.width, 1, t.color("color"));
              break;
            case "overline":
              this.renderer.rectangle(e.left, Math.round(e.top), e.width, 1, t.color("color"));
              break;
            case "line-through":
              this.renderer.rectangle(e.left, Math.ceil(e.top + i.middle + i.lineWidth), e.width, 1, t.color("color"))
          }
        };
        var $ = {
          inset: [
            [
              "darken", .6
            ],
            [
              "darken", .1
            ],
            [
              "darken", .1
            ],
            [
              "darken", .6
            ]
          ]
        };
        n.prototype.parseBorders = function(t) {
          var e = t.parseBounds(),
            i = x(t),
            n = ["Top", "Right", "Bottom", "Left"].map(function(e, i) {
              var n = t.css("border" + e + "Style"),
                o = t.color("border" + e + "Color");
              "inset" === n && o.isBlack() && (o = new j([255, 255, 255, o.a]));
              var r = $[n]
                ? $[n][i]
                : null;
              return {
                width: t.cssInt("border" + e + "Width"),
                color: r
                  ? o[r[0]](r[1])
                  : o,
                args: null
              }
            }),
            o = c(e, i, n);
          return {
            clip: this.parseBackgroundClip(t, o, n, i, e),
            borders: s(n, e, o, i)
          }
        },
        n.prototype.parseBackgroundClip = function(t, e, i, n, o) {
          var r = t.css("backgroundClip"),
            a = [];
          switch (r) {
            case "content-box":
            case "padding-box":
              d(a, n[0], n[1], e.topLeftInner, e.topRightInner, o.left + i[3].width, o.top + i[0].width),
              d(a, n[1], n[2], e.topRightInner, e.bottomRightInner, o.left + o.width - i[1].width, o.top + i[0].width),
              d(a, n[2], n[3], e.bottomRightInner, e.bottomLeftInner, o.left + o.width - i[1].width, o.top + o.height - i[2].width),
              d(a, n[3], n[0], e.bottomLeftInner, e.topLeftInner, o.left + i[3].width, o.top + o.height - i[2].width);
              break;
            default:
              d(a, n[0], n[1], e.topLeftOuter, e.topRightOuter, o.left, o.top),
              d(a, n[1], n[2], e.topRightOuter, e.bottomRightOuter, o.left + o.width, o.top),
              d(a, n[2], n[3], e.bottomRightOuter, e.bottomLeftOuter, o.left + o.width, o.top + o.height),
              d(a, n[3], n[0], e.bottomLeftOuter, e.topLeftOuter, o.left, o.top + o.height)
          }
          return a
        },
        e.exports = n
      }, {
        "./color": 3,
        "./fontmetrics": 7,
        "./log": 13,
        "./nodecontainer": 14,
        "./pseudoelementcontainer": 18,
        "./stackingcontext": 21,
        "./textcontainer": 25,
        "./utils": 26,
        punycode: 1
      }
    ],
    16: [
      function(t, e, i) {
        function n(t, e, i) {
          var n = "withCredentials" in new XMLHttpRequest;
          if (!e)
            return Promise.reject("No proxy configured");
          var o = a(n),
            l = s(e, t, o);
          return n
            ? h(l)
            : r(i, l, o).then(function(t) {
              return f(t.content)
            })
        }
        function o(t, e, i) {
          var n = "crossOrigin" in new Image,
            o = a(n),
            l = s(e, t, o);
          return n
            ? Promise.resolve(l)
            : r(i, l, o).then(function(t) {
              return "data:" + t.type + ";base64," + t.content
            })
        }
        function r(t, e, i) {
          return new Promise(function(n, o) {
            var r = t.createElement("script"),
              a = function() {
                delete window.html2canvas.proxy[i],
                t.body.removeChild(r)
              };
            window.html2canvas.proxy[i] = function(t) {
              a(),
              n(t)
            },
            r.src = e,
            r.onerror = function(t) {
              a(),
              o(t)
            },
            t.body.appendChild(r)
          })
        }
        function a(t) {
          return t
            ? ""
            : "html2canvas_" + Date.now() + "_" + ++m + "_" + Math.round(1e5 * Math.random())
        }
        function s(t, e, i) {
          return t + "?url=" + encodeURIComponent(e) + (
            i.length
            ? "&callback=html2canvas.proxy." + i
            : "")
        }
        function l(t) {
          return function(e) {
            var i,
              n = new DOMParser;
            try {
              i = n.parseFromString(e, "text/html")
            } catch (t) {
              d("DOMParser not supported, falling back to createHTMLDocument"),
              i = document.implementation.createHTMLDocument("");
              try {
                i.open(),
                i.write(e),
                i.close()
              } catch (t) {
                d("createHTMLDocument write not supported, falling back to document.body.innerHTML"),
                i.body.innerHTML = e
              }
            }
            var o = i.querySelector("base");
            if (!o || !o.href.host) {
              var r = i.createElement("base");
              r.href = t,
              i.head.insertBefore(r, i.head.firstChild)
            }
            return i
          }
        }
        function c(t, e, i, o, r, a) {
          return new n(t, e, window.document).then(l(t)).then(function(t) {
            return p(t, i, o, r, a, 0, 0)
          })
        }
        var h = t("./xhr"),
          u = t("./utils"),
          d = t("./log"),
          p = t("./clone"),
          f = u.decode64,
          m = 0;
        i.Proxy = n,
        i.ProxyURL = o,
        i.loadUrlDocument = c
      }, {
        "./clone": 2,
        "./log": 13,
        "./utils": 26,
        "./xhr": 28
      }
    ],
    17: [
      function(t, e, i) {
        function n(t, e) {
          var i = document.createElement("a");
          i.href = t,
          t = i.href,
          this.src = t,
          this.image = new Image;
          var n = this;
          this.promise = new Promise(function(i, r) {
            n.image.crossOrigin = "Anonymous",
            n.image.onload = i,
            n.image.onerror = r,
            new o(t, e, document).then(function(t) {
              n.image.src = t
            }).catch(r)
          })
        }
        var o = t("./proxy").ProxyURL;
        e.exports = n
      }, {
        "./proxy": 16
      }
    ],
    18: [
      function(t, e, i) {
        function n(t, e, i) {
          o.call(this, t, e),
          this.isPseudoElement = !0,
          this.before = ":before" === i
        }
        var o = t("./nodecontainer");
        n.prototype.cloneTo = function(t) {
          n.prototype.cloneTo.call(this, t),
          t.isPseudoElement = !0,
          t.before = this.before
        },
        n.prototype = Object.create(o.prototype),
        n.prototype.appendToDOM = function() {
          this.before
            ? this.parent.node.insertBefore(this.node, this.parent.node.firstChild)
            : this.parent.node.appendChild(this.node),
          this.parent.node.className += " " + this.getHideClass()
        },
        n.prototype.cleanDOM = function() {
          this.node.parentNode.removeChild(this.node),
          this.parent.node.className = this.parent.node.className.replace(this.getHideClass(), "")
        },
        n.prototype.getHideClass = function() {
          return this["PSEUDO_HIDE_ELEMENT_CLASS_" + (
              this.before
              ? "BEFORE"
              : "AFTER")]
        },
        n.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE = "___html2canvas___pseudoelement_before",
        n.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER = "___html2canvas___pseudoelement_after",
        e.exports = n
      }, {
        "./nodecontainer": 14
      }
    ],
    19: [
      function(t, e, i) {
        function n(t, e, i, n, o) {
          this.width = t,
          this.height = e,
          this.images = i,
          this.options = n,
          this.document = o
        }
        var o = t("./log");
        n.prototype.renderImage = function(t, e, i, n) {
          var o = t.cssInt("paddingLeft"),
            r = t.cssInt("paddingTop"),
            a = t.cssInt("paddingRight"),
            s = t.cssInt("paddingBottom"),
            l = i.borders,
            c = e.width - (l[1].width + l[3].width + o + a),
            h = e.height - (l[0].width + l[2].width + r + s);
          this.drawImage(n, 0, 0, n.image.width || c, n.image.height || h, e.left + o + l[3].width, e.top + r + l[0].width, c, h)
        },
        n.prototype.renderBackground = function(t, e, i) {
          e.height > 0 && e.width > 0 && (this.renderBackgroundColor(t, e), this.renderBackgroundImage(t, e, i))
        },
        n.prototype.renderBackgroundColor = function(t, e) {
          var i = t.color("backgroundColor");
          i.isTransparent() || this.rectangle(e.left, e.top, e.width, e.height, i)
        },
        n.prototype.renderBorders = function(t) {
          t.forEach(this.renderBorder, this)
        },
        n.prototype.renderBorder = function(t) {
          t.color.isTransparent() || null === t.args || this.drawShape(t.args, t.color)
        },
        n.prototype.renderBackgroundImage = function(t, e, i) {
          t.parseBackgroundImages().reverse().forEach(function(n, r, a) {
            switch (n.method) {
              case "url":
                var s = this.images.get(n.args[0]);
                s
                  ? this.renderBackgroundRepeating(t, e, s, a.length - (r + 1), i)
                  : o("Error loading background-image", n.args[0]);
                break;
              case "linear-gradient":
              case "gradient":
                var l = this.images.get(n.value);
                l
                  ? this.renderBackgroundGradient(l, e, i)
                  : o("Error loading background-image", n.args[0]);
                break;
              case "none":
                break;
              default:
                o("Unknown background-image type", n.args[0])
            }
          }, this)
        },
        n.prototype.renderBackgroundRepeating = function(t, e, i, n, o) {
          var r = t.parseBackgroundSize(e, i.image, n),
            a = t.parseBackgroundPosition(e, i.image, n, r);
          switch (t.parseBackgroundRepeat(n)) {
            case "repeat-x":
            case "repeat no-repeat":
              this.backgroundRepeatShape(i, a, r, e, e.left + o[3], e.top + a.top + o[0], 99999, r.height, o);
              break;
            case "repeat-y":
            case "no-repeat repeat":
              this.backgroundRepeatShape(i, a, r, e, e.left + a.left + o[3], e.top + o[0], r.width, 99999, o);
              break;
            case "no-repeat":
              this.backgroundRepeatShape(i, a, r, e, e.left + a.left + o[3], e.top + a.top + o[0], r.width, r.height, o);
              break;
            default:
              this.renderBackgroundRepeat(i, a, r, {
                top: e.top,
                left: e.left
              }, o[3], o[0])
          }
        },
        e.exports = n
      }, {
        "./log": 13
      }
    ],
    20: [
      function(t, e, i) {
        function n(t, e) {
          r.apply(this, arguments),
          this.canvas = this.options.canvas || this.document.createElement("canvas"),
          this.options.canvas || (this.canvas.width = t, this.canvas.height = e),
          this.ctx = this.canvas.getContext("2d"),
          this.taintCtx = this.document.createElement("canvas").getContext("2d"),
          this.ctx.textBaseline = "bottom",
          this.variables = {},
          s("Initialized CanvasRenderer with size", t, "x", e)
        }
        function o(t) {
          return t.length > 0
        }
        var r = t("../renderer"),
          a = t("../lineargradientcontainer"),
          s = t("../log");
        n.prototype = Object.create(r.prototype),
        n.prototype.setFillStyle = function(t) {
          return this.ctx.fillStyle = "object" === (
            void 0 === t
            ? "undefined"
            : _typeof(t)) && t.isColor
            ? t.toString()
            : t,
          this.ctx
        },
        n.prototype.rectangle = function(t, e, i, n, o) {
          this.setFillStyle(o).fillRect(t, e, i, n)
        },
        n.prototype.circle = function(t, e, i, n) {
          this.setFillStyle(n),
          this.ctx.beginPath(),
          this.ctx.arc(t + i / 2, e + i / 2, i / 2, 0, 2 * Math.PI, !0),
          this.ctx.closePath(),
          this.ctx.fill()
        },
        n.prototype.circleStroke = function(t, e, i, n, o, r) {
          this.circle(t, e, i, n),
          this.ctx.strokeStyle = r.toString(),
          this.ctx.stroke()
        },
        n.prototype.drawShape = function(t, e) {
          this.shape(t),
          this.setFillStyle(e).fill()
        },
        n.prototype.taints = function(t) {
          if (null === t.tainted) {
            this.taintCtx.drawImage(t.image, 0, 0);
            try {
              this.taintCtx.getImageData(0, 0, 1, 1),
              t.tainted = !1
            } catch (e) {
              this.taintCtx = document.createElement("canvas").getContext("2d"),
              t.tainted = !0
            }
          }
          return t.tainted
        },
        n.prototype.drawImage = function(t, e, i, n, o, r, a, s, l) {
          this.taints(t) && !this.options.allowTaint || this.ctx.drawImage(t.image, e, i, n, o, r, a, s, l)
        },
        n.prototype.clip = function(t, e, i) {
          this.ctx.save(),
          t.filter(o).forEach(function(t) {
            this.shape(t).clip()
          }, this),
          e.call(i),
          this.ctx.restore()
        },
        n.prototype.shape = function(t) {
          return this.ctx.beginPath(),
          t.forEach(function(t, e) {
            "rect" === t[0]
              ? this.ctx.rect.apply(this.ctx, t.slice(1))
              : this.ctx[
                0 === e
                  ? "moveTo"
                  : t[0] + "To"
              ].apply(this.ctx, t.slice(1))
          }, this),
          this.ctx.closePath(),
          this.ctx
        },
        n.prototype.font = function(t, e, i, n, o, r) {
          this.setFillStyle(t).font = [e, i, n, o, r].join(" ").split(",")[0]
        },
        n.prototype.fontShadow = function(t, e, i, n) {
          this.setVariable("shadowColor", t.toString()).setVariable("shadowOffsetY", e).setVariable("shadowOffsetX", i).setVariable("shadowBlur", n)
        },
        n.prototype.clearShadow = function() {
          this.setVariable("shadowColor", "rgba(0,0,0,0)")
        },
        n.prototype.setOpacity = function(t) {
          this.ctx.globalAlpha = t
        },
        n.prototype.setTransform = function(t) {
          this.ctx.translate(t.origin[0], t.origin[1]),
          this.ctx.transform.apply(this.ctx, t.matrix),
          this.ctx.translate(-t.origin[0], -t.origin[1])
        },
        n.prototype.setVariable = function(t, e) {
          return this.variables[t] !== e && (this.variables[t] = this.ctx[t] = e),
          this
        },
        n.prototype.text = function(t, e, i) {
          this.ctx.fillText(t, e, i)
        },
        n.prototype.backgroundRepeatShape = function(t, e, i, n, o, r, a, s, l) {
          var c = [
            [
              "line", Math.round(o), Math.round(r)
            ],
            [
              "line",
              Math.round(o + a),
              Math.round(r)
            ],
            [
              "line",
              Math.round(o + a),
              Math.round(s + r)
            ],
            [
              "line",
              Math.round(o),
              Math.round(s + r)
            ]
          ];
          this.clip([c], function() {
            this.renderBackgroundRepeat(t, e, i, n, l[3], l[0])
          }, this)
        },
        n.prototype.renderBackgroundRepeat = function(t, e, i, n, o, r) {
          var a = Math.round(n.left + e.left + o),
            s = Math.round(n.top + e.top + r);
          this.setFillStyle(this.ctx.createPattern(this.resizeImage(t, i), "repeat")),
          this.ctx.translate(a, s),
          this.ctx.fill(),
          this.ctx.translate(-a, -s)
        },
        n.prototype.renderBackgroundGradient = function(t, e) {
          if (t instanceof a) {
            var i = this.ctx.createLinearGradient(e.left + e.width * t.x0, e.top + e.height * t.y0, e.left + e.width * t.x1, e.top + e.height * t.y1);
            t.colorStops.forEach(function(t) {
              i.addColorStop(t.stop, t.color.toString())
            }),
            this.rectangle(e.left, e.top, e.width, e.height, i)
          }
        },
        n.prototype.resizeImage = function(t, e) {
          var i = t.image;
          if (i.width === e.width && i.height === e.height)
            return i;
          var n,
            o = document.createElement("canvas");
          return o.width = e.width,
          o.height = e.height,
          n = o.getContext("2d"),
          n.drawImage(i, 0, 0, i.width, i.height, 0, 0, e.width, e.height),
          o
        },
        e.exports = n
      }, {
        "../lineargradientcontainer": 12,
        "../log": 13,
        "../renderer": 19
      }
    ],
    21: [
      function(t, e, i) {
        function n(t, e, i, n) {
          o.call(this, i, n),
          this.ownStacking = t,
          this.contexts = [],
          this.children = [],
          this.opacity = (
            this.parent
            ? this.parent.stack.opacity
            : 1) * e
        }
        var o = t("./nodecontainer");
        n.prototype = Object.create(o.prototype),
        n.prototype.getParentStack = function(t) {
          var e = this.parent
            ? this.parent.stack
            : null;
          return e
            ? e.ownStacking
              ? e
              : e.getParentStack(t)
            : t.stack
        },
        e.exports = n
      }, {
        "./nodecontainer": 14
      }
    ],
    22: [
      function(t, e, i) {
        function n(t) {
          this.rangeBounds = this.testRangeBounds(t),
          this.cors = this.testCORS(),
          this.svg = this.testSVG()
        }
        n.prototype.testRangeBounds = function(t) {
          var e,
            i,
            n,
            o,
            r = !1;
          return t.createRange && (e = t.createRange(), e.getBoundingClientRect && (i = t.createElement("boundtest"), i.style.height = "123px", i.style.display = "block", t.body.appendChild(i), e.selectNode(i), n = e.getBoundingClientRect(), o = n.height, 123 === o && (r = !0), t.body.removeChild(i))),
          r
        },
        n.prototype.testCORS = function() {
          return void 0 !== (new Image).crossOrigin
        },
        n.prototype.testSVG = function() {
          var t = new Image,
            e = document.createElement("canvas"),
            i = e.getContext("2d");
          t.src = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";
          try {
            i.drawImage(t, 0, 0),
            e.toDataURL()
          } catch (t) {
            return !1
          }
          return !0
        },
        e.exports = n
      }, {}
    ],
    23: [
      function(t, e, i) {
        function n(t) {
          this.src = t,
          this.image = null;
          var e = this;
          this.promise = this.hasFabric().then(function() {
            return e.isInline(t)
              ? Promise.resolve(e.inlineFormatting(t))
              : o(t)
          }).then(function(t) {
            return new Promise(function(i) {
              window.html2canvas.svg.fabric.loadSVGFromString(t, e.createCanvas.call(e, i))
            })
          })
        }
        var o = t("./xhr"),
          r = t("./utils").decode64;
        n.prototype.hasFabric = function() {
          return window.html2canvas.svg && window.html2canvas.svg.fabric
            ? Promise.resolve()
            : Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg"))
        },
        n.prototype.inlineFormatting = function(t) {
          return /^data:image\/svg\+xml;base64,/.test(t)
            ? this.decode64(this.removeContentType(t))
            : this.removeContentType(t)
        },
        n.prototype.removeContentType = function(t) {
          return t.replace(/^data:image\/svg\+xml(;base64)?,/, "")
        },
        n.prototype.isInline = function(t) {
          return /^data:image\/svg\+xml/i.test(t)
        },
        n.prototype.createCanvas = function(t) {
          var e = this;
          return function(i, n) {
            var o = new window.html2canvas.svg.fabric.StaticCanvas("c");
            e.image = o.lowerCanvasEl,
            o.setWidth(n.width).setHeight(n.height).add(window.html2canvas.svg.fabric.util.groupSVGElements(i, n)).renderAll(),
            t(o.lowerCanvasEl)
          }
        },
        n.prototype.decode64 = function(t) {
          return "function" == typeof window.atob
            ? window.atob(t)
            : r(t)
        },
        e.exports = n
      }, {
        "./utils": 26,
        "./xhr": 28
      }
    ],
    24: [
      function(t, e, i) {
        function n(t, e) {
          this.src = t,
          this.image = null;
          var i = this;
          this.promise = e
            ? new Promise(function(e, n) {
              i.image = new Image,
              i.image.onload = e,
              i.image.onerror = n,
              i.image.src = "data:image/svg+xml," + (
              new XMLSerializer).serializeToString(t),
              i.image.complete === !0 && e(i.image)
            })
            : this.hasFabric().then(function() {
              return new Promise(function(e) {
                window.html2canvas.svg.fabric.parseSVGDocument(t, i.createCanvas.call(i, e))
              })
            })
        }
        var o = t("./svgcontainer");
        n.prototype = Object.create(o.prototype),
        e.exports = n
      }, {
        "./svgcontainer": 23
      }
    ],
    25: [
      function(t, e, i) {
        function n(t, e) {
          r.call(this, t, e)
        }
        function o(t, e, i) {
          if (t.length > 0)
            return e + i.toUpperCase()
        }
        var r = t("./nodecontainer");
        n.prototype = Object.create(r.prototype),
        n.prototype.applyTextTransform = function() {
          this.node.data = this.transform(this.parent.css("textTransform"))
        },
        n.prototype.transform = function(t) {
          var e = this.node.data;
          switch (t) {
            case "lowercase":
              return e.toLowerCase();
            case "capitalize":
              return e.replace(/(^|\s|:|-|\(|\))([a-z])/g, o);
            case "uppercase":
              return e.toUpperCase();
            default:
              return e
          }
        },
        e.exports = n
      }, {
        "./nodecontainer": 14
      }
    ],
    26: [
      function(t, e, i) {
        i.smallImage = function() {
          return "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
        },
        i.bind = function(t, e) {
          return function() {
            return t.apply(e, arguments)
          }
        },
        i.decode64 = function(t) {
          var e,
            i,
            n,
            o,
            r,
            a,
            s,
            l,
            c = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
            h = t.length,
            u = "";
          for (e = 0; e < h; e += 4)
            i = c.indexOf(t[e]),
            n = c.indexOf(t[e + 1]),
            o = c.indexOf(t[e + 2]),
            r = c.indexOf(t[e + 3]),
            a = i << 2 | n >> 4,
            s = (15 & n) << 4 | o >> 2,
            l = (3 & o) << 6 | r,
            u += 64 === o
              ? String.fromCharCode(a)
              : 64 === r || r === -1
                ? String.fromCharCode(a, s)
                : String.fromCharCode(a, s, l);
          return u
        },
        i.getBounds = function(t) {
          if (t.getBoundingClientRect) {
            var e = t.getBoundingClientRect(),
              i = null == t.offsetWidth
                ? e.width
                : t.offsetWidth;
            return {
              top: e.top,
              bottom: e.bottom || e.top + e.height,
              right: e.left + i,
              left: e.left,
              width: i,
              height: null == t.offsetHeight
                ? e.height
                : t.offsetHeight
            }
          }
          return {}
        },
        i.offsetBounds = function(t) {
          var e = t.offsetParent
            ? i.offsetBounds(t.offsetParent)
            : {
              top: 0,
              left: 0
            };
          return {
            top: t.offsetTop + e.top,
            bottom: t.offsetTop + t.offsetHeight + e.top,
            right: t.offsetLeft + e.left + t.offsetWidth,
            left: t.offsetLeft + e.left,
            width: t.offsetWidth,
            height: t.offsetHeight
          }
        },
        i.parseBackgrounds = function(t) {
          var e,
            i,
            n,
            o,
            r,
            a,
            s,
            l = " \r\n\t",
            c = [],
            h = 0,
            u = 0,
            d = function() {
              e && ('"' === i.substr(0, 1) && (i = i.substr(1, i.length - 2)), i && s.push(i), "-" === e.substr(0, 1) && (o = e.indexOf("-", 1) + 1) > 0 && (n = e.substr(0, o), e = e.substr(o)), c.push({prefix: n, method: e.toLowerCase(), value: r, args: s, image: null})),
              s = [],
              e = n = i = r = ""
            };
          return s = [],
          e = n = i = r = "",
          t.split("").forEach(function(t) {
            if (!(0 === h && l.indexOf(t) > -1)) {
              switch (t) {
                case '"':
                  a
                    ? a === t && (a = null)
                    : a = t;
                  break;
                case "(":
                  if (a)
                    break;
                  if (0 === h)
                    return h = 1,
                    void(r += t);
                  u++;
                  break;
                case ")":
                  if (a)
                    break;
                  if (1 === h) {
                    if (0 === u)
                      return h = 0,
                      r += t,
                      void d();
                    u--
                  }
                  break;
                case ",":
                  if (a)
                    break;
                  if (0 === h)
                    return void d();
                  if (1 === h && 0 === u && !e.match(/^url$/i))
                    return s.push(i),
                    i = "",
                    void(r += t)
                }
              r += t,
              0 === h
                ? e += t
                : i += t
            }
          }),
          d(),
          c
        }
      }, {}
    ],
    27: [
      function(t, e, i) {
        function n(t) {
          o.apply(this, arguments),
          this.type = "linear" === t.args[0]
            ? o.TYPES.LINEAR
            : o.TYPES.RADIAL
        }
        var o = t("./gradientcontainer");
        n.prototype = Object.create(o.prototype),
        e.exports = n
      }, {
        "./gradientcontainer": 9
      }
    ],
    28: [
      function(t, e, i) {
        function n(t) {
          return new Promise(function(e, i) {
            var n = new XMLHttpRequest;
            n.open("GET", t),
            n.onload = function() {
              200 === n.status
                ? e(n.responseText)
                : i(new Error(n.statusText))
            },
            n.onerror = function() {
              i(new Error("Network Error"))
            },
            n.send()
          })
        }
        e.exports = n
      }, {}
    ]
  }, {}, [4])(4)
}),
CLOUD.Extensions = CLOUD.Extensions || {},
CLOUD.Extensions.Utils = CLOUD.Extensions.Utils || {},
CLOUD.Extensions.Utils.Geometric = {
  isInsideBounds: function(t, e, i) {
    return t >= i.x && t <= i.x + i.width && e >= i.y && e <= i.y + i.height
  },
  getAngleBetweenPoints: function(t, e) {
    return Math.atan2(e.y - t.y, e.x - t.x)
  },
  isEqualBetweenPoints: function(t, e, i) {
    i = i || 1e-4;
    var n = t.x - e.x,
      o = t.y - e.y;
    return !(Math.sqrt(n * n + o * o) > i)
  }
},
CLOUD.Extensions = CLOUD.Extensions || {},
CLOUD.Extensions.Utils = CLOUD.Extensions.Utils || {},
CLOUD.Extensions.Utils.Shape2D = {
  createSvgElement: function(t) {
    var e = document.createElementNS("http://www.w3.org/2000/svg", t);
    return e.setAttribute("pointer-events", "inherit"),
    e
  },
  getRGBAString: function(t, e) {
    return e <= 0
      ? "none"
      : [
        "rgba(" + parseInt("0x" + t.substr(1, 2)),
        ",",
        parseInt("0x" + t.substr(3, 2)),
        ",",
        parseInt("0x" + t.substr(5, 2)),
        ",",
        e,
        ")"
      ].join("")
  },
  makeFlag: function() {
    var t = this.createSvgElement("path");
    return t.setAttribute("d", "M0 0 L0 -20 L15 -13 L4 -6.87 L4 0Z"),
    t
  },
  makeBubble: function() {
    var t = this.createSvgElement("path");
    return t.setAttribute("d", "m0.0035,-19.88544c-3.838253,0 -6.95,2.581968 -6.95,5.766754c0,3.185555 6.95,13.933247 6.95,13.933247s6.95,-10.747692 6.95,-13.933247c0,-3.184786 -3.11082,-5.766754 -6.95,-5.766754z"),
    t
  },
  makeCommon: function(t, e) {
    var i = this.createSvgElement("image");
    return i.href.baseVal = t,
    i.setAttribute("height", e.toString() + "px"),
    i.setAttribute("width", e.toString() + "px"),
    i
  }
},
CLOUD.DomUtilEx = {
  create: function(t, e, i) {
    var n = document.createElement(t);
    return n.className = e || "",
    i && i.appendChild(n),
    n
  },
  remove: function(t) {
    var e = t.parentNode;
    e && e.removeChild(t)
  },
  setPosition: function(t, e) {
    t.position = e,
    t.style.left = e.x + "px",
    t.style.top = e.y + "px"
  },
  setOpacity: function(t, e) {
    "opacity" in t.style
      ? t.style.opacity = e
      : "filter" in t.style && CLOUD.DomUtilEx._setOpacityIE(t, e)
  },
  _setOpacityIE: function(t, e) {
    var i = !1,
      n = "DXImageTransform.Microsoft.Alpha";
    try {
      i = t.filters.item(n)
    } catch (t) {
      if (1 === e)
        return
    }
    e = Math.round(100 * e),
    i
      ? (i.Enabled = 100 !== e, i.Opacity = e)
      : t.style.filter += " progid:" + n + "(opacity=" + e + ")"
  }
},
CLOUD.MarkerUtil = {
  viewer: void 0,
  setOptions: function(t, e) {
    t.hasOwnProperty("options") || (t.options = {});
    for (var i in e)
      t.options[i] = e[i];
    return t.options
  },
  transformPosition: function(t) {
    if (void 0 === CLOUD.MarkerUtil.viewer)
      throw new Error("please set the viewer for transformPosition.");
    var e = CLOUD.DomUtil.getContainerOffsetToClient(document.getElementById("viewport")),
      i = CLOUD.MarkerUtil.viewer.getScene(),
      n = CLOUD.MarkerUtil.viewer.cameraControl.camera,
      o = i.getMatrixGlobal(),
      r = new THREE.Vector3(t.x, t.y, t.z);
    return r.applyMatrix4(o),
    r.project(n),
    r.x = Math.round(.5 * (r.x + 1) * e.width),
    r.y = Math.round(-.5 * (r.y - 1) * e.height), {
      x: r.x,
      y: r.y
    }
  },
  panes: {},
  createPane: function(t, e) {
    var i = t
        ? " " + t.replace("Pane", "") + "-pane"
        : "",
      n = CLOUD.DomUtilEx.create("div", i, e || document.getElementById("viewport"));
    return t && (CLOUD.MarkerUtil.panes[t] = n),
    n
  },
  getPane: function(t, e) {
    return void 0 === t && (t = "markerPane"),
    CLOUD.MarkerUtil.panes.hasOwnProperty(t)
      ? CLOUD.MarkerUtil.panes[t]
      : CLOUD.MarkerUtil.createPane(t, e)
  }
},
CLOUD.MiniMap = function(t) {
  function e(t, e, i, n) {
    return (e.x - t.x) * (n.y - i.y) - (e.y - t.y) * (n.x - i.x)
  }
  function i(t, i, n) {
    return e(t, i, t, n)
  }
  function n(t, e, n) {
    return Math.abs(i(t, e, n))
  }
  function o(t, e, i, o) {
    var r = n(t, e, i),
      a = n(t, e, o);
    return new THREE.Vector2((o.x * r + i.x * a) / (r + a), (o.y * r + i.y * a) / (r + a))
  }
  function r(t, e, i) {
    var n = new THREE.Vector3;
    return n.crossVectors(t, e),
    !(n.dot(i) >= 0)
  }
  function a(t) {
    t.x = t.x * U,
    t.y = -t.y * A
  }
  function s(t) {
    t.x = t.x / U,
    t.y = -t.y / A
  }
  function l(t) {
    var e = lt.getSize();
    t.x = .5 * (t.x + 1) * e.x + lt.min.x,
    t.y = .5 * (t.y + 1) * e.y + lt.min.y
  }
  function c(t) {
    var e = lt.getSize();
    t.x = (t.x - lt.min.x) / e.x * 2 - 1,
    t.y = (t.y - lt.min.y) / e.y * 2 - 1
  }
  function h(t) {
    var e = document.createElement("style");
    e.type = "text/css";
    try {
      e.appendChild(document.createTextNode(t))
    } catch (i) {
      e.styleSheet.cssText = t
    }
    document.getElementsByTagName("head")[0].appendChild(e)
  }
  function u(t) {
    return null == J[t]
      ? (J[t] = document.createElementNS(Z, "image"), J[t])
      : J[t]
  }
  function d(t) {
    return null == K[t]
      ? (K[t] = document.createElementNS(Z, "line"), 0 == rt && K[t].setAttribute("shape-rendering", "crispEdges"), K[t])
      : K[t]
  }
  function p(t) {
    return null == $[t]
      ? ($[t] = document.createElementNS(Z, "circle"), 0 == rt && $[t].setAttribute("shape-rendering", "crispEdges"), $[t])
      : $[t]
  }
  function f(t) {
    return null == Q[t]
      ? (Q[t] = document.createElementNS(Z, "text"), 0 == rt && Q[t].setAttribute("shape-rendering", "crispEdges"), Q[t])
      : Q[t]
  }
  function m(t, e, i) {
    O = d(et++),
    O.setAttribute("x1", t.x),
    O.setAttribute("y1", t.y),
    O.setAttribute("x2", e.x),
    O.setAttribute("y2", e.y),
    i instanceof THREE.LineBasicMaterial && (O.setAttribute("style", "fill: none; stroke: " + i.color.getStyle() + "; stroke-width: " + i.linewidth + "; stroke-opacity: " + i.opacity + "; stroke-linecap: " + i.linecap + "; stroke-linejoin: " + i.linejoin), S.appendChild(O))
  }
  function g(t, e, i) {
    O = p(ot++),
    O.setAttribute("r", ut + ""),
    O.setAttribute("transform", "translate(" + t + "," + e + ")"),
    i instanceof THREE.LineBasicMaterial && (O.setAttribute("style", "fill: none; stroke: " + i.color.getStyle() + "; stroke-width: 1"), S.appendChild(O))
  }
  function v(t, e, i, n) {
    O = f(it++),
    n instanceof THREE.LineBasicMaterial && (O.setAttribute("style", "font-size:" + dt + "px; fill: none; stroke: " + n.color.getStyle() + "; stroke-width: 1"), S.appendChild(O)),
    O.innerHTML = i;
    var o = O.getBoundingClientRect(),
      r = t - .5 * o.width,
      a = e + .25 * o.height;
    O.setAttribute("transform", "translate(" + r + "," + a + ")")
  }
  function y() {
    gt && (O = u(0), M.appendChild(O))
  }
  function E() {
    M.appendChild(B),
    M.appendChild(N),
    M.appendChild(P)
  }
  function x() {
    M.appendChild(S);
    for (var t = 0, e = ct.length; t < e; t++)
      for (var i = ct[t], n = 0, o = i.length; n < o; n++) {
        var r = i[n],
          a = r.v1.clone(),
          s = r.v2.clone(),
          l = r.material;
        if (st.makeEmpty(), st.setFromPoints([a, s]), at.isIntersectionBox(st) === !0 && (m(a, s, l), n % pt == 0)) {
          var c = new THREE.Vector2;
          c.subVectors(s, a).normalize().multiplyScalar(ut);
          var h = a.clone().sub(c),
            u = s.clone().add(c);
          g(h.x, h.y, l),
          g(u.x, u.y, l),
          v(h.x, h.y, r.name, l),
          v(u.x, u.y, r.name, l)
        }
      }
    }
  function b(t, e) {
    var i = {
      position: "absolute",
      display: "block",
      left: "20px",
      bottom: "20px",
      outline: "#0000FF dotted thin"
    };
    e = e || i;
    for (var n in e)
      t.style[n] = e[n]
  }
  function w(t) {
    var e = q.getMainSceneMatrix();
    t.applyMatrix4(e)
  }
  function C(t, e) {
    var i = new THREE.Box2,
      n = [],
      r = new THREE.Box2(new THREE.Vector2(e[0], e[1]), new THREE.Vector2(e[2], e[3])),
      a = [],
      s = [],
      l = 0,
      c = 0,
      h = t.length;
    for (l = 0; l < h; l++) {
      var u = t[l],
        d = u.start || u.Start,
        p = u.end || u.End,
        f = new THREE.Vector2(d.X, d.Y),
        m = new THREE.Vector2(p.X, p.Y),
        g = m.clone().sub(f).normalize();
      Math.abs(g.x) >= Math.abs(g.y)
        ? a.push({v1: f, v2: m})
        : s.push({v1: f, v2: m})
    }
    var v,
      y,
      E,
      x,
      b,
      w,
      C = a.length,
      T = s.length;
    for (l = 0; l < C; l++)
      for (v = a[l], E = v.v1.clone(), x = v.v2.clone(), c = 0; c < T; c++) {
        y = s[c],
        b = y.v1.clone(),
        w = y.v2.clone();
        var _ = o(E, x, b, w);
        i.expandByPoint(_)
      }
    for (i.union(r), i.expandByScalar(Tt), l = 0; l < h; l++) {
      var u = t[l],
        L = u.name || u.Name,
        d = u.start || u.Start,
        p = u.end || u.End,
        f = new THREE.Vector2(d.X, d.Y),
        m = new THREE.Vector2(p.X, p.Y),
        g = m.clone().sub(f).normalize();
      Math.abs(g.x) >= Math.abs(g.y)
        ? (f.x = i.max.x, m.x = i.min.x, n.push({
          name: L,
          start: {
            X: f.x,
            Y: f.y
          },
          end: {
            X: m.x,
            Y: m.y
          }
        }))
        : (f.y = i.min.y, m.y = i.max.y, n.push({
          name: L,
          start: {
            X: f.x,
            Y: f.y
          },
          end: {
            X: m.x,
            Y: m.y
          }
        }))
    }
    return n
  }
  function T(t) {
    lt.makeEmpty();
    for (var e = 0, i = t.length; e < i; e++) {
      var n = t[e],
        o = n.start || n.Start,
        r = n.end || n.End,
        a = new THREE.Vector2(o.X, o.Y),
        s = new THREE.Vector2(r.X, r.Y);
      lt.expandByPoint(a),
      lt.expandByPoint(s)
    }
    var l = lt.getCenter(),
      c = lt.getSize(),
      h = new THREE.Vector2,
      u = D / R,
      d = c.x / c.y,
      p = c.x,
      f = c.y;
    d > u
      ? (ft && (p = c.x * D / (D - 4 * (ut + 4))), f = p / u)
      : d < u && (ft && (f = c.y * R / (R - 4 * (ut + 4))), p = f * u),
    h.set(p, f),
    lt.setFromCenterAndSize(l, h)
  }
  function _(t, e) {
    ct.length > 0 && (ct = []),
    ht.length > 0 && (ht = []);
    var i = [],
      n = [],
      r = 0,
      s = 0,
      l = t.length;
    for (r = 0; r < l; r++) {
      var h = t[r],
        u = h.name || h.Name,
        d = h.start || h.Start,
        p = h.end || h.End,
        f = new THREE.Vector2(d.X, d.Y),
        m = new THREE.Vector2(p.X, p.Y);
      c(f),
      a(f),
      c(m),
      a(m);
      var g = m.clone().sub(f).normalize();
      Math.abs(g.x) >= Math.abs(g.y)
        ? i.push({name: u, v1: f, v2: m, material: e})
        : n.push({name: u, v1: f, v2: m, material: e})
    }
    ct.push(i),
    ct.push(n);
    var v,
      y,
      E,
      x,
      b,
      w,
      C,
      T,
      _ = i.length,
      L = n.length;
    for (r = 0; r < _; r++)
      for (v = i[r], x = v.name, b = v.v1.clone(), w = v.v2.clone(), s = 0; s < L; s++) {
        y = n[s],
        E = y.name,
        C = y.v1.clone(),
        T = y.v2.clone();
        var M = o(b, w, C, T);
        ht.push({
          intersectionPoint: M,
          horizLine: [
            b.clone(), w.clone()
          ],
          verticalLine: [
            C.clone(), T.clone()
          ],
          abcName: x,
          numeralName: E
        })
      }
    }
  this.viewer = t,
  this.visible = !0,
  this.width = 0,
  this.height = 0,
  this.domContainer = null,
  this.autoClear = !0,
  this.mouseButtons = {
    LEFT: THREE.MOUSE.LEFT,
    RIGHT: THREE.MOUSE.RIGHT
  },
  this.callbackCameraChanged = null,
  this.callbackMapClick = null,
  this.mapClickMode = "default",
  this.callbackClickOnAxisGrid = null,
  this.initialized = !1,
  this.axisGirds = null;
  var L,
    M,
    S,
    O,
    D,
    R,
    U,
    A,
    I,
    P,
    B,
    N,
    k,
    H,
    F,
    G,
    V,
    z,
    q = this,
    W = new THREE.Vector2,
    j = new THREE.Color,
    X = 1,
    Y = new THREE.LineBasicMaterial({color: 10066329, linewidth: .5}),
    Z = "http://www.w3.org/2000/svg",
    K = [],
    Q = [],
    J = [],
    $ = [],
    tt = 0,
    et = 0,
    it = 0,
    nt = 0,
    ot = 0,
    rt = 1,
    at = new THREE.Box2,
    st = new THREE.Box2,
    lt = new THREE.Box2,
    ct = [],
    ht = [],
    ut = 10,
    dt = 8,
    pt = 3,
    ft = !1,
    mt = !1,
    gt = !1,
    vt = !0,
    yt = !1,
    Et = 0,
    xt = 0,
    bt = !0,
    wt = !1,
    Ct = !1,
    Tt = 100;
  this.enableMouseEvent = function(t) {
    vt = t
  },
  this.isEnableMouseEvent = function() {
    return vt
  },
  this.isMouseOverCanvas = function(t) {
    var e = L;
    if (wt = !1, e) {
      var i = CLOUD.DomUtil.getContainerOffsetToClient(e),
        n = new THREE.Vector2;
      if (n.x = t.x - i.left, n.y = t.y - i.top, 0 === i.width || 0 === i.height)
        return !1;
      if (n.x > 0 && n.x < this.width && n.y > 0 && n.y < this.height)
        return W.x = n.x / this.width * 2 - 1,
        W.y = -n.y / this.height * 2 + 1,
        wt = !0,
        !0
    }
    return !1
  },
  this.isMouseMoving = function() {
    return this.viewer.editorManager.isMouseMoving()
  },
  this.onMouseDown = function(t) {
    this.isMouseMoving() || (this.isMouseDown = !0)
  },
  this.onMouseMove = function(t) {
    if (!this.isMouseMoving() && vt) {
      var e = new THREE.Vector2(t.clientX, t.clientY),
        i = this.isMouseOverCanvas(e);
      this.highlightedNode(i, ft, !1)
    }
  },
  this.onMouseUp = function(t) {
    if (this.isMouseDown) {
      this.isMouseDown = !1;
      var e = new THREE.Vector2(t.clientX, t.clientY),
        i = this.isMouseOverCanvas(e),
        n = mt || gt;
      if (!vt)
        return void this.highlightedNode(i, ft, !0);
      if (i && n) {
        var o = new THREE.Vector3,
          r = W.clone();
        l(r);
        var c = W.clone();
        a(c);
        var h = this.getIntersectionToMinDistance(c);
        if (h) {
          var u = new THREE.Vector2(h.intersectionPoint.x, h.intersectionPoint.y);
          if (c.sub(u).lengthSq() < 9) {
            var d = u.clone();
            s(d),
            l(d),
            o.set(d.x, d.y, xt)
          } else
            o.set(r.x, r.y, xt)
        } else
          o.set(r.x, r.y, xt);
        var p = o.clone();
        "default" == this.mapClickMode
          ? (this.callbackMapClick && this.callbackMapClick(p), w(o), this.flyToPointWithParallelEye(o))
          : "static" == this.mapClickMode && this.callbackMapClick && this.callbackMapClick(p)
      }
    }
  },
  this.imageCoord2WordCoord = function(t) {
    t.x > 0 && t.x < this.width && t.y > 0 && t.y < this.height && (W.x = t.x / this.width * 2 - 1, W.y = -t.y / this.height * 2 + 1),
    wt = !0;
    var e = new THREE.Vector3,
      i = W.clone();
    l(i);
    var n = W.clone();
    a(n);
    var o = this.getIntersectionToMinDistance(n);
    if (o) {
      var r = new THREE.Vector2(o.intersectionPoint.x, o.intersectionPoint.y);
      if (n.sub(r).lengthSq() < 9) {
        var c = r.clone();
        s(c),
        l(c),
        e.set(c.x, c.y, xt)
      } else
        e.set(i.x, i.y, xt)
    } else
      e.set(i.x, i.y, xt);
    return e
  },
  this.toLocation = function(t, e) {
    var i = !1;
    t.x > 0 && t.x < this.width && t.y > 0 && t.y < this.height && (W.x = t.x / this.width * 2 - 1, W.y = -t.y / this.height * 2 + 1, wt = !0, i = !0);
    var n = mt || gt;
    if (!vt)
      return void this.highlightedNode(i, ft, !0);
    if (i && n) {
      var o = this.imageCoord2WordCoord(t),
        r = o.clone();
      "default" == this.mapClickMode
        ? e
          ? e(r)
          : (this.callbackMapClick(r), w(o), this.flyToPointWithParallelEye(o))
        : "static" == this.mapClickMode && (
          e
          ? e(r)
          : this.callbackMapClick(r)),
      this.flyToPointWithParallelEye(o)
    }
  },
  this.onContextMenu = function(t) {
    t.preventDefault()
  },
  this.onMouseDownBinded = this.onMouseDown.bind(this),
  this.onMouseMoveBinded = this.onMouseMove.bind(this),
  this.onMouseUpBinded = this.onMouseUp.bind(this),
  this.onContextMenuBinded = this.onContextMenu.bind(this),
  this.addDomEventListeners = function() {
    L && (L.addEventListener("contextmenu", this.onContextMenuBinded, !1), L.addEventListener("mousedown", this.onMouseDownBinded, !1), L.addEventListener("mousemove", this.onMouseMoveBinded, !1), L.addEventListener("mouseup", this.onMouseUpBinded, !1))
  },
  this.removeDomEventListeners = function() {
    L && (L.removeEventListener("contextmenu", this.onContextMenuBinded, !1), L.removeEventListener("mousedown", this.onMouseDownBinded, !1), L.removeEventListener("mousemove", this.onMouseMoveBinded, !1), L.removeEventListener("mouseup", this.onMouseUpBinded, !1))
  },
  this.init = function(t, e, i, n, o) {
    if (e = e || 320, i = i || 240, o = o || 0, M || (M = document.createElementNS(Z, "svg"), S = document.createElementNS(Z, "g")), this.initCanvasContainer(t, n), this.initTipNode(), this.initCameraNode(), this.setSize(e, i), this.setClearColor(3355443, o), this.clear(), this.addDomEventListeners(), yt = !1, this.callbackClickOnAxisGrid) {
      var r = {
        position: "",
        abcName: "",
        numeralName: "",
        offsetX: "",
        offsetY: ""
      };
      this.callbackClickOnAxisGrid(r)
    }
    this.initialized = !0
  },
  this.uninit = function() {
    this.initialized && (this.initialized = !1, this.removeDomEventListeners(), this.clear(), M.parentNode && M.parentNode.removeChild(M), this.remove(), L = null, M = null, S = null, this.domContainer = null, this.callbackCameraChanged = null, this.callbackClickOnAxisGrid = null, this.axisGirds = null)
  },
  this.setSize = function(t, e) {
    L && (this.width = t, this.height = e, L.style.width = t + "px", L.style.height = e + "px", D = t, R = e, U = D / 2, A = R / 2, M.setAttribute("viewBox", -U + " " + -A + " " + D + " " + R), M.setAttribute("width", D), M.setAttribute("height", R), at.min.set(-U, -A), at.max.set(U, A))
  },
  this.setClearColor = function(t, e) {
    j.set(t),
    X = void 0 !== e
      ? e
      : 1
  },
  this.clear = function() {
    for (tt = 0, et = 0, it = 0, nt = 0, ot = 0; M.childNodes.length > 0;) {
      for (; M.childNodes[0] > 0;)
        M.childNodes[0].removeChild(M.childNodes[0].childNodes[0]);
      M.removeChild(M.childNodes[0])
    }
    M.style.backgroundColor = "rgba(" + (
    255 * j.r | 0) + "," + (
    255 * j.g | 0) + "," + (
    255 * j.b | 0) + "," + X + ")"
  },
  this.render = function() {
    mt && (this.autoClear && this.clear(), this.visible && (y(), ft && (x(), E()), this.calculateCameraPosition(), bt && M.appendChild(k)))
  },
  this.initCanvasContainer = function(t, e) {
    this.domContainer = t,
    L || (L = document.createElement("div"), b(L, e), t.appendChild(L), L.appendChild(M))
  },
  this.initCameraNode = function() {
    if (!k) {
      k = document.createElementNS(Z, "g"),
      k.setAttribute("fill", "#1b8cef"),
      k.setAttribute("stroke", "#cbd7e1"),
      k.setAttribute("stroke-width", "1"),
      k.setAttribute("stroke-linejoin", "round");
      var t = document.createElementNS(Z, "circle");
      t.setAttribute("r", "6"),
      F = t;
      var e = document.createElementNS(Z, "path");
      e.setAttribute("d", "M 7 6 Q 10 0, 7 -6 L 19 0 Z"),
      H = e,
      k.appendChild(t),
      k.appendChild(e)
    }
    k.setAttribute("opacity", "0.0")
  },
  this.initTipNode = function() {
    if (!I) {
      h(".cloud-tip:after { box-sizing: border-box;display: inline;font-size: 10px;width: 100%;line-height: 1;color: #fff;content: '\\25BC';position: absolute;text-align: center;margin: -4px 0 0 0;top: 100%;left: 0;}"),
      I = document.createElement("div"),
      I.className = "",
      I.style.position = "absolute",
      I.style.display = "block",
      I.style.background = "#fff",
      I.style.color = "#000",
      I.style.padding = "0 8px 0 8px",
      I.style.borderRadius = "2px",
      I.style.fontSize = "8px",
      L.appendChild(I)
    }
    I.style.opacity = 0,
    P || (P = document.createElementNS(Z, "circle"), P.setAttribute("r", "3"), P.setAttribute("fill", "#258ae3")),
    P.style.opacity = 0,
    B || (B = document.createElementNS(Z, "line"), B.setAttribute("style", "stroke:#258ae3;stroke-width:1")),
    B.style.opacity = 0,
    N || (N = document.createElementNS(Z, "line"), N.setAttribute("style", "stroke:#258ae3;stroke-width:1")),
    N.style.opacity = 0
  },
  this.generateAxisGrid = function(t) {
    void 0 == t && (t = !0);
    var e = CLOUD.MiniMap.axisGridData;
    if (e) {
      if (e.Grids.length < 1)
        return void console.error("axis grid data error!!!");
      mt = !0;
      var i,
        n = e.mapMaxBox;
      i = t && n
        ? C(e.Grids, n)
        : e.Grids,
      this.axisGirds = i,
      this.initAxisGird(i),
      gt
        ? (
          console.log("re-initialize floor plane!!!"), this.initFloorPlane(), Ct
          ? this.fly()
          : this.render())
        : this.render()
    }
  },
  this.initAxisGird = function(t) {
    T(t),
    _(t, Y)
  },
  this.generateFloorPlane = function(t) {
    void 0 === t && (t = !1),
    Ct = t;
    var e = CLOUD.MiniMap.floorPlaneData;
    if (e) {
      var i = e.Path || e.path,
        n = e.BoundingBox || e.boundingBox,
        o = e.Elevation || e.elevation;
      if (!i || !n)
        return void console.warn("floor-plan data is error!");
      if (V = i, G = new THREE.Box3(new THREE.Vector3(n.Min.X, n.Min.Y, n.Min.Z), new THREE.Vector3(n.Max.X, n.Max.Y, n.Max.Z)), xt = .5 * (G.min.z + G.max.z), Et = o || G.min.z, gt = !0, !mt)
        return void console.warn("axis-grid is not initialized!");
      this.initFloorPlane(),
      Ct
        ? this.fly()
        : this.render()
    }
  },
  this.initFloorPlane = function() {
    var t = V,
      e = new THREE.Box2(new THREE.Vector2(G.min.x, G.min.y), new THREE.Vector2(G.max.x, G.max.y)),
      i = lt.getSize(),
      n = lt.getCenter(),
      o = e.getSize(),
      r = e.getCenter(),
      a = D / i.x,
      s = o.x * a,
      l = o.y * a,
      c = r.clone().sub(n);
    c.x *= a,
    c.y *= -a,
    lt.containsBox(e) || console.warn("the bounding-box of axis-grid is not contains the bounding-box of floor-plane!"),
    O = u(0),
    O.href.baseVal = t,
    O.setAttribute("id", "Floor-" + nt),
    O.setAttribute("preserveAspectRatio", "none"),
    O.setAttribute("width", s + ""),
    O.setAttribute("height", l + ""),
    O.setAttribute("x", -.5 * s + ""),
    O.setAttribute("y", -.5 * l + ""),
    O.setAttribute("transform", "translate(" + c.x + "," + c.y + ")")
  },
  this.resizeClientAxisGrid = function() {
    var t = this.axisGirds || CLOUD.MiniMap.axisGridData.Grids;
    this.initAxisGird(t),
    gt && this.initFloorPlane()
  },
  this.showAxisGird = function() {
    mt && (ft = !0, this.resizeClientAxisGrid(), S.style.display = "", yt && this.showTip(), this.render())
  },
  this.hideAxisGird = function() {
    mt && (ft = !1, this.resizeClientAxisGrid(), S.style.display = "none", this.hideTip(), this.render())
  },
  this.showTip = function() {
    I && (I.className = "cloud-tip", I.style.opacity = 1),
    P && (P.style.opacity = 1),
    B && (B.style.opacity = 1),
    N && (N.style.opacity = 1)
  },
  this.hideTip = function() {
    I && (I.className = "", I.style.opacity = 0),
    P && (P.style.opacity = 0),
    B && (B.style.opacity = 0),
    N && (N.style.opacity = 0)
  },
  this.highlightNodeByAxisGridNumber = function(t, e) {
    var i = this.getIntersectionByAxisGridNumber(t, e);
    i
      ? (this.setHighlightNode(i), this.showTip())
      : this.hideTip(),
    this.render()
  },
  this.highlightedNode = function(t, e, i) {
    if (yt = !1, t && e) {
      var n;
      if (i) {
        var o = W.clone();
        a(o),
        n = this.getIntersectionToMinDistance(o)
      } else
        n = this.getIntersectionByNormalizedPoint(W);
      if (
        n
        ? (yt = !0, this.setHighlightNode(n), this.showTip())
        : this.hideTip(),
      this.render(),
      this.callbackClickOnAxisGrid) {
        var r = this.getAxisGridInfoByNormalizedPoint(W);
        this.callbackClickOnAxisGrid(r)
      }
    } else
      this.hideTip(),
      this.render()
  },
  this.setHighlightNode = function(t) {
    P.setAttribute("transform", "translate(" + t.intersectionPoint.x + "," + t.intersectionPoint.y + ")"),
    I.innerHTML = t.numeralName + "-" + t.abcName;
    var e = I.getBoundingClientRect();
    I.style.left = U + t.intersectionPoint.x - .5 * e.width + "px",
    I.style.top = A + t.intersectionPoint.y - e.height - 12 + "px",
    B.setAttribute("x1", t.horizLine[0].x),
    B.setAttribute("y1", t.horizLine[0].y),
    B.setAttribute("x2", t.horizLine[1].x),
    B.setAttribute("y2", t.horizLine[1].y),
    N.setAttribute("x1", t.verticalLine[0].x),
    N.setAttribute("y1", t.verticalLine[0].y),
    N.setAttribute("x2", t.verticalLine[1].x),
    N.setAttribute("y2", t.verticalLine[1].y)
  },
  this.getMainSceneMatrix = function() {
    return this.viewer.getScene().getMatrixGlobal()
  },
  this.containsPointInMainScene = function(t) {
    var e = this.viewer.getScene().getBoundingBoxWorld();
    return !!e && e.containsPoint(t)
  },
  this.getAxisGridInfoByPoint = function(t) {
    var e = this.getMainSceneMatrix(),
      i = new THREE.Matrix4;
    i.getInverse(e);
    var n = t.clone();
    n.applyMatrix4(i);
    var o = n.clone();
    c(o),
    a(o);
    var r = this.getIntersectionToMinDistance(o);
    if (r) {
      var h = new THREE.Vector2(r.intersectionPoint.x, r.intersectionPoint.y);
      s(h),
      l(h);
      var u = Math.round(n.x - h.x),
        d = Math.round(n.y - h.y);
      return {position: n, abcName: r.abcName, numeralName: r.numeralName, offsetX: u, offsetY: d}
    }
    return {position: new THREE.Vector3, abcName: "", numeralName: "", offsetX: "", offsetY: ""}
  },
  this.getAxisGridInfoByNormalizedPoint = function(t) {
    var e = t.clone();
    l(e);
    var i = t.clone();
    a(i);
    var n = this.getIntersectionToMinDistance(i);
    if (n) {
      var o = new THREE.Vector2(n.intersectionPoint.x, n.intersectionPoint.y);
      s(o),
      l(o);
      var r = Math.round(e.x - o.x),
        c = Math.round(e.y - o.y);
      return {position: e, abcName: n.abcName, numeralName: n.numeralName, offsetX: r, offsetY: c}
    }
    return {position: new THREE.Vector3, abcName: "", numeralName: "", offsetX: "", offsetY: ""}
  },
  this.getIntersectionByNormalizedPoint = function(t) {
    for (var e = null, i = 0, n = ht.length; i < n; i++) {
      var o = ht[i].intersectionPoint,
        r = new THREE.Vector2(t.x, t.y);
      a(r);
      if (o.distanceToSquared(r) < 9) {
        e = ht[i];
        break
      }
    }
    return e
  },
  this.getIntersectionByAxisGridNumber = function(t, e) {
    for (var i = null, n = 0, o = ht.length; n < o; n++) {
      var r = ht[n].abcName.toLowerCase(),
        a = ht[n].numeralName;
      if (r === t.toLowerCase() && a === e) {
        i = ht[n];
        break
      }
    }
    return i
  },
  this.getIntersectionToMinDistance = function(t) {
    if (ht.length < 1)
      return null;
    for (var e = 0, i = 0, n = 0, o = ht.length; n < o; n++) {
      var r = ht[n],
        a = new THREE.Vector2(r.intersectionPoint.x, r.intersectionPoint.y),
        s = a.distanceToSquared(t);
      0 == n
        ? e = s
        : e > s && (e = s, i = n)
    }
    return ht[i]
  },
  this.checkFloorPlaneBox = function() {
    G || (G = this.viewer.getBoundingBoxWorld(), xt = .5 * (G.min.z + G.max.z), Et = G.min.z)
  },
  this.calculateCameraPosition = function() {
    this.checkFloorPlaneBox();
    var t = this.viewer.camera,
      e = this.viewer.cameraControl;
    if (t && e) {
      var i = t.position,
        n = t.target,
        o = this.getMainSceneMatrix(),
        s = new THREE.Matrix4;
      s.getInverse(o);
      var l = G.getCenter(),
        h = new THREE.Vector3(G.min.x, G.min.y, l.z).applyMatrix4(o),
        u = new THREE.Vector3(G.min.x, G.max.y, l.z).applyMatrix4(o),
        d = new THREE.Vector3(G.max.x, G.min.y, l.z).applyMatrix4(o),
        p = new THREE.Plane;
      p.setFromCoplanarPoints(h, u, d);
      var f = p.projectPoint(i);
      f.applyMatrix4(s);
      var m = p.projectPoint(n);
      m.applyMatrix4(s);
      var g = m.clone().sub(f);
      g.z = 0,
      g.normalize();
      var v = i.clone();
      v.applyMatrix4(s);
      var y = v.clone();
      if (c(y), a(y), k.setAttribute("opacity", "1.0"), g.length() < 1e-5)
        H.setAttribute("opacity", "0.0"),
        k.setAttribute("transform", "translate(" + y.x + "," + y.y + ")");
      else {
        var E = new THREE.Vector3(0, 0, 1),
          x = new THREE.Vector3(1, 0, 0),
          b = r(x, g, E),
          w = THREE.Math.radToDeg(x.angleTo(g));
        b || (w *= -1);
        var C = this.calculateEdgePositionCameraOutBounds(lt, f, g);
        if (C) {
          var T = new THREE.Vector2(C.x, C.y);
          c(T),
          a(T),
          H.setAttribute("opacity", "1.0"),
          F.setAttribute("opacity", "0.0"),
          k.setAttribute("transform", "translate(" + T.x + "," + T.y + ") rotate(" + w + ")")
        } else
          H.setAttribute("opacity", "1.0"),
          F.setAttribute("opacity", "1.0"),
          k.setAttribute("transform", "translate(" + y.x + "," + y.y + ") rotate(" + w + ")")
      }
      this.setCallbackCameraInfo(v, y),
      z = v.clone();
      return {
        worldPosition: v,
        projectedWorldPosition: new THREE.Vector3(f.x, f.y, xt),
        screenPosition: y
      }
    }
  },
  this.calculateEdgePositionCameraOutBounds = function(t, e, i) {
    var n = function(t, e) {
        for (var i = !1, n = 0, o = t.length; n < o; n++)
          if (CLOUD.Extensions.Utils.Geometric.isEqualBetweenPoints(e, t[n], 1e-5)) {
            i = !0;
            break
          }
        return i
      },
      o = t.clone();
    if (o.min.x -= .5, o.min.y -= .5, o.max.x += .5, o.max.y += .5, !o.containsPoint(e)) {
      var r = [],
        a = new THREE.Vector3(e.x, e.y, 0),
        s = new THREE.Ray(a, i),
        l = new THREE.Vector3(t.min.x, t.min.y, 0),
        c = new THREE.Vector3(-1, 0, 0),
        h = new THREE.Plane;
      h.setFromNormalAndCoplanarPoint(c, l);
      var u = s.intersectPlane(h);
      if (u && o.containsPoint(u) && r.push(u), l.set(t.max.x, t.max.y, 0), c.set(-1, 0, 0), h.setFromNormalAndCoplanarPoint(c, l), u = s.intersectPlane(h), u && o.containsPoint(u) && r.push(u), l.set(t.min.x, t.min.y, 0), c.set(0, 1, 0), h.setFromNormalAndCoplanarPoint(c, l), u = s.intersectPlane(h), u && o.containsPoint(u) && (n(u, r) || r.push(u)), l.set(t.max.x, t.max.y, 0), c.set(0, 1, 0), h.setFromNormalAndCoplanarPoint(c, l), u = s.intersectPlane(h), u && o.containsPoint(u) && (n(u, r) || r.push(u)), 2 != r.length)
        return null;
      var d = r[0],
        p = r[1],
        f = p.clone().sub(d).normalize();
      return CLOUD.Extensions.Utils.Geometric.isEqualBetweenPoints(f, i, 1e-5)
        ? r[0]
        : r[1]
    }
    return null
  },
  this.fly = function() {
    var t = this.calculateCameraPosition(),
      e = t.projectedWorldPosition.clone();
    w(e),
    this.flyToPointWithParallelEye(e)
  },
  this.flyToPointWithParallelEye = function(t) {
    this.viewer.cameraControl.flyToPointWithParallelEye(t)
  },
  this.flyByAxisGridNumber = function(t, e) {
    var i = this.getIntersectionByAxisGridNumber(t, e);
    if (i) {
      this.checkFloorPlaneBox();
      var n = new THREE.Vector3(i.intersectionPoint.x, i.intersectionPoint.y, xt);
      return s(n),
      l(n),
      w(n),
      this.viewer.cameraControl.flyToPointWithParallelEye(n),
      !0
    }
    return !1
  },
  this.setCallbackCameraInfo = function(t, e) {
    var i = !0;
    if (z && (i = 0 !== t.distanceToSquared(z)), this.callbackCameraChanged && i) {
      var n = t.clone(),
        o = this.getIntersectionToMinDistance(e);
      if (o) {
        var r = new THREE.Vector2(o.intersectionPoint.x, o.intersectionPoint.y);
        s(r),
        l(r);
        var a = Math.round(t.x - r.x),
          c = Math.round(t.y - r.y),
          h = Math.round(t.z - Et),
          u = "X(" + o.numeralName + "," + a + ")",
          d = "Y(" + o.abcName + "," + c + ")",
          p = !0,
          f = t.clone();
        f.setZ(xt),
        this.containsPointInMainScene(f) || (p = !1, u = "", d = "");
        var m = {
          position: n,
          isInScene: p,
          axis: {
            abcName: o.abcName,
            numeralName: o.numeralName,
            offsetX: a,
            offsetY: c,
            offsetZ: h,
            infoX: u,
            infoY: d
          }
        };
        this.callbackCameraChanged(m)
      } else {
        var m = {
          position: n,
          isInScene: !1,
          axis: {
            abcName: "",
            numeralName: "",
            offsetX: "",
            offsetY: "",
            offsetZ: "",
            infoX: "",
            infoY: ""
          }
        };
        this.callbackCameraChanged(m)
      }
    }
  },
  this.enableCameraNode = function(t) {
    bt = t
  },
  this.remove = function() {
    L && L.parentNode && L.parentNode.removeChild(L)
  },
  this.append = function() {
    L && !L.parentNode && (this.domContainer.appendChild(L), this.render())
  },
  this.setCameraChangedCallback = function(t) {
    this.callbackCameraChanged = t
  },
  this.setMapClickCallback = function(t) {
    this.callbackMapClick = t
  },
  this.setMapClickMode = function(t) {
    this.mapClickMode = t
  },
  this.setClickOnAxisGridCallback = function(t) {
    this.callbackClickOnAxisGrid = t
  },
  this.resize = function(t, e) {
    L && mt && (
      this.setSize(t, e), this.resizeClientAxisGrid(), S.style.display = ft
      ? ""
      : "none",
    this.hideTip(),
    this.render())
  }
},
CLOUD.MiniMap.axisGridData = null,
CLOUD.MiniMap.floorPlaneData = null,
CLOUD.MiniMap.setAxisGridData = function(t) {
  CLOUD.MiniMap.axisGridData = t
},
CLOUD.MiniMap.setFloorPlaneData = function(t) {
  CLOUD.MiniMap.floorPlaneData = t
},
CLOUD.Extensions.Annotation = function(t, e) {
  this.editor = t,
  this.id = e,
  this.shapeType = 0,
  this.position = {
    x: 0,
    y: 0,
    z: 0
  },
  this.size = {
    width: 0,
    height: 0
  },
  this.rotation = 0,
  this.style = t.annotationStyle
    ? CLOUD.DomUtil.cloneStyle(t.annotationStyle)
    : this.getDefaultStyle(),
  this.shape = null,
  this.selected = !1,
  this.highlighted = !1,
  this.highlightColor = "#FAFF3C",
  this.isDisableInteractions = !1,
  this.disableResizeWidth = !1,
  this.disableResizeHeight = !1,
  this.disableRotation = !1,
  this.onMouseDownBinded = this.onMouseDown.bind(this),
  this.onMouseOutBinded = this.onMouseOut.bind(this),
  this.onMouseOverBinded = this.onMouseOver.bind(this)
},
CLOUD.Extensions.Annotation.prototype = {
  constructor: CLOUD.Extensions.Annotation,
  addDomEventListeners: function() {},
  removeDomEventListeners: function() {},
  onMouseDown: function(t) {
    this.isDisableInteractions || (this.select(), this.editor.annotationFrame && this.editor.annotationFrame.dragBegin(t))
  },
  onMouseOut: function() {
    this.highlight(!1)
  },
  onMouseOver: function() {
    this.highlight(!0)
  },
  created: function() {},
  destroy: function() {
    this.removeDomEventListeners(),
    this.deselect(),
    this.setParent(null)
  },
  set: function(t, e, i) {
    this.position.x = t.x,
    this.position.y = t.y,
    this.position.z = t.z,
    this.size.width = e.width,
    this.size.height = e.height,
    this.rotation = i || 0,
    this.update()
  },
  resetRotation: function(t) {
    this.rotation = t,
    this.update()
  },
  getRotation: function() {
    return this.rotation
  },
  resetPosition: function(t) {
    this.position.x = t.x,
    this.position.y = t.y,
    this.position.z = t.z,
    this.update()
  },
  getClientPosition: function() {
    return this.editor.getAnnotationClientPosition(this.position)
  },
  resetSize: function(t, e) {
    this.size.width = t.width,
    this.size.height = t.height,
    this.position.x = e.x,
    this.position.y = e.y,
    this.position.z = e.z,
    this.update()
  },
  getClientSize: function() {
    return this.editor.getAnnotationClientSize(this.size, this.position)
  },
  setParent: function(t) {
    var e = this.shape;
    e.parentNode && e.parentNode.removeChild(e),
    t && t.appendChild(e)
  },
  setStyle: function(t) {
    this.style = CLOUD.DomUtil.cloneStyle(t),
    this.update(!0)
  },
  getStyle: function() {
    return CLOUD.DomUtil.cloneStyle(this.style)
  },
  updateStyle: function(t) {
    this.style = CLOUD.DomUtil.cloneStyle(t),
    this.update(!0)
  },
  update: function() {},
  select: function() {
    this.selected || (this.selected = !0, this.highlighted = !1, this.update(), this.editor.selectAnnotation(this))
  },
  deselect: function() {
    this.selected = !1
  },
  highlight: function(t) {
    this.isDisableInteractions || (this.highlighted = t, this.update())
  },
  disableInteractions: function(t) {
    this.isDisableInteractions = t
  },
  delete: function() {
    this.editor.deleteAnnotation(this)
  },
  getDefaultStyle: function() {
    var t = {};
    return t["stroke-width"] = 3,
    t["stroke-color"] = "#ff0000",
    t["stroke-opacity"] = 1,
    t["fill-color"] = "#ff0000",
    t["fill-opacity"] = 0,
    t["font-family"] = "Arial",
    t["font-size"] = 16,
    t["font-style"] = "",
    t["font-weight"] = "",
    t
  }
},
CLOUD.Extensions.Annotation.shapeTypes = {
  ARROW: 0,
  RECTANGLE: 1,
  CIRCLE: 2,
  CROSS: 3,
  CLOUD: 4,
  TEXT: 5
},
CLOUD.Extensions.AnnotationArrow = function(t, e) {
  CLOUD.Extensions.Annotation.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Annotation.shapeTypes.ARROW,
  this.head = new THREE.Vector2,
  this.tail = new THREE.Vector2,
  this.disableResizeHeight = !0,
  this.size.height = 4 * this.style["stroke-width"],
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.AnnotationArrow.prototype = Object.create(CLOUD.Extensions.Annotation.prototype),
CLOUD.Extensions.AnnotationArrow.prototype.constructor = CLOUD.Extensions.AnnotationArrow,
CLOUD.Extensions.AnnotationArrow.prototype.addDomEventListeners = function() {
  this.shape.addEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.addEventListener("mouseout", this.onMouseOutBinded),
  this.shape.addEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationArrow.prototype.removeDomEventListeners = function() {
  this.shape.removeEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.removeEventListener("mouseout", this.onMouseOutBinded),
  this.shape.removeEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationArrow.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("polygon")
},
CLOUD.Extensions.AnnotationArrow.prototype.setByTailHead = function(t, e) {
  var i = new THREE.Vector2(t.x, t.y),
    n = new THREE.Vector2(e.x, e.y),
    o = n.clone().sub(i).normalize();
  this.size.width = i.distanceTo(n),
  this.rotation = Math.acos(o.dot(new THREE.Vector2(1, 0))),
  this.rotation = e.y > t.y
    ? 2 * Math.PI - this.rotation
    : this.rotation,
  this.tail.set(t.x, t.y),
  this.head.set(e.x, e.y);
  var r = t.z;
  this.position.x = .5 * (this.head.x + this.tail.x),
  this.position.y = .5 * (this.head.y + this.tail.y),
  this.position.z = r,
  this.update()
},
CLOUD.Extensions.AnnotationArrow.prototype.getClientSize = function() {
  var t = this.editor.getAnnotationClientSize(this.size, this.position);
  return t.height = 4 * this.style["stroke-width"],
  t
},
CLOUD.Extensions.AnnotationArrow.prototype.resetSize = function(t, e) {
  var i = new THREE.Vector2(Math.cos(this.rotation), Math.sin(this.rotation));
  i.multiplyScalar(.5 * t.width);
  var n = new THREE.Vector2(e.x, e.y),
    o = n.clone().sub(i),
    r = n.clone().add(i);
  this.tail.set(o.x, o.y),
  this.head.set(r.x, r.y),
  this.position.x = e.x,
  this.position.y = e.y,
  this.position.z = e.z,
  this.size.width = t.width,
  this.update()
},
CLOUD.Extensions.AnnotationArrow.prototype.resetPosition = function(t) {
  var e = this.head.x - this.tail.x,
    i = this.head.y - this.tail.y;
  this.tail.x = t.x - .5 * e,
  this.tail.y = t.y - .5 * i,
  this.head.x = this.tail.x + e,
  this.head.y = this.tail.y + i,
  this.position.x = t.x,
  this.position.y = t.y,
  this.position.z = t.z,
  this.update()
},
CLOUD.Extensions.AnnotationArrow.prototype.update = function() {
  var t = this.highlighted
      ? this.highlightColor
      : this.style["stroke-color"],
    e = this.style["stroke-opacity"],
    i = this.getShapePoints(),
    n = i.map(function(t) {
      return t[0] + "," + t[1]
    }),
    o = n.join(" "),
    r = this.getClientPosition(),
    a = this.getClientSize(),
    s = .5 * a.width,
    l = .5 * a.height;
  this.transformShape = [
    "translate(",
    r.x,
    ",",
    r.y,
    ") ",
    "rotate(",
    THREE.Math.radToDeg(this.rotation),
    ") ",
    "translate(", -s,
    ",", -l,
    ") "
  ].join(""),
  this.shape.setAttribute("points", o),
  this.shape.setAttribute("transform", this.transformShape),
  this.shape.setAttribute("fill", t),
  this.shape.setAttribute("opacity", e)
},
CLOUD.Extensions.AnnotationArrow.prototype.getShapePoints = function() {
  var t = 2 * this.style["stroke-width"],
    e = this.getClientSize(),
    i = .5 * e.width,
    n = t,
    o = .5 * t,
    r = i - 2 * n,
    a = [
      -i, -o
    ],
    s = [
      r, -o
    ],
    l = [
      r, -n
    ],
    c = [
      i, 0
    ],
    h = [
      r, n
    ],
    u = [
      r, o
    ],
    d = [
      -i,
      o
    ],
    p = [
      a,
      s,
      l,
      c,
      h,
      u,
      d
    ];
  return p.forEach(function(t) {
    t[0] += i,
    t[1] += n
  }),
  p
},
CLOUD.Extensions.AnnotationArrow.prototype.renderToCanvas = function(t) {
  var e = 2 * this.style["stroke-width"],
    i = this.style["stroke-color"],
    n = this.style["stroke-opacity"],
    o = this.getClientPosition(),
    r = this.getClientSize(),
    a = .5 * r.width,
    s = e,
    l = (new THREE.Matrix4).makeTranslation(-a, -s, 0),
    c = (new THREE.Matrix4).makeRotationZ(this.rotation),
    h = (new THREE.Matrix4).makeTranslation(o.x, o.y, 0),
    u = h.multiply(c).multiply(l),
    d = this.getShapePoints();
  t.fillStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(i, n),
  t.beginPath(),
  d.forEach(function(e) {
    var i = new THREE.Vector3(e[0], e[1], 0);
    i.applyMatrix4(u),
    t.lineTo(i.x, i.y)
  }),
  t.fill()
},
CLOUD.Extensions.AnnotationRectangle = function(t, e) {
  CLOUD.Extensions.Annotation.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Annotation.shapeTypes.RECTANGLE,
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.AnnotationRectangle.prototype = Object.create(CLOUD.Extensions.Annotation.prototype),
CLOUD.Extensions.AnnotationRectangle.prototype.constructor = CLOUD.Extensions.AnnotationRectangle,
CLOUD.Extensions.AnnotationRectangle.prototype.addDomEventListeners = function() {
  this.shape.addEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.addEventListener("mouseout", this.onMouseOutBinded),
  this.shape.addEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationRectangle.prototype.removeDomEventListeners = function() {
  this.shape.removeEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.removeEventListener("mouseout", this.onMouseOutBinded),
  this.shape.removeEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationRectangle.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("rect")
},
CLOUD.Extensions.AnnotationRectangle.prototype.update = function() {
  var t = this.style["stroke-width"],
    e = this.highlighted
      ? this.highlightColor
      : this.style["stroke-color"],
    i = this.style["stroke-opacity"],
    n = this.style["fill-color"],
    o = this.style["fill-opacity"],
    r = this.getClientPosition(),
    a = this.getClientSize(),
    s = Math.max(a.width - t, 0),
    l = Math.max(a.height - t, 0),
    c = .5 * s,
    h = .5 * l;
  this.transformShape = [
    "translate(",
    r.x,
    ",",
    r.y,
    ") ",
    "rotate(",
    THREE.Math.radToDeg(this.rotation),
    ") ",
    "translate(", -c,
    ",", -h,
    ") "
  ].join(""),
  this.shape.setAttribute("transform", this.transformShape),
  this.shape.setAttribute("stroke-width", t),
  this.shape.setAttribute("stroke", CLOUD.Extensions.Utils.Shape2D.getRGBAString(e, i)),
  this.shape.setAttribute("fill", CLOUD.Extensions.Utils.Shape2D.getRGBAString(n, o)),
  this.shape.setAttribute("width", s + ""),
  this.shape.setAttribute("height", l + "")
},
CLOUD.Extensions.AnnotationRectangle.prototype.renderToCanvas = function(t) {
  var e = this.style["stroke-width"],
    i = this.highlighted
      ? this.highlightColor
      : this.style["stroke-color"],
    n = this.style["stroke-opacity"],
    o = this.style["fill-color"],
    r = this.style["fill-opacity"],
    a = this.getClientSize(),
    s = this.getClientPosition(),
    l = Math.max(a.width - e, 0),
    c = Math.max(a.height - e, 0);
  t.strokeStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(i, n),
  t.fillStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(o, r),
  t.lineWidth = e,
  t.translate(s.x, s.y),
  t.rotate(this.rotation),
  t.beginPath(),
  0 !== r && t.fillRect(l / -2, c / -2, l, c),
  t.strokeRect(l / -2, c / -2, l, c)
},
CLOUD.Extensions.AnnotationCircle = function(t, e) {
  CLOUD.Extensions.Annotation.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Annotation.shapeTypes.CIRCLE,
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.AnnotationCircle.prototype = Object.create(CLOUD.Extensions.Annotation.prototype),
CLOUD.Extensions.AnnotationCircle.prototype.constructor = CLOUD.Extensions.AnnotationCircle,
CLOUD.Extensions.AnnotationCircle.prototype.addDomEventListeners = function() {
  this.shape.addEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.addEventListener("mouseout", this.onMouseOutBinded),
  this.shape.addEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationCircle.prototype.removeDomEventListeners = function() {
  this.shape.removeEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.removeEventListener("mouseout", this.onMouseOutBinded),
  this.shape.removeEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationCircle.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("ellipse")
},
CLOUD.Extensions.AnnotationCircle.prototype.update = function() {
  var t = this.style["stroke-width"],
    e = this.highlighted
      ? this.highlightColor
      : this.style["stroke-color"],
    i = this.style["stroke-opacity"],
    n = this.style["fill-color"],
    o = this.style["fill-opacity"],
    r = this.getClientPosition(),
    a = this.getClientSize(),
    s = .5 * Math.max(a.width - t, 0),
    l = .5 * Math.max(a.height - t, 0);
  this.transformShape = [
    "translate(",
    r.x,
    ",",
    r.y,
    ") ",
    "rotate(",
    THREE.Math.radToDeg(this.rotation),
    ") ",
    "translate(", -s,
    ",", -l,
    ") "
  ].join(""),
  this.shape.setAttribute("transform", this.transformShape),
  this.shape.setAttribute("stroke-width", t),
  this.shape.setAttribute("stroke", CLOUD.Extensions.Utils.Shape2D.getRGBAString(e, i)),
  this.shape.setAttribute("fill", CLOUD.Extensions.Utils.Shape2D.getRGBAString(n, o)),
  this.shape.setAttribute("cx", s),
  this.shape.setAttribute("cy", l),
  this.shape.setAttribute("rx", s),
  this.shape.setAttribute("ry", l)
},
CLOUD.Extensions.AnnotationCircle.prototype.renderToCanvas = function(t) {
  var e = this.style["stroke-width"],
    i = this.style["stroke-color"],
    n = this.style["stroke-opacity"],
    o = this.style["fill-color"],
    r = this.style["fill-opacity"],
    a = this.getClientPosition(),
    s = this.getClientSize(),
    l = Math.max(s.width - e, 0),
    c = Math.max(s.height - e, 0);
  t.strokeStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(i, n),
  t.fillStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(o, r),
  t.lineWidth = e,
  t.translate(a.x, a.y),
  t.rotate(this.rotation),
  function(t, e, i, n, o) {
    t.beginPath();
    var r = e - n / 2,
      a = e + n / 2,
      s = i - o / 2,
      l = i + o / 2,
      c = .551784 * n / 2,
      h = .551784 * o / 2;
    t.moveTo(e, s),
    t.bezierCurveTo(e + c, s, a, i - h, a, i),
    t.bezierCurveTo(a, i + h, e + c, l, e, l),
    t.bezierCurveTo(e - c, l, r, i + h, r, i),
    t.bezierCurveTo(r, i - h, e - c, s, e, s),
    t.stroke()
  }(t, 0, 0, l, c),
  0 !== r && t.fill()
},
CLOUD.Extensions.AnnotationCloud = function(t, e) {
  CLOUD.Extensions.Annotation.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Annotation.shapeTypes.CLOUD,
  this.shapePoints = [],
  this.trackingPoint = {
    x: 0,
    y: 0
  },
  this.isSeal = !1,
  this.isTracking = !1,
  this.isEnableTrack = !1,
  this.originSize = {
    width: 1,
    height: 1
  },
  this.viewBox = {
    width: 1e3,
    height: 1e3
  },
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.AnnotationCloud.prototype = Object.create(CLOUD.Extensions.Annotation.prototype),
CLOUD.Extensions.AnnotationCloud.prototype.constructor = CLOUD.Extensions.AnnotationCloud,
CLOUD.Extensions.AnnotationCloud.prototype.addDomEventListeners = function() {
  this.shape.addEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.addEventListener("mouseout", this.onMouseOutBinded),
  this.shape.addEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationCloud.prototype.removeDomEventListeners = function() {
  this.shape.removeEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.removeEventListener("mouseout", this.onMouseOutBinded),
  this.shape.removeEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationCloud.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("path")
},
CLOUD.Extensions.AnnotationCloud.prototype.setByPositions = function(t, e) {
  this.positions = t.concat(),
  this.isSeal = e || !1,
  this.calculatePosition(!0),
  this.originSize.width = 0 === this.size.width
    ? 1
    : this.size.width,
  this.originSize.height = 0 === this.size.height
    ? 1
    : this.size.height,
  this.update()
},
CLOUD.Extensions.AnnotationCloud.prototype.set = function(t, e, i, n, o) {
  this.position.x = t.x,
  this.position.y = t.y,
  this.position.z = t.z,
  this.size.width = e.width,
  this.size.height = e.height,
  this.rotation = i || 0,
  o
    ? (
      this.originSize.width = 0 === o.width
      ? 1
      : o.width,
    this.originSize.height = 0 === o.height
      ? 1
      : o.height)
    : (
      this.originSize.width = 0 === this.size.width
      ? 1
      : this.size.width,
    this.originSize.height = 0 === this.size.height
      ? 1
      : this.size.height),
  this.setShapePoints(n),
  this.update()
},
CLOUD.Extensions.AnnotationCloud.prototype.setTrackingPoint = function(t) {
  this.trackingPoint.x = t.x,
  this.trackingPoint.y = t.y,
  this.calculatePosition(!1),
  this.update()
},
CLOUD.Extensions.AnnotationCloud.prototype.update = function() {
  if (!(this.shapePoints.length < 1)) {
    var t = this.getPathString(),
      e = this.style["stroke-width"],
      i = this.highlighted
        ? this.highlightColor
        : this.style["stroke-color"],
      n = this.style["stroke-opacity"],
      o = this.style["fill-color"],
      r = this.style["fill-opacity"];
    this.shape.setAttribute("stroke-width", e),
    this.shape.setAttribute("stroke", CLOUD.Extensions.Utils.Shape2D.getRGBAString(i, n)),
    this.shape.setAttribute("fill", CLOUD.Extensions.Utils.Shape2D.getRGBAString(o, r)),
    this.shape.setAttribute("d", t)
  }
},
CLOUD.Extensions.AnnotationCloud.prototype.worldToViewBox = function(t) {
  var e = this.originSize.width,
    i = this.originSize.height,
    n = this.viewBox.width,
    o = this.viewBox.height;
  return {
    x: Math.floor(t.x / e * n + .5),
    y: Math.floor(t.y / i * o + .5)
  }
},
CLOUD.Extensions.AnnotationCloud.prototype.viewBoxToWorld = function(t) {
  var e = this.originSize.width,
    i = this.originSize.height,
    n = this.viewBox.width,
    o = this.viewBox.height;
  return {
    x: t.x / n * e,
    y: t.y / o * i
  }
},
CLOUD.Extensions.AnnotationCloud.prototype.getPathString = function() {
  var t,
    e,
    i,
    n,
    o = this.size.width / this.originSize.width,
    r = this.size.height / this.originSize.height,
    a = (new THREE.Matrix4).makeScale(o, r, 1),
    s = (new THREE.Matrix4).makeRotationZ(-this.rotation),
    l = (new THREE.Matrix4).makeTranslation(this.position.x, this.position.y, this.position.z),
    c = l.multiply(s).multiply(a),
    h = this,
    u = new THREE.Vector3,
    d = this.shapePoints.map(function(o, r) {
      return 0 === r
        ? (u.x = o.x, u.y = o.y, u.z = 0, u.applyMatrix4(c), u = h.editor.worldToClient(u), t = u.x, e = u.y, ["M"].concat([t, e]).join(" "))
        : (u.x = o.cx, u.y = o.cy, u.z = 0, u.applyMatrix4(c), u = h.editor.worldToClient(u), i = u.x, n = u.y, u.x = o.x, u.y = o.y, u.z = 0, u.applyMatrix4(c), u = h.editor.worldToClient(u), t = u.x, e = u.y, ["Q"].concat([i, n, t, e]).join(" "))
    }).join(" ");
  return this.isSeal && (d += "Z"),
  d
},
CLOUD.Extensions.AnnotationCloud.prototype.getControlPoint = function(t, e) {
  var i = new THREE.Vector2(t.x, t.y),
    n = new THREE.Vector2(e.x, e.y),
    o = n.clone().sub(i),
    r = .5 * o.length(),
    a = .5 * (i.x + n.x),
    s = .5 * (i.y + n.y),
    l = new THREE.Vector2(a, s);
  return 0 == r
    ? null
    : (o.normalize(), o.rotateAround(new THREE.Vector2(0, 0), .5 * Math.PI), o.multiplyScalar(r), l.add(o), {
      x: l.x,
      y: l.y
    })
},
CLOUD.Extensions.AnnotationCloud.prototype.getBoundingBox = function() {
  for (var t = new THREE.Box2, e = new THREE.Vector2, i = 0, n = this.shapePoints.length; i < n; i++)
    0 === i
      ? (e.set(this.shapePoints[i].x, this.shapePoints[i].y), t.expandByPoint(e))
      : (e.set(this.shapePoints[i].cx, this.shapePoints[i].cy), t.expandByPoint(e), e.set(this.shapePoints[i].x, this.shapePoints[i].y), t.expandByPoint(e));
  return t
},
CLOUD.Extensions.AnnotationCloud.prototype.calculateShapePath = function() {
  var t,
    e = {},
    i = {},
    n = {},
    o = this.positions.length;
  if (this.shapePoints = [], !(o < 1))
    if (this.depth = this.positions[0].z || 0, 1 === o)
      i.x = this.positions[0].x,
      i.y = this.positions[0].y,
      this.shapePoints.push({x: this.positions[0].x, y: this.positions[0].y}),
      this.isTracking && (t = this.getControlPoint(i, this.trackingPoint)) && this.shapePoints.push({cx: t.x, cy: t.y, x: this.trackingPoint.x, y: this.trackingPoint.y});
    else
      for (var r = 0; r < o; r++)
        i.x = this.positions[r].x,
        i.y = this.positions[r].y,
        0 === r
          ? (this.shapePoints.push({x: this.positions[r].x, y: this.positions[r].y}), n.x = this.positions[r].x, n.y = this.positions[r].y, e.x = this.positions[r].x, e.y = this.positions[r].y)
          : (t = this.getControlPoint(n, i), t && this.shapePoints.push({cx: t.x, cy: t.y, x: i.x, y: i.y}), n.x = i.x, n.y = i.y, r === o - 1 && (
            this.isTracking
            ? (t = this.getControlPoint(n, this.trackingPoint)) && this.shapePoints.push({cx: t.x, cy: t.y, x: this.trackingPoint.x, y: this.trackingPoint.y})
            : this.isSeal && (t = this.getControlPoint(n, e)) && this.shapePoints.push({cx: t.x, cy: t.y, x: e.x, y: e.y})))
    },
CLOUD.Extensions.AnnotationCloud.prototype.calculateRelativePosition = function(t) {
  for (var e = 0, i = this.shapePoints.length; e < i; e++)
    0 === e
      ? (this.shapePoints[e].x -= t.x, this.shapePoints[e].y -= t.y)
      : (this.shapePoints[e].x -= t.x, this.shapePoints[e].y -= t.y, this.shapePoints[e].cx -= t.x, this.shapePoints[e].cy -= t.y)
  },
CLOUD.Extensions.AnnotationCloud.prototype.calculatePosition = function(t) {
  if (t = t || !1, this.calculateShapePath(), t) {
    var e = this.getBoundingBox(),
      i = e.getCenter();
    this.center = {
      x: i.x,
      y: i.y
    },
    this.position.x = i.x,
    this.position.y = i.y,
    this.position.z = this.depth || 0,
    this.calculateRelativePosition(i),
    e = this.getBoundingBox();
    var n = e.getSize();
    this.size.width = n.x || 16,
    this.size.height = n.y || 16
  } else
    this.center && this.calculateRelativePosition(this.center)
},
CLOUD.Extensions.AnnotationCloud.prototype.startTrack = function() {
  this.isTracking = !0
},
CLOUD.Extensions.AnnotationCloud.prototype.finishTrack = function() {
  this.isTracking = !1
},
CLOUD.Extensions.AnnotationCloud.prototype.enableTrack = function() {
  this.isEnableTrack = !0
},
CLOUD.Extensions.AnnotationCloud.prototype.disableTrack = function() {
  this.isEnableTrack = !1
},
CLOUD.Extensions.AnnotationCloud.prototype.getTrackState = function() {
  return this.isEnableTrack
},
CLOUD.Extensions.AnnotationCloud.prototype.setSeal = function(t) {
  this.isSeal = t,
  this.calculatePosition(!1),
  this.update()
},
CLOUD.Extensions.AnnotationCloud.prototype.setShapePoints = function(t) {
  var e,
    i,
    n,
    o,
    r,
    a = t.split(","),
    s = parseInt(a[0]),
    l = parseInt(a[1]);
  r = this.viewBoxToWorld({x: s, y: l}),
  s = r.x,
  l = r.y,
  this.shapePoints = [],
  this.shapePoints.push({x: s, y: l});
  for (var c = 2, h = a.length; c < h; c += 4)
    n = parseInt(a[c]),
    o = parseInt(a[c + 1]),
    r = this.viewBoxToWorld({x: n, y: o}),
    n = r.x,
    o = r.y,
    e = parseInt(a[c + 2]),
    i = parseInt(a[c + 3]),
    r = this.viewBoxToWorld({x: e, y: i}),
    e = r.x,
    i = r.y,
    this.shapePoints.push({cx: n, cy: o, x: e, y: i})
},
CLOUD.Extensions.AnnotationCloud.prototype.getShapePoints = function() {
  for (var t, e, i, n, o, r = [], a = 0, s = this.shapePoints.length; a < s; a++)
    0 === a
      ? (t = this.shapePoints[a].x, e = this.shapePoints[a].y, o = this.worldToViewBox({x: t, y: e}), t = o.x, e = o.y, r.push(t), r.push(e))
      : (i = this.shapePoints[a].cx, n = this.shapePoints[a].cy, o = this.worldToViewBox({x: i, y: n}), i = o.x, n = o.y, r.push(i), r.push(n), t = this.shapePoints[a].x, e = this.shapePoints[a].y, o = this.worldToViewBox({x: t, y: e}), t = o.x, e = o.y, r.push(t), r.push(e));
  return r.join(",")
},
CLOUD.Extensions.AnnotationCloud.prototype.renderToCanvas = function(t) {
  if (!(this.shapePoints.length < 2)) {
    var e = this.style["stroke-width"],
      i = this.highlighted
        ? this.highlightColor
        : this.style["stroke-color"],
      n = this.style["stroke-opacity"],
      o = this.style["fill-color"],
      r = this.style["fill-opacity"];
    t.strokeStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(i, n),
    t.fillStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(o, r),
    t.lineWidth = e;
    var a = this.size.width / this.originSize.width,
      s = this.size.height / this.originSize.height,
      l = (new THREE.Matrix4).makeScale(a, s, 1),
      c = (new THREE.Matrix4).makeRotationZ(-this.rotation),
      h = (new THREE.Matrix4).makeTranslation(this.position.x, this.position.y, this.position.z),
      u = h.multiply(c).multiply(l),
      d = this;
    t.beginPath();
    var p,
      f,
      m,
      g,
      v = new THREE.Vector3;
    this.shapePoints.forEach(function(e, i) {
      0 === i
        ? (v.x = e.x, v.y = e.y, v.z = 0, v.applyMatrix4(u), v = d.editor.worldToClient(v), p = v.x, f = v.y, t.moveTo(p, f))
        : (v.x = e.cx, v.y = e.cy, v.z = 0, v.applyMatrix4(u), v = d.editor.worldToClient(v), m = v.x, g = v.y, v.x = e.x, v.y = e.y, v.z = 0, v.applyMatrix4(u), v = d.editor.worldToClient(v), p = v.x, f = v.y, t.quadraticCurveTo(m, g, p, f))
    }),
    t.stroke(),
    0 !== r && t.fill(),
    t.stroke()
  }
},
CLOUD.Extensions.AnnotationCross = function(t, e) {
  CLOUD.Extensions.Annotation.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Annotation.shapeTypes.CROSS,
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.AnnotationCross.prototype = Object.create(CLOUD.Extensions.Annotation.prototype),
CLOUD.Extensions.AnnotationCross.prototype.constructor = CLOUD.Extensions.AnnotationCross,
CLOUD.Extensions.AnnotationCross.prototype.addDomEventListeners = function() {
  this.shape.addEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.addEventListener("mouseout", this.onMouseOutBinded),
  this.shape.addEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationCross.prototype.removeDomEventListeners = function() {
  this.shape.removeEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.removeEventListener("mouseout", this.onMouseOutBinded),
  this.shape.removeEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationCross.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("path")
},
CLOUD.Extensions.AnnotationCross.prototype.update = function() {
  var t = this.style["stroke-width"],
    e = this.highlighted
      ? this.highlightColor
      : this.style["stroke-color"],
    i = this.style["stroke-opacity"],
    n = this.style["fill-color"],
    o = this.style["fill-opacity"],
    r = this.getClientPosition(),
    a = this.getClientSize(),
    s = .5 * Math.max(a.width - t, 0),
    l = .5 * Math.max(a.height - t, 0);
  this.transformShape = [
    "translate(",
    r.x,
    ",",
    r.y,
    ") ",
    "rotate(",
    THREE.Math.radToDeg(this.rotation),
    ") ",
    "translate(", -s,
    ",", -l,
    ") "
  ].join(""),
  this.shape.setAttribute("transform", this.transformShape),
  this.shape.setAttribute("stroke-width", t),
  this.shape.setAttribute("stroke", CLOUD.Extensions.Utils.Shape2D.getRGBAString(e, i)),
  this.shape.setAttribute("fill", CLOUD.Extensions.Utils.Shape2D.getRGBAString(n, o)),
  this.shape.setAttribute("d", this.getPath().join(" "))
},
CLOUD.Extensions.AnnotationCross.prototype.getPath = function() {
  var t = this.getClientSize(),
    e = t.width,
    i = t.height,
    n = [];
  return n.push("M"),
  n.push(0),
  n.push(0),
  n.push("L"),
  n.push(e),
  n.push(i),
  n.push("z"),
  n.push("M"),
  n.push(0),
  n.push(i),
  n.push("L"),
  n.push(e),
  n.push(0),
  n.push("z"),
  n
},
CLOUD.Extensions.AnnotationCross.prototype.renderToCanvas = function(t) {
  var e = this.style["stroke-width"],
    i = this.highlighted
      ? this.highlightColor
      : this.style["stroke-color"],
    n = this.style["stroke-opacity"],
    o = this.style["fill-color"],
    r = this.style["fill-opacity"],
    a = this.getClientPosition(),
    s = this.getClientSize(),
    l = Math.max(s.width - e, 0),
    c = Math.max(s.height - e, 0);
  t.strokeStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(i, n),
  t.fillStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(o, r),
  t.lineWidth = e,
  t.translate(a.x, a.y),
  t.rotate(this.rotation),
  t.translate(-.5 * l, -.5 * c),
  t.beginPath(),
  t.moveTo(0, 0),
  t.lineTo(l, c),
  t.moveTo(0, c),
  t.lineTo(l, 0),
  t.stroke(),
  0 !== r && t.fill(),
  t.stroke()
},
CLOUD.Extensions.AnnotationText = function(t, e) {
  CLOUD.Extensions.Annotation.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Annotation.shapeTypes.TEXT,
  this.currText = "",
  this.currTextLines = [""],
  this.textDirty = !0,
  this.lineHeight = 100,
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.AnnotationText.prototype = Object.create(CLOUD.Extensions.Annotation.prototype),
CLOUD.Extensions.AnnotationText.prototype.constructor = CLOUD.Extensions.AnnotationText,
CLOUD.Extensions.AnnotationText.prototype.addDomEventListeners = function() {
  this.shape.addEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.addEventListener("mouseout", this.onMouseOutBinded),
  this.shape.addEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationText.prototype.removeDomEventListeners = function() {
  this.shape.removeEventListener("mousedown", this.onMouseDownBinded, !0),
  this.shape.removeEventListener("mouseout", this.onMouseOutBinded),
  this.shape.removeEventListener("mouseover", this.onMouseOverBinded)
},
CLOUD.Extensions.AnnotationText.prototype.createShape = function() {
  this.clipPath = CLOUD.Extensions.Utils.Shape2D.createSvgElement("clipPath"),
  this.clipPathId = "clip_" + this.id,
  this.clipPath.setAttribute("id", this.clipPathId),
  this.clipPath.removeAttribute("pointer-events"),
  this.clipRect = CLOUD.Extensions.Utils.Shape2D.createSvgElement("rect"),
  this.clipRect.removeAttribute("pointer-events"),
  this.clipPath.appendChild(this.clipRect),
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("text"),
  this.backgroundRect = CLOUD.Extensions.Utils.Shape2D.createSvgElement("rect")
},
CLOUD.Extensions.AnnotationText.prototype.set = function(t, e, i, n) {
  this.position.x = t.x,
  this.position.y = t.y,
  this.position.z = t.z,
  this.size.width = e.width,
  this.size.height = e.height,
  this.rotation = i,
  this.setText(n)
},
CLOUD.Extensions.AnnotationText.prototype.resetSize = function(t, e) {
  var i = this.getClientSize(),
    n = Math.floor(i.width) !== t.width;
  if (this.position.x = e.x, this.position.y = e.y, this.position.z = e.z, this.size.width = t.width, this.size.height = t.height, n) {
    var o = this.calcTextLines();
    this.linesEqual(o) || (this.currTextLines = o, this.textDirty = !0, this.forceRedraw())
  }
  this.update()
},
CLOUD.Extensions.AnnotationText.prototype.setText = function(t) {
  this.currText = t,
  this.currTextLines = this.calcTextLines(),
  this.textDirty = !0,
  this.show(),
  this.update()
},
CLOUD.Extensions.AnnotationText.prototype.getText = function() {
  return this.currText
},
CLOUD.Extensions.AnnotationText.prototype.setParent = function(t) {
  var e = this.clipPath.parentNode;
  e && e.removeChild(this.clipPath),
  t && t.appendChild(this.clipPath),
  e = this.backgroundRect.parentNode,
  e && e.removeChild(this.backgroundRect),
  t && t.appendChild(this.backgroundRect),
  e = this.shape.parentNode,
  e && e.removeChild(this.shape),
  t && t.appendChild(this.shape)
},
CLOUD.Extensions.AnnotationText.prototype.update = function(t) {
  var e = this.style["font-size"],
    i = this.highlighted
      ? this.highlightColor
      : this.style["stroke-color"],
    n = this.style["stroke-opacity"],
    o = this.style["fill-color"],
    r = this.style["fill-opacity"],
    a = this.getClientPosition(),
    s = this.getClientSize(),
    l = .5 * s.width,
    c = .5 * s.height;
  this.transformShape = [
    "translate(",
    a.x,
    ",",
    a.y,
    ") ",
    "rotate(",
    THREE.Math.radToDeg(this.rotation),
    ") ",
    "translate(", -l,
    ",", -c,
    ") "
  ].join(""),
  this.shape.setAttribute("font-family", this.style["font-family"]),
  this.shape.setAttribute("font-size", e),
  this.shape.setAttribute("font-weight", this.style["font-weight"]),
  this.shape.setAttribute("font-style", this.style["font-style"]),
  this.shape.setAttribute("fill", CLOUD.Extensions.Utils.Shape2D.getRGBAString(i, n));
  var h = ["translate(0, ", e, ")"].join("");
  this.shape.setAttribute("transform", this.transformShape + h),
  (this.textDirty || t) && (t && (this.currTextLines = this.calcTextLines()), this.rebuildTextSvg(), this.textDirty = !1);
  var u = {
    x: 0,
    y: 0,
    left: 0,
    right: 0
  };
  this.shapeBox = u,
  this.clipRect.setAttribute("x", "0"),
  this.clipRect.setAttribute("y", u.y + ""),
  this.clipRect.setAttribute("width", s.width),
  this.clipRect.setAttribute("height", s.height),
  h = ["translate(0, ", s.height, ")"].join(""),
  this.backgroundRect.setAttribute("transform", this.transformShape),
  this.backgroundRect.setAttribute("width", s.width),
  this.backgroundRect.setAttribute("height", s.height),
  this.backgroundRect.setAttribute("stroke-width", "0"),
  this.backgroundRect.setAttribute("fill", CLOUD.Extensions.Utils.Shape2D.getRGBAString(o, r))
},
CLOUD.Extensions.AnnotationText.prototype.show = function() {
  "" !== this.shape.style.display && (this.shape.style.display = "")
},
CLOUD.Extensions.AnnotationText.prototype.hide = function() {
  "none" !== this.shape.style.display && (this.shape.style.display = "none")
},
CLOUD.Extensions.AnnotationText.prototype.forceRedraw = function() {
  window.requestAnimationFrame(function() {
    this.highlighted = !this.highlighted,
    this.update(),
    this.highlighted = !this.highlighted,
    this.update()
  }.bind(this))
},
CLOUD.Extensions.AnnotationText.prototype.rebuildTextSvg = function() {
  for (; this.shape.childNodes.length > 0;)
    this.shape.removeChild(this.shape.childNodes[0]);
  var t = 0,
    e = this.getLineHeight();
  this.currTextLines.forEach(function(i) {
    var n = CLOUD.Extensions.Utils.Shape2D.createSvgElement("tspan");
    n.setAttribute("x", 0),
    n.setAttribute("y", t),
    n.textContent = i,
    this.shape.appendChild(n),
    t += e
  }.bind(this))
},
CLOUD.Extensions.AnnotationText.prototype.getLineHeight = function() {
  return this.style["font-size"] * (.01 * this.lineHeight)
},
CLOUD.Extensions.AnnotationText.prototype.calcTextLines = function() {
  return this.editor.getTextArea().getTextValuesByAnnotation(this).lines
},
CLOUD.Extensions.AnnotationText.prototype.getTextLines = function() {
  return this.currTextLines.concat()
},
CLOUD.Extensions.AnnotationText.prototype.linesEqual = function(t) {
  var e = this.currTextLines;
  if (t.length !== e.length)
    return !1;
  for (var i = e.length, n = 0; n < i; ++n)
    if (t[n] !== e[n])
      return !1;
return !0
},
CLOUD.Extensions.AnnotationText.prototype.renderToCanvas = function(t) {
  var e = this.style["fill-color"],
    i = this.style["fill-opacity"],
    n = this.style["stroke-color"],
    o = this.style["stroke-opacity"],
    r = this.style["font-family"],
    a = this.style["font-style"],
    s = this.style["font-weight"],
    l = this.style["font-size"],
    c = l * (.01 * this.lineHeight),
    h = this.getClientPosition(),
    u = this.getClientSize(),
    d = {
      width: this.shapeBox.width,
      height: this.shapeBox.height
    };
  t.save(),
  t.fillStyle = CLOUD.Extensions.Utils.Shape2D.getRGBAString(e, i),
  t.translate(h.x, h.y),
  0 !== i && t.fillRect(-.5 * d.width, -.5 * d.height, d.width, d.height),
  t.restore(),
  t.fillStyle = n,
  t.strokeStyle = n,
  t.textBaseline = "top",
  t.translate(h.x, h.y),
  t.rotate(this.rotation),
  t.translate(-.5 * u.width, -.5 * u.height),
  t.font = a + " " + s + " " + l + "px " + r,
  t.globalAlpha = o,
  function(t, e, i, n) {
    var o = 0;
    e.forEach(function(e) {
      o + i > n || (t.fillText(e, 0, o), o += i)
    })
  }(t, this.currTextLines, c, d.height)
},
CLOUD.Extensions.AnnotationTextArea = function(t, e) {
  this.editor = t,
  this.container = e,
  this.textArea = document.createElement("textarea"),
  this.textArea.setAttribute("maxlength", "260"),
  this.textAreaStyle = {},
  this.textAreaStyle.position = "absolute",
  this.textAreaStyle["overflow-y"] = "hidden",
  this.measurePanel = document.createElement("div"),
  this.textAnnotation = null,
  this.onKeyDownBinded = this.onKeyDown.bind(this),
  this.onResizeBinded = this.onResize.bind(this),
  this.addDomEventListeners()
},
CLOUD.Extensions.AnnotationTextArea.prototype.addDomEventListeners = function() {
  this.textArea.addEventListener("keydown", this.onKeyDownBinded, !1)
},
CLOUD.Extensions.AnnotationTextArea.prototype.removeDomEventListeners = function() {
  this.textArea.removeEventListener("keydown", this.onKeyDownBinded, !1)
},
CLOUD.Extensions.AnnotationTextArea.prototype.onKeyDown = function() {
  var t = event.keyCode;
  event.shiftKey || 13 !== t || (event.preventDefault(), this.accept(), this.editor.resetCurrentAnnotationText())
},
CLOUD.Extensions.AnnotationTextArea.prototype.onResize = function() {
  window.requestAnimationFrame(function() {
    if (this.textAnnotation) {
      var t = this.textArea.value;
      this.style = null,
      this.init(),
      this.textArea.value = t
    }
  }.bind(this))
},
CLOUD.Extensions.AnnotationTextArea.prototype.destroy = function() {
  this.removeDomEventListeners(),
  this.inactive()
},
CLOUD.Extensions.AnnotationTextArea.prototype.init = function() {
  var t = this.textAnnotation.getClientPosition(),
    e = this.textAnnotation.getClientSize(),
    i = Math.floor(t.x - .5 * e.width + .5),
    n = Math.floor(t.y - .5 * e.height + .5),
    o = this.textAnnotation.lineHeight + "%";
  this.textAreaStyle["line-height"] = o,
  this.setBound(i, n, e.width, e.height),
  this.setStyle(this.textAnnotation.getStyle()),
  this.textArea.value = this.textAnnotation.getText()
},
CLOUD.Extensions.AnnotationTextArea.prototype.setBound = function(t, e, i, n) {
  t + i >= this.container.clientWidth && (t = this.container.clientWidth - (i + 10)),
  e + n >= this.container.clientHeight && (e = this.container.clientHeight - (n + 10)),
  this.textAreaStyle.left = t + "px",
  this.textAreaStyle.top = e + "px",
  this.textAreaStyle.width = i + "px",
  this.textAreaStyle.height = n + "px"
},
CLOUD.Extensions.AnnotationTextArea.prototype.setStyle = function(t) {
  if (this.style) {
    var e = parseFloat(this.textArea.style.width),
      i = parseFloat(this.textArea.style.height),
      n = parseFloat(this.textArea.style.left),
      o = parseFloat(this.textArea.style.top),
      r = {
        x: n + .5 *e,
        y: o + .5 *i
      };
    this.setBound(r.x - .5 * e, r.y - .5 * i, e, i)
  }
  this.textAreaStyle["font-family"] = t["font-family"],
  this.textAreaStyle["font-size"] = t["font-size"] + "px",
  this.textAreaStyle["font-weight"] = t["font-weight"],
  this.textAreaStyle["font-style"] = t["font-style"],
  this.textAreaStyle.color = t["stroke-color"];
  var a = CLOUD.DomUtil.getStyleString(this.textAreaStyle);
  this.textArea.setAttribute("style", a),
  this.style = CLOUD.DomUtil.cloneStyle(t)
},
CLOUD.Extensions.AnnotationTextArea.prototype.isActive = function() {
  return !!this.textAnnotation
},
CLOUD.Extensions.AnnotationTextArea.prototype.active = function(t, e) {
  if (this.textAnnotation !== t) {
    this.inactive(),
    this.container.appendChild(this.textArea),
    this.textAnnotation = t,
    this.firstEdit = e || !1,
    this.init(),
    window.addEventListener("resize", this.onResizeBinded);
    var i = this.textArea;
    window.requestAnimationFrame(function() {
      i.focus()
    })
  }
},
CLOUD.Extensions.AnnotationTextArea.prototype.inactive = function() {
  window.removeEventListener("resize", this.onResizeBinded),
  this.textAnnotation && (this.textAnnotation = null, this.container.removeChild(this.textArea)),
  this.style = null
},
CLOUD.Extensions.AnnotationTextArea.prototype.accept = function() {
  var t = parseFloat(this.textArea.style.left),
    e = parseFloat(this.textArea.style.top),
    i = parseFloat(this.textArea.style.width),
    n = parseFloat(this.textArea.style.height),
    o = this.getTextValues(),
    r = {
      x: t + .5 *i,
      y: e + .5 *n
    },
    a = {
      annotation: this.textAnnotation,
      firstEdit: this.firstEdit,
      style: this.style,
      position: r,
      width: i,
      height: n,
      text: o.text,
      lines: o.lines
    };
  this.editor.handleTextChange(a),
  this.inactive()
},
CLOUD.Extensions.AnnotationTextArea.prototype.getTextValuesByAnnotation = function(t) {
  this.active(t, !1);
  var e = this.getTextValues();
  return this.inactive(),
  e
},
CLOUD.Extensions.AnnotationTextArea.prototype.getTextValues = function() {
  return {text: this.textArea.value, lines: this.calcTextLines()}
},
CLOUD.Extensions.AnnotationTextArea.prototype.calcTextLines = function() {
  var t = this.textArea.value,
    e = t.split(/\r*\n/),
    i = CLOUD.DomUtil.cloneStyle(this.textAreaStyle);
  CLOUD.DomUtil.removeStyleAttribute(i, ["top", "left", "width", "height", "overflow-y"]),
  i.position = "absolute",
  i["white-space"] = "nowrap",
  i.float = "left",
  i.visibility = "hidden",
  this.measurePanel.setAttribute("style", CLOUD.DomUtil.getStyleString(i)),
  this.container.appendChild(this.measurePanel);
  for (var n = parseFloat(this.textArea.style.width), o = [], r = 0, a = e.length; r < a; ++r) {
    var s = CLOUD.DomUtil.trimRight(e[r]);
    this.splitLine(s, n, o)
  }
  return this.container.removeChild(this.measurePanel),
  o
},
CLOUD.Extensions.AnnotationTextArea.prototype.getShorterLine = function(t) {
  var e = t.lastIndexOf(" ");
  if (e === -1)
    return [t];
  for (; " " === t.charAt(e - 1);)
    e--;
  var i = t.substr(e);
  return [
    t.substr(0, e),
    i
  ]
},
CLOUD.Extensions.AnnotationTextArea.prototype.splitWord = function(t, e, i, n) {
  for (var o = 1;;) {
    var r = t.substr(0, o);
    this.measurePanel.innerHTML = r;
    if (this.measurePanel.clientWidth > i) {
      if (1 === o)
        return n.push(r),
        void this.splitWord(t.substr(1), e, i, n);
      var a = t.substr(0, o - 1);
      n.push(a);
      var s = t.substr(o - 1);
      return void this.splitLine(s + e, i, n)
    }
    if (++o > t.length)
      return void n.push(t)
  }
},
CLOUD.Extensions.AnnotationTextArea.prototype.splitLine = function(t, e, i) {
  if ("" !== t)
    for (var n = "", o = !1; !o;) {
      this.measurePanel.innerHTML = t;
      var r = this.measurePanel.clientWidth;
      if (r <= e)
        i.push(t),
        this.splitLine(CLOUD.DomUtil.trimLeft(n), e, i),
        o = !0;
      else {
        var a = this.getShorterLine(t);
        1 === a.length
          ? (this.splitWord(t, n, e, i), o = !0)
          : (t = a[0], n = a[1] + n)
      }
    }
  },
CLOUD.Extensions.AnnotationPopupTextArea = function(t, e, i) {
  this.editor = t,
  this.container = e,
  this.measurePanel = document.createElement("div"),
  this.textAnnotation = null,
  this.popupCallback = i,
  this.initialText = "",
  this._resetTextAreaStyle()
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype._setStyle = function(t) {
  var e = this.textAnnotation.getClientPosition(),
    i = this.textAnnotation.getClientSize(),
    n = Math.floor(e.x - .5 * i.width + .5),
    o = Math.floor(e.y - .5 * i.height + .5),
    r = i.width,
    a = i.height,
    s = t["font-size"];
  n + r >= this.container.clientWidth && (r = this.container.clientWidth - n + s),
  o + a >= this.container.clientHeight && (a = this.container.clientHeight - o + s),
  this.textAreaStyle.left = n + "px",
  this.textAreaStyle.top = o + "px",
  this.textAreaStyle.width = r + "px",
  this.textAreaStyle.height = a + "px",
  this.textAreaStyle["font-family"] = t["font-family"],
  this.textAreaStyle["font-size"] = t["font-size"] + "px",
  this.textAreaStyle["font-weight"] = t["font-weight"],
  this.textAreaStyle["font-style"] = t["font-style"],
  this.textAreaStyle.color = t["stroke-color"]
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype._getTextValues = function() {
  var t = this.textAnnotation.getText();
  return {text: t, lines: this._calcTextLines(t)}
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype._calcTextLines = function(t) {
  var e = t.split(/\r*\n/),
    i = this.container,
    n = CLOUD.DomUtil.cloneStyle(this.textAreaStyle);
  CLOUD.DomUtil.removeStyleAttribute(n, ["top", "left", "width", "height", "overflow-y"]),
  n.position = "absolute",
  n["white-space"] = "nowrap",
  n.float = "left",
  n.visibility = "hidden",
  this.measurePanel.setAttribute("style", CLOUD.DomUtil.getStyleString(n)),
  i.appendChild(this.measurePanel);
  for (var o = parseFloat(this.textAreaStyle.width), r = [], a = 0, s = e.length; a < s; ++a) {
    var l = CLOUD.DomUtil.trimRight(e[a]);
    this._splitTextLine(l, o, r)
  }
  return i.removeChild(this.measurePanel),
  r
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype._getShorterTextLine = function(t) {
  var e = t.lastIndexOf(" ");
  if (e === -1)
    return [t];
  for (; " " === t.charAt(e - 1);)
    e--;
  var i = t.substr(e);
  return [
    t.substr(0, e),
    i
  ]
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype._splitWord = function(t, e, i, n) {
  for (var o = 1;;) {
    var r = t.substr(0, o);
    this.measurePanel.innerHTML = r;
    if (this.measurePanel.clientWidth > i) {
      if (1 === o)
        return n.push(r),
        void this._splitWord(t.substr(1), e, i, n);
      var a = t.substr(0, o - 1);
      n.push(a);
      var s = t.substr(o - 1);
      return void this._splitTextLine(s + e, i, n)
    }
    if (++o > t.length)
      return void n.push(t)
  }
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype._splitTextLine = function(t, e, i) {
  if ("" !== t)
    for (var n = "", o = !1, r = this.measurePanel; !o;) {
      r.innerHTML = t;
      var a = r.clientWidth;
      if (a <= e)
        i.push(t),
        this._splitTextLine(CLOUD.DomUtil.trimLeft(n), e, i),
        o = !0;
      else {
        var s = this._getShorterTextLine(t);
        1 === s.length
          ? (this._splitWord(t, n, e, i), o = !0)
          : (t = s[0], n = s[1] + n)
      }
    }
  },
CLOUD.Extensions.AnnotationPopupTextArea.prototype._resetTextAreaStyle = function() {
  this.textAreaStyle = {},
  this.textAreaStyle.position = "absolute",
  this.textAreaStyle["overflow-y"] = "hidden"
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype.destroy = function() {
  this.inactive(),
  this.editor = null,
  this.container = null,
  this.measurePanel = null,
  this.popupCallback = null
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype.isActive = function() {
  return !!this.textAnnotation
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype.active = function(t, e) {
  if (this.inactive(), this.textAnnotation = t, e && this.popupCallback) {
    this._setStyle(this.textAnnotation.getStyle()),
    this.initialText = this.textAnnotation.getText();
    var i = this.initialText;
    this.popupCallback(i)
  }
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype.inactive = function() {
  this.textAnnotation && (this.textAnnotation = null)
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype.accept = function(t) {
  var e = this.textAreaStyle,
    i = parseFloat(e.left),
    n = parseFloat(e.top),
    o = parseFloat(e.width),
    r = parseFloat(e.height),
    a = this._calcTextLines(t),
    s = {
      x: i + .5 *o,
      y: n + .5 *r
    },
    l = {
      annotation: this.textAnnotation,
      position: s,
      width: o,
      height: r,
      text: t,
      lines: a
    };
  this.editor.handleTextChange(l),
  this.inactive(),
  this._resetTextAreaStyle()
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype.unaccept = function() {
  var t = this.initialText;
  this.accept(t)
},
CLOUD.Extensions.AnnotationPopupTextArea.prototype.getTextValuesByAnnotation = function(t) {
  this.active(t, !1);
  var e = this._getTextValues();
  return this.inactive(),
  e
},
CLOUD.Extensions.AnnotationFrame = function(t, e) {
  this.editor = t,
  this.container = e,
  this.selection = {
    x: 0,
    y: 0,
    width: 0,
    height: 0,
    rotation: 0,
    element: null,
    active: !1,
    dragging: !1,
    resizing: !1,
    handle: {}
  },
  this.annotation = null,
  this.onResizeDownBinded = this.onResizeDown.bind(this),
  this.onDoubleClickBinded = this.onDoubleClick.bind(this),
  this.onRepositionDownBinded = this.onRepositionDown.bind(this),
  this.onRotationDownBinded = this.onRotationDown.bind(this),
  this.createFramePanel(),
  this.addDomEventListeners()
},
CLOUD.Extensions.AnnotationFrame.prototype.addDomEventListeners = function() {
  this.framePanel.addEventListener("mousedown", this.onResizeDownBinded),
  this.framePanel.addEventListener("dblclick", this.onDoubleClickBinded),
  this.selection.element.addEventListener("mousedown", this.onRepositionDownBinded),
  this.selection.element.addEventListener("mousedown", this.onRotationDownBinded)
},
CLOUD.Extensions.AnnotationFrame.prototype.removeDomEventListeners = function() {
  this.framePanel.removeEventListener("mousedown", this.onResizeDownBinded),
  this.framePanel.removeEventListener("dblclick", this.onDoubleClickBinded),
  this.selection.element.removeEventListener("mousedown", this.onRepositionDownBinded),
  this.selection.element.removeEventListener("mousedown", this.onRotationDownBinded)
},
CLOUD.Extensions.AnnotationFrame.prototype.onMouseMove = function(t) {},
CLOUD.Extensions.AnnotationFrame.prototype.onMouseUp = function(t) {},
CLOUD.Extensions.AnnotationFrame.prototype.onRepositionDown = function(t) {
  this.annotation && (this.isDragPoint(t.target) || this.isRotatePoint(t.target) || (this.selection.dragging = !0, this.originMouse = this.editor.getPointOnDomContainer(t.clientX, t.clientY), this.originPosition = this.annotation.getClientPosition(), this.onMouseMove = this.onRepositionMove.bind(this), this.onMouseUp = this.onRepositionUp.bind(this), this.editor.dragAnnotationFrameBegin()))
},
CLOUD.Extensions.AnnotationFrame.prototype.onRepositionMove = function(t) {
  if (this.annotation && this.selection.dragging) {
    var e = this.editor.getPointOnDomContainer(t.clientX, t.clientY),
      i = {
        x: e.x - this.originMouse.x,
        y: e.y - this.originMouse.y
      },
      n = this.originPosition.x + i.x,
      o = this.originPosition.y + i.y;
    this.updatePosition(n, o, this.selection.rotation);
    var r = this.editor.getAnnotationWorldPosition({x: n, y: o});
    this.annotation.resetPosition(r)
  }
},
CLOUD.Extensions.AnnotationFrame.prototype.onRepositionUp = function() {
  this.onMouseMove = function() {},
  this.onMouseUp = function() {},
  this.selection.dragging && (this.selection.dragging = !1, this.editor.dragAnnotationFrameEnd())
},
CLOUD.Extensions.AnnotationFrame.prototype.onResizeDown = function(t) {
  if (this.annotation) {
    var e = t.target;
    if (this.isDragPoint(e)) {
      this.selection.resizing = !0,
      this.selection.handle.resizingPanel = e;
      var i = this.selection.handle.resizingPanel.getAttribute("data-drag-point");
      this.container.style.cursor = i + "-resize";
      var n = this.editor.getPointOnDomContainer(t.clientX, t.clientY),
        o = this.annotation.getClientPosition(),
        r = this.annotation.getClientSize();
      this.origin = {
        x: o.x,
        y: o.y,
        width: r.width,
        height: r.height,
        mouseX: n.x,
        mouseY: n.y
      },
      this.onMouseMove = this.onResizeMove.bind(this),
      this.onMouseUp = this.onResizeUp.bind(this),
      this.editor.dragAnnotationFrameBegin()
    }
  }
},
CLOUD.Extensions.AnnotationFrame.prototype.onResizeMove = function(t) {
  if (this.annotation && this.selection.resizing) {
    var e = this.editor.getPointOnDomContainer(t.clientX, t.clientY),
      i = this.origin,
      n = {
        x: e.x - i.mouseX,
        y: e.y - i.mouseY
      },
      o = new THREE.Vector3(n.x, n.y, 0),
      r = (new THREE.Matrix4).makeRotationZ(-this.selection.rotation);
    n = o.applyMatrix4(r);
    var a = i.x,
      s = i.y,
      l = i.width,
      c = i.height,
      h = new THREE.Vector3,
      u = this.selection.handle.resizingPanel.getAttribute("data-drag-point");
    ({
      n: function() {
        c -= n.y,
        h.y = n.y
      },
      s: function() {
        c += n.y,
        h.y = n.y
      },
      w: function() {
        l -= n.x,
        h.x = n.x
      },
      e: function() {
        l += n.x,
        h.x = n.x
      },
      nw: function() {
        this.n(),
        this.w()
      },
      ne: function() {
        this.n(),
        this.e()
      },
      sw: function() {
        this.s(),
        this.w()
      },
      se: function() {
        this.s(),
        this.e()
      }
    })[u]();
    var d = (new THREE.Matrix4).makeRotationZ(this.selection.rotation),
      p = h.applyMatrix4(d),
      f = {
        x: a + .5 *p.x,
        y: s + .5 *p.y
      },
      m = {
        width: l,
        height: c
      },
      g = this.editor.getAnnotationWorldPosition(f),
      v = this.editor.getAnnotationWorldSize(m, f);
    this.annotation.resetSize(v, g)
  }
},
CLOUD.Extensions.AnnotationFrame.prototype.onResizeUp = function(t) {
  this.onMouseMove = function() {},
  this.onMouseUp = function() {},
  this.selection.resizing = !1,
  this.selection.handle.resizingPanel = null,
  this.container.style.cursor = "",
  this.editor.dragAnnotationFrameEnd()
},
CLOUD.Extensions.AnnotationFrame.prototype.onRotationDown = function(t) {
  this.annotation && this.isRotatePoint(t.target) && (this.selection.rotating = !0, this.originPosition = this.editor.getPointOnDomContainer(t.clientX, t.clientY), this.originRotation = this.selection.rotation || 0, this.onMouseMove = this.onRotationMove.bind(this), this.onMouseUp = this.onRotationUp.bind(this), this.editor.dragAnnotationFrameBegin())
};
CLOUD.Extensions.AnnotationFrame.prototype.onRotationMove = function(t) {
  if (this.annotation && this.selection.rotating) {
    var e = this.editor.getPointOnDomContainer(t.clientX, t.clientY),
      i = this.annotation.getClientPosition(),
      n = CLOUD.Extensions.Utils.Geometric.getAngleBetweenPoints(i, e),
      o = CLOUD.Extensions.Utils.Geometric.getAngleBetweenPoints(i, this.originPosition),
      r = n - o + this.originRotation;
    this.updatePosition(this.selection.x, this.selection.y, r),
    this.annotation.resetRotation(r)
  }
},
CLOUD.Extensions.AnnotationFrame.prototype.onRotationUp = function(t) {
  this.onMouseMove = function() {},
  this.onMouseUp = function() {},
  this.selection.rotating = !1,
  this.originRotation = null,
  this.originPosition = null,
  this.editor.dragAnnotationFrameEnd()
},
CLOUD.Extensions.AnnotationFrame.prototype.onDoubleClick = function(t) {
  this.selection.dragging = !1,
  this.annotation && this.editor.onMouseDoubleClick(t, this.annotation)
},
CLOUD.Extensions.AnnotationFrame.prototype.destroy = function() {
  this.removeDomEventListeners()
},
CLOUD.Extensions.AnnotationFrame.prototype.createFramePanel = function() {
  var t = this,
    e = function(t, e) {
      var i,
        n = (t + 2) / 2 * -1,
        o = document.createElement("div");
      switch (o.style.position = "absolute", o.style.backgroundColor = "rgba(151, 151, 151, 1)", o.style.border = "2px solid rgb(95, 98, 100)", o.style.height = t + "px", o.style.width = t + "px", o.style.borderRadius = t / 2 + 2 + "px", o.style.boxSizing = "border-box", CLOUD.DomUtil.setCursorStyle(o, e), o.className = "select-drag-point drag-point-" + e, o.setAttribute("data-drag-point", e), e) {
        case "n":
          i = document.createElement("div"),
          i.style.position = "absolute",
          i.style.width = "100%",
          i.style.height = t + "px",
          i.style.top = n + "px",
          o.style.margin = "0 auto",
          o.style.position = "",
          i.appendChild(o),
          o = i;
          break;
        case "s":
          i = document.createElement("div"),
          i.style.position = "absolute",
          i.style.width = "100%",
          i.style.height = t + "px",
          i.style.bottom = n + "px",
          o.style.margin = "0 auto",
          o.style.position = "",
          i.appendChild(o),
          o = i;
          break;
        case "w":
          o.style.left = n + "px",
          o.style.top = "50%",
          o.style.transform = "translate3d(0, -50%, 0)";
          break;
        case "e":
          o.style.right = n + "px",
          o.style.top = "50%",
          o.style.transform = "translate3d(0, -50%, 0)";
          break;
        case "nw":
          o.style.top = n + "px",
          o.style.left = n + "px";
          break;
        case "ne":
          o.style.top = n + "px",
          o.style.right = n + "px";
          break;
        case "sw":
          o.style.bottom = n + "px",
          o.style.left = n + "px";
          break;
        case "se":
          o.style.bottom = n + "px",
          o.style.right = n + "px"
      }
      return o
    };
  this.framePanel = function() {
    var t = document.createElement("div");
    return t.style.position = "absolute",
    t.style.top = 0,
    t.style.bottom = 0,
    t.style.left = 0,
    t.style.right = 0,
    t.style.overflow = "hidden",
    t.style.visibility = "hidden",
    t.style.pointerEvents = "none",
    t
  }(),
  this.container.appendChild(this.framePanel);
  var i = function() {
    var t = document.createElement("div");
    return t.style.position = "absolute",
    t.style.border = "1px solid rgb(0, 0, 255)",
    t.style.zIndex = 1,
    t.style.cursor = "move",
    t.style.boxSizing = "border-box",
    t.style.pointerEvents = "auto",
    t.classList.add("drag-box"),
    t
  }();
  !function(i) {
    [
      "n",
      "s",
      "w",
      "e",
      "nw",
      "ne",
      "sw",
      "se"
    ].forEach(function(n) {
      t.selection.handle[n] = e(12, n),
      i.appendChild(t.selection.handle[n])
    })
  }(i),
  this.selection.element = i,
  this.framePanel.appendChild(this.selection.element),
  this.selection.rotationPanel = function(t) {
    var e = t / 2 + 2,
      i = document.createElement("div");
    return i.style.position = "absolute",
    i.style.backgroundColor = "aqua",
    i.style.border = "2px solid rgb(95, 98, 100)",
    i.style.height = t + "px",
    i.style.width = t + "px",
    i.style.borderRadius = e + "px",
    i.style.boxSizing = "border-box",
    i.classList.add("select-rotate-point"),
    i.style.top = "-25px",
    i.style.left = "50%",
    i.style.transform = "translate3d(-50%, 0px, 0px)",
    i
  }(12),
  i.appendChild(this.selection.rotationPanel),
  this.updateState(!1)
},
CLOUD.Extensions.AnnotationFrame.prototype.setSelection = function(t, e, i, n, o) {
  this.updateDimensions(i, n),
  this.updatePosition(t, e, o),
  this.updateState(!0),
  this.framePanel.style.visibility = "visible"
},
CLOUD.Extensions.AnnotationFrame.prototype.setAnnotation = function(t) {
  if (!t)
    return void(this.annotation && (this.annotation = null, this.updateState(!1)));
  var e = t.getClientSize(),
    i = t.getClientPosition(),
    n = t.rotation;
  this.annotation = t,
  this.setSelection(i.x - e.width / 2, i.y - e.height / 2, e.width, e.height, n),
  this.enableResize(),
  this.enableRotation()
},
CLOUD.Extensions.AnnotationFrame.prototype.isActive = function() {
  return this.isDragging() || this.isResizing() || this.isRotating()
},
CLOUD.Extensions.AnnotationFrame.prototype.dragBegin = function(t) {
  this.onRepositionDown(t)
},
CLOUD.Extensions.AnnotationFrame.prototype.isDragging = function() {
  return this.selection.dragging
},
CLOUD.Extensions.AnnotationFrame.prototype.isResizing = function() {
  return this.selection.resizing
},
CLOUD.Extensions.AnnotationFrame.prototype.isRotating = function() {
  return this.selection.rotating
},
CLOUD.Extensions.AnnotationFrame.prototype.enableResize = function() {
  var t,
    e;
  if (this.annotation.disableResizeHeight || this.annotation.disableResizeWidth) {
    for (e in this.selection.handle)
      (t = this.selection.handle[e]) && (t.style.display = "none");
    this.annotation.disableResizeHeight && (this.selection.handle.w.style.display = "block", this.selection.handle.e.style.display = "block"),
    this.annotation.disableResizeWidth && (this.selection.handle.n.style.display = "block", this.selection.handle.s.style.display = "block")
  } else
    for (e in this.selection.handle)
      (t = this.selection.handle[e]) && (t.style.display = "block")
},
CLOUD.Extensions.AnnotationFrame.prototype.enableRotation = function() {
  var t = this.annotation.disableRotation
    ? "none"
    : "block";
  this.selection.rotationPanel.style.display = t
},
CLOUD.Extensions.AnnotationFrame.prototype.updateDimensions = function(t, e) {
  this.selection.width = t,
  this.selection.height = e,
  this.selection.element.style.width = t + "px",
  this.selection.element.style.height = e + "px"
},
CLOUD.Extensions.AnnotationFrame.prototype.updatePosition = function(t, e, i) {
  var n = this.annotation.getClientSize();
  this.selection.x = t,
  this.selection.y = e,
  this.selection.rotation = i,
  this.selection.element.style.msTransform = CLOUD.DomUtil.toTranslate3d(t, e) + " rotate(" + i + "rad)",
  this.selection.element.style.msTransformOrigin = n.width / 2 + "px " + n.height / 2 + "px",
  this.selection.element.style.webkitTransform = CLOUD.DomUtil.toTranslate3d(t, e) + " rotate(" + i + "rad)",
  this.selection.element.style.webkitTransformOrigin = n.width / 2 + "px " + n.height / 2 + "px",
  this.selection.element.style.transform = CLOUD.DomUtil.toTranslate3d(t, e) + " rotate(" + i + "rad)",
  this.selection.element.style.transformOrigin = n.width / 2 + "px " + n.height / 2 + "px"
},
CLOUD.Extensions.AnnotationFrame.prototype.updateState = function(t) {
  this.selection.active = t,
  this.selection.element.style.display = t
    ? "block"
    : "none"
},
CLOUD.Extensions.AnnotationFrame.prototype.isDragPoint = function(t) {
  return CLOUD.DomUtil.matchesSelector(t, ".select-drag-point")
},
CLOUD.Extensions.AnnotationFrame.prototype.isRotatePoint = function(t) {
  return CLOUD.DomUtil.matchesSelector(t, ".select-rotate-point")
},
CLOUD.Extensions = CLOUD.Extensions || {},
CLOUD.Extensions.AnnotationEditor = function(t, e) {
  this.domElement = t,
  this.annotations = [],
  this.selectedAnnotation = null,
  this.bounds = {
    x: 0,
    y: 0,
    width: 0,
    height: 0
  },
  this.keys = {
    BACKSPACE: 8,
    ALT: 18,
    ESC: 27,
    LEFT: 37,
    UP: 38,
    RIGHT: 39,
    BOTTOM: 40,
    DELETE: 46,
    ZERO: 48,
    A: 65,
    D: 68,
    E: 69,
    Q: 81,
    S: 83,
    W: 87,
    PLUS: 187,
    SUB: 189
  },
  this.isEditing = !1,
  this.originX = 0,
  this.originY = 0,
  this.isCreating = !1,
  this.beginEditCallback = null,
  this.endEditCallback = null,
  this.changeEditorModeCallback = null,
  this.annotationType = CLOUD.Extensions.Annotation.shapeTypes.ARROW,
  this.nextAnnotationId = 0,
  this.annotationMinLen = 16,
  this.initialized = !1,
  this.epsilon = 1e-4,
  this.annotationStyle = null,
  this.isDblClickCloseCloud = !0,
  this.mouseButtons = {
    LEFT: 0,
    MIDDLE: 1,
    RIGHT: 2
  },
  this.onContextMenuBinded = this.onContextMenu.bind(this),
  this.onMouseDownBinded = this.onMouseDown.bind(this),
  this.onMouseDoubleClickBinded = this.onMouseDoubleClick.bind(this),
  this.onMouseMoveBinded = this.onMouseMove.bind(this),
  this.onMouseUpBinded = this.onMouseUp.bind(this),
  this.onKeyDownBinded = this.onKeyDown.bind(this),
  this.onKeyUpBinded = this.onKeyUp.bind(this),
  this.onTouchStartBinded = this.onTouchStart.bind(this),
  this.onTouchMoveBinded = this.onTouchMove.bind(this),
  this.onTouchEndBinded = this.onTouchEnd.bind(this),
  e = e || {},
  this.popupCallback = e.popupCallback,
  this.annotationTextArea = null,
  this.annotationPopupTextArea = null
},
CLOUD.Extensions.AnnotationEditor.prototype.addDomEventListeners = function() {
  this.svg && (this.svg.addEventListener("mousedown", this.onMouseDownBinded, !1), this.svg.addEventListener("touchstart", this.onTouchStartBinded, !1), this.svg.addEventListener("dblclick", this.onMouseDoubleClickBinded, !1), this.svg.addEventListener("contextmenu", this.onContextMenuBinded, !1), window.addEventListener("mousemove", this.onMouseMoveBinded, !1), window.addEventListener("mouseup", this.onMouseUpBinded, !1), window.addEventListener("touchmove", this.onTouchMoveBinded, !1), window.addEventListener("touchend", this.onTouchEndBinded, !1), window.addEventListener("keydown", this.onKeyDownBinded, !1), window.addEventListener("keyup", this.onKeyUpBinded, !1), this.onFocus())
},
CLOUD.Extensions.AnnotationEditor.prototype.removeDomEventListeners = function() {
  this.svg && (this.svg.removeEventListener("mousedown", this.onMouseDownBinded, !1), this.svg.removeEventListener("touchstart", this.onTouchStartBinded, !1), this.svg.removeEventListener("dblclick", this.onMouseDoubleClickBinded, !1), this.svg.removeEventListener("contextmenu", this.onContextMenuBinded, !1), window.removeEventListener("mousemove", this.onMouseMoveBinded, !1), window.removeEventListener("mouseup", this.onMouseUpBinded, !1), window.removeEventListener("touchmove", this.onTouchMoveBinded, !1), window.removeEventListener("touchend", this.onTouchEndBinded, !1), window.removeEventListener("keydown", this.onKeyDownBinded, !1), window.removeEventListener("keyup", this.onKeyUpBinded, !1))
},
CLOUD.Extensions.AnnotationEditor.prototype.onFocus = function() {
  this.svg && this.svg.focus()
},
CLOUD.Extensions.AnnotationEditor.prototype.onContextMenu = function(t) {
  t.preventDefault()
},
CLOUD.Extensions.AnnotationEditor.prototype.onMouseDown = function(t) {
  if (t.preventDefault(), t.stopPropagation(), t.button === this.mouseButtons.LEFT) {
    if (this.annotationFrame.isActive())
      return void this.annotationFrame.setAnnotation(this.selectedAnnotation);
    this.handleEvent(t, "down"),
    this.isCreating || t.target !== this.svg || this.selectAnnotation(null)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.onMouseMove = function(t) {
  if (t.stopPropagation(), t.button === this.mouseButtons.LEFT) {
    if (this.annotationFrame.isActive())
      return this.annotationFrame.onMouseMove(t),
      void this.annotationFrame.setAnnotation(this.selectedAnnotation);
    this.handleEvent(t, "move")
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.onMouseUp = function(t) {
  if (t.stopPropagation(), this.annotationFrame.isActive())
    return void this.annotationFrame.onMouseUp(t);
  this.selectedAnnotation && this.isCreating && this.handleEvent(t, "up")
},
CLOUD.Extensions.AnnotationEditor.prototype.onTouchStart = function(t) {
  if (t.preventDefault(), t.stopPropagation(), 1 == t.touches.length) {
    if (this.annotationFrame.isActive())
      return void this.annotationFrame.setAnnotation(this.selectedAnnotation);
    this.handleEvent(t, "start"),
    this.isCreating || t.target !== this.svg || this.selectAnnotation(null)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.onTouchMove = function(t) {
  if (t.stopPropagation(), 1 == t.touches.length) {
    if (this.annotationFrame.isActive())
      return this.annotationFrame.onTouchMove(t),
      void this.annotationFrame.setAnnotation(this.selectedAnnotation);
    this.handleEvent(t, "touchmove")
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.onTouchEnd = function(t) {
  if (t.stopPropagation(), this.annotationFrame.isActive())
    return void this.annotationFrame.onTouchEnd(t);
  this.selectedAnnotation && this.isCreating && this.handleEvent(t, "end")
},
CLOUD.Extensions.AnnotationEditor.prototype.onMouseDoubleClick = function(t, e) {
  t.preventDefault(),
  t.stopPropagation(),
  this.isEditing && (this.isDblClickCloseCloud && this.mouseDoubleClickForCloud(t), this.mouseDoubleClickForText(t, e))
},
CLOUD.Extensions.AnnotationEditor.prototype.onKeyDown = function(t) {},
CLOUD.Extensions.AnnotationEditor.prototype.onKeyUp = function(t) {
  if (this.isEditing)
    switch (t.keyCode) {
      case this.keys.DELETE:
        this.selectedAnnotation && (this.selectedAnnotation.delete(), this.selectedAnnotation = null, this.deselectAnnotation());
        break;
      case this.keys.ESC:
        this.annotationType === CLOUD.Extensions.Annotation.shapeTypes.CLOUD && (this.selectedAnnotation.finishTrack(), this.selectedAnnotation.setSeal(!1), this.createAnnotationEnd(), this.deselectAnnotation()),
        this.forceAnnotationTextComplete()
    }
  },
CLOUD.Extensions.AnnotationEditor.prototype.onResize = function() {
  var t = this.getDomContainerBounds();
  this.bounds.x = 0,
  this.bounds.y = 0,
  this.bounds.width = t.width,
  this.bounds.height = t.height,
  this.svg.setAttribute("width", this.bounds.width + ""),
  this.svg.setAttribute("height", this.bounds.height + ""),
  this.updateAnnotations()
},
CLOUD.Extensions.AnnotationEditor.prototype.handleEvent = function(t, e) {
  var i = this.annotationType;
  if ("down" !== e && "start" !== e || !this.forceAnnotationTextComplete())
    switch (i) {
      case CLOUD.Extensions.Annotation.shapeTypes.RECTANGLE:
        "down" === e
          ? this.startRectangle(t.clientX, t.clientY) && this.createAnnotationBegin()
          : "start" === e
            ? this.startRectangle(t.touches[0].clientX, t.touches[0].clientY) && this.createAnnotationBegin()
            : "move" === e
              ? this.moveRectangle(t.clientX, t.clientY)
              : "touchmove" === e
                ? this.moveRectangle(t.touches[0].clientX, t.touches[0].clientY)
                : "up" !== e && "end" !== e || (this.createAnnotationEnd(), this.deselectAnnotation());
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.CIRCLE:
        "down" === e
          ? this.startCircle(t.clientX, t.clientY) && this.createAnnotationBegin()
          : "start" === e
            ? this.startCircle(t.touches[0].clientX, t.touches[0].clientY) && this.createAnnotationBegin()
            : "move" === e
              ? this.moveCircle(t.clientX, t.clientY)
              : "touchmove" === e
                ? this.moveCircle(t.touches[0].clientX, t.touches[0].clientY)
                : "up" !== e && "end" !== e || (this.createAnnotationEnd(), this.deselectAnnotation());
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.CROSS:
        "down" === e
          ? this.startCross(t.clientX, t.clientY) && this.createAnnotationBegin()
          : "start" === e
            ? this.startCross(t.touches[0].clientX, t.touches[0].clientY) && this.createAnnotationBegin()
            : "move" === e
              ? this.moveCross(t.clientX, t.clientY)
              : "touchmove" === e
                ? this.moveCross(t.touches[0].clientX, t.touches[0].clientY)
                : "up" !== e && "end" !== e || (this.createAnnotationEnd(), this.deselectAnnotation());
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.CLOUD:
        "down" === e
          ? this.startCloud(t.clientX, t.clientY) && this.createAnnotationBegin()
          : "start" === e
            ? this.startCloud(t.touches[0].clientX, t.touches[0].clientY) && this.createAnnotationBegin()
            : "move" === e
              ? this.moveCloud(t.clientX, t.clientY)
              : "touchmove" === e
                ? this.moveCloud(t.touches[0].clientX, t.touches[0].clientY)
                : "up" !== e && "end" !== e || this.endCloud(t, e);
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.TEXT:
        "down" === e
          ? this.startText(t.clientX, t.clientY)
          : "start" === e && this.startText(t.touches[0].clientX, t.touches[0].clientY);
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.ARROW:
      default:
        "down" === e
          ? this.startArrow(t.clientX, t.clientY) && this.createAnnotationBegin()
          : "start" === e
            ? this.startArrow(t.touches[0].clientX, t.touches[0].clientY) && this.createAnnotationBegin()
            : "move" === e
              ? this.moveArrow(t.clientX, t.clientY)
              : "touchmove" === e
                ? this.moveArrow(t.touches[0].clientX, t.touches[0].clientY)
                : "up" !== e && "end" !== e || (this.createAnnotationEnd(), this.deselectAnnotation())
            }
  },
CLOUD.Extensions.AnnotationEditor.prototype.startArrow = function(t, e) {
  if (this.selectedAnnotation)
    return !1;
  var i = this.getPointOnDomContainer(t, e);
  this.originX = i.x,
  this.originY = i.y;
  var n = this.annotationMinLen,
    o = {
      x: this.originX,
      y: this.originY
    },
    r = {
      x: Math.round(o.x + Math.cos(.25 * Math.PI) * n),
      y: Math.round(o.y + Math.sin(.25 * -Math.PI) * n)
    };
  !function(t, e, i, n) {
    CLOUD.Extensions.Utils.Geometric.isInsideBounds(e.x, e.y, n) || (e.y = Math.round(t.y + Math.sin(.25 * Math.PI) * i), CLOUD.Extensions.Utils.Geometric.isInsideBounds(e.x, e.y, n) || (e.x = Math.round(t.y + Math.cos(.25 * -Math.PI) * i), CLOUD.Extensions.Utils.Geometric.isInsideBounds(e.x, e.y, n) || (e.y = Math.round(t.y + Math.sin(.25 * -Math.PI) * i))))
  }(o, r, n, this.getBounds()),
  r = this.getAnnotationWorldPosition(r),
  o = this.getAnnotationWorldPosition(o);
  var a = this.generateAnnotationId(),
    s = new CLOUD.Extensions.AnnotationArrow(this, a);
  return s.setByTailHead(o, r),
  this.addAnnotation(s),
  s.created(),
  this.selectedAnnotation = s,
  !0
},
CLOUD.Extensions.AnnotationEditor.prototype.moveArrow = function(t, e) {
  if (this.selectedAnnotation && this.isCreating) {
    var i = this.selectedAnnotation,
      n = this.getPointOnDomContainer(t, e),
      o = this.getBounds(),
      r = this.originX,
      a = this.originY,
      s = n.x - r;
    Math.abs(s) < this.annotationMinLen && (
      n.x = s > 0
      ? r + this.annotationMinLen
      : r - this.annotationMinLen);
    var l = Math.min(Math.max(o.x, n.x), o.x + o.width),
      c = Math.min(Math.max(o.y, n.y), o.y + o.height);
    l === r && c === a && (l++, c++);
    var h = {
        x: r,
        y: a
      },
      u = {
        x: l,
        y: c
      };
    h = this.getAnnotationWorldPosition(h),
    u = this.getAnnotationWorldPosition(u),
    (Math.abs(i.head.x - u.x) >= this.epsilon || Math.abs(i.head.y - u.y) >= this.epsilon || Math.abs(i.tail.x - h.x) >= this.epsilon || Math.abs(i.tail.y - h.y) >= this.epsilon) && i.setByTailHead(h, u)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.startRectangle = function(t, e) {
  if (this.selectedAnnotation)
    return !1;
  var i = this.getPointOnDomContainer(t, e),
    n = this.annotationMinLen;
  this.originX = i.x,
  this.originY = i.y;
  var o = {
      x: i.x,
      y: i.y
    },
    r = {
      width: n,
      height: n
    },
    a = this.getAnnotationWorldPosition(o),
    s = this.getAnnotationWorldSize(r, o),
    l = this.generateAnnotationId(),
    c = new CLOUD.Extensions.AnnotationRectangle(this, l);
  return c.set(a, s, 0),
  this.addAnnotation(c),
  c.created(),
  this.selectedAnnotation = c,
  !0
},
CLOUD.Extensions.AnnotationEditor.prototype.moveRectangle = function(t, e) {
  if (this.selectedAnnotation && this.isCreating) {
    var i = this.selectedAnnotation,
      n = this.getPointOnDomContainer(t, e),
      o = this.getBounds(),
      r = this.originX,
      a = this.originY,
      s = Math.min(Math.max(o.x, n.x), o.x + o.width),
      l = Math.min(Math.max(o.y, n.y), o.y + o.height);
    s === r && l === a && (s++, l++);
    var c = {
        x: (r + s) / 2,
        y: (a + l) / 2
      },
      h = {
        width: Math.abs(s - r),
        height: Math.abs(l - a)
      },
      u = this.getAnnotationWorldPosition(c),
      d = this.getAnnotationWorldSize(h, c);
    (Math.abs(i.position.x - u.x) > this.epsilon || Math.abs(i.size.y - d.y) > this.epsilon || Math.abs(i.position.y - u.y) > this.epsilon || Math.abs(i.size.y - d.y) > this.epsilon) && i.set(u, d)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.startCircle = function(t, e) {
  if (this.selectedAnnotation)
    return !1;
  var i = this.getPointOnDomContainer(t, e);
  this.originX = i.x,
  this.originY = i.y;
  var n = this.annotationMinLen,
    o = {
      x: i.x,
      y: i.y
    },
    r = {
      width: n,
      height: n
    },
    a = this.getAnnotationWorldPosition(o),
    s = this.getAnnotationWorldSize(r, o),
    l = this.generateAnnotationId(),
    c = new CLOUD.Extensions.AnnotationCircle(this, l);
  return c.set(a, s, 0),
  this.addAnnotation(c),
  c.created(),
  this.selectedAnnotation = c,
  !0
},
CLOUD.Extensions.AnnotationEditor.prototype.moveCircle = function(t, e) {
  if (this.selectedAnnotation && this.isCreating) {
    var i = this.selectedAnnotation,
      n = this.getPointOnDomContainer(t, e),
      o = this.getBounds(),
      r = this.originX,
      a = this.originY,
      s = Math.min(Math.max(o.x, n.x), o.x + o.width),
      l = Math.min(Math.max(o.y, n.y), o.y + o.height);
    s === r && l === a && (s++, l++);
    var c = {
        x: (r + s) / 2,
        y: (a + l) / 2
      },
      h = {
        width: Math.abs(s - r),
        height: Math.abs(l - a)
      },
      u = this.getAnnotationWorldPosition(c),
      d = this.getAnnotationWorldSize(h, c);
    (Math.abs(i.position.x - u.x) > this.epsilon || Math.abs(i.size.y - d.y) > this.epsilon || Math.abs(i.position.y - u.y) > this.epsilon || Math.abs(i.size.y - d.y) > this.epsilon) && i.set(u, d)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.startCross = function(t, e) {
  if (this.selectedAnnotation)
    return !1;
  var i = this.getPointOnDomContainer(t, e);
  this.originX = i.x,
  this.originY = i.y;
  var n = this.annotationMinLen,
    o = {
      x: i.x,
      y: i.y
    },
    r = {
      width: n,
      height: n
    },
    a = this.getAnnotationWorldPosition(o),
    s = this.getAnnotationWorldSize(r, o),
    l = this.generateAnnotationId(),
    c = new CLOUD.Extensions.AnnotationCross(this, l);
  return c.set(a, s, 0),
  this.addAnnotation(c),
  c.created(),
  this.selectedAnnotation = c,
  !0
},
CLOUD.Extensions.AnnotationEditor.prototype.moveCross = function(t, e) {
  if (this.selectedAnnotation && this.isCreating) {
    var i = this.selectedAnnotation,
      n = this.getPointOnDomContainer(t, e),
      o = this.getBounds(),
      r = this.originX,
      a = this.originY,
      s = Math.min(Math.max(o.x, n.x), o.x + o.width),
      l = Math.min(Math.max(o.y, n.y), o.y + o.height);
    s === r && l === a && (s++, l++);
    var c = {
        x: (r + s) / 2,
        y: (a + l) / 2
      },
      h = {
        width: Math.abs(s - r),
        height: Math.abs(l - a)
      },
      u = this.getAnnotationWorldPosition(c),
      d = this.getAnnotationWorldSize(h, c);
    (Math.abs(i.position.x - u.x) > this.epsilon || Math.abs(i.size.y - d.y) > this.epsilon || Math.abs(i.position.y - u.y) > this.epsilon || Math.abs(i.size.y - d.y) > this.epsilon) && i.set(u, d)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.startCloud = function(t, e) {
  if (this.selectedAnnotation)
    return !1;
  var i = this.getPointOnDomContainer(t, e);
  this.originX = i.x,
  this.originY = i.y;
  var n = this.getAnnotationWorldPosition({x: i.x, y: i.y});
  this.cloudPoints = [n];
  var o = this.generateAnnotationId(),
    r = new CLOUD.Extensions.AnnotationCloud(this, o);
  return r.setByPositions(this.cloudPoints),
  r.created(),
  r.enableTrack(),
  this.addAnnotation(r),
  this.selectedAnnotation = r,
  !0
},
CLOUD.Extensions.AnnotationEditor.prototype.moveCloud = function(t, e) {
  if (this.selectedAnnotation && this.isCreating) {
    var i = this.selectedAnnotation;
    if (i.getTrackState()) {
      var n = this.getPointOnDomContainer(t, e),
        o = this.getAnnotationWorldPosition(n);
      i.startTrack(),
      i.setTrackingPoint(o)
    }
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.endCloud = function(t, e) {
  if (t.button === this.mouseButtons.LEFT || t.touches && 0 === t.touches.length) {
    var i = function() {
      a.finishTrack(),
      a.setByPositions(s),
      a.enableTrack()
    };
    if (!this.selectedAnnotation || !this.isCreating)
      return;
    var n = "up" === e
        ? this.getPointOnDomContainer(t.clientX, t.clientY)
        : this.getPointOnDomContainer(t.touches[0].clientX, t.touches[0].clientY),
      o = {
        x: this.originX,
        y: this.originY
      };
    if (CLOUD.Extensions.Utils.Geometric.isEqualBetweenPoints(o, n, 2))
      return;
    var r = this.getAnnotationWorldPosition({x: n.x, y: n.y});
    this.cloudPoints.push(r);
    var a = this.selectedAnnotation;
    a.disableTrack();
    var s = this.cloudPoints;
    this.isDblClickCloseCloud
      ? (this.timerId && clearTimeout(this.timerId), this.timerId = setTimeout(i, 300))
      : i()
  } else
    t.button === this.mouseButtons.RIGHT && this.mouseDoubleClickForCloud(t)
},
CLOUD.Extensions.AnnotationEditor.prototype.mouseDoubleClickForCloud = function(t) {
  if (this.isCreating && this.selectedAnnotation && this.selectedAnnotation.shapeType === CLOUD.Extensions.Annotation.shapeTypes.CLOUD) {
    this.isDblClickCloseCloud && this.timerId && clearTimeout(this.timerId);
    var e = this.getPointOnDomContainer(t.clientX, t.clientY),
      i = this.getAnnotationWorldPosition(e);
    this.cloudPoints.push(i),
    this.selectedAnnotation.finishTrack(),
    this.selectedAnnotation.setByPositions(this.cloudPoints, !0),
    this.createAnnotationEnd(),
    this.deselectAnnotation()
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.startText = function(t, e) {
  if (!this.selectedAnnotation) {
    var i = this.getPointOnDomContainer(t, e),
      n = {
        x: i.x + 160,
        y: i.y + 32
      },
      o = {
        width: 320,
        height: 64
      },
      r = this.getAnnotationWorldPosition(n),
      a = this.getAnnotationWorldSize(o, n),
      s = this.generateAnnotationId(),
      l = this.currentAnnotationText = new CLOUD.Extensions.AnnotationText(this, s);
    l.set(r, a, 0, ""),
    this.addAnnotation(l),
    l.created(),
    l.forceRedraw(),
    this.selectedAnnotation = l;
    return this.getTextArea().active(this.selectedAnnotation, !0),
    !0
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.mouseDoubleClickForText = function(t, e) {
  if (e && this.selectedAnnotation && this.selectedAnnotation.shapeType === CLOUD.Extensions.Annotation.shapeTypes.TEXT) {
    this.currentAnnotationText = e,
    this.selectedAnnotation.hide(),
    this.deselectAnnotation();
    this.getTextArea().active(e, !0)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.init = function(t) {
  if (t && (this.beginEditCallback = t.beginEditCallback, this.endEditCallback = t.endEditCallback, this.changeEditorModeCallback = t.changeEditorModeCallback), !this.svg) {
    var e = this.getDomContainerBounds();
    this.bounds.width = e.width,
    this.bounds.height = e.height,
    this.svg = CLOUD.Extensions.Utils.Shape2D.createSvgElement("svg"),
    this.svg.style.position = "absolute",
    this.svg.style.display = "block",
    this.svg.style.left = "0",
    this.svg.style.top = "0",
    this.svg.setAttribute("width", e.width + ""),
    this.svg.setAttribute("height", e.height + ""),
    this.domElement.appendChild(this.svg),
    this.enableSVGPaint(!1),
    this.annotationFrame = new CLOUD.Extensions.AnnotationFrame(this, this.domElement),
    this.popupCallback
      ? this.annotationPopupTextArea = new CLOUD.Extensions.AnnotationPopupTextArea(this, this.domElement, this.popupCallback)
      : this.annotationTextArea = new CLOUD.Extensions.AnnotationTextArea(this, this.domElement)
  }
  this.initialized = !0
},
CLOUD.Extensions.AnnotationEditor.prototype.uninit = function() {
  this.initialized = !1,
  this.svg && (this.isEditing && this.editEnd(), this.unloadAnnotations(), this.svg.parentNode && this.svg.parentNode.removeChild(this.svg), this.svgGroup = null, this.svg = null, this.beginEditCallback = null, this.endEditCallback = null, this.changeEditorModeCallback = null)
},
CLOUD.Extensions.AnnotationEditor.prototype.isInitialized = function() {
  return this.initialized
},
CLOUD.Extensions.AnnotationEditor.prototype.destroy = function() {
  this.forceAnnotationTextComplete(),
  this.deselectAnnotation(),
  this.annotationFrame && (this.annotationFrame.destroy(), this.annotationFrame = null),
  this.currentAnnotationText && (this.currentAnnotationText = null),
  this.popupCallback && (this.popupCallback = null)
},
CLOUD.Extensions.AnnotationEditor.prototype.generateAnnotationId = function() {
  return = this.nextAnnotationId + 1,
  this.nextAnnotationId.toString(10)
},
CLOUD.Extensions.AnnotationEditor.prototype.onExistEditor = function() {
  this.uninit()
},
CLOUD.Extensions.AnnotationEditor.prototype.editBegin = function() {
  if (this.isEditing)
    return !0;
  this.svgGroup || (this.svgGroup = CLOUD.Extensions.Utils.Shape2D.createSvgElement("g")),
  this.svgGroup.parentNode || this.svg.insertBefore(this.svgGroup, this.svg.firstChild),
  this.handleCallbacks("beginEdit"),
  this.addDomEventListeners(),
  this.enableSVGPaint(!0),
  this.clear(),
  this.isEditing = !0
},
CLOUD.Extensions.AnnotationEditor.prototype.editEnd = function() {
  this.isEditing = !1,
  this.forceAnnotationTextComplete(),
  this.svgGroup && this.svgGroup.parentNode && this.svgGroup.parentNode.removeChild(this.svgGroup),
  this.removeDomEventListeners(),
  this.handleCallbacks("endEdit"),
  this.enableSVGPaint(!1),
  this.deselectAnnotation()
},
CLOUD.Extensions.AnnotationEditor.prototype.createAnnotationBegin = function() {
  this.isCreating || (this.isCreating = !0, this.disableAnnotationInteractions(!0))
},
CLOUD.Extensions.AnnotationEditor.prototype.createAnnotationEnd = function() {
  this.isCreating && (this.isCreating = !1, this.disableAnnotationInteractions(!1))
},
CLOUD.Extensions.AnnotationEditor.prototype.dragAnnotationFrameBegin = function() {
  this.disableAnnotationInteractions(!0)
},
CLOUD.Extensions.AnnotationEditor.prototype.dragAnnotationFrameEnd = function() {
  this.disableAnnotationInteractions(!1)
},
CLOUD.Extensions.AnnotationEditor.prototype.clear = function() {
  for (var t = this.annotations; t.length;) {
    var e = t[0];
    this.removeAnnotation(e),
    e.destroy()
  }
  var i = this.svgGroup;
  if (i && i.childNodes.length > 0)
    for (; i.childNodes.length;)
      i.removeChild(i.childNodes[0])
},
CLOUD.Extensions.AnnotationEditor.prototype.setAnnotationType = function(t) {
  this.forceAnnotationTextComplete(),
  this.annotationType = t,
  this.createAnnotationEnd(),
  this.deselectAnnotation(),
  this.onFocus()
},
CLOUD.Extensions.AnnotationEditor.prototype.addAnnotation = function(t) {
  t.setParent(this.svgGroup),
  this.annotations.push(t)
},
CLOUD.Extensions.AnnotationEditor.prototype.deleteAnnotation = function(t) {
  t && (this.removeAnnotation(t), t.destroy())
},
CLOUD.Extensions.AnnotationEditor.prototype.removeAnnotation = function(t) {
  var e = this.annotations.indexOf(t);
  e !== -1 && this.annotations.splice(e, 1)
},
CLOUD.Extensions.AnnotationEditor.prototype.setAnnotationSelection = function(t) {
  this.selectedAnnotation !== t && this.deselectAnnotation(),
  this.selectedAnnotation = t,
  this.isCreating || this.annotationFrame.setAnnotation(t)
},
CLOUD.Extensions.AnnotationEditor.prototype.selectAnnotation = function(t) {
  if (t) {
    var e = t.shapeType;
    this.annotationType === e
      ? this.setAnnotationSelection(t)
      : (this.setAnnotationSelection(null), this.setAnnotationSelection(t)),
    e === CLOUD.Extensions.Annotation.shapeTypes.TEXT
      ? this.currentAnnotationText = t
      : this.currentAnnotationText = null
  } else
    this.setAnnotationSelection(null),
    this.currentAnnotationText = null
},
CLOUD.Extensions.AnnotationEditor.prototype.deselectAnnotation = function() {
  this.selectedAnnotation && (this.selectedAnnotation.deselect(), this.selectedAnnotation = null),
  this.annotationFrame.setAnnotation(null)
},
CLOUD.Extensions.AnnotationEditor.prototype.worldToClient = function(t) {
  return new THREE.Vector3(t.x, t.y, t.z)
},
CLOUD.Extensions.AnnotationEditor.prototype.clientToWorld = function(t) {
  return new THREE.Vector3(t.x, t.y, 0)
},
CLOUD.Extensions.AnnotationEditor.prototype.getAnnotationWorldPosition = function(t) {
  return this.clientToWorld(t)
},
CLOUD.Extensions.AnnotationEditor.prototype.getAnnotationClientPosition = function(t) {
  return this.worldToClient(t)
},
CLOUD.Extensions.AnnotationEditor.prototype.getAnnotationWorldSize = function(t, e) {
  var i = this.clientToWorld({
      x: e.x - .5 *t.width,
      y: e.y - .5 *t.height
    }),
    n = this.clientToWorld({
      x: e.x + .5 *t.width,
      y: e.y + .5 *t.height
    });
  return {
    width: Math.abs(n.x - i.x),
    height: Math.abs(n.y - i.y)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.getAnnotationClientSize = function(t, e) {
  var i = this.worldToClient({
      x: e.x - .5 *t.width,
      y: e.y - .5 *t.height,
      z: e.z
    }),
    n = this.worldToClient({
      x: e.x + .5 *t.width,
      y: e.y + .5 *t.height,
      z: e.z
    });
  return {
    width: Math.abs(n.x - i.x),
    height: Math.abs(n.y - i.y)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.getBounds = function() {
  return this.bounds
},
CLOUD.Extensions.AnnotationEditor.prototype.getPointOnDomContainer = function(t, e) {
  var i = this.getDomContainerBounds();
  return new THREE.Vector2(t - i.left, e - i.top)
},
CLOUD.Extensions.AnnotationEditor.prototype.getDomContainerBounds = function() {
  return CLOUD.DomUtil.getContainerOffsetToClient(this.domElement)
},
CLOUD.Extensions.AnnotationEditor.prototype.getViewBox = function(t, e) {
  var i = this.clientToWorld({x: 0, y: 0}),
    n = this.clientToWorld({x: t, y: e}),
    o = Math.min(i.x, n.x),
    r = Math.min(i.y, n.y);
  return [
    o,
    r,
    Math.max(i.x, n.x) - o,
    Math.max(i.y, n.y) - r
  ].join(" ")
},
CLOUD.Extensions.AnnotationEditor.prototype.handleTextChange = function(t) {
  var e = t.annotation;
  if ("" === t.text)
    return this.selectAnnotation(null),
    void t.annotation.delete();
  var i = {
      x: t.position.x,
      y: t.position.y
    },
    n = {
      width: t.width,
      height: t.height
    },
    o = this.getAnnotationWorldPosition(i),
    r = this.getAnnotationWorldSize(n, i);
  e.resetSize(r, o),
  e.setText(t.text),
  this.createAnnotationEnd(),
  this.deselectAnnotation()
},
CLOUD.Extensions.AnnotationEditor.prototype.disableAnnotationInteractions = function(t) {
  this.annotations.forEach(function(e) {
    e.disableInteractions(t)
  })
},
CLOUD.Extensions.AnnotationEditor.prototype.handleCallbacks = function(t) {
  switch (t) {
    case "beginEdit":
      this.beginEditCallback && this.beginEditCallback(this.domElement);
      break;
    case "endEdit":
      this.endEditCallback && this.endEditCallback(this.domElement);
      break;
    case "changeEditor":
      this.changeEditorModeCallback && this.changeEditorModeCallback(this.domElement)
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.renderToCanvas = function(t) {
  this.annotations.forEach(function(e) {
    t.save(),
    e.renderToCanvas(t),
    t.restore()
  })
},
CLOUD.Extensions.AnnotationEditor.prototype.enableSVGPaint = function(t) {
  t
    ? this.svg && this.svg.setAttribute("pointer-events", "painted")
    : this.svg && this.svg.setAttribute("pointer-events", "none")
},
CLOUD.Extensions.AnnotationEditor.prototype.forceAnnotationTextComplete = function() {
  return !(!this.annotationTextArea || !this.annotationTextArea.isActive()) && (this.annotationTextArea.accept(), this.currentAnnotationText && (this.currentAnnotationText = null), !0)
},
CLOUD.Extensions.AnnotationEditor.prototype.resetCurrentAnnotationText = function() {
  this.currentAnnotationText && (this.currentAnnotationText = null)
},
CLOUD.Extensions.AnnotationEditor.prototype.getScreenSnapshot = function(t, e) {
  var i = document.createElement("canvas"),
    n = this.getDomContainerBounds();
  i.width = n.width,
  i.height = n.height;
  var o = i.getContext("2d"),
    r = this.gradientStartColor,
    a = this.gradientStopColor,
    s = this;
  if (r) {
    if (a) {
      var l = o.createLinearGradient(0, 0, 0, i.height);
      l.addColorStop(0, r),
      l.addColorStop(1, a),
      o.fillStyle = l
    } else
      o.fillStyle = r;
    o.fillRect(0, 0, i.width, i.height)
  }
  if (e && t) {
    var c = new Image;
    return c.onload = function() {
      o.drawImage(c, 0, 0),
      s.renderToCanvas(o);
      var t = i.toDataURL("image/png");
      i = o = null,
      e(t)
    },
    c.src = t,
    null
  }
  if (t) {
    var c = new Image;
    c.src = t,
    o.drawImage(c, 0, 0)
  }
  this.renderToCanvas(o);
  var h = i.toDataURL("image/png");
  return i = o = null,
  h
},
CLOUD.Extensions.AnnotationEditor.prototype.setBackgroundColor = function(t, e) {
  this.gradientStartColor = t,
  this.gradientStopColor = e
},
CLOUD.Extensions.AnnotationEditor.prototype.getAnnotationInfoList = function() {
  this.forceAnnotationTextComplete(),
  this.createAnnotationEnd(),
  this.deselectAnnotation();
  for (var t = [], e = 0, i = this.annotations.length; e < i; e++) {
    var n = this.annotations[e],
      o = "";
    n.shapeType === CLOUD.Extensions.Annotation.shapeTypes.TEXT && (o = encodeURIComponent(n.currText));
    var r = "",
      a = null;
    n.shapeType === CLOUD.Extensions.Annotation.shapeTypes.CLOUD && (r = n.getShapePoints(), a = n.originSize);
    var s = {
      id: n.id,
      shapeType: n.shapeType,
      position: n.position,
      size: n.size,
      rotation: n.rotation,
      shapePoints: r,
      originSize: a,
      style: n.style,
      text: o
    };
    t.push(s)
  }
  return t
},
CLOUD.Extensions.AnnotationEditor.prototype.loadAnnotations = function(t) {
  this.svgGroup || (this.svgGroup = CLOUD.Extensions.Utils.Shape2D.createSvgElement("g")),
  this.clear(),
  this.svgGroup.parentNode || this.svg.insertBefore(this.svgGroup, this.svg.firstChild);
  for (var e = 0, i = t.length; e < i; e++) {
    var n = t[e],
      o = n.id,
      r = n.shapeType,
      a = n.position,
      s = n.size,
      l = n.rotation,
      c = n.shapePoints,
      h = n.originSize,
      u = decodeURIComponent(n.text),
      d = n.style
        ? n.style
        : this.annotationStyle;
    switch (r) {
      case CLOUD.Extensions.Annotation.shapeTypes.ARROW:
        var p = new CLOUD.Extensions.AnnotationArrow(this, o);
        p.set(a, s, l),
        p.setStyle(d),
        this.addAnnotation(p),
        p.created();
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.RECTANGLE:
        var f = new CLOUD.Extensions.AnnotationRectangle(this, o);
        f.set(a, s, l),
        f.setStyle(d),
        this.addAnnotation(f),
        f.created();
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.CIRCLE:
        var m = new CLOUD.Extensions.AnnotationCircle(this, o);
        m.set(a, s, l),
        m.setStyle(d),
        this.addAnnotation(m),
        m.created();
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.CROSS:
        var g = new CLOUD.Extensions.AnnotationCross(this, o);
        g.set(a, s, l),
        g.setStyle(d),
        this.addAnnotation(g),
        g.created();
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.CLOUD:
        var v = new CLOUD.Extensions.AnnotationCloud(this, o);
        v.set(a, s, l, c, h),
        v.setStyle(d),
        this.addAnnotation(v),
        v.created();
        break;
      case CLOUD.Extensions.Annotation.shapeTypes.TEXT:
        var y = new CLOUD.Extensions.AnnotationText(this, o);
        y.set(a, s, l, u),
        y.setStyle(d),
        this.addAnnotation(y),
        y.created(),
        y.forceRedraw()
    }
  }
},
CLOUD.Extensions.AnnotationEditor.prototype.unloadAnnotations = function() {
  this.clear(),
  this.svgGroup && this.svgGroup.parentNode && this.svgGroup.parentNode.removeChild(this.svgGroup)
},
CLOUD.Extensions.AnnotationEditor.prototype.showAnnotations = function() {
  this.svgGroup && this.svgGroup.setAttribute("visibility", "visible")
},
CLOUD.Extensions.AnnotationEditor.prototype.hideAnnotations = function() {
  this.svgGroup && this.svgGroup.setAttribute("visibility", "hidden")
},
CLOUD.Extensions.AnnotationEditor.prototype.setAnnotationStyle = function(t, e) {
  this.annotationStyle = CLOUD.DomUtil.cloneStyle(t),
  e && this.currentAnnotationText && (this.currentAnnotationText.updateStyle(t), this.annotationTextArea && this.annotationTextArea.setStyle(t))
},
CLOUD.Extensions.AnnotationEditor.prototype.updateAnnotations = function() {
  for (var t = 0, e = this.annotations.length; t < e; t++) {
    this.annotations[t].update()
  }
  this.annotationFrame && this.selectedAnnotation && this.annotationFrame.setAnnotation(this.selectedAnnotation)
},
CLOUD.Extensions.AnnotationEditor.prototype.onCameraChange = function() {},
CLOUD.Extensions.AnnotationEditor.prototype.enableDblClickCloseCloud = function(t) {
  this.isDblClickCloseCloud = t
},
CLOUD.Extensions.AnnotationEditor.prototype.getTextArea = function() {
  return this.popupCallback
    ? this.annotationPopupTextArea
    : this.annotationTextArea
},
CLOUD.Extensions.AnnotationEditor.prototype.setTextFromPopupBox = function(t) {
  this.popupCallback && this.annotationPopupTextArea.accept(t)
},
CLOUD.Extensions.AnnotationEditor.prototype.unsetTextFromPopupBox = function() {
  this.popupCallback && this.annotationPopupTextArea.unaccept()
},
CLOUD.Extensions.AnnotationEditor.prototype.clearAnnotations = function() {
  if (this.svg) {
    this.deselectAnnotation();
    for (var t = this.annotations, e = 0, i = t.length; e < i; ++e) {
      t[e].destroy()
    }
    this.annotations = []
  }
},
CLOUD.Extensions = CLOUD.Extensions || {},
CLOUD.Extensions.AnnotationEditor2D = function(t, e) {
  CLOUD.Extensions.AnnotationEditor.call(this, t, e),
  this.absoluteBasePoint = null,
  this.screenBasePoint = null,
  this.zoomFactor = {
    x: 1,
    y: 1
  }
},
CLOUD.Extensions.AnnotationEditor2D.prototype = Object.create(CLOUD.Extensions.AnnotationEditor.prototype),
CLOUD.Extensions.AnnotationEditor2D.prototype.constructor = CLOUD.Extensions.AnnotationEditor2D,
CLOUD.Extensions.AnnotationEditor2D.prototype.setDomContainer = function(t) {
  t && (this.domElement = t)
},
CLOUD.Extensions.AnnotationEditor2D.prototype.setAbsoluteBasePoint = function(t) {
  t && (this.absoluteBasePoint || (this.absoluteBasePoint = {}), this.absoluteBasePoint.x = t.x, this.absoluteBasePoint.y = t.y)
},
CLOUD.Extensions.AnnotationEditor2D.prototype.setScreenBasePoint = function(t) {
  t && (this.screenBasePoint || (this.screenBasePoint = {}), this.screenBasePoint.x = t.x, this.screenBasePoint.y = t.y)
},
CLOUD.Extensions.AnnotationEditor2D.prototype.setZoomFactor = function(t, e) {
  t = t || 1,
  e = e || 1,
  this.zoomFactor.x = t,
  this.zoomFactor.y = e
},
CLOUD.Extensions.AnnotationEditor2D.prototype.worldToClient = function(t) {
  var e = this.getDomContainerBounds(),
    i = new THREE.Vector3,
    n = this.absoluteBasePoint,
    o = this.screenBasePoint;
  return this.absoluteBasePoint || (n = {
    x: 0,
    y: 0
  }),
  this.screenBasePoint || (o = {
    x: .5 *e.width,
    y: .5 *e.height
  }),
  i.x = (t.x - n.x) * this.zoomFactor.x + o.x,
  i.y = (-t.y - n.y) * this.zoomFactor.y + o.y,
  i.z = 0,
  i
},
CLOUD.Extensions.AnnotationEditor2D.prototype.clientToWorld = function(t) {
  var e = this.getDomContainerBounds(),
    i = new THREE.Vector3,
    n = 1 / this.zoomFactor.x,
    o = 1 / this.zoomFactor.y,
    r = this.absoluteBasePoint,
    a = this.screenBasePoint;
  return this.absoluteBasePoint || (r = {
    x: 0,
    y: 0
  }),
  this.screenBasePoint || (a = {
    x: .5 *e.width,
    y: .5 *e.height
  }),
  i.x = (t.x - a.x) * n + r.x,
  i.y = -((t.y - a.y) * o + r.y),
  i.z = 0,
  i
},
CLOUD.Extensions.AnnotationEditor2D.prototype.onCameraChange = function() {
  this.handleCallbacks("changeEditor")
},
CLOUD.Extensions.AnnotationEditor2D.prototype.setSvgZIndex = function(t) {
  t = t || 18,
  this.svg && (this.svg.style.zIndex = t)
},
CLOUD.Extensions = CLOUD.Extensions || {},
CLOUD.Extensions.AnnotationEditor3D = function(t, e, i) {
  CLOUD.Extensions.AnnotationEditor.call(this, t, i),
  this.camera = e
},
CLOUD.Extensions.AnnotationEditor3D.prototype = Object.create(CLOUD.Extensions.AnnotationEditor.prototype),
CLOUD.Extensions.AnnotationEditor3D.prototype.constructor = CLOUD.Extensions.AnnotationEditor3D,
CLOUD.Extensions.AnnotationEditor3D.prototype.setDomContainer = function(t) {
  t && (this.domElement = t)
},
CLOUD.Extensions.AnnotationEditor3D.prototype.worldToClient = function(t) {
  var e = this.getDomContainerBounds(),
    i = this.camera,
    n = new THREE.Vector3(t.x, t.y, t.z);
  return n.applyMatrix4(i.matrixWorld),
  n.sub(i.position),
  n.project(i),
  n.x = Math.floor(.5 * (n.x + 1) * e.width + .5),
  n.y = Math.floor(-.5 * (n.y - 1) * e.height + .5),
  n.z = 0,
  n
},
CLOUD.Extensions.AnnotationEditor3D.prototype.clientToWorld = function(t) {
  var e = this.getDomContainerBounds(),
    i = this.camera,
    n = new THREE.Vector3;
  return n.x = t.x / e.width * 2 - 1,
  n.y = -t.y / e.height * 2 + 1,
  n.z = 0,
  n.unproject(i),
  n.add(i.position).applyMatrix4(i.matrixWorldInverse),
  n
},
CLOUD.Extensions.AnnotationEditor3D.prototype.onCameraChange = function() {
  this.camera.dirty && this.handleCallbacks("changeEditor")
},
CLOUD.Extensions.Marker = function(t, e) {
  this.id = t,
  this.editor = e,
  this.position = new THREE.Vector3,
  this.boundingBox = new THREE.Box3,
  this.shape = null,
  this.style = CLOUD.Extensions.Marker.getDefaultStyle(),
  this.selected = !1,
  this.highlighted = !1,
  this.highlightColor = "#000088",
  this.isDisableInteractions = !1,
  this.keys = {
    BACKSPACE: 8,
    ALT: 18,
    ESC: 27,
    LEFT: 37,
    UP: 38,
    RIGHT: 39,
    BOTTOM: 40,
    DELETE: 46,
    ZERO: 48,
    A: 65,
    D: 68,
    E: 69,
    Q: 81,
    S: 83,
    W: 87,
    PLUS: 187,
    SUB: 189
  },
  this.onMouseDownBinded = this.onMouseDown.bind(this),
  this.onKeyUpBinded = this.onKeyUp.bind(this)
},
CLOUD.Extensions.Marker.prototype = {
  constructor: CLOUD.Extensions.Marker,
  addDomEventListeners: function() {
    this.shape.addEventListener("mousedown", this.onMouseDownBinded, !0),
    this.shape.addEventListener("touchstart", this.onMouseDownBinded, !0),
    window.addEventListener("keyup", this.onKeyUpBinded)
  },
  removeDomEventListeners: function() {
    this.shape.removeEventListener("mousedown", this.onMouseDownBinded, !0),
    this.shape.removeEventListener("touchstart", this.onMouseDownBinded, !0),
    window.removeEventListener("keyup", this.onKeyUpBinded)
  },
  onMouseDown: function(t) {
    t.preventDefault(),
    t.stopPropagation(),
    this.select()
  },
  onKeyUp: function(t) {
    switch (t.keyCode) {
      case this.keys.DELETE:
        this.editor.deselectMarker(),
        this.delete()
    }
  },
  createShape: function() {},
  destroy: function() {
    this.removeDomEventListeners(),
    this.deselect(),
    this.setParent(null)
  },
  set: function(t, e, i, n) {
    this.userId = t,
    this.position.set(e.x, e.y, e.z),
    this.boundingBox = i.clone(),
    n && (this.style = CLOUD.DomUtil.cloneStyle(n)),
    this.update()
  },
  setParent: function(t) {
    var e = this.shape;
    e && (e.parentNode && e.parentNode.removeChild(e), t && t.appendChild(e))
  },
  setStyle: function(t) {
    this.style = CLOUD.DomUtil.cloneStyle(t),
    this.update()
  },
  select: function() {
    this.selected || (this.selected = !0, this.highlight(!0)),
    this.editor.selectMarker(this)
  },
  deselect: function() {
    this.highlight(!1),
    this.selected = !1
  },
  highlight: function(t) {
    this.isDisableInteractions || (this.highlighted = t, this.update())
  },
  disableInteractions: function(t) {
    this.isDisableInteractions = t
  },
  delete: function() {
    this.editor.deleteMarker(this)
  },
  getClientPosition: function() {
    return this.editor.worldToClient(this.position)
  },
  getBoundingBox: function() {
    return this.boundingBox
  },
  toNewObject: function() {
    return {
      id: this.id,
      userId: this.userId,
      shapeType: this.shapeType,
      cx: this.cx,
      cy: this.cy,
      position: this.position
        ? this.position.clone()
        : null,
      boundingBox: this.boundingBox
        ? this.boundingBox.clone()
        : null
    }
  },
  update: function() {
    var t = this.style["stroke-width"],
      e = this.highlighted
        ? this.highlightColor
        : this.style["stroke-color"],
      i = this.style["stroke-opacity"],
      n = this.style["fill-color"],
      o = this.style["fill-opacity"],
      r = this.getClientPosition();
    if (!r)
      return void(this.shape.style.display = "none");
    var a = r.x,
      s = r.y;
    if (2 == this.shapeType)
      var l = [
        "translate(", a - .5 * this.pictureSize,
        ",",
        s - .5 * this.pictureSize,
        ") "
      ].join("");
    else
      var l = ["translate(", a, ",", s, ") "].join("");
    this.cx = a,
    this.cy = s,
    this.shape.setAttribute("transform", l),
    this.shape.setAttribute("stroke-width", t),
    this.shape.setAttribute("stroke", e),
    this.shape.setAttribute("stroke-opacity", i),
    this.shape.setAttribute("fill", n),
    this.shape.setAttribute("fill-opacity", o)
  }
},
CLOUD.Extensions.Marker.shapeTypes = {
  BUBBLE: 0,
  FLAG: 1,
  COMMON: 2
},
CLOUD.Extensions.Marker.getDefaultStyle = function() {
  var t = {};
  return t["stroke-width"] = 2,
  t["stroke-color"] = "#fffaff",
  t["stroke-opacity"] = 1,
  t["fill-color"] = "#ff2129",
  t["fill-opacity"] = 1,
  t
},
CLOUD.Extensions.MarkerBubble = function(t, e) {
  CLOUD.Extensions.Marker.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Marker.shapeTypes.BUBBLE,
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.MarkerBubble.prototype = Object.create(CLOUD.Extensions.Marker.prototype),
CLOUD.Extensions.MarkerBubble.prototype.constructor = CLOUD.Extensions.MarkerBubble,
CLOUD.Extensions.MarkerBubble.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.makeBubble()
},
CLOUD.Extensions.MarkerFlag = function(t, e) {
  CLOUD.Extensions.Marker.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Marker.shapeTypes.FLAG,
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.MarkerFlag.prototype = Object.create(CLOUD.Extensions.Marker.prototype),
CLOUD.Extensions.MarkerFlag.prototype.constructor = CLOUD.Extensions.MarkerFlag,
CLOUD.Extensions.MarkerFlag.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.makeFlag()
},
CLOUD.Extensions.MarkerCommon = function(t, e, i) {
  CLOUD.Extensions.Marker.call(this, t, e),
  this.shapeType = CLOUD.Extensions.Marker.shapeTypes.COMMON,
  this.pictureSize = 50,
  this.createShape(i),
  this.addDomEventListeners()
},
CLOUD.Extensions.MarkerCommon.prototype = Object.create(CLOUD.Extensions.Marker.prototype),
CLOUD.Extensions.MarkerCommon.prototype.constructor = CLOUD.Extensions.MarkerCommon,
CLOUD.Extensions.MarkerCommon.prototype.createShape = function(t) {
  this.shape = CLOUD.Extensions.Utils.Shape2D.makeCommon(t, this.pictureSize)
},
CLOUD.Extensions.MarkerEditor = function(t) {
  this.cameraControl = t.cameraControl,
  this.scene = t.getScene(),
  this.domElement = t.domElement,
  this.markers = [],
  this.selectedMarker = null,
  this.flagColors = {
    red: "#ff2129",
    green: "#85af03",
    yellow: "#fe9829"
  },
  this.bubbleColors = {
    red: "#f92a24",
    green: "#86b507",
    gray: "#ff9326"
  },
  this.nextMarkerId = 0,
  this.initialized = !1,
  this.markerClickCallback = null
},
CLOUD.Extensions.MarkerEditor.prototype.onResize = function() {
  if (this.svg) {
    var t = this.getDomContainerBounds();
    this.svg.setAttribute("width", t.width + ""),
    this.svg.setAttribute("height", t.height + ""),
    this.updateMarkers()
  }
},
CLOUD.Extensions.MarkerEditor.prototype.init = function() {
  if (!this.svg) {
    var t = this.getDomContainerBounds(),
      e = t.width,
      i = t.height;
    this.svg = CLOUD.Extensions.Utils.Shape2D.createSvgElement("svg"),
    this.svg.style.position = "absolute",
    this.svg.style.display = "block",
    this.svg.style.position = "absolute",
    this.svg.style.display = "block",
    this.svg.style.left = "0",
    this.svg.style.top = "0",
    this.svg.setAttribute("width", e + ""),
    this.svg.setAttribute("height", i + ""),
    this.domElement.appendChild(this.svg),
    this.svgGroup = CLOUD.Extensions.Utils.Shape2D.createSvgElement("g"),
    this.svg.insertBefore(this.svgGroup, this.svg.firstChild)
  }
  this.initialized = !0
},
CLOUD.Extensions.MarkerEditor.prototype.uninit = function() {
  this.initialized = !1,
  this.svg && (this.unloadMarkers(), this.svgGroup && this.svgGroup.parentNode && this.svgGroup.parentNode.removeChild(this.svgGroup), this.svg.parentNode && this.svg.parentNode.removeChild(this.svg), this.svgGroup = null, this.svg = null, this.markerClickCallback = null)
},
CLOUD.Extensions.MarkerEditor.prototype.isInitialized = function() {
  return this.initialized
},
CLOUD.Extensions.MarkerEditor.prototype.generateMarkerId = function() {
  return = this.nextMarkerId + 1,
  this.nextMarkerId.toString(10)
},
CLOUD.Extensions.MarkerEditor.prototype.clear = function() {
  for (var t = this.markers; t.length;) {
    var e = t[0];
    this.deleteMarker(e)
  }
  var i = this.svgGroup;
  if (i && i.childNodes.length > 0)
    for (; i.childNodes.length;)
      i.removeChild(i.childNodes[0])
},
CLOUD.Extensions.MarkerEditor.prototype.addMarker = function(t) {
  t.setParent(this.svgGroup),
  this.markers.push(t)
},
CLOUD.Extensions.MarkerEditor.prototype.deleteMarker = function(t) {
  if (t) {
    var e = this.markers.indexOf(t);
    e !== -1 && this.markers.splice(e, 1),
    t.destroy()
  }
},
CLOUD.Extensions.MarkerEditor.prototype.selectMarker = function(t) {
  this.selectedMarker !== t
    ? (this.deselectMarker(), this.selectedMarker = t)
    : this.deselectMarker(),
  this.markerClickCallback && (
    this.selectedMarker
    ? this.markerClickCallback(this.selectedMarker.toNewObject())
    : this.markerClickCallback(null))
},
CLOUD.Extensions.MarkerEditor.prototype.deselectMarker = function() {
  this.selectedMarker && (this.selectedMarker.deselect(), this.selectedMarker = null)
},
CLOUD.Extensions.MarkerEditor.prototype.getSceneMatrix = function() {
  return this.scene.getMatrixGlobal()
},
CLOUD.Extensions.MarkerEditor.prototype.getInverseSceneMatrix = function() {
  var t = this.getSceneMatrix(),
    e = new THREE.Matrix4;
  return e.getInverse(t),
  e
},
CLOUD.Extensions.MarkerEditor.prototype.worldToClient = function(t) {
  var e = this.getDomContainerBounds(),
    i = this.cameraControl.camera,
    n = this.getSceneMatrix(),
    o = new THREE.Vector3(t.x, t.y, t.z);
  return o.applyMatrix4(n),
  o.project(i),
  Math.abs(o.z) > 1
    ? null
    : (o.x = Math.round(.5 * (o.x + 1) * e.width), o.y = Math.round(-.5 * (o.y - 1) * e.height), o.z = 0, o)
},
CLOUD.Extensions.MarkerEditor.prototype.clientToWorld = function(t) {
  var e = this.getDomContainerBounds(),
    i = this.cameraControl.camera,
    n = new THREE.Vector3;
  n.x = t.x / e.width * 2 - 1,
  n.y = -t.y / e.height * 2 + 1,
  n.z = 0,
  n.unproject(i);
  var o = this.getInverseSceneMatrix();
  return n.applyMatrix4(o),
  n
},
CLOUD.Extensions.MarkerEditor.prototype.clientToViewport = function(t) {
  var e = this.getDomContainerBounds(),
    i = new THREE.Vector3;
  return i.x = t.x / e.width * 2 - 1,
  i.y = -t.y / e.height * 2 + 1,
  i.z = 0,
  i
},
CLOUD.Extensions.MarkerEditor.prototype.enableSVGPaint = function(t) {
  t
    ? this.svg && this.svg.setAttribute("pointer-events", "painted")
    : this.svg && this.svg.setAttribute("pointer-events", "none")
},
CLOUD.Extensions.MarkerEditor.prototype.getDomContainerBounds = function() {
  return CLOUD.DomUtil.getContainerOffsetToClient(this.domElement)
},
CLOUD.Extensions.MarkerEditor.prototype.getMarkerColor = function(t, e) {
  var i = this.bubbleColors.red;
  switch (t < 0 && t > 1 && (t = 0), e > 2 && (e -= 3), e < 0 && e > 2 && (e = 0), e) {
    case 0:
      i = 0 === t
        ? this.bubbleColors.red
        : this.flagColors.red;
      break;
    case 1:
      i = 0 === t
        ? this.bubbleColors.green
        : this.flagColors.green;
      break;
    case 2:
      i = 0 === t
        ? this.bubbleColors.gray
        : this.flagColors.yellow
  }
  return i
},
CLOUD.Extensions.MarkerEditor.prototype.createMarkerByIntersect = function(t, e, i) {
  var n = this.generateMarkerId(),
    o = t.userId,
    r = t.worldPosition || t.object.point,
    a = t.worldBoundingBox || t.object.boundingBox,
    s = {
      id: n,
      userId: o,
      position: r,
      boundingBox: a,
      shapeType: e,
      state: i
    };
  this.createMarker(s)
},
CLOUD.Extensions.MarkerEditor.prototype.createMarker = function(t) {
  if (t) {
    var e = CLOUD.Extensions.Marker.getDefaultStyle();
    e["fill-color"] = this.getMarkerColor(t.shapeType, t.state);
    var i,
      n = t.id,
      o = CLOUD.Extensions.Marker.shapeTypes;
    switch (t.shapeType) {
      case o.BUBBLE:
        i = new CLOUD.Extensions.MarkerBubble(n, this);
        break;
      case o.COMMON:
        i = new CLOUD.Extensions.MarkerCommon(n, this, t.state);
        break;
      case o.FLAG:
      default:
        i = new CLOUD.Extensions.MarkerFlag(n, this)
    }
    i.set(t.userId, t.position, t.boundingBox, e),
    this.addMarker(i)
  }
},
CLOUD.Extensions.MarkerEditor.prototype.getMarkersBoundingBox = function() {
  if (this.markers.length < 1)
    return null;
  for (var t = new THREE.Box3, e = 0, i = this.markers.length; e < i; e++) {
    var n = this.markers[e];
    t.union(n.getBoundingBox())
  }
  return t
},
CLOUD.Extensions.MarkerEditor.prototype.getMarkerInfoList = function() {
  for (var t = [], e = 0, i = this.markers.length; e < i; e++) {
    var n = this.markers[e],
      o = n.userId + "_" + e,
      r = {
        id: n.id || o,
        userId: n.userId,
        shapeType: n.shapeType,
        position: n.position,
        boundingBox: n.boundingBox,
        state: n.state
      };
    t.push(r)
  }
  return t
},
CLOUD.Extensions.MarkerEditor.prototype.loadMarkers = function(t) {
  this.clear();
  for (var e = 0, i = t.length; e < i; e++) {
    var n = t[e],
      o = n.userId + "_" + e,
      r = n.id || o,
      a = n.userId,
      s = n.shapeType,
      l = n.state,
      c = n.position,
      h = new THREE.Box3;
    h.max.x = n.boundingBox.max.x,
    h.max.y = n.boundingBox.max.y,
    h.max.z = n.boundingBox.max.z,
    h.min.x = n.boundingBox.min.x,
    h.min.y = n.boundingBox.min.y,
    h.min.z = n.boundingBox.min.z;
    var u = {
      id: r,
      userId: a,
      position: c,
      boundingBox: h,
      shapeType: s,
      state: l
    };
    this.createMarker(u)
  }
},
CLOUD.Extensions.MarkerEditor.prototype.loadMarkersFromIntersect = function(t, e, i) {
  this.clear(),
  this.createMarkerByIntersect(t, e, i)
},
CLOUD.Extensions.MarkerEditor.prototype.unloadMarkers = function() {
  this.clear()
},
CLOUD.Extensions.MarkerEditor.prototype.updateMarkers = function() {
  for (var t = 0, e = this.markers.length; t < e; t++) {
    this.markers[t].update()
  }
},
CLOUD.Extensions.MarkerEditor.prototype.getMarker = function(t) {
  for (var e = this.markers, i = e.length, n = 0; n < i; ++n)
    if (e[n].id == t)
      return e[n];
return null
},
CLOUD.Extensions.MarkerEditor.prototype.getMarkerByUserId = function(t) {
  for (var e = this.markers, i = e.length, n = 0; n < i; ++n)
    if (e[n].userId == t)
      return e[n];
return null
},
CLOUD.Extensions.MarkerEditor.prototype.setMarkerClickCallback = function(t) {
  this.markerClickCallback = t
},
CLOUD.Extensions.Icon = function(t, e, i, n, o, r) {
  this.options = {
    iconUrl: t,
    iconSize: e || [
      40, 40
    ],
    iconAnchor: i || [
      20, 20
    ],
    shadowUrl: n,
    shadowSize: o || [
      41, 41
    ],
    shadowAnchor: r || [20, 20]
  }
},
CLOUD.Extensions.Icon.prototype = {
  constructor: CLOUD.Extensions.Icon,
  initialize: function(t) {
    CLOUD.MarkerUtil.setOptions(this, t)
  },
  createIcon: function(t) {
    return this._createIcon("icon", t)
  },
  createShadow: function(t) {
    return this._createIcon("shadow", t)
  },
  _createIcon: function(t, e) {
    var i = this._getIconUrl(t);
    if (!i) {
      if ("icon" === t)
        throw new Error("iconUrl not set in Icon options, please set the iconUrl.");
      return null
    }
    var n = this._createImg(
      i, e && "IMG" === e.tagName
      ? e
      : null);
    return this._setIconStyles(n, t),
    n
  },
  _setIconStyles: function(t, e) {
    var i = this.options,
      n = i[e + "Size"];
    "number" == typeof n && (n = [n, n]);
    var o = n,
      r = "shadow" === e && i.shadowAnchor || i.iconAnchor || o && [
        o[0] / 2,
        o[1] / 2
      ];
    t.style.position = "absolute",
    r && (t.style.marginLeft = -r[0] + "px", t.style.marginTop = -r[1] + "px"),
    o && (t.style.width = o[0] + "px", t.style.height = o[1] + "px")
  },
  _createImg: function(t, e) {
    return e = e || document.createElement("img"),
    e.src = t,
    e
  },
  _getIconUrl: function(t) {
    return this.options[t + "Url"]
  }
},
CLOUD.Extensions.MarkerEx = function(t) {
  this.options = {
    icon: t,
    title: "",
    zIndexOffset: 0,
    opacity: 1,
    riseOnHover: !0,
    riseOffset: 250,
    pane: "markerPane"
  },
  this.position = {},
  this.uuid = "",
  this.clickCallback = null,
  this.mouseDownFun = this.onMouseDown.bind(this),
  this.mouseUpFun = this.onMouseUp.bind(this),
  this.mouseOverFun = this.onMouseOver.bind(this),
  this.mouseOutFun = this.onMouseOut.bind(this),
  this.touchEndFun = this.onTouchEnd.bind(this)
},
CLOUD.Extensions.MarkerEx.prototype = {
  constructor: CLOUD.Extensions.MarkerEx,
  initialize: function(t, e) {
    CLOUD.MarkerUtil.setOptions(this, e),
    this.position.x = t.x,
    this.position.y = t.y,
    this.position.z = t.z
  },
  onAdd: function() {
    this._initIcon(),
    this.update()
  },
  onRemove: function() {
    this._removeIcon(),
    this._removeShadow()
  },
  setZIndexOffset: function(t) {
    return this.options.zIndexOffset = t,
    this.update()
  },
  setIcon: function(t) {
    return this.options.icon = t,
    this._initIcon(),
    this.update(),
    this
  },
  getElement: function() {
    return this._icon
  },
  getPos: function() {
    return this._pos
  },
  update: function() {
    if (this._icon) {
      var t = CLOUD.MarkerUtil.transformPosition(this.position);
      this._setPos(t)
    }
    return this
  },
  display: function(t) {
    this._icon && (
      this._icon.style.display = t
      ? "none"
      : "")
  },
  onMouseDown: function(t) {
    t.preventDefault(),
    t.stopPropagation(),
    this.event = t
  },
  onMouseUp: function(t) {
    t.preventDefault(),
    t.stopPropagation(),
    this.event.clientX == t.clientX && this.event.clientY == t.clientY && null != this.clickCallback && this.clickCallback(t, this)
  },
  onTouchEnd: function(t) {
    t.preventDefault(),
    t.stopPropagation(),
    this.event.pageX == t.pageX && this.event.pageY == t.pageY && null != this.clickCallback && this.clickCallback(this.event, this)
  },
  onMouseOver: function(t) {
    this._bringToFront(),
    this.setOpacity(.5 * this.options.opacity)
  },
  onMouseOut: function(t) {
    this._resetZIndex(),
    this.setOpacity(2 * this.options.opacity)
  },
  setClickCallback: function(t) {
    this._icon && (this.clickCallback = t)
  },
  _initIcon: function() {
    var t = this.options,
      e = t.icon.createIcon(this._icon),
      i = !1;
    e !== this._icon && (this._icon && this._removeIcon(), i = !0),
    this._icon = e,
    t.riseOnHover && (this._icon.addEventListener("mouseover", this.mouseOverFun), this._icon.addEventListener("mouseout", this.mouseOutFun));
    var n = t.icon.createShadow(this._shadow),
      o = !1;
    n !== this._shadow && (this._removeShadow(), o = !0),
    this._shadow = n,
    t.opacity < 1 && this._updateOpacity(),
    i && CLOUD.MarkerUtil.getPane(this.options.pane).appendChild(this._icon),
    n && o && CLOUD.MarkerUtil.getPane("shadowPane").appendChild(this._shadow),
    this._icon.addEventListener("mousedown", this.mouseDownFun, !1),
    this._icon.addEventListener("mouseup", this.mouseUpFun, !1),
    this._icon.addEventListener("touchstart", this.mouseDownFun, !1),
    this._icon.addEventListener("touchend", this.touchEndFun, !1)
  },
  _removeIcon: function() {
    this._icon && (this.options.riseOnHover && (this._icon.removeEventListener("mouseover", this.mouseOverFun), this._icon.removeEventListener("mouseout", this.mouseOutFun)), this._icon.removeEventListener("mousedown", this.mouseDownFun, !1), this._icon.removeEventListener("mouseup", this.mouseUpFun, !1), this._icon.removeEventListener("touchstart", this.mouseDownFun, !1), this._icon.removeEventListener("touchend", this.touchEndFun, !1), CLOUD.DomUtilEx.remove(this._icon), this._icon = null)
  },
  _removeShadow: function() {
    this._shadow && CLOUD.DomUtilEx.remove(this._shadow),
    this._shadow = null
  },
  _setPos: function(t) {
    this._pos = t,
    CLOUD.DomUtilEx.setPosition(this._icon, t),
    this._shadow && CLOUD.DomUtilEx.setPosition(this._shadow, t),
    this._zIndex = t.y + this.options.zIndexOffset,
    this._resetZIndex()
  },
  _updateZIndex: function(t) {
    this._icon.style.zIndex = this._zIndex + t
  },
  setOpacity: function(t) {
    return this.options.opacity = t,
    this._icon && this._updateOpacity(),
    this
  },
  _updateOpacity: function() {
    var t = this.options.opacity;
    CLOUD.DomUtilEx.setOpacity(this._icon, t),
    this._shadow && CLOUD.DomUtilEx.setOpacity(this._shadow, t)
  },
  _bringToFront: function() {
    this._updateZIndex(this.options.riseOffset)
  },
  _resetZIndex: function() {
    this._updateZIndex(0)
  }
},
CLOUD.Extensions.Layer = function() {
  CLOUD.Extensions.MarkerEx.call(this),
  this.markerList = []
},
CLOUD.Extensions.Layer.prototype = Object.create(CLOUD.Extensions.MarkerEx.prototype),
CLOUD.Extensions.Layer.prototype.constructor = CLOUD.Extensions.Layer,
CLOUD.Extensions.Layer.prototype.addMarker = function(t) {
  if (this.markerList.push(t), 1 != this.markerList.length)
    this.addPosition(t.position),
    this.update();
  else {
    var t = this.markerList[0];
    this.initialize(t.position, t.options),
    this.onAdd()
  }
  this._icon.title = this.markerList.length.toString()
},
CLOUD.Extensions.Layer.prototype.addLayer = function(t) {
  this.markerList = this.markerList.concat(t.markerList),
  this.markerList.length != t.markerList.length
    ? (this.addPosition(t.position), this.update())
    : (this.initialize(t.position, t.options), this.onAdd()),
  this._icon.title = this.markerList.length.toString()
},
CLOUD.Extensions.Layer.prototype.addPosition = function(t) {
  this.position.x += t.x,
  this.position.y += t.y,
  this.position.z += t.z,
  this.position.x *= .5,
  this.position.y *= .5,
  this.position.z *= .5
},
CLOUD.Extensions.Layer.prototype.getPos = function() {
  return this._pos = CLOUD.MarkerUtil.transformPosition(this.position),
  this._pos
},
CLOUD.Extensions.MarkerManager = function(t) {
  this.viewer = t,
  CLOUD.MarkerUtil.viewer = t,
  this.markerList = {},
  this.markerResultList = {},
  this.iconList = {},
  this.layerIcon = {},
  this.viewer.addRenderCallback(this.update.bind(this)),
  this.markerClusterDistance = 25,
  this.zoomFactor = 10,
  this.zoomToLayerFun = this.zoomToLayer.bind(this),
  this.markerClickCallback = null,
  this.layerClickCallback = null
},
CLOUD.Extensions.MarkerManager.prototype = {
  constructor: CLOUD.Extensions.MarkerManager,
  createIcon: function(t, e, i, n, o, r, a) {
    var s = new CLOUD.Extensions.Icon(e, i, n, o, r, a);
    s.name = t,
    this.iconList[t] = s
  },
  setLayerIcon: function(t, e) {
    void 0 === e && (e = "Default"),
    this.layerIcon[e] = this.iconList[t]
  },
  addMarker: function(t, e, i, n) {
    var o = new CLOUD.Extensions.MarkerEx(this.iconList[t]);
    void 0 === n && (n = "Default"),
    this.markerList.hasOwnProperty(n) || (this.markerList[n] = []),
    this.markerList[n].push(o),
    o.uuid = i,
    o.initialize(e),
    o.onAdd(),
    null != this.markerClickCallback && o.setClickCallback(this.markerClickCallback)
  },
  removeMarker: function(t) {
    for (var e in this.markerList)
      for (var i = this.markerList[e], n = i.length, o = 0; o < n; ++o)
        if (t === i[o].uuid)
          return this.markerList[e].splice(o, 1),
          this.update(),
          !0;
  return !1
  },
  getMarkerByUserId: function(t) {
    for (var e in this.markerList)
      for (var i = this.markerList[e], n = i.length, o = 0; o < n; ++o)
        if (t === i[o].uuid)
          return i[o];
  return null
  },
  getMarkerInfoList: function() {
    var t = {};
    for (var e in this.iconList)
      t[e] = this.iconList[e].options;
    var i = {};
    for (var e in this.layerIcon)
      i[e] = this.layerIcon[e].name;
    var n = {};
    for (var e in this.markerList) {
      n[e] = [];
      for (var o = this.markerList[e], r = o.length, a = 0; a < r; ++a) {
        var s = o[a];
        n[e][a] = {
          iconName: s.options.icon.name,
          uuid: s.uuid,
          position: s.position
        }
      }
    }
    return JSON.stringify({icons: t, layers: i, markers: n})
  },
  loadMarkers: function(t) {
    this.clearAll();
    var e = JSON.parse(t),
      i = e.icons;
    for (var n in i) {
      var o = new CLOUD.Extensions.Icon;
      o.initialize(i[n]),
      this.iconList[n] = o
    }
    var r = e.layers;
    for (var n in r)
      this.setLayerIcon(r[n], n);
    var a = e.markers;
    for (var n in a)
      for (var s = a[n], l = s.length, c = 0; c < l; ++c) {
        var h = s[c];
        this.addMarker(h.iconName, h.position, h.uuid, n)
      }
    this.update()
  },
  setMarkerClickCallback: function(t) {
    this.markerClickCallback = t
  },
  setLayerClickCallback: function(t) {
    this.layerClickCallback = t
  },
  clearMarkers: function() {
    for (var t in this.markerList) {
      for (var e = this.markerList[t], i = e.length, n = 0; n < i; ++n)
        e[n].onRemove();
      this.markerList[t] = []
    }
    this.update()
  },
  clearAll: function() {
    this.clearMarkers(),
    this.layerIcon = {},
    this.iconList = {}
  },
  update: function() {
    for (var t in this.markerList)
      this.updateMarkerCluster(t);
    this.updateLayerCluster();
    for (var t in this.markerResultList)
      for (var e = this.markerResultList[t], i = e.length, n = 0; n < i; ++n) {
        var o = e[n];
        1 == o.markerList.length
          ? (o.onRemove(), o.markerList[0].display(!1))
          : (
            this.layerIcon.hasOwnProperty(t)
            ? o.setIcon(this.layerIcon[t])
            : o.onAdd(),
          o.setClickCallback(this.zoomToLayerFun))
      }
    },
  updateMarkerCluster: function(t) {
    if (void 0 === t && (t = "Default"), this.markerList.hasOwnProperty(t)) {
      this.clearMarkerResult(t);
      for (var e = this.markerList[t], i = this.markerResultList[t], n = e.length, o = 0; o < n; ++o) {
        var r = e[o];
        r.update();
        var a = this.findNearbyCluster(r, t);
        null == a && (a = new CLOUD.Extensions.Layer, i.push(a)),
        a.addMarker(r),
        r.display(!0)
      }
    }
  },
  updateLayerCluster: function() {
    for (var t in this.markerResultList) {
      var e = this.markerResultList[t];
      this.markerResultList[t] = [];
      for (var i = 0; i < e.length; ++i) {
        var n = e[i],
          o = this.findNearbyCluster(n, t);
        null == o && (o = new CLOUD.Extensions.Layer, this.markerResultList[t].push(o)),
        o.addLayer(n),
        n.onRemove()
      }
    }
  },
  findNearbyCluster: function(t, e) {
    for (var i = t.getPos(), n = this.markerResultList[e], o = n.length, r = 0; r < o; ++r) {
      var a = n[r],
        s = a.getPos(),
        l = {
          x: s.x - i.x,
          y: s.y - i.y
        };
      if (Math.sqrt(l.x * l.x + l.y * l.y) < this.markerClusterDistance)
        return a
    }
    return null
  },
  clearMarkerResult: function(t) {
    if (void 0 === t && (t = "Default"), !this.markerResultList.hasOwnProperty(t))
      return void(this.markerResultList[t] = []);
    for (var e = this.markerResultList[t], i = e.length, n = 0; n < i; ++n)
      e[n].onRemove();
    this.markerResultList[t] = []
  },
  zoomToLayer: function(t, e) {
    for (var i = this.viewer, n = e.markerList.length, o = new THREE.Box3, r = 0; r < n; ++r)
      o.expandByPoint(e.markerList[r].position);
    var a = o.getCenter();
    a.applyMatrix4(i.getScene().getMatrixGlobal());
    var s = i.camera,
      l = i.camera.position.clone(),
      c = new THREE.Vector3;
    c.subVectors(a, l),
    c.multiplyScalar(1 / this.zoomFactor);
    for (var r = 0; r < this.zoomFactor; ++r) {
      s.position.addVectors(s.position, c),
      s.target.addVectors(s.target, c),
      s.updateMVP(),
      e.markerList[0].update();
      var h = e.markerList[0].getPos();
      e.markerList[1].update();
      var u = e.markerList[1].getPos(),
        d = {
          x: h.x - u.x,
          y: h.y - u.y
        };
      if (Math.sqrt(d.x * d.x + d.y * d.y) > this.markerClusterDistance) {
        i.render();
        break
      }
    }
    null != this.layerClickCallback && this.layerClickCallback(t, e)
  }
},
CLOUD.Extensions.MeasureMark = function(t, e, i) {
  this.id = t,
  this.editor = e,
  this.enableEvent = void 0 === i || i,
  this.shape = null,
  this.shapeType = 0,
  this.style = CLOUD.Extensions.MeasureMark.getDefaultStyle(),
  this.selected = !1,
  this.highlighted = !1,
  this.highlightColor = "#000088",
  this.isDisableInteractions = !1,
  this.onMouseDownBinded = this.onMouseDown.bind(this),
  this.onMouseMoveBinded = this.onMouseMove.bind(this),
  this.onMouseUpBinded = this.onMouseUp.bind(this),
  this.createShape(),
  this.addDomEventListeners()
},
CLOUD.Extensions.MeasureMark.prototype = {
  constructor: CLOUD.Extensions.MeasureMark,
  destroy: function() {
    this.removeDomEventListeners(),
    this.onMouseDownBinded = null,
    this.onMouseMoveBinded = null,
    this.onMouseUpBinded = null,
    this.deselect(),
    this.setParent(null),
    this.editor = null,
    this.position = null,
    this.shape = null,
    this.style = null
  },
  addDomEventListeners: function() {
    this.enableEvent && (this.shape.addEventListener("mousedown", this.onMouseDownBinded, !1), this.shape.addEventListener("mousemove", this.onMouseMoveBinded, !1), window.addEventListener("mouseup", this.onMouseUpBinded, !1))
  },
  removeDomEventListeners: function() {
    this.enableEvent && (this.shape.removeEventListener("mousedown", this.onMouseDownBinded, !1), this.shape.removeEventListener("mousemove", this.onMouseMoveBinded, !1), window.removeEventListener("mouseup", this.onMouseUpBinded, !1))
  },
  onMouseDown: function(t) {
    t.preventDefault(),
    t.stopPropagation(),
    this.select()
  },
  onMouseMove: function(t) {},
  onMouseUp: function(t) {},
  createShape: function() {},
  set: function() {},
  clear: function() {},
  getClientPosition: function(t) {
    return this.editor.worldToClient(t)
  },
  setParent: function(t) {
    var e = this.shape;
    e && (e.parentNode && e.parentNode.removeChild(e), t && t.appendChild(e))
  },
  setStyle: function(t, e) {
    this.style = CLOUD.DomUtil.cloneStyle(t),
    e && this.update()
  },
  isSelected: function() {
    return this.selected
  },
  select: function() {
    this.selected || (this.selected = !0, this.highlight(!0))
  },
  deselect: function() {
    this.highlight(!1),
    this.selected = !1
  },
  highlight: function(t) {
    this.isDisableInteractions || (this.highlighted = t, this.update())
  },
  disableInteractions: function(t) {
    this.isDisableInteractions = t
  },
  update: function() {},
  hide: function() {
    "" === this.shape.style.display && (this.shape.style.display = "none")
  },
  show: function() {
    "none" === this.shape.style.display && (this.shape.style.display = "")
  }
},
CLOUD.Extensions.MeasureMark.shapeTypes = {
  ANCHOR: 0,
  LINE: 1,
  LABEL: 2
},
CLOUD.Extensions.MeasureMark.getDefaultStyle = function() {
  var t = {};
  return t["stroke-width"] = 2,
  t["stroke-color"] = "#fffaff",
  t["stroke-opacity"] = 1,
  t["fill-color"] = "#ff2129",
  t["fill-opacity"] = 1,
  t["font-family"] = "Arial",
  t["font-size"] = 16,
  t["font-style"] = "",
  t["font-weight"] = "",
  t
},
CLOUD.Extensions.MeasureAnchor = function(t, e, i) {
  CLOUD.Extensions.MeasureMark.call(this, t, e, i),
  this.shapeType = CLOUD.Extensions.MeasureMark.shapeTypes.ANCHOR,
  this.position = null,
  this.mouseKey = this.editor.mouseKey
},
CLOUD.Extensions.MeasureAnchor.prototype = Object.create(CLOUD.Extensions.MeasureMark.prototype),
CLOUD.Extensions.MeasureAnchor.prototype.constructor = CLOUD.Extensions.MeasureAnchor,
CLOUD.Extensions.MeasureAnchor.prototype.onMouseDown = function(t) {
  t.preventDefault(),
  t.button === this.mouseKey.LEFT && this.select()
},
CLOUD.Extensions.MeasureAnchor.prototype.onMouseUp = function(t) {
  t.preventDefault(),
  t.stopPropagation(),
  t.button === this.mouseKey.LEFT && this.deselect()
},
CLOUD.Extensions.MeasureAnchor.prototype.createShape = function() {
  var t = this.enableEvent
    ? "15"
    : "10";
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("circle"),
  this.shape.setAttribute("r", t)
},
CLOUD.Extensions.MeasureAnchor.prototype.set = function(t, e, i) {
  this.position || (this.position = {
    x: 0,
    y: 0,
    z: 0
  }),
  this.position.x = t.x,
  this.position.y = t.y,
  this.position.z = t.z,
  e && (this.style = CLOUD.DomUtil.cloneStyle(e)),
  i && this.update()
},
CLOUD.Extensions.MeasureAnchor.prototype.update = function() {
  if (!this.position)
    return void this.hide();
  var t = this.style["stroke-width"],
    e = this.highlighted
      ? this.highlightColor
      : this.style["stroke-color"],
    i = this.style["stroke-opacity"],
    n = this.style["fill-color"],
    o = this.style["fill-opacity"],
    r = this.getClientPosition(this.position),
    a = r.x,
    s = r.y,
    l = ["translate(", a, ",", s, ") "].join("");
  this.shape.setAttribute("transform", l),
  this.shape.setAttribute("stroke-width", t),
  this.shape.setAttribute("stroke", e),
  this.shape.setAttribute("stroke-opacity", i),
  this.shape.setAttribute("fill", n),
  this.shape.setAttribute("fill-opacity", o),
  this.show()
},
CLOUD.Extensions.MeasureAnchor.prototype.clear = function() {
  this.position = null
},
CLOUD.Extensions.MeasureLine = function(t, e, i) {
  CLOUD.Extensions.MeasureMark.call(this, t, e, i),
  this.shapeType = CLOUD.Extensions.MeasureMark.shapeTypes.LINE,
  this.start = {
    x: 0,
    y: 0,
    z: 0
  },
  this.end = {
    x: 0,
    y: 0,
    z: 0
  }
},
CLOUD.Extensions.MeasureLine.prototype = Object.create(CLOUD.Extensions.MeasureMark.prototype),
CLOUD.Extensions.MeasureLine.prototype.constructor = CLOUD.Extensions.MeasureLine,
CLOUD.Extensions.MeasureLine.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("polyline")
},
CLOUD.Extensions.MeasureLine.prototype.set = function(t, e, i, n) {
  this.start || (this.start = {
    x: 0,
    y: 0,
    z: 0
  }, this.end = {
    x: 0,
    y: 0,
    z: 0
  }),
  this.start.x = t.x,
  this.start.y = t.y,
  this.start.z = t.z,
  this.end.x = e.x,
  this.end.y = e.y,
  this.end.z = e.z,
  i && (this.style = CLOUD.DomUtil.cloneStyle(i)),
  n && this.update()
},
CLOUD.Extensions.MeasureLine.prototype.update = function() {
  if (!this.start)
    return void this.hide();
  var t = this.style["stroke-width"],
    e = this.style["fill-color"],
    i = this.style["stroke-opacity"],
    n = this.getClientPosition(this.start),
    o = this.getClientPosition(this.end),
    r = n.x + "," + n.y + " " + o.x + "," + o.y;
  this.shape.setAttribute("points", r),
  this.shape.setAttribute("stroke-width", t),
  this.shape.setAttribute("stroke", e),
  this.shape.setAttribute("stroke-opacity", i),
  this.show()
};
CLOUD.Extensions.MeasureLine.prototype.clear = function() {
  this.start = null,
  this.end = null
},
CLOUD.Extensions.MeasureLabel = function(t, e, i) {
  CLOUD.Extensions.MeasureMark.call(this, t, e, i),
  this.shapeType = CLOUD.Extensions.MeasureMark.shapeTypes.LABEL,
  this.position = null
},
CLOUD.Extensions.MeasureLabel.prototype = Object.create(CLOUD.Extensions.MeasureMark.prototype),
CLOUD.Extensions.MeasureLabel.prototype.constructor = CLOUD.Extensions.MeasureLabel,
CLOUD.Extensions.MeasureLabel.prototype.createShape = function() {
  this.shape = CLOUD.Extensions.Utils.Shape2D.createSvgElement("text")
},
CLOUD.Extensions.MeasureLabel.prototype.set = function(t, e, i, n) {
  this.position || (this.position = {
    x: 0,
    y: 0,
    z: 0
  }),
  this.position.x = t.x,
  this.position.y = t.y,
  this.position.z = t.z,
  this.text = e,
  i && (this.style = CLOUD.DomUtil.cloneStyle(i)),
  n && this.update()
},
CLOUD.Extensions.MeasureLabel.prototype.update = function() {
  if (!this.position)
    return void this.hide();
  var t = this.style["font-size"],
    e = this.style["fill-color"],
    i = this.style["fill-opacity"],
    n = this.getClientPosition(this.position),
    o = n.x + 20,
    r = n.y + .5 * t,
    a = ["translate(", o, ",", r, ") "].join("");
  this.shape.setAttribute("transform", a),
  this.shape.setAttribute("font-family", this.style["font-family"]),
  this.shape.setAttribute("font-size", t),
  this.shape.setAttribute("font-weight", this.style["font-weight"]),
  this.shape.setAttribute("font-style", this.style["font-style"]),
  this.shape.setAttribute("fill", CLOUD.Extensions.Utils.Shape2D.getRGBAString(e, i)),
  this.show(),
  this.textPan || (this.textPan = CLOUD.Extensions.Utils.Shape2D.createSvgElement("tspan"), this.shape.appendChild(this.textPan)),
  this.textPan.textContent = this.text
},
CLOUD.Extensions.MeasureLabel.prototype.clear = function() {
  this.position = null
},
CLOUD.Extensions.MeasureEditor = function(t, e) {
  this.viewer = t,
  this.options = e,
  this.cameraControl = t.cameraControl,
  this.scene = t.getScene(),
  this.domElement = t.domElement,
  this.nextId = 0,
  this.lastMouse = {
    x: 0,
    y: 0
  },
  this.mouseKey = {
    LEFT: 0,
    MIDDLE: 1,
    RIGHT: 2
  },
  this._onMouseDownBinded = this._onMouseDown.bind(this),
  this._onMouseMoveBinded = this._onMouseMove.bind(this),
  this._onMouseUpBinded = this._onMouseUp.bind(this),
  this._init()
},
CLOUD.Extensions.MeasureEditor.prototype._addDomEventListeners = function() {
  this.svg.addEventListener("mousedown", this._onMouseDownBinded, !1),
  this.svg.addEventListener("mousemove", this._onMouseMoveBinded, !1),
  this.svg.addEventListener("mouseup", this._onMouseUpBinded, !1)
},
CLOUD.Extensions.MarkerEditor.prototype._removeDomEventListeners = function() {
  this.svg.removeEventListener("mousedown", this._onMouseDownBinded, !1),
  this.svg.removeEventListener("mousemove", this._onMouseMoveBinded, !1),
  this.svg.removeEventListener("mouseup", this._onMouseUpBinded, !1)
},
CLOUD.Extensions.MeasureEditor.prototype._onMouseDown = function(t) {
  t.button === this.mouseKey.LEFT && (this.lastMouse.x = t.clientX, this.lastMouse.y = t.clientY)
},
CLOUD.Extensions.MeasureEditor.prototype._onMouseMove = function(t) {
  this.anchorHolder.isSelected() && (t.preventDefault(), t.stopPropagation(), this.lastMouse.x === t.clientX && this.lastMouse.y === t.clientY || this._pick(t), this.lastMouse.x = t.clientX, this.lastMouse.y = t.clientY)
},
CLOUD.Extensions.MeasureEditor.prototype._onMouseUp = function(t) {
  if (this.anchorHolder.isSelected() && this.anchorHolder.deselect(), t.button === this.mouseKey.LEFT) {
    var e = Math.abs(this.lastMouse.x - t.clientX),
      i = Math.abs(this.lastMouse.y - t.clientY);
    e < 2 && i < 2 && this._pick(t),
    this.lastMouse.x = t.clientX,
    this.lastMouse.y = t.clientY
  }
},
CLOUD.Extensions.MeasureEditor.prototype._generateId = function() {
  return = this.nextId + 1,
  this.nextId.toString(10)
},
CLOUD.Extensions.MeasureEditor.prototype._pick = function(t) {
  var e = this.scene;
  if (!e)
    return void console.log("WebViewer.js is not imported!");
  var i = this.cameraControl;
  if (i.enabled === !1)
    return !1;
  var n = this,
    o = new THREE.Vector2(t.clientX, t.clientY),
    r = i.getIntersectContext(o),
    a = t.clientX,
    s = t.clientY;
  i.intersector.pick(r, function(t) {
    if (t) {
      e.intersectToWorld(t),
      t.cx = a,
      t.cy = s;
      var o,
        l,
        c = [];
      c.push(t.userId),
      o = t.worldPosition;
      var h = e.getMatrixGlobal(),
        u = t.face.normal.clone(),
        d = t.worldPosition.clone(),
        p = new THREE.Ray(d, u);
      p.applyMatrix4(h);
      var f = i.intersector.getIntersectByRay(r, p);
      f
        ? (e.intersectToWorld(f), l = f.worldPosition, c.push(f.userId))
        : l = t.worldPosition,
      n._set(o, l),
      n.options && n.options.pickedCallback && n.options.pickedCallback(c)
    }
  })
},
CLOUD.Extensions.MeasureEditor.prototype._init = function() {
  this.anchorHolder = new CLOUD.Extensions.MeasureAnchor(this._generateId(), this, !0),
  this.anchor = new CLOUD.Extensions.MeasureAnchor(this._generateId(), this, !1),
  this.line = new CLOUD.Extensions.MeasureLine(this._generateId(), this, !1),
  this.label = new CLOUD.Extensions.MeasureLabel(this._generateId(), this, !1);
  var t = this._getDomContainerBounds(),
    e = t.width,
    i = t.height;
  this.svg = CLOUD.Extensions.Utils.Shape2D.createSvgElement("svg"),
  this.svg.style.position = "absolute",
  this.svg.style.display = "block",
  this.svg.style.position = "absolute",
  this.svg.style.display = "block",
  this.svg.style.left = "0",
  this.svg.style.top = "0",
  this.svg.setAttribute("width", e + ""),
  this.svg.setAttribute("height", i + ""),
  this.domElement.appendChild(this.svg),
  this.svgGroup = CLOUD.Extensions.Utils.Shape2D.createSvgElement("g"),
  this.svg.appendChild(this.svgGroup),
  this.anchorHolder.setParent(this.svgGroup),
  this.anchor.setParent(this.svgGroup),
  this.line.setParent(this.svgGroup),
  this.label.setParent(this.svgGroup),
  this._addDomEventListeners(),
  this.reset()
},
CLOUD.Extensions.MeasureEditor.prototype._appendSvgNode = function() {
  this.svg.parentNode || this.domElement.appendChild(this.svg)
},
CLOUD.Extensions.MeasureEditor.prototype._removeSvgNode = function() {
  this.svg.parentNode && this.svg.parentNode.removeChild(this.svg)
},
CLOUD.Extensions.MeasureEditor.prototype._set = function(t, e) {
  var i = {
      x: .5 *(t.x + e.x),
      y: .5 *(t.y + e.y),
      z: .5 *(t.z + e.z)
    },
    n = Math.abs(t.x - e.x);
  n += Math.abs(t.y - e.y),
  n += Math.abs(t.z - e.z),
  n = Math.round(n),
  n += " mm",
  this.anchorHolder.set(t),
  this.anchor.set(e),
  this.line.set(t, e),
  this.label.set(i, n),
  this.update()
},
CLOUD.Extensions.MeasureEditor.prototype._getDomContainerBounds = function() {
  return CLOUD.DomUtil.getContainerOffsetToClient(this.domElement)
},
CLOUD.Extensions.MeasureEditor.prototype.destroy = function() {
  this.anchorHolder.destroy(),
  this.anchorHolder = null,
  this.anchor.destroy(),
  this.anchor = null,
  this.line.destroy(),
  this.line = null,
  this.label.destroy(),
  this.label = null,
  this._removeDomEventListeners(),
  this._onMouseDownBinded = null,
  this._onMouseMoveBinded = null,
  this._onMouseUpBinded = null,
  this.svgGroup && this.svgGroup.parentNode && this.svgGroup.parentNode.removeChild(this.svgGroup),
  this.svg.parentNode && this.svg.parentNode.removeChild(this.svg),
  this.svgGroup = null,
  this.svg = null,
  this.cameraControl = null,
  this.scene = null,
  this.domElement = null,
  this.viewer = null
},
CLOUD.Extensions.MeasureEditor.prototype.resize = function() {
  if (this.domElement) {
    var t = this._getDomContainerBounds();
    this.svg.setAttribute("width", t.width + ""),
    this.svg.setAttribute("height", t.height + ""),
    this.update()
  }
},
CLOUD.Extensions.MeasureEditor.prototype.reset = function() {
  this.anchorHolder.isSelected() && this.anchorHolder.deselect(),
  this.anchorHolder.clear(),
  this.anchor.clear(),
  this.line.clear(),
  this.label.clear(),
  this.update()
},
CLOUD.Extensions.MeasureEditor.prototype.setStyle = function(t) {
  this.anchorHolder.setStyle(t),
  this.anchor.setStyle(t),
  this.line.setStyle(t),
  this.label.setStyle(t),
  this.update()
},
CLOUD.Extensions.MeasureEditor.prototype.setStyles = function(t) {
  this.anchorHolder.setStyle(t.anchorHolder),
  this.anchor.setStyle(t.anchor),
  this.line.setStyle(t.line),
  this.label.setStyle(t.label),
  this.update()
},
CLOUD.Extensions.MeasureEditor.prototype.update = function() {
  if (this.domElement) {
    var t = this.anchor.position;
    t
      ? (
        this.worldToClient(t)
        ? (this.anchor.update(), this.anchorHolder.update(), this.line.update(), this.label.update())
        : (this.anchor.hide(), this.anchorHolder.update(), this.line.hide(), this.label.hide()),
      this.showGroup())
      : this.hideGroup()
  }
},
CLOUD.Extensions.MeasureEditor.prototype.worldToClient = function(t) {
  return this.viewer.worldToCanvas(t)
},
CLOUD.Extensions.MeasureEditor.prototype.activate = function() {
  this._appendSvgNode()
},
CLOUD.Extensions.MeasureEditor.prototype.deactivate = function() {
  this.reset(),
  this._removeSvgNode()
},
CLOUD.Extensions.MeasureEditor.prototype.hideGroup = function() {
  this.svgGroup && "" === this.svgGroup.style.display && (this.svgGroup.style.display = "none")
},
CLOUD.Extensions.MeasureEditor.prototype.showGroup = function() {
  this.svgGroup && "none" === this.svgGroup.style.display && (this.svgGroup.style.display = "")
},
CLOUD.Extensions.MeasureHelper = function(t, e) {
  this.viewer = t,
  this.options = e || {}
},
CLOUD.Extensions.MeasureHelper.prototype = {
  constructor: CLOUD.Extensions.MeasureHelper,
  destroy: function() {
    this.editor && this.editor.destroy(),
    this.editor = null,
    this.viewer = null,
    this.options && (this.options = null)
  },
  activate: function() {
    this.editor || (this.editor = new CLOUD.Extensions.MeasureEditor(this.viewer, this.options)),
    this.editor.activate()
  },
  deactivate: function() {
    this.editor && this.editor.deactivate()
  },
  update: function() {
    this.editor && this.editor.update()
  },
  resize: function() {
    this.editor && this.editor.resize()
  },
  reset: function() {
    this.editor && this.editor.reset()
  },
  setStyle: function(t) {
    this.editor && this.editor.setStyle(t)
  },
  setStyles: function(t) {
    this.editor && this.editor.setStyles(t)
  }
},
CLOUD.Extensions.MiniMapHelper = function(t) {
  this.viewer = t,
  this.miniMaps = {},
  this.defaultMiniMap = null
},
CLOUD.Extensions.MiniMapHelper.prototype = {
  constructor: CLOUD.Extensions.MiniMapHelper,
  destroy: function() {
    this.destroyAllMiniMap(),
    this.viewer = null,
    this.miniMaps = {},
    this.defaultMiniMap = null
  },
  createMiniMap: function(t, e, i, n, o, r, a) {
    var s = this.miniMaps[t];
    s || (s = this.miniMaps[t] = new CLOUD.MiniMap(this.viewer), s.setCameraChangedCallback(r), s.setClickOnAxisGridCallback(a)),
    e = e || this.viewer.domElement,
    e && s.init(e, i, n, o),
    this.defaultMiniMap || (this.defaultMiniMap = this.miniMaps[t])
  },
  destroyMiniMap: function(t) {
    var e = this.miniMaps[t];
    e && (e.uninit(), this.defaultMiniMap === e && (this.defaultMiniMap = null), delete this.miniMaps[t])
  },
  destroyAllMiniMap: function() {
    for (var t in this.miniMaps)
      this.destroyMiniMap(t)
  },
  removeMiniMap: function(t) {
    var e = this.miniMaps[t];
    e && e.remove()
  },
  appendMiniMap: function(t) {
    var e = this.miniMaps[t];
    e && e.append()
  },
  getMiniMaps: function() {
    return this.miniMaps
  },
  getMiniMap: function(t) {
    return this.miniMaps[t]
  },
  renderMiniMap: function() {
    for (var t in this.miniMaps) {
      var e = this.miniMaps[t];
      e && e.render()
    }
  },
  setFloorPlaneData: function(t) {
    CLOUD.MiniMap.setFloorPlaneData(t)
  },
  generateFloorPlane: function(t, e) {
    var i = this.miniMaps[t];
    i && i.generateFloorPlane(e)
  },
  setAxisGridData: function(t, e) {
    CLOUD.MiniMap.setAxisGridData(t)
  },
  generateAxisGrid: function(t) {
    var e = this.miniMaps[t];
    e && e.generateAxisGrid()
  },
  showAxisGrid: function(t, e) {
    var i = this.miniMaps[t];
    i && (
      e
      ? i.showAxisGird()
      : i.hideAxisGird())
  },
  enableAxisGridEvent: function(t, e) {
    var i = this.miniMaps[t];
    i && i.enableMouseEvent(e)
  },
  enableMiniMapCameraNode: function(t, e) {
    var i = this.miniMaps[t];
    i && i.enableCameraNode(e)
  },
  flyBypAxisGridNumber: function(t, e, i) {
    return console.warn("CLOUD.Extensions.MiniMapHelper.flyBypAxisGridNumber() has been deprecated. Use CLOUD.Extensions.MiniMapHelper.flyByAxisGridNumber() instead."),
    this.flyByAxisGridNumber(t, e, i)
  },
  flyByAxisGridNumber: function(t, e, i) {
    var n = this.miniMaps[t];
    return !!n && n.flyByAxisGridNumber(e, i)
  },
  getAxisGridInfoByPoint: function(t) {
    var e = this.defaultMiniMap,
      i = null;
    return e && (i = e.getAxisGridInfoByPoint(t)),
    i
  },
  getAxisGridInfoByIntersect: function(t) {
    var e = this.defaultMiniMap;
    e && (t.axisGridInfo = e.getAxisGridInfoByPoint(t.point))
  },
  resize: function(t, e, i) {
    var n = this.miniMaps[t];
    n && n.resize(e, i)
  }
},
CLOUD.Extensions.MarkerHelper = function(t) {
  this.viewer = t,
  this.markerClickCallback = null
},
CLOUD.Extensions.MarkerHelper.prototype = {
  constructor: CLOUD.Extensions.MarkerHelper,
  destroy: function() {
    this.uninitMarkerEditor(),
    this.markerEditor = null,
    this.markerClickCallback = null,
    this.viewer = null
  },
  initMarkerEditor: function() {
    var t = this.viewer;
    this.markerEditor || (this.markerEditor = new CLOUD.Extensions.MarkerEditor(t)),
    this.markerEditor.isInitialized() || this.markerEditor.init(),
    this.markerClickCallback && this.markerEditor.setMarkerClickCallback(this.markerClickCallback)
  },
  uninitMarkerEditor: function() {
    this.markerEditor && this.markerEditor.isInitialized() && this.markerEditor.uninit()
  },
  zoomToSelectedMarkers: function() {
    if (this.markerEditor) {
      var t = this.markerEditor.getMarkersBoundingBox();
      t && this.viewer.zoomToBBox(t, .05),
      this.markerEditor.updateMarkers()
    }
  },
  loadMarkers: function(t) {
    t
      ? (this.initMarkerEditor(), this.markerEditor.loadMarkers(t))
      : this.uninitMarkerEditor()
  },
  loadMarkerFromIntersect: function(t, e, i) {
    t && (this.initMarkerEditor(), this.markerEditor.createMarkerByIntersect(t, e, i))
  },
  loadMarkerFromPosition: function(t, e, i, n, o, r) {
    if (t && e) {
      var a = {
        worldPosition: t,
        userId: e,
        worldBoundingBox: new THREE.Box3(i, n)
      };
      this.initMarkerEditor(),
      this.markerEditor.createMarkerByIntersect(a, o, r)
    }
  },
  loadMarkersFromIntersect: function(t, e, i) {
    t
      ? (this.initMarkerEditor(), this.markerEditor.loadMarkersFromIntersect(t, e, i))
      : this.uninitMarkerEditor()
  },
  getMarkerInfoList: function() {
    return this.markerEditor
      ? this.markerEditor.getMarkerInfoList()
      : null
  },
  resizeMarkers: function() {
    if (this.markerEditor)
      return this.markerEditor.onResize()
  },
  renderMarkers: function() {
    if (this.markerEditor)
      return this.markerEditor.updateMarkers()
  },
  getMarkersBoundingBox: function() {
    if (this.markerEditor)
      return this.markerEditor.getMarkersBoundingBox()
  },
  hideMarkerByUserId: function(t) {
    if (this.markerEditor) {
      this.markerEditor.getMarkerByUserId(t).shape.style.display = "none"
    }
  },
  hideAllMarker: function() {
    this.markerEditor && (this.markerEditor.svg.style.display = "none")
  },
  showMarkerByUserId: function(t) {
    if (this.markerEditor) {
      this.markerEditor.getMarkerByUserId(t).shape.style.display = ""
    }
  },
  showAllMarker: function() {
    this.markerEditor && (this.markerEditor.svg.style.display = "")
  },
  selectMarkerByUserId: function(t) {
    if (this.markerEditor) {
      var e = this.markerEditor.getMarkerByUserId(t);
      e.highlight(!0),
      this.markerEditor.selectMarker(e)
    }
  },
  deleteMarkerByUserId: function(t) {
    if (this.markerEditor) {
      var e = this.markerEditor.getMarkerByUserId(t);
      this.markerEditor.deleteMarker(e)
    }
  },
  deleteSelectMarker: function() {
    this.markerEditor && this.markerEditor.selectedMarker && this.markerEditor.deleteMarker(this.markerEditor.selectedMarker)
  },
  setMarkerClickCallback: function(t) {
    this.markerClickCallback = t
  }
},
CLOUD.Extensions.DwgHelper = function(t) {
  this.dwgContainer = null,
  this.annotationContainer = null,
  this.defaultStyle = {
    "stroke-width": 3,
    "stroke-color": "#ff0000",
    "stroke-opacity": 1,
    "fill-color": "#ff0000",
    "fill-opacity": 0,
    "font-family": "Arial",
    "font-size": 16,
    "font-style": "",
    "font-weight": ""
  },
  this.isDblClickCloseCloud = !0,
  this.options = t
},
CLOUD.Extensions.DwgHelper.prototype = {
  constructor: CLOUD.Extensions.DwgHelper,
  destroy: function() {
    this.uninitAnnotation(),
    this.editor = null,
    this.dwgContainer = null,
    this.annotationContainer = null,
    this.options = null
  },
  setDomContainer: function(t, e) {
    this.dwgContainer = t,
    this.annotationContainer = e || t
  },
  initAnnotation: function(t, e) {
    var i = this,
      n = this.annotationContainer,
      o = this.options;
    if (
      this.editor
      ? this.editor.setDomContainer(n)
      : this.editor = new CLOUD.Extensions.AnnotationEditor2D(n, o),
    this.editor.enableDblClickCloseCloud(this.isDblClickCloseCloud),
    !this.editor.isInitialized()) {
      var r = {
        beginEditCallback: t,
        endEditCallback: e,
        changeEditorModeCallback: function() {
          i.uninitAnnotation()
        }
      };
      this.editor.init(r),
      this.editor.setSvgZIndex(),
      r = null
    }
  },
  uninitAnnotation: function() {
    this.editor && this.editor.isInitialized() && this.editor.uninit()
  },
  setAnnotationBackgroundColor: function(t, e) {
    this.editor && this.editor.setBackgroundColor(t, e)
  },
  editAnnotationBegin: function(t, e, i) {
    this.initAnnotation(e, i),
    t && this.editor.setAbsoluteBasePoint(t),
    this.editor.editBegin()
  },
  editAnnotationEnd: function() {
    this.editor && this.editor.editEnd()
  },
  setAnnotationType: function(t) {
    this.editor && this.editor.setAnnotationType(t)
  },
  setAnnotationStyle: function(t, e) {
    if (this.editor) {
      for (var i in t)
        i in this.defaultStyle && (this.defaultStyle[i] = t[i]);
      this.editor.setAnnotationStyle(this.defaultStyle, e)
    }
  },
  loadAnnotations: function(t, e, i, n) {
    t
      ? (this.initAnnotation(i, n), e && this.editor.setAbsoluteBasePoint(e), this.editor.loadAnnotations(t))
      : this.uninitAnnotation()
  },
  getAnnotationInfoList: function() {
    return this.editor
      ? this.editor.getAnnotationInfoList()
      : null
  },
  resizeAnnotations: function() {
    this.editor && this.editor.isInitialized() && this.editor.onResize()
  },
  clearAnnotations: function() {
    this.editor && this.editor.isInitialized() && this.editor.onCameraChange()
  },
  enableDblClickCloseCloud: function(t) {
    this.isDblClickCloseCloud = t
  },
  captureAnnotationsScreenSnapshot: function(t) {
    var e = this,
      i = this.editor && this.editor.isInitialized(),
      n = this.dwgContainer;
    if (!n || !i)
      return void t(null);
    html2canvas(n, {
      logging: !0,
      onrendered: function(i) {
        var n = i.toDataURL("image/png");
        e.editor.getScreenSnapshot(n, t)
      }
    })
  },
  canvas2image: function(t) {
    this.captureAnnotationsScreenSnapshot(t)
  },
  setAbsoluteBasePoint: function(t) {
    this.initAnnotation(),
    t && this.editor.setAbsoluteBasePoint(t)
  },
  setScreenBasePoint: function(t) {
    this.initAnnotation(),
    t && this.editor.setScreenBasePoint(t)
  },
  setZoomFactor: function(t, e) {
    e = e || t,
    this.initAnnotation(),
    this.editor.setZoomFactor(t, e)
  },
  setTextFromPopupBox: function(t) {
    this.editor && this.editor.setTextFromPopupBox(t)
  },
  unsetTextFromPopupBox: function() {
    this.editor && this.editor.unsetTextFromPopupBox()
  }
},
CLOUD.Extensions.AnnotationHelper2D = function(t) {
  this.domContainer = null,
  this.defaultStyle = {
    "stroke-width": 3,
    "stroke-color": "#ff0000",
    "stroke-opacity": 1,
    "fill-color": "#ff0000",
    "fill-opacity": 0,
    "font-family": "Arial",
    "font-size": 16,
    "font-style": "",
    "font-weight": ""
  },
  this.isDblClickCloseCloud = !1,
  this.options = t
},
CLOUD.Extensions.AnnotationHelper2D.prototype = {
  constructor: CLOUD.Extensions.AnnotationHelper2D,
  destroy: function() {
    this.uninitAnnotation(),
    this.editor = null,
    this.domContainer = null,
    this.beginEditCallback = null,
    this.endEditCallback = null,
    this.stateChangeCallback = null,
    this.defaultStyle = null,
    this.options = null
  },
  setDomContainer: function(t) {
    this.domContainer = t
  },
  setEditCallback: function(t, e, i) {
    this.beginEditCallback = t,
    this.endEditCallback = e,
    this.stateChangeCallback = i
  },
  initAnnotation: function() {
    var t = this,
      e = this.domContainer,
      i = this.options;
    if (
      this.editor
      ? this.editor.setDomContainer(e)
      : this.editor = new CLOUD.Extensions.AnnotationEditor2D(e, i),
    this.editor.enableDblClickCloseCloud(this.isDblClickCloseCloud),
    !this.editor.isInitialized()) {
      var n = {
        beginEditCallback: t.beginEditCallback,
        endEditCallback: t.endEditCallback,
        changeEditorModeCallback: t.stateChangeCallback
      };
      this.editor.init(n),
      n = null
    }
  },
  uninitAnnotation: function() {
    this.editor && this.editor.isInitialized() && this.editor.uninit()
  },
  setAnnotationBackgroundColor: function(t, e) {
    this.initAnnotation(),
    this.editor.setBackgroundColor(t, e)
  },
  editAnnotationBegin: function(t, e, i) {
    this.initAnnotation(),
    t && this.editor.setAbsoluteBasePoint(t),
    e && this.editor.setScreenBasePoint(e),
    i && this.editor.setZoomFactor(i.x, i.y),
    this.editor.editBegin()
  },
  editAnnotationEnd: function() {
    this.editor && this.editor.editEnd()
  },
  setAnnotationType: function(t) {
    this.initAnnotation(),
    this.editor.setAnnotationType(t)
  },
  setAnnotationStyle: function(t, e) {
    this.initAnnotation();
    for (var i in t)
      i in this.defaultStyle && (this.defaultStyle[i] = t[i]);
    this.editor.setAnnotationStyle(this.defaultStyle, e)
  },
  loadAnnotations: function(t, e, i, n) {
    t
      ? (this.initAnnotation(), e && this.editor.setAbsoluteBasePoint(e), i && this.editor.setScreenBasePoint(i), n && this.editor.setZoomFactor(n.x, n.y), this.editor.loadAnnotations(t))
      : this.uninitAnnotation()
  },
  getAnnotationInfoList: function() {
    return this.editor
      ? this.editor.getAnnotationInfoList()
      : null
  },
  getAnnotationInfoListWithBox: function() {
    if (this.editor) {
      var t = this.editor.getAnnotationInfoList();
      if (0 === t.length)
        return null;
      for (var e = new THREE.Box2, i = 0, n = t.length; i < n; i++) {
        var o = t[i],
          r = o.shapeType,
          a = o.position,
          s = o.size,
          l = o.rotation || 0;
        if (r === CLOUD.Extensions.Annotation.shapeTypes.ARROW) {
          var c = new THREE.Vector2(Math.cos(l), Math.sin(l));
          c.multiplyScalar(.5 * s.width);
          var h = new THREE.Vector2(a.x, a.y),
            u = h.clone().sub(c),
            d = h.clone().add(c);
          u.y = -u.y,
          d.y = -d.y,
          e.expandByPoint(u),
          e.expandByPoint(d)
        } else {
          var p = new THREE.Vector2(a.x - .5 * s.width, -a.y - .5 * s.height),
            f = new THREE.Vector2(a.x + .5 * s.width, -a.y + .5 * s.height);
          e.expandByPoint(p),
          e.expandByPoint(f)
        }
      }
      return {boundingBox: e, annotations: t}
    }
    return null
  },
  resizeAnnotations: function() {
    this.editor && this.editor.isInitialized() && this.editor.onResize()
  },
  renderAnnotations: function() {
    this.editor && this.editor.isInitialized() && this.editor.onCameraChange()
  },
  enableDblClickCloseCloud: function(t) {
    this.isDblClickCloseCloud = t
  },
  captureAnnotationsScreenSnapshot: function(t, e) {
    return this.editor.getScreenSnapshot(t, e)
  },
  setAbsoluteBasePoint: function(t) {
    this.initAnnotation(),
    t && this.editor.setAbsoluteBasePoint(t)
  },
  setScreenBasePoint: function(t) {
    this.initAnnotation(),
    t && this.editor.setScreenBasePoint(t)
  },
  setZoomFactor: function(t, e) {
    e = e || t,
    this.initAnnotation(),
    this.editor.setZoomFactor(t, e)
  },
  setTextFromPopupBox: function(t) {
    this.editor && this.editor.setTextFromPopupBox(t)
  },
  unsetTextFromPopupBox: function() {
    this.editor && this.editor.unsetTextFromPopupBox()
  },
  clearAnnotations: function() {
    this.editor && this.editor.clearAnnotations()
  }
},
CLOUD.Extensions.AnnotationHelper3D = function(t, e) {
  this.viewer = t,
  this.defaultStyle = {
    "stroke-width": 3,
    "stroke-color": "#ff0000",
    "stroke-opacity": 1,
    "fill-color": "#ff0000",
    "fill-opacity": 0,
    "font-family": "Arial",
    "font-size": 16,
    "font-style": "",
    "font-weight": ""
  },
  this.isDblClickCloseCloud = !0,
  this.resizeBind = this.resizeAnnotations.bind(this),
  this.renderBind = this.renderAnnotations.bind(this),
  this.options = e
},
CLOUD.Extensions.AnnotationHelper3D.prototype = {
  constructor: CLOUD.Extensions.AnnotationHelper3D,
  destroy: function() {
    this.uninitAnnotation(),
    this.editor = null,
    this.viewer = null,
    this.resizeBind = null,
    this.renderBind = null,
    this.options = null
  },
  hasAnnotations: function() {
    return this.editor && this.editor.isInitialized()
  },
  initAnnotation: function() {
    var t = this.viewer,
      e = this,
      i = this.options;
    if (this.editor || (this.editor = new CLOUD.Extensions.AnnotationEditor3D(t.domElement, t.camera, i)), this.editor.enableDblClickCloseCloud(this.isDblClickCloseCloud), !this.editor.isInitialized()) {
      var n = {
        beginEditCallback: function(e) {
          t.editorManager.unregisterDomEventListeners(e)
        },
        endEditCallback: function(e) {
          t.editorManager.registerDomEventListeners(e)
        },
        changeEditorModeCallback: function() {
          e.uninitAnnotation()
        }
      };
      this.viewer.addCallbacks("resize", this.resizeBind),
      this.viewer.addCallbacks("render", this.renderBind),
      this.editor.init(n),
      n = null
    }
  },
  uninitAnnotation: function() {
    this.editor && this.editor.isInitialized() && (this.viewer.removeCallbacks("resize", this.resizeBind), this.viewer.removeCallbacks("render", this.renderBind), this.editor.uninit())
  },
  setAnnotationBackgroundColor: function(t, e) {
    this.editor && this.editor.setBackgroundColor(t, e)
  },
  editAnnotationBegin: function() {
    this.initAnnotation(),
    this.editor.editBegin()
  },
  editAnnotationEnd: function() {
    this.editor && this.editor.editEnd()
  },
  setAnnotationType: function(t) {
    this.initAnnotation(),
    this.editor.setAnnotationType(t)
  },
  setAnnotationStyle: function(t, e) {
    if (this.editor) {
      for (var i in t)
        i in this.defaultStyle && (this.defaultStyle[i] = t[i]);
      this.editor.setAnnotationStyle(this.defaultStyle, e)
    }
  },
  loadAnnotations: function(t) {
    t
      ? (this.initAnnotation(), this.editor.loadAnnotations(t))
      : this.uninitAnnotation()
  },
  getAnnotationInfoList: function() {
    return this.editor
      ? this.editor.getAnnotationInfoList()
      : null
  },
  resizeAnnotations: function() {
    this.editor && this.editor.isInitialized() && this.editor.onResize()
  },
  renderAnnotations: function() {
    this.editor && this.editor.isInitialized() && this.editor.onCameraChange()
  },
  enableDblClickCloseCloud: function(t) {
    this.isDblClickCloseCloud = t
  },
  captureAnnotationsScreenSnapshot: function(t, e) {
    if (e) {
      var i = this;
      return this.viewer.getRenderBufferScreenShot(t, function(t) {
        i.editor.getScreenSnapshot(t, e)
      }),
      null
    }
    var n = this.viewer.getRenderBufferScreenShot(t);
    return n = this.editor.getScreenSnapshot(n)
  },
  setTextFromPopupBox: function(t) {
    this.editor && this.editor.setTextFromPopupBox(t)
  },
  unsetTextFromPopupBox: function() {
    this.editor && this.editor.unsetTextFromPopupBox()
  },
  clearAnnotations: function() {
    this.editor && this.editor.clearAnnotations()
  }
},
CLOUD.Plugins = {
  ViewHouse: "2017.5.11"
},
CLOUD.Plugins.Font = CLOUD.Plugins.Font || {},
CLOUD.Plugins.Font.helvetiker_regular = {
  glyphs: {
    "": {
      x_min: 0,
      x_max: 712,
      ha: 815,
      o: "m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "
    },
    S: {
      x_min: 0,
      x_max: 788,
      ha: 890,
      o: "m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "
    },
    "": {
      x_min: 343,
      x_max: 449,
      ha: 792,
      o: "m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "
    },
    "/": {
      x_min: 183.25,
      x_max: 608.328125,
      ha: 792,
      o: "m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "
    },
    "": {
      x_min: -.4375,
      x_max: 777.453125,
      ha: 839,
      o: "m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "
    },
    y: {
      x_min: 0,
      x_max: 684.78125,
      ha: 771,
      o: "m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "
    },
    "": {
      x_min: 0,
      x_max: 803,
      ha: 917,
      o: "m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "
    },
    "": {
      x_min: -111,
      x_max: 339,
      ha: 361,
      o: "m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "
    },
    g: {
      x_min: 0,
      x_max: 686,
      ha: 838,
      o: "m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "
    },
    "": {
      x_min: 0,
      x_max: 442,
      ha: 539,
      o: "m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "
    },
    "": {
      x_min: 0,
      x_max: 705.5625,
      ha: 803,
      o: "m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "
    },
    "": {
      x_min: 0,
      x_max: 819.5625,
      ha: 893,
      o: "m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "
    },
    "": {
      x_min: -46.265625,
      x_max: 392,
      ha: 513,
      o: "m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "
    },
    e: {
      x_min: 0,
      x_max: 714,
      ha: 813,
      o: "m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "
    },
    "": {
      x_min: 0,
      x_max: 712,
      ha: 815,
      o: "m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "
    },
    J: {
      x_min: 0,
      x_max: 588,
      ha: 699,
      o: "m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "
    },
    "": {
      x_min: -1,
      x_max: 503,
      ha: 601,
      o: "m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "
    },
    "": {
      x_min: -3,
      x_max: 1008,
      ha: 1106,
      o: "m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "
    },
    "": {
      x_min: 0,
      x_max: 922,
      ha: 1030,
      o: "m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "
    },
    "^": {
      x_min: 193.0625,
      x_max: 598.609375,
      ha: 792,
      o: "m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "
    },
    "": {
      x_min: 0,
      x_max: 507.203125,
      ha: 604,
      o: "m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "
    },
    D: {
      x_min: 0,
      x_max: 828,
      ha: 935,
      o: "m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "
    },
    "": {
      x_min: 0,
      x_max: 142,
      ha: 239,
      o: "m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "
    },
    "": {
      x_min: 0,
      x_max: 47,
      ha: 125,
      o: "m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "
    },
    w: {
      x_min: 0,
      x_max: 1009.71875,
      ha: 1100,
      o: "m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "
    },
    $: {
      x_min: 0,
      x_max: 700,
      ha: 793,
      o: "m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "
    },
    "\\": {
      x_min: -.015625,
      x_max: 425.0625,
      ha: 522,
      o: "m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "
    },
    "": {
      x_min: 0,
      x_max: 697.21875,
      ha: 747,
      o: "m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "
    },
    "": {
      x_min: 42,
      x_max: 181,
      ha: 297,
      o: "m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "
    },
    "": {
      x_min: 0,
      x_max: 1144.5,
      ha: 1214,
      o: "m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "
    },
    "": {
      x_min: 0,
      x_max: 139,
      ha: 236,
      o: "m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "
    },
    "": {
      x_min: 0,
      x_max: 801,
      ha: 915,
      o: "m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "
    },
    "-": {
      x_min: 8.71875,
      x_max: 350.390625,
      ha: 478,
      o: "m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "
    },
    Q: {
      x_min: 0,
      x_max: 968,
      ha: 1072,
      o: "m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "
    },
    "": {
      x_min: 1,
      x_max: 676.28125,
      ha: 740,
      o: "m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "
    },
    M: {
      x_min: 0,
      x_max: 954,
      ha: 1067,
      o: "m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "
    },
    "": {
      x_min: 0,
      x_max: 1006,
      ha: 1094,
      o: "m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "
    },
    C: {
      x_min: 0,
      x_max: 886,
      ha: 944,
      o: "m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "
    },
    "!": {
      x_min: 0,
      x_max: 138,
      ha: 236,
      o: "m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "
    },
    "{": {
      x_min: 0,
      x_max: 480.5625,
      ha: 578,
      o: "m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "
    },
    X: {
      x_min: -.015625,
      x_max: 854.15625,
      ha: 940,
      o: "m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "
    },
    "#": {
      x_min: 0,
      x_max: 963.890625,
      ha: 1061,
      o: "m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "
    },
    "": {
      x_min: 42,
      x_max: 284,
      ha: 361,
      o: "m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "
    },
    "": {
      x_min: 0,
      x_max: 906.953125,
      ha: 982,
      o: "m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "
    },
    ")": {
      x_min: 0,
      x_max: 318,
      ha: 415,
      o: "m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "
    },
    "": {
      x_min: 0,
      x_max: 634.71875,
      ha: 714,
      o: "m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "
    },
    "": {
      x_min: 0,
      x_max: 952.78125,
      ha: 1028,
      o: "m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "
    },
    "}": {
      x_min: 0,
      x_max: 481,
      ha: 578,
      o: "m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "
    },
    "": {
      x_min: -3,
      x_max: 1672,
      ha: 1821,
      o: "m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "
    },
    a: {
      x_min: 0,
      x_max: 698.609375,
      ha: 794,
      o: "m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "
    },
    "": {
      x_min: 0,
      x_max: 941.671875,
      ha: 1039,
      o: "m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "
    },
    "=": {
      x_min: 8.71875,
      x_max: 780.953125,
      ha: 792,
      o: "m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "
    },
    N: {
      x_min: 0,
      x_max: 801,
      ha: 914,
      o: "m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "
    },
    "": {
      x_min: 0,
      x_max: 712,
      ha: 797,
      o: "m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "
    },
    2: {
      x_min: 59,
      x_max: 731,
      ha: 792,
      o: "m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "
    },
    "": {
      x_min: 0,
      x_max: 941.671875,
      ha: 938,
      o: "m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "
    },
    Z: {
      x_min: 0,
      x_max: 779,
      ha: 849,
      o: "m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "
    },
    u: {
      x_min: 0,
      x_max: 617,
      ha: 729,
      o: "m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "
    },
    k: {
      x_min: 0,
      x_max: 612.484375,
      ha: 697,
      o: "m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "
    },
    "": {
      x_min: 0,
      x_max: 803,
      ha: 917,
      o: "m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "
    },
    "": {
      x_min: 0,
      x_max: 906.953125,
      ha: 985,
      o: "m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "
    },
    s: {
      x_min: 0,
      x_max: 604,
      ha: 697,
      o: "m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "
    },
    B: {
      x_min: 0,
      x_max: 778,
      ha: 876,
      o: "m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "
    },
    "": {
      x_min: 0,
      x_max: 614,
      ha: 708,
      o: "m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "
    },
    "?": {
      x_min: 0,
      x_max: 607,
      ha: 704,
      o: "m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "
    },
    H: {
      x_min: 0,
      x_max: 803,
      ha: 915,
      o: "m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "
    },
    "": {
      x_min: 0,
      x_max: 675,
      ha: 761,
      o: "m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "
    },
    c: {
      x_min: 1,
      x_max: 701.390625,
      ha: 775,
      o: "m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "
    },
    "": {
      x_min: 0,
      x_max: 566.671875,
      ha: 678,
      o: "m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "
    },
    "": {
      x_min: 0,
      x_max: 660,
      ha: 745,
      o: "m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "
    },
    "": {
      x_min: 0,
      x_max: 954,
      ha: 1068,
      o: "m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "
    },
    "": {
      x_min: .109375,
      x_max: 1120,
      ha: 1217,
      o: "m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "
    },
    "": {
      x_min: 0,
      x_max: 1158,
      ha: 1275,
      o: "m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "
    },
    "": {
      x_min: 0,
      x_max: 663.890625,
      ha: 775,
      o: "m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "
    },
    "": {
      x_min: .1875,
      x_max: 819.546875,
      ha: 886,
      o: "m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "
    },
    "(": {
      x_min: 0,
      x_max: 318.0625,
      ha: 415,
      o: "m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "
    },
    U: {
      x_min: 0,
      x_max: 796,
      ha: 904,
      o: "m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "
    },
    "": {
      x_min: .5,
      x_max: 744.953125,
      ha: 822,
      o: "m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "
    },
    "": {
      x_min: 0,
      x_max: 765.5625,
      ha: 809,
      o: "m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "
    },
    F: {
      x_min: 0,
      x_max: 683.328125,
      ha: 717,
      o: "m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "
    },
    "": {
      x_min: 0,
      x_max: 705.5625,
      ha: 803,
      o: "m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "
    },
    ":": {
      x_min: 0,
      x_max: 142,
      ha: 239,
      o: "m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "
    },
    "": {
      x_min: 0,
      x_max: 854.171875,
      ha: 935,
      o: "m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "
    },
    "*": {
      x_min: 116,
      x_max: 674,
      ha: 792,
      o: "m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "
    },
    "": {
      x_min: 0,
      x_max: 777,
      ha: 835,
      o: "m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "
    },
    "": {
      x_min: 0,
      x_max: 347,
      ha: 444,
      o: "m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "
    },
    V: {
      x_min: 0,
      x_max: 862.71875,
      ha: 940,
      o: "m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "
    },
    "": {
      x_min: 0,
      x_max: 734.71875,
      ha: 763,
      o: "m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "
    },
    "": {
      x_min: 0,
      x_max: 0,
      ha: 853
    },
    "": {
      x_min: .328125,
      x_max: 819.515625,
      ha: 889,
      o: "m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "
    },
    0: {
      x_min: 73,
      x_max: 715,
      ha: 792,
      o: "m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "
    },
    "": {
      x_min: 0,
      x_max: 347,
      ha: 454,
      o: "m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "
    },
    "@": {
      x_min: 0,
      x_max: 1260,
      ha: 1357,
      o: "m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "
    },
    "": {
      x_min: 0,
      x_max: 499,
      ha: 613,
      o: "m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "
    },
    i: {
      x_min: 14,
      x_max: 136,
      ha: 275,
      o: "m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "
    },
    "": {
      x_min: 0,
      x_max: 778,
      ha: 877,
      o: "m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "
    },
    "": {
      x_min: 0,
      x_max: 617,
      ha: 725,
      o: "m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "
    },
    "]": {
      x_min: 0,
      x_max: 275,
      ha: 372,
      o: "m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "
    },
    m: {
      x_min: 0,
      x_max: 1019,
      ha: 1128,
      o: "m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "
    },
    "": {
      x_min: 8.328125,
      x_max: 780.5625,
      ha: 815,
      o: "m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "
    },
    8: {
      x_min: 55,
      x_max: 736,
      ha: 792,
      o: "m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "
    },
    "": {
      x_min: 42,
      x_max: 326.71875,
      ha: 361,
      o: "m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "
    },
    "": {
      x_min: 0,
      x_max: 779.171875,
      ha: 850,
      o: "m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "
    },
    R: {
      x_min: 0,
      x_max: 781.953125,
      ha: 907,
      o: "m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "
    },
    o: {
      x_min: 0,
      x_max: 713,
      ha: 821,
      o: "m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "
    },
    5: {
      x_min: 54.171875,
      x_max: 738,
      ha: 792,
      o: "m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "
    },
    7: {
      x_min: 58.71875,
      x_max: 730.953125,
      ha: 792,
      o: "m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "
    },
    K: {
      x_min: 0,
      x_max: 819.46875,
      ha: 906,
      o: "m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "
    },
    ",": {
      x_min: 0,
      x_max: 142,
      ha: 239,
      o: "m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "
    },
    d: {
      x_min: 0,
      x_max: 683,
      ha: 796,
      o: "m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "
    },
    "": {
      x_min: -109,
      x_max: 247,
      ha: 232,
      o: "m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "
    },
    E: {
      x_min: 0,
      x_max: 736.109375,
      ha: 789,
      o: "m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "
    },
    Y: {
      x_min: 0,
      x_max: 820,
      ha: 886,
      o: "m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "
    },
    '"': {
      x_min: 0,
      x_max: 299,
      ha: 396,
      o: "m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "
    },
    "": {
      x_min: 17.984375,
      x_max: 773.609375,
      ha: 792,
      o: "m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "
    },
    "": {
      x_min: 0,
      x_max: 364,
      ha: 467,
      o: "m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "
    },
    "": {
      x_min: 1,
      x_max: 710,
      ha: 810,
      o: "m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "
    },
    "": {
      x_min: 0,
      x_max: 634.71875,
      ha: 714,
      o: "m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "
    },
    "": {
      x_min: 0,
      x_max: 922,
      ha: 1031,
      o: "m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "
    },
    "": {
      x_min: 0,
      x_max: 96,
      ha: 251,
      o: "m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "
    },
    "": {
      x_min: 11,
      x_max: 781,
      ha: 792,
      o: "m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "
    },
    "|": {
      x_min: 343,
      x_max: 449,
      ha: 792,
      o: "m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "
    },
    "": {
      x_min: 0,
      x_max: 617,
      ha: 725,
      o: "m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "
    },
    "": {
      x_min: 0,
      x_max: 593,
      ha: 690,
      o: "m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "
    },
    b: {
      x_min: 0,
      x_max: 685,
      ha: 783,
      o: "m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "
    },
    q: {
      x_min: 0,
      x_max: 683,
      ha: 876,
      o: "m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "
    },
    "": {
      x_min: -.171875,
      x_max: 969.5625,
      ha: 1068,
      o: "m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "
    },
    "": {
      x_min: 0,
      x_max: 617,
      ha: 725,
      o: "m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "
    },
    z: {
      x_min: -.015625,
      x_max: 613.890625,
      ha: 697,
      o: "m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "
    },
    "": {
      x_min: 0,
      x_max: 894,
      ha: 1e3,
      o: "m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "
    },
    "": {
      x_min: .78125,
      x_max: 697,
      ha: 810,
      o: "m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "
    },
    "": {
      x_min: 0,
      x_max: 960,
      ha: 1056,
      o: "m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "
    },
    "": {
      x_min: -3,
      x_max: 1008,
      ha: 1106,
      o: "m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "
    },
    "~": {
      x_min: 0,
      x_max: 833,
      ha: 931,
      o: "m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "
    },
    "": {
      x_min: 0,
      x_max: 736.21875,
      ha: 778,
      o: "m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "
    },
    "": {
      x_min: 0,
      x_max: 450,
      ha: 547,
      o: "m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "
    },
    "[": {
      x_min: 0,
      x_max: 273.609375,
      ha: 371,
      o: "m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "
    },
    L: {
      x_min: 0,
      x_max: 645.828125,
      ha: 696,
      o: "m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "
    },
    "": {
      x_min: 0,
      x_max: 803.390625,
      ha: 894,
      o: "m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "
    },
    "": {
      x_min: 0,
      x_max: 573,
      ha: 642,
      o: "m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "
    },
    "": {
      x_min: 0,
      x_max: 674,
      ha: 778,
      o: "m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "
    },
    "": {
      x_min: 0,
      x_max: 958,
      ha: 1054,
      o: "m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "
    },
    "": {
      x_min: 0,
      x_max: 705.28125,
      ha: 749,
      o: "m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "
    },
    " ": {
      x_min: 0,
      x_max: 0,
      ha: 375
    },
    "%": {
      x_min: -3,
      x_max: 1089,
      ha: 1186,
      o: "m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "
    },
    P: {
      x_min: 0,
      x_max: 726,
      ha: 806,
      o: "m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "
    },
    "": {
      x_min: 0,
      x_max: 1078.21875,
      ha: 1118,
      o: "m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "
    },
    "": {
      x_min: .125,
      x_max: 1136.546875,
      ha: 1235,
      o: "m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "
    },
    _: {
      x_min: 0,
      x_max: 705.5625,
      ha: 803,
      o: "m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "
    },
    "": {
      x_min: -110,
      x_max: 246,
      ha: 275,
      o: "m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "
    },
    "+": {
      x_min: 23,
      x_max: 768,
      ha: 792,
      o: "m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "
    },
    "": {
      x_min: 0,
      x_max: 1050,
      ha: 1149,
      o: "m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "
    },
    "": {
      x_min: 0,
      x_max: 720,
      ha: 783,
      o: "m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "
    },
    "'": {
      x_min: 0,
      x_max: 139,
      ha: 236,
      o: "m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "
    },
    "": {
      x_min: 0,
      x_max: 350,
      ha: 397,
      o: "m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "
    },
    "": {
      x_min: 0,
      x_max: 450,
      ha: 553,
      o: "m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "
    },
    T: {
      x_min: 0,
      x_max: 777,
      ha: 835,
      o: "m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "
    },
    "": {
      x_min: 0,
      x_max: 915,
      ha: 997,
      o: "m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "
    },
    "": {
      x_min: 0,
      x_max: 0,
      ha: 694
    },
    j: {
      x_min: -77.78125,
      x_max: 167,
      ha: 349,
      o: "m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "
    },
    "": {
      x_min: 0,
      x_max: 756.953125,
      ha: 819,
      o: "m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "
    },
    1: {
      x_min: 215.671875,
      x_max: 574,
      ha: 792,
      o: "m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "
    },
    "": {
      x_min: 18.0625,
      x_max: 774,
      ha: 792,
      o: "m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "
    },
    "<": {
      x_min: 17.984375,
      x_max: 773.609375,
      ha: 792,
      o: "m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "
    },
    "": {
      x_min: 0,
      x_max: 704.484375,
      ha: 801,
      o: "m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "
    },
    t: {
      x_min: 0,
      x_max: 367,
      ha: 458,
      o: "m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "
    },
    "": {
      x_min: 0,
      x_max: 706,
      ha: 803,
      o: "m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "
    },
    "": {
      x_min: 0,
      x_max: 750,
      ha: 803,
      o: "m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "
    },
    W: {
      x_min: 0,
      x_max: 1263.890625,
      ha: 1351,
      o: "m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "
    },
    ">": {
      x_min: 18.0625,
      x_max: 774,
      ha: 792,
      o: "m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "
    },
    v: {
      x_min: 0,
      x_max: 675.15625,
      ha: 761,
      o: "m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "
    },
    "": {
      x_min: .28125,
      x_max: 644.5,
      ha: 703,
      o: "m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "
    },
    "": {
      x_min: 0,
      x_max: 624.9375,
      ha: 699,
      o: "m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "
    },
    "&": {
      x_min: -3,
      x_max: 894.25,
      ha: 992,
      o: "m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "
    },
    "": {
      x_min: 0,
      x_max: 862.5,
      ha: 942,
      o: "m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "
    },
    I: {
      x_min: 41,
      x_max: 180,
      ha: 293,
      o: "m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "
    },
    G: {
      x_min: 0,
      x_max: 921,
      ha: 1011,
      o: "m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "
    },
    "": {
      x_min: 0,
      x_max: 617,
      ha: 725,
      o: "m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "
    },
    "`": {
      x_min: 0,
      x_max: 138.890625,
      ha: 236,
      o: "m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "
    },
    "": {
      x_min: 0,
      x_max: 142,
      ha: 239,
      o: "m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "
    },
    "": {
      x_min: .328125,
      x_max: 819.515625,
      ha: 889,
      o: "m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "
    },
    r: {
      x_min: 0,
      x_max: 355.5625,
      ha: 432,
      o: "m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "
    },
    x: {
      x_min: 0,
      x_max: 675,
      ha: 764,
      o: "m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "
    },
    "": {
      x_min: 0,
      x_max: 696.609375,
      ha: 747,
      o: "m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "
    },
    h: {
      x_min: 0,
      x_max: 615,
      ha: 724,
      o: "m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "
    },
    ".": {
      x_min: 0,
      x_max: 142,
      ha: 239,
      o: "m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "
    },
    "": {
      x_min: -2,
      x_max: 878,
      ha: 974,
      o: "m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "
    },
    ";": {
      x_min: 0,
      x_max: 142,
      ha: 239,
      o: "m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "
    },
    f: {
      x_min: 0,
      x_max: 378,
      ha: 472,
      o: "m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "
    },
    "": {
      x_min: 1,
      x_max: 348.21875,
      ha: 454,
      o: "m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "
    },
    A: {
      x_min: .03125,
      x_max: 906.953125,
      ha: 1008,
      o: "m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "
    },
    6: {
      x_min: 53,
      x_max: 739,
      ha: 792,
      o: "m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "
    },
    "": {
      x_min: 1,
      x_max: 139.890625,
      ha: 236,
      o: "m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "
    },
    "": {
      x_min: -70,
      x_max: 283,
      ha: 361,
      o: "m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "
    },
    "": {
      x_min: -.21875,
      x_max: 773.21875,
      ha: 857,
      o: "m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "
    },
    "": {
      x_min: 0,
      x_max: 765.5625,
      ha: 809,
      o: "m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "
    },
    O: {
      x_min: 0,
      x_max: 958,
      ha: 1057,
      o: "m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "
    },
    n: {
      x_min: 0,
      x_max: 615,
      ha: 724,
      o: "m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "
    },
    3: {
      x_min: 54,
      x_max: 737,
      ha: 792,
      o: "m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "
    },
    9: {
      x_min: 53,
      x_max: 739,
      ha: 792,
      o: "m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "
    },
    l: {
      x_min: 41,
      x_max: 166,
      ha: 279,
      o: "m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "
    },
    "": {
      x_min: 40.09375,
      x_max: 728.796875,
      ha: 825,
      o: "m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "
    },
    "": {
      x_min: 0,
      x_max: 632.328125,
      ha: 679,
      o: "m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "
    },
    4: {
      x_min: 48,
      x_max: 742.453125,
      ha: 792,
      o: "m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "
    },
    p: {
      x_min: 0,
      x_max: 685,
      ha: 786,
      o: "m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "
    },
    "": {
      x_min: 0,
      x_max: 777,
      ha: 835,
      o: "m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "
    },
    "": {
      x_min: 0,
      x_max: 808,
      ha: 907,
      o: "m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "
    },
    "": {
      x_min: .78125,
      x_max: 697,
      ha: 810,
      o: "m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "
    }
  },
  cssFontWeight: "normal",
  ascender: 1189,
  underlinePosition: -100,
  cssFontStyle: "normal",
  boundingBox: {
    yMin: -334,
    xMin: -111,
    yMax: 1189,
    xMax: 1672
  },
  resolution: 1e3,
  original_font_information: {
    postscript_name: "Helvetiker-Regular",
    version_string: "Version 1.00 2004 initial release",
    vendor_url: "http://www.magenta.gr/",
    full_font_name: "Helvetiker",
    font_family_name: "Helvetiker",
    copyright: "Copyright (c) agenta ltd, 2004",
    description: "",
    trademark: "",
    designer: "",
    designer_url: "",
    unique_font_identifier: "agenta ltd:Helvetiker:22-10-104",
    license_url: "http://www.ellak.gr/fonts/MgOpen/license.html",
    license_description: 'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',
    manufacturer_name: "agenta ltd",
    font_sub_family_name: "Regular"
  },
  descender: -334,
  familyName: "Helvetiker",
  lineHeight: 1522,
  underlineThickness: 50
},
CLOUD.ViewHouse = function(t, e) {
  var i = this;
  this.viewer = t,
  this.preRotationHandle = e,
  this.mouseButtons = {
    LEFT: THREE.MOUSE.LEFT,
    RIGHT: THREE.MOUSE.RIGHT
  },
  this.visible = !0,
  this.isAnimationFinish = !0,
  this.pickedColor = 11653612,
  this.width = 0,
  this.height = 0,
  this.isDisable = !1;
  var n,
    o,
    r = CLOUD.Plugins.Font.helvetiker_regular,
    a = {
      Big: 0,
      Medium: 1,
      Small: 2
    },
    s = {
      Big: 220,
      Medium: 165,
      Small: 110
    },
    l = {
      Home: 0,
      Top: 1,
      Bottom: 2,
      Front: 3,
      Back: 4,
      Right: 5,
      Left: 6,
      SouthEast: 7,
      SouthWest: 8,
      NorthEast: 9,
      NorthWest: 10,
      BottomFront: 11,
      BottomBack: 12,
      BottomRight: 13,
      BottomLeft: 14,
      BottomSouthEast: 15,
      BottomSouthWest: 16,
      BottomNorthEast: 17,
      BottomNorthWest: 18,
      RoofFront: 19,
      RoofBack: 20,
      RoofRight: 21,
      RoofLeft: 22,
      RoofSouthEast: 23,
      RoofSouthWest: 24,
      RoofNorthEast: 25,
      RoofNorthWest: 26,
      TopTurnRight: 27,
      TopTurnBack: 28,
      TopTurnLeft: 29,
      BottomTurnRight: 30,
      BottomTurnBack: 31,
      BottomTurnLeft: 32,
      FrontTurnRight: 33,
      FrontTurnTop: 34,
      FrontTurnLeft: 35,
      RightTurnBack: 36,
      RightTurnTop: 37,
      RightTurnFront: 38,
      BackTurnRight: 39,
      BackTurnTop: 40,
      BackTurnLeft: 41,
      LeftTurnFront: 42,
      LeftTurnTop: 43,
      LeftTurnBack: 44
    },
    c = {
      Compass: "compass",
      Home: "home",
      BottomFloor: "Bottom_Floor",
      BottomSouth: "Bottom_South",
      BottomNorth: "Bottom_North",
      BottomEast: "Bottom_East",
      BottomWest: "Bottom_West",
      BottomSouthEast: "Bottom_SouthEast",
      BottomSouthWest: "Bottom_SouthWest",
      BottomNorthWest: "Bottom_NorthWest",
      BottomNorthEast: "Bottom_NorthEast",
      MiddleSouth: "Middle_South",
      MiddleNorth: "Middle_North",
      MiddleEast: "Middle_East",
      MiddleWest: "Middle_West",
      MiddleSouthEast: "Middle_SouthEast",
      MiddleSouthWest: "Middle_SouthWest",
      MiddleNorthWest: "Middle_NorthWest",
      MiddleNorthEast: "Middle_NorthEast",
      MiddleDoor: "Middle_Door",
      MiddleRightWindow: "Middle_RightWindow",
      MiddleLeftWindow: "Middle_LeftWindow",
      RoofCenter: "Roof_Center",
      RoofSouth: "Roof_South",
      RoofNorth: "Roof_North",
      RoofEast: "Roof_East",
      RoofWest: "Roof_West",
      RoofEaves: "Roof_Eaves",
      RoofSouthEast: "Roof_SouthEast",
      RoofSouthWest: "Roof_SouthWest",
      RoofNorthWest: "Roof_NorthWest",
      RoofNorthEast: "Roof_NorthEast",
      ControlPointNorth: "ControlPoint_North",
      ControlPointSouth: "ControlPoint_South",
      ControlPointEast: "ControlPoint_East",
      ControlPointWest: "ControlPoint_West",
      ControlRingNorthEast: "ControlRing_NorthEast",
      ControlRingSouthWest: "ControlRing_SouthWest",
      ControlRingNorthWest: "ControlRing_NorthWest",
      ControlRingSouthEast: "ControlRing_SouthEast"
    },
    h = new THREE.Scene,
    u = new THREE.OrthographicCamera(-s.Big / 2, s.Big / 2, s.Big / 2, -s.Big / 2, -s.Big / 2, s.Big / 2),
    d = new THREE.Raycaster,
    p = new THREE.Scene,
    f = u.clone(),
    m = new THREE.Raycaster,
    g = new THREE.Group,
    v = new THREE.Group,
    y = new THREE.Group,
    E = new THREE.Group,
    x = new THREE.Group,
    b = new THREE.Group,
    w = new THREE.Vector3,
    C = new THREE.Vector3,
    T = null,
    _ = null,
    L = null,
    M = null,
    S = null,
    O = null,
    D = null,
    R = null,
    U = null,
    A = null,
    I = null,
    P = null,
    B = 0,
    N = null,
    k = null,
    H = null,
    F = null,
    G = null,
    V = null,
    z = null,
    q = null,
    W = null,
    j = !0,
    X = !1,
    Y = !1,
    Z = !0,
    K = new THREE.Vector2,
    Q = new THREE.Vector2,
    J = new THREE.Vector2,
    $ = new THREE.Vector2,
    tt = !1,
    et = "",
    it = null,
    nt = 0,
    ot = 0,
    rt = -1,
    at = !1,
    st = function(t, e, i, n, o) {
      for (var r = e.length, a = new Float32Array(3 * r), s = 0; s < r; ++s)
        a[3 * s] = e[s].x,
        a[3 * s + 1] = e[s].y,
        a[3 * s + 2] = e[s].z;
      var l = new THREE.BufferGeometry;
      l.setIndex(new THREE.BufferAttribute(new Uint16Array(i), 1)),
      l.addAttribute("position", new THREE.BufferAttribute(a, 3));
      var c = new THREE.LineBasicMaterial({color: n, linewidth: o}),
        h = new THREE.Line(l, c);
      t.add(h)
    },
    lt = function(t, e, i) {
      t === c.MiddleDoor && (T = e, _ = i),
      t === c.MiddleSouth && (L = e, M = i),
      t === c.MiddleLeftWindow && (S = e, O = i),
      t === c.MiddleRightWindow && (D = e, R = i),
      t === c.MiddleWest && (U = e, A = i),
      t === c.MiddleEast && (I = e, P = i)
    },
    ct = function(t, e, i, n, o) {
      for (var r, a, s = new THREE.Geometry, l = 0, c = e.length; l < c;)
        r = new THREE.Vector3,
        r = e[l++],
        s.vertices.push(r);
      for (l = 0, c = i.length; l < c;)
        a = new THREE.Face3,
        a.a = i[l++],
        a.b = i[l++],
        a.c = i[l++],
        s.faces.push(a);
      var h = new THREE.MeshBasicMaterial({color: n}),
        u = new THREE.Mesh(s, h);
      u.name = o,
      lt(o, u, n),
      t.add(u)
    },
    ht = function() {
      nt = 40,
      ot = 35;
      var t = [];
      t.push(new THREE.Vector3(-27, -47.01, -40)),
      t.push(new THREE.Vector3(27, -47.01, -40)),
      t.push(new THREE.Vector3(27, -47.01, -34)),
      t.push(new THREE.Vector3(-27, -47.01, -34)),
      t.push(new THREE.Vector3(-27, -35.01, -40)),
      t.push(new THREE.Vector3(27, -35.01, -40)),
      t.push(new THREE.Vector3(27, -35.01, -34)),
      t.push(new THREE.Vector3(-27, -35.01, -34)),
      t.push(new THREE.Vector3(-21, -41.01, -34)),
      t.push(new THREE.Vector3(21, -41.01, -34)),
      t.push(new THREE.Vector3(21, -41.01, -28)),
      t.push(new THREE.Vector3(-21, -41.01, -28)),
      t.push(new THREE.Vector3(-21, -35.01, -34)),
      t.push(new THREE.Vector3(21, -35.01, -34)),
      t.push(new THREE.Vector3(21, -35.01, -28)),
      t.push(new THREE.Vector3(-21, -35.01, -28));
      var e = [
          4,
          5,
          6,
          6,
          7,
          4,
          5,
          1,
          2,
          2,
          6,
          5,
          0,
          4,
          7,
          7,
          3,
          0,
          7,
          6,
          2,
          2,
          3,
          7,
          0,
          1,
          5,
          5,
          4,
          0,
          12,
          13,
          14,
          14,
          15,
          12,
          13,
          9,
          10,
          10,
          14,
          13,
          8,
          12,
          15,
          15,
          11,
          8,
          15,
          14,
          10,
          10,
          11,
          15,
          8,
          9,
          13,
          13,
          12,
          8
        ],
        i = [];
      i.push(new THREE.Vector3(42.5, -35, -40)),
      i.push(new THREE.Vector3(33.5, -35, -40)),
      i.push(new THREE.Vector3(33.5, -35, -31)),
      i.push(new THREE.Vector3(42.5, -35, -31)),
      i.push(new THREE.Vector3(42.5, -26, -31)),
      i.push(new THREE.Vector3(42.5, -26, -40)),
      i.push(new THREE.Vector3(33.5, -26, -40));
      var n = [
          0,
          3,
          2,
          2,
          1,
          0,
          3,
          0,
          5,
          5,
          4,
          3,
          0,
          1,
          6,
          6,
          5,
          0
        ],
        o = [];
      o.push(new THREE.Vector3(42.5, 26, -40)),
      o.push(new THREE.Vector3(42.5, 26, -31)),
      o.push(new THREE.Vector3(42.5, -26, -31)),
      o.push(new THREE.Vector3(42.5, -26, -40)),
      o.push(new THREE.Vector3(33.5, -26, -40)),
      o.push(new THREE.Vector3(33.5, 26, -40));
      var r = [
          0,
          1,
          2,
          2,
          3,
          0,
          3,
          4,
          5,
          5,
          0,
          3
        ],
        a = [];
      a.push(new THREE.Vector3(42.5, 35, -40)),
      a.push(new THREE.Vector3(33.5, 35, -40)),
      a.push(new THREE.Vector3(33.5, 35, -31)),
      a.push(new THREE.Vector3(42.5, 35, -31)),
      a.push(new THREE.Vector3(42.5, 26, -31)),
      a.push(new THREE.Vector3(42.5, 26, -40)),
      a.push(new THREE.Vector3(33.5, 26, -40));
      var s = [
          0,
          1,
          2,
          2,
          3,
          0,
          3,
          4,
          5,
          5,
          0,
          3,
          0,
          5,
          6,
          6,
          1,
          0
        ],
        l = [];
      l.push(new THREE.Vector3(-33.5, 35, -40)),
      l.push(new THREE.Vector3(-33.5, 35, -31)),
      l.push(new THREE.Vector3(33.5, 35, -31)),
      l.push(new THREE.Vector3(33.5, 35, -40)),
      l.push(new THREE.Vector3(33.5, 26, -40)),
      l.push(new THREE.Vector3(-33.5, 26, -40));
      var h = [
          0,
          1,
          2,
          2,
          3,
          0,
          3,
          4,
          5,
          5,
          0,
          3
        ],
        u = [];
      u.push(new THREE.Vector3(-42.5, 35, -40)),
      u.push(new THREE.Vector3(-33.5, 35, -40)),
      u.push(new THREE.Vector3(-33.5, 35, -31)),
      u.push(new THREE.Vector3(-42.5, 35, -31)),
      u.push(new THREE.Vector3(-42.5, 26, -31)),
      u.push(new THREE.Vector3(-42.5, 26, -40)),
      u.push(new THREE.Vector3(-33.5, 26, -40));
      var d = [
          0,
          3,
          2,
          2,
          1,
          0,
          3,
          0,
          5,
          5,
          4,
          3,
          0,
          1,
          6,
          6,
          5,
          0
        ],
        p = [];
      p.push(new THREE.Vector3(-42.5, 26, -40)),
      p.push(new THREE.Vector3(-42.5, 26, -31)),
      p.push(new THREE.Vector3(-42.5, -26, -31)),
      p.push(new THREE.Vector3(-42.5, -26, -40)),
      p.push(new THREE.Vector3(-33.5, -26, -40)),
      p.push(new THREE.Vector3(-33.5, 26, -40));
      var f = [
          0,
          3,
          2,
          2,
          1,
          0,
          3,
          0,
          5,
          5,
          4,
          3
        ],
        m = [];
      m.push(new THREE.Vector3(-42.5, -35, -40)),
      m.push(new THREE.Vector3(-33.5, -35, -40)),
      m.push(new THREE.Vector3(-33.5, -35, -31)),
      m.push(new THREE.Vector3(-42.5, -35, -31)),
      m.push(new THREE.Vector3(-42.5, -26, -31)),
      m.push(new THREE.Vector3(-42.5, -26, -40)),
      m.push(new THREE.Vector3(-33.5, -26, -40));
      var g = [
          0,
          1,
          2,
          2,
          3,
          0,
          3,
          4,
          5,
          5,
          0,
          3,
          0,
          5,
          6,
          6,
          1,
          0
        ],
        v = [];
      v.push(new THREE.Vector3(-33.5, -35, -40)),
      v.push(new THREE.Vector3(-33.5, 26, -40)),
      v.push(new THREE.Vector3(33.5, 26, -40)),
      v.push(new THREE.Vector3(33.5, -35, -40));
      var E = [
          0,
          1,
          2,
          2,
          3,
          0
        ],
        x = [];
      x.push(new THREE.Vector3(-33.5, -35, -40)),
      x.push(new THREE.Vector3(33.5, -35, -40)),
      x.push(new THREE.Vector3(33.5, -35, 10)),
      x.push(new THREE.Vector3(-33.5, -35, 10));
      var b = [
          0,
          1,
          2,
          2,
          3,
          0
        ],
        w = [];
      w.push(new THREE.Vector3(33.5, -35, -31)),
      w.push(new THREE.Vector3(33.5, -35, 10)),
      w.push(new THREE.Vector3(42.5, -35, 10)),
      w.push(new THREE.Vector3(42.5, -35, -31)),
      w.push(new THREE.Vector3(42.5, -26, -31)),
      w.push(new THREE.Vector3(42.5, -26, 10));
      var C = [
          0,
          3,
          2,
          2,
          1,
          0,
          3,
          4,
          5,
          5,
          2,
          3
        ],
        T = [];
      T.push(new THREE.Vector3(42.5, -26, -31)),
      T.push(new THREE.Vector3(42.5, 26, -31)),
      T.push(new THREE.Vector3(42.5, 26, 10)),
      T.push(new THREE.Vector3(42.5, -26, 10));
      var _ = [
          0,
          1,
          2,
          2,
          3,
          0
        ],
        L = [];
      L.push(new THREE.Vector3(33.5, 35, -31)),
      L.push(new THREE.Vector3(33.5, 35, 10)),
      L.push(new THREE.Vector3(42.5, 35, 10)),
      L.push(new THREE.Vector3(42.5, 35, -31)),
      L.push(new THREE.Vector3(42.5, 26, -31)),
      L.push(new THREE.Vector3(42.5, 26, 10));
      var M = [
          0,
          1,
          2,
          2,
          3,
          0,
          3,
          2,
          5,
          5,
          4,
          3
        ],
        S = [];
      S.push(new THREE.Vector3(-33.5, 35, -31)),
      S.push(new THREE.Vector3(33.5, 35, -31)),
      S.push(new THREE.Vector3(33.5, 35, 10)),
      S.push(new THREE.Vector3(-33.5, 35, 10));
      var O = [
          0,
          3,
          2,
          2,
          1,
          0
        ],
        D = [];
      D.push(new THREE.Vector3(-33.5, 35, -31)),
      D.push(new THREE.Vector3(-33.5, 35, 10)),
      D.push(new THREE.Vector3(-42.5, 35, 10)),
      D.push(new THREE.Vector3(-42.5, 35, -31)),
      D.push(new THREE.Vector3(-42.5, 26, -31)),
      D.push(new THREE.Vector3(-42.5, 26, 10));
      var R = [
          0,
          3,
          2,
          2,
          1,
          0,
          3,
          4,
          5,
          5,
          2,
          3
        ],
        U = [];
      U.push(new THREE.Vector3(-42.5, -26, -31)),
      U.push(new THREE.Vector3(-42.5, 26, -31)),
      U.push(new THREE.Vector3(-42.5, 26, 10)),
      U.push(new THREE.Vector3(-42.5, -26, 10));
      var A = [
          0,
          3,
          2,
          2,
          1,
          0
        ],
        I = [];
      I.push(new THREE.Vector3(-33.5, -35, -31)),
      I.push(new THREE.Vector3(-33.5, -35, 10)),
      I.push(new THREE.Vector3(-42.5, -35, 10)),
      I.push(new THREE.Vector3(-42.5, -35, -31)),
      I.push(new THREE.Vector3(-42.5, -26, -31)),
      I.push(new THREE.Vector3(-42.5, -26, 10));
      var P = [
          0,
          1,
          2,
          2,
          3,
          0,
          3,
          2,
          5,
          5,
          4,
          3
        ],
        B = [];
      B.push(new THREE.Vector3(-15, -35.01, -28)),
      B.push(new THREE.Vector3(15, -35.01, -28)),
      B.push(new THREE.Vector3(15, -35.01, 0)),
      B.push(new THREE.Vector3(-15, -35.01, 0));
      var N = [
          0,
          1,
          2,
          2,
          3,
          0
        ],
        k = [];
      k.push(new THREE.Vector3(42.51, -12.5, -25)),
      k.push(new THREE.Vector3(42.51, 12.5, -25)),
      k.push(new THREE.Vector3(42.51, 12.5, 0)),
      k.push(new THREE.Vector3(42.51, -12.5, 0));
      var H = [
          0,
          1,
          2,
          2,
          3,
          0
        ],
        F = [];
      F.push(new THREE.Vector3(-42.51, -12.5, -25)),
      F.push(new THREE.Vector3(-42.51, 12.5, -25)),
      F.push(new THREE.Vector3(-42.51, 12.5, 0)),
      F.push(new THREE.Vector3(-42.51, -12.5, 0));
      var G = [
          0,
          3,
          2,
          2,
          1,
          0
        ],
        V = [];
      V.push(new THREE.Vector3(-41, -40, 10)),
      V.push(new THREE.Vector3(41, -40, 10)),
      V.push(new THREE.Vector3(18, -21, 40)),
      V.push(new THREE.Vector3(-18, -21, 40)),
      V.push(new THREE.Vector3(-18, -12, 40)),
      V.push(new THREE.Vector3(18, -12, 40));
      var z = [
          0,
          1,
          2,
          0,
          2,
          3,
          4,
          3,
          2,
          4,
          2,
          5
        ],
        q = [];
      q.push(new THREE.Vector3(27, -21, 40)),
      q.push(new THREE.Vector3(27, -12, 40)),
      q.push(new THREE.Vector3(18, -12, 40)),
      q.push(new THREE.Vector3(18, -21, 40)),
      q.push(new THREE.Vector3(41, -40, 10)),
      q.push(new THREE.Vector3(50, -40, 10)),
      q.push(new THREE.Vector3(50, -31, 10));
      var W = [
          0,
          1,
          2,
          2,
          3,
          0,
          3,
          4,
          5,
          5,
          0,
          3,
          0,
          5,
          6,
          6,
          1,
          0
        ],
        j = [];
      j.push(new THREE.Vector3(50, -31, 10)),
      j.push(new THREE.Vector3(50, 31, 10)),
      j.push(new THREE.Vector3(27, 12, 40)),
      j.push(new THREE.Vector3(27, -12, 40)),
      j.push(new THREE.Vector3(18, -12, 40)),
      j.push(new THREE.Vector3(18, 12, 40));
      var X = [
          0,
          1,
          2,
          0,
          2,
          3,
          4,
          3,
          2,
          4,
          2,
          5
        ],
        Y = [];
      Y.push(new THREE.Vector3(27, 21, 40)),
      Y.push(new THREE.Vector3(27, 12, 40)),
      Y.push(new THREE.Vector3(18, 12, 40)),
      Y.push(new THREE.Vector3(18, 21, 40)),
      Y.push(new THREE.Vector3(41, 40, 10)),
      Y.push(new THREE.Vector3(50, 40, 10)),
      Y.push(new THREE.Vector3(50, 31, 10));
      var Z = [
          0,
          3,
          2,
          2,
          1,
          0,
          3,
          0,
          5,
          5,
          4,
          3,
          0,
          1,
          6,
          6,
          5,
          0
        ],
        K = [];
      K.push(new THREE.Vector3(41, 40, 10)),
      K.push(new THREE.Vector3(-41, 40, 10)),
      K.push(new THREE.Vector3(-18, 21, 40)),
      K.push(new THREE.Vector3(18, 21, 40)),
      K.push(new THREE.Vector3(18, 12, 40)),
      K.push(new THREE.Vector3(-18, 12, 40));
      var Q = [
          0,
          1,
          2,
          0,
          2,
          3,
          4,
          3,
          2,
          4,
          2,
          5
        ],
        J = [];
      J.push(new THREE.Vector3(-27, 21, 40)),
      J.push(new THREE.Vector3(-27, 12, 40)),
      J.push(new THREE.Vector3(-18, 12, 40)),
      J.push(new THREE.Vector3(-18, 21, 40)),
      J.push(new THREE.Vector3(-41, 40, 10)),
      J.push(new THREE.Vector3(-50, 40, 10)),
      J.push(new THREE.Vector3(-50, 31, 10));
      var $ = [
          0,
          1,
          2,
          2,
          3,
          0,
          3,
          4,
          5,
          5,
          0,
          3,
          0,
          5,
          6,
          6,
          1,
          0
        ],
        tt = [];
      tt.push(new THREE.Vector3(-50, 31, 10)),
      tt.push(new THREE.Vector3(-50, -31, 10)),
      tt.push(new THREE.Vector3(-27, -12, 40)),
      tt.push(new THREE.Vector3(-27, 12, 40)),
      tt.push(new THREE.Vector3(-18, 12, 40)),
      tt.push(new THREE.Vector3(-18, -12, 40));
      var et = [
          0,
          1,
          2,
          0,
          2,
          3,
          4,
          3,
          2,
          4,
          2,
          5
        ],
        it = [];
      it.push(new THREE.Vector3(-27, -21, 40)),
      it.push(new THREE.Vector3(-27, -12, 40)),
      it.push(new THREE.Vector3(-18, -12, 40)),
      it.push(new THREE.Vector3(-18, -21, 40)),
      it.push(new THREE.Vector3(-41, -40, 10)),
      it.push(new THREE.Vector3(-50, -40, 10)),
      it.push(new THREE.Vector3(-50, -31, 10));
      var rt = [
          0,
          3,
          2,
          2,
          1,
          0,
          3,
          0,
          5,
          5,
          4,
          3,
          0,
          1,
          6,
          6,
          5,
          0
        ],
        at = [];
      at.push(new THREE.Vector3(18, -12, 40)),
      at.push(new THREE.Vector3(-18, -12, 40)),
      at.push(new THREE.Vector3(-18, 12, 40)),
      at.push(new THREE.Vector3(18, 12, 40));
      var lt = [
          0,
          2,
          1,
          0,
          3,
          2
        ],
        ht = [];
      ht.push(new THREE.Vector3(50, 40, 10)),
      ht.push(new THREE.Vector3(-50, 40, 10)),
      ht.push(new THREE.Vector3(-50, -40, 10)),
      ht.push(new THREE.Vector3(50, -40, 10)),
      ht.push(new THREE.Vector3(42.5, 35, 10)),
      ht.push(new THREE.Vector3(-42.5, 35, 10)),
      ht.push(new THREE.Vector3(-42.5, -35, 10)),
      ht.push(new THREE.Vector3(42.5, -35, 10));
      for (var ut = [
        0,
        4,
        5,
        5,
        1,
        0,
        1,
        5,
        6,
        6,
        2,
        1,
        2,
        6,
        7,
        7,
        3,
        2,
        3,
        7,
        4,
        4,
        0,
        3
      ], dt = [
        t,
        i,
        o,
        a,
        l,
        u,
        p,
        m,
        v,
        x,
        w,
        T,
        L,
        S,
        D,
        U,
        I,
        B,
        k,
        F,
        V,
        q,
        j,
        Y,
        K,
        J,
        tt,
        it,
        at,
        ht
      ], pt = [
        e,
        n,
        r,
        s,
        h,
        d,
        f,
        g,
        E,
        b,
        C,
        _,
        M,
        O,
        R,
        A,
        P,
        N,
        H,
        G,
        z,
        W,
        X,
        Z,
        Q,
        $,
        et,
        rt,
        lt,
        ut
      ], ft = [
        c.BottomSouth,
        c.BottomSouthEast,
        c.BottomEast,
        c.BottomNorthEast,
        c.BottomNorth,
        c.BottomNorthWest,
        c.BottomWest,
        c.BottomSouthWest,
        c.BottomFloor,
        c.MiddleSouth,
        c.MiddleSouthEast,
        c.MiddleEast,
        c.MiddleNorthEast,
        c.MiddleNorth,
        c.MiddleNorthWest,
        c.MiddleWest,
        c.MiddleSouthWest,
        c.MiddleDoor,
        c.MiddleRightWindow,
        c.MiddleLeftWindow,
        c.RoofSouth,
        c.RoofSouthEast,
        c.RoofEast,
        c.RoofNorthEast,
        c.RoofNorth,
        c.RoofNorthWest,
        c.RoofWest,
        c.RoofSouthWest,
        c.RoofCenter,
        c.RoofEaves
      ], mt = [
        10069173,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        15198188,
        10069173,
        10069173,
        10069173,
        10069173,
        10069173,
        10069173,
        10069173,
        10069173,
        10069173,
        10069173,
        10069173,
        15198188,
        15198188
      ], gt = 0; gt < dt.length; ++gt)
        ct(y, dt[gt], pt[gt], mt[gt], ft[gt]);
      var vt = [];
      vt.push(new THREE.Vector3(-42.5, -35, -40)),
      vt.push(new THREE.Vector3(42.5, -35, -40)),
      vt.push(new THREE.Vector3(42.5, 35, -40)),
      vt.push(new THREE.Vector3(-42.5, 35, -40)),
      vt.push(new THREE.Vector3(-42.5, -35, 10)),
      vt.push(new THREE.Vector3(42.5, -35, 10)),
      vt.push(new THREE.Vector3(42.5, 35, 10)),
      vt.push(new THREE.Vector3(-42.5, 35, 10)),
      vt.push(new THREE.Vector3(-50, -40, 10)),
      vt.push(new THREE.Vector3(50, -40, 10)),
      vt.push(new THREE.Vector3(50, 40, 10)),
      vt.push(new THREE.Vector3(-50, 40, 10)),
      vt.push(new THREE.Vector3(-27, -21, 40)),
      vt.push(new THREE.Vector3(27, -21, 40)),
      vt.push(new THREE.Vector3(27, 21, 40)),
      vt.push(new THREE.Vector3(-27, 21, 40)),
      vt.push(new THREE.Vector3(-27, -47.01, -40)),
      vt.push(new THREE.Vector3(27, -47.01, -40)),
      vt.push(new THREE.Vector3(27, -47.01, -34)),
      vt.push(new THREE.Vector3(-27, -47.01, -34)),
      vt.push(new THREE.Vector3(-27, -35.01, -40)),
      vt.push(new THREE.Vector3(27, -35.01, -40)),
      vt.push(new THREE.Vector3(27, -35.01, -34)),
      vt.push(new THREE.Vector3(-27, -35.01, -34)),
      vt.push(new THREE.Vector3(-21, -41.01, -34)),
      vt.push(new THREE.Vector3(21, -41.01, -34)),
      vt.push(new THREE.Vector3(21, -41.01, -28)),
      vt.push(new THREE.Vector3(-21, -41.01, -28)),
      vt.push(new THREE.Vector3(-21, -35.01, -31)),
      vt.push(new THREE.Vector3(21, -35.01, -31)),
      vt.push(new THREE.Vector3(21, -35.01, -28)),
      vt.push(new THREE.Vector3(-21, -35.01, -28)),
      vt.push(new THREE.Vector3(-15, -35.01, -28)),
      vt.push(new THREE.Vector3(15, -35.01, -28)),
      vt.push(new THREE.Vector3(15, -35.01, 0)),
      vt.push(new THREE.Vector3(-15, -35.01, 0)),
      vt.push(new THREE.Vector3(-42.51, -12.5, -25)),
      vt.push(new THREE.Vector3(-42.51, 12.5, -25)),
      vt.push(new THREE.Vector3(-42.51, 12.5, 0)),
      vt.push(new THREE.Vector3(-42.51, -12.5, 0)),
      vt.push(new THREE.Vector3(42.51, -12.5, -25)),
      vt.push(new THREE.Vector3(42.51, 12.5, -25)),
      vt.push(new THREE.Vector3(42.51, 12.5, 0)),
      vt.push(new THREE.Vector3(42.51, -12.5, 0));
      for (var yt = [
        [
          0, 1, 2, 3, 0
        ],
        [
          4, 5, 6, 7, 4
        ],
        [
          0, 4
        ],
        [
          1, 5
        ],
        [
          3, 7
        ],
        [
          2, 6
        ],
        [
          8, 9, 10, 11, 8
        ],
        [
          12, 13, 14, 15, 12
        ],
        [
          8, 12
        ],
        [
          9, 13
        ],
        [
          10, 14
        ],
        [
          11, 15
        ],
        [
          16, 17, 18, 19, 16
        ],
        [
          20, 21, 22, 23, 20
        ],
        [
          16, 20
        ],
        [
          17, 21
        ],
        [
          18, 22
        ],
        [
          19, 23
        ],
        [
          24, 25, 26, 27, 24
        ],
        [
          28, 29, 30, 31, 28
        ],
        [
          24, 28
        ],
        [
          25, 29
        ],
        [
          26, 30
        ],
        [
          27, 31
        ],
        [
          32, 33, 34, 35, 32
        ],
        [
          36, 37, 38, 39, 36
        ],
        [
          40, 41, 42, 43, 40
        ]
      ], Et = 0; Et < yt.length; ++Et)
        st(y, vt, yt[Et], 7895160, 5)
    },
    ut = function() {
      var t = new THREE.MeshBasicMaterial({color: 14408667, side: THREE.DoubleSide}),
        e = new THREE.MeshBasicMaterial({
          color: 10439242,
          side: THREE.DoubleSide,
          depthTest: !1
        }),
        i = new THREE.MeshBasicMaterial({
          color: 16711680,
          overdraw: 0,
          side: THREE.DoubleSide,
          depthTest: !1
        }),
        n = new THREE.Shape;
      n.moveTo(30, 0),
      n.lineTo(0, 15),
      n.lineTo(0, -15),
      n.lineTo(30, 0);
      var o = new THREE.ShapeGeometry(n),
        a = new THREE.Mesh(o, t);
      a.translateX(80);
      var s = new THREE.Mesh(o, t);
      s.rotateZ(Math.PI),
      s.translateX(80);
      var l = new THREE.Mesh(o, e);
      l.rotateZ(Math.PI / 2),
      l.translateX(80);
      var h = new THREE.Mesh(o, t);
      h.rotateZ(-Math.PI / 2),
      h.translateX(80),
      g.add(a),
      g.add(s),
      g.add(l),
      g.add(h);
      var u = new THREE.Font(r),
        d = {
          size: 12,
          height: 1,
          curveSegments: 2,
          font: u
        },
        p = new THREE.TextGeometry("N", d),
        f = new THREE.TextGeometry("S", d),
        m = new THREE.TextGeometry("E", d),
        v = new THREE.TextGeometry("W", d);
      p.computeBoundingBox(),
      f.computeBoundingBox(),
      m.computeBoundingBox(),
      v.computeBoundingBox();
      var y,
        E,
        x,
        b,
        w;
      y = -.5 * (p.boundingBox.max.x - p.boundingBox.min.x),
      E = new THREE.Mesh(p, i),
      E.translateX(y),
      E.translateY(82),
      y = -.5 * (f.boundingBox.max.x - f.boundingBox.min.x),
      x = new THREE.Mesh(f, i),
      x.rotateZ(Math.PI),
      x.translateX(y),
      x.translateY(82),
      y = -.5 * (m.boundingBox.max.x - m.boundingBox.min.x),
      b = new THREE.Mesh(m, i),
      b.rotateZ(-Math.PI / 2),
      b.translateX(y),
      b.translateY(82),
      y = -.5 * (m.boundingBox.max.x - m.boundingBox.min.x),
      w = new THREE.Mesh(v, i),
      w.rotateZ(Math.PI / 2),
      w.translateX(y),
      w.translateY(82),
      g.add(E),
      g.add(x),
      g.add(b),
      g.add(w);
      var C = new THREE.RingGeometry(65, 82, 32, 5, 0, 2 * Math.PI),
        T = new THREE.Mesh(C, t);
      T.name = c.Compass,
      g.add(T)
    },
    dt = function() {
      var t = {
          color: 10069173,
          side: THREE.DoubleSide
        },
        e = {
          color: 10069173,
          side: THREE.DoubleSide
        },
        i = Math.asin(10 / 75),
        n = Math.PI / 2 - 2 * i,
        o = new THREE.RingGeometry(73.5, 76.5, 32, 5, i, n),
        r = new THREE.Mesh(o, new THREE.MeshBasicMaterial(t));
      r.name = c.ControlRingNorthEast,
      v.add(r);
      var r = new THREE.Mesh(o, new THREE.MeshBasicMaterial(t));
      r.name = c.ControlRingNorthWest,
      r.rotateZ(Math.PI / 2),
      v.add(r);
      var r = new THREE.Mesh(o, new THREE.MeshBasicMaterial(t));
      r.name = c.ControlRingSouthWest,
      r.rotateZ(Math.PI),
      v.add(r);
      var r = new THREE.Mesh(o, new THREE.MeshBasicMaterial(t));
      r.name = c.ControlRingSouthEast,
      r.rotateZ(-Math.PI / 2),
      v.add(r);
      var a = new THREE.Shape;
      a.moveTo(10, 0),
      a.absarc(0, 0, 10, 0, 2 * Math.PI, !1);
      var s = new THREE.ShapeGeometry(a),
        r = new THREE.Mesh(s, new THREE.MeshBasicMaterial(e));
      r.name = c.ControlPointNorth,
      r.rotateZ(Math.PI / 2),
      r.translateX(75),
      v.add(r);
      var r = new THREE.Mesh(s, new THREE.MeshBasicMaterial(e));
      r.name = c.ControlPointSouth,
      r.rotateZ(-Math.PI / 2),
      r.translateX(75),
      v.add(r);
      var r = new THREE.Mesh(s, new THREE.MeshBasicMaterial(e));
      r.name = c.ControlPointEast,
      r.translateX(75),
      v.add(r);
      var r = new THREE.Mesh(s, new THREE.MeshBasicMaterial(e));
      r.name = c.ControlPointWest,
      r.translateX(-75),
      v.add(r)
    },
    pt = function() {
      var t = [];
      t.push(new THREE.Vector3(0, 30, 0)),
      t.push(new THREE.Vector3(-15, 15, 0)),
      t.push(new THREE.Vector3(-12, 15, 0)),
      t.push(new THREE.Vector3(-12, 0, 0)),
      t.push(new THREE.Vector3(-4, 0, 0)),
      t.push(new THREE.Vector3(-4, 13, 0)),
      t.push(new THREE.Vector3(4, 13, 0)),
      t.push(new THREE.Vector3(4, 0, 0)),
      t.push(new THREE.Vector3(12, 0, 0)),
      t.push(new THREE.Vector3(12, 15, 0)),
      t.push(new THREE.Vector3(15, 15, 0)),
      t.push(new THREE.Vector3(0, 30, 0));
      for (var e = new THREE.Geometry, i = 0; i < t.length; ++i)
        e.vertices.push(t[i].multiplyScalar(1));
      var n = new THREE.Line(e, new THREE.LineBasicMaterial({color: 7895160, linewidth: 5}));
      n.position.x = -95,
      n.position.y = 80,
      E.add(n);
      var o = new THREE.Shape;
      o.moveTo(t[0].x, t[0].y);
      for (var r = 1; r < t.length; ++r)
        o.lineTo(t[r].x, t[r].y);
      var e = new THREE.ShapeGeometry(o),
        n = new THREE.Mesh(e, new THREE.MeshBasicMaterial({color: 15198188, side: THREE.DoubleSide}));
      n.position.x = -95,
      n.position.y = 80,
      n.name = c.Home,
      E.add(n)
    },
    ft = function() {
      var t = {
          color: 11653612,
          side: THREE.DoubleSide
        },
        e = {
          color: 489172,
          linewidth: 5
        },
        i = Math.asin(10 / 75),
        n = Math.PI / 2 - 2 * i,
        o = new THREE.RingGeometry(75 - 10 / 3, 75 + 10 / 3, 32, 5, i, n);
      B = 75,
      N = new THREE.Mesh(o, new THREE.MeshBasicMaterial(t)),
      N.translateZ(.01),
      b.add(N),
      k = new THREE.Quaternion,
      k.copy(N.quaternion),
      H = new THREE.Vector3,
      H.copy(N.position);
      var r = new THREE.Shape;
      r.moveTo(10, 0),
      r.absarc(0, 0, 10, 0, 2 * Math.PI, !1);
      var a = new THREE.ShapeGeometry(r);
      F = new THREE.Mesh(a, new THREE.MeshBasicMaterial(t)),
      F.translateZ(.01),
      b.add(F),
      G = new THREE.Quaternion,
      G.copy(F.quaternion),
      V = new THREE.Vector3,
      V.copy(F.position);
      for (var s = [
        new THREE.Vector3(20 * .707 / 4, 20 * .707 / 2, 0),
        new THREE.Vector3(-20 * .707 / 4, 0, 0),
        new THREE.Vector3(20 * .707 / 4, -20 * .707 / 2, 0)
      ], a = new THREE.Geometry, l = 0; l < s.length; ++l)
        a.vertices.push(s[l]);
      z = new THREE.Line(a, new THREE.LineBasicMaterial(e)),
      z.translateZ(.015),
      b.add(z),
      q = new THREE.Quaternion,
      q.copy(z.quaternion),
      W = new THREE.Vector3,
      W.copy(z.position),
      N.visible = !1,
      F.visible = !1,
      z.visible = !1
    },
    mt = function(t) {
      switch (t) {
        case a.Big:
          i.width = s.Big,
          i.height = s.Big;
          break;
        case a.Medium:
          i.width = s.Medium,
          i.height = s.Medium;
          break;
        case a.Small:
        default:
          i.width = s.Small,
          i.height = s.Small
      }
      n.style.width = i.width + "px",
      n.style.height = i.height + "px"
    },
    gt = function(t) {
      var e = n;
      if (void 0 !== e) {
        var o = CLOUD.DomUtil.getContainerOffsetToClient(e),
          r = new THREE.Vector2;
        if (r.x = t.x - o.left, r.y = t.y - o.top, r.x > 0 && r.x < i.width && r.y > 0 && r.y < i.height)
          return $.x = r.x / i.width * 2 - 1,
          $.y = -r.y / i.height * 2 + 1,
          !0
      }
      return !1
    },
    vt = function(t) {
      X = t,
      E.visible = !!t
    },
    yt = function(t) {
      if (Z = t, t) {
        for (var e = y.children, i = 0; i < e.length; i++)
          e[i].material.transparent = !0,
          e[i].material.opacity = .6;
        for (var n = v.children, i = 0; i < n.length; i++)
          n[i].material.transparent = !0,
          n[i].material.opacity = .6;
        for (var o = g.children, i = 0; i < o.length; i++)
          o[i].material.transparent = !0,
          o[i].material.opacity = .6;
        for (var r = E.children, i = 0; i < r.length; i++)
          r[i].material.transparent = !0,
          r[i].material.opacity = .6
      } else {
        for (var e = y.children, i = 0; i < e.length; i++)
          e[i].material.transparent = !1,
          e[i].material.opacity = 1;
        for (var n = v.children, i = 0; i < n.length; i++)
          n[i].material.transparent = !1,
          n[i].material.opacity = 1;
        for (var o = g.children, i = 0; i < o.length; i++)
          o[i].material.transparent = !1,
          o[i].material.opacity = 1;
        for (var r = E.children, i = 0; i < r.length; i++)
          r[i].material.transparent = !1,
          r[i].material.opacity = 1
      }
    },
    Et = function(t) {
      var e = -1,
        i = !1;
      switch ($.x * $.y > 0 && (i = !0), t) {
        case c.Home:
          e = l.Home;
          break;
        case c.RoofCenter:
          e = rt === l.RoofFront || rt === l.RoofSouthEast || rt === l.RoofSouthWest
            ? l.Top
            : rt === l.RoofRight
              ? l.TopTurnRight
              : rt === l.RoofBack || rt === l.RoofNorthEast || rt === l.RoofNorthWest
                ? l.TopTurnBack
                : rt === l.RoofLeft
                  ? l.TopTurnLeft
                  : rt === l.TopTurnRight
                    ? l.TopTurnRight
                    : rt === l.TopTurnBack
                      ? l.TopTurnBack
                      : rt === l.TopTurnLeft
                        ? l.TopTurnLeft
                        : l.Top;
          break;
        case c.BottomFloor:
          e = rt === l.BottomFront || rt === l.BottomSouthEast || rt === l.BottomSouthWest
            ? l.Bottom
            : rt === l.BottomRight
              ? l.BottomTurnLeft
              : rt === l.BottomBack || rt === l.BottomNorthEast || rt === l.BottomNorthWest
                ? l.BottomTurnBack
                : rt === l.BottomLeft
                  ? l.BottomTurnRight
                  : rt === l.BottomTurnRight
                    ? l.BottomTurnRight
                    : rt === l.BottomTurnBack
                      ? l.BottomTurnBack
                      : rt === l.BottomTurnLeft
                        ? l.BottomTurnLeft
                        : l.Bottom;
          break;
        case c.BottomSouth:
          e = l.BottomFront;
          break;
        case c.BottomNorth:
          e = l.BottomBack;
          break;
        case c.BottomEast:
          e = l.BottomRight;
          break;
        case c.BottomWest:
          e = l.BottomLeft;
          break;
        case c.BottomSouthEast:
          e = l.BottomSouthEast;
          break;
        case c.BottomSouthWest:
          e = l.BottomSouthWest;
          break;
        case c.BottomNorthWest:
          e = l.BottomNorthWest;
          break;
        case c.BottomNorthEast:
          e = l.BottomNorthEast;
          break;
        case c.MiddleSouth:
        case c.MiddleDoor:
          e = l.Front;
          break;
        case c.MiddleNorth:
          e = l.Back;
          break;
        case c.MiddleRightWindow:
        case c.MiddleEast:
          e = l.Right;
          break;
        case c.MiddleWest:
        case c.MiddleLeftWindow:
          e = l.Left;
          break;
        case c.MiddleSouthEast:
          e = l.SouthEast;
          break;
        case c.MiddleSouthWest:
          e = l.SouthWest;
          break;
        case c.MiddleNorthWest:
          e = l.NorthWest;
          break;
        case c.MiddleNorthEast:
          e = l.NorthEast;
          break;
        case c.RoofSouth:
          e = l.RoofFront;
          break;
        case c.RoofNorth:
          e = l.RoofBack;
          break;
        case c.RoofEast:
          e = l.RoofRight;
          break;
        case c.RoofWest:
          e = l.RoofLeft;
          break;
        case c.RoofSouthEast:
          e = l.RoofSouthEast;
          break;
        case c.RoofSouthWest:
          e = l.RoofSouthWest;
          break;
        case c.RoofNorthWest:
          e = l.RoofNorthWest;
          break;
        case c.RoofNorthEast:
          e = l.RoofNorthEast;
          break;
        case c.ControlPointNorth:
          e = rt === l.Front
            ? l.Top
            : rt === l.Top
              ? l.Back
              : rt === l.Back
                ? l.TopTurnBack
                : rt === l.TopTurnBack
                  ? l.Front
                  : rt === l.Right
                    ? l.TopTurnRight
                    : rt === l.TopTurnRight
                      ? l.Left
                      : rt === l.Left
                        ? l.TopTurnLeft
                        : rt === l.TopTurnLeft
                          ? l.Right
                          : rt === l.BackTurnRight
                            ? l.Left
                            : rt === l.BackTurnLeft
                              ? l.Right
                              : rt === l.BackTurnTop
                                ? l.Back
                                : rt === l.RightTurnFront
                                  ? l.Back
                                  : rt === l.RightTurnBack
                                    ? l.Front
                                    : rt === l.RightTurnTop
                                      ? l.Bottom
                                      : rt === l.LeftTurnFront
                                        ? l.Back
                                        : rt === l.LeftTurnBack
                                          ? l.Front
                                          : rt === l.LeftTurnTop
                                            ? l.Bottom
                                            : rt === l.BottomTurnRight
                                              ? l.Left
                                              : rt === l.BottomTurnLeft
                                                ? l.Right
                                                : rt === l.BottomTurnBack
                                                  ? l.Back
                                                  : rt === l.FrontTurnRight
                                                    ? l.Left
                                                    : rt === l.FrontTurnLeft
                                                      ? l.Right
                                                      : rt === l.FrontTurnTop
                                                        ? l.Bottom
                                                        : l.Top;
          break;
        case c.ControlPointSouth:
          e = rt === l.Front
            ? l.Bottom
            : rt === l.Bottom
              ? l.Back
              : rt === l.Back
                ? l.BottomTurnBack
                : rt === l.BottomTurnBack
                  ? l.Front
                  : rt === l.Right
                    ? l.BottomTurnRight
                    : rt === l.BottomTurnRight
                      ? l.Left
                      : rt === l.Left
                        ? l.BottomTurnLeft
                        : rt === l.BottomTurnLeft
                          ? l.Right
                          : rt === l.FrontTurnRight
                            ? l.Right
                            : rt === l.FrontTurnLeft
                              ? l.Left
                              : rt === l.FrontTurnTop
                                ? l.Top
                                : rt === l.RightTurnFront
                                  ? l.Front
                                  : rt === l.RightTurnBack
                                    ? l.Back
                                    : rt === l.RightTurnTop
                                      ? l.Top
                                      : rt === l.BackTurnRight
                                        ? l.Right
                                        : rt === l.BackTurnLeft
                                          ? l.Left
                                          : rt === l.BackTurnTop
                                            ? l.Top
                                            : rt === l.LeftTurnFront
                                              ? l.Front
                                              : rt === l.LeftTurnBack
                                                ? l.Back
                                                : rt === l.LeftTurnTop
                                                  ? l.Top
                                                  : rt === l.Top
                                                    ? l.Front
                                                    : rt === l.TopTurnRight
                                                      ? l.Right
                                                      : rt === l.TopTurnBack
                                                        ? l.Back
                                                        : rt === l.TopTurnLeft
                                                          ? l.Left
                                                          : l.Bottom;
          break;
        case c.ControlPointEast:
          e = rt === l.Front
            ? l.Right
            : rt === l.Right
              ? l.Back
              : rt === l.Back
                ? l.Left
                : rt === l.Left
                  ? l.Front
                  : rt === l.Top
                    ? l.Right
                    : rt === l.TopTurnRight
                      ? l.Back
                      : rt === l.TopTurnBack
                        ? l.Left
                        : rt === l.TopTurnLeft
                          ? l.Front
                          : rt === l.Bottom
                            ? l.Right
                            : rt === l.BottomTurnRight
                              ? l.Front
                              : rt === l.BottomTurnBack
                                ? l.Left
                                : rt === l.BottomTurnLeft
                                  ? l.Back
                                  : rt === l.FrontTurnRight
                                    ? l.Top
                                    : rt === l.FrontTurnLeft
                                      ? l.Bottom
                                      : rt === l.FrontTurnTop
                                        ? l.Left
                                        : rt === l.RightTurnFront
                                          ? l.Back
                                          : rt === l.RightTurnBack
                                            ? l.Top
                                            : rt === l.RightTurnTop
                                              ? l.Front
                                              : rt === l.BackTurnRight
                                                ? l.Top
                                                : rt === l.BackTurnLeft
                                                  ? l.Bottom
                                                  : rt === l.BackTurnTop
                                                    ? l.Left
                                                    : rt === l.LeftTurnFront
                                                      ? l.Top
                                                      : rt === l.LeftTurnBack
                                                        ? l.Bottom
                                                        : rt === l.LeftTurnTop
                                                          ? l.Back
                                                          : l.Right;
          break;
        case c.ControlPointWest:
          e = rt === l.Front
            ? l.Left
            : rt === l.Left
              ? l.Back
              : rt === l.Back
                ? l.Right
                : rt === l.Right
                  ? l.Front
                  : rt === l.Front
                    ? l.Left
                    : rt === l.Top
                      ? l.Left
                      : rt === l.TopTurnRight
                        ? l.Front
                        : rt === l.TopTurnBack
                          ? l.Right
                          : rt === l.TopTurnLeft
                            ? l.Back
                            : rt === l.Bottom
                              ? l.Left
                              : rt === l.BottomTurnRight
                                ? l.Back
                                : rt === l.BottomTurnBack
                                  ? l.Right
                                  : rt === l.BottomTurnLeft
                                    ? l.Front
                                    : rt === l.FrontTurnRight
                                      ? l.Bottom
                                      : rt === l.FrontTurnLeft
                                        ? l.Top
                                        : rt === l.FrontTurnTop
                                          ? l.Right
                                          : rt === l.RightTurnFront
                                            ? l.Top
                                            : rt === l.RightTurnBack
                                              ? l.Bottom
                                              : rt === l.RightTurnTop
                                                ? l.Back
                                                : rt === l.BackTurnRight
                                                  ? l.Top
                                                  : rt === l.BackTurnLeft
                                                    ? l.Bottom
                                                    : rt === l.BackTurnTop
                                                      ? l.Right
                                                      : rt === l.LeftTurnFront
                                                        ? l.Bottom
                                                        : rt === l.LeftTurnBack
                                                          ? l.Top
                                                          : rt === l.LeftTurnTop
                                                            ? l.Front
                                                            : l.Left;
          break;
        case c.ControlRingNorthEast:
        case c.ControlRingSouthWest:
        case c.ControlRingNorthWest:
        case c.ControlRingSouthEast:
          e = i
            ? rt === l.Front
              ? l.FrontTurnRight
              : rt === l.FrontTurnRight
                ? l.FrontTurnTop
                : rt === l.FrontTurnTop
                  ? l.FrontTurnLeft
                  : rt === l.FrontTurnLeft
                    ? l.Front
                    : rt === l.Right
                      ? l.RightTurnBack
                      : rt === l.RightTurnBack
                        ? l.RightTurnTop
                        : rt === l.RightTurnTop
                          ? l.RightTurnFront
                          : rt === l.RightTurnFront
                            ? l.Right
                            : rt === l.Back
                              ? l.BackTurnRight
                              : rt === l.BackTurnRight
                                ? l.BackTurnTop
                                : rt === l.BackTurnTop
                                  ? l.BackTurnLeft
                                  : rt === l.BackTurnLeft
                                    ? l.Back
                                    : rt === l.Left
                                      ? l.LeftTurnFront
                                      : rt === l.LeftTurnFront
                                        ? l.LeftTurnTop
                                        : rt === l.LeftTurnTop
                                          ? l.LeftTurnBack
                                          : rt === l.LeftTurnBack
                                            ? l.Left
                                            : rt === l.Top
                                              ? l.TopTurnRight
                                              : rt === l.TopTurnRight
                                                ? l.TopTurnBack
                                                : rt === l.TopTurnBack
                                                  ? l.TopTurnLeft
                                                  : rt === l.TopTurnLeft
                                                    ? l.Top
                                                    : rt === l.Bottom
                                                      ? l.BottomTurnRight
                                                      : rt === l.BottomTurnRight
                                                        ? l.BottomTurnBack
                                                        : rt === l.BottomTurnBack
                                                          ? l.BottomTurnLeft
                                                          : rt === l.BottomTurnLeft
                                                            ? l.Bottom
                                                            : l.FrontTurnRight
            : rt === l.Front
              ? l.FrontTurnLeft
              : rt === l.FrontTurnLeft
                ? l.FrontTurnTop
                : rt === l.FrontTurnTop
                  ? l.FrontTurnRight
                  : rt === l.FrontTurnRight
                    ? l.Front
                    : rt === l.Right
                      ? l.RightTurnFront
                      : rt === l.RightTurnFront
                        ? l.RightTurnTop
                        : rt === l.RightTurnTop
                          ? l.RightTurnBack
                          : rt === l.RightTurnBack
                            ? l.Right
                            : rt === l.Back
                              ? l.BackTurnLeft
                              : rt === l.BackTurnLeft
                                ? l.BackTurnTop
                                : rt === l.BackTurnTop
                                  ? l.BackTurnRight
                                  : rt === l.BackTurnRight
                                    ? l.Back
                                    : rt === l.Left
                                      ? l.LeftTurnBack
                                      : rt === l.LeftTurnBack
                                        ? l.LeftTurnTop
                                        : rt === l.LeftTurnTop
                                          ? l.LeftTurnFront
                                          : rt === l.LeftTurnFront
                                            ? l.Left
                                            : rt === l.Top
                                              ? l.TopTurnLeft
                                              : rt === l.TopTurnLeft
                                                ? l.TopTurnBack
                                                : rt === l.TopTurnBack
                                                  ? l.TopTurnRight
                                                  : rt === l.TopTurnRight
                                                    ? l.Top
                                                    : rt === l.Bottom
                                                      ? l.BottomTurnLeft
                                                      : rt === l.BottomTurnLeft
                                                        ? l.BottomTurnBack
                                                        : rt === l.BottomTurnBack
                                                          ? l.BottomTurnRight
                                                          : rt === l.BottomTurnRight
                                                            ? l.Bottom
                                                            : l.FrontTurnLeft
      }
      rt = e
    },
    xt = function(t, e) {
      if (e) {
        var n = !1;
        switch (
          $.x * $.y > 0 && (n = !0), t === c.MiddleDoor
          ? L.material.color.setHex(i.pickedColor)
          : t !== c.MiddleSouth && L.material.color.setHex(M),
        t === c.MiddleSouth
          ? T.material.color.setHex(i.pickedColor)
          : t !== c.MiddleDoor && T.material.color.setHex(_),
        t === c.MiddleWest
          ? S.material.color.setHex(i.pickedColor)
          : t !== c.MiddleLeftWindow && S.material.color.setHex(O),
        t === c.MiddleLeftWindow
          ? U.material.color.setHex(i.pickedColor)
          : t !== c.MiddleWest && U.material.color.setHex(A),
        t === c.MiddleEast
          ? D.material.color.setHex(i.pickedColor)
          : t !== c.MiddleRightWindow && D.material.color.setHex(R),
        t === c.MiddleRightWindow
          ? I.material.color.setHex(i.pickedColor)
          : t !== c.MiddleEast && I.material.color.setHex(P),
        t) {
          case c.ControlRingNorthEast:
            N.visible = !0,
            N.quaternion.copy(k),
            N.position.copy(H),
            F.visible = !0,
            F.quaternion.copy(G),
            F.position.copy(V),
            F.rotateZ(Math.PI / 4),
            F.translateX(B),
            z.visible = !0,
            z.quaternion.copy(q),
            z.position.copy(W),
            z.rotateZ(Math.PI / 4),
            z.translateX(B),
            n
              ? z.rotateZ(Math.PI / 2)
              : z.rotateZ(-Math.PI / 2);
            break;
          case c.ControlRingNorthWest:
            N.visible = !0,
            N.quaternion.copy(k),
            N.position.copy(H),
            N.rotateZ(Math.PI / 2),
            F.visible = !0,
            F.quaternion.copy(G),
            F.position.copy(V),
            F.rotateZ(3 * Math.PI / 4),
            F.translateX(B),
            z.visible = !0,
            z.quaternion.copy(q),
            z.position.copy(W),
            z.rotateZ(3 * Math.PI / 4),
            z.translateX(B),
            n
              ? z.rotateZ(Math.PI / 2)
              : z.rotateZ(-Math.PI / 2);
            break;
          case c.ControlRingSouthWest:
            N.visible = !0,
            N.quaternion.copy(k),
            N.position.copy(H),
            N.rotateZ(Math.PI),
            F.visible = !0,
            F.quaternion.copy(G),
            F.position.copy(V),
            F.rotateZ(3 * -Math.PI / 4),
            F.translateX(B),
            z.visible = !0,
            z.quaternion.copy(q),
            z.position.copy(W),
            z.rotateZ(3 * -Math.PI / 4),
            z.translateX(B),
            n
              ? z.rotateZ(Math.PI / 2)
              : z.rotateZ(-Math.PI / 2);
            break;
          case c.ControlRingSouthEast:
            N.visible = !0,
            N.quaternion.copy(k),
            N.position.copy(H),
            N.rotateZ(-Math.PI / 2),
            F.visible = !0,
            F.quaternion.copy(G),
            F.position.copy(V),
            F.rotateZ(-Math.PI / 4),
            F.translateX(B),
            z.visible = !0,
            z.quaternion.copy(q),
            z.position.copy(W),
            z.rotateZ(-Math.PI / 4),
            z.translateX(B),
            n
              ? z.rotateZ(Math.PI / 2)
              : z.rotateZ(-Math.PI / 2);
            break;
          case c.ControlPointNorth:
            N.visible = !1,
            F.visible = !1,
            z.visible = !0,
            z.quaternion.copy(q),
            z.position.copy(W),
            z.rotateZ(Math.PI / 2),
            z.translateX(B);
            break;
          case c.ControlPointSouth:
            N.visible = !1,
            F.visible = !1,
            z.visible = !0,
            z.quaternion.copy(q),
            z.position.copy(W),
            z.rotateZ(-Math.PI / 2),
            z.translateX(B);
            break;
          case c.ControlPointEast:
            N.visible = !1,
            F.visible = !1,
            z.visible = !0,
            z.quaternion.copy(q),
            z.position.copy(W),
            z.translateX(B);
            break;
          case c.ControlPointWest:
            N.visible = !1,
            F.visible = !1,
            z.visible = !0,
            z.quaternion.copy(q),
            z.position.copy(W),
            z.rotateZ(Math.PI),
            z.translateX(B);
            break;
          default:
            N.visible = !1,
            F.visible = !1,
            z.visible = !1
        }
      } else
        N.visible && (N.visible = !1),
        F.visible && (F.visible = !1),
        z.visible && (z.visible = !1)
    },
    bt = function(t) {
      it != t && (it && it.material.color.setHex(it.currentHex), it = t, it.currentHex = it.material.color.getHex(), "" !== it.name && it.material.color.setHex(i.pickedColor), xt(it.name, !0))
    },
    wt = function() {
      it && it.material.color.setHex(it.currentHex),
      xt("", !1),
      it = null
    },
    Ct = function() {
      m.setFromCamera($, f);
      var t = m.intersectObjects(x.children, !0);
      if (t.length > 0)
        bt(t[0].object);
      else {
        d.setFromCamera($, u);
        var e = d.intersectObjects(h.children, !0);
        e.length > 0
          ? bt(e[0].object)
          : wt()
      }
    },
    Tt = function(t, e, i) {
      return t > e
        ? t - e <= i
        : e - t <= i
    },
    _t = function(t) {
      var e = t.clone();
      return e.normalize(),
      !Tt(e.y, 0, 1e-4)
    },
    Lt = function(t) {
      var e = t.clone();
      return e.normalize(),
      !!(Tt(e.x, 0, 1e-4) && Tt(e.y, 0, 1e-4) || Tt(e.x, 0, 1e-4) && Tt(e.z, 0, 1e-4) || Tt(e.y, 0, 1e-4) && Tt(e.z, 0, 1e-4))
    },
    Mt = function(t) {
      var e = t.clone();
      return e.normalize(),
      !!(Tt(e.x, 0, 1e-4) && Tt(e.y, 1, 1e-4) && Tt(e.z, 0, 1e-4))
    },
    St = function(t, e) {
      var i = t.clone();
      i.normalize();
      var n = e.clone();
      if (n.normalize(), Tt(i.x, 0, 1e-4) && Tt(i.y, -1, 1e-4) && Tt(i.z, 0, 1e-4)) {
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, -1, 1e-4))
          return l.Top;
        if (Tt(n.x, -1, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.TopTurnRight;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 1, 1e-4))
          return l.TopTurnBack;
        if (Tt(n.x, 1, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.TopTurnLeft
      }
      if (Tt(i.x, 0, 1e-4) && Tt(i.y, 1, 1e-4) && Tt(i.z, 0, 1e-4)) {
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 1, 1e-4))
          return l.Bottom;
        if (Tt(n.x, -1, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.BottomTurnRight;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, -1, 1e-4))
          return l.BottomTurnBack;
        if (Tt(n.x, 1, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.Bottom
      }
      if (Tt(i.x, 0, 1e-4) && Tt(i.y, 0, 1e-4) && Tt(i.z, -1, 1e-4)) {
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 1, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.Front;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, -1, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.FrontTurnTop;
        if (Tt(n.x, 1, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.FrontTurnLeft;
        if (Tt(n.x, -1, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.FrontTurnRight
      }
      if (Tt(i.x, 0, 1e-4) && Tt(i.y, 0, 1e-4) && Tt(i.z, 1, 1e-4)) {
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 1, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.Back;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, -1, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.BackTurnTop;
        if (Tt(n.x, -1, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.BackTurnLeft;
        if (Tt(n.x, 1, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.BackTurnRight
      }
      if (Tt(i.x, -1, 1e-4) && Tt(i.y, 0, 1e-4) && Tt(i.z, 0, 1e-4)) {
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 1, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.Right;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, -1, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.RightTurnTop;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, -1, 1e-4))
          return l.RightTurnFront;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 1, 1e-4))
          return l.RightTurnBack
      }
      if (Tt(i.x, 1, 1e-4) && Tt(i.y, 0, 1e-4) && Tt(i.z, 0, 1e-4)) {
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 1, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.Left;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, -1, 1e-4) && Tt(n.z, 0, 1e-4))
          return l.LeftTurnTop;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, -1, 1e-4))
          return l.LeftTurnFront;
        if (Tt(n.x, 0, 1e-4) && Tt(n.y, 0, 1e-4) && Tt(n.z, 1, 1e-4))
          return l.LeftTurnBack
      }
      return -1
    },
    Ot = function(t) {
      t.style.position = "absolute",
      t.style.display = "block",
      t.style.outline = "0",
      t.style.right = "20px",
      t.style.top = "20px",
      t.style.opacity = ".6",
      t.style.webkitTransition = "opacity .2s ease",
      t.style.mozTransition = "opacity .2s ease",
      t.style.msTransform = "opacity .2s ease",
      t.style.oTransform = "opacity .2s ease",
      t.style.transition = "opacity .2s ease"
    };
  this.init = function(t) {
    n = document.createElement("div"),
    Ot(n),
    t.appendChild(n),
    o = new THREE.WebGLRenderer({
      antialias: !0,
      alpha: !0,
      preserveDrawingBuffer: !0
    }),
    n.appendChild(o.domElement),
    this.resize(t.offsetWidth, t.offsetHeight, this.viewer.isMobile),
    this.addDomEventListeners()
  },
  this.uninit = function() {
    this.removeDomEventListeners(),
    n && (n.removeChild(o.domElement), n = null)
  },
  this.enable = function() {
    n && o && !o.domElement.parentNode && (n.appendChild(o.domElement), this.addDomEventListeners())
  },
  this.disable = function() {
    n && o && o.domElement.parentNode && (this.removeDomEventListeners(), n.removeChild(o.domElement))
  },
  this.enableCompass = function(t) {
    j = t
  },
  this.addDomEventListeners = function() {
    n && (n.addEventListener("contextmenu", function(t) {
      t.preventDefault()
    }, !1), n.addEventListener("mousedown", this.onMouseDownBinded, !1), window.addEventListener("mousemove", this.onMouseMoveBinded, !1), window.addEventListener("mouseup", this.onMouseUpBinded, !1))
  },
  this.removeDomEventListeners = function() {
    n && (n.removeEventListener("contextmenu", function(t) {
      t.preventDefault()
    }, !1), n.removeEventListener("mousedown", this.onMouseDownBinded, !1), window.removeEventListener("mousemove", this.onMouseMoveBinded, !1), window.removeEventListener("mouseup", this.onMouseUpBinded, !1))
  },
  this.mouseUp = function(t) {
    t.stopPropagation();
    var e = new THREE.Vector2(t.clientX, t.clientY),
      n = gt(e);
    return Y
      ? (Y = !1, Q.set(e.x, e.y), J.subVectors(Q, K), this.preRotationHandle && !this.preRotationHandle() || (this.viewer.rotateCamera(J), K.copy(Q)))
      : n && t.button === i.mouseButtons.LEFT && it && (rt = -1, this.preRotationHandle && !this.preRotationHandle() || Et(it.name), rt !== -1 && void 0 !== rt && null !== rt && this.viewer.setStandardView(rt, null, function() {
        i.render()
      })),
    n
  },
  this.mouseMove = function(t) {
    t.stopPropagation();
    var e = !1,
      i = new THREE.Vector2(t.clientX, t.clientY),
      n = gt(i);
    if (Y)
      Q.set(i.x, i.y),
      J.subVectors(Q, K),
      this.preRotationHandle && !this.preRotationHandle() || (this.viewer.rotateCamera(J), K.copy(Q));
    else if (n) {
      if (Z && (yt(!1), e = !0), X === !1 && (vt(!0), e = !0), Ct(), it) {
        if ("" !== it.name) {
          var o = it.name;
          o === c.MiddleDoor
            ? o = c.MiddleSouth
            : o === c.MiddleLeftWindow
              ? o = c.MiddleWest
              : o === c.MiddleRightWindow && (o = c.MiddleEast),
          et !== o && (et = o, tt = !0, e = !0)
        }
      } else
        "" !== et && (et = "", tt = !1, e = !0);
      e && this.render(),
      at = !0
    } else
      at && (at = !1, tt && (wt(), tt = !1, e = !0), Z === !1 && (yt(!0), e = !0), X && (vt(!1), e = !0), e && this.render());
    return n
  },
  this.mouseDown = function(t) {
    t.preventDefault(),
    t.stopPropagation();
    var e = new THREE.Vector2(t.clientX, t.clientY),
      n = gt(e);
    if (n && t.button === i.mouseButtons.LEFT && (Y = !1, it)) {
      it.name === c.Compass && (Y = !0, K.set(e.x, e.y))
    }
    return n
  },
  this.render = function() {
    if (this.visible && !this.isDisable && o) {
      var t = this.viewer.getActiveCameraInfo();
      u.up.copy(t.up),
      u.lookAt(t.dir),
      u.updateMatrixWorld();
      var e = t.dir;
      rt === -1 && (rt = St(e, u.up)),
      Lt(e)
        ? v.visible = !0
        : v.visible = !1,
      this.isAnimationFinish || (v.visible = !1),
      v.visible === !1 && (N.visible = !1, F.visible = !1, z.visible = !1),
      v.position.copy(w),
      b.position.copy(C),
      v.visible && Mt(e) && (v.translateZ(nt + 1), b.translateZ(nt + 1)),
      j && _t(e)
        ? g.visible = !0
        : g.visible = !1,
      o.autoClear = !0,
      o.render(h, u),
      o.autoClear = !1,
      o.render(p, f),
      o.autoClear = !0
    }
  },
  this.resize = function(t, e, i) {
    mt(
      t < 400 || i
      ? a.Small
      : a.Medium),
    o.setSize(this.width, this.height)
  },
  this.onMouseDownBinded = this.mouseDown.bind(this),
  this.onMouseMoveBinded = this.mouseMove.bind(this),
  this.onMouseUpBinded = this.mouseUp.bind(this),
  function() {
    ut(),
    ht(),
    dt(),
    pt(),
    ft(),
    g.translateZ(-nt),
    h.add(g),
    h.add(y);
    var t = new THREE.Euler(-Math.PI / 2, 0, 0, THREE.Euler.DefaultOrder);
    h.rotation.copy(t),
    x.add(E),
    x.add(v),
    v.translateZ(30),
    p.add(x),
    p.add(b)
  }(),
  yt(!0),
  vt(!1)
},
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Authentication"),
    e = function() {
      return {APIHost: "https://api.bimface.com", viewToken: null}
    };
  t.AuthenticationConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Authentication"),
    e = (Glodon.Web, Glodon.Web.Lang.Utility.HttpRequest),
    i = function(t) {
      this.config = t
    };
  i.prototype.authenticate = function(t, i) {
    var n = this,
      o = n.config;
    e.ajax({
      url: o.APIHost + "/inside/databag?viewToken=" + o.viewToken,
      success: function(e) {
        var r = JSON.parse(e);
        "success" == r.code
          ? (r.data.viewToken = o.viewToken, n.data = r.data, t && t(r.data))
          : i && i(r)
      },
      failure: function(t) {
        var e = JSON.parse(t);
        i && i(e)
      }
    })
  },
  t.AuthenticationManager = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Data"),
    e = Glodon.Web.Lang.Utility.HttpRequest,
    i = function(t) {
      if (this._config = t, !t.viewToken)
        return !1
    };
  i.prototype = {
    getComponentProperty: function(t, i, n) {
      if (!t)
        return console.warn("elementId must not be empty!."),
        void(n && n());
      var o = this,
        r = o._config,
        a = void 0;
      if ("Local" != r.dataEnvType) {
        if ("singleModel" == r.modelType)
          a = r.APIHost + "/data/v2/files/" + r.modelId + "/elements/" + t + "?view_token=" + r.viewToken;
        else {
          var s = t.split(".");
          a = r.APIHost + "/data/v2/integrations/" + r.modelId + "/files/" + s[0] + "/elements/" + s[1] + "?view_token=" + r.viewToken
        }
        e.ajax({
          url: a,
          success: function(e) {
            var a = JSON.parse(e);
            "Local" == r.dataEnvType
              ? (o._objectData = a, i && i({properties: a[t]}))
              : "success" == a.code
                ? i && i(a.data)
                : n && n(a)
          },
          failure: function(t) {
            var e = JSON.parse(t);
            n && n(e)
          }
        })
      } else if (o._objectData)
        i({properties: o._objectData.getElementProperties(t)});
      else {
        var l = new Glodon.Bimface.Data.ObjectPropertyManager("./" + r.databagId + "/property");
        l.load(function() {
          i({properties: l.getElementProperties(t)})
        }),
        o._objectData = l
      }
    },
    getModelTree: function(t, i) {
      var n = this,
        o = n._config,
        r = void 0;
      r = "Local" == o.dataEnvType
        ? "singleModel" == o.modelType
          ? "./" + o.databagId + "/metadata/tree.json"
          : "./" + o.databagId + "/metadata/specialtyTree.json"
        : "singleModel" == o.modelType
          ? o.APIHost + "/data/v2/files/" + o.modelId + "/tree?v=2.0&view_token=" + o.viewToken
          : o.APIHost + "/data/v2/integrations/" + o.modelId + "/tree?view_token=" + o.viewToken + "&treeType=specialty",
      e.ajax({
        url: r,
        success: function(e) {
          var n = JSON.parse(e);
          if (n.code) {
            if ("success" != n.code)
              return i && i(n),
              !1;
            n = n.data
          }
          t && t(n, o.modelType)
        },
        failure: function(t) {
          var e = JSON.parse(t);
          i && i(e)
        }
      })
    },
    getModeTree: function(t, e) {
      console.warn("This function is deprecated. Please use getModelTree instead."),
      this.getModelTree(t, e)
    }
  },
  t.MetaDataManager = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Data"),
    e = function() {
      return {APIHost: "https://api.bimface.com", viewToken: null, modelId: null, modelType: "singleModel", dataEnvType: "BIMFACE"}
    };
  t.MetaDataManagerConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Data"),
    e = Glodon.Web.Lang.Utility.HttpRequest,
    i = function(t) {
      if (!t.databagId)
        return !1;
      this.__config = t
    };
  i.prototype.getFamilyTypes = function(t, i) {
    var n = this.__config,
      o = void 0;
    o = "Local" == n.dataEnvType
      ? "./" + n.databagId + "/metadata/floorTree.json"
      : n.resourceHost + "/" + n.databagId + "/metadata/familyInfo.json",
    e.ajax({
      url: o,
      success: function(e) {
        for (var e = JSON.parse(e), i = e.Types || e.types, n = 0, o = i.length; n < o; n++)
          i[n].id = i[n].Id || i[n].id,
          i[n].name = i[n].Name || i[n].name,
          delete i[n].Id,
          delete i[n].Name;
        t && t(i)
      },
      failure: function(t) {
        var e = JSON.parse(t);
        i && i(e)
      }
    })
  },
  t.FamilyDataManager = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Data"),
    e = function() {
      return {resourceHost: "https://m.bimface.com", databagId: null}
    };
  t.FamilyDataManagerConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Data"),
    e = (Glodon.Web.Lang.Utility.HttpRequest, e || {});
  e.version = 1,
  e.EnumObjectTableIndex = {
    OTI_OBJECTS_VALUES: 0,
    OTI_PROPERTY_SCHEMAS: 1,
    OTI_ELEMENT_PROPERTIES: 2,
    OTI_ELEMENTS: 3
  };
  var i = function(t) {
    this.url = t,
    this.objectsDB = []
  };
  i.prototype = {
    load: function(t) {
      for (var e = this, i = [
        "Values.json", "Schemas.json", "ElementProperties.json", "Elements.json"
      ], n = i.length, o = 0, r = i.length; o < r; ++o)
        !function(o) {
          (new THREE.FileLoader).load(e.url + "/" + i[o], function(i) {
            e.objectsDB[o] = JSON.parse(i),
            0 == (n -= 1) && t()
          })
        }
      (o)
    },
    getElementProperties: function(t) {
      if (null == t)
        return null;
      var i = this.objectsDB[e.EnumObjectTableIndex.OTI_ELEMENTS],
        n = i[t];
      if (void 0 === n)
        return null;
      for (var o = this.objectsDB[e.EnumObjectTableIndex.OTI_OBJECTS_VALUES], r = this.objectsDB[e.EnumObjectTableIndex.OTI_ELEMENT_PROPERTIES], a = this.objectsDB[e.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS], s = 0, l = 0, c = 0, h = {}, u = [], d = 0, p = 0, f = n[2], m = n[1]; p < f; ++p) {
        s = 2 * (m + p),
        l = 4 * r[s],
        c = r[s + 1],
        d = a[l];
        var g = h[d];
        void 0 === g && (g = [], h[d] = g, u.push(d)),
        g.push({
          key: o[a[l + 1]],
          unit: o[a[l + 3]],
          valueType: a[l + 2],
          value: o[c]
        })
      }
      for (var v = [], p = 0, y = u.length; p < y; ++p)
        d = u[p],
        v.push({group: o[d], items: h[d]});
      return v
    }
  },
  t.ObjectPropertyManager = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Control"),
    e = function() {
      return {id: null, tagName: "div", className: "bf-control", title: "", element: ""}
    };
  t.ControlConfig = e
}(),
function() {
  var t = Object.freeze({
    Click: "Click",
    MouseEnter: "MouseEnter",
    MouseLeave: "MouseLeave",
    MouseMove: "MouseMove",
    StateChange: "StateChange",
    Change: "Change"
  });
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Control").ControlEvent = t
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Control"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = function(t) {
      var i = this;
      i.eventManager = new Glodon.Web.Lang.EventManager,
      i.element = e.create(t.tagName, t.className),
      i.id = t.id || Glodon.Web.Lang.Utility.UUID.createUUID(),
      t.title && i.setTitle(t.title),
      t.element && t.element.appendChild(i.element)
    };
  i.prototype = {
    addEventListener: function(t, e) {
      var i = this,
        n = i.eventManager;
      i.element.addEventListener(t.toLocaleLowerCase(), e),
      n.addEvent(t, e)
    },
    removeEventListener: function(t, e) {
      var i = this;
      i.eventManager.removeEvent(t, e),
      i.element.removeEventListener(t.toLocaleLowerCase(), e)
    },
    show: function() {
      this.element.style.display = ""
    },
    hide: function() {
      this.element.style.display = "none"
    },
    setTitle: function(t) {
      this.element.setAttribute("title", t)
    },
    getTitle: function() {
      return this.element.getAttribute("title")
    },
    setClassNames: function(t) {
      this.element.setAttribute("class", t)
    },
    getClassNames: function() {
      return this.element.getClass()
    },
    addClassName: function(t) {
      this.element.addClass(t)
    },
    removeClassName: function(t) {
      this.element.removeClass(t)
    },
    toggleClassName: function(t, e) {
      this.element.toggleClass(t, e)
    },
    setDomId: function(t) {
      this.element.setAttribute("id", t)
    },
    getDomId: function() {
      return this.element.getAttribute("id")
    },
    getId: function() {
      return this.id
    },
    setHtml: function(t) {
      this.element.innerHTML = t
    },
    setStyle: function(t) {
      this.element.setCss(t)
    },
    destroy: function() {
      this.element.parentElement && this.element.parentElement.removeChild(this.element)
    }
  },
  t.Control = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Toolbar"),
    e = new Glodon.Bimface.UI.Control.ControlConfig,
    i = function() {
      var t = {
        className: "bf-toolbar"
      };
      return Object.assign({}, e, t)
    };
  t.ToolbarConfig = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Control"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Toolbar"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    n = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), function(e) {
      this._controls = [],
      t.Control.call(this, e)
    });
  i.Type.inheritPrototype(n, t.Control),
  n.prototype.addControl = function(t) {
    this.getControls().push(t),
    this.element.appendChild(t.element)
  },
  n.prototype.addControls = function(t) {
    for (var e = this, i = 0, n = t.length; i < n; i++)
      e.addControl(t[i]);
    return this.getControls()
  },
  n.prototype.insertControl = function(t, e) {
    var i = this.getControls();
    i.insert(t, e);
    var n = i[t + 1];
    n
      ? this.element.insertBefore(e.element, n.element)
      : this.element.appendChild(e.element)
  },
  n.prototype.removeControl = function(t) {
    var e = this.getControls(),
      i = e.getObjectByAttribute("id", t);
    e.removeObjectByAttribute("id", t),
    this.element.removeChild(i.element)
  },
  n.prototype.getControls = function() {
    return this._controls
  },
  n.prototype.getControl = function(t) {
    return this.getControls().getObjectByAttribute("id", t)
  },
  e.Toolbar = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Button"),
    e = (Glodon.Bimface.UI.Button.ButtonOption, new Glodon.Bimface.UI.Control.ControlConfig),
    i = function() {
      var t = {
        className: "bf-button",
        title: "button",
        checkedState: !1,
        defaultClass: "",
        changeClass: "",
        inheritTitle: !1
      };
      return Object.assign({}, e, t)
    };
  t.ButtonConfig = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Control"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Button"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    n = function(e) {
      t.Control.call(this, e)
    };
  i.Type.inheritPrototype(n, t.Control),
  e.Button = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Button"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    i = Glodon.Bimface.UI.Control.ControlEvent,
    n = function(e) {
      t.Button.call(this, e);
      var n = this;
      n._checked = e.checkedState,
      n._checked && this.addClassName("bf-checked"),
      n.addEventListener(i.Click, function() {
        n.toggleCheckedState()
      })
    };
  e.Type.inheritPrototype(n, t.Button),
  n.prototype.toggleCheckedState = function() {
    this.setCheckedState(!this._checked)
  },
  n.prototype.setCheckedState = function(t) {
    this._checked != t && (this._checked = t, this.toggleClassName("bf-checked", t), this.eventManager.fireEvent(i.StateChange, t))
  },
  n.prototype.isChecked = function() {
    return this._checked
  },
  t.ToggleButton = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Control"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Button"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Toolbar"),
    n = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    o = new i.ToolbarConfig,
    r = new t.ControlConfig,
    a = function(e) {
      t.Control.call(this, e);
      var n = this;
      n._inheritTitle = e.inheritTitle,
      n.setClassNames("bf-combobox");
      var a = new t.Control(r);
      a.setClassNames("bf-current"),
      o.element = n.element,
      o.className = "bf-sub-toolbar";
      var s = new i.Toolbar(o);
      n.currentElement = a,
      n._subToolbar = s,
      n.element.appendChild(n.currentElement.element),
      n.addEventListener("Click", function() {
        n.toggleDropDownList()
      })
    };
  n.Type.inheritPrototype(a, t.Control),
  a.prototype.toggleDropDownList = function() {
    this.checked = !this.checked,
    this.toggleClassName("bf-expand")
  },
  a.prototype.showDropDownList = function() {
    this._checked = !0,
    this.addClassName("bf-expand")
  },
  a.prototype.hideDropDownList = function(t) {
    this._checked = !1,
    this.removeClassName("bf-expand")
  },
  a.prototype.addControl = function(t) {
    var e = this,
      i = e.getControls();
    e._subToolbar.addControl(t),
    1 == i.length && e.setSelectedControlById(t.id),
    t.addEventListener("Click", function() {
      for (var n = 0, o = i.length; n < o; n++)
        i[n].setCheckedState(!1);
      e.currentElement.setHtml(this.outerHTML.replace("checked", "")),
      t.setCheckedState(!0),
      e._currentControl = t,
      e.eventManager.fireEvent("Change", t)
    })
  },
  a.prototype.removeControl = function(t) {
    this._subToolbar.removeControl(t)
  },
  a.prototype.getControls = function() {
    return this._subToolbar.getControls()
  },
  a.prototype.getControl = function(t) {
    return this._subToolbar.getControl(t)
  },
  a.prototype.getCurrentControl = function() {
    return this._currentControl
  },
  a.prototype.setSelectedControlById = function(t) {
    var e = this.getControl(t);
    e.setCheckedState(!1);
    var i = e.element.cloneNode(!0);
    this._inheritTitle || i.removeAttribute("title"),
    this.currentElement.setHtml(i.outerHTML),
    e.setCheckedState(!0),
    this._currentControl = e
  },
  e.ComboBox = a
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Button"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    i = function(e) {
      t.ToggleButton.call(this, e)
    };
  e.Type.inheritPrototype(i, t.ToggleButton),
  t.ComboBoxOptionButton = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Button"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    i = function(e) {
      t.Button.call(this, e);
      var i = this;
      i._defaultClass = e.defaultClass,
      i._changeClass = e.changeClass,
      i._title = e.title,
      i._changeTitle = e.changeTitle,
      i._checked && this.addClassName("bf-checked"),
      i.addEventListener("Click", function() {
        i.toggleCheckedState()
      })
    };
  e.Type.inheritPrototype(i, t.Button),
  i.prototype.toggleCheckedState = function() {
    this.toggleClassName(this._defaultClass),
    this.toggleClassName(this._changeClass),
    this.setTitle(this._changeTitle);
    var t = this._title;
    this._title = this._changeTitle,
    this._changeTitle = t
  },
  t.ChangeButton = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Button"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    i = {},
    n = function(e) {
      t.Button.call(this, e);
      var n = this;
      n._checked = e.checkedState,
      n.addEventListener("Click", function() {
        n.setChecked()
      }),
      i[e.groupName]
        ? (i[e.groupName].push(n), this._groupList = i[e.groupName])
        : (i[e.groupName] = [n], this._groupList = i[e.groupName], n.setChecked())
    };
  e.Type.inheritPrototype(n, t.Button),
  n.prototype.setChecked = function() {
    for (var t = this._groupList, e = 0, i = t.length; e < i; e++)
      t[e].removeClassName("bf-checked");
    this.addClassName("bf-checked")
  },
  t.SingleButton = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Menu"),
    e = new Glodon.Bimface.UI.Control.ControlConfig,
    i = function() {
      var t = {
        className: "bf-menu",
        isSubMenu: !1,
        text: null
      };
      return Object.assign({}, e, t)
    };
  t.MenuConfig = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Menu"),
    e = new Glodon.Bimface.UI.Control.ControlConfig,
    i = function() {
      var t = {
        className: "bf-menu-item"
      };
      return Object.assign({}, e, t)
    };
  t.MenuItemConfig = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Button"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Menu"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    n = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), function(e) {
      this._controls = [],
      t.Button.call(this, e),
      this.isDisabled = !1
    });
  i.Type.inheritPrototype(n, t.Button),
  n.prototype.setText = function(t) {
    this.element.innerText = t
  },
  n.prototype.disabled = function(t) {
    this.element.addClass("bf-disabled"),
    this.isDisabled = !0
  },
  n.prototype.enabled = function(t) {
    this.element.removeClass("bf-disabled"),
    this.isDisabled = !1
  },
  n.prototype.addEventListener = function(t, e) {
    var i = this,
      n = i.eventManager;
    this.isDisabled || (i.element.addEventListener(t.toLocaleLowerCase(), e), n.addEvent(t, e))
  },
  e.MenuItem = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Menu"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = function() {
      this.element = e.create("div", "bf-spacer")
    };
  t.Spacer = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Toolbar"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Menu"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    n = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    o = function(e) {
      if (t.Toolbar.call(this, e), this.element.addEventListener("mousedown", function(t) {
        t.stopPropagation()
      }), this.element.addEventListener("contextmenu", function(t) {
        t.preventDefault()
      }), this.isDisabled = !1, e.isSubMenu) {
        var i = n.create("div", "bf-menu-item");
        i.innerText = e.text;
        var o = n.create("div", "bf-menu");
        this.element.appendChild(i),
        this.element.appendChild(o),
        this.subElement = o
      }
    };
  i.Type.inheritPrototype(o, t.Toolbar),
  o.prototype.setPosition = function(t) {
    this.element.style.left = t.x + "px",
    this.element.style.top = t.y + "px"
  },
  o.prototype.addControl = function(t) {
    this.getControls().push(t),
    this.subElement
      ? this.subElement.appendChild(t.element)
      : this.element.appendChild(t.element)
  },
  o.prototype.disabled = function(t) {
    this.element.addClass("bf-disabled"),
    this.isDisabled = !0
  },
  o.prototype.enabled = function(t) {
    this.element.removeClass("bf-disabled"),
    this.isDisabled = !1
  },
  o.prototype.destroy = function(t) {
    this.element.remove(),
    this.element = null
  },
  e.Menu = o
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Control"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Panel"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    n = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    o = function(e) {
      t.Control.call(this, e),
      this._controls = [];
      var n = this,
        o = n.element;
      n.isShow = !0;
      var r = i.create("div", "bf-cantainer"),
        a = i.create("div", "bf-close"),
        s = e.css;
      for (var l in s)
        o.style[l] = "" + s[l];
      if (e.easyMode || o.appendChild(a), e.title) {
        var c = i.create("div", "bf-title");
        c.textContent = e.title,
        o.appendChild(c),
        o.addClass("bf-has-title"),
        e.enableDrag && Glodon.Web.Lang.Utility.Dom.drag({
          element: this.element,
          handle: c,
          move: function(t, e, i) {
            n.eventManager.fireEvent("Move", t, e, i)
          }
        })
      }
      o.appendChild(r),
      this.cantainer = r,
      e.enableSizable && Glodon.Web.Lang.Utility.Dom.sizable({
        element: this.element,
        axis: "all",
        sizable: function(t, e, i) {
          n.eventManager.fireEvent("Sizable", t, e, i)
        }
      }),
      a.addEventListener("click", function() {
        n.hide()
      }),
      r.addEventListener("click", function(t) {
        var e = t.target.closest(".bf-group-title");
        if (e && e.hasClass("bf-group-title")) {
          e.parentNode.toggleClass("bf-collapse")
        }
      })
    };
  n.Type.inheritPrototype(o, t.Control),
  o.prototype.setData = function(t) {
    for (var e = this.cantainer, i = '<table class="bf-table">', n = 0, o = t.length; n < o; n++) {
      for (var r = '<tbody class="bf-group"><tr class="bf-group-title"><td colspan="2"><i class="bf-icon"></i>' + t[n].group + "</td></tr>", a = t[n].items, s = 0, l = a.length; s < l; s++) {
        var c = a[s];
        r += '<tr class="bf-group-content"><td class="bf-key">' + c.key + '</td><td class="bf-value">' + c.value + "</td></tr>"
      }
      r += "</tbody>",
      i += r
    }
    i += "</table>",
    e.innerHTML = i
  },
  o.prototype.close = function() {
    this.eventManager.fireEvent("Close"),
    this.destroy()
  },
  o.prototype.hide = function() {
    this.eventManager.fireEvent("Hide"),
    this.isShow = !1,
    this.element.style.display = "none"
  },
  o.prototype.show = function() {
    this.eventManager.fireEvent("Show"),
    this.isShow = !0,
    this.element.style.display = ""
  },
  o.prototype.toggle = function() {
    this.isShow
      ? this.element.style.display = "none"
      : this.element.style.display = "",
    this.isShow = !this.isShow
  },
  o.prototype.addControl = function(t) {
    this.getControls().push(t),
    this.cantainer.appendChild(t.element)
  },
  o.prototype.getControls = function() {
    return this._controls
  },
  o.prototype.getControl = function(t) {
    return this.getControls().getObjectByAttribute("id", t)
  },
  o.prototype.setHtml = function(t) {
    this.cantainer.innerHTML = t
  },
  e.Panel = o
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Panel"),
    e = new Glodon.Bimface.UI.Control.ControlConfig,
    i = function() {
      var t = {
        className: "bf-panel",
        title: "panel",
        css: {
          width: "200px",
          height: "200px",
          minWidth: "200px",
          minHeight: "200px"
        },
        enableDrag: !0,
        enableSizable: !0
      };
      return Object.assign({}, e, t)
    };
  t.PanelConfig = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Tree"),
    e = function(t) {
      var e = this;
      e._root = t,
      e.element = t.element,
      e.eventManager = t.eventManager,
      e.addEventListener = t.addEventListener,
      e.removeEventListener = t.removeEventListener,
      t.addEventListener("SelectionChanged", function(t) {
        e._selectionNode == t
          ? e._selectionNode = null
          : (e._selectionNode && e._selectionNode.deselect(), e._selectionNode = t)
      })
    };
  e.prototype = {
    getRoot: function() {
      return this._root
    },
    getChecked: function() {
      function t(n, o) {
        var r = n.getCheckedState(),
          a = n.element.getAttribute("data-filter");
        switch (r) {
          case "unchecked":
            break;
          case "checked":
            if (n == e)
              i = "all";
            else {
              var s = Object.assign({}, o);
              s[a] = n.id,
              i.push(s)
            }
            break;
          case "half":
            var l = n.getControls(),
              c = Object.assign({}, o);
            n != e && (c[a] = n.id);
            for (var h = 0, u = l.length; h < u; h++)
              t(l[h], c)
          }
      }
      var e = this._root,
        i = [];
      return t(e, {}),
      i
    },
    getSelection: function() {
      function t(e, i) {
        var n = e.element.getAttribute("data-filter"),
          o = e.getParent();
        if (!o)
          return i;
        i[n] = e.id,
        t(o, i)
      }
      var e = this._selectionNode,
        i = {};
      return !!e && (t(e, i), i)
    }
  },
  t.Tree = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Toolbar"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Tree"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    n = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    o = function(e) {
      t.Toolbar.call(this, e),
      this._opt = Object.assign({}, e),
      e.hasCheckbox && (
        this._checkedState = e.isChecked
        ? "checked"
        : "unchecked"),
      this._selection = e.selection,
      this._selectionState = "unSelected"
    };
  i.Type.inheritPrototype(o, t.Toolbar),
  o.prototype.setData = function(t, e) {
    var i = this,
      o = this._opt,
      r = n.create("div", "bf-tree-node bf-collapse");
    if (o.hasCheckbox) {
      var a = o.isChecked
          ? "bf-checked"
          : "",
        s = n.create("span", "bf-label " + a);
      s.innerHTML = '<input type="checkbox" checked="' + o.isChecked + '"><span class="bf-checkbox"></span>',
      this.checkbox = s,
      r.appendChild(s),
      s.addEventListener("click", function(t) {
        var e = s.getElementsByTagName("input")[0].checked,
          n = e
            ? "unchecked"
            : "checked";
        i.setCheckedState(!e),
        i.eventManager.fireEvent("CheckedChanged", n)
      })
    }
    var l = n.create("span", "bf-tree-name");
    l.textContent = e || "",
    l.addEventListener("click", function(t) {
      if (!i._selection)
        return !1;
      var e = this.hasClass("bf-selected");
      e
        ? i.deselect()
        : i.select(),
      e = !e,
      i._selectionState = e
        ? "selected"
        : "unselected",
      i.eventManager.fireEvent("SelectionChanged", i, e)
    }),
    r.appendChild(l),
    this.element.appendChild(r),
    this.treeNode = r,
    this.treeName = l,
    this.id = t
  },
  o.prototype.addChildNode = function(t) {
    var e = this;
    if (this._controls.push(t), t._parent = this, !this.subTree) {
      var i = n.create("span", "bf-icon"),
        o = this.treeNode;
      i.addEventListener("click", function() {
        o.toggleClass("bf-collapse")
      }),
      o.insertBefore(i, this.treeNode.children[0]),
      this.subTree = n.create("div", "bf-sub-tree"),
      this.element.appendChild(this.subTree)
    }
    this.subTree.appendChild(t.element),
    t.addEventListener("CheckedChanged", function(t) {
      e.setParentCheckedState()
    }),
    t.addEventListener("SelectionChanged", function(t, i) {
      e.eventManager.fireEvent("SelectionChanged", t, i)
    })
  },
  o.prototype.getCheckedState = function() {
    return this._checkedState
  },
  o.prototype.getSelectionState = function() {
    return this._selectionState
  },
  o.prototype.getParent = function() {
    return !!this._parent && this._parent
  },
  o.prototype.setCheckedState = function(t) {
    var e = this._opt;
    this._checkedState = t
      ? "checked"
      : "unchecked",
    e.hasCheckbox && (this.checkbox.getElementsByTagName("input")[0].checked = t, this.checkbox.toggleClass("bf-checked", t), this.checkbox.toggleClass("bf-unchecked", !t), this.checkbox.removeClass("bf-half")),
    this.setChildrenCheckedState(t)
  },
  o.prototype.setParentCheckedState = function() {
    var t = this.getControls();
    if (t && t.length > 0) {
      for (var e, i = 0, n = t.length; i < n; i++) {
        var o = t[i].getCheckedState();
        e
          ? o != e && (e = "half")
          : e = o
      }
      this._checkedState = e
    }
    switch (this._checkedState) {
      case "checked":
        this.checkbox.getElementsByTagName("input")[0].checked = !0,
        this.checkbox.addClass("bf-checked"),
        this.checkbox.removeClass("bf-unchecked"),
        this.checkbox.removeClass("bf-half");
        break;
      case "unchecked":
        this.checkbox.getElementsByTagName("input")[0].checked = !1,
        this.checkbox.addClass("bf-unchecked"),
        this.checkbox.removeClass("bf-checked"),
        this.checkbox.removeClass("bf-half");
        break;
      case "half":
        this.checkbox.getElementsByTagName("input")[0].checked = !0,
        this.checkbox.addClass("bf-half"),
        this.checkbox.removeClass("bf-unchecked"),
        this.checkbox.removeClass("bf-checked")
    }
    this.eventManager.fireEvent("CheckedChanged", e)
  },
  o.prototype.setChildrenCheckedState = function(t) {
    var e = this.getControls(),
      i = e.length;
    if (e && i > 0)
      for (var n = 0; n < i; n++)
        e[n].setCheckedState(t)
  },
  o.prototype.expand = function() {
    this.treeNode.removeClass("bf-collapse")
  },
  o.prototype.collapse = function() {
    this.treeNode.addClass("bf-collapse")
  },
  o.prototype.toggleExpansion = function(t) {
    this.treeNode.toggleClass("bf-collapse", t)
  },
  o.prototype.select = function() {
    return this.treeName.addClass("bf-selected")
  },
  o.prototype.deselect = function() {
    return this.treeName.removeClass("bf-selected")
  },
  e.TreeNode = o
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.UI.Tree"),
    e = new Glodon.Bimface.UI.Control.ControlConfig,
    i = function() {
      var t = {
        className: "bf-tree",
        title: "tree",
        hasCheckbox: !0,
        isChecked: !0,
        selection: !0
      };
      return Object.assign(e, t)
    };
  t.TreeNodeConfig = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer"),
    e = (Object.freeze({TranslucentOthers: "", HideOthers: ""}), function() {
      var t = new Glodon.Web.Lang.EventManager;
      this.getEventManager = function() {
        return t
      }
    });
  e.prototype.init = function() {},
  e.prototype.addView = function(t) {
    var e = this,
      i = Glodon.Bimface.Authentication.AuthenticationManager,
      n = (e._opt, new Glodon.Bimface.Authentication.AuthenticationConfig);
    n.viewToken = t,
    n.APIHost = this._opt.APIHost,
    (this.authenticate = new i(n)).authenticate(function(t) {
      "bimView" == t.renderType && (t.renderType = "3DView"),
      e._data = t,
      e.loadViewCore(t)
    }, function(t) {
      var i = Glodon.Bimface.Viewer.Viewer3DEvent;
      e.getEventManager().fireEvent(i.Error, t)
    })
  },
  e.prototype.loadViewCore = function() {},
  e.prototype.addEventListener = function(t, e) {
    this.getEventManager().addEvent(t, e)
  },
  e.prototype.removeEventListener = function(t, e) {
    this.getEventManager().removeEvent(t, e)
  },
  e.prototype.enableFullScreen = function(t) {
    var e = this._opt.domElement,
      i = this;
    t
      ? Glodon.Web.Lang.Utility.FullScreen.fullScreen(e)
      : Glodon.Web.Lang.Utility.FullScreen.exitFullScreen(),
    setTimeout(function() {
      i.resize()
    }, 200)
  },
  t.Viewer = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer"),
    e = function() {
      return {domElement: null, resourceHost: "https://m.bimface.com", APIHost: "https://api.bimface.com"}
    };
  t.Viewer2DConfig = e
}(),
function() {
  var t = Object.freeze({
    Loaded: "Loaded",
    MouseClicked: "MouseClicked",
    Rendered: "Rendered",
    ViewChanged: "ViewChanged",
    ViewMoving: "ViewMoving",
    ViewMoved: "ViewMoved",
    ViewZooming: "ViewZooming",
    Error: "Error"
  });
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").Viewer2DEvent = t
}(),
function() {
  var t = Object.freeze({Pan: "Pan", Zoom: "Zoom"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").NavigationMode2D = t
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    n = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest"),
    o = Glodon.Bimface.Viewer.Viewer2DEvent,
    r = function(e) {
      t.Viewer.call(this);
      var n = this,
        r = i.create("div", "bf-dwg");
      e.domElement.appendChild(r),
      n._opt = e,
      n._domElement = r,
      n._viewLoaded = !1,
      n._dwgViewer = n.createDwgViewer(),
      n.currentViewId = null;
      var a;
      r.addEventListener("mousedown", function() {
        a = (new Date).getTime()
      }),
      r.addEventListener("mouseup", function(t) {
        var e = (n._dwgViewer, (new Date).getTime()),
          i = r.getBoundingClientRect(),
          s = {
            x: t.clientX - i.left,
            y: t.clientY - i.top
          },
          l = n.clientToWorld(s);
        e - a < 300 && n.getEventManager().fireEvent(o.MouseClicked, {
          worldPosition: l,
          clientPosition: s
        }),
        a = e = null
      }),
      this.getDomElement = function() {
        return r
      }
    };
  e.Type.inheritPrototype(r, t.Viewer),
  r.prototype = Object.assign({}, t.Viewer.prototype, {
    createDwgViewer: function() {
      var t = this;
      return {
        __container: null,
        __options: null,
        __unit: 512,
        __state: "pan",
        __rect: null,
        __defaultTileURL: "//static.bimface.com/components/images/tile-default.jpg",
        __curLevel: 1,
        __zoomFact: 1.6,
        __zoomScale: 1,
        __canMove: !1,
        __startPos: null,
        __startPoint: null,
        __endPoint: null,
        __startDistance: null,
        __endDistance: null,
        __startScale: null,
        __moveLevel: null,
        __viewWidth: 0,
        __viewHeight: 0,
        __viewLeft: 0,
        __viewTop: 0,
        __sceneInViewPoint: {},
        __endCallback: null,
        __mouseInViewPoint: {
          left: 0,
          top: 0
        },
        __imgObjCache: [],
        __zoomStart: null,
        __zoomDelta: 800,
        __zoomTimer: null,
        __pinchStart: null,
        __pinchDelta: 2e3,
        __pinchTimer: null,
        init: function(t, e) {
          var n = this,
            o = i.create("div", "bf-scene"),
            r = i.create("div", "bf-rect");
          if (o.innerHTML = '<div class="bf-dwg-view"></div>', t.appendChild(r), n.__container = t, n.__panel && n.__panel.parentElement.removeChild(n.__panel), n.__panel = n.__container.appendChild(o), n.__rect = r, n.__viewWidth = t.offsetWidth, n.__viewHeight = t.offsetHeight, "string" == typeof e) {
            var a = new Image;
            a.src = e,
            n.__panel.appendChild(a),
            n.__options = Object.assign({
              lod: {
                maxLevel: 1,
                ext: "",
                url: ""
              }
            }, e)
          } else {
            n.__options = Object.assign({
              lod: {
                maxLevel: 11,
                ext: "",
                url: ""
              }
            }, e);
            var s = n.__options.lod;
            n.__firstImgUrl = s.url + "/L1/Model_0_0." + s.ext,
            n.fit()
          }
          n.__bindEvent(),
          n.__bindMobileEvent()
        },
        getPanel: function() {
          return this.__panel
        },
        setState: function(t) {
          this.__state = t
        },
        getViewInfo: function() {
          var t = this,
            e = t.__zoomScale,
            i = t.__unit;
          return {
            view: {
              width: t.__viewWidth,
              height: t.__viewHeight,
              top: t.__viewTop,
              left: t.__viewLeft
            },
            scene: {
              width: i * e,
              height: i * e,
              scale: t.__zoomScale
            }
          }
        },
        windowResize: function() {
          var t = this,
            e = t.__container;
          t.__viewWidth = e.offsetWidth,
          t.__viewHeight = e.offsetHeight,
          t.zoom(t.__zoomScale)
        },
        drawRect: function(t) {
          this.__rect.style.width = t.offsetX + "px",
          this.__rect.style.height = t.offsetY + "px"
        },
        rectZoom: function() {
          var t = this,
            e = t.__rect;
          if ("none" == e.style.display)
            return !1;
          var i = e.offsetTop,
            n = e.offsetLeft,
            o = t.__viewWidth,
            r = t.__viewHeight,
            a = e.offsetWidth,
            s = e.offsetHeight,
            l = t.__zoomScale,
            c = 1;
          if (a < 10 || s < 10)
            return e.style.width = "0",
            e.style.height = "0",
            e.style.display = "none",
            !1;
          c = o / r > a / s
            ? r / s
            : o / a,
          l *= c;
          var h = {
            top: i + s / 2,
            left: n + a / 2
          };
          e.style.width = "0",
          e.style.height = "0",
          e.style.display = "none",
          t.zoom(l, h)
        },
        pan: function(e) {
          var i = this;
          i.__viewLeft = i.__startPos.left - e.offsetX,
          i.__viewTop = i.__startPos.top - e.offsetY,
          i.__resetSceneInViewPoint(),
          i.__changeViewPos(),
          t.getEventManager().fireEvent(o.ViewMoving, e),
          t.getEventManager().fireEvent(o.Rendered)
        },
        zoomIn: function(t) {
          var e = this,
            i = e.__zoomScale * e.__zoomFact;
          e.zoom(i, t)
        },
        zoomOut: function(t) {
          var e = this,
            i = e.__zoomScale / e.__zoomFact;
          e.zoom(i, t)
        },
        zoomTo: function(t, e) {
          this.zoom(t, e)
        },
        fit: function() {
          var t = this;
          t.__curLevel = 1,
          t.__zoomScale = 1,
          t.__viewLeft = 0,
          t.__viewTop = 0,
          t.__viewPoint(),
          t.__genTiles()
        },
        zoom: function(e, n) {
          var r = this,
            a = r.__panel,
            s = r.__options,
            l = a.getElementsByClassName("bf-dwg-view")[0],
            c = r.__unit,
            h = r.__curLevel,
            u = s.lod;
          if (e <= 1)
            e = 1,
            h = 1;
          else
            var d = Math.log(e) / Math.log(2),
              h = parseInt(d, 10) + 2;
          if (h >= u.maxLevel) {
            var p = Math.pow(2, u.maxLevel - 1);
            e >= p && (e = p),
            h = u.maxLevel
          }
          for (var f = e / r.__zoomScale, m = l.getElementsByClassName("bf-dwg-tile"), g = 0, v = m.length; g < v; g++) {
            var y = m[g],
              d = y.getAttribute("data-level"),
              E = r.__zoomScale / Math.pow(2, d - 1);
            y.style.width = c * E * f + "px",
            y.style.height = c * E * f + "px"
          }
          if (e < r.__zoomScale) {
            var x = i.create("img", "bf-dwg-tile");
            x.src = r.__firstImgUrl,
            x.setAttribute("data-col", "0"),
            x.setAttribute("data-row", "0"),
            x.setAttribute("data-level", "1"),
            x.style.width = c * e + "px",
            x.style.height = c * e + "px",
            x.style.zIndex = 0,
            l.appendChild(x)
          }
          r.__mouseInViewPoint = n || {
            left: r.__viewWidth / 2,
            top: r.__viewHeight / 2
          },
          r.__resetSceneInViewPoint(),
          r.__zoomScale = e,
          r.__viewPoint(!0),
          r.__curLevel = h,
          r.__stateChange();
          var b = r.__zoomStart,
            w = r.__zoomDelta,
            C = new Date;
          window.clearTimeout(r.__zoomTimer),
          b
            ? C.getTime() - b.getTime() >= w
              ? r.__zoomEvent()
              : r.__zoomTimer = window.setTimeout(function() {
                r.__zoomEvent()
              }, w)
            : b = new Date,
          r.__zoomStart = C,
          n || (n = {
            left: 0,
            top: 0
          }),
          t.getEventManager().fireEvent(o.ViewZooming, {
            zoomScale: e,
            mouseClientPosition: {
              x: n.left,
              y: n.top
            }
          }),
          t.getEventManager().fireEvent(o.Rendered)
        },
        __zoomEvent: function() {
          var t = this;
          t.__genTiles(),
          t.__viewPoint(!0),
          t.__zoomStart = null
        },
        __removeLast: function() {
          for (var t = this, e = t.__panel.getElementsByTagName("view")[0], i = e.getElementsByTagName("bf-dwg-past"), n = 0, o = i.length; n < o; n++)
            e.removeChild(i[n])
        },
        __bindEvent: function() {
          var e = this,
            i = e.__container,
            n = e.__rect,
            r = e.__zoomScale;
          window.addEventListener("resize", function() {
            e.windowResize()
          });
          var a = function(t, o) {
              var a = e.__state;
              r = e.__zoomScale,
              t = o || t,
              e.__canMove = !0,
              i.style.cursor = "pointer";
              var o = e.__startPoint = e.__getEventPoint(t);
              if (e.__startPos = {
                top: e.__viewTop,
                left: e.__viewLeft
              }, "rectzoom" == a) {
                var s = e.__container.offsetTop,
                  l = e.__container.offsetLeft;
                !function t(e) {
                  e.offsetParent && (s += e.offsetParent.offsetTop, l += e.offsetParent.offsetLeft, t(e.offsetParent))
                }(e.__container);
                var c = document.documentElement.scrollTop,
                  h = document.documentElement.scrollLeft;
                n.style.top = c + o.y - s + "px",
                n.style.left = h + o.x - l + "px",
                n.style.display = "block"
              }
              return t.preventDefault(),
              !1
            },
            s = function(t) {
              var i = e.__state;
              if (!e.__canMove)
                return !1;
              var n = e.__endPoint = e.__getEventPoint(t),
                o = e.__startPoint,
                a = {
                  offsetX: n.x - o.x,
                  offsetY: n.y - o.y
                };
              if (Math.abs(a.offsetX) > 10 || Math.abs(a.offsetX) > 10)
                switch (i.toLocaleLowerCase()) {
                  case "pan":
                    e.pan(a);
                    break;
                  case "rectzoom":
                    e.drawRect(a);
                    break;
                  case "zoom":
                    if (Math.abs(a.y) > 20) {
                      var s = -a.y / 200 + r;
                      s = s < 1
                        ? 1
                        : s,
                      e.zoom(s)
                    }
                }
              return !1
            },
            l = function(n) {
              if (!e.__startPoint)
                return !1;
              var r = e.__state,
                a = e.__startPoint,
                s = e.__getEventPoint(n),
                l = {
                  offsetX: s.x - a.x,
                  offsetY: s.y - a.y
                };
              switch (e.__canMove = !1, i.style.cursor = "default", e.__startPoint = null, e.__endPoint = null, r.toLocaleLowerCase()) {
                case "pan":
                  e.__stateChange();
                  break;
                case "rectzoom":
                  e.rectZoom()
              }
              return e.__genTiles(),
              e.__endCallback && e.__endCallback(),
              t.getEventManager().fireEvent(o.ViewMoved, l),
              !1
            };
          i.addEventListener("mousedown", a),
          i.addEventListener("mouseup", l),
          i.addEventListener("mouseleave", l),
          i.addEventListener("mousemove", s),
          i.addEventListener("mousewheel", function(t) {
            e.__wheelEvent(t),
            t.preventDefault()
          }),
          i.addEventListener("DOMMouseScroll", function(t) {
            e.__wheelEvent(t),
            t.preventDefault()
          })
        },
        __wheelEvent: function(t) {
          var e = this,
            i = t.wheelDelta && (
              t.wheelDelta > 0
              ? 1
              : -1) || t.detail && (
              t.detail > 0
              ? -1
              : 1),
            n = e.__zoomScale,
            o = n + i * n / 10,
            r = e.__container.offsetLeft,
            a = e.__container.offsetTop,
            s = {
              left: t.pageX - r,
              top: t.pageY - a
            };
          e.zoom(o, s)
        },
        __bindMobileEvent: function() {
          var e = this,
            i = e.__container;
          window.addEventListener("resize", function() {
            e.windowResize()
          }),
          i.addEventListener("touchstart", function(t) {
            t.preventDefault();
            var t = e.__getMobileEvt(t);
            return t.isMulti
              ? (e.__startScale = e.__zoomScale, e.__startDistance = t.distance)
              : (e.__startPoint = t.point, e.__startPos = {
                top: e.__viewTop,
                left: e.__viewLeft
              }),
            !1
          }),
          i.addEventListener("touchend", function(i) {
            var i = e.__getMobileEvt(i);
            return e.__startDistance
              ? (e.__stateChange(), e.__genTiles(), e.__viewPoint(!0))
              : (e.__stateChange(), e.__genTiles()),
            e.__startPoint = null,
            e.__endPoint = null,
            e.__startDistance = null,
            e.__endDistance = null,
            e.__startScale = null,
            t.getEventManager().fireEvent(o.ViewMoved, offset),
            !1
          }),
          i.addEventListener("touchmove", function(t) {
            var t = e.__getMobileEvt(t);
            if (t.isMulti) {
              var i = e.__endDistance = t.distance,
                n = e.__startDistance,
                o = e.__startScale * i / n;
              e.zoom(o)
            } else {
              var r = e.__endPoint = t.point,
                a = e.__startPoint || t.point,
                s = {
                  offsetX: r.x - a.x,
                  offsetY: r.y - a.y
                };
              (Math.abs(s.offsetX) > 10 || Math.abs(s.offsetY) > 10) && e.pan(s)
            }
          })
        },
        __getMobileEvt: function(t) {
          for (var e = this, t = t.originalEvent || t, i = [], n = null, o = 0, r = t.touches.length; o < r; o++)
            n = t.touches[o],
            i.push({x: n.pageX, y: n.pageY});
          return i.length <= 1
            ? {
              isMulti: !1,
              point: i[0]
            }
            : {
              isMulti: !0,
              distance: e.__getDistance(i[0], i[1]),
              point: i
            }
        },
        __getDistance: function(t, e) {
          var i = e.x - t.x,
            n = e.y - t.y;
          return Math.sqrt(i * i + n * n)
        },
        __viewPoint: function(t) {
          var e = this,
            i = e.__unit,
            n = e.__zoomScale,
            o = e.__viewWidth,
            r = e.__viewHeight,
            a = i * n,
            s = a;
          if (!t)
            return e.__viewLeft = (a - o) / 2,
            e.__viewTop = (s - r) / 2,
            e.__mouseInViewPoint = {
              left: o / 2,
              top: r / 2
            }
          ,
          e.__resetSceneInViewPoint(),
          e.__changeViewPos(),
          !1;
          var l = e.__viewLeft,
            c = e.__viewTop,
            h = e.__sceneInViewPoint,
            u = e.__mouseInViewPoint,
            d = n * i * h.left,
            p = n * i * h.top;
          l = d - u.left,
          c = p - u.top,
          e.__viewLeft = l,
          e.__viewTop = c,
          e.__changeViewPos()
        },
        __changeViewPos: function() {
          var t = this,
            e = t.__panel,
            i = t.__zoomScale,
            n = (t.__curLevel, t.__unit),
            o = e.getElementsByClassName("bf-dwg-view")[0],
            r = t.__viewLeft,
            a = t.__viewTop,
            s = t.__viewHeight / 2 + a,
            l = t.__viewWidth / 2 + r;
          o.style.top = s + "px",
          o.style.left = l + "px",
          e.style.top = -a + "px",
          e.style.left = -r + "px";
          for (var c = o.getElementsByTagName("img"), h = 0, u = c.length; h < u; h++) {
            var d = c[h],
              p = d.getAttribute("data-level"),
              f = n * i / Math.pow(2, p - 1),
              m = d.getAttribute("data-col"),
              g = d.getAttribute("data-row"),
              v = g * f - s,
              y = m * f - l;
            d.style.top = v + "px",
            d.style.left = y + "px"
          }
        },
        __genTiles: function() {
          function e(t, e) {
            if (e)
              return !1;
            if (m === f)
              for (var i = c.getElementsByClassName("bf-dwg-past"), n = i.length, o = n; o > 0; o--)
                c.removeChild(i[0]);
          t && c.appendChild(t)
          }
          var n = this,
            r = n.__curLevel,
            a = n.__zoomScale,
            s = n.__panel,
            l = n.__options,
            c = s.getElementsByClassName("bf-dwg-view")[0],
            h = n.__getShowTiles(r, n.__viewLeft, n.__viewTop, n.__viewWidth, n.__viewHeight, l.lod.maxLevel);
          n.__images = h;
          for (var u = c.getElementsByClassName("bf-dwg-tile"), d = 0, p = u.length; d < p; d++)
            u[d].addClass("bf-dwg-past");
          for (var f = h.length, m = 0, d = 0, p = h.length; d < p; d++) {
            var g = i.create("img", "bf-dwg-tile"),
              v = h[d],
              y = n.__unit,
              E = a / Math.pow(2, n.__curLevel - 1);
            v.src = v.src.replace(/[#+? ]/g, function(t) {
              return escape(t)
            }),
            g.onload = function() {
              m++,
              e(this, this.stateChange)
            },
            g.onerror = function() {
              m++,
              e("", this.stateChange)
            },
            g.onabort = function() {
              v.src = n.__defaultTileURL,
              m++,
              e(this, this.stateChange)
            },
            g.src = v.src,
            g.setAttribute("data-row", v.row),
            g.setAttribute("data-col", v.col),
            g.setAttribute("data-level", v.level),
            g.style.top = v.top + "px",
            g.style.left = v.left + "px",
            g.style.width = y * E + "px",
            g.style.height = y * E + "px",
            n.__imgObjCache.push(g)
          }
          t.getEventManager().fireEvent(o.Rendered)
        },
        __resetSceneInViewPoint: function() {
          var t = this,
            e = t.__unit,
            i = t.__zoomScale,
            n = t.__viewLeft,
            o = t.__viewTop,
            r = t.__sceneInViewPoint,
            a = t.__mouseInViewPoint;
          r.left = (n + a.left) / (e * i),
          r.top = (o + a.top) / (e * i)
        },
        __getShowTiles: function(t, e, i, n, o, r) {
          var a = this,
            s = a.__options.lod.url,
            l = a.__options.lod.ext,
            c = [],
            h = a.__unit * a.__zoomScale / Math.pow(2, a.__curLevel - 1),
            u = {
              row: parseInt(i / h, 10),
              col: parseInt(e / h, 10)
            },
            d = 1,
            p = h - e % h;
          for (0 === p && (p += h); p < n;)
            p += h,
            d++;
          var f = 1,
            m = h - i % h;
          for (0 === m && (m += h); m < o;)
            m += h,
            f++;
          var g = e + n / 2,
            v = i + o / 2,
            y = Math.pow(2, t - 1);
          if (1 == r)
            return !1;
          for (var E = 0; E < f; E++) {
            var x = u.row + E;
            if (!(x >= y || x < 0))
              for (var b = 0; b < d; b++) {
                var w = u.col + b;
                w >= y || w < 0 || c.push({
                  row: x,
                  col: w,
                  src: s + "/L" + t + "/Model_" + x + "_" + w + "." + l,
                  top: x * h - v,
                  left: w * h - g,
                  level: a.__curLevel
                })
              }
            }
          return c
        },
        __stateChange: function() {
          for (var t = this, e = t.__imgObjCache, i = 0, n = e.length; i < n; i++)
            e[i].stateChange = !0;
          t.__imgObjCache = []
        },
        __getEventPoint: function(t) {
          return {
            x: t.clientX || t.pageX || t.originalEvent && (t.originalEvent.clientX || t.originalEvent.pageX),
            y: t.clientY || t.pageY || t.originalEvent && (t.originalEvent.clientY || t.originalEvent.pageY),
            offsetX: t.offsetX || t.originalEvent && t.originalEvent.layerX,
            offsetY: t.offsetY || t.originalEvent && t.originalEvent.layerY
          }
        },
        __showInfo: function(t) {
          var e = this;
          e.debugPanel.html(e.debugPanel.html() + "<br/>" + t).scrollTop(e.debugPanel[0].scrollHeight)
        }
      }
    },
    load: function(t) {
      0 == this._viewLoaded && (this._viewLoaded = !0, this.addView(t))
    },
    loadViewCore: function(t) {
      var e = this,
        i = e._opt;
      n.ajax({
        async: !1,
        url: i.resourceHost + "/" + t.databagId + "/manifest.json",
        success: function(t) {
          var i = JSON.parse(t);
          if (i.Views) {
            for (var n = [], r = 0, a = i.Views.length; r < a; r++) {
              var s = i.Views[r],
                l = s.Representations.getObjectByAttribute("MIME", "image/tiles");
              n.push({name: s.Name, id: s.ID, file: l})
            }
            e._views = n,
            e.showViewById(n[0].id),
            e.getEventManager().fireEvent(o.Loaded, e)
          }
        }
      })
    },
    showFile: function(t) {
      var e = this,
        i = e._opt,
        n = e._data;
      e._dwgViewer.init(e._domElement, {
        lod: {
          maxLevel: parseInt(t.Attributes.DwgLevel, 10),
          ext: t.Attributes.DwgExt || "jpg",
          url: i.resourceHost + "/" + n.databagId + "/" + t.Path
        }
      })
    },
    showImage: function(t) {
      this._dwgViewer.init(this._domElement, t)
    },
    render: function() {},
    home: function() {
      this._dwgViewer.fit()
    },
    setNavigationMode: function(t) {
      this._dwgViewer.setState(t)
    },
    zoomIn: function() {
      this._dwgViewer.zoomIn()
    },
    zoomOut: function() {
      this._dwgViewer.zoomOut()
    },
    zoom: function(t) {
      this._dwgViewer.zoomTo(t)
    },
    rectZoom: function(t) {
      this._dwgViewer.setState("rectzoom"),
      t && (this._dwgViewer.__endCallback = t)
    },
    getViews: function() {
      return this._views
    },
    showViewById: function(t) {
      if (this.currentViewId != t) {
        var e = this._views,
          i = e.getObjectByAttribute("id", t);
        i && (this.currentViewId = t, this.showFile(i.file), this.getEventManager().fireEvent(o.ViewChanged, t))
      }
    },
    resize: function() {
      this._dwgViewer.windowResize()
    },
    worldToClient: function(t) {
      var e = this._dwgViewer,
        i = this.getMaxLevel(),
        n = e.__zoomScale,
        o = e.__viewLeft,
        r = e.__viewTop;
      return new Glodon.Web.Geometry.Point3d(t.x * n / i - o, t.y * n / i - r, 0)
    },
    clientToWorld: function(t) {
      var e = this._dwgViewer,
        i = e.__options.lod.maxLevel,
        n = e.__zoomScale,
        o = e.__viewLeft,
        r = e.__viewTop;
      return new Glodon.Web.Geometry.Point3d((t.x + o) * i / n, (t.y + r) * i / n, 0)
    },
    isInViewFrustum: function(t) {
      var e = this._dwgViewer,
        i = e.__viewWidth,
        n = e.__viewHeight,
        o = this.worldToClient(t);
      return o.x > 0 && o.x < i && o.y > 0 && o.y < n
    },
    getMaxLevel: function() {
      return this._dwgViewer.__options.lod.maxLevel
    },
    getCurrentLevel: function() {
      return this._dwgViewer.__curLevel
    },
    getZoomScale: function() {
      return this._dwgViewer.__zoomScale
    },
    getCurrentState: function() {
      var t = this,
        e = t._dwgViewer;
      return {viewTop: e.__viewTop, viewLeft: e.__viewLeft, level: e.__curLevel, zoomScale: e.__zoomScale, viewId: t.currentViewId}
    },
    setState: function(t) {
      var e = this,
        i = e._dwgViewer;
      e.currentViewId != t.viewId && e.showViewById(t.viewId),
      i.zoom(t.zoomScale),
      i.__viewTop = t.viewTop,
      i.__viewLeft = t.viewLeft,
      i.__genTiles()
    },
    createSnapshotAsync: function(t, e) {
      var n = this,
        o = i.create("canvas", "bf-canvas"),
        r = o.getContext("2d"),
        a = n._dwgViewer,
        s = a.__viewWidth,
        l = a.__viewHeight,
        c = s / 2,
        h = l / 2,
        u = (a.__viewTop, a.__viewLeft, a.__images),
        d = u.length,
        p = a.__unit * a.__zoomScale / Math.pow(2, a.__curLevel - 1),
        f = function() {
          if (0 == d) {
            var t = o.toDataURL("image/png");
            e && e(t)
          }
        };
      o.setAttribute("width", s),
      o.setAttribute("height", l),
      r.rect(0, 0, s, l),
      t instanceof Glodon.Web.Graphics.Color
        ? r.fillStyle = t.getRGBA()
        : r.fillStyle = "#000",
      r.fillRect(0, 0, s, l);
      for (var m = 0; m < d; m++)
        !function(t, e) {
          new Glodon.Web.Graphics.Utility.ImageContainer(t.src).then(function(i) {
            t.isLoad = !0,
            r.drawImage(i, t.left + c, t.top + h, e, e),
            d--,
            f()
          }, function(e) {
            t.isLoad = !0,
            d--,
            f()
          })
        }
      (u[m], p)
    }
  }),
  t.Viewer2D = r
}(),
function() {
  var t = Object.freeze({
    ViewAdded: "ViewAdded",
    ViewLoading: "ViewLoading",
    Rendered: "Rendered",
    ComponentsSelectionChanged: "ComponentsSelectionChanged",
    SelectionChanged: "SelectionChanged",
    MouseClicked: "MouseClicked",
    ContextMenu: "ContextMenu",
    RectSelection: "RectSelection",
    Error: "Error"
  });
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").Viewer3DEvent = t
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer"),
    e = function(t) {
      var e = Glodon.Bimface.Viewer.OrbitButton,
        i = Glodon.Bimface.Viewer.ViewOption,
        n = {
          domElement: null,
          APIHost: "https://api.bimface.com",
          resourceHost: "https://m.bimface.com",
          initialViewOption: i.Home,
          homeViewOption: i.Home,
          enableViewHouse: !0,
          minimumFPS: 15,
          enableOrbit: !0,
          orbitButton: e.Left,
          suffix: ".gz",
          loading: !0
        };
      return Object.assign(n, t)
    };
  t.Viewer3DConfig = e
}(),
function() {
  var t = Object.freeze({HideOthers: "HideOthers", MakeOthersTranslucent: "MakeOthersTranslucent"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").IsolateOption = t
}(),
function() {
  var t = Object.freeze({
    Home: "Home",
    Top: "Top",
    Bottom: "Bottom",
    North: "North",
    South: "South",
    West: "West",
    East: "East",
    SouthEast: "SouthEast",
    SouthWest: "SouthWest",
    NorthEast: "NorthEast",
    NorthWest: "NorthWest"
  });
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").ViewOption = t
}(),
function() {
  var t = Object.freeze({Red: "Red", Yellow: "Yellow", Green: "Green", Blue: "Blue", Black: "Black"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").ColorOption = t
}(),
function() {
  var t = Object.freeze({
    Fly: "Fly",
    Orbit: "Orbit",
    Select: "Select",
    Zoom: "Zoom",
    OrbitWithModelCenter: "OrbitWithModelCenter",
    PickWithRect: "PickWithRect",
    ZoomWithRect: "ZoomWithRect"
  });
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").NavigationMode3D = t
}(),
function() {
  var t = Object.freeze({Translucent: "Translucent", Opaque: "Opaque"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").OpacityOption = t
}(),
function() {
  var t = Object.freeze({Left: "Left", Right: "Right"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").OrbitButton = t
}(),
function() {
  var t = Object.freeze({X: "X", Y: "Y", Z: "Z"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").AxisOption = t
}(),
function() {
  var t = Object.freeze({Default: "Default", Rotate: "Rotate"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").SectionBoxMode = t
}(),
function() {
  var t = Object.freeze({Up: "Up", Down: "Down", Left: "Left", Right: "Right"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer").Direction = t
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    n = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest"), "The API doesn't support the version of current data."),
    o = "Please call enableSectionBox before using this method.",
    r = function(e) {
      t.Viewer.call(this);
      var n = this;
      this._beforeInitialize(e),
      this._opt = e,
      this._colorOverridedMap = {},
      this._colorOverridedList = [];
      var o = new CLOUD.Viewer,
        r = (CLOUD.GlobalData, Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop());
      r
        ? console.log("client: desktop")
        : console.log("client: mobile");
      var a = i.create("div", "bf-view");
      e.domElement.appendChild(a),
      o.init(a),
      this.view = {},
      o.setDeviceMobile && o.setDeviceMobile(!r),
      this.getViewer = function() {
        return o
      },
      this.getDomElement = function() {
        return a
      },
      this.hookContextMenu(a),
      this.hookCloudViewerEvents(),
      this._config(e),
      window.addEventListener("resize", function() {
        n.resize()
      })
    };
  e.Type.inheritPrototype(r, t.Viewer),
  r.prototype = Object.assign({}, t.Viewer.prototype, {
    hookContextMenu: function(t) {
      var e,
        i,
        n = this,
        o = t.getBoundingClientRect();
      t.addEventListener("mousedown", function() {
        e = (new Date).getTime()
      }),
      t.addEventListener("mouseup", function(t) {
        var t = t || event,
          r = {
            x: t.clientX - o.left,
            y: t.clientY - o.top
          };
        t.button,
        (i = (new Date).getTime()) - e < 300 && 2 == t.button && (n._disableContextMenu || n.getEventManager().fireEvent(Glodon.Bimface.Viewer.Viewer3DEvent.ContextMenu, n, r))
      })
    },
    toggleContextMenuDisplay: function() {
      this._disableContextMenu = !this._disableContextMenu
    },
    hookCloudViewerEvents: function() {
      var t = this,
        e = t._opt,
        n = this.getViewer(),
        o = this.getEventManager(),
        r = Glodon.Bimface.Viewer.Viewer3DEvent,
        a = i.create("div", "bf-loading"),
        s = i.create("div", "bf-loading-gif"),
        l = i.create("div", "bf-loading-progress"),
        c = i.create("div", "bf-loading-text"),
        h = !1,
        u = i.create("div", "bf-rect-selcetion"),
        d = function(t) {
          var e = null,
            i = t.doubleClick
              ? "DoubleClick"
              : "Click",
            n = t.doubleClick
              ? 2
              : 1;
          if (t.intersectInfo && "Marker3D" == t.intersectInfo.tag)
            return !1;
          if (t.intersectInfo) {
            if (e = {
              objectId: t.intersectInfo.selectedObjectId,
              fileId: null,
              elementId: t.intersectInfo.selectedObjectId,
              boundingBox: t.intersectInfo.worldBoundingBox,
              click: n,
              worldPosition: t.intersectInfo.worldPosition,
              clientPosition: t.canvasPos,
              eventType: i
            }, t.intersectInfo.selectedObjectId && "string" == typeof t.intersectInfo.selectedObjectId) {
              var a = t.intersectInfo.selectedObjectId.split(".");
              a.length > 1 && (e.elementId = a[1], e.fileId = a[0])
            }
          } else
            e = {
              screenPosition: t.canvasPos,
              click: n,
              eventType: i
            };
          t.event.altKey && console.log(e),
          o.fireEvent(r.MouseClicked, e),
          o.fireEvent(r.ComponentsSelectionChanged, e)
        },
        p = function(t) {
          t.visible
            ? (u.setCss({
              left: t.left + "px",
              top: t.top + "px",
              width: t.width + "px",
              height: t.height + "px",
              opacity: t.dir
                ? .5
                : .1
            }), e.domElement.appendChild(u), h = !0)
            : (h && (e.domElement.removeChild(u), h = !1), o.fireEvent(r.RectSelection, t))
        };
      l.innerText = "0%",
      c.innerText = "...",
      a.appendChild(s),
      a.appendChild(l),
      a.appendChild(c),
      n.registerEventListener(CLOUD.EVENTS.ON_LOAD_START, function() {
        e.loading && e.domElement.appendChild(a)
      }),
      n.registerEventListener(CLOUD.EVENTS.ON_LOAD_COMPLETE, function() {
        e.enableViewHouse && t.showViewHouse(),
        e.loading && e.domElement.removeChild(a),
        t.setNavigationMode(Glodon.Bimface.Viewer.NavigationMode3D.PickWithRect),
        n.enableTextureMapping(!0),
        o.fireEvent(r.ViewAdded, t)
      }),
      n.registerEventListener(CLOUD.EVENTS.ON_LOAD_PROGRESS, function(t) {
        var e = t.progress,
          i = Math.round(e.loaded / e.total * 100);
        e.progress = i,
        l.innerText = i + "%",
        o.fireEvent(r.ViewLoading, e)
      }),
      n.registerEventListener(CLOUD.EVENTS.ON_LOAD_EMPTY_SCENE, function() {
        e.loading && e.domElement.removeChild(a),
        o.fireEvent(r.Error, {
          code: "EmptyData",
          message: "this view is empty."
        })
      }),
      n.registerEventListener(CLOUD.EVENTS.ON_EDITOR_UPDATEUI, function(t) {
        p(t.data)
      }),
      n.registerEventListener(CLOUD.EVENTS.ON_EDITOR_BEGIN, function() {}),
      n.registerEventListener(CLOUD.EVENTS.ON_EDITOR_END, function() {}),
      n.registerEventListener(CLOUD.EVENTS.ON_CLICK_PICK, function(t) {
        d(t)
      }),
      n.registerEventListener(CLOUD.EVENTS.ON_SELECTION_CHANGED, function(t) {
        o.fireEvent(Glodon.Bimface.Viewer.Viewer3DEvent.SelectionChanged, t.selectionList)
      }),
      n.addCallbacks("render", function() {
        o.fireEvent(Glodon.Bimface.Viewer.Viewer3DEvent.Rendered)
      })
    },
    render: function() {
      this.getViewer().render()
    },
    enableOrbit: function(t) {
      this.getViewer().cameraControl.noRotate = void 0 != t && !t
    },
    setMinimumFPS: function(t) {
      if ("number" != typeof t)
        return !1;
      t = t > 60
        ? 60
        : t < 4
          ? 4
          : t,
      this.getViewer().limitFrameRate(t)
    },
    exitWalk: function() {
      var t = document.querySelector(".gld-bf-firstperson.bf-checked");
      t && t.click()
    },
    setView: function(t) {
      var e = {
        Home: 0,
        Top: 1,
        Bottom: 2,
        North: 3,
        South: 4,
        West: 5,
        East: 6,
        SouthEast: 7,
        SouthWest: 8,
        NorthEast: 9,
        NorthWest: 10
      };
      this.exitWalk();
      var i = this.getViewer();
      i.editorManager.setStandardView(e[t], i)
    },
    showAllComponents: function() {
      this.getViewer().getFilters().clear()
    },
    zoomToSelectedComponents: function() {
      this.getViewer().zoomToSelection()
    },
    zoomToBoundingBox: function(t) {
      if (t && t.min && t.max) {
        var e = [
          [
            t.min.x, t.min.y, t.min.z
          ],
          [
            t.max.x, t.max.y, t.max.z
          ]
        ];
        this.getViewer().zoomToBBox(CLOUD.Utils.computeBBox(e), -.5)
      }
    },
    setNavigationMode: function(t) {
      var e = this._adapter.isDeprecatedEngine(),
        i = this.getViewer();
      if (e)
        switch (t) {
          case "Fly":
            i.setFlyMode();
            break;
          case "Orbit":
            i.setOrbitMode();
            break;
          case "Select":
            i.setPickMode(!0);
            break;
          case "Zoom":
            i.setZoomMode();
            break;
          default:
            console.log(n)
        }
      else
        switch (t) {
          case "Fly":
            i.setEditorMode("fly");
            break;
          case "Orbit":
            i.setEditorMode("orbit");
            break;
          case "Select":
            i.setEditorMode("pick"),
            i.setPointRotateMode(CLOUD.PointRotateMode.SELECTION);
            break;
          case "Zoom":
            i.setEditorMode("zoom");
            break;
          case "OrbitWithModelCenter":
            i.setEditorMode("pick"),
            i.setPointRotateMode(CLOUD.PointRotateMode.CENTER);
            break;
          case "PickWithRect":
            i.setEditorMode("pickByRect"),
            i.setPointRotateMode(CLOUD.PointRotateMode.SELECTION);
            break;
          case "ZoomWithRect":
            i.setEditorMode("zoomByRect"),
            i.setPointRotateMode(CLOUD.PointRotateMode.SELECTION)
        }
      },
    setOrbitButton: function(t) {
      var e = {
        Left: "left",
        Right: "right"
      };
      this._opt.orbitButton = t,
      this.getViewer().setOrbitButton(e[t])
    },
    setUseLeftHandedInput: function(t) {
      this._opt.leftHandedMouseSetup = t,
      this.getViewer().setOrbitButton(t && "left" || "right")
    },
    getUseLeftHandedInput: function() {
      return void 0 === this._opt.leftHandedMouseSetup || this._opt.leftHandedMouseSetup
    },
    setReverseWheelDirection: function(t) {
      this.getViewer().setReverseWheelDirection(t)
    },
    enableHover: function(t) {
      this.getViewer().enableHover(t)
    },
    isolateComponentsByObjectData: function(t, e) {
      var i = this,
        n = i.getViewer(),
        o = n.getFilters(),
        r = i._adapter,
        a = r.getIsolateOptionValue(e);
      if (this._adapter.isDeprecatedEngine())
        o.setIsolateCondition(t),
        n.recalculationPlanes(),
        o.enableSceneOverrider(a);
      else {
        var s = {
          MakeOthersTranslucent: 3,
          HideOthers: 1
        };
        o.clearAllIsolateConditions(),
        t && o.setIsolateConditions(t, s[e])
      }
    },
    isolateComponentsById: function(t, e) {
      var i = this.getViewer(),
        n = i.getFilters(),
        o = this._adapter,
        r = o.getIsolateOptionValue(e);
      this._adapter.isDeprecatedEngine()
        ? (filters.setIsolateByUserIds(t), i.recalculationPlanes(), filters.enableSceneOverrider(r))
        : (n.clearAllIsolateList(), n.addToIsolateList(r, t))
    },
    clearIsolation: function() {
      var t = this.getViewer(),
        e = t.getFilters();
      this._adapter.isDeprecatedEngine()
        ? (e.setIsolateCondition(), e.enableSceneOverrider(0))
        : (e.clearAllIsolateConditions(), e.clearAllIsolateList())
    },
    hideComponents: function(t) {
      this.getViewer().getFilters().addToIdList(CLOUD.EnumIdBasedType.HIDDEN, t)
    },
    showComponents: function(t) {
      this.getViewer().getFilters().removeFromIdList(CLOUD.EnumIdBasedType.HIDDEN, t)
    },
    showExclusiveComponentsByObjectData: function(t) {
      var e = this.getViewer(),
        i = e.getFilters();
      this._adapter.isDeprecatedEngine()
        ? i.setVisibleConditions(t)
        : (
          i.clearAllConditions(), t && 0 == t.length
          ? i.hideScene()
          : (i.showScene(), i.setConditions(0, t)))
    },
    getCameraStatus: function() {
      return JSON.parse(this.getViewer().getCamera())
    },
    setCameraStatus: function(t) {
      "object" == (
        void 0 === t
        ? "undefined"
        : _typeof(t)) && (t = JSON.stringify(t)),
      this.exitWalk(),
      this.getViewer().setCamera(t)
    },
    highlightComponentsById: function(t, e, i) {
      if (!i)
        return !1;
      var n = this.getViewer().getFilters(),
        o = {
          Red: "red",
          Orange: "beforeEdit",
          Yellow: "yellow",
          Green: "green",
          Blue: "blue",
          Black: "black"
        };
      n.setOverriderByUserIds(i, t, o[e])
    },
    highlightComponentsByObjectData: function(t, e) {
      for (var i = this.getViewer().getFilters(), n = {
        Red: "red",
        Orange: "beforeEdit",
        Yellow: "yellow",
        Green: "green",
        Blue: "blue",
        Black: "black "
      }, o = [], r = 0, a = t.length; r < a; r++)
        o.push({condition: t[r], material: n[e]});
      i.setConditionOverrider(o)
    },
    setComponentsOpacity: function(t, e) {
      if (this._adapter.isDeprecatedEngine())
        console.log(n);
      else {
        var i = this.getViewer().getFilters();
        "Translucent" == e
          ? i.makeTranslucentByIds(t)
          : "Opaque" == e && i.removeFromIdList(CLOUD.EnumIdBasedType.TRANSLUCENT, t)
      }
    },
    loadViewCore: function(t) {
      if (this._data && this._data.renderVersion != t.renderVersion)
        return console.log("this model can not be added."),
        !1;
      var e = this,
        i = e.getViewer(),
        n = e._opt,
        o = e._engineAdapter(t.renderVersion),
        r = n.databagResource || "/" + t.databagId + "/resource/v3/model";
      if (i.load(r, n.resourceHost), e._adapter = o, t.isSupportFamilyTypeList) {
        var a = new Glodon.Bimface.Data.FamilyDataManagerConfig;
        a.databagId = t.databagId,
        a.resourceHost = e._opt.resourceHost;
        new Glodon.Bimface.Data.FamilyDataManager(a).getFamilyTypes(function(t) {
          e._data.familyTypes = t
        })
      }
      e.view[t.viewToken] = r
    },
    addModel: function(t) {
      if (this._data && this._data.renderVersion != t.renderVersion)
        return console.log("this model can not be added."),
        !1;
      var e = this,
        i = e.getViewer(),
        n = (e._opt, e._engineAdapter(t.renderVersion)),
        o = "./" + t.databagId + "/resource/v3/model";
      if (CLOUD.GlobalData.ZipResourcePostfix = "", t.dataEnvType = "Local", e._data = t, i.load(o, ""), e._adapter = n, t.isSupportFamilyTypeList) {
        var r = new Glodon.Bimface.Data.FamilyDataManagerConfig;
        r.databagId = t.databagId,
        r.resourceHost = e._opt.resourceHost;
        new Glodon.Bimface.Data.FamilyDataManager(r).getFamilyTypes(function(t) {
          e._data.familyTypes = t
        })
      }
      e.view[t.viewToken] = o
    },
    removeView: function(t) {
      var e = this.getViewer(),
        i = this.view[t];
      e.unload(i),
      delete this.view[t]
    },
    showView: function(t) {
      var e = this.getViewer(),
        i = e.modelManager.models,
        n = this.view[t];
      n && i[n] && e.showScene(i[n])
    },
    hideView: function(t) {
      var e = this.getViewer(),
        i = e.modelManager.models,
        n = this.view[t];
      n && i[n] && e.showScene(i[n], !1)
    },
    getSelectedComponents: function() {
      return this.getViewer().getFilters()._filterImpl._getSelected()
    },
    setSelectedComponentsById: function(t) {
      this.getViewer().setSelection(t)
    },
    addSelectedComponentsById: function(t) {
      this.getViewer().addToSelection(t)
    },
    removeSelectedId: function(t) {
      this.getViewer().removeFromSelection(t)
    },
    resize: function(t, e) {
      var i = this._opt.domElement,
        n = t || i.clientWidth,
        o = e || i.clientHeight;
      this.getViewer().resize(n, o)
    },
    setBackgroundColor: function(t) {
      var e = Glodon.Web.Graphics.Color,
        i = {
          Black: new e(0, 0, 0, 1),
          Blue: new e(0, 0, 189, 1),
          Green: new e(0, 255, 0, 1),
          Red: new e(255, 0, 0, 1),
          Yellow: new e(250, 189, 5, 1)
        },
        n = this._opt.domElement;
      "string" == typeof t && (t = n.style.backgroundColor = i[t]),
      n.style.backgroundColor = t.getRGBA()
    },
    getCurrentState: function() {
      return {state: this.getViewer().getFilters().saveState(), camera: this.getCameraStatus()}
    },
    setState: function(t) {
      var e = t.camera,
        i = this.getViewer();
      this.setCameraStatus(e),
      i.getFilters().loadState(t.state)
    },
    createSnapshot: function(t) {
      return console.warn("This function is deprecated. Please use createSnapshotAsync instead."),
      this.getViewer().canvas2image(t)
    },
    createSnapshotAsync: function(t, e) {
      var i = this,
        n = i.getViewer();
      if (i._adapter.isDeprecatedEngine()) {
        var o = n.getRenderBufferScreenShot(t.getRGBA());
        e && e(o),
        i.render()
      } else
        n.getRenderBufferScreenShot(t.getRGBA(), function(t) {
          e && e(t),
          i.render()
        })
    },
    section: function() {
      var t = this,
        e = this.getViewer(),
        i = e.getScene(),
        n = i.getClipPlanes();
      if (!t._section) {
        e.setClipPlanesMode();
        var o = e.editorManager.editors.clipByBox;
        n.enable(!0, !0),
        o.enablePick = !1,
        t._section = {
          visible: function(t) {
            n.visible = t,
            o.enablePick = !t
          },
          enableRotation: function(t) {
            n.rotatable = t
          },
          enable: function(i) {
            n.enable(i, i),
            i
              ? e.setClipPlanesMode()
              : t.setNavigationMode(Glodon.Bimface.Viewer.NavigationMode3D.PickWithRect)
          },
          reset: function() {
            n.rotatable = !1,
            n.visible = !0,
            o.enablePick = !1,
            n.reset()
          },
          close: function() {
            n.enable(!1, !1),
            t.setNavigationMode(Glodon.Bimface.Viewer.NavigationMode3D.PickWithRect),
            t._section = null
          },
          save: function() {
            return n.store()
          },
          load: function(t) {
            t
              ? n.restore(t)
              : n.reset(),
            n.restore(t)
          }
        }
      }
      return t._section
    },
    enableSectionBox: function() {
      var t = this,
        e = this.getViewer();
      e.getScene().getClipPlanes().enable(!0, !0),
      e.setClipPlanesMode(),
      t._isSection = !0
    },
    disableSectionBox: function() {
      var t = this;
      this.getViewer().getScene().getClipPlanes().enable(!1, !1),
      t.setNavigationMode(Glodon.Bimface.Viewer.NavigationMode3D.PickWithRect),
      t._isSection = !1
    },
    resetSectionBox: function() {
      if (!this._isSection)
        return void console.log(o);
      var t = this.getViewer(),
        e = t.getScene().getClipPlanes(),
        i = t.editorManager.editors.clipByBox;
      e.rotatable = !1,
      e.visible = !0,
      i.enablePick = !1,
      e.reset()
    },
    setSectionBoxMode: function(t) {
      if (!this._isSection)
        return void console.log(o);
      var e = this.getViewer(),
        i = e.getScene().getClipPlanes();
      i.rotatable = "Rotate" == t
    },
    showSectionBox: function() {
      if (!this._isSection)
        return void console.log(o);
      var t = this.getViewer(),
        e = t.getScene().getClipPlanes(),
        i = t.editorManager.editors.clipByBox;
      e.visible = !0,
      i.enablePick = !1
    },
    hideSectionBox: function() {
      if (!this._isSection)
        return void console.log(o);
      var t = this.getViewer(),
        e = t.getScene().getClipPlanes(),
        i = t.editorManager.editors.clipByBox;
      e.visible = !1,
      i.enablePick = !0
    },
    getSectionBoxState: function() {
      if (!this._isSection)
        return void console.log(o);
      return this.getViewer().getScene().getClipPlanes().store()
    },
    setSectionBoxState: function(t) {
      var e = this.getViewer(),
        i = e.getScene().getClipPlanes();
      t && i.restore(t)
    },
    getFamilyTypes: function() {
      var t = this._data.familyTypes;
      return t || !1
    },
    showFamilyTypeById: function(t) {
      var e = Glodon.Bimface.Viewer.IsolateOption;
      this.isolateComponentsByObjectData([
        {
          typeId: t
        }
      ], e.HideOthers)
    },
    getModelTree: function(t) {
      if (!this._MetaDataManager) {
        var e = Glodon.Bimface.Data,
          i = new e.MetaDataManagerConfig,
          n = this._data;
        i.APIHost = this._opt.APIHost,
        i.viewToken = n.viewToken,
        i.databagId = n.databagId,
        i.modelId = n.modelId,
        i.modelType = n.modelType,
        i.dataEnvType = n.dataEnvType,
        this._MetaDataManager = new e.MetaDataManager(i)
      }
      this._MetaDataManager.getModelTree(t)
    },
    getModeTree: function(t) {
      console.warn("This function is deprecated. Please use getModelTree instead."),
      this.getModelTree(t)
    },
    getComponentProperty: function(t, e) {
      if (!this._MetaDataManager) {
        var i = Glodon.Bimface.Data,
          n = new i.MetaDataManagerConfig,
          o = this._data;
        n.APIHost = this._opt.APIHost,
        n.viewToken = o.viewToken,
        n.databagId = o.databagId,
        n.modelId = o.modelId,
        n.modelType = o.modelType,
        n.dataEnvType = o.dataEnvType,
        this._MetaDataManager = new i.MetaDataManager(n)
      }
      this._MetaDataManager.getComponentProperty(t, e)
    },
    showViewHouse: function() {
      var t = this;
      if (t._viewHouse)
        t._viewHouse.enableViewHouse(!0);
      else {
        var e = t._opt,
          i = Glodon.Bimface.Plugins.ViewHouseConfig();
        i.domElement = e.domElement,
        i.viewer = t,
        t._viewHouse = new Glodon.Bimface.Plugins.ViewHouse(i)
      }
    },
    hideViewHouse: function() {
      this._viewHouse && this._viewHouse.enableViewHouse(!1)
    },
    startAutoRotate: function(t) {
      function e() {
        o.rotateLeft(),
        o.updateAuto(),
        i._animationFrameHandle = requestAnimationFrame(e)
      }
      var i = this,
        n = this.getViewer(),
        o = i._adapter.getCameraControl(n);
      return null == o
        ? void console.log("Auto-rotate is not supported.")
        : (
          o.autoRotateSpeed = t, 0 == t
          ? void i.stopAutoRotate()
          : (i._animationFrameHandle && i.stopAutoRotate(), void e()))
    },
    stopAutoRotate: function() {
      this._animationFrameHandle && cancelAnimationFrame(this._animationFrameHandle)
    },
    overrideComponentsColorById: function(t, e) {
      var i = this.getViewer().getFilters();
      if (this._adapter.isDeprecatedEngine())
        console.log(n);
      else {
        for (var o = this._colorOverridedMap, r = this._colorOverridedList, a = e.getHEX() + (100 * e.getAlpha()).toString(16), s = 0, l = t.length; s < l; s++) {
          var c = t[s],
            h = r.getObjectByAttribute("id", c);
          if (h) {
            var u = o[h.color];
            u && u.removeByValue(c),
            i.removeFromOverrideList(h.color, [c]),
            h.color = a
          } else
            r.push({id: c, color: a})
        }
        o[a] || (o[a] = []),
        o[a] = o[a].concat(t),
        o[a] = Array.from(new Set(o[a])),
        i.setOverrideListByColor(a, o[a], {
          color: parseInt(e.getHEX(), 16),
          opacity: e.getAlpha()
        })
      }
    },
    restoreComponentsColorById: function(t) {
      var e = this.getViewer().getFilters();
      if (this._adapter.isDeprecatedEngine())
        console.log(n);
      else
        for (var i = this._colorOverridedMap, o = this._colorOverridedList, r = 0, a = t.length; r < a; r++) {
          var s = t[r],
            l = o.getObjectByAttribute("id", s);
          if (l) {
            var c = i[l.color];
            c && c.removeByValue(s),
            e.removeFromOverrideList(l.color, [s]),
            o.removeObjectByAttribute("id", s)
          }
        }
      },
    overrideComponentsColorByObjectData: function(t, e) {
      var i = this.getViewer().getFilters(),
        o = this._adapter.isDeprecatedEngine(),
        r = [];
      e.getHEX(),
      (100 * e.getAlpha()).toString(16);
      if (o)
        console.log(n);
      else {
        for (var a = 0, s = t.length; a < s; a++)
          r.push({
            condition: t[a],
            color: {
              color: parseInt(e.getHEX(), 16),
              opacity: e.getAlpha()
            }
          });
        i.setConditions(2, r)
      }
    },
    restoreComponentsColorByObjectData: function() {
      var t = this.getViewer().getFilters();
      this._adapter.isDeprecatedEngine()
        ? console.log(n)
        : t.clearConditions(2)
    },
    disableComponentsSelectionById: function(t) {
      this.getViewer().getFilters().addToFrozenList(t)
    },
    enableComponentsSelectionById: function(t) {
      this.getViewer().getFilters().removeFromFrozenList(t)
    },
    isIsolate: function() {
      return this.getViewer().getFilters().isIsolate()
    },
    isFiltering: function() {
      return this.getViewer().getFilters().isFiltering()
    },
    worldToClient: function(t) {
      return this.getViewer().worldToCanvas(t)
    },
    clientToWorld: function(t) {
      return this.getViewer().canvasToWorld(t)
    },
    hitTest: function(t, e) {
      this.getViewer().pickByPointWithNormal(t, function(i) {
        if (i) {
          var n = i[0],
            o = {
              objectId: n.userId,
              boundingBox: n.worldBoundingBox,
              worldPosition: n.worldPosition,
              clientPosition: t
            };
          e && e(o)
        }
      })
    },
    isInViewFrustum: function(t) {
      return this.getViewer().insideCamera(t)
    },
    lockAxis: function(t) {
      if ("Z" != t)
        return void console.warn("The API supports AxisOption.Z only for now.");
      this.getViewer().lockAxisZ(!0)
    },
    unlockAxis: function(t) {
      if ("Z" != t)
        return void console.warn("The API supports AxisOption.Z only for now.");
      this.getViewer().lockAxisZ(!1)
    },
    enableMouseHoverHighlight: function() {
      this.getViewer().enableHover(!0)
    },
    disableMouseHoverHighlight: function() {
      this.getViewer().enableHover(!1)
    },
    setOverallLightIntensity: function(t) {
      this.getViewer().setLightIntensityFactor(t)
    },
    getOverallLightIntensity: function(t) {
      return CLOUD.GlobalData.LightIntensityFactor
    },
    moveTo: function(t) {
      var e = CLOUD.MoveDirection,
        e = {
          Up: CLOUD.MoveDirection.UP,
          Down: CLOUD.MoveDirection.DOWN,
          Left: CLOUD.MoveDirection.LEFT,
          Right: CLOUD.MoveDirection.RIGHT,
          Forward: CLOUD.MoveDirection.FORWARD,
          Back: CLOUD.MoveDirection.BACK
        };
      this.getViewer().moveTo(e[t])
    },
    getInformation: function() {
      var t = this.getViewer();
      return {elements: t.getNumOfElements(), renderables: t.getNumOfRenderables(), triangles: t.getNumOfTriangles()}
    },
    _beforeInitialize: function(t) {
      CLOUD.GlobalData.LimitFrameTime = 1e3 / t.minimumFPS,
      CLOUD.GlobalData.EnableDemolishByDClick = !1,
      CLOUD.GlobalData.DisableRotation = t.rotation,
      CLOUD.GlobalData.UseMpkWorker = !1,
      CLOUD.GlobalData.ZipResourcePostfix = t.suffix,
      CLOUD.GlobalData.LightIntensityFactor = 1.2
    },
    _config: function(t) {
      var e = this.getViewer(),
        i = {
          Left: "left",
          Right: "right"
        },
        n = {
          Home: 0,
          Top: 1,
          Bottom: 2,
          North: 3,
          South: 4,
          West: 5,
          East: 6,
          SouthEast: 7,
          SouthWest: 8,
          NorthEast: 9,
          NorthWest: 10
        };
      try {
        e.setInitialView(n[t.initialViewOption]),
        e.setHomeView(n[t.homeViewOption])
      } catch (i) {
        e.setInitialViewType(t.initialViewOption),
        e.setHomeViewType(t.homeViewOption)
      }
      e.setOrbitButton(i[t.orbitButton])
    },
    _engineAdapter: function(t) {
      var e = {
          getIsolateOptionValue: function(t) {
            return {MakeOthersTranslucent: 3, HideOthers: 1}[t]
          },
          getDataBagResource: function() {
            return "/resource/v3/model"
          },
          getCameraControl: function(t) {
            return t.cameraControl
          },
          setIsolateConditions: function() {
            return "setConditions"
          },
          isDeprecatedEngine: function() {
            return !1
          }
        },
        i = {
          getIsolateOptionValue: function(t) {
            return {MakeOthersTranslucent: 1, HideOthers: 2}[t]
          },
          getDataBagResource: function() {
            return "/resource/model"
          },
          getCameraControl: function(t) {
            return null
          },
          setIsolateConditions: function() {
            return "setIsolateCondition"
          },
          isDeprecatedEngine: function() {
            return !0
          }
        };
      return "1.0" == t
        ? i
        : e
    }
  }),
  t.Viewer3D = r
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins"),
    e = function() {
      return {
        name: "defaultMap",
        domElement: null,
        width: 240,
        height: 240,
        viewer: null,
        axis: !1,
        host: "https://m.bimface.com",
        onCameraChanged: null,
        inMoveOnAxisGrid: null
      }
    };
  t.MiniMapConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest")),
    i = function(t) {
      var e = this,
        i = t;
      if (e._opt = i, !i.domElement)
        return console.log("domElement must be empty."),
        !1;
      if (!i.viewer)
        return console.log("viewer is not defined."),
        !1;
      var n = i.viewer.getViewer();
      e._helper = new CLOUD.Extensions.MiniMapHelper(i.viewer.getViewer());
      var o = function() {
        e._helper.renderMiniMap()
      };
      n.addCallbacks("render", o),
      e.init()
    };
  i.prototype = {
    init: function() {
      var t = this,
        i = t._opt,
        n = {},
        o = [],
        r = t._helper;
      if (e.ajax({
        url: i.host + "/" + i.viewer._data.databagId + "/metadata/grids.json",
        async: !1,
        success: function(t) {
          for (var e = JSON.parse(t), i = [], o = 0, r = e.grids.length; o < r; o++) {
            var a = e.grids[o];
            a.start.X = a.start.x,
            a.start.Y = a.start.y,
            a.start.Z = a.start.z,
            a.end.X = a.end.x,
            a.end.Y = a.end.y,
            a.end.Z = a.end.z,
            i.push(a)
          }
          n.Grids = i
        }
      }), e.ajax({
        async: !1,
        url: i.host + "/" + i.viewer._data.databagId + "/metadata/levels.json",
        success: function(t) {
          n.Levels = JSON.parse(t).levels
        }
      }), e.ajax({
        async: !1,
        url: i.host + "/" + i.viewer._data.databagId + "/resource/model/maps/output.json",
        dataType: "text",
        success: function(t) {
          var e = JSON.parse(t);
          for (var n in e) {
            var r = e[n];
            r.path = i.host + "/" + i.viewer._data.databagId + "/resource/model/maps/" + n + ".png",
            r.id = n,
            r.name = n,
            o.push(r)
          }
        }
      }), !n.Grids || !n.Levels)
        return i.domElement.innerHTML = '<p class="bf-message">axis grids not found.</p>',
        !1;
      r.setAxisGridData(n),
      o.length > 0 && r.setFloorPlaneData(o[0]),
      t._floors = o,
      t.createMap()
    },
    createMap: function(t, e) {
      var i,
        n = this._helper,
        o = this._opt,
        r = {
          left: 0,
          bottom: 0,
          outling: "none",
          position: "relative"
        };
      n.createMiniMap(o.name, o.domElement, o.width, o.height, r, o.onCameraChanged, o.inMoveOnAxisGrid),
      n.generateAxisGrid(o.name),
      n.generateFloorPlane(o.name, !1),
      n.showAxisGrid(o.name, o.axis),
      i = n.getMiniMap(o.name),
      i.setMapClickCallback(function() {})
    },
    getFloors: function() {
      return this._floors
    },
    showAxisGrid: function() {
      this._helper.showAxisGrid(this._opt.name, !0)
    },
    hideAxisGrid: function() {
      this._helper.showAxisGrid(this._opt.name, !1)
    },
    showFloorById: function(t) {
      var e = this,
        i = e._opt.name,
        n = e._floors,
        o = n.getObjectByAttribute("name", t);
      e._helper.setFloorPlaneData(o),
      e._helper.generateFloorPlane(i, !0)
    },
    resize: function(t, e) {
      this._helper.resize(this._opt.name, t, e)
    },
    onClick: function(t, e) {
      var i = this,
        n = i._opt,
        t = t || "default",
        o = i._helper.getMiniMap(n.name);
      o.setMapClickMode(t),
      o.setMapClickCallback(function(t) {
        e && "function" == typeof e && e(t)
      })
    },
    toLocation: function(t, e) {
      var i = this,
        n = i._opt;
      i._helper.getMiniMap(n.name).toLocation(t, e)
    },
    imageCoord2WordCoord: function(t, e) {
      var i = this,
        n = i._opt;
      return i._helper.getMiniMap(n.name).imageCoord2WordCoord(_defineProperty({
        x: t
      }, "x", e))
    }
  },
  t.MiniMap = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Map"),
    e = function() {
      return {
        id: "defaultMap",
        domElement: null,
        viewer: null,
        width: 240,
        height: 240,
        isShowGrid: !1,
        navigationMode: "Default",
        resourceHost: "https://m.bimface.com"
      }
    };
  t.MapConfig = e
}(),
function() {
  var t = Object.freeze({ViewerCameraChanged: "ViewerCameraChanged", MouseClicked: "MouseClicked", MouseHoveredGrid: "MouseHoveredGrid"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Map").MapEvents = t
}(),
function() {
  var t = Object.freeze({Default: "Default", Static: "Static"});
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Map").MapNavigationMode = t
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Map"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest")),
    i = function(t) {
      var e = this,
        i = t;
      if (e._opt = i, !i.domElement)
        return console.log("domElement must be empty."),
        !1;
      if (!i.viewer)
        return console.log("viewer is not defined."),
        !1;
      var n = new Glodon.Web.Lang.EventManager;
      this.getEventManager = function() {
        return n
      };
      var o = i.viewer.getViewer();
      e._helper = new CLOUD.Extensions.MiniMapHelper(i.viewer.getViewer());
      var r = function() {
        e._helper.renderMiniMap()
      };
      o.addCallbacks("render", r),
      e.init()
    };
  i.prototype = {
    addEventListener: function(t, e) {
      this.getEventManager().addEvent(t, e)
    },
    removeEventListener: function(t, e) {
      this.getEventManager().removeEvent(t, e)
    },
    init: function() {
      var t = this,
        i = t._opt,
        n = {},
        o = [],
        r = t._helper;
      if (e.ajax({
        url: i.resourceHost + "/" + i.viewer._data.databagId + "/metadata/grids.json",
        async: !1,
        success: function(t) {
          for (var e = JSON.parse(t), i = [], o = 0, r = e.grids.length; o < r; o++) {
            var a = e.grids[o];
            a.start.X = a.start.x,
            a.start.Y = a.start.y,
            a.start.Z = a.start.z,
            a.end.X = a.end.x,
            a.end.Y = a.end.y,
            a.end.Z = a.end.z,
            i.push(a)
          }
          n.Grids = i
        }
      }), e.ajax({
        async: !1,
        url: i.resourceHost + "/" + i.viewer._data.databagId + "/metadata/levels.json",
        success: function(t) {
          n.Levels = JSON.parse(t).levels
        }
      }), e.ajax({
        async: !1,
        url: i.resourceHost + "/" + i.viewer._data.databagId + "/resource/model/maps/output.json",
        dataType: "text",
        success: function(t) {
          var e = JSON.parse(t);
          for (var n in e) {
            var r = e[n];
            r.path = i.resourceHost + "/" + i.viewer._data.databagId + "/resource/model/maps/" + n + ".png",
            r.id = n,
            r.name = n,
            o.push(r)
          }
        }
      }), !n.Grids || !n.Levels)
        return i.domElement.innerHTML = '<p class="bf-message">axis grids not found.</p>',
        !1;
      r.setAxisGridData(n),
      o.length > 0 && r.setFloorPlaneData(o[0]),
      t._floors = o,
      t.createMap()
    },
    createMap: function(t, e) {
      var i,
        n = this,
        o = n.getEventManager(),
        r = Glodon.Bimface.Plugins.Map.MapEvents,
        a = (Glodon.Bimface.Plugins.Map.MapNavigationMode, n._helper),
        s = n._opt,
        l = {
          left: 0,
          bottom: 0,
          outling: "none",
          position: "relative"
        },
        c = function(t) {
          o.fireEvent(r.ViewerCameraChanged, t)
        },
        h = function(t) {
          o.fireEvent(r.MouseHoveredGrid, t)
        },
        u = function(t) {
          o.fireEvent(r.MouseClicked, t)
        };
      a.createMiniMap(s.name, s.domElement, s.width, s.height, l, c, h),
      a.generateAxisGrid(s.name),
      a.generateFloorPlane(s.name, !1),
      a.showAxisGrid(s.name, s.isShowGrid),
      i = a.getMiniMap(s.name),
      i.setMapClickMode(s.navigationMode.toLocaleLowerCase()),
      i.setMapClickCallback(function(t) {
        u(t)
      })
    },
    getFloorList: function() {
      return this._floors
    },
    showGrid: function() {
      this._helper.showAxisGrid(this._opt.name, !0)
    },
    hideGrid: function() {
      this._helper.showAxisGrid(this._opt.name, !1)
    },
    showFloorById: function(t) {
      var e = this,
        i = e._opt.name,
        n = e._floors,
        o = n.getObjectByAttribute("name", t);
      e._helper.setFloorPlaneData(o),
      e._helper.generateFloorPlane(i, !0)
    },
    resize: function(t, e) {
      this._helper.resize(this._opt.name, t, e)
    },
    setNavigationMode: function(t) {
      var e = this._opt,
        i = this._helper,
        n = i.getMiniMap(e.name);
      e.navigationMode = t,
      n.setMapClickMode(e.navigationMode.toLocaleLowerCase())
    },
    clientCoord2WorldCoord: function(t, e) {
      var i = this,
        n = i._opt;
      return i._helper.getMiniMap(n.name).imageCoord2WordCoord({x: t, y: e})
    }
  },
  t.Map = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins"),
    e = function() {
      return {domElement: null, viewer: null}
    };
  t.ViewHouseConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest"), function(t) {
      this._opt = t,
      this.init()
    });
  e.prototype = {
    init: function() {
      var t = this,
        e = t._opt,
        i = e.viewer.getViewer(),
        n = new CLOUD.ViewHouse(i, function() {
          var t = document.querySelector(".gld-bf-firstperson.bf-checked");
          return t && t.click(),
          !0
        });
      n.init(e.domElement),
      n.render(),
      t._viewHouse = n,
      i.addRenderCallback(function() {
        n.render()
      })
    },
    enableViewHouse: function(t) {
      var e = this,
        i = e._viewHouse;
      t
        ? i.enable()
        : i.disable()
    }
  },
  t.ViewHouse = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins"),
    e = function() {
      return {
        background: null,
        domElement: null,
        viewer: null,
        style: {
          "stroke-width": 3,
          "stroke-color": "#ff0000",
          "stroke-opacity": 1,
          "fill-color": "#ff0000",
          "fill-opacity": 0,
          "font-family": "Arial",
          "font-size": 16,
          "font-style": "italic",
          "font-weight": "bold"
        }
      }
    };
  t.AnnotationConfig = e
}(),
function() {
  var t = Object.freeze({
    Arrow: "Arrow",
    Rectangle: "Rectangle",
    Circle: "Circle",
    Cross: "Cross",
    Cloud: "Cloud",
    Text: "Text"
  });
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins").AnnotationTypeOption = t
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest"), function(t) {
      this._opt = t,
      this.init()
    });
  e.prototype = {
    init: function() {
      var t,
        e = this,
        i = e._opt;
      if (i.viewer)
        t = new CLOUD.Extensions.AnnotationHelper3D(i.viewer.getViewer());
      else {
        if (!i.domElement)
          return alert("domElement must not be empty."),
          !1;
        t = new CLOUD.Extensions.AnnotationHelper2D,
        t.setDomContainer(i.domElement)
      }
      this._helper = t
    },
    begin: function() {
      var t = this._helper,
        e = this._opt;
      t.editAnnotationBegin(e.absBasePoint, e.screenBasePoint, e.zoomFactor)
    },
    end: function() {
      this._helper.editAnnotationEnd()
    },
    save: function() {
      return this._helper.getAnnotationInfoList()
    },
    createSnapshot: function(t, e) {
      return this._helper.captureAnnotationsScreenSnapshot(t, e)
    },
    load: function(t) {
      var e = this._helper;
      this._opt;
      e.loadAnnotations(t)
    },
    setType: function(t) {
      var e = {
        arrow: 0,
        rectangle: 1,
        circle: 2,
        cross: 3,
        cloud: 4,
        text: 5
      };
      this._helper.setAnnotationType(e[t.toLocaleLowerCase()])
    },
    setStyle: function(t) {
      this._helper.setAnnotationStyle(t)
    },
    destroy: function() {
      this._helper.destroy()
    }
  },
  t.Annotation = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Annotation"),
    e = function() {
      return {
        viewer: null,
        lineWidth: 3,
        lineColor: new Glodon.Web.Graphics.Color(208, 2, 27, 1),
        fillColor: new Glodon.Web.Graphics.Color(255, 255, 255, 0),
        fontFamily: "Arial",
        fontSize: 16
      }
    };
  t.AnnotationManagerConfig = e
}(),
function() {
  var t = Object.freeze({
    Arrow: "Arrow",
    Rectangle: "Rectangle",
    Circle: "Circle",
    Cross: "Cross",
    Cloud: "Cloud",
    Text: "Text"
  });
  Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Annotation").AnnotationTypeOption = t
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Annotation"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest"), function(t) {
      var e = this,
        i = t.viewer,
        n = i instanceof Glodon.Bimface.Viewer.Viewer3D;
      if (this._opt = t, this.isView3D = n, this.isShowAnnotation = !1, this.historyQueue = [], this.init(), !n) {
        var o = Glodon.Bimface.Viewer.Viewer2DEvent;
        i.addEventListener(o.ViewMoving, function(t) {
          e.updateSvg()
        }),
        i.addEventListener(o.ViewZooming, function(t) {
          e.updateSvg(t.zoomScale)
        })
      }
    });
  e.prototype = {
    init: function() {
      var t,
        e = this,
        i = e._opt;
      e.isView3D
        ? t = new CLOUD.Extensions.AnnotationHelper3D(i.viewer.getViewer(), i)
        : (t = new CLOUD.Extensions.AnnotationHelper2D(i), t.setDomContainer(i.viewer.getDomElement())),
      this._helper = t
    },
    startDrawing: function() {
      var t = this._helper,
        e = this._opt;
      if (t.editAnnotationBegin(), !this.isView3D) {
        var i = e.viewer.getZoomScale();
        t.setZoomFactor(i);
        t.editor.svg.addEventListener("mousewheel", function(t) {
          t.preventDefault(),
          t.stopPropagation()
        })
      }
      this.isShowAnnotation = !0
    },
    endDrawing: function() {
      this._helper.editAnnotationEnd(),
      this.isShowAnnotation = !1
    },
    getAnnotationList: function() {
      var t = this,
        e = this._helper.getAnnotationInfoList();
      if (!t.isView3D && e && e.length > 0)
        for (var i = t._opt.viewer, n = i.getZoomScale(), o = 0, r = e.length; o < r; o++)
          e[o].worldPosition = t.getWorldPosition(e[o]),
          e[o].defaultSize = {
            width: e[o].size.width / n,
            height: e[o].size.height / n
          };
    return e
    },
    setAnnotationList: function(t) {
      if (!t || 0 == t.length)
        return !1;
      if (!this.isView3D)
        for (var e = this._opt.viewer.getZoomScale(), i = 0, n = t.length; i < n; i++)
          t[i].position = this.getSVGPosition(t[i], e),
          t[i].size.width = t[i].defaultSize.width * e,
          t[i].size.height = t[i].defaultSize.height * e;
    this._annotationList = t,
      this._helper.loadAnnotations(t),
      this.isShowAnnotation = !0
    },
    clear: function() {
      this.setAnnotationList([]),
      this._helper.clearAnnotations()
    },
    createSnapshot: function(t) {
      var e = this,
        i = e._opt.viewer;
      i instanceof Glodon.Bimface.Viewer.Viewer3D
        ? e._helper.captureAnnotationsScreenSnapshot("", t)
        : i.createSnapshotAsync("", function(i) {
          e._helper.captureAnnotationsScreenSnapshot(i, t)
        })
    },
    resize: function() {
      this._helper.resizeAnnotations()
    },
    setAnnotationType: function(t) {
      var e = {
        arrow: 0,
        rectangle: 1,
        circle: 2,
        cross: 3,
        cloud: 4,
        text: 5
      };
      this._helper.setAnnotationType(e[t.toLocaleLowerCase()])
    },
    setLineWidth: function(t) {
      this._helper.setAnnotationStyle({"stroke-width": t})
    },
    setLineColor: function(t) {
      this._helper.setAnnotationStyle({
        "stroke-color": "#" + t.getHEX(),
        "stroke-opacity": t.getAlpha()
      })
    },
    setFillColor: function(t) {
      this._helper.setAnnotationStyle({
        "fill-color": "#" + t.getHEX(),
        "fill-opacity": t.getAlpha()
      })
    },
    setFontFamily: function(t) {
      this._helper.setAnnotationStyle({"font-family": t})
    },
    setFontSize: function(t) {
      this._helper.setAnnotationStyle({"font-size": t})
    },
    setStyle: function(t) {
      this._helper.setAnnotationStyle(t)
    },
    destroy: function() {
      this._helper.destroy()
    },
    getCurrentState: function() {
      var t = this,
        e = t._opt.viewer,
        i = {
          annotationList: t.getAnnotationList()
        };
      return t.isView3D
        ? i.state = e.getCameraStatus()
        : i.state = e.getCurrentState(),
      i
    },
    setState: function(t) {
      var e = this,
        i = e._opt.viewer;
      e.isView3D
        ? i.setCameraStatus(t.state)
        : i.setState(t.state),
      e.setAnnotationList(t.annotationList)
    },
    updateSvg: function() {
      var t = this,
        e = this._annotationList,
        i = t._opt.viewer.getZoomScale();
      if (!e || 0 == e.length)
        return !1;
      for (var n = 0, o = e.length; n < o; n++)
        e[n].position = t.getSVGPosition(e[n], i),
        e[n].size.width = e[n].defaultSize.width * i,
        e[n].size.height = e[n].defaultSize.height * i;
      this.isShowAnnotation && this.setAnnotationList(e)
    },
    getWorldPosition: function(t) {
      var e = this._opt.viewer,
        i = e._dwgViewer.getViewInfo();
      origin = {
        x: i.view.width / 2,
        y: i.view.height / 2
      };
      var n = {
        x: origin.x + t.position.x,
        y: origin.y - t.position.y
      };
      return e.clientToWorld(n)
    },
    getSVGPosition: function(t, e) {
      var i = this._opt.viewer,
        n = i._dwgViewer.getViewInfo(),
        o = {
          x: n.view.width / 2,
          y: n.view.height / 2
        },
        r = i.worldToClient(t.worldPosition);
      n.scene.scale;
      return {
        x: r.x - o.x,
        y: o.y - r.y
      }
    },
    revoke: function() {}
  },
  t.AnnotationManager = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Annotation"),
    e = function() {};
  t.AnnotationToolbarConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Annotation"),
    e = Object.freeze({Saved: "Saved", Cancelled: "Cancelled"});
  t.AnnotationToolbarEvent = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Annotation"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest"), Glodon.Bimface.Plugins.Annotation.AnnotationToolbarEvent),
    n = function(t) {
      var n = this._eventManager = new Glodon.Web.Lang.EventManager,
        o = [],
        r = t.viewer,
        a = e.create("div", "bf-annotation bf-hide");
      this.domElement = a;
      var s = Glodon.Bimface.Plugins.Annotation.AnnotationTypeOption,
        l = new Glodon.Bimface.Plugins.Annotation.AnnotationManagerConfig,
        c = l.lineColor;
      l.viewer = r,
      l.annotationCallback = t.annotationCallback;
      var h = this._annotationManager = new Glodon.Bimface.Plugins.Annotation.AnnotationManager(l);
      r.getDomElement().appendChild(a);
      var u = new Glodon.Bimface.UI.Toolbar.ToolbarConfig;
      u.element = a,
      u.className = "bf-toolbar bf-toolbar-annotation";
      var d = new Glodon.Bimface.UI.Toolbar.Toolbar(u);
      o.push(d);
      var p = new Glodon.Bimface.UI.Toolbar.ToolbarConfig;
      p.element = a,
      p.className = "bf-toolbar bf-toolbar-control";
      var f = new Glodon.Bimface.UI.Toolbar.Toolbar(p);
      o.push(f);
      var m = new Glodon.Bimface.UI.Button.ButtonConfig;
      m.className = "bf-button gld-bf-narrow",
      m.title = "",
      m.groupName = "Annotation";
      var g = new Glodon.Bimface.UI.Button.SingleButton(m);
      g.addEventListener("Click", function() {
        h.setAnnotationType(s.Arrow),
        F.show(),
        Y.hide()
      }),
      d.addControl(g);
      var v = new Glodon.Bimface.UI.Button.ButtonConfig;
      v.className = "bf-button gld-bf-nrectangle",
      v.title = "",
      v.groupName = "Annotation";
      var y = new Glodon.Bimface.UI.Button.SingleButton(v);
      y.addEventListener("Click", function() {
        h.setAnnotationType(s.Rectangle),
        F.show(),
        Y.hide()
      }),
      d.addControl(y);
      var E = new Glodon.Bimface.UI.Button.ButtonConfig;
      E.className = "bf-button gld-bf-noval",
      E.title = "",
      E.groupName = "Annotation";
      var x = new Glodon.Bimface.UI.Button.SingleButton(E);
      x.addEventListener("Click", function() {
        h.setAnnotationType(s.Circle),
        F.show(),
        Y.hide()
      }),
      d.addControl(x);
      var b = new Glodon.Bimface.UI.Button.ButtonConfig;
      b.className = "bf-button gld-bf-mark",
      b.title = "X",
      b.groupName = "Annotation";
      var w = new Glodon.Bimface.UI.Button.SingleButton(b);
      w.addEventListener("Click", function() {
        h.setAnnotationType(s.Cross),
        F.show(),
        Y.hide()
      }),
      d.addControl(w);
      var C = new Glodon.Bimface.UI.Button.ButtonConfig;
      C.className = "bf-button gld-bf-ntext",
      C.title = "",
      C.groupName = "Annotation";
      var T = new Glodon.Bimface.UI.Button.SingleButton(C);
      T.addEventListener("Click", function() {
        h.setAnnotationType(s.Text),
        F.hide(),
        Y.show()
      }),
      d.addControl(T);
      var _ = new Glodon.Bimface.UI.Button.ButtonConfig;
      _.className = "bf-button bf-color",
      _.title = "";
      var L = new Glodon.Bimface.UI.Button.ComboBox(_),
        M = new Glodon.Bimface.UI.Button.ButtonConfig;
      M.className = "bf-button bf-color",
      M.title = "";
      var S = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(M);
      S.color = new Glodon.Web.Graphics.Color(208, 2, 27, 1);
      var O = e.create("div", "bf-color-button");
      O.setCss({
        backgroundColor: "#" + S.color.getHEX()
      }),
      S.setHtml(O.outerHTML),
      L.addControl(S);
      var D = new Glodon.Bimface.UI.Button.ButtonConfig;
      D.className = "bf-button bf-color",
      D.title = "";
      var R = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(D);
      R.color = new Glodon.Web.Graphics.Color(245, 166, 35, 1);
      var U = e.create("div", "bf-color-button");
      U.setCss({
        backgroundColor: "#" + R.color.getHEX()
      }),
      R.setHtml(U.outerHTML),
      L.addControl(R);
      var A = new Glodon.Bimface.UI.Button.ButtonConfig;
      A.className = "bf-button bf-color",
      A.title = "";
      var I = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(A);
      I.color = new Glodon.Web.Graphics.Color(74, 144, 226, 1);
      var P = e.create("div", "bf-color-button");
      P.setCss({
        backgroundColor: "#" + I.color.getHEX()
      }),
      I.setHtml(P.outerHTML),
      L.addControl(I);
      var B = new Glodon.Bimface.UI.Button.ButtonConfig;
      B.className = "bf-button bf-color",
      B.title = "";
      var N = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(B);
      N.color = new Glodon.Web.Graphics.Color(126, 211, 33, 1);
      var k = e.create("div", "bf-color-button");
      k.setCss({
        backgroundColor: "#" + N.color.getHEX()
      }),
      N.setHtml(k.outerHTML),
      L.addControl(N),
      d.addControl(L);
      var H = new Glodon.Bimface.UI.Button.ButtonConfig;
      H.className = "bf-button",
      H.title = "";
      var F = new Glodon.Bimface.UI.Button.ComboBox(H),
        H = new Glodon.Bimface.UI.Button.ButtonConfig;
      H.className = "bf-button bf-line",
      H.title = "";
      var G = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(H);
      G.lineWidth = 2;
      var V = e.create("div", "bf-line-button");
      V.setCss({
        height: G.lineWidth + "px",
        backgroundColor: "#" + c.getHEX(),
        margin: (32 - G.lineWidth) / 2 + "px 4px"
      }),
      G.element.appendChild(V),
      F.addControl(G),
      H.title = "";
      var z = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(H);
      z.lineWidth = 6;
      var q = e.create("div", "bf-line-button");
      q.setCss({
        height: z.lineWidth + "px",
        backgroundColor: "#" + c.getHEX(),
        margin: (32 - z.lineWidth) / 2 + "px 4px"
      }),
      z.element.appendChild(q),
      F.addControl(z),
      H.title = "";
      var W = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(H);
      W.lineWidth = 10;
      var j = e.create("div", "bf-line-button");
      j.setCss({
        height: W.lineWidth + "px",
        backgroundColor: "#" + c.getHEX(),
        margin: (32 - W.lineWidth) / 2 + "px 4px"
      }),
      W.element.appendChild(j),
      F.addControl(W),
      L.addEventListener("Change", function(t) {
        h.setLineColor(t.color),
        c = t.color;
        c.getHEX();
        V.setCss({
          height: G.lineWidth + "px",
          backgroundColor: "#" + c.getHEX(),
          margin: (32 - G.lineWidth) / 2 + "px 4px"
        }),
        q.setCss({
          height: z.lineWidth + "px",
          backgroundColor: "#" + c.getHEX(),
          margin: (32 - z.lineWidth) / 2 + "px 4px"
        }),
        j.setCss({
          height: W.lineWidth + "px",
          backgroundColor: "#" + c.getHEX(),
          margin: (32 - W.lineWidth) / 2 + "px 4px"
        });
        var e = F.getCurrentControl();
        F.setSelectedControlById(e.getId())
      }),
      F.addEventListener("Change", function(t) {
        h.setLineWidth(t.lineWidth)
      }),
      d.addControl(F);
      var X = new Glodon.Bimface.UI.Button.ButtonConfig;
      X.className = "bf-button bf-font-button",
      X.title = "";
      var Y = new Glodon.Bimface.UI.Button.ComboBox(X),
        Z = new Glodon.Bimface.UI.Button.ButtonConfig;
      Z.className = "bf-button bf-size",
      Z.title = "14";
      var K = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(Z);
      K.fontSize = 14,
      K.setHtml("14"),
      Y.addControl(K),
      Z.title = "18";
      var Q = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(Z);
      Q.fontSize = 18,
      Q.setHtml("18"),
      Y.addControl(Q),
      Z.title = "24";
      var J = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(Z);
      J.fontSize = 24,
      J.setHtml("24"),
      Y.addControl(J),
      Y.addEventListener("Change", function(t) {
        h.setFontSize(t.fontSize)
      }),
      Y.hide(),
      d.addControl(Y);
      var $ = new Glodon.Bimface.UI.Button.ButtonConfig;
      $.className = "bf-save",
      $.title = "";
      var tt = new Glodon.Bimface.UI.Button.SingleButton($);
      tt.setHtml(""),
      tt.addEventListener("Click", function() {
        h.endDrawing(),
        a.addClass("bf-hide"),
        n.fireEvent(i.Saved, {
          annotationList: h.getAnnotationList(),
          state: h.getCurrentState()
        })
      }),
      f.addControl(tt);
      var et = new Glodon.Bimface.UI.Button.ButtonConfig;
      et.className = "bf-cancel",
      et.title = "";
      var it = new Glodon.Bimface.UI.Button.SingleButton(et);
      it.setHtml(""),
      it.addEventListener("Click", function() {
        h.endDrawing(),
        a.addClass("bf-hide"),
        n.fireEvent(i.Cancelled)
      }),
      f.addControl(it),
      this.getEventManager = function() {
        return n
      }
    };
  n.prototype = {
    getEventManager: function() {
      return this._eventManager
    },
    addEventListener: function(t, e) {
      this.getEventManager().addEvent(t, e)
    },
    removeEventListener: function(t, e) {
      this.getEventManager().removeEvent(t, e)
    },
    show: function(t, e) {
      this._annotationManager.clear(),
      this._annotationManager.startDrawing(),
      this.domElement.removeClass("bf-hide")
    },
    getAnnotationManager: function() {
      return this._annotationManager
    }
  },
  t.AnnotationToolbar = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins"),
    e = function() {
      return {viewer: null}
    };
  t.TagConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.HttpRequest"), function(t) {
      var e = this,
        i = this._viewer = t.viewer.getViewer();
      this._opt = t,
      this._renderCallback = function() {
        e.resize()
      },
      this._tagHelper = new CLOUD.Extensions.MarkerEditor(i),
      this.init(),
      i.addCallbacks("render", this._renderCallback)
    });
  e.prototype = {
    init: function() {
      this._tagHelper.isInitialized() || this._tagHelper.init()
    },
    addTag: function(t, e) {
      if (!t)
        return !1;
      var i = !1,
        n = this.getTags();
      t.userId = t.objectId,
      t.worldBoundingBox = t.boundingBox,
      t.worldPosition || (t.worldPosition = {
        x: (t.worldBoundingBox.min.x + t.worldBoundingBox.max.x) / 2,
        y: (t.worldBoundingBox.min.y + t.worldBoundingBox.max.y) / 2,
        z: (t.worldBoundingBox.min.z + t.worldBoundingBox.max.z) / 2
      });
      for (var o = 0, r = n.length; o < r; o++) {
        if (n[o].userId == t.userId)
          return i = !0,
          !1
      }
      i || this._tagHelper.createMarkerByIntersect(t, e.shape, e.type, e.image)
    },
    deleteTag: function(t) {
      for (var e = this, i = this.getTags(), n = 0, o = i.length; n < o; n++) {
        var r = i[n];
        if (r.userId == t)
          return e._tagHelper.deleteMarker(r),
          !1
      }
    },
    destroy: function() {
      this._viewer.removeCallbacks("render", this._renderCallback),
      this._tagHelper.markerClickCallback = null,
      this.unLoadTags(),
      this._tagHelper = null
    },
    loadTags: function(t) {
      this._tagHelper.loadMarkers(t)
    },
    unLoadTags: function() {
      this._tagHelper.unloadMarkers()
    },
    getTags: function() {
      return this._tagHelper.getMarkerInfoList()
    },
    zoomToSelectedTag: function() {
      this._tagHelper.zoomToSelectedMarkers()
    },
    resize: function() {
      this._tagHelper.onResize()
    },
    onSelected: function(t) {
      this._tagHelper.setMarkerClickCallback(t)
    }
  },
  t.Tag = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = function() {
      return {viewer: null}
    };
  t.DrawableContainerConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = function() {
      return {
        id: null,
        tooltip: "",
        tooltipStyle: {},
        draggable: !1,
        worldPosition: new Glodon.Web.Geometry.Point3d(0, 0, 0),
        angle: 0
      }
    };
  t.DrawableItemConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), Glodon.Web.Common.MouseButton, function(t) {
      this.id = t.id || Glodon.Web.Lang.Utility.UUID.createUUID(),
      this.worldPosition = t.worldPosition,
      this.angle = t.angle
    });
  e.prototype = {
    draw: function(t) {},
    onClick: function(t) {
      this._onclick = t
    },
    onRightClick: function(t) {
      this._onrightclick = t
    },
    onEndDrag: function(t) {
      this._onenddrag = t
    },
    setTooltip: function(t) {
      this.tipElement.querySelector("span").innerText = t
    },
    setTooltipStyle: function(t) {
      for (var e in t)
        this.tipElement.style[e] = t[e]
    },
    getTooltip: function() {
      return this.tipElement.querySelector("span").innerText
    },
    getTooltipStyle: function() {
      return this.tipElement.style
    },
    getWorldPosition: function() {
      return this.worldPosition
    },
    setWorldPosition: function(t) {
      this.worldPosition = t
    }
  },
  t.DrawableItem = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = function() {
      this.rootDomElement = e.create("div", "bf-drawable-context"),
      this.clientPosition = null
    };
  t.DrawableContext = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,
    i = function() {
      var t = {
        width: 32,
        height: 32,
        opacity: .75,
        src: null,
        offsetX: 0,
        offsetY: 0
      };
      return Object.assign({}, e, t)
    };
  t.ImageConfig = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = Glodon.Bimface.Plugins.Drawable.DrawableItem,
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    n = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    o = function(t) {
      e.call(this, t);
      var n = this,
        o = !1,
        r = i.create("img", "bf-drawable-image");
      r.draggable = !1,
      r.src = t.src,
      r.style.width = t.width + "px",
      r.style.height = t.height + "px",
      r.style.opacity = "" + t.opacity,
      r.style.transform = "rotate(" + t.angle + "deg)",
      this._config = t,
      this._domElement = r,
      this.clientPosition = {};
      var a,
        s = function(t) {
          var e = n.viewer.clientToWorld({
            x: t.x - a.x + n.clientPosition.x,
            y: t.y - a.y + n.clientPosition.y
          });
          e
            ? (n.worldPosition = e, n.update(), n._onenddrag && n._onenddrag(n), o = !1)
            : n.update()
        },
        l = function(t) {
          a = t,
          o = !0
        };
      t.draggable && i.drag({element: r, cursor: "pointer", end: s, start: l}),
      r.addEventListener("mouseup", function(t) {
        var e = t || window.event;
        "0" == e.button && n._onclick && (!o || a.x == e.clientX && a.y == e.clientY) && n._onclick(n)
      }),
      r.addEventListener("mousedown", function(t) {
        var e = t || window.event;
        e.stopPropagation(),
        "2" == e.button && n._onrightclick
          ? n._onrightclick(n)
          : "1" == e.button && n._onmiddleclick && n._onmiddleclick(n)
      })
    };
  n.Type.inheritPrototype(o, e);
  var r = {
    draw: function(t) {
      var e = this._domElement,
        i = this._config;
      this.clientPosition = t.clientPosition,
      e.style.left = t.clientPosition.x + i.offsetX - i.width / 2 + "px",
      e.style.top = t.clientPosition.y + i.offsetY - i.height / 2 + "px",
      t.rootDomElement.appendChild(e)
    },
    getWidth: function() {
      return this._config.width
    },
    setWidth: function(t) {
      var e = this._config.width,
        i = this._domElement,
        n = (e - t) / 2,
        o = parseInt(i.style.left);
      this._config.width = t,
      i.style.width = t + "px",
      i.style.left = o + n + "px"
    },
    getHeight: function() {
      return this._config.height
    },
    setHeight: function(t) {
      var e = this._config.height,
        i = this._domElement,
        n = (e - t) / 2,
        o = parseInt(i.style.top);
      this._config.height = t,
      i.style.height = t + "px",
      i.style.top = o + n + "px"
    },
    getOpacity: function() {
      return this._config.opacity
    },
    setOpacity: function(t) {
      this._config.opacity = t,
      this._domElement.style.opacity = t
    },
    getSrc: function() {
      return this._config.src
    },
    setSrc: function(t) {
      this._config.src = t,
      this._domElement.src = t
    },
    getOffsetX: function() {
      return this._config.offsetX
    },
    setOffsetX: function(t) {
      var e = this._config.offsetX,
        i = this._domElement,
        n = t - e,
        o = parseInt(i.style.left);
      this._config.offsetX = t,
      i.style.left = o + n + "px"
    },
    getOffsetY: function() {
      return this._config.offsetY
    },
    setOffsetY: function(t) {
      var e = this._config.offsetY,
        i = this._domElement,
        n = t - e,
        o = parseInt(i.style.top);
      this._config.offsetY = t,
      i.style.top = o + n + "px"
    },
    getAngle: function() {
      return this.angle
    },
    setAngle: function(t) {
      this.angle = t,
      this._domElement.style.transform = "rotate(" + t + "deg)"
    }
  };
  !function(t, e) {
    var i = e.prototype;
    for (var n in t)
      i[n] = t[n]
  }(r, o),
  t.Image = o
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,
    i = function() {
      var t = {
        width: 0,
        height: 0,
        opacity: .75,
        content: "",
        offsetX: 0,
        offsetY: 0
      };
      return Object.assign({}, e, t)
    };
  t.CustomItemConfig = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = Glodon.Bimface.Plugins.Drawable.DrawableItem,
    i = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    n = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"),
    o = function(t) {
      e.call(this, t);
      var n = !1,
        o = this,
        r = i.create("div", "bf-drawable-text");
      r.style.width = 0,
      r.style.height = 0;
      var a,
        s = t.viewer;
      this.clientPosition = {},
      t.content instanceof HTMLElement
        ? (t.content.draggable = !1, t.content.style.marginLeft = "-" + (
        parseInt(t.content.style.width) / 2 - parseInt(r.style.width) / 2) + "px", t.content.style.marginTop = "-" + (
        parseInt(t.content.style.height) / 2 - parseInt(r.style.height) / 2) + "px", this.content = t.content, r.appendChild(t.content), this.dom = t.content)
        : (r.innerHTML = t.content, this.text = t.content);
      var l = i.create("div", "bf-tooltip");
      l.style.display = "none",
      l.innerHTML = '<div class="bf-tooltip-content"><div class="bf-tooltip-arrow"></div><div class="bf-tooltip-inner"><span>' + t.tooltip + "</span></div></div>",
      l.style.left = t.width + "px",
      l.style.top = "-" + t.height + "px";
      var c = t.tipCSS;
      for (var h in c)
        l.style[h] = c[h];
      this.tipElement = l,
      r.appendChild(l);
      var u = function(t) {
          var e = s.clientToWorld({
            x: t.x - a.x + o.clientPosition.x,
            y: t.y - a.y + o.clientPosition.y
          });
          e
            ? (o.worldPosition = e, o.update(), o._onenddrag(o), n = !1)
            : o.update()
        },
        d = function(t) {
          a = t,
          n = !0
        };
      t.draggable && i.drag({element: r, cursor: "pointer", end: u, start: d}),
      r.style.width = t.width + "px",
      r.style.height = t.height + "px",
      r.style.opacity = "" + t.opacity,
      this._config = t,
      this._domElement = r,
      r.addEventListener("mouseover", function(t) {
        o.tipElement && o.tipElement.querySelector("span").innerText.length > 0 && (o.tipElement.style.display = "block")
      }),
      r.addEventListener("mouseout", function(t) {
        o.tipElement && (o.tipElement.style.display = "none")
      }),
      r.addEventListener("keydown", function(t) {
        t.stopPropagation()
      }),
      r.addEventListener("mouseup", function(t) {
        var e = t || window.event;
        "0" == e.button && o._onclick && (!n || a.x == e.clientX && a.y == e.clientY) && o._onclick(o)
      }),
      r.addEventListener("mousedown", function(t) {
        var e = t || window.event;
        e.stopPropagation(),
        "2" == e.button && o._onrightclick
          ? o._onrightclick(o)
          : "1" == e.button && o._onmiddleclick && o._onmiddleclick(o)
      })
    };
  n.Type.inheritPrototype(o, e);
  var r = {
    draw: function(t) {
      var e = this._domElement,
        i = this._config;
      this.clientPosition = t.clientPosition,
      e.style.left = t.clientPosition.x + i.offsetX - i.width / 2 + "px",
      e.style.top = t.clientPosition.y + i.offsetY - i.height / 2 + "px",
      "" == e.innerHTML && (
        this.dom
        ? e.appendChild(this.dom)
        : this.text && (e.innerText = this.text)),
      t.rootDomElement.appendChild(e)
    },
    getWidth: function() {
      return this._config.width
    },
    setWidth: function(t) {
      var e = this._config.width,
        i = this._domElement,
        n = (e - t) / 2,
        o = parseInt(i.style.left);
      this._config.width = t,
      i.style.width = t + "px",
      i.style.left = o + n + "px",
      this.content.style.marginLeft = "-" + (
      parseInt(this.content.style.width) / 2 - parseInt(i.style.width) / 2) + "px",
      this.content.style.marginTop = "-" + (
      parseInt(this.content.style.height) / 2 - parseInt(i.style.height) / 2) + "px"
    },
    getHeight: function() {
      return this._config.height
    },
    setHeight: function(t) {
      var e = this._config.height,
        i = this._domElement,
        n = (e - t) / 2,
        o = parseInt(i.style.top);
      this._config.height = t,
      i.style.height = t + "px",
      i.style.top = o + n + "px",
      this.content.style.marginLeft = "-" + (
      parseInt(this.content.style.width) / 2 - parseInt(i.style.width) / 2) + "px",
      this.content.style.marginTop = "-" + (
      parseInt(this.content.style.height) / 2 - parseInt(i.style.height) / 2) + "px"
    },
    getOpacity: function() {
      return this._config.opacity
    },
    setOpacity: function(t) {
      this._config.opacity = t,
      this._domElement.style.opacity = t
    },
    getContent: function() {
      return this._config.content
    },
    setContent: function(t) {
      this._config.content = t,
      this._domElement.content = t
    },
    getOffsetX: function() {
      return this._config.offsetX
    },
    setOffsetX: function(t) {
      var e = this._config.offsetX,
        i = this._domElement,
        n = t - e,
        o = parseInt(i.style.left);
      this._config.offsetX = t,
      i.style.left = o + n + "px"
    },
    getOffsetY: function() {
      return this._config.offsetY
    },
    setOffsetY: function(t) {
      var e = this._config.offsetY,
        i = this._domElement,
        n = t - e,
        o = parseInt(i.style.top);
      this._config.offsetY = t,
      i.style.top = o + n + "px"
    }
  };
  !function(t, e) {
    var i = e.prototype;
    for (var n in t)
      i[n] = t[n]
  }(r, o),
  t.CustomItem = o
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Drawable"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), function(t) {
      var e = this,
        i = t.viewer,
        n = new Glodon.Web.Lang.EventManager,
        o = new Glodon.Bimface.Plugins.Drawable.DrawableContext;
      i.getDomElement().appendChild(o.rootDomElement),
      i.addEventListener("Rendered", function() {
        e.update()
      }),
      e._items = [],
      e._viewer = i,
      e._context = o,
      e.getEventManager = function() {
        return n
      }
    });
  e.prototype = {
    addItem: function(t) {
      var e = this._items,
        i = this._viewer;
      t.viewer = i,
      t.update = this.update.bind(this),
      e.push(t),
      this.update()
    },
    removeItemById: function(t) {
      this._items.removeObjectByAttribute("id", t) && this.update()
    },
    getItemById: function(t) {
      return this._items.getObjectByAttribute("id", t)
    },
    getAllItems: function() {
      return this._items
    },
    addItems: function(t) {
      if (t.length)
        for (var e = 0; e < t.length; e++)
          t[e].update = this.update.bind(this);
    this._items = t,
      this.update()
    },
    clear: function() {
      this._items = [],
      this.update()
    },
    update: function() {
      var t = this._items,
        e = this._viewer,
        i = this._context;
      i.rootDomElement.innerHTML = "",
      i.domContainer = null,
      i.svgContainer = null;
      for (var n = 0, o = t.length; n < o; n++) {
        var r = t[n].worldPosition;
        e.isInViewFrustum(r) && (i.clientPosition = e.worldToClient(r), t[n].draw(i))
      }
    }
  },
  t.DrawableContainer = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Measure"),
    e = function() {
      return {
        viewer: null,
        targetsHintColor: new Glodon.Web.Graphics.Color(245, 127, 35, .6)
      }
    };
  t.MeasureRayConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Measure"),
    e = function() {
      return {
        id: null,
        color: new Glodon.Web.Graphics.Color(245, 127, 35, 1),
        width: 2,
        startPoint: new Glodon.Web.Geometry.Point3d(0, 0, 0),
        endPoint: new Glodon.Web.Geometry.Point3d(0, 0, 0),
        startObjectId: null,
        endObjectId: null
      }
    };
  t.MeasureRayItemConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Measure"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = function(t) {
      this.id = t.id || Glodon.Web.Lang.Utility.UUID.createUUID();
      this.startPoint = t.startPoint,
      this.endPoint = t.endPoint;
      this.startComponentId = t.startComponentId,
      this.endComponentId = t.endComponentId;
      var i = e.createNS("defs", "bf-defs");
      i.innerHTML = '\n      <marker id="end" markerWidth="6" markerHeight="6" refx="5" refy="3" orient="auto" markerUnits="strokeWidth">\n        <path d="M0,0 L0,6 L6,3 z" fill="' + t.color.getRGBA() + '" />\n      </marker>';
      var n = e.create("i", "bf-measure-handle");
      n.style.width = 12 * t.width + "px",
      n.style.height = 12 * t.width + "px",
      n.style.backgroundColor = t.color.getRGBA(),
      n.style.lineHeight = 12 * t.width + "px";
      var o = e.createNS("line", "bf-measure-line");
      o.style.stroke = t.color.getRGBA(),
      o.setAttribute("stroke-width", t.width);
      var r = e.create("span", "bf-measure-number");
      r.style.backgroundColor = t.color.getRGBA(),
      this.domElement = i,
      this.line = o,
      this.circle = n,
      this.text = r
    };
  i.prototype = {
    draw: function(t) {
      var e = this.domElement,
        i = this.line,
        n = this.circle,
        o = this.text,
        r = Math.abs(t.endPoint.x - t.startPoint.x),
        a = Math.abs(t.endPoint.y - t.startPoint.y),
        s = Math.abs(t.endPoint.z - t.startPoint.z),
        l = Math.sqrt(Math.pow(r, 2) + Math.pow(a, 2) + Math.pow(s, 2));
      i.setAttribute("x1", t.startPoint.x),
      i.setAttribute("y1", t.startPoint.y),
      i.setAttribute("x2", t.endPoint.x),
      i.setAttribute("y2", t.endPoint.y),
      n.style.left = t.startPoint.x + "px",
      n.style.top = t.startPoint.y + "px",
      t.isMove && (n.style.border = "2px solid #fff"),
      l < 15
        ? i.removeAttribute("marker-end")
        : i.setAttribute("marker-end", "url(#end)"),
      o.innerText = t.distance,
      t.svg.appendChild(e),
      t.svg.appendChild(i),
      t.text.appendChild(n),
      0 == t.distance
        ? n.innerText = "0"
        : (o.style.left = (t.startPoint.x + t.endPoint.x) / 2 + "px", o.style.top = (t.startPoint.y + t.endPoint.y) / 2 + "px", o.style.transform = "translate(-50%, 0)", o.style.marginTop = "2px", t.text.appendChild(o))
    }
  },
  t.MeasureRayItem = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Measure"),
    e = Object.freeze({Measured: "Measured"});
  t.MeasureRayEvent = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Measure"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = function(t) {
      var i = t.viewer;
      if (i) {
        if (!(i instanceof Glodon.Bimface.Viewer.Viewer3D))
          return void console.log("Viewer2D is not supported.");
        var n = this,
          o = new Glodon.Web.Lang.EventManager,
          r = e.create("div", "bf-measure-conext");
        i.addEventListener("Rendered", function() {
          n.measureItem && n.update()
        }),
        this.context = {
          rootDomElement: r
        },
        this._opt = t,
        this._enableMove = !1,
        this._events = {
          mousedown: function() {
            this._startTime = (new Date).getTime()
          },
          mouseup: function(t) {
            if (0 == t.button || 1 == t.button)
              if (n._enableMove)
                n._enableMove = !1,
                n.measureByPoint(t);
              else {
                var e = this._startTime,
                  i = (new Date).getTime();
                i - e < 300 && n.measureByPoint(t)
              }
            },
          mousemove: function(t) {
            n._enableMove && (t.stopPropagation(), n.measureByPoint(t))
          }
        },
        this.getEventManager = function() {
          return o
        }
      }
    };
  i.prototype = {
    addEventListener: function(t, e) {
      this.getEventManager().addEvent(t, e)
    },
    removeEventListener: function(t, e) {
      this.getEventManager().removeEvent(t, e)
    },
    switchOn: function(t) {
      var i = this.context,
        n = this;
      n._opt.viewer.getDomElement().appendChild(i.rootDomElement),
      n._opt.viewer.getViewer().setPickDisabled(!0),
      t && (n._callback = t),
      n._opt.viewer.setSelectedComponentsById();
      var o = e.createNS("svg", "bf-measure-svg"),
        r = e.create("div", "bf-measure-text");
      i.rootDomElement.appendChild(o),
      i.rootDomElement.appendChild(r),
      i.svg = o,
      i.text = r,
      i.rootDomElement.addEventListener("mousedown", n._events.mousedown),
      i.rootDomElement.addEventListener("mouseup", n._events.mouseup),
      i.rootDomElement.addEventListener("mousemove", n._events.mousemove)
    },
    switchOff: function() {
      var t = this.context.rootDomElement,
        e = this,
        i = e._opt.viewer;
      i.getViewer().setPickDisabled(!1),
      e.measureItem && (i.restoreComponentsColorById([e.measureItem.startComponentId, e.measureItem.endComponentId]), i.render()),
      t.removeEventListener("mousedown", e._events.mousedown),
      t.removeEventListener("mouseup", e._events.mouseup),
      t.removeEventListener("mousemove", e._events.mousemove),
      t.innerHTML = "",
      t.remove(),
      e.measureItem = null
    },
    reset: function() {
      var t = this.context,
        e = this,
        i = e._opt.viewer;
      e.measureItem && (i.restoreComponentsColorById([e.measureItem.startComponentId, e.measureItem.endComponentId]), i.render()),
      t.svg.innerHTML = "",
      t.text.innerHTML = "",
      e.measureItem = null
    },
    measureByPoint: function(t) {
      var e = this,
        i = e._opt.viewer;
      i.getViewer().pickByPointWithNormal(t, function(t) {
        if (t) {
          e.measureItem && i.restoreComponentsColorById([e.measureItem.startComponentId, e.measureItem.endComponentId]);
          var n = (Glodon.Bimface.Viewer.Viewer3DEvent, e._getContextData(t)),
            o = new Glodon.Bimface.Plugins.Measure.MeasureRayItemConfig;
          o.startComponentId = n.startComponentId,
          o.endComponentId = n.endComponentId,
          o.startPoint = n.startPoint,
          o.endPoint = n.endPoint;
          var r = new Glodon.Bimface.Plugins.Measure.MeasureRayItem(o);
          r.circle.addEventListener("mousedown", function(t) {
            2 != t.button && (e._enableMove = !0)
          }),
          e.context.distance = n.distance,
          i.overrideComponentsColorById([
            n.startComponentId, n.endComponentId
          ], e._opt.targetsHintColor),
          setTimeout(function() {
            e.update(),
            i.render()
          }, 100),
          e.measureItem = r,
          e.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureRayEvent.Measured, n)
        }
      })
    },
    update: function() {
      var t = this.measureItem,
        e = this.context,
        i = this._opt.viewer;
      e.svg.innerHTML = "",
      e.text.innerHTML = "",
      e.isMove = this._enableMove;
      var n = i.worldToClient(t.startPoint),
        o = i.worldToClient(t.endPoint);
      n && o && (e.startPoint = new Glodon.Web.Geometry.Point3d(n.x, n.y, n.z), e.endPoint = new Glodon.Web.Geometry.Point3d(o.x, o.y, o.z), t.draw(e))
    },
    _getContextData: function(t) {
      var e,
        i,
        n = {};
      return e = i = t[0],
      t.length > 1 && (i = t[1]),
      n.startComponentId = e.userId,
      n.startPoint = e.worldPosition,
      n.endComponentId = i.userId,
      n.endPoint = i.worldPosition,
      n.distanceX = Math.round(Math.abs(n.endPoint.x - n.startPoint.x)),
      n.distanceY = Math.round(Math.abs(n.endPoint.y - n.startPoint.y)),
      n.distanceZ = Math.round(Math.abs(n.endPoint.z - n.startPoint.z)),
      n.distance = Math.round(Math.sqrt(Math.pow(n.distanceX, 2) + Math.pow(n.distanceY, 2) + Math.pow(n.distanceZ, 2))),
      n
    }
  },
  t.MeasureRay = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Marker3D"),
    e = function() {
      return {viewer: null}
    };
  t.Marker3DContainerConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Marker3D"),
    e = function() {
      return {
        id: null,
        size: 30,
        tooltip: "",
        src: null,
        worldPosition: new Glodon.Web.Geometry.Point3d(0, 0, 0)
      }
    };
  t.Marker3DConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Marker3D"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), function(t) {
      this.id = t.id || Glodon.Web.Lang.Utility.UUID.createUUID(),
      this.size = t.size,
      this.iconUrl = t.src,
      this.tooltip = t.tooltip,
      this.position = t.worldPosition
    });
  e.prototype = {
    getId: function() {
      return this.id
    },
    getWorldPosition: function() {
      return this.position
    },
    setWorldPosition: function(t) {
      this.position = t,
      this.update()
    },
    getSize: function() {
      return this.size
    },
    setSize: function(t) {
      this.size = t,
      this.update()
    },
    getSrc: function() {
      return this.iconUrl
    },
    setSrc: function(t) {
      this.iconUrl = t,
      this.update()
    },
    getTooltip: function() {
      return this.tooltip
    },
    setTooltip: function(t) {
      this.tooltip = t
    },
    onClick: function(t) {
      t && (this._callback = t)
    },
    onRightClick: function(t) {},
    update: function() {
      this.container && this.container.update()
    }
  },
  t.Marker3D = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Plugins.Marker3D"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"), function(t) {
      if (!t.viewer)
        return void console.log("viewer must not be empty.");
      var e = t.viewer instanceof Glodon.Bimface.Viewer.Viewer3D,
        i = t.viewer.getViewer();
      if (!e)
        return void console.log("Viewer2D is not supported.");
      var n = new CLOUD.Marker3D(i, !0),
        o = this;
      this._helper = n,
      this._viewer = t.viewer,
      this._items = [],
      i.registerEventListener(CLOUD.EVENTS.ON_CLICK_PICK, function(t) {
        var e = t.intersectInfo;
        if (e && "Marker3D" === e.tag) {
          var i = n.getItemByPick(e),
            r = o.getItemById(i.id);
          r._callback && r._callback(i)
        }
      })
    });
  e.prototype = {
    addItem: function(t) {
      t.container = this,
      this._items.push(t),
      this.update()
    },
    addItems: function(t) {
      this._items = this._items.concat(t),
      this.update()
    },
    removeItemById: function(t) {
      this._items.removeObjectByAttribute("id", t),
      this.update()
    },
    getItemById: function(t) {
      return this._items.getObjectByAttribute("id", t)
    },
    getAllItems: function() {
      return this._items
    },
    clear: function() {
      this._items = [],
      this.update()
    },
    update: function() {
      this._helper.clear(),
      this._helper.add(this._items),
      this._helper.update(),
      this._viewer.render()
    }
  },
  t.Marker3DContainer = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = function() {
      var t = {
          Toolbars: [
            "MainToolbar", "ModelTree"
          ],
          Buttons: [
            "Home",
            "Walk",
            "RectangleSelect",
            "Measure",
            "Section",
            "Property",
            "Information",
            "Setting",
            "FullScreen"
          ]
        },
        e = Glodon.Bimface.Viewer.Viewer3DConfig();
      return Object.assign({}, t, e)
    };
  t.WebApplication3DConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = Object.freeze({ViewAdded: "ViewAdded", ViewLoading: "ViewLoading", ComponentsSelectionChanged: "ComponentsSelectionChanged", Error: "Error"});
  t.WebApplication3DEvent = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t) {
      var e = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        i = Glodon.Bimface.UI.Control.ControlEvent,
        n = new Glodon.Bimface.UI.Button.ButtonConfig;
      n.id = "Home",
      n.title = "",
      n.className = "bf-button gld-bf-home";
      var o = new Glodon.Bimface.UI.Button.Button(n);
      return o.addEventListener(i.Click, function() {
        e
          ? t.setView(Glodon.Bimface.Viewer.ViewOption.Home)
          : t.home()
      }),
      o
    };
  t.Home = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e, i) {
      var n = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        o = Glodon.Bimface.UI.Control.ControlEvent;
      if (!n)
        return void console.log("The API is not supported on this viewer.");
      var r = Glodon.Bimface.Viewer.NavigationMode3D,
        a = {
          OrbitPoint: r.PickWithRect,
          OrbitCamera: r.Fly
        },
        s = new Glodon.Bimface.UI.Button.ButtonConfig;
      s.id = "OrbitButton",
      s.title = "",
      s.inheritTitle = !0;
      var l = new Glodon.Bimface.UI.Button.ComboBox(s),
        c = new Glodon.Bimface.UI.Button.ButtonConfig;
      c.id = "OrbitPoint",
      c.title = "",
      c.className = "bf-button gld-bf-orbitpoint";
      var h = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(c),
        u = new Glodon.Bimface.UI.Button.ButtonConfig;
      u.id = "OrbitCamera",
      u.title = "",
      u.className = "bf-button gld-bf-orbitcamera";
      var d = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(u);
      return l.addControl(h),
      l.addControl(d),
      l.addEventListener(o.Change, function(e) {
        i.getControl("Section").setCheckedState(!1),
        t.setNavigationMode(a[e.id])
      }),
      l
    };
  t.OrbitButton = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e, i) {
      var n = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        o = Glodon.Bimface.UI.Control.ControlEvent,
        r = Glodon.Bimface.Viewer.Viewer3DEvent;
      if (!n)
        return void console.log("The API is not supported on this viewer.");
      var a = new Glodon.Bimface.UI.Button.ButtonConfig;
      a.id = "RectangleSelect",
      a.title = "",
      a.className = "bf-button gld-bf-zoomrect";
      var s = new Glodon.Bimface.UI.Button.ToggleButton(a),
        l = function() {
          s.setCheckedState(!1),
          i.resetState()
        };
      return s.addEventListener(o.StateChange, function(e) {
        if (e) {
          i.getControl("Section").setCheckedState(!1);
          i.getControl("Walk").setCheckedState(!1),
          t.setNavigationMode(Glodon.Bimface.Viewer.NavigationMode3D.ZoomWithRect),
          t.addEventListener(r.RectSelection, l)
        } else
          t.removeEventListener(r.RectSelection, l)
      }),
      s
    };
  t.RectangleSelect = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Panel"),
    e = function(t) {
      var e = Glodon.Bimface.Viewer.Viewer3DEvent,
        i = function(e) {
          e.objectId
            ? t.getComponentProperty(e.objectId, function(t) {
              o.setData(t.properties)
            })
            : o.setData("")
        };
      if (o)
        return o.show(),
        t.addEventListener(e.ComponentsSelectionChanged, i),
        o;
      var n = new Glodon.Bimface.UI.Panel.PanelConfig;
      n.title = "",
      n.css = {
        right: "10px",
        top: "10px",
        width: "300px",
        height: "416px"
      };
      var o = new Glodon.Bimface.UI.Panel.Panel(n),
        r = t.getSelectedComponents();
      for (var a in r) {
        t.getComponentProperty(a, function(t) {
          o.setData(t.properties)
        });
        break
      }
      return t.addEventListener(e.ComponentsSelectionChanged, i),
      o.addEventListener("Hide", function() {
        t.removeEventListener(e.ComponentsSelectionChanged, i)
      }),
      o
    };
  t.PropertyPanel = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e) {
      var i = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        n = Glodon.Bimface.UI.Control.ControlEvent;
      if (!i)
        return void console.log("The API is not supported on this viewer.");
      var o = new Glodon.Bimface.UI.Button.ButtonConfig;
      o.id = "Property",
      o.title = "",
      o.className = "bf-button gld-bf-properties";
      var r,
        a = new Glodon.Bimface.UI.Button.ToggleButton(o);
      return a.addEventListener(n.Click, function() {
        a.isChecked()
          ? (r = new Glodon.Bimface.Application.UI.Panel.PropertyPanel(t), r.addEventListener("Hide", function() {
            e.removeChild(r.element),
            a.setCheckedState(!1)
          }), e.appendChild(r.element))
          : e.removeChild(r.element)
      }),
      a
    };
  t.Property = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = function(t, i, n) {
      var o = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        r = Glodon.Bimface.UI.Control.ControlEvent;
      if (!o)
        return void console.log("The API is not supported on this viewer.");
      var a = new Glodon.Bimface.UI.Button.ButtonConfig;
      a.id = "Measure",
      a.title = "",
      a.className = "bf-button gld-bf-measure";
      var s,
        l,
        c = new Glodon.Bimface.UI.Button.ToggleButton(a),
        h = function() {
          var t = e.create("div", "bf-panel bf-measure-panel"),
            i = e.create("span", "bf-measure-text");
          i.innerText = "";
          var n = e.create("span", "bf-close bf-measure-close");
          n.addEventListener("click", function() {
            c.setCheckedState(!1)
          });
          var o = e.create("button", "bf-measure-reset");
          return o.innerText = "",
          o.addEventListener("click", function() {
            i.innerHTML = "",
            l.reset()
          }),
          t.appendChild(i),
          t.appendChild(n), {
            panel: t,
            text: i,
            reset: o
          }
        };
      return c.addEventListener(r.StateChange, function(e) {
        var o = n.getControl("Walk");
        if (e) {
          var r = new Glodon.Bimface.Plugins.Measure.MeasureRayConfig;
          if (r.viewer = t, l = new Glodon.Bimface.Plugins.Measure.MeasureRay(r), s = h(), l.addEventListener(Glodon.Bimface.Plugins.Measure.MeasureRayEvent.Measured, function(t) {
            s.text.innerHTML = '<span class="bf-measure-distance">' + t.distance + "</span>mm",
            s.text.appendChild(s.reset)
          }), i.appendChild(s.panel), l.switchOn(), o.isChecked()) {
            document.querySelector(".bf-measure-panel").style.bottom = "130px"
          }
        } else
          i.removeChild(s.panel),
          s = null,
          l.switchOff()
      }),
      c
    };
  t.Measure = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e, i) {
      var n = (Glodon.Bimface.Viewer.Viewer3D, Glodon.Bimface.UI.Control.ControlEvent),
        o = new Glodon.Bimface.UI.Button.ButtonConfig;
      o.id = "Annotation",
      o.title = "",
      o.className = "bf-button gld-bf-notes";
      var r = new Glodon.Bimface.UI.Button.Button(o);
      return r.addEventListener(n.Click, function() {
        i.hide(),
        i.getControl("Measure").setCheckedState(!1);
        var e = new Glodon.Bimface.Plugins.Annotation.AnnotationToolbarConfig;
        e.viewer = t;
        var n = self._annotation = new Glodon.Bimface.Plugins.Annotation.AnnotationToolbar(e),
          o = Glodon.Bimface.Plugins.Annotation.AnnotationToolbarEvent;
        n.show(),
        n.addEventListener(o.Saved, function() {
          i.show()
        }),
        n.addEventListener(o.Cancelled, function() {
          i.show()
        }),
        r._annotationManager = n.getAnnotationManager(),
        r._annotationToolbar = n
      }),
      r
    };
  t.Annotation = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Panel"),
    e = function(t) {
      var e = new Glodon.Bimface.UI.Panel.PanelConfig;
      e.title = "",
      e.css = {
        right: "10px",
        bottom: "10px",
        width: "300px",
        height: "92px",
        minHeight: "92px"
      },
      e.enableSizable = !1;
      var i = new Glodon.Bimface.UI.Panel.Panel(e),
        n = Glodon.Bimface.Application.UI.Toolbar.SectionToolbarConfig();
      n.viewer = t;
      var o = Glodon.Bimface.Application.UI.Toolbar.Toolbar(n),
        r = o.getControl("SectionReset"),
        a = o.getControl("SectionVisiable"),
        s = o.getControl("SectionRotate"),
        l = Glodon.Bimface.UI.Control.ControlEvent;
      return r.addEventListener(l.Click, function() {
        a.setCheckedState(!1),
        s.setCheckedState(!1)
      }),
      i.addControl(o),
      i
    };
  t.SectionPanel = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e, i) {
      var n = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        o = Glodon.Bimface.UI.Control.ControlEvent;
      if (!n)
        return void console.log("The API is not supported on this viewer.");
      var r = new Glodon.Bimface.UI.Button.ButtonConfig;
      r.id = "Section",
      r.title = "",
      r.className = "bf-button gld-bf-sectionbox";
      var a,
        s = new Glodon.Bimface.UI.Button.ToggleButton(r);
      return s.addEventListener(o.StateChange, function(n) {
        if (n) {
          i.getControl("Measure").setCheckedState(!1);
          i.getControl("RectangleSelect").setCheckedState(!1);
          i.getControl("Walk").setCheckedState(!1),
          a = new Glodon.Bimface.Application.UI.Panel.SectionPanel(t),
          a.addEventListener("Hide", function() {
            e.removeChild(a.element),
            s.setCheckedState(!1)
          }),
          t.enableSectionBox(),
          t.render(),
          e.appendChild(a.element)
        } else
          t.resetSectionBox(),
          t.disableSectionBox(),
          t.render(),
          a.close(),
          a = null,
          i.resetState()
      }),
      s
    };
  t.Section = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t) {
      var e = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        i = Glodon.Bimface.UI.Control.ControlEvent;
      if (!e)
        return void console.log("The API is not supported on this viewer.");
      var n = new Glodon.Bimface.UI.Button.ButtonConfig;
      n.id = "SectionVisiable",
      n.title = "";
      var o = new Glodon.Bimface.UI.Button.ToggleButton(n);
      return o.setHtml('<span class="gld-bf-box-hide"></span><span class="bf-button-name"></span>'),
      o.addEventListener(i.Click, function() {
        o.isChecked()
          ? t.hideSectionBox()
          : t.showSectionBox(),
        t.render()
      }),
      o
    };
  t.SectionVisiable = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t) {
      var e = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        i = Glodon.Bimface.UI.Control.ControlEvent;
      if (!e)
        return void console.log("The API is not supported on this viewer.");
      var n = new Glodon.Bimface.UI.Button.ButtonConfig;
      n.id = "SectionRotate",
      n.title = "";
      var o = new Glodon.Bimface.UI.Button.ToggleButton(n);
      return o.setHtml('<span class="gld-bf-rotate-box"></span><span class="bf-button-name"></span>'),
      o.addEventListener(i.Click, function() {
        var e = Glodon.Bimface.Viewer.SectionBoxMode;
        o.isChecked()
          ? t.setSectionBoxMode(e.Rotate)
          : t.setSectionBoxMode(e.Default)
      }),
      o
    };
  t.SectionRotate = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t) {
      var e = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        i = Glodon.Bimface.UI.Control.ControlEvent;
      if (!e)
        return void console.log("The API is not supported on this viewer.");
      var n = new Glodon.Bimface.UI.Button.ButtonConfig;
      n.id = "SectionReset",
      n.title = "";
      var o = new Glodon.Bimface.UI.Button.Button(n);
      return o.setHtml('<span class="gld-bf-reset-box"></span><span class="bf-button-name"></span>'),
      o.addEventListener(i.Click, function() {
        t.resetSectionBox(),
        t.render()
      }),
      o
    };
  t.SectionReset = e
}(),
function() {
  var t,
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Panel"),
    i = function(e) {
      if (t)
        return t.show(),
        t;
      var i = new Glodon.Bimface.UI.Panel.PanelConfig;
      i.title = "",
      i.css = {
        left: "50%",
        top: "50%",
        width: "300px",
        height: "210px",
        transform: "translate(-50%,-50%)"
      },
      i.enableSizable = !1;
      var n = e.getInformation();
      t = new Glodon.Bimface.UI.Panel.Panel(i);
      var o = '<div class="bf-info">\n                  <ul class="bf-info-list">\n                    <li><span class="bf-info-value">' + n.elements + '</span></li>\n                    <li><span class="bf-info-value">' + n.triangles + '</span></li>\n                    <li><span class="bf-info-value">' + 3 * n.triangles + '</span></li>\n                  </ul>\n                  <div class="bf-info-power">Powered by <a target="_blank" href="http://bimface.com/">bimface.com</a></div>\n                </div>';
      return t.setHtml(o),
      t
    };
  e.InformationPanel = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e) {
      var i = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        n = Glodon.Bimface.UI.Control.ControlEvent;
      if (!i)
        return void console.log("The API is not supported on this viewer.");
      var o = new Glodon.Bimface.UI.Button.ButtonConfig;
      o.id = "Information",
      o.title = "",
      o.className = "bf-button gld-bf-information";
      var r,
        a = new Glodon.Bimface.UI.Button.ToggleButton(o);
      return a.addEventListener(n.Click, function() {
        a.isChecked()
          ? (r = new Glodon.Bimface.Application.UI.Panel.InformationPanel(t), r.addEventListener("Hide", function() {
            e.removeChild(r.element),
            a.setCheckedState(!1)
          }), e.appendChild(r.element))
          : e.removeChild(r.element)
      }),
      a
    };
  t.Information = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t) {
      var e = (Glodon.Bimface.Viewer.Viewer3D, Glodon.Bimface.UI.Control.ControlEvent),
        i = new Glodon.Bimface.UI.Button.ButtonConfig;
      i.id = "FullScreen",
      i.title = "",
      i.className = "bf-button gld-bf-maximize";
      var n = new Glodon.Bimface.UI.Button.ChangeButton(i);
      return n.addEventListener(e.Click, function() {
        var e = this.hasClass("gld-bf-maximize");
        t.enableFullScreen(e)
      }),
      Glodon.Web.Lang.Utility.FullScreen.onFullScreenChanged(function() {
        var t = n.getTitle();
        n.toggleClassName("gld-bf-maximize"),
        n.toggleClassName("gld-bf-minimize"),
        "" == t
          ? n.setTitle("")
          : n.setTitle("")
      }),
      n
    };
  t.FullScreen = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t) {
      var e = (Glodon.Bimface.Viewer.Viewer3D, Glodon.Bimface.UI.Control.ControlEvent),
        i = new Glodon.Bimface.UI.Button.ButtonConfig;
      i.id = "FamilyList",
      i.title = "FamilyList",
      i.className = "bf-button gld-bf-maximize";
      for (var n = new Glodon.Bimface.UI.Button.ComboBox(i), o = t.getFamilyTypes(), r = 0, a = o.length; r < a; r++) {
        var s = o[r],
          i = new Glodon.Bimface.UI.Button.ButtonConfig;
        i.id = s.id,
        i.title = s.name;
        var l = new Glodon.Bimface.UI.Button.ComboBoxOptionButton(i);
        l.setHtml('<span class="bf-button-name">' + s.name + "</span>"),
        n.addControl(l)
      }
      return n.addEventListener(e.Change, function(e) {
        t.showFamilyTypeById(e.id),
        t.render()
      }),
      n
    };
  t.FamilyList = e
}(),
function() {
  var t,
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Panel"),
    i = function t(e) {
      if (e) {
        var i = new Glodon.Bimface.UI.Tree.TreeNodeConfig;
        switch (e.type) {
          case "floor":
            e.type = "levelName",
            i.isChecked = !0,
            i.hasCheckbox = !0,
            i.selection = !0;
            break;
          case "category":
            e.type = "categoryId",
            i.isChecked = !0,
            i.hasCheckbox = !0,
            i.selection = !0;
            break;
          case "specialty":
            i.isChecked = !0,
            i.hasCheckbox = !0,
            i.selection = !0;
            break;
          case "family":
          case "familyType":
          default:
            i.isChecked = !1,
            i.hasCheckbox = !1,
            i.selection = !1
        }
        var n = new Glodon.Bimface.UI.Tree.TreeNode(i);
        if (
          n.element.setAttribute("data-filter", e.type), "categoryId" == e.type
          ? n.setData(e.id, e.name)
          : "" == e.name
            ? n.setData("", e.name)
            : n.setData(e.name, e.name),
        e.items && e.items.length > 0)
          for (var o = 0, r = e.items.length; o < r; o++)
            n.addChildNode(t(e.items[o]));
      return n
      }
    },
    n = function(e, n, o) {
      if (t)
        return t.show(),
        t;
      var r = new Glodon.Bimface.UI.Panel.PanelConfig;
      return r.title = "",
      r.css = {
        left: "10px",
        top: "10px",
        width: "300px",
        height: "416px"
      },
      t = new Glodon.Bimface.UI.Panel.Panel(r),
      e.getModeTree(function(n, r) {
        if (n && 0 != n.length) {
          var a = new Glodon.Bimface.UI.Tree.TreeNodeConfig;
          a.isChecked = !0,
          a.hasCheckbox = !0,
          a.selection = !0;
          var s = new Glodon.Bimface.UI.Tree.TreeNode(a);
          s.element.setAttribute("data-filter", "root"),
          s.setData("all", ""),
          s.expand();
          var l = new Glodon.Bimface.UI.Tree.Tree(s);
          if ("singleModel" == r)
            for (var c = 0, h = n.length; c < h; c++)
              if (1 == h && "floor" == n[c].type)
                for (var u = n[c].items, d = 0; d < u.length; d++)
                  s.addChildNode(i(u[d]));
        else
            s.addChildNode(i(n[c]));
          else
            for (var c = 0, h = n.items.length; c < h; c++)
              s.addChildNode(i(n.items[c]));
        l.addEventListener("CheckedChanged", function() {
            var t = l.getChecked();
            "all" == t && (t = null),
            e.showExclusiveComponentsByObjectData(t),
            e.render()
          }),
          l.addEventListener("SelectionChanged", function() {
            var t = Glodon.Bimface.Viewer.IsolateOption,
              i = l.getSelection();
            i
              ? e.isolateComponentsByObjectData([i], t.MakeOthersTranslucent)
              : e.isolateComponentsByObjectData(),
            e.render()
          }),
          o.modelTree = l,
          t.addControl(l)
        }
      }),
      t.addEventListener("Hide", function() {
        o.show()
      }),
      t
    };
  e.ModelTreePanel = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e, i) {
      var n = (Glodon.Bimface.Viewer.Viewer3D, Glodon.Bimface.UI.Control.ControlEvent),
        o = new Glodon.Bimface.UI.Button.ButtonConfig;
      o.id = "ModelTree",
      o.title = "",
      o.className = "bf-button gld-bf-tree";
      var r = new Glodon.Bimface.UI.Button.Button(o);
      return r.addEventListener(n.Click, function() {
        i.hide();
        var n = new Glodon.Bimface.Application.UI.Panel.ModelTreePanel(t, e, i);
        e.appendChild(n.element)
      }),
      r
    };
  t.ModelTree = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Panel"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = {
      menu: !1,
      hobby: !1,
      hover: !1,
      scroll: !1,
      color: 0,
      cur: 15
    },
    n = function(t) {
      var n = new Glodon.Bimface.UI.Panel.PanelConfig,
        o = this;
      this.viewer = t,
      n.title = "",
      n.css = {
        left: "50%",
        top: "50%",
        transform: "translate(-50%,-200px)",
        width: "330px",
        height: "auto"
      },
      n.enableSizable = !1;
      var r = {
          1: new Glodon.Web.Graphics.Color(255, 255, 255, 1),
          2: new Glodon.Web.Graphics.Color(214, 214, 213, 1),
          3: new Glodon.Web.Graphics.Color(92, 92, 92, 1),
          4: new Glodon.Web.Graphics.Color(0, 0, 0, 1),
          5: new Glodon.Web.Graphics.Color(134, 157, 180, 1),
          6: new Glodon.Web.Graphics.Color(50, 71, 91, 1)
        },
        a = new Glodon.Bimface.UI.Panel.Panel(n),
        s = e.create("div", "bf-setting-tabs"),
        l = e.create("form", "bf-setting"),
        c = '<ul class="tab1 show">\n        <li class="bf-setting-li radio">\n        <span class="bf-setting-name"></span>\n         <div class="bf-setting-value bf-small contextmenu">\n        <label class="bf-label bf-checked">\n        <span class=' + (
          i.menu
          ? "icon-nochecked"
          : "icon-checked") + '></span>\n        <input type="radio" class="bf-orbit" name="orbit" value="Left" ' + (
          i.menu
          ? 'checked="true"'
          : "") + '>\n        <span class="bf-radio"></span>\n        </label>\n        <label class="bf-label">\n        <span class=' + (
          i.menu
          ? "icon-checked"
          : "icon-nochecked") + '></span>\n        <input type="radio" class="bf-orbit" name="orbit" value="Right"' + (
          i.menu
          ? ""
          : 'checked="true"') + '>\n        <span class="bf-radio"></span>\n        </label>\n        </div>\n        </li>\n\n        <li class="bf-setting-li radio">\n        <span class="bf-setting-name"></span>\n    <div class="bf-setting-value bf-small hobby">\n        <label class="bf-label bf-checked">\n        <span class=' + (
          i.hobby
          ? "icon-nochecked"
          : "icon-checked") + '></span>\n        <input type="radio" class="bf-orbit" name="orbit" value="Left" ' + (
        !i.hobby && 'checked="true"') + '>\n        <span class="bf-radio"></span>\n        </label>\n        <label class="bf-label">\n        <span class=' + (
          i.hobby
          ? "icon-checked"
          : "icon-nochecked") + '></span>\n        <input type="radio" class="bf-orbit" name="orbit" value="Right"' + (
        i.hobby && 'checked="true"') + '>\n        <span class="bf-radio"></span>\n        </label>\n        </div>\n        </li>\n\n        <li class="bf-setting-li checkbox">\n        <span class="bf-setting-name"></span>\n    <label class=" bf-checkbox">\n        <span class="radioBox gld-bf-selected ' + (
          i.hover
          ? "checked"
          : "") + '"></span>\n        <input type="checkbox" class="bf-orbit hover" name="orbit" value="Left" checked="true">\n        <span class="bf-radio"></span>\n        </label>\n        </li>\n        <li class="bf-setting-li checkbox">\n        <span class="bf-setting-name"></span>\n    <label class=" bf-checkbox">\n        <span class="radioBox gld-bf-selected ' + (
          i.scroll
          ? "checked"
          : "") + '"></span>\n        <input type="checkbox" class="bf-orbit scroll" name="orbit" value="Left" checked="true">\n        <span class="bf-radio"></span>\n        </label>\n        </li>\n        </ul>\n\n        <ul class="tab2 ">\n        <li class="bf-setting-li">\n        <span class="bf-setting-name"></span>\n    <div class="bf-setting-value bf-FPS" ></div>\n        </li>\n\n        <li class="bf-setting-li">\n        <span class="bf-setting-name"></span>\n    <div class="bf-color">\n        <label class="bf-color-item">\n        <input type="radio" name="color" class="bf-color-input" value="1" ' + (
        0 == i.color && 'checked="checked"') + ' />\n        <span class="bf-radio"  style="background:#fff;"></span>\n        </label>\n        <label class="bf-color-item" value="2">\n        <input type="radio" name="color" class="bf-color-input" value="2" ' + (
        1 == i.color && 'checked="checked"') + ' />\n        <span class="bf-radio" style="background:#d6d6d5;"></span>\n        </label>\n        <label class="bf-color-item">\n        <input type="radio" name="color" class="bf-color-input" value="3" ' + (
        2 == i.color && 'checked="checked"') + ' />\n        <span class="bf-radio" style="background:#5c5c5c;"></span>\n        </label>\n        <label class="bf-color-item">\n        <input type="radio" name="color" class="bf-color-input" value="4"  ' + (
        3 == i.color && 'checked="checked"') + '/>\n        <span class="bf-radio" style="background:#000000;"></span>\n        </label>\n        <label class="bf-color-item">\n        <input type="radio" name="color" class="bf-color-input" value="5"  ' + (
        4 == i.color && 'checked="checked"') + '/>\n        <span class="bf-radio" style="background:#869db4;"></span>\n        </label>\n        <label class="bf-color-item">\n        <input type="radio" name="color" class="bf-color-input" value="6" ' + (
        5 == i.color && 'checked="checked"') + ' />\n        <span class="bf-radio" style="background:#32475b;"></span>\n        </label>\n        </div>\n        </li>\n        </ul>\n        <div class="bf-reset">\n        <span class="reset"></span>\n        </div>';
      l.innerHTML = c,
      s.innerHTML = '\n      <span data-tab="tab1" class="tab-left selected"></span><span data-tab="tab2" class="tab-right"></span>\n    ',
      s.onclick = function(t) {
        var e = t.target,
          i = (e.getAttribute("data-tab"), e.previousElementSibling || e.nextElementSibling);
        e.hasClass("selected") || (e.toggleClass("selected"), i.toggleClass("selected"), document.querySelector(".tab1").toggleClass("show"), document.querySelector(".tab2").toggleClass("show"))
      };
      for (var h = l.querySelectorAll(".contextmenu input"), u = 0, d = h.length; u < d; u++)
        h[u].addEventListener("change", function() {
          var t = this.previousElementSibling;
          t.hasClass("icon-checked") || o.viewer.toggleContextMenuDisplay();
          var e = l.querySelector(".contextmenu .icon-checked");
          e.removeClass("icon-checked"),
          e.addClass("icon-nochecked"),
          t.toggleClass("icon-checked"),
          t.toggleClass("icon-nochecked"),
          i.menu = !i.menu
        });
      for (var h = l.querySelectorAll(".hobby input"), p = 0, f = h.length; p < f; p++)
        h[p].addEventListener("change", function() {
          var e = this.previousElementSibling;
          e.hasClass("icon-checked") || t.setUseLeftHandedInput("Left" == this.value && !0 || !1);
          var n = l.querySelector(".hobby .icon-checked");
          n.removeClass("icon-checked"),
          n.addClass("icon-nochecked"),
          e.toggleClass("icon-checked"),
          e.toggleClass("icon-nochecked"),
          i.hobby = !i.hobby
        });
      l.querySelector(".hover").addEventListener("change", function() {
        var e = this.previousElementSibling,
          n = e.hasClass("checked");
        t.enableHover(!n),
        e.toggleClass("checked"),
        i.hover = !i.hover
      }),
      l.querySelector(".scroll").addEventListener("change", function() {
        var e = this.previousElementSibling,
          n = e.hasClass("checked");
        t.setReverseWheelDirection(!n),
        e.toggleClass("checked"),
        i.scroll = !i.scroll
      });
      for (var m = l.querySelectorAll(".bf-color input"), g = 0, v = m.length; g < v; g++)
        !function(e, n) {
          m[e].addEventListener("change", function() {
            var n = r[this.value];
            t.setBackgroundColor(n),
            i.color = e
          })
        }
      (g);
      l.querySelector(".reset").addEventListener("click", function() {
        l.querySelector(".bf-color input").click(),
        i.scroll && l.querySelector(".scroll").click(),
        i.hover && l.querySelector(".hover").click(),
        l.querySelector(".hobby input").click(),
        l.querySelector(".contextmenu input").click(),
        l.querySelector(".bf-input-range").value = 15,
        y.reset(),
        i.cur = 15,
        t.setMinimumFPS(15)
      });
      var y = new Glodon.Web.Lang.Utility.Dom.range({
        element: l.getElementsByClassName("bf-FPS")[0],
        min: 4,
        max: 60,
        cur: i.cur,
        change: function(e) {
          t.setMinimumFPS(parseInt(e)),
          i.cur = e
        }
      });
      return a.cantainer.appendChild(s),
      a.cantainer.appendChild(l),
      a
    };
  t.SettingPanel = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e) {
      var i = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        n = Glodon.Bimface.UI.Control.ControlEvent;
      if (!i)
        return void console.log("The API is not supported on this viewer.");
      var o = new Glodon.Bimface.UI.Button.ButtonConfig;
      o.id = "Setting",
      o.title = "",
      o.className = "bf-button gld-bf-settings";
      var r,
        a = new Glodon.Bimface.UI.Button.ToggleButton(o);
      return a.addEventListener(n.Click, function() {
        if (a.isChecked()) {
          if (r)
            return r.show();
          r = new Glodon.Bimface.Application.UI.Panel.SettingPanel(t),
          r.addEventListener("Hide", function() {
            a.setCheckedState(!1),
            r.toggle()
          }),
          t.render(),
          e.appendChild(r.element)
        } else
          r.toggle()
      }),
      a
    };
  t.Setting = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Panel"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom"),
    i = {
      lock: !1,
      click: !0
    },
    n = function(t, n) {
      var o = this,
        r = {
          WalkMenu: {
            element: n,
            speedIndex: 2,
            className: "bf-panel bf-walk-panel",
            css: {
              left: "50%",
              bottom: "46px",
              borderRadius: "3px",
              background: "rgba(0, 0, 0, 0.6)",
              transform: "translate(-50%,-50%)",
              width: "390px",
              minWidth: 0,
              minHeight: 0,
              height: "50px"
            },
            title: "",
            easyMode: !0,
            enableSizable: !1
          },
          WalkSetting: {
            element: n,
            title: "",
            className: "bf-panel bf-walksetting-panel",
            css: {
              left: "50%",
              top: "50%",
              transform: "translate(-50%,-50%)",
              width: "330px",
              height: "207px"
            },
            enableSizable: !0
          }
        },
        a = [
          "0.50", "0.75", "1.00", "1.50", "2.00"
        ],
        s = (document.getElementById("cloud-main-canvas"), t.getViewer());
      if (o.WalkMenuPanel)
        o.WalkMenuPanel.show();
      else {
        var l = function() {
            var t = a[r.WalkMenu.speedIndex];
            f[0].innerText = t + "X",
            f[1] && (f[1].innerText = t + "X"),
            s.setMovementSpeedRate((t - 0) / 2)
          },
          c = function() {
            2 - a[r.WalkMenu.speedIndex] > 0 && (++r.WalkMenu.speedIndex, l())
          },
          h = function() {
            a[r.WalkMenu.speedIndex] - .5 > 0 && (--r.WalkMenu.speedIndex, l())
          },
          u = new Glodon.Bimface.Application.Panel(r.WalkMenu),
          d = e.create("div", "bf-person"),
          p = '<span class="person-text"><em class="orange">WSAD</em><em class="orange">QE</em></span>\n                  <div class="person-btns"><span class=" gld-bf-minus  speedBtn"></span><span class="speedNum">' + a[r.WalkMenu.speedIndex] + 'X</span><span class=" gld-bf-add speedBtn"></span><span class="setting"></span></div>';
        d.innerHTML = p,
        d.querySelector(".gld-bf-add").addEventListener("click", c),
        d.querySelector(".gld-bf-minus").addEventListener("click", h);
        d.getElementsByClassName("setting")[0].onclick = function() {
          if (o.WalkSettingPanel)
            o.WalkSettingPanel.toggle();
          else {
            var t = new Glodon.Bimface.Application.Panel(r.WalkSetting),
              n = e.create("form", "bf-setting"),
              d = '<ul class=\'person-setting\'>\n                          <li class="bf-setting-li">\n                          <span class="bf-setting-name"></span>\n                      <div class="person-btns"><span  class="speedBtn  gld-bf-minus"></span><span class="speedNum">' + a[r.WalkMenu.speedIndex] + 'X</span><span class="speedBtn  gld-bf-add"></span></div>\n                          </li>\n                          <li class="bf-setting-li lock">\n                          <span class="bf-setting-name"></span>\n\n                      <label class=" bf-checkbox">\n                          <span class="radioBox gld-bf-selected ' + (
                i.lock
                ? "checked"
                : "") + '"></span>\n                          <input type="checkbox" class="bf-orbit scroll" name="orbit" value="Left" checked="true">\n                          <span class="bf-radio"></span>\n                          </label>\n\n\n\n                          </li>\n                          <li class="bf-setting-li">\n                          <span class="bf-setting-name"></span>\n                      <div class="bf-setting-value bf-small viewpoint">\n\n                          <label class="bf-label bf-checked">\n                          <span class=' + (
                i.click
                ? "icon-checked"
                : "icon-nochecked") + '></span>\n                      <input type="radio" class="bf-orbit" name="orbit" value="Left" ' + (
                i.click
                ? 'checked="true"'
                : "") + '>\n                          <span class="bf-radio"></span>\n                          </label>\n                          <label class="bf-label">\n                          <span class=' + (
                i.click
                ? "icon-nochecked"
                : "icon-checked") + '></span>\n                      <input type="radio" class="bf-orbit" name="orbit" value="Right"' + (
                i.click
                ? ""
                : 'checked="true"') + '>\n                          <span class="bf-radio"></span>\n                          </label>\n\n\n                          </div>\n                          </li>\n\n                          </ul>\n                          <div class="bf-reset-wrap">\n                          <span class="person-reset "></span>\n                          </div>';
            n.innerHTML = d;
            for (var p = n.querySelectorAll(".viewpoint input"), f = 0, m = p.length; f < m; f++)
              p[f].addEventListener("change", function() {
                var t = this.previousElementSibling;
                t.hasClass("icon-checked");
                s.setWalkLookMousePressed(!i.click);
                var e = n.querySelector(".viewpoint .icon-checked");
                e.removeClass("icon-checked"),
                e.addClass("icon-nochecked"),
                t.toggleClass("icon-checked"),
                t.toggleClass("icon-nochecked"),
                i.click = !i.click
              });
            n.querySelector(".lock input").addEventListener("change", function() {
              var t = this.previousElementSibling,
                e = t.hasClass("checked");
              s.setWalkHeightLocked(!e),
              t.toggleClass("checked"),
              i.lock = !i.lock
            });
            var g = n.querySelector(".gld-bf-selected"),
              v = n.querySelector(".viewpoint input");
            n.querySelector(".gld-bf-add").addEventListener("click", c),
            n.querySelector(".gld-bf-minus").addEventListener("click", h),
            g.addEventListener("click", function() {
              this.checked
            }),
            n.querySelector(".person-reset").addEventListener("click", function() {
              i.lock && g.click(),
              i.click || v.click(),
              r.WalkMenu.speedIndex = 2,
              l()
            }),
            t.cantainer.appendChild(n),
            o.WalkSettingPanel = t,
            u.WalkSettingPanel = t,
            l()
          }
        },
        u.cantainer.appendChild(d),
        o.WalkMenuPanel = u;
        var f = document.getElementsByClassName("speedNum")
      }
      return o.WalkMenuPanel = u,
      u.hideSettingPanel = function() {
        this.WalkSettingPanel && this.WalkSettingPanel.hide()
      },
      u
    };
  t.WalkPanel = n
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    e = function(t, e, i) {
      var n = t instanceof Glodon.Bimface.Viewer.Viewer3D,
        o = Glodon.Bimface.UI.Control.ControlEvent;
      if (!n)
        return void console.log("The API is not supported on this viewer.");
      var r = new Glodon.Bimface.UI.Button.ButtonConfig;
      r.id = "Walk",
      r.title = "",
      r.className = "bf-button gld-bf-firstperson";
      var a,
        s,
        l = new Glodon.Bimface.UI.Button.ToggleButton(r),
        c = t.getViewer();
      return l.addEventListener(o.StateChange, function() {
        var n = i.getControl("Measure");
        if (l.isChecked()) {
          if (i.getControl("RectangleSelect").setCheckedState(!1), t.setNavigationMode(Glodon.Bimface.Viewer.NavigationMode3D.PickWithRect), s = c.getCurrentEditorName(), n.isChecked()) {
            var o = document.querySelector(".bf-measure-panel");
            o.style.bottom = "130px"
          }
          var r = i.getControl("Section");
          if (r.isChecked() && r.setCheckedState(!1), c.setEditorMode("walk"), a)
            return a.show();
          a = new Glodon.Bimface.Application.UI.Panel.WalkPanel(t, e),
          a.addEventListener("Hide", function() {
            l.setCheckedState(!1),
            a.toggle(),
            c.setEditorMode(s)
          }),
          t.render(),
          e.appendChild(a.element)
        } else if (c.setEditorMode(s), a.toggle(), a.hideSettingPanel(), n.isChecked()) {
          var o = document.querySelector(".bf-measure-panel");
          o.style.bottom = "70px"
        }
      }),
      l
    };
  t.Walk = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Toolbar"),
    e = function() {
      var t = {
          id: "MainToolbar",
          title: "",
          className: "bf-toolbar bf-toolbar-bottom",
          buttons: [
            "Home",
            "Person",
            "OrbitButton",
            "RectangleSelect",
            "Measure",
            "Section",
            "Annotation",
            "Property",
            "Information",
            "Setting",
            "FullScreen"
          ]
        },
        e = new Glodon.Bimface.UI.Toolbar.ToolbarConfig;
      return Object.assign({}, e, t)
    };
  t.MainToolbarConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Toolbar"),
    e = function() {
      var t = {
          id: "SectionToolbar",
          title: "",
          buttons: ["SectionVisiable", "SectionRotate", "SectionReset"]
        },
        e = new Glodon.Bimface.UI.Toolbar.ToolbarConfig;
      return Object.assign({}, e, t)
    };
  t.SectionToolbarConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Toolbar"),
    e = function() {
      var t = {
          id: "FamilyTypes",
          title: "FamilyTypes",
          className: "bf-toolbar bf-toolbar bf-toolbar-select",
          buttons: ["FamilyList"]
        },
        e = new Glodon.Bimface.UI.Toolbar.ToolbarConfig;
      return Object.assign({}, e, t)
    };
  t.FamilyListConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Toolbar"),
    e = function() {
      var t = {
          id: "ModelTree",
          title: "ModelTree",
          className: "bf-toolbar bf-toolbar bf-tree-toolbar",
          buttons: ["ModelTree"]
        },
        e = new Glodon.Bimface.UI.Toolbar.ToolbarConfig;
      return Object.assign({}, e, t)
    };
  t.ModelTree = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Toolbar"),
    e = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Button"),
    i = function(t) {
      for (var i = new Glodon.Bimface.UI.Toolbar.Toolbar(t), n = 0, o = t.buttons.length; n < o; n++)
        if (e[t.buttons[n]]) {
          var r = e[t.buttons[n]](t.viewer, t.element, i);
          i.addControl(r)
        }
      return i
    };
  t.Toolbar = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application.UI.Menu"),
    e = function(t, e, i, n) {
      var o = (Glodon.Bimface.Viewer.Viewer3D, Glodon.Bimface.UI.Control.ControlEvent),
        o = Glodon.Bimface.UI.Control.ControlEvent,
        r = new Glodon.Bimface.UI.Menu.MenuConfig;
      r.element = e;
      var a = new Glodon.Bimface.UI.Menu.Menu(r),
        s = function() {
          a && (a.destroy(), a = null)
        };
      self._contextMenu = a;
      var l = new Glodon.Bimface.UI.Menu.MenuItemConfig;
      l.id = "HideComponents";
      var c = new Glodon.Bimface.UI.Menu.MenuItem(l);
      c.setText(""),
      c.addEventListener(o.Click, function() {
        t.hideComponents(i),
        t.setSelectedComponentsById(),
        t.render(),
        s()
      });
      var h = new Glodon.Bimface.UI.Menu.MenuItemConfig;
      h.id = "SetComponentsOpacityssddd";
      var u = new Glodon.Bimface.UI.Menu.MenuItem(h);
      u.setText(""),
      u.addEventListener(o.Click, function() {
        t.setComponentsOpacity(i, Glodon.Bimface.Viewer.OpacityOption.Translucent),
        t.setSelectedComponentsById(),
        t.render(),
        s()
      });
      var d = new Glodon.Bimface.UI.Menu.MenuConfig;
      d.id = "IsolateMenu",
      d.isSubMenu = !0,
      d.text = "",
      d.className = "bf-sub-menu";
      var p = new Glodon.Bimface.UI.Menu.Menu(d),
        f = new Glodon.Bimface.UI.Menu.MenuItemConfig;
      f.id = "HideOthers";
      var m = new Glodon.Bimface.UI.Menu.MenuItem(f);
      m.setText(""),
      m.addEventListener(o.Click, function() {
        t.isolateComponentsById(i, Glodon.Bimface.Viewer.IsolateOption.HideOthers),
        t.setSelectedComponentsById(),
        t.render(),
        s()
      });
      var g = new Glodon.Bimface.UI.Menu.MenuItemConfig;
      g.id = "MakeOthersTranslucent";
      var v = new Glodon.Bimface.UI.Menu.MenuItem(g);
      v.setText(""),
      v.addEventListener(o.Click, function() {
        t.isolateComponentsById(i, Glodon.Bimface.Viewer.IsolateOption.MakeOthersTranslucent),
        t.setSelectedComponentsById(),
        t.render(),
        s()
      }),
      p.addControl(m),
      p.addControl(v);
      var y = new Glodon.Bimface.UI.Menu.Spacer,
        E = new Glodon.Bimface.UI.Menu.MenuItemConfig;
      E.id = "ShowAll";
      var x = new Glodon.Bimface.UI.Menu.MenuItem(E);
      return x.setText(""),
      x.addEventListener(o.Click, function() {
        n && n._root.setCheckedState(!0),
        t.showAllComponents(),
        t.render(),
        s()
      }),
      a.addControl(c),
      a.addControl(u),
      a.addControl(p),
      a.addControl(y),
      a.addControl(x),
      i && 0 == i.length && (c.disabled(), u.disabled(), p.disabled(), m.disabled(), v.disabled()),
      e.addEventListener("mousedown", function(t) {
        s()
      }),
      t.getDomElement().addEventListener("mousedown", function(t) {
        s()
      }),
      a
    };
  t.ContextMenu = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom")),
    i = function(t) {
      var i = this,
        n = [],
        o = t,
        r = e.create("div", "bf-container");
      t.domElement.appendChild(r),
      o.domElement = r,
      this.getViewer = function() {
        return s
      },
      this.getEventManager = function() {
        return c
      },
      this.getToolbars = function() {
        return n
      },
      this.getToolbar = function(t) {
        return "LeftToolbar" == t && (t = "ModelTree"),
        n.getObjectByAttribute("id", t)
      },
      this.render = function() {
        this.getViewer().render()
      },
      this.addView = function(t) {
        s.addView(t)
      },
      this.getAnnotationManager = function() {
        return a.getControl("Annotation")._annotationManager
      },
      this.addEventListener = Glodon.Bimface.Viewer.Viewer3D.prototype.addEventListener,
      this.removeEventListener = Glodon.Bimface.Viewer.Viewer3D.prototype.removeEventListener;
      var a,
        s = new Glodon.Bimface.Viewer.Viewer3D(o),
        l = Glodon.Bimface.Viewer.Viewer3DEvent,
        c = s.getEventManager();
      s.addEventListener(l.ViewAdded, function(t) {
        var e = t._data;
        if (o.Toolbars.indexOf("MainToolbar") != -1) {
          var l = Glodon.Bimface.Application.UI.Toolbar.MainToolbarConfig();
          l.element = r,
          l.viewer = s,
          l.buttons = o.Buttons,
          e.isSupportComponentProperty || l.buttons.removeByValue("Property"),
          a = Glodon.Bimface.Application.UI.Toolbar.Toolbar(l),
          n.push(a),
          a.resetState = function() {
            var t = a.getControl("OrbitButton"),
              e = Glodon.Bimface.Viewer.NavigationMode3D;
            if (!t)
              return void s.setNavigationMode(e.Select);
            var i = t.getCurrentControl().id,
              n = {
                OrbitPoint: e.Select,
                OrbitCamera: e.Fly
              };
            s.setNavigationMode(n[i]);
            var o = this.getControl("Walk");
            if (o && o._checked) {
              s.getViewer().setEditorMode("walk")
            }
          }
        }
        if (e.isSupportModelTree && o.Toolbars.indexOf("ModelTree") != -1) {
          var c = Glodon.Bimface.Application.UI.Toolbar.ModelTree();
          c.element = r,
          c.viewer = s;
          var h = Glodon.Bimface.Application.UI.Toolbar.Toolbar(c);
          i._modelTree = h,
          n.push(h)
        }
        if (e.isSupportFamilyTypeList) {
          var u = Glodon.Bimface.Application.UI.Toolbar.FamilyListConfig();
          u.element = r,
          u.viewer = s;
          var d = Glodon.Bimface.Application.UI.Toolbar.Toolbar(u);
          n.push(d)
        }
      }),
      s.addEventListener(l.ContextMenu, function(t, e) {
        var n = [],
          o = t.getSelectedComponents();
        for (var a in o)
          a && n.push(a);
        if (!i.disableContextMenu) {
          var l = new Glodon.Bimface.Application.UI.Menu.ContextMenu(s, r, n, i._modelTree.modelTree);
          i._contextMenu = l,
          l.setPosition({x: e.x, y: e.y})
        }
      }),
      r.onclick = function() {
        var t = document.activeElement,
          e = document.getElementById("cloud-main-canvas");
        t != e && "INPUT" != t.tagName && e.focus()
      }
    };
  t.WebApplication3D = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = function() {
      var t = {
          Toolbars: [
            "MainToolbar", "FamilyList"
          ],
          Buttons: ["Home", "Setting", "Information", "FullScreen"]
        },
        e = Glodon.Bimface.Viewer.Viewer3DConfig();
      return Object.assign({}, t, e)
    };
  t.WebApplicationRfaConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = Object.freeze({ViewAdded: "ViewAdded", ViewLoading: "ViewLoading", ComponentsSelectionChanged: "ComponentsSelectionChanged", Error: "Error"});
  t.WebApplicationRfaEvent = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom")),
    i = function(t) {
      var i = this,
        n = [],
        o = t,
        r = e.create("div", "bf-container");
      t.domElement.appendChild(r),
      o.domElement = r,
      this.getViewer = function() {
        return s
      },
      this.getEventManager = function() {
        return c
      },
      this.getToolbars = function() {
        return n
      },
      this.getToolbar = function(t) {
        return "LeftToolbar" == t && (t = "FamilyList"),
        n.getObjectByAttribute("id", t)
      },
      this.render = function() {
        this.getViewer().render()
      },
      this.addView = function(t) {
        s.addView(t)
      },
      this.getAnnotationManager = function() {
        return a.getControl("Annotation")._annotationManager
      },
      this.addEventListener = Glodon.Bimface.Viewer.Viewer3D.prototype.addEventListener,
      this.removeEventListener = Glodon.Bimface.Viewer.Viewer3D.prototype.removeEventListener;
      var a,
        s = new Glodon.Bimface.Viewer.Viewer3D(o),
        l = Glodon.Bimface.Viewer.Viewer3DEvent,
        c = s.getEventManager();
      s.addEventListener(l.ViewAdded, function(t) {
        var e = t._data;
        if (o.Toolbars.indexOf("MainToolbar") != -1) {
          var l = Glodon.Bimface.Application.UI.Toolbar.MainToolbarConfig();
          l.element = r,
          l.viewer = s,
          l.buttons = o.Buttons,
          e.isSupportComponentProperty || l.buttons.removeByValue("Property"),
          a = Glodon.Bimface.Application.UI.Toolbar.Toolbar(l),
          n.push(a),
          a.resetState = function() {
            var t = a.getControl("OrbitButton"),
              e = Glodon.Bimface.Viewer.NavigationMode3D;
            if (!t)
              return void s.setNavigationMode(e.Select);
            var i = t.getCurrentControl().id,
              n = {
                OrbitPoint: e.Select,
                OrbitCamera: e.Fly
              };
            s.setNavigationMode(n[i])
          }
        }
        if (e.isSupportModelTree && o.Toolbars.indexOf("ModelTree") != -1) {
          var c = Glodon.Bimface.Application.UI.Toolbar.ModelTree();
          c.element = r,
          c.viewer = s;
          var h = Glodon.Bimface.Application.UI.Toolbar.Toolbar(c);
          i._modelTree = h,
          n.push(h)
        }
        if (e.isSupportFamilyTypeList) {
          var u = Glodon.Bimface.Application.UI.Toolbar.FamilyListConfig();
          u.element = r,
          u.viewer = s;
          var d = Glodon.Bimface.Application.UI.Toolbar.Toolbar(u),
            p = d.getControl("FamilyList"),
            f = p.getCurrentControl();
          s.showFamilyTypeById(f.getId()),
          n.push(d)
        }
      }),
      s.addEventListener(l.ContextMenu, function(t, e) {
        var n = [],
          o = t.getSelectedComponents();
        for (var a in o)
          a && n.push(a);
        if (!i.disableContextMenu) {
          var l = new Glodon.Bimface.Application.UI.Menu.ContextMenu(s, r, n, i._modelTree.modelTree);
          i._contextMenu = l,
          l.setPosition({x: e.x, y: e.y})
        }
      })
    };
  t.WebApplicationRfa = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = function() {
      var t = {
          Toolbars: [
            "MainToolbar", "LeftSubToolbar"
          ],
          Buttons: ["Home", "RectZoom", "FullScreen"]
        },
        e = Glodon.Bimface.Viewer.Viewer2DConfig();
      return Object.assign({}, t, e)
    };
  t.WebApplication2DConfig = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = Object.freeze({Loaded: "Loaded", Error: "Error"});
  t.WebApplication2DEvent = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = function(t) {
      var e = new Glodon.Bimface.UI.Toolbar.ToolbarConfig,
        i = Object.assign({}, e, t);
      return new Glodon.Bimface.UI.Toolbar.Toolbar(i)
    },
    i = function(t) {
      for (var i = [], n = 0, o = t.length; n < o; n++)
        i.push(e(t[n]));
      this._Toolbars = i
    };
  i.prototype.getToolbar = function(t) {
    return this._Toolbars.getObjectByAttribute("id", t)
  },
  t.Toolbar = e,
  t.Toolbars = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = function(t) {
      var e = new Glodon.Bimface.UI.Button.ButtonConfig,
        i = Object.assign({
          type: "Button"
        }, e, t),
        n = (Glodon.Bimface.UI.Control.ControlEvent, new Glodon.Bimface.UI.Button[i.type](i));
      for (var o in i.handles)
        n.addEventListener(o, i.handles[o]);
      return i.html && n.setHtml(i.html),
      n
    },
    i = function(t) {
      for (var i = [], n = 0, o = t.length; n < o; n++) {
        var r = e(t[n]);
        if ("ComboBox" == t[n].type) {
          var a = t[n].options;
          for (var s in a)
            r.addControl(e(a[s]))
        }
        i.push(r)
      }
      this._Buttons = i
    };
  i.prototype.getButtons = function(t) {
    return this._Buttons
  },
  i.prototype.getButton = function(t) {
    return this._Buttons.getObjectByAttribute("id", t)
  },
  t.Button = e,
  t.Buttons = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = function(t) {
      var e = new Glodon.Bimface.UI.Panel.PanelConfig,
        i = Object.assign({}, e.css, t.css),
        n = Object.assign({}, e, t);
      return n.css = i,
      new Glodon.Bimface.UI.Panel.Panel(n)
    };
  t.Panel = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = function(t, e, i, n, o) {
      var r = new Glodon.Bimface.UI.Tree.TreeNodeConfig;
      r.hasCheckbox = n,
      r.isChecked = !0,
      r.selection = o;
      var a = new Glodon.Bimface.UI.Tree.TreeNode(r);
      return a.element.setAttribute("data-filter", i),
      a.setTitle(""),
      a.setData(t, e),
      a
    };
  t.Tree = e
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = (Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Viewer"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility"), Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Web.Lang.Utility.Dom")),
    i = function(t) {
      var i = this,
        n = t,
        o = e.create("div", "bf-container"),
        r = Glodon.Bimface.Viewer.NavigationMode2D,
        a = Glodon.Bimface.Viewer.Viewer2DEvent;
      t.domElement.appendChild(o),
      n.domElement = o;
      var s = new Glodon.Bimface.Viewer.Viewer2D(n);
      this.load = function(t) {
        s.load(t)
      },
      this.getViewer = function() {
        return s
      },
      this.getToolbars = function() {
        return f
      },
      this.getToolbar = function(t) {
        return f.getToolbar(t)
      },
      this._panels = {};
      var l = {
          MainToolbar: {
            id: "MainToolbar",
            title: "MainToolbar",
            element: o,
            className: "bf-toolbar bf-toolbar-bottom"
          },
          LeftSubToolbar: {
            id: "LeftSubToolbar",
            title: "LeftSubToolbar",
            element: o,
            className: "bf-toolbar bf-toolbar-select"
          }
        },
        c = {
          Home: {
            id: "Home",
            title: "",
            className: "bf-button gld-bf-home",
            handles: {
              Click: function() {
                s.home()
              }
            }
          },
          RectZoom: {
            id: "RectZoom",
            title: "",
            type: "ToggleButton",
            className: "bf-button gld-bf-zoomrect",
            handles: {
              Click: function() {
                s.rectZoom(function() {
                  v.getButton("RectZoom").setCheckedState(!1),
                  s.setNavigationMode(r.Pan)
                })
              }
            }
          },
          Information: {
            id: "Information",
            title: "BIMFACE",
            className: "bf-button gld-bf-information",
            type: "ToggleButton",
            handles: {
              Click: function() {
                if (this.hasClass("bf-checked"))
                  if (i._panels.InformationPanel)
                    i._panels.InformationPanel.show();
                  else {
                    var t = new Glodon.Bimface.Application.Panel(h.Information);
                    t.setHtml('<div class="bf-info"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANEAAAAfCAYAAAB52CgrAAAABGdBTUEAALGPC/xhBQAAFJlJREFUeAHlXAt8VcWZn5lzbyAQIIRAoSISEnyBVq1u17oqspqg5WeLq65WixV8oNQVpGopdqtWVizUoi1QFJDCyq9VKau7KyGAPBStRayPtVLzIKBSH0A0JCHJvWdm/9+5Z86dc+85ed5AKPPLZGa++WbmO+fMf75vvjPn8q/s3jDCbrJPZUaQ3KpiPD5MSB7RZNtSasSI/LLdHx4YyBrVWZrupIL9jSnZhymR46P3772lV4OKNDQ1nGfSbcFraoqKt5m0oHywbGrXgZHj3tP8A6pK/4HH+SBdTk1VlFXsLyjZmUrv6rJSiudVrb/UspUIG6tntnr1o+PHHQir13T01Qf50xDzNK2DaRztXuWc17a3PWSguZCNWI/2sr3t28KPMU4AXwGifx61pXGS5zPI96dkMT2Hceg6oog8vbZdlCaM1RhpaoqN54z/C2PqAt2cMzWfSTXZZs7Dc8jgmV5dsS9PgoaGYyEI2iQCV+w55E5VTCbBaIk5/Iu6wXWcC8XV6UypqQb/H/PKS5eeXtRj+WZ+ET3YwODIxtkVTLELNQNX4nHk76RyfnnpWZLxYYrLXynFBmsenXLODnEmLur/QelDB0aW/ARyK13XlWl+1dqT8ipLL2eKD8M9/EHgWJwtbGgSX0XdE4H1IOIe90IyB/EWxB6ImQi0AI1uT0eQoxD8OxD7Ib6O8nm4l3Z7+gjjRV80ka9HvBdxVBhfe+jo83bItyi1DehTQLsP8bjUug6WbfQ5TGCw+Yqp1QDl1rCOuMWnK8m+jRk4Blc8E9e9E+3QJiQQgKQagWlwFTTUjWiTzThf4OdWV71T0fT0GLXJ03b+ekjE2aMA739hvdiSWueUOeunbLWEWeIO8H6SygM571cxiYejZg0oL1vkPrBUtoyW88o3nCptthnAnyO5XIOL2JM2AACEe9KDFqq0OpcAWYci+zbiHYiZAhD1PgJ90yrcnjALzAQgCt9AvNLJdfIf5CCNQPNoBWJGAOSKdJKbOgk9d0Qag4CVKQBR3xZibgTLHfAAICk1DRMWtKRGIi4NIPCNwYSoIhpjcpZSYjYm7mq08zSSU+UCCPSrUV9GNOQnYYxlGGkBCp5GIh4AiQFI14VoJLr4X6LtdNwGdJTUSM5Yic4BJLaEW+ImbhsaibM/o8FeaKgJDhuTtw6oKI3cr9Qt93eROdK/cv1pTMY3YEzHvLQYXwSL+E6uYms8eV0AgWcy7nZLZscStCny2jH2LvIViJ3RpjG0fxr3k9I2Bdx/AvP1Kcw/Qvn3KbSOFJejkfN83MYNSN9C/NQtByWtXf9naDQ7peGdKH/PoH2E/JuIcYPWkez7aPTXhBZIAxKqYNNxkdBADoDShkgCyXuuBoBS2X1AYurrur4NQCIQmkDSTZOpUilA4vlCRO6RdhwPOnnPaeI+VrEuCiDdmGkgDdxVdkY8Fl+P0fK1YBjvRMHi52PxWIWL+C7uqaOBSA7NE5Tiemlilbh1jUgnYOKXBvEeBtoMjJGquc6AjOM6IxPaX45+rzbk/zXy96JPAlLGAsYR6Ow+o0PaDszAOJ0FkNclDZAIGkhk2in2CuORH5IJFwwg3YiAxHcirmGCzyMTDkKbN0YzOinqJmH1zcYFkFr1ArVpzbQDzy9d0+5lr6GZcYDkmnaCz5QyDjNIpW/ElZoIIK28SilSxRkJ+RXrvh6PyY3ozAOQ7him8jSmrFXQ4v9BJlxrAHLbjdftkc7rzGQ1+ml3Fvd8ABrdbDTcbORnGvmOZKcbjZbhGmGSZxZAbv/9kdJ1UChHnI5xMgYg6jTCo9Y0yuggbJsNLyx5ofqjlwbxJlmJh/8zXQcLcK+0xTLBlc9Gz+7R9zVpNfVuamjeDQEXa35LqP0S9gy2jtqedqr6WFlv1kbtch6TL2peSt/dE7sQCU1GJ0AT3sVEEufcthVke167s6K9+lTJpnq//DGZlcsLf7VfVDVwIV7SfaWmGz57eRSA9N6zndwgF5WX96hhVaN5VDyYOoYuSyUOwhpdzISaACB58oq42qd5UtJhRnmLkT/cWdqP9XYHfR3ptYi7EHsiXgCQnYvn/Rry7Qpol40G5xuNOgtIo6u0LI2lwzbIK3UhU2lExez5vs7gRKiuXD9+f1Ex2fEf++paLhxCdeikNZvuRwEeswKYNyOh6bw9Esp/QZW3wVRSPcpsO4kiy5pBsoHH2WPEGg6OAI8nP/ZgtTISnVyjdsMbyHapuL0GqQ/wWg5Re2jmxtp1swCk73YUSAMqN5xToyqvxKSYqGLp3kFnLM439eqd92RT/YErlC3PgGb6vpYBnkXaEz2ty0aaZeTrjfxhy+KaCDwEIh0exgT8BPSnQLjNJdLkJ7OsvYG8ktoSqEa/tI/pqoB1ywtt3gt6LdqQSU5QMGsnglLygja07RQLvM034OoCvHbB3XIAiEn7WwDNmCAOAhCzopNZPP4Yl/bgmqKStYyLCQBmUxA/0TAhrt5YsW5VR0w7AhBMxjLIkxvWP7T4puze+eP3fvXsBrj/bwOADsIkXR7K370qyK2uzWHaQL/gijcPqe3mx+MeeoueS2tL0stg0oaFQTq6sh6INIBa3gNl9uLwAJw9EiZbivvbP44HIMXG+msSJRNAmKi0yjmhq4CkAYR71SYAaXmQ3nE0AAnPhTThXYbcj0BbwGeChTbhoX3GraNVnjx1x3RwQHQkAKTveitAUh0FkO4/00BqI4A2aw2k5TDSowFI10Peoa7Me5CuMuSnLL0A1uEaPMMTdOFYTMWRBJC+4RpIOF3g00hwLPzQMeFCNBDWRc+EMzWQ7lenmQJSOwD0LTLh9PgBqQMkuL6XB9QdURKeBS2s9xhC/ALax7eXQPkd1GunEL0mudvgP+ayES6yXmPCMXGf11dv25JuUmDAcZ1RVkT43hv0ZtGdYO5Zz2LDzUY8bh2UQllcSNMGZiqnV2Xsy/pH0M9ak59Jvt0sk2wKssFm+G9Nt6V6V+f3FZXsyKvaUMCi1lxz99hs9yYb3hcISP0r1uH9C04RhDgbMIFoj8SCnA2dBRCcjAukiDxrCgWvnZ6IJvlI53GP2EmuEOQ9XBIi0MOgX+bWTcK9ewDg+jyE9++aHGF280mYVJNxE0brK7VwggH5EE+bKo3HbK3qyUj+dR1rXC+taBazJfUzTvcD73EZk6wvThT8Y5LGV/PaQ6uwfGFfbp+JfcVEp47zL4QQl2g+J1XxE5VtT4J8p2m6xZyzcxupTIB29rhx+QDev/TVPFn8YCXyFbqsUx+QNDElDQJSZwFEQ0jJpio7/k09HBwMfxCW/SHKuzWtm6TmHudxACNQo4L+Cu7VNsh8HiK5kachzkI85kIED3cJVsmbgIa7TSC16U4AQNAAvSQdqbBjpyohVpIX3gSS2Q9uPI4J8Z04GkPqvxbl9xXjK5C/3AKA9hUWv2HyS9t+UkTErTIuZ5hA0jyCs0Gom88iYjKO/Cw1gaR5UlMNJLy7OtnzMaUwmUB6qWrjWeSFa9GJoOCFy8m/qRUTzhuFAIR3Rn9hNiezabVXEZy5F/J8FlzVbiqZajtw3xcFtcQ4F4N+tltXh5ROEbQUSBv9j8twO9rPQd8HW2pwhOvOh4xPZFAGsnjmQyGoKF6Ith9ILoAgFM7FOae4oRTkw8oSM4OA5AEI5+4w8B/pQuAevhP7nsfwwuCczwuL0zQHWKIypp4UUXFzGJDgMjqOdwBIo9R7Gz+u3IOXUI4nisRJCYqtr15/muDyDLyfm002ZVAQFts+enjPbZv52fGg+lSaBhBOg9yHLv+UWh9Q/nYArTOka/HMluB5+PY5bofmS8/F4KlpZSAyR8m8JkuBPJX0/ujniN01nAzBKGYyvAgQUfADKUFr4b8BoDQuA0jol1Y+cosmNFACQL4mBCR8X0Q0MgcCAmSLMRNIaTypQEpjCCC8x0c1968srYSp+QdUmy83E9wwL62I3Koa2VBoz38P6AIkvtXK4YtCDs+mNTEBlFZ5+AhknqUBHsA6B/SxrhjNSB9186EJniuaqTlg0C+Mp6H8GOih7+ZCOzt6Kw65IKIrSAIJk8ag+69OwYOGs6kjcbMm+WuMUhJIjUBQBKsuVilHAxlMySwBKa+ilB0oGtcqkFScBcpmAglmUm2y9/BcTeG4/wWQrmC2SgcSVz9SjXwpi/L5vJnB7FSn+HviW7P68ss+HVxS76eHlDjAylUuaaAQjjDyQ6igPV4mAjmE6KM83K60YGqhFeDZm8qhVuScwifWpTptfg8+krEAcQji9xEXI3bHsAVCLc+gYO/jPu2JWBG4kY2gJM8tKCpedMCgmVmYbk9Db1yExiSQE/Ch3G7Ycv2U4KTSEwEbFJ6bs6ZnY130UBMbj1X7Bl2F4y6f41O9PjDjyjSN0n6fbCn4cvCFuzTNEtbdjEsMlwgSpwMKikoWatniIloVETGf/LZkkX0jiz3ZdNuwNBBIOGkAk3QQgDOaNcM8sayJ2Me9gH2Zo1lJA7ULQBic94j+jsdi16AHT944E23Z67yIe/1amPyZoGNBJBPnO25f2NWmm2RqRf9hsVjsd6j7msvnJJCNPkybh8ICl057azIXHZevydsN8h9AruWZliNix50bkOzX4nN2V677JxA2JYnJ3IGiEvIorUhS2pRL488rX7vOVqw42ZpvFQfrP0DZA5Et7bnJiYuJKMTc6sqy88HzErWLyNgIuLzpAerQLLiYTN/11BRe4rnCdWVYagIJi4TNIuoRaLznMTaCysMxoolYEhYi/4OOAIh6kQ3217hg/4wJdimVKQgmaU+00ikc2X/3Yni9WK3GRCtPFac53jwFtNNjy3IujE6qS12klqHup4iDEAsRr0IkwB0TwV1Z3Wt1vweSqkOHCjtxw/hWrPqr8bKVvD2BgQAEP/HxzucZgRwMALLgYpezLCmHB7OEUwlIzOJXYC79GDuGnwBAPTQ3Jj4+MOT4PIT9Z3s1kO4D78pmQZG9gn7Walp3SHFtx0OO6wxZ5hh5J6ueGZWF/dxNVICamppaj2tqBG2+QSdQHjMhCaIWPqjr2rvhAsh5N+V8b582nAcgxq5Jq0wQPAABjCeH8LRKJiDxCD5+4/wN8hqaEY2Prxl56ffavAcKGk3Zs7shkGZAVNorUSgDIN5MZJP/mxuq8f5ZDSQKXAkT1Mp82vukBmhqHAJOBPpoz9O4qYx/b+WIc0HdAUDwZngGhXGXDxeA9JDuLwOFODg0VydSAhK3ZjmftSjvY7FOdNjxppjoA9Da0TBuL2laiOjc5lOxODks+B+JxxtvQeEBh+D+A/i+RH+LUNRaiF7adiuta8qbybzAj3w4PyqCG3B1JjturS/8CFDChCMNRAAKDOLnjgkXooHgoGjSJlxnNFDg0F1JdDUSNN6LXTlMG/r+N/D0dvleBxA2pbZp/m3umbi355p0OHhuUZvGJBZgsyJh0pFpR4E+2vtmIpv2n1zoOujxdfmoSyPY/zwXEexiqAFPjcOLvCPsSoZ+WJonrR5JMxCMJw5hX1RXs0hzD//vhTXWZzf3jRwSoPtueP8hg2p3fVjzVHZz3fXQPjP1nhZOjk/McWVUPRux+SVA2FuaDrh5csLJ8eqAirKvYMO+3FRjPAunIrpZwMmQ38AT+kJSLCwBVq+nkuXDm8MEz8GIcJR4IVgLsXguvK4/87h0Ztc7ZNKRk8kLACF9tLcchCkukbTR5W7eTP5mFOh1SQ7a1hm0rsr65m2mBolYgo/Az05NxYXQBtMJFo/TJnGDW/QlDY3qbaUah2oiLn71W7v448IW2fgg7iF4ts9O1jWW1cZxdi6WPDsHwGytr/r4wZ7SvgcA9rxzAMr23KyexV/oxkgtyUdg1bsdmmqYJgMsjyO/nsoDK0qLpJI54HkQxSyiUeCNOFKT+J7eKXeHfzhaNUXavpX5FckaaLEyJ9ThFJVMsjx3wPeRegeQTSGiN9SRdkrTUCZPSn4uyjcjWoj00d5ozJH/M3lQrgX9z6CdiUgTm/ZlPvMQ5UyFJqOj0418xrL4MRq5DCYd/fqJb1VpywgEIFhiO4UtcbQ/Plco8SRcxG+Et004EeA9861sBKC+0Z7F1QUXmRiiY0RLIxaO2Qf9dhsGUdjsA7QzBXc8R6aJEC5Ct6jhL+Msx7OWVL77cLhEwwSmBecuYzzvozuD1qEs5kQVGj7jNsaj9fZIqf0tNgj4wRtFoO6KcACdahPznK4YJwJ7Nwdnz5bhEOckHOL8BQbxNFJLV6QB5J5EeA53y7K5XGQpcRt+tBDKI6mREv34vHCv675DAQQGgCTHjrOlkQibHLc53hklNZJuD/lPwY97OUCSeMkHuqeRNE/3SglA6jmuaC/Ith8h2f4V4x7njr0H6aoMy0Gm4bVun/TR3lTMl9qUMZaifCPiNxDJO7gYfGRevorYGe1ML7Dp14McDYQ0jn7pRTBpOwo0zpVI6R1djAidCHRi4Rlnr5IKpNY6RcPgs3Dw3zpA4nwKYGR0YwDI8MK1BCDdmGSz49wAkq5JpgFASlZ2q5wJIHKm4O/IBDK3dEj76E5XdDTF/HgHE5WcJpch0hyjA6rbEL3gTu7vgLAOUZtZxEexs2EwOvip0cl9yJOT41yXdglSip0OuM4d3kaLJqs27fBwaXUKDmEA0twEJKV+AxPrCeBlO25WoBeO6gJNON2PkSaABI1Epp1QgbIRkLRpJ5nsdqYd4GJooDBvpHHRXZvV94dWfNLeXRFmo1O9ktpBA2BukCPpPMR5iIeCeDpIwzvhZMA4ZM5djLgIMZ6syUhO8QHlpT/2dYXvQcYWFi8M+xmpIVUbT2i2Y9f52wg6oDkQL+LyNR1XYVu5OQuds3ON6lYAM7nscv7x/qKS32resHRA+dqZ/naqbmzhuAVatjBZ3J/7Cuv2iNDJq3ko7T6ovfuLLl2eKhBWN/r8YYhLX4NJ8GkqT2fK6D8H7U9BrETftGfokoBxCtBxP8S3MY4GVOBY4CVX91hEakPydTTQvVqJ8fRC4evHvfbhIPZB9JSIj6nthX0Y56//Dy5GPw14sZShAAAAAElFTkSuQmCC" /><p>Powered by BIMFACE</p><a target="_blank" href="https://bimface.com">https://bimface.com</a></div>'),
                    i._panels.InformationPanel = t,
                    t.addEventListener("Hide", function() {
                      v.getButton("Information").setCheckedState(!1)
                    })
                  }
                else
                  i._panels.InformationPanel.hide()
              }
            }
          },
          FullScreen: {
            id: "FullScreen",
            title: "",
            className: "bf-button gld-bf-maximize",
            handles: {
              Click: function() {
                var t = this.hasClass("gld-bf-maximize");
                s.enableFullScreen(t),
                Glodon.Web.Lang.Utility.FullScreen.onFullScreenChanged(function() {
                  var e = m.getControl("FullScreen");
                  e.getTitle();
                  e.toggleClassName("gld-bf-maximize"),
                  e.toggleClassName("gld-bf-minimize"),
                  t
                    ? e.setTitle("")
                    : e.setTitle("")
                })
              }
            }
          }
        },
        h = {
          Information: {
            element: o,
            title: "BIMFACE",
            css: {
              left: "50%",
              top: "50%",
              width: "330px",
              height: "278px",
              transform: "translate(-50%,-50%)",
              zIndex: 999
            },
            enableSizable: !1
          }
        };
      if (!t.Toolbars || 0 == t.Toolbars.length)
        return !1;
      for (var u = [], d = 0, p = t.Toolbars.length; d < p; d++)
        u.push(l[t.Toolbars[d]]);
      var f = new Glodon.Bimface.Application.Toolbars(u),
        m = f.getToolbar("MainToolbar");
      if (m) {
        for (var g = [], d = 0, p = t.Buttons.length; d < p; d++)
          g.push(c[t.Buttons[d]]);
        var v = new Glodon.Bimface.Application.Buttons(g);
        m.addControls(v.getButtons())
      }
      var y = f.getToolbar("LeftSubToolbar");
      y && s.addEventListener(a.Loaded, function(t) {
        for (var e = t.getViews(), i = {
          type: "ComboBox",
          id: "Views",
          inheritTitle: !0,
          options: {},
          handles: {
            Change: function(t) {
              s.showViewById(t.id)
            }
          }
        }, n = 0, o = e.length; n < o; n++) {
          var r = e[n];
          i.options[r.name] = {
            type: "ComboBoxOptionButton",
            title: r.name,
            id: r.id,
            className: "bf-button",
            html: '<span class="bf-button-name">' + r.name + "</span>"
          }
        }
        var i = new Glodon.Bimface.Application.Buttons([i]),
          l = i.getButtons()[0];
        s.addEventListener(a.ViewChanged, function(t) {
          l.setSelectedControlById(t)
        }),
        y.addControls(i.getButtons())
      })
    };
  t.WebApplication2D = i
}(),
function() {
  var t = Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon, "Bimface.Application"),
    e = function(t, e) {
      var i;
      if ("dwgView" == t.viewType) {
        var n = new Glodon.Bimface.Application.WebApplication2DConfig;
        n.domElement = e;
        var o = Glodon.Bimface.Application.ApplicationEvent;
        i = new Glodon.Bimface.Application.WebApplication2D(n),
        i.load(t.viewToken)
      } else if ("rfaView" == t.viewType) {
        var n = new Glodon.Bimface.Application.WebApplicationRfaConfig;
        n.domElement = e;
        var o = Glodon.Bimface.Application.WebApplicationRfaEvent;
        i = new Glodon.Bimface.Application.WebApplicationRfa(n),
        i.addView(t.viewToken),
        i.addEventListener(o.ViewAdded, function() {
          i.render()
        })
      } else {
        var n = new Glodon.Bimface.Application.WebApplication3DConfig;
        n.domElement = e;
        var o = Glodon.Bimface.Application.WebApplication3DEvent;
        i = new Glodon.Bimface.Application.WebApplication3D(n),
        i.addView(t.viewToken),
        i.addEventListener(o.ViewAdded, function() {
          i.render()
        })
      }
      this._application = i
    };
  e.prototype = {
    hideBimfaceInfo: function() {
      this._application.getToolbar("MainToolbar").getControl("Information").hide()
    }
  },
  t.WebApplicationDemo = e
}(),
window.Glodon = Glodon;
